(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[3325],{73325:(ce,N,p)=>{"use strict";p.r(N),p.d(N,{plugin:()=>Cr});var S=p(29997),d=p(35383),_=p(86833),e=p(74848),C=p(22803),A=p(96540),z=p(55801),K=p(37e3),q=p(29675),J=p(54874),M=p(76302),b=p(60484),F=p(34128);const X=t=>(i,r)=>{const n={};for(const o in t)n[o]=t[o](i[o],r);return n},ae=(t,i,r)=>(0,A.useCallback)(o=>{t(r(i,o))},[t,i,r]),ye=(0,A.createContext)(void 0),B=()=>{const t=(0,A.useContext)(ye);if(!t)throw new Error("Use DispatchContext first.");return t},ue=t=>({name:t,pipelineAgg:""}),It=t=>`var${Math.max(0,...t.map(i=>parseInt(i.name.match("^var(\\d+)$")?.[1]||"0",10)))+1}`,At=t=>t.settings?.model==="ewma",rt=t=>t.settings?.model==="holt",Oe=t=>t.settings?.model==="holt_winters",vs=t=>["holt","ewma","holt_winters"].includes(t.settings?.model||""),de=t=>Q[t.type].requiresField,Se=t=>Q[t.type].isPipelineAgg,Re=t=>Q[t.type].supportsMultipleBucketPaths,xs=t=>Q[t.type].supportsMissing,ie=t=>Q[t.type].hasSettings,fe=t=>Q[t.type].hasMeta,Fe=t=>Q[t.type].supportsInlineScript,Ct=["count","avg","sum","min","max","extended_stats","percentiles","cardinality","raw_document","raw_data","logs","moving_avg","moving_fn","derivative","serial_diff","cumulative_sum","bucket_script","rate","top_metrics"],wt=t=>Ct.includes(t),Q={count:{label:"Count",impliedQueryType:"metrics",requiresField:!1,isPipelineAgg:!1,supportsMissing:!1,supportsMultipleBucketPaths:!1,hasSettings:!1,hasMeta:!1,supportsInlineScript:!1,defaults:{}},avg:{label:"Average",impliedQueryType:"metrics",requiresField:!0,supportsInlineScript:!0,supportsMissing:!0,isPipelineAgg:!1,supportsMultipleBucketPaths:!1,hasSettings:!0,hasMeta:!1,defaults:{}},sum:{label:"Sum",impliedQueryType:"metrics",requiresField:!0,supportsInlineScript:!0,supportsMissing:!0,isPipelineAgg:!1,supportsMultipleBucketPaths:!1,hasSettings:!0,hasMeta:!1,defaults:{}},max:{label:"Max",impliedQueryType:"metrics",requiresField:!0,supportsInlineScript:!0,supportsMissing:!0,isPipelineAgg:!1,supportsMultipleBucketPaths:!1,hasSettings:!0,hasMeta:!1,defaults:{}},min:{label:"Min",impliedQueryType:"metrics",requiresField:!0,supportsInlineScript:!0,supportsMissing:!0,isPipelineAgg:!1,supportsMultipleBucketPaths:!1,hasSettings:!0,hasMeta:!1,defaults:{}},extended_stats:{label:"Extended Stats",impliedQueryType:"metrics",requiresField:!0,supportsMissing:!0,supportsInlineScript:!0,isPipelineAgg:!1,supportsMultipleBucketPaths:!1,hasSettings:!0,hasMeta:!0,defaults:{meta:{std_deviation_bounds_lower:!0,std_deviation_bounds_upper:!0}}},percentiles:{label:"Percentiles",impliedQueryType:"metrics",requiresField:!0,supportsMissing:!0,supportsInlineScript:!0,isPipelineAgg:!1,supportsMultipleBucketPaths:!1,hasSettings:!0,hasMeta:!1,defaults:{settings:{percents:["25","50","75","95","99"]}}},cardinality:{label:"Unique Count",impliedQueryType:"metrics",requiresField:!0,supportsMissing:!0,isPipelineAgg:!1,supportsMultipleBucketPaths:!1,hasSettings:!0,supportsInlineScript:!1,hasMeta:!1,defaults:{}},moving_avg:{label:"Moving Average",impliedQueryType:"metrics",requiresField:!0,isPipelineAgg:!0,versionRange:"<8.0.0",supportsMissing:!1,supportsMultipleBucketPaths:!1,hasSettings:!0,supportsInlineScript:!1,hasMeta:!1,defaults:{settings:{model:"simple",window:"5"}}},moving_fn:{label:"Moving Function",impliedQueryType:"metrics",requiresField:!0,isPipelineAgg:!0,supportsMultipleBucketPaths:!1,supportsInlineScript:!1,supportsMissing:!1,hasMeta:!1,hasSettings:!0,defaults:{}},derivative:{label:"Derivative",impliedQueryType:"metrics",requiresField:!0,isPipelineAgg:!0,supportsMissing:!1,supportsMultipleBucketPaths:!1,hasSettings:!0,supportsInlineScript:!1,hasMeta:!1,defaults:{}},serial_diff:{label:"Serial Difference",impliedQueryType:"metrics",requiresField:!0,isPipelineAgg:!0,supportsMissing:!1,supportsMultipleBucketPaths:!1,hasSettings:!0,supportsInlineScript:!1,hasMeta:!1,defaults:{settings:{lag:"1"}}},cumulative_sum:{label:"Cumulative Sum",impliedQueryType:"metrics",requiresField:!0,isPipelineAgg:!0,supportsMissing:!1,supportsMultipleBucketPaths:!1,hasSettings:!0,supportsInlineScript:!1,hasMeta:!1,defaults:{}},bucket_script:{label:"Bucket Script",impliedQueryType:"metrics",requiresField:!1,isPipelineAgg:!0,supportsMissing:!1,supportsMultipleBucketPaths:!0,hasSettings:!0,supportsInlineScript:!1,hasMeta:!1,defaults:{pipelineVariables:[ue(It([]))]}},raw_document:{label:"Raw Document (deprecated)",requiresField:!1,impliedQueryType:"raw_document",isPipelineAgg:!1,supportsMissing:!1,supportsMultipleBucketPaths:!1,hasSettings:!0,supportsInlineScript:!1,hasMeta:!1,defaults:{settings:{size:"500"}}},raw_data:{label:"Raw Data",requiresField:!1,impliedQueryType:"raw_data",isPipelineAgg:!1,supportsMissing:!1,supportsMultipleBucketPaths:!1,hasSettings:!0,supportsInlineScript:!1,hasMeta:!1,defaults:{settings:{size:"500"}}},logs:{label:"Logs",requiresField:!1,isPipelineAgg:!1,supportsMissing:!1,supportsMultipleBucketPaths:!1,hasSettings:!0,impliedQueryType:"logs",supportsInlineScript:!1,hasMeta:!1,defaults:{settings:{limit:"500"}}},top_metrics:{label:"Top Metrics",impliedQueryType:"metrics",requiresField:!1,isPipelineAgg:!1,supportsMissing:!1,supportsMultipleBucketPaths:!1,hasSettings:!0,supportsInlineScript:!1,hasMeta:!1,defaults:{settings:{order:"desc"}}},rate:{label:"Rate",impliedQueryType:"metrics",requiresField:!0,isPipelineAgg:!1,supportsMissing:!1,supportsMultipleBucketPaths:!1,hasSettings:!0,supportsInlineScript:!0,hasMeta:!1,defaults:{}}},Us={moving_avg:[{label:"window",default:5},{label:"model",default:"simple"},{label:"predict"},{label:"minimize",default:!1}],moving_fn:[{label:"window",default:5},{label:"script"}],derivative:[{label:"unit"}],serial_diff:[{label:"lag"}],cumulative_sum:[{label:"format"}],bucket_script:[]},Mt=(t,i)=>{const r=i.filter(n=>Re(n)?n.pipelineVariables?.some(o=>o.pipelineAgg===t.id):de(n)&&t.id===n.field);return[...r,...r.flatMap(n=>Mt(n,i))]},Tt=[{label:"Avg",value:"avg"},{label:"Min",value:"min"},{label:"Max",value:"max"},{label:"Sum",value:"sum"},{label:"Count",value:"count"},{label:"Std Dev",value:"std_deviation"},{label:"Std Dev Upper",value:"std_deviation_bounds_upper"},{label:"Std Dev Lower",value:"std_deviation_bounds_lower"}],bs=[{label:"Simple",value:"simple"},{label:"Linear",value:"linear"},{label:"Exponentially Weighted",value:"ewma"},{label:"Holt Linear",value:"holt"},{label:"Holt Winters",value:"holt_winters"}],Et={pre:"@HIGHLIGHT@",post:"@/HIGHLIGHT@"},ve="3";function ge(t="1"){return{type:"count",id:t}}function nt(t="1"){return{type:"date_histogram",id:t,settings:{interval:"auto"}}}const Ie=(t,i)=>t.find(r=>r.id===i);function at(t,i){return!!t?.metrics?.some(r=>r.type===i)}function Ks(t){return t in pipelineOptions}function Dt(t){return!!metricAggregationConfig[t].supportsMultipleBucketPaths}var Ve=p(99589);const xe=t=>de(t)?`${Q[t.type].label} ${t.field}`:Q[t.type].label,Le=t=>Object.entries(t).reduce((i,[r,n])=>{if(n==null)return{...i};if(Array.isArray(n)&&n.length===0)return{...i};if(typeof n=="string"&&n.length===0)return{...i};if(!Array.isArray(n)&&typeof n=="object"){const o=Le(n);return Object.keys(o).length===0?{...i}:{...i,[r]:o}}return{...i,[r]:n}},{}),lt=t=>{const i=t.match(/^(\d+)/);return i?i[1]:void 0},Ne=t=>(typeof t.settings?.script=="object"?t.settings?.script?.inline:t.settings?.script)||"",Pt=t=>!!(0,Ve.gte)(t,"7.16.0"),_t="Support for Elasticsearch versions after their end-of-life (currently versions < 7.16) was removed. Using unsupported version of Elasticsearch may lead to unexpected and incorrect results.",Be=t=>t?.bucketAggs?.slice(-1)[0]?.type==="date_histogram",ot=/\$(\w+)|\[\[(\w+?)(?::(\w+))?\]\]|\${(\w+)(?:\.([^:^\}]+))?(?::([^\}]+))?}/g;function Ot(t,i){i=i||{};const r=i.delimiter||".";let n=i.maxDepth||3,o=1;const u={};function f(v,$){Object.keys(v).forEach(h=>{const x=v[h],D=i?.safe&&Array.isArray(x),O=Object.prototype.toString.call(x)==="[object Object]",G=$?$+r+h:h;if(i?.maxDepth||(n=o+1),!D&&O&&x&&Object.keys(x).length&&o<n)return++o,f({...x},G);u[G]=x})}return f(t,null),u}var R=p(65307);const Qe=(0,R.VP)("@metrics/add"),We=(0,R.VP)("@metrics/remove"),qe=(0,R.VP)("@metrics/toggle_visibility"),Ae=(0,R.VP)("@metrics/change_field"),Ce=(0,R.VP)("@metrics/change_type"),ct=(0,R.VP)("@metrics/change_attr"),k=(0,R.VP)("@metrics/change_setting"),Rt=(0,R.VP)("@metrics/change_meta"),we=(0,R.VP)("init"),Vt=(0,R.VP)("change_query"),Lt=(0,R.VP)("change_alias_pattern"),js=(t,i)=>Vt.match(i)?i.payload:we.match(i)?t||"":t,$s=(t,i)=>Lt.match(i)?i.payload:we.match(i)?t||"":t;var ut=p(58064);const Nt=()=>({label:"",query:"*"}),W={terms:{label:"Terms",requiresField:!0,defaultSettings:{min_doc_count:"1",size:"10",order:"desc",orderBy:"_term"}},filters:{label:"Filters",requiresField:!1,defaultSettings:{filters:[Nt()]}},geohash_grid:{label:"Geo Hash Grid",requiresField:!0,defaultSettings:{precision:ve}},date_histogram:{label:"Date Histogram",requiresField:!0,defaultSettings:{interval:"auto",min_doc_count:"0",trimEdges:"0",timeZone:ut.g$.utc}},histogram:{label:"Histogram",requiresField:!0,defaultSettings:{interval:"1000",min_doc_count:"0"}},nested:{label:"Nested (experimental)",requiresField:!0,defaultSettings:{}}},ke=[{label:"Term value",value:"_term"},{label:"Doc Count",value:"_count"}],Me=[{label:"Top",value:"desc"},{label:"Bottom",value:"asc"}],Bt=(0,R.VP)("@bucketAggs/add"),Qt=(0,R.VP)("@bucketAggs/remove"),Wt=(0,R.VP)("@bucketAggs/change_type"),qt=(0,R.VP)("@bucketAggs/change_field"),H=(0,R.VP)("@bucketAggs/change_setting"),Ss=t=>(i,r)=>{if(Bt.match(r)){const n={id:r.payload,type:"terms",settings:W.terms.defaultSettings},o=i[i.length-1];return o?.type==="date_histogram"?[...i.slice(0,i.length-1),n,o]:[...i,n]}return Qt.match(r)?i.filter(n=>n.id!==r.payload):Wt.match(r)?i.map(n=>n.id!==r.payload.id?n:{id:n.id,type:r.payload.newType,settings:W[r.payload.newType].defaultSettings}):qt.match(r)?i.map(n=>n.id!==r.payload.id?n:{...n,field:r.payload.newField}):Ce.match(r)?Q[r.payload.type].impliedQueryType!=="metrics"?[]:i.length===0?[{...nt("2"),field:t}]:i:H.match(r)?i.map(n=>{if(n.id!==r.payload.bucketAgg.id)return n;const o=Le({...n.settings,[r.payload.settingName]:r.payload.newValue});return{...n,settings:{...o}}}):we.match(r)?i&&i.length>0?i:[{...nt("2"),field:t}]:i},Fs=(t,i)=>{if(Qe.match(i))return[...t,ge(i.payload)];if(We.match(i)){const r=t.find(u=>u.id===i.payload),n=[r,...Mt(r,t)],o=t.filter(u=>!n.some(f=>f.id===u.id));return o.length===0?[ge("1")]:o}return Ce.match(i)?t.filter(r=>Q[i.payload.type].impliedQueryType==="metrics"?!0:r.id===i.payload.id).map(r=>r.id!==i.payload.id?r:{id:r.id,type:i.payload.type,...Q[i.payload.type].defaults}):Ae.match(i)?t.map(r=>{if(r.id!==i.payload.id)return r;const n={...r,field:i.payload.field};return Se(r)?{...n,pipelineAgg:i.payload.field}:n}):qe.match(i)?t.map(r=>r.id!==i.payload?r:{...r,hide:!r.hide}):k.match(i)?t.map(r=>{if(r.id!==i.payload.metric.id)return r;if(ie(r)){const n=Le({...r.settings,[i.payload.settingName]:i.payload.newValue});return{...r,settings:{...n}}}return r}):Rt.match(i)?t.map(r=>r.id!==i.payload.metric.id?r:fe(r)?{...r,meta:{...r.meta,[i.payload.meta]:i.payload.newValue}}:r):ct.match(i)?t.map(r=>r.id!==i.payload.metric.id?r:{...r,[i.payload.attribute]:i.payload.newValue}):we.match(i)?t&&t.length>0?t:[ge("1")]:t},dt=(0,A.createContext)(void 0),kt=(0,A.createContext)(void 0),Te=(0,A.createContext)(void 0),ze=({children:t,onChange:i,onRunQuery:r,query:n,datasource:o,range:u})=>{const f=(0,A.useCallback)((L,O)=>{i(L),(L.query===O.query||O.query===void 0)&&r()},[i,r]),v=X({query:js,alias:$s,metrics:Fs,bucketAggs:Ss(o.timeField)}),$=ae(L=>f({...n,...L,timeField:o.timeField},n),n,v),h=!n.metrics||!n.bucketAggs||n.query===void 0,[x,D]=(0,A.useState)(h);return(0,A.useEffect)(()=>{x&&h&&($(we()),D(!1))},[x,$,h]),h?null:(0,e.jsx)(dt.Provider,{value:o,children:(0,e.jsx)(kt.Provider,{value:n,children:(0,e.jsx)(Te.Provider,{value:u,children:(0,e.jsx)(ye.Provider,{value:$,children:t})})})})},ft=t=>()=>{const i=(0,A.useContext)(t);if(!i)throw new Error("use ElasticsearchProvider first.");return i},pe=ft(kt),re=ft(dt),He=ft(Te),zt=t=>t.id,Is=t=>parseInt(t,10),As=()=>{const{metrics:t,bucketAggs:i}=pe();return(0,A.useMemo)(()=>(Math.max(...[...t?.map(zt)||["0"],...i?.map(zt)||["0"]].map(Is))+1).toString(),[t,i])};var be=p(54594),V=p(2543),Ue=p(77222),Ee=p(54394),gt=p(99764);const Ht=({children:t,label:i,onRemoveClick:r,onHideClick:n,hidden:o=!1})=>{const u=(0,q.of)(Ut);return(0,e.jsxs)(Ue.C,{children:[(0,e.jsx)(Ee.e,{children:(0,e.jsxs)(M.c,{width:17,as:"div",children:[(0,e.jsx)("span",{children:i}),(0,e.jsxs)("span",{className:u.iconWrapper,children:[n&&(0,e.jsx)(gt.K,{name:o?"eye-slash":"eye",onClick:n,size:"sm","aria-pressed":o,className:u.icon,tooltip:"Hide row"}),(0,e.jsx)(gt.K,{name:"trash-alt",size:"sm",className:u.icon,onClick:r||V.noop,disabled:!r,tooltip:"Remove row"})]})]})}),t]})},Ut=t=>({iconWrapper:(0,C.css)({display:"flex"}),icon:(0,C.css)({color:t.colors.text.secondary,marginLeft:t.spacing(.25)})});var Kt=p(67692),De=p(80762),le=p(75505);const Ke=t=>W[t.type].requiresField,Cs=["date_histogram","histogram","terms","filters","geohash_grid","nested"],Gt=t=>Cs.includes(t),ws=t=>{if(wt(t))switch(t){case"cardinality":return[];case"top_metrics":return["number"];default:return["number"]}if(Gt(t))switch(t){case"date_histogram":return["date"];case"geohash_grid":return["geo_point"];case"histogram":return["number"];default:return[]}return[]},Yt=({text:t})=>({label:t,value:t}),Ge=t=>{const i=re(),r=He(),n=Array.isArray(t)?t:ws(t);let o;return async u=>(o||(o=await(0,le.s)(i.getFields(n,r))),o.filter(({text:f})=>u===void 0||f.includes(u)).map(Yt))},je=(0,C.css)({minWidth:"150px"});var Zt=p(79784);const Jt=(t,i)=>({wrapper:(0,C.css)({maxWidth:"500px",display:"flex",flexDirection:"column"}),settingsWrapper:(0,C.css)({paddingTop:t.spacing(.5)}),icon:(0,C.css)({marginRight:t.spacing(.5)}),button:(0,C.css)({justifyContent:"start"},i&&{color:t.colors.text.disabled})}),a=({label:t,children:i,hidden:r=!1})=>{const[n,o]=(0,A.useState)(!1),u=(0,q.$j)(),f=Jt(u,r);return(0,e.jsx)(Ee.e,{children:(0,e.jsxs)("div",{className:(0,C.cx)(f.wrapper),children:[(0,e.jsxs)("button",{className:(0,C.cx)("gf-form-label query-part",f.button,je),onClick:()=>o(!n),"aria-expanded":n,type:"button",children:[(0,e.jsx)(Zt.I,{name:n?"angle-down":"angle-right","aria-hidden":"true",className:f.icon}),t]}),n&&(0,e.jsx)("div",{className:f.settingsWrapper,children:i})]})})};var I=p(44826),Ye=p(14749);const te=["1w","1M","1q","1y"];class pt{constructor(i){this.timeField=i.timeField}getRangeFilter(){return{[this.timeField]:{gte:"$timeFrom",lte:"$timeTo",format:"epoch_millis"}}}buildTermsAgg(i,r,n){if(r.terms={field:i.field},!i.settings)return r;const o=i.settings?.size?parseInt(i.settings.size,10):500;if(r.terms.size=o===0?500:o,i.settings.orderBy!==void 0){r.terms.order={},i.settings.orderBy==="_term"?r.terms.order._key=i.settings.order:r.terms.order[i.settings.orderBy]=i.settings.order;const u=lt(i.settings.orderBy);if(u){for(let f of n.metrics||[])if(f.id===u){f.type==="count"?r.terms.order={_count:i.settings.order}:de(f)&&(r.aggs={},r.aggs[f.id]={[f.type]:{field:f.field}});break}}}return i.settings.min_doc_count!==void 0&&(r.terms.min_doc_count=parseInt(i.settings.min_doc_count,10),isNaN(r.terms.min_doc_count)&&(r.terms.min_doc_count=i.settings.min_doc_count)),i.settings.missing&&(r.terms.missing=i.settings.missing),r}getDateHistogramAgg(i){const r={},n=i.settings||{};r.field=i.field||this.timeField,r.min_doc_count=n.min_doc_count||0,r.extended_bounds={min:"$timeFrom",max:"$timeTo"},r.format="epoch_millis",n.timeZone&&n.timeZone!==ut.g$.utc&&(r.time_zone=n.timeZone),n.offset!==""&&(r.offset=n.offset);const o=n.interval==="auto"?"${__interval_ms}ms":n.interval;return o!==void 0&&te.includes(o)?r.calendar_interval=o:r.fixed_interval=o,r}getHistogramAgg(i){return{interval:i.settings?.interval,field:i.field,min_doc_count:i.settings?.min_doc_count||0}}getFiltersAgg(i){const r={};for(let{query:n,label:o}of i.settings?.filters||[])r[o||n]={query_string:{query:n,analyze_wildcard:!0}};return r}documentQuery(i,r){return i.size=r,i.sort=[{[this.timeField]:{order:"desc",unmapped_type:"boolean"}},{_doc:{order:"desc"}}],i.script_fields={},i}build(i){i.metrics=i.metrics||[ge()],i.bucketAggs=i.bucketAggs||[nt()],i.timeField=this.timeField;let r,n,o,u,f;const v={size:0,query:{bool:{filter:[{range:this.getRangeFilter()}]}}};if(i.query&&i.query!==""&&(v.query.bool.filter=[...v.query.bool.filter,{query_string:{analyze_wildcard:!0,query:i.query}}]),i.bucketAggs.length===0&&(r=i.metrics[0],!r||!(r.type==="raw_document"||r.type==="raw_data")))throw{message:"Invalid query"};if(i.metrics?.[0]?.type==="raw_document"||i.metrics?.[0]?.type==="raw_data"){r=i.metrics[0];const $=r.settings?.size?parseInt(r.settings.size,10):500;return this.documentQuery(v,$||500)}for(f=v,n=0;n<i.bucketAggs.length;n++){const $=i.bucketAggs[n],h={};switch($.type){case"date_histogram":{h.date_histogram=this.getDateHistogramAgg($);break}case"histogram":{h.histogram=this.getHistogramAgg($);break}case"filters":{h.filters={filters:this.getFiltersAgg($)};break}case"terms":{this.buildTermsAgg($,h,i);break}case"geohash_grid":{h.geohash_grid={field:$.field,precision:$.settings?.precision||ve};break}case"nested":{h.nested={path:$.field};break}}f.aggs=f.aggs||{},f.aggs[$.id]=h,f=h}for(f.aggs={},n=0;n<i.metrics.length;n++){if(r=i.metrics[n],r.type==="count")continue;const $={};let h={};if(Se(r))if(Re(r))if(r.pipelineVariables){for(h={buckets_path:{}},o=0;o<r.pipelineVariables.length;o++)if(u=r.pipelineVariables[o],u.name&&u.pipelineAgg&&/^\d*$/.test(u.pipelineAgg)){const x=Ie(i.metrics,u.pipelineAgg);x&&(x.type==="count"?h.buckets_path[u.name]="_count":h.buckets_path[u.name]=u.pipelineAgg)}}else continue;else if(r.field&&/^\d*$/.test(r.field)){const x=Ie(i.metrics,r.field);x&&(x.type==="count"?h={buckets_path:"_count"}:h={buckets_path:r.field})}else continue;else de(r)&&(h={field:r.field});if(ie(r))switch(Object.entries(r.settings||{}).filter(([x,D])=>D!==null).forEach(([x,D])=>{h[x]=x==="script"?this.buildScript(Ne(r)):D}),r.type){case"moving_avg":h={...h,...h?.window!==void 0&&{window:this.toNumber(h.window)},...h?.predict!==void 0&&{predict:this.toNumber(h.predict)},...vs(r)&&{settings:{...h.settings,...Object.fromEntries(Object.entries(h.settings||{}).filter(([x])=>["alpha","beta","gamma","period"].includes(x)).filter(([x,D])=>D!==void 0).map(([x,D])=>[x,this.toNumber(D)]))}}};break;case"serial_diff":h={...h,...h.lag!==void 0&&{lag:this.toNumber(h.lag)}};break;case"top_metrics":h={metrics:r.settings?.metrics?.map(x=>({field:x})),size:1},r.settings?.orderBy&&(h.sort=[{[r.settings?.orderBy]:r.settings?.order}]);break}$[r.type]=h,f.aggs[r.id]=$}return v}buildScript(i){return i}toNumber(i){const r=parseFloat(`${i}`);return isNaN(r)?i:r}getTermsQuery(i){const r={size:0,query:{bool:{filter:[{range:this.getRangeFilter()}]}}};i.query&&r.query.bool.filter.push({query_string:{analyze_wildcard:!0,query:i.query}});let n=500;i.size&&(n=i.size),r.aggs={1:{terms:{field:i.field,size:n,order:{}}}};const{orderBy:o="key",order:u=o==="doc_count"?"desc":"asc"}=i;if(["asc","desc"].indexOf(u)<0)throw{message:`Invalid query sort order ${u}`};switch(o){case"key":case"term":const f="_key";r.aggs[1].terms.order[f]=u;break;case"doc_count":r.aggs[1].terms.order._count=u;break;default:throw{message:`Invalid query sort type ${o}`}}return r}getLogsQuery(i,r){let n={size:0,query:{bool:{filter:[{range:this.getRangeFilter()}]}}};return i.query&&n.query.bool.filter.push({query_string:{analyze_wildcard:!0,query:i.query}}),n=this.documentQuery(n,r),{...n,aggs:this.build(i).aggs,highlight:{fields:{"*":{}},pre_tags:[Et.pre],post_tags:[Et.post],fragment_size:2147483647}}}}const y=t=>({value:i})=>i===t,Ze=(t,i)=>i===void 0||t.some(y(i))?t:[...t,{value:i,label:i}],Gs=({options:t,value:i,onChange:r})=>{const[n,o]=(0,A.useState)(Ze(t,i)),u=f=>o([...n,{value:f,label:f}]);return{onCreateOption:f=>{u(f),r({value:f})},onChange:r,allowCustomValue:!0,options:n,value:i}},Je=[{label:"auto",value:"auto"},{label:"10s",value:"10s"},{label:"1m",value:"1m"},{label:"5m",value:"5m"},{label:"10m",value:"10m"},{label:"20m",value:"20m"},{label:"1h",value:"1h"},{label:"1d",value:"1d"},{label:"1w",value:"1w"},{label:"1M",value:"1M"},{label:"1q",value:"1q"},{label:"1y",value:"1y"}],Ys=t=>({value:i})=>i===t,Zs=(t,i,r)=>!r.some(Ys(t))&&t.trim().length>0,P=(t,i)=>t.value?.startsWith(i)||!1,Pe=t=>t&&te.includes(t)?"calendar":"fixed",Ms=({bucketAgg:t})=>{const i=B(),{current:r}=(0,A.useRef)((0,V.uniqueId)("es-date_histogram-")),n=(0,A.useCallback)(({value:u})=>i(H({bucketAgg:t,settingName:"interval",newValue:u})),[t,i]),o=Pe(t.settings?.interval||W.date_histogram.defaultSettings?.interval);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(b.I,{label:o==="calendar"?"Calendar interval":"Fixed interval",tooltip:o==="calendar"?"Calendar-aware intervals adapt to varying day lengths, month durations, and leap seconds, considering the calendar context.":"Fixed intervals remain constant, always being multiples of SI units, independent of calendar changes.",...Y,children:(0,e.jsx)(I.l6,{inputId:(0,V.uniqueId)("es-date_histogram-interval"),isValidNewOption:Zs,filterOption:P,...Gs({options:Je,value:t.settings?.interval||W.date_histogram.defaultSettings?.interval,onChange:n})})}),(0,e.jsx)(b.I,{label:"Min Doc Count",...Y,children:(0,e.jsx)(F.p,{id:`${r}-min_doc_count`,onBlur:u=>i(H({bucketAgg:t,settingName:"min_doc_count",newValue:u.target.value})),defaultValue:t.settings?.min_doc_count||W.date_histogram.defaultSettings?.min_doc_count})}),(0,e.jsx)(b.I,{label:"Trim Edges",...Y,tooltip:"Trim the edges on the timeseries datapoints",children:(0,e.jsx)(F.p,{id:`${r}-trime_edges`,onBlur:u=>i(H({bucketAgg:t,settingName:"trimEdges",newValue:u.target.value})),defaultValue:t.settings?.trimEdges||W.date_histogram.defaultSettings?.trimEdges})}),(0,e.jsx)(b.I,{label:"Offset",...Y,tooltip:"Change the start value of each bucket by the specified positive (+) or negative offset (-) duration, such as 1h for an hour, or 1d for a day",children:(0,e.jsx)(F.p,{id:`${r}-offset`,onBlur:u=>i(H({bucketAgg:t,settingName:"offset",newValue:u.target.value})),defaultValue:t.settings?.offset||W.date_histogram.defaultSettings?.offset})}),(0,e.jsx)(b.I,{label:"Timezone",...Y,children:(0,e.jsx)(Ye.U,{value:t.settings?.timeZone||W.date_histogram.defaultSettings?.timeZone,includeInternal:[ut.g$.utc],onChange:u=>{i(H({bucketAgg:t,settingName:"timeZone",newValue:u}))}})})]})},Xt=({index:t,onAdd:i,onRemove:r,elements:n})=>(0,e.jsxs)("div",{className:(0,C.css)({display:"flex"}),children:[t===0&&(0,e.jsx)(be.$n,{variant:"secondary",fill:"text",icon:"plus",onClick:i,tooltip:"Add","aria-label":"Add"}),n.length>=2&&(0,e.jsx)(be.$n,{variant:"secondary",fill:"text",icon:"minus",onClick:r,tooltip:"Remove","aria-label":"Remove"})]}),Xe=(0,R.VP)("@bucketAggregations/filter/add"),ht=(0,R.VP)("@bucketAggregations/filter/remove"),he=(0,R.VP)("@bucketAggregations/filter/change"),j=(t=[],i)=>Xe.match(i)?[...t,Nt()]:ht.match(i)?t.slice(0,i.payload).concat(t.slice(i.payload+1)):he.match(i)?t.map((r,n)=>n!==i.payload.index?r:i.payload.filter):t,Ts=({bucketAgg:t})=>{const{current:i}=(0,A.useRef)((0,V.uniqueId)("es-filters-")),r=B(),n=ae(o=>r(H({bucketAgg:t,settingName:"filters",newValue:o})),t.settings?.filters,j);return(0,A.useEffect)(()=>{t.settings?.filters?.length||n(Xe())},[n,t.settings?.filters?.length]),(0,e.jsx)(e.Fragment,{children:(0,e.jsx)("div",{className:(0,C.css)({display:"flex",flexDirection:"column"}),children:t.settings?.filters.map((o,u)=>(0,e.jsxs)("div",{className:(0,C.css)({display:"flex"}),children:[(0,e.jsx)(b.I,{label:"Query",labelWidth:8,children:(0,e.jsx)("div",{className:(0,C.css)({width:"150px"}),children:(0,e.jsx)(J.X,{placeholder:"Lucene Query",portalOrigin:"elasticsearch",onChange:f=>n(he({index:u,filter:{...o,query:f}})),query:o.query})})}),(0,e.jsx)(b.I,{label:"Label",labelWidth:8,children:(0,e.jsx)(F.p,{width:16,id:`${i}-label-${u}`,placeholder:"Label",onBlur:f=>n(he({index:u,filter:{...o,label:f.target.value}})),defaultValue:o.label})}),(0,e.jsx)(Xt,{index:u,elements:t.settings?.filters||[],onAdd:()=>n(Xe()),onRemove:()=>n(ht(u))})]},u))})})},es=({bucketAgg:t})=>{const{metrics:i}=pe(),r=is(i),{current:n}=(0,A.useRef)((0,V.uniqueId)("es-terms-"));let o=t.settings?.size||W.terms.defaultSettings?.size;!o||o===""?o="10":o==="0"&&(o="500");const u=B();return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(b.I,{label:"Order",...Y,children:(0,e.jsx)(I.l6,{inputId:`${n}-order`,onChange:f=>u(H({bucketAgg:t,settingName:"order",newValue:f.value})),options:Me,value:t.settings?.order||W.terms.defaultSettings?.order})}),(0,e.jsx)(b.I,{label:"Size",...Y,children:(0,e.jsx)(F.p,{id:`${n}-size`,onBlur:f=>u(H({bucketAgg:t,settingName:"size",newValue:f.target.value})),defaultValue:o})}),(0,e.jsx)(b.I,{label:"Min Doc Count",...Y,children:(0,e.jsx)(F.p,{id:`${n}-min_doc_count`,onBlur:f=>u(H({bucketAgg:t,settingName:"min_doc_count",newValue:f.target.value})),defaultValue:t.settings?.min_doc_count||W.terms.defaultSettings?.min_doc_count})}),(0,e.jsx)(b.I,{label:"Order By",...Y,children:(0,e.jsx)(I.l6,{inputId:`${n}-order_by`,onChange:f=>u(H({bucketAgg:t,settingName:"orderBy",newValue:f.value})),options:r,value:t.settings?.orderBy||W.terms.defaultSettings?.orderBy})}),(0,e.jsx)(b.I,{label:"Missing",...Y,children:(0,e.jsx)(F.p,{id:`${n}-missing`,onBlur:f=>u(H({bucketAgg:t,settingName:"missing",newValue:f.target.value})),defaultValue:t.settings?.missing||W.terms.defaultSettings?.missing})})]})};function ts(t){return t.meta?Object.keys(t.meta).filter(r=>t.meta?.[r]).map(r=>{let n=r;return r==="std_deviation_bounds_lower"&&(n="std_lower"),r==="std_deviation_bounds_upper"&&(n="std_upper"),{label:`${xe(t)} (${n})`,value:`${t.id}[${n}]`}}):[]}function ne(t){return t.settings?.percents?t.settings.percents.map(i=>{const r=/^\d+\.\d+/.test(`${i}`)?i:`${i}.0`;return{label:`${xe(t)} (${i})`,value:`${t.id}[${r}]`}}):[]}function ss(t){return t.type!=="top_metrics"&&!Se(t)}const is=(t=[])=>{const i=t.filter(ss).flatMap(r=>r.type==="extended_stats"?ts(r):r.type==="percentiles"?ne(r):{label:xe(r),value:r.id});return[...ke,...i]},rs=t=>i=>i.value===t,mt=t=>{const{metrics:i}=pe();switch(t.type){case"terms":{const r=t.settings?.order||"desc",n=t.settings?.size||"10",o=parseInt(t.settings?.min_doc_count||"0",10),u=t.settings?.orderBy||"_term";let f="";n!=="0"&&(f=`${Me.find(rs(r))?.label} ${n}, `),o>0&&(f+=`Min Doc Count: ${o}, `),f+="Order by: ";const v=ke.find(rs(u));if(v)f+=v.label;else{const $=i?.find(h=>h.id===lt(u));$?f+=xe($):f+="metric not found"}return n==="0"&&(f+=` (${r})`),f}case"histogram":{const r=t.settings?.interval||"1000",n=parseInt(t.settings?.min_doc_count||"1",10);return`Interval: ${r}${n>0?`, Min Doc Count: ${n}`:""}`}case"filters":return`Filter Queries (${(t.settings?.filters||W.filters.defaultSettings?.filters).length})`;case"geohash_grid":return`Precision: ${parseInt(t.settings?.precision||ve,10)}`;case"date_histogram":{const r=t.settings?.interval||"auto",n=parseInt(t.settings?.min_doc_count||"0",10),o=parseInt(t.settings?.trimEdges||"0",10);let u=`Interval: ${r}`;return n>0&&(u+=`, Min Doc Count: ${n}`),o>0&&(u+=`, Trim edges: ${o}`),u}default:return"Settings"}},Y={labelWidth:18},ns=({bucketAgg:t})=>{const{current:i}=(0,A.useRef)((0,V.uniqueId)("es-setting-")),r=B(),n=mt(t);return(0,e.jsxs)(a,{label:n,children:[t.type==="terms"&&(0,e.jsx)(es,{bucketAgg:t}),t.type==="date_histogram"&&(0,e.jsx)(Ms,{bucketAgg:t}),t.type==="filters"&&(0,e.jsx)(Ts,{bucketAgg:t}),t.type==="geohash_grid"&&(0,e.jsx)(b.I,{label:"Precision",...Y,children:(0,e.jsx)(F.p,{id:`${i}-geohash_grid-precision`,onBlur:o=>r(H({bucketAgg:t,settingName:"precision",newValue:o.target.value})),defaultValue:t.settings?.precision||W[t.type].defaultSettings?.precision})}),t.type==="histogram"&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(b.I,{label:"Interval",...Y,children:(0,e.jsx)(F.p,{id:`${i}-histogram-interval`,onBlur:o=>r(H({bucketAgg:t,settingName:"interval",newValue:o.target.value})),defaultValue:t.settings?.interval||W[t.type].defaultSettings?.interval})}),(0,e.jsx)(b.I,{label:"Min Doc Count",...Y,children:(0,e.jsx)(F.p,{id:`${i}-histogram-min_doc_count`,onBlur:o=>r(H({bucketAgg:t,settingName:"min_doc_count",newValue:o.target.value})),defaultValue:t.settings?.min_doc_count||W[t.type].defaultSettings?.min_doc_count})})]})]})},oe=Object.entries(W).map(([t,{label:i}])=>({label:i,value:t})),as=t=>({label:W[t.type].label,value:t.type}),ls=({value:t})=>{const i=B(),r=Ge(t.type);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(Ee.e,{children:[(0,e.jsx)(Kt.Y,{className:je,options:oe,onChange:n=>i(Wt({id:t.id,newType:n.value})),value:as(t)}),Ke(t)&&(0,e.jsx)(De.s,{className:je,loadOptions:r,onChange:n=>i(qt({id:t.id,newField:n.value})),placeholder:"Select Field",value:t.field})]}),(0,e.jsx)(ns,{bucketAgg:t})]})},Es=({nextId:t})=>{const i=B(),{bucketAggs:r}=pe(),n=r?.length||0;return(0,e.jsx)(e.Fragment,{children:r.map((o,u)=>(0,e.jsxs)(Ht,{label:u===0?"Group By":"Then By",onRemoveClick:n>1&&(()=>i(Qt(o.id))),children:[(0,e.jsx)(ls,{value:o}),u===0&&(0,e.jsx)(be.$n,{variant:"secondary",fill:"text",icon:"plus",onClick:()=>i(Bt(t)),tooltip:"Add grouping condition","aria-label":"Add grouping condition"})]},`${o.type}-${o.id}`))})};var _e=p(29010);const os=(0,C.css)({whiteSpace:"nowrap"}),yt=t=>({label:xe(t),value:t}),et=t=>t.map(yt),cs=({options:t,onChange:i,className:r,value:n})=>{const o=t.find(u=>u.id===n);return(0,e.jsx)(Kt.Y,{className:(0,C.cx)(r,os),options:et(t),onChange:i,placeholder:"Select Metric",value:o?yt(o):void 0})};function U({label:t,settingName:i,metric:r,placeholder:n,tooltip:o}){const u=B(),[f]=(0,A.useState)((0,V.uniqueId)("es-field-id-"));let $=r.settings?.[i]||"";return i==="script"&&($=Ne(r)),(0,e.jsx)(b.I,{label:t,labelWidth:16,tooltip:o,children:(0,e.jsx)(F.p,{id:f,placeholder:n,onBlur:h=>u(k({metric:r,settingName:i,newValue:h.target.value})),defaultValue:$})})}const vt=(0,R.VP)("@pipelineVariables/add"),us=(0,R.VP)("@pipelineVariables/remove"),xt=(0,R.VP)("@pipelineVariables/rename"),bt=(0,R.VP)("@pipelineVariables/change_metric"),Ds=(t=[],i)=>vt.match(i)?[...t,ue(It(t))]:us.match(i)?t.slice(0,i.payload).concat(t.slice(i.payload+1)):xt.match(i)?t.map((r,n)=>n!==i.payload.index?r:{...r,name:i.payload.newName}):bt.match(i)?t.map((r,n)=>n!==i.payload.index?r:{...r,pipelineAgg:i.payload.newMetric}):t,me=({value:t,previousMetrics:i})=>{const r=B(),n=ae(o=>r(ct({metric:t,attribute:"pipelineVariables",newValue:o})),t.pipelineVariables,Ds);return(0,A.useEffect)(()=>{t.pipelineVariables?.length||n(vt())},[n,t.pipelineVariables?.length]),(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("div",{className:(0,C.css)({display:"flex"}),children:[(0,e.jsx)(M.c,{width:16,children:"Variables"}),(0,e.jsx)("div",{className:(0,C.css)({display:"grid",gridTemplateColumns:"1fr auto",rowGap:"4px",marginBottom:"4px"}),children:t.pipelineVariables.map((o,u)=>(0,e.jsxs)(A.Fragment,{children:[(0,e.jsxs)("div",{className:(0,C.css)({display:"grid",columnGap:"4px",gridTemplateColumns:"auto auto"}),children:[(0,e.jsx)(F.p,{"aria-label":"Variable name",defaultValue:o.name,placeholder:"Variable Name",onBlur:f=>n(xt({newName:f.target.value,index:u}))}),(0,e.jsx)(cs,{onChange:f=>n(bt({newMetric:f.value.id,index:u})),options:i,value:o.pipelineAgg})]}),(0,e.jsx)(Xt,{index:u,elements:t.pipelineVariables||[],onAdd:()=>n(vt()),onRemove:()=>n(us(u))})]},(0,V.uniqueId)("es-bs-")))})]}),(0,e.jsx)(U,{label:"Script",metric:t,settingName:"script",tooltip:"Elasticsearch v5.0 and above: Scripting language is Painless. Use params.<var> to reference a variable. Elasticsearch pre-v5.0: Scripting language is per default Groovy if not changed. For Groovy use <var> to reference a variable.",placeholder:"params.var1 / params.var2"})]})},ds=({metric:t})=>{const i=B(),{current:r}=(0,A.useRef)((0,V.uniqueId)("es-moving-avg-"));return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(b.I,{label:"Model",labelWidth:16,children:(0,e.jsx)(I.l6,{inputId:`${r}-model`,onChange:n=>i(k({metric:t,settingName:"model",newValue:n.value})),options:bs,value:t.settings?.model})}),(0,e.jsx)(U,{label:"Window",settingName:"window",metric:t,placeholder:"5"}),(0,e.jsx)(U,{label:"Predict",settingName:"predict",metric:t}),(At(t)||rt(t)||Oe(t))&&(0,e.jsx)(b.I,{label:"Alpha",labelWidth:16,children:(0,e.jsx)(F.p,{id:`${r}-alpha`,onBlur:n=>i(k({metric:t,settingName:"settings",newValue:{...t.settings?.settings,alpha:n.target.value}})),defaultValue:t.settings?.settings?.alpha})}),(rt(t)||Oe(t))&&(0,e.jsx)(b.I,{label:"Beta",labelWidth:16,children:(0,e.jsx)(F.p,{id:`${r}-beta`,onBlur:n=>i(k({metric:t,settingName:"settings",newValue:{...t.settings?.settings,beta:n.target.value}})),defaultValue:t.settings?.settings?.beta})}),Oe(t)&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(b.I,{label:"Gamma",labelWidth:16,children:(0,e.jsx)(F.p,{id:`${r}-gamma`,onBlur:n=>i(k({metric:t,settingName:"settings",newValue:{...t.settings?.settings,gamma:n.target.value}})),defaultValue:t.settings?.settings?.gamma})}),(0,e.jsx)(b.I,{label:"Period",labelWidth:16,children:(0,e.jsx)(F.p,{id:`${r}-period`,onBlur:n=>i(k({metric:t,settingName:"settings",newValue:{...t.settings?.settings,period:n.target.value}})),defaultValue:t.settings?.settings?.period})}),(0,e.jsx)(b.I,{label:"Pad",labelWidth:16,children:(0,e.jsx)(_e.K,{id:`${r}-pad`,onChange:n=>i(k({metric:t,settingName:"settings",newValue:{...t.settings?.settings,pad:n.target.checked}})),checked:!!t.settings?.settings?.pad})})]}),(At(t)||rt(t)||Oe(t))&&(0,e.jsx)(b.I,{label:"Minimize",labelWidth:16,children:(0,e.jsx)(_e.K,{id:`${r}-minimize`,onChange:n=>i(k({metric:t,settingName:"minimize",newValue:n.target.checked})),checked:!!t.settings?.minimize})})]})},jt=t=>({value:t,label:t}),Ps=({metric:t})=>{const i=B(),r=Ge(["number","date"]),n=Ge(t.type);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(b.I,{label:"Metrics",labelWidth:16,children:(0,e.jsx)(I.Iv,{onChange:o=>i(k({metric:t,settingName:"metrics",newValue:o.map(u=>u.value)})),loadOptions:n,value:t.settings?.metrics?.map(jt),closeMenuOnSelect:!1,defaultOptions:!0})}),(0,e.jsx)(b.I,{label:"Order",labelWidth:16,children:(0,e.jsx)(I.l6,{onChange:o=>i(k({metric:t,settingName:"order",newValue:o.value})),options:Me,value:t.settings?.order})}),(0,e.jsx)(b.I,{label:"Order By",labelWidth:16,className:(0,C.css)({"& > div":{width:"100%"}}),children:(0,e.jsx)(De.s,{className:(0,C.css)({marginRight:0}),loadOptions:r,onChange:o=>i(k({metric:t,settingName:"orderBy",newValue:o.value})),placeholder:"Select Field",value:t.settings?.orderBy})})]})},T=t=>i=>i.value===t,$t=t=>{switch(t.type){case"cardinality":return`Precision threshold: ${t.settings?.precision_threshold||""}`;case"percentiles":return t.settings?.percents&&t.settings?.percents?.length>=1?`Values: ${t.settings?.percents}`:"Percents: Default";case"extended_stats":{const i=Object.entries(t.meta||{}).map(([r,n])=>n&&Tt.find(T(r))?.label).filter(Boolean);return`Stats: ${i.length>0?i.join(", "):"None selected"}`}case"raw_document":case"raw_data":return`Size: ${t.settings?.size||500}`;default:return"Options"}},s={labelWidth:16},l=({metric:t,previousMetrics:i})=>{const{current:r}=(0,A.useRef)((0,V.uniqueId)("es-setting-")),n=B(),o=$t(t),u=(0,A.useId)(),f=(0,A.useId)(),v=(0,A.useId)(),$=[{value:"second",label:"Second"},{value:"minute",label:"Minute"},{value:"hour",label:"Hour"},{value:"day",label:"Day"},{value:"week",label:"Week"},{value:"month",label:"Month"},{value:"quarter",label:"Quarter"},{value:"Year",label:"Year"}],h=[{value:"sum",label:"Sum"},{value:"value_count",label:"Value count"}];return(0,e.jsxs)(a,{label:o,hidden:t.hide,children:[t.type==="derivative"&&(0,e.jsx)(U,{label:"Unit",metric:t,settingName:"unit"}),t.type==="serial_diff"&&(0,e.jsx)(U,{label:"Lag",metric:t,settingName:"lag",placeholder:"1"}),t.type==="cumulative_sum"&&(0,e.jsx)(U,{label:"Format",metric:t,settingName:"format"}),t.type==="moving_avg"&&(0,e.jsx)(ds,{metric:t}),t.type==="moving_fn"&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(U,{label:"Window",metric:t,settingName:"window"}),(0,e.jsx)(U,{label:"Script",metric:t,settingName:"script"}),(0,e.jsx)(U,{label:"Shift",metric:t,settingName:"shift"})]}),t.type==="top_metrics"&&(0,e.jsx)(Ps,{metric:t}),t.type==="bucket_script"&&(0,e.jsx)(me,{value:t,previousMetrics:i}),(t.type==="raw_data"||t.type==="raw_document")&&(0,e.jsx)(b.I,{label:"Size",...s,htmlFor:u,children:(0,e.jsx)(F.p,{id:u,onBlur:x=>n(k({metric:t,settingName:"size",newValue:x.target.value})),defaultValue:t.settings?.size??Q.raw_data.defaults.settings?.size})}),t.type==="logs"&&(0,e.jsx)(U,{label:"Limit",metric:t,settingName:"limit",placeholder:"500"}),t.type==="cardinality"&&(0,e.jsx)(U,{label:"Precision Threshold",metric:t,settingName:"precision_threshold"}),t.type==="extended_stats"&&(0,e.jsxs)(e.Fragment,{children:[Tt.map(x=>(0,e.jsx)(c,{stat:x,onChange:D=>n(Rt({metric:t,meta:x.value,newValue:D})),value:t.meta?.[x.value]!==void 0?!!t.meta?.[x.value]:!!Q.extended_stats.defaults.meta?.[x.value]},x.value)),(0,e.jsx)(U,{label:"Sigma",metric:t,settingName:"sigma",placeholder:"3"})]}),t.type==="percentiles"&&(0,e.jsx)(b.I,{label:"Percentiles",...s,children:(0,e.jsx)(F.p,{id:`${r}-percentiles-percents`,onBlur:x=>n(k({metric:t,settingName:"percents",newValue:x.target.value.split(",").filter(Boolean)})),defaultValue:t.settings?.percents||Q.percentiles.defaults.settings?.percents,placeholder:"1,5,25,50,75,95,99"})}),t.type==="rate"&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(b.I,{label:"Unit",...s,"data-testid":"unit-select",htmlFor:f,children:(0,e.jsx)(I.l6,{id:f,onChange:x=>n(k({metric:t,settingName:"unit",newValue:x.value})),options:$,value:t.settings?.unit})}),(0,e.jsx)(b.I,{label:"Mode",...s,"data-testid":"mode-select",htmlFor:v,children:(0,e.jsx)(I.l6,{id:v,onChange:x=>n(k({metric:t,settingName:"mode",newValue:x.value})),options:h,value:t.settings?.unit})})]}),Fe(t)&&(0,e.jsx)(U,{label:"Script",metric:t,settingName:"script",placeholder:"_value * 1"}),xs(t)&&(0,e.jsx)(U,{label:"Missing",metric:t,settingName:"missing",tooltip:`The missing parameter defines how documents that are missing a value should be treated. By default
            they will be ignored but it is also possible to treat them as if they had a value`})]})},c=({stat:t,onChange:i,value:r})=>{const[n]=(0,A.useState)((0,V.uniqueId)("es-field-id-"));return(0,A.createElement)(b.I,{label:t.label,...s,key:t.value},(0,e.jsx)(_e.K,{id:n,onChange:o=>i(o.target.checked),value:r}))},g=({name:t,metric:i})=>{const r=[];return(0,e.jsxs)(Ue.C,{children:[(0,e.jsx)(Ee.e,{children:(0,e.jsx)(M.c,{width:17,as:"div",children:(0,e.jsx)("span",{children:t})})}),(0,e.jsx)(l,{metric:i,previousMetrics:r})]})},m=(t,i)=>({color:i&&(0,C.css)({"&, &:hover, label, a":{color:i?t.colors.text.disabled:t.colors.text.primary}})}),E=t=>({label:Q[t.type].label,value:t.type}),w=t=>!Q[t.type].isPipelineAgg,ee=(t,i)=>{const r=t.some(w);return Object.entries(Q).filter(([n,o])=>o.impliedQueryType==="metrics").filter(([n,{versionRange:o="*"}])=>i!=null?(0,Ve.satisfies)(i,o):!0).filter(([n,o])=>r||!o.isPipelineAgg).map(([n,{label:o}])=>({label:o,value:n}))},gi=({value:t})=>{const i=m((0,q.$j)(),!!t.hide),r=re(),n=pe(),o=B(),u=Ge(t.type),f=async h=>{const x=await r.getDatabaseVersion();return ee(h,x)},v=(0,A.useCallback)(async()=>{const h=await u();return Fe(t)?[{label:"None"},...h]:h},[u,t]),$=n.metrics.slice(0,n.metrics.findIndex(h=>h.id===t.id));return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(Ee.e,{children:[(0,e.jsx)(De.s,{className:(0,C.cx)(i.color,je),loadOptions:()=>f($),onChange:h=>o(Ce({id:t.id,type:h.value})),value:E(t)}),de(t)&&!Se(t)&&(0,e.jsx)(De.s,{className:(0,C.cx)(i.color,je),loadOptions:v,onChange:h=>o(Ae({id:t.id,field:h.value})),placeholder:"Select Field",value:t.field}),Se(t)&&!Re(t)&&(0,e.jsx)(cs,{className:(0,C.cx)(i.color,je),onChange:h=>o(Ae({id:t.id,field:h.value?.id})),options:$,value:t.field})]}),ie(t)&&(0,e.jsx)(l,{metric:t,previousMetrics:$})]})},pi=({nextId:t})=>{const i=B(),{metrics:r}=pe(),n=r?.length||0;return(0,e.jsx)(e.Fragment,{children:r?.map((o,u)=>{switch(o.type){case"logs":return(0,e.jsx)(g,{name:"Logs",metric:o},`${o.type}-${o.id}`);case"raw_data":return(0,e.jsx)(g,{name:"Raw Data",metric:o},`${o.type}-${o.id}`);case"raw_document":return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(g,{name:"Raw Document",metric:o},`${o.type}-${o.id}`),(0,e.jsx)(K.F,{severity:"warning",title:"The 'Raw Document' query type is deprecated."})]});default:return(0,e.jsxs)(Ht,{label:`Metric (${o.id})`,hidden:o.hide,onHideClick:()=>i(qe(o.id)),onRemoveClick:n>1&&(()=>i(We(o.id))),children:[(0,e.jsx)(gi,{value:o}),Q[o.type].impliedQueryType==="metrics"&&u===0&&(0,e.jsx)(be.$n,{variant:"secondary",fill:"text",icon:"plus",onClick:()=>i(Qe(t)),tooltip:"Add metric","aria-label":"Add metric"})]},`${o.type}-${o.id}`)}})})};var hi=p(60641);const mi=[{value:"metrics",label:"Metrics"},{value:"logs",label:"Logs"},{value:"raw_data",label:"Raw Data"},{value:"raw_document",label:"Raw Document"}];function yi(t){switch(t){case"logs":case"raw_data":case"raw_document":return t;case"metrics":return"count";default:throw new Error(`invalid query type: ${t}`)}}const vi=()=>{const t=pe(),i=B(),r=t.metrics?.[0];if(r==null)return null;const n=Q[r.type].impliedQueryType,o=u=>{i(Ce({id:r.id,type:yi(u)}))};return(0,e.jsx)(hi.z,{fullWidth:!1,options:mi,value:n,onChange:o})};function xi(t){const[i,r]=(0,A.useState)(null);return(0,A.useEffect)(()=>{let n=!1;return t.getDatabaseVersion().then(o=>{n||r(o)},o=>{console.log(o)}),()=>{n=!0}},[t]),i}const bi=({query:t,onChange:i,onRunQuery:r,datasource:n,range:o})=>{const u=xi(n),f=u!=null&&!Pt(u);return(0,e.jsxs)(ze,{datasource:n,onChange:i,onRunQuery:r,query:t,range:o||(0,z.E2)(),children:[f&&(0,e.jsx)(K.F,{title:_t}),(0,e.jsx)(ji,{value:t})]})},Js=t=>({root:(0,C.css)({display:"flex"}),queryItem:(0,C.css)({flexGrow:1,margin:t.spacing(0,.5,.5,0)})}),Xs=({value:t,onChange:i})=>{const r=(0,q.of)(Js);return(0,e.jsx)("div",{className:r.queryItem,children:(0,e.jsx)(J.X,{query:t,onChange:i,placeholder:"Enter a lucene query",portalOrigin:"elasticsearch"})})},ji=({value:t})=>{const i=B(),r=As(),n=(0,A.useId)(),o=(0,q.of)(Js),u=Be(t),f=t.metrics?.every(v=>Q[v.type].impliedQueryType==="metrics");return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("div",{className:o.root,children:[(0,e.jsx)(M.c,{width:17,children:"Query type"}),(0,e.jsx)("div",{className:o.queryItem,children:(0,e.jsx)(vi,{})})]}),(0,e.jsxs)("div",{className:o.root,children:[(0,e.jsx)(M.c,{width:17,children:"Lucene Query"}),(0,e.jsx)(Xs,{onChange:v=>i(Vt(v)),value:t?.query}),u&&(0,e.jsx)(b.I,{label:"Alias",labelWidth:15,tooltip:"Aliasing only works for timeseries queries (when the last group is 'Date Histogram'). For all other query types this field is ignored.",htmlFor:n,children:(0,e.jsx)(F.p,{id:n,placeholder:"Alias Pattern",onBlur:v=>i(Lt(v.currentTarget.value)),defaultValue:t.alias})})]}),(0,e.jsx)(pi,{nextId:r}),f&&(0,e.jsx)(Es,{nextId:r})]})};var $i=p(65074),Si=p(76229),Fi=p(50532),Ii=p(14141),Ai=p(5518),_s=p(70985),Ci=p(6370),wi=p(80486),tt=p(32370),Os=p(76080),ei=p(48583),Mi=p(75863),Ti=p(46399),Ei=p(47180),Rs=p(85480),Vs=p(44575),Di=p(84596),Pi=p(30912),_i=p(76174);const Oi=t=>{const{value:i,onChange:r,onDelete:n,suggestions:o,className:u}=t,f=(0,q.of)(Vi),[v,$]=Ri(i.datasourceUid),h=x=>D=>{r({...i,[x]:D.currentTarget.value})};return(0,e.jsxs)("div",{className:u,children:[(0,e.jsxs)("div",{className:f.firstRow,children:[(0,e.jsx)(b.I,{label:"Field",htmlFor:"elasticsearch-datasource-config-field",labelWidth:12,tooltip:"Can be exact field name or a regex pattern that will match on the field name.",children:(0,e.jsx)(F.p,{type:"text",id:"elasticsearch-datasource-config-field",value:i.field,onChange:h("field"),width:100})}),(0,e.jsx)(be.$n,{variant:"destructive",title:"Remove field",icon:"times",onClick:x=>{x.preventDefault(),n()}})]}),(0,e.jsxs)(Ue.C,{children:[(0,e.jsxs)("div",{className:f.urlField,children:[(0,e.jsx)(M.c,{htmlFor:"elasticsearch-datasource-internal-link",width:12,children:v?"Query":"URL"}),(0,e.jsx)(_i.l,{placeholder:v?"${__value.raw}":"http://example.com/${__value.raw}",value:i.url||"",onChange:x=>r({...i,url:x}),suggestions:o})]}),(0,e.jsx)("div",{className:f.urlDisplayLabelField,children:(0,e.jsx)(b.I,{label:"URL Label",htmlFor:"elasticsearch-datasource-url-label",labelWidth:14,tooltip:"Use to override the button label.",children:(0,e.jsx)(F.p,{type:"text",id:"elasticsearch-datasource-url-label",value:i.urlDisplayLabel,onChange:h("urlDisplayLabel")})})})]}),(0,e.jsxs)("div",{className:f.row,children:[(0,e.jsx)(b.I,{label:"Internal link",labelWidth:12,children:(0,e.jsx)(_e.K,{label:"Internal link",value:v||!1,onChange:()=>{v&&r({...i,datasourceUid:void 0}),$(!v)}})}),v&&(0,e.jsx)(Pi.s,{tracing:!0,onChange:x=>{r({...i,datasourceUid:x.uid})},current:i.datasourceUid})]})]})};function Ri(t){const[i,r]=(0,A.useState)(!!t),n=(0,Di.A)(t);return(0,A.useEffect)(()=>{!n&&t&&!i&&r(!0),n&&!t&&i&&r(!1)},[n,t,i]),[i,r]}const Vi=()=>({firstRow:(0,C.css)({display:"flex"}),nameField:(0,C.css)({flex:2}),regexField:(0,C.css)({flex:3}),row:(0,C.css)({display:"flex",alignItems:"baseline"}),urlField:(0,C.css)({display:"flex",flex:1}),urlDisplayLabelField:(0,C.css)({flex:1})}),Li=t=>({addButton:(0,C.css)({marginRight:"10px"}),container:(0,C.css)({marginBottom:t.spacing(2)}),dataLink:(0,C.css)({marginBottom:t.spacing(1)})}),Ni=t=>{const{value:i,onChange:r}=t,n=(0,q.of)(Li);return(0,e.jsx)(Rs.I,{title:"Data links",description:(0,e.jsx)(Vs.H,{description:"Add links to existing fields. Links will be shown in log row details next to the field value.",suffix:"elasticsearch/#data-links",feature:"Elasticsearch data links"}),children:(0,e.jsxs)("div",{className:n.container,children:[i&&i.length>0&&(0,e.jsx)("div",{className:"gf-form-group",children:i.map((o,u)=>(0,e.jsx)(Oi,{className:n.dataLink,value:o,onChange:f=>{const v=[...i];v.splice(u,1,f),r(v)},onDelete:()=>{const f=[...i];f.splice(u,1),r(f)},suggestions:[{value:Ti.c.valueRaw,label:"Raw value",documentation:"Raw value of the field",origin:Ei.$0.Value}]},u))}),(0,e.jsx)(be.$n,{type:"button",variant:"secondary",className:n.addButton,icon:"plus",onClick:o=>{o.preventDefault();const u=[...i||[],{field:"",url:""}];r(u)},children:"Add"})]})})},Ls=[{label:"No pattern",value:"none"},{label:"Hourly",value:"Hourly",example:"[logstash-]YYYY.MM.DD.HH"},{label:"Daily",value:"Daily",example:"[logstash-]YYYY.MM.DD"},{label:"Weekly",value:"Weekly",example:"[logstash-]GGGG.WW"},{label:"Monthly",value:"Monthly",example:"[logstash-]YYYY.MM"},{label:"Yearly",value:"Yearly",example:"[logstash-]YYYY"}],Bi=({value:t,onChange:i})=>(0,e.jsxs)(Rs.I,{title:"Elasticsearch details",description:(0,e.jsx)(Vs.H,{description:"Specific settings for the Elasticsearch data source.",suffix:"elasticsearch/#index-settings",feature:"Elasticsearch details"}),children:[(0,e.jsx)(b.I,{label:"Index name",htmlFor:"es_config_indexName",labelWidth:29,tooltip:"Name of your Elasticsearch index. You can use a time pattern, such as YYYY.MM.DD, or a wildcard for the index name.",children:(0,e.jsx)(F.p,{id:"es_config_indexName",value:t.jsonData.index??(t.database||""),onChange:Qi(t,i),width:24,placeholder:"es-index-name",required:!0})}),(0,e.jsx)(b.I,{label:"Pattern",htmlFor:"es_config_indexPattern",labelWidth:29,tooltip:"If you're using a pattern for your index, select the type, or no pattern.",children:(0,e.jsx)(I.l6,{inputId:"es_config_indexPattern",value:Ls.find(r=>r.value===(t.jsonData.interval===void 0?"none":t.jsonData.interval)),options:Ls,onChange:qi(t,i),width:24})}),(0,e.jsx)(b.I,{label:"Time field name",htmlFor:"es_config_timeField",labelWidth:29,tooltip:"Name of your time field. Defaults to @timestamp.",children:(0,e.jsx)(F.p,{id:"es_config_timeField",value:t.jsonData.timeField||"",onChange:Ns("timeField",t,i),width:24,placeholder:"@timestamp",required:!0})}),(0,e.jsx)(b.I,{label:"Max concurrent Shard Requests",htmlFor:"es_config_shardRequests",labelWidth:29,tooltip:"Maximum number of concurrent shards a search request can hit per node. Defaults to 5.",children:(0,e.jsx)(F.p,{id:"es_config_shardRequests",value:t.jsonData.maxConcurrentShardRequests||"",onChange:Ns("maxConcurrentShardRequests",t,i),width:24})}),(0,e.jsx)(b.I,{label:"Min time interval",htmlFor:"es_config_minTimeInterval",labelWidth:29,tooltip:(0,e.jsxs)(e.Fragment,{children:["A lower limit for the auto group by time interval. Recommended to be set to write frequency, for example"," ",(0,e.jsx)("code",{children:"1m"})," if your data is written every minute."]}),error:"Value is not valid, you can use number with time unit specifier: y, M, w, d, h, m, s",invalid:!!t.jsonData.timeInterval&&!/^\d+(ms|[Mwdhmsy])$/.test(t.jsonData.timeInterval),children:(0,e.jsx)(F.p,{id:"es_config_minTimeInterval",value:t.jsonData.timeInterval||"",onChange:Ns("timeInterval",t,i),width:24,placeholder:"10s"})}),(0,e.jsx)(b.I,{label:"Include Frozen Indices",htmlFor:"es_config_frozenIndices",labelWidth:29,tooltip:"Include frozen indices in searches.",children:(0,e.jsx)(_e.K,{id:"es_config_frozenIndices",value:t.jsonData.includeFrozen??!1,onChange:Wi("includeFrozen",t,i)})})]}),Qi=(t,i)=>r=>{i({...t,database:"",jsonData:{...t.jsonData,index:r.currentTarget.value}})},Ns=(t,i,r)=>n=>{r({...i,jsonData:{...i.jsonData,[t]:n.currentTarget.value}})},Wi=(t,i,r)=>n=>{r({...i,jsonData:{...i.jsonData,[t]:n.currentTarget.checked}})},qi=(t,i)=>r=>{const n=r.value==="none"?void 0:r.value,o=t.jsonData.index??t.database;if(!o||o.length===0||o.startsWith("[logstash-]")){let u="";if(n!==void 0){const f=Ls.find(v=>v.value===n);f&&(u=f.example??"")}i({...t,database:"",jsonData:{...t.jsonData,index:u,interval:n}})}else i({...t,jsonData:{...t.jsonData,interval:n}})};function ki(){return 5}const zi=t=>{const{value:i,onChange:r}=t,n=o=>u=>{r({...i,[o]:u.currentTarget.value})};return(0,e.jsxs)(Rs.I,{title:"Logs",description:(0,e.jsx)(Vs.H,{description:"Configure which fields the data source uses for log messages and log levels.",suffix:"elasticsearch/#logs",feature:"Elasticsearch log fields"}),children:[(0,e.jsx)(b.I,{label:"Message field name",labelWidth:22,tooltip:"Configure the field to be used for log messages.",children:(0,e.jsx)(F.p,{id:"es_logs-config_logMessageField",value:i.logMessageField,onChange:n("logMessageField"),placeholder:"_source",width:24})}),(0,e.jsx)(b.I,{label:"Level field name",labelWidth:22,tooltip:"Configure the field that determines the level of each log message.",children:(0,e.jsx)(F.p,{id:"es_logs-config_logLevelField",value:i.logLevelField,onChange:n("logLevelField"),width:24})})]})},Hi=t=>({...t,jsonData:{...t.jsonData,timeField:t.jsonData.timeField||"@timestamp",maxConcurrentShardRequests:t.jsonData.maxConcurrentShardRequests||ki(),logMessageField:t.jsonData.logMessageField||"",logLevelField:t.jsonData.logLevelField||"",includeFrozen:t.jsonData.includeFrozen??!1}}),Ui=t=>!!t.jsonData.timeField&&!!t.jsonData.maxConcurrentShardRequests&&t.jsonData.logMessageField!==void 0&&t.jsonData.logLevelField!==void 0,Ki=t=>{const{options:i,onOptionsChange:r}=t;(0,A.useEffect)(()=>{Ui(i)||r(Hi(i))},[r,i]);const n=(0,Si.pe)({config:i,onChange:r});return tt.$.sigV4AuthEnabled&&(n.customMethods=[{id:"custom-sigv4",label:"SigV4 auth",description:"AWS Signature Version 4 authentication",component:(0,e.jsx)($i._r,{inExperimentalAuthComponent:!0,...t})}],n.selectedMethod=i.jsonData.sigV4Auth?"custom-sigv4":n.selectedMethod),(0,e.jsxs)(e.Fragment,{children:[i.access==="direct"&&(0,e.jsx)(K.F,{title:"Error",severity:"error",children:"Browser access mode in the Elasticsearch datasource is no longer available. Switch to server access mode."}),(0,e.jsx)(Fi.I,{dataSourceName:"Elasticsearch",docsLink:"https://grafana.com/docs/grafana/latest/datasources/elasticsearch",hasRequiredFields:!1}),(0,e.jsx)(Os.c,{spacing:4}),(0,e.jsx)(Ii.u,{config:i,onChange:r,urlPlaceholder:"http://localhost:9200"}),(0,e.jsx)(Os.c,{spacing:4}),(0,e.jsx)(Ai.N,{...n,onAuthMethodSelect:o=>{r({...i,basicAuth:o===_s.q.BasicAuth,withCredentials:o===_s.q.CrossSiteCredentials,jsonData:{...i.jsonData,sigV4Auth:o==="custom-sigv4",oauthPassThru:o===_s.q.OAuthForward}})}}),(0,e.jsx)(Os.c,{spacing:4}),(0,e.jsx)(Ci.A,{title:"Additional settings",description:"Additional settings are optional settings that can be configured for more control over your data source.",isCollapsible:!0,isInitiallyOpen:!0,children:(0,e.jsxs)(ei.B,{gap:5,direction:"column",children:[(0,e.jsx)(wi.g,{config:i,onChange:r}),tt.$.secureSocksDSProxyEnabled&&(0,e.jsx)(Mi.Y,{options:i,onOptionsChange:r}),(0,e.jsx)(Bi,{value:i,onChange:r}),(0,e.jsx)(zi,{value:i.jsonData,onChange:o=>r({...i,jsonData:o})}),(0,e.jsx)(Ni,{value:i.jsonData.dataLinks,onChange:o=>{r({...i,jsonData:{...i.jsonData,dataLinks:o}})}})]})})]})};var Gi=p(51553),fs=p(65474),Yi=p(62467),ti=p(66847),Zi=p(69862),Ji=p(2174),Xi=p(41560),er=p(57532),st=p(81160),tr=p(59099),se=p(18163),sr=p(59577),Bs=p(16753),Z=p(3202),ir=p(65502),rr=p(39736),nr=p(98437);const si={Hourly:{startOf:"hour",amount:"hours"},Daily:{startOf:"day",amount:"days"},Weekly:{startOf:"isoWeek",amount:"weeks"},Monthly:{startOf:"month",amount:"months"},Yearly:{startOf:"year",amount:"years"}};class ar{constructor(i,r){this.pattern=i,this.interval=r,this.dateLocale="en"}getIndexForToday(){return this.interval?(0,Z.yT)().locale(this.dateLocale).format(this.pattern):this.pattern}getIndexList(i,r){if(!this.interval)return this.pattern;const o=si[this.interval],u=(0,Z.KQ)(i||(0,Z.KQ)(r).add(-7,o.amount)).utc().startOf(o.startOf),f=(0,Z.KQ)(r||(0,Z.KQ)(i).add(7,o.amount)).utc().startOf(o.startOf).valueOf(),v=[];for(;u.valueOf()<=f;)v.push(u.locale(this.dateLocale).format(this.pattern)),u.add(1,o.amount);return v}}var gs=p(58462);class lr extends S.Is{constructor(i,r){super(),this.datasource=i,Object.assign(this,r)}importFromAbstractQuery(i){return{metrics:[{id:"1",type:"logs"}],query:this.getElasticsearchQuery(i.labelMatchers),refId:i.refId}}getElasticsearchQuery(i){return i.map(r=>{switch(r.operator){case gs.D_.Equal:return r.name+':"'+r.value+'"';case gs.D_.NotEqual:return"-"+r.name+':"'+r.value+'"';case gs.D_.EqualRegEx:return r.name+":/"+r.value+"/";case gs.D_.NotEqualRegEx:return"-"+r.name+":/"+r.value+"/"}}).join(" AND ")}}var or=p(32300),ps=p(30048);function cr(t){const i=t.annotation,r=t.onAnnotationChange;return(0,e.jsxs)(ei.B,{direction:"column",gap:5,children:[(0,e.jsx)("div",{children:(0,e.jsx)(Xs,{value:i.target?.query,onChange:n=>{const u={...i.target??{refId:"annotation_query"},query:n};r({...i,target:u})}})}),(0,e.jsxs)("div",{children:[(0,e.jsx)("h6",{children:"Field mappings"}),(0,e.jsxs)(or.U,{children:[(0,e.jsx)(ps.c,{label:"Time",children:(0,e.jsx)(F.p,{type:"text",placeholder:"@timestamp",value:i.timeField,onChange:n=>{r({...i,timeField:n.currentTarget.value})}})}),(0,e.jsx)(ps.c,{label:"Time End",children:(0,e.jsx)(F.p,{type:"text",value:i.timeEndField,onChange:n=>{r({...i,timeEndField:n.currentTarget.value})}})}),(0,e.jsx)(ps.c,{label:"Text",children:(0,e.jsx)(F.p,{type:"text",value:i.textField,onChange:n=>{r({...i,textField:n.currentTarget.value})}})}),(0,e.jsx)(ps.c,{label:"Tags",children:(0,e.jsx)(F.p,{type:"text",placeholder:"tags",value:i.tagsField,onChange:n=>{r({...i,tagsField:n.currentTarget.value})}})})]})]}),(0,e.jsx)("div",{})]})}function ur(t){return!t||typeof t!="object"?!1:"meta"in t}var it=p(94601);function hs(t,i,r,n=""){return ii(t,i,r,n)!==null}function ii(t,i,r,n=""){const o=`${n}${it.term.escape(i)}`;r=it.phrase.escape(r);let u=oi(t);return u?Qs(u,o,r):null}function Qs(t,i,r){return Object.keys(t).length===0?null:li(t.left)?Qs(t.left,i,r):ys(t.left)&&t.left.field===i&&t.left.term===r?t.left:qs(t)?null:ys(t.right)&&t.right.field===i&&t.right.term===r?t.right:ks(t.right)?Qs(t.right,i,r):null}function St(t,i,r,n=""){if(hs(t,i,r,n))return t;i=ai(i),r=ms(r);const o=`${n}${i}:"${r}"`;return ri(t,o)}function ri(t,i,r="AND"){return i?t.trim()===""?i:`${t} ${r} ${i}`:t}function dr(t,i){if(!i.key||!i.value)return t;if(i={...i,value:i.value.toString()},["=","!="].includes(i.operator))return St(t,i.key,i.value,i.operator==="="?"":"-");const n=ai(i.key),o=ms(i.value),u=ms(i.value,!1);let f="";switch(i.operator){case"=~":f=`${n}:/${u}/`;break;case"!~":f=`-${n}:/${u}/`;break;case">":f=`${n}:>${o}`;break;case"<":f=`${n}:<${o}`;break}return ri(t,f)}function ni(t,i,r,n=""){const o=ii(t,i,r,n),u=oi(t);return!o||!u?t:it.toString(Ws(u,o))}function Ws(t,i){return Object.keys(t).length===0?t:li(t.left)?(t.left=Ws(t.left,i),t):ys(t.left)&&(0,V.isEqual)(t.left,i)?(Object.assign(t,{left:void 0,operator:void 0,right:void 0},"right"in t?t.right:{}),t):qs(t)?t:ys(t.right)&&(0,V.isEqual)(t.right,i)?(Object.assign(t,{right:void 0,operator:void 0}),t):(ks(t.right)&&(t.right=Ws(t.right,i)),t)}function ai(t){return it.term.escape(t)}function ms(t,i=!0){return i&&(t=t.replace(/\\/g,"\\\\")),it.phrase.escape(t)}function fr(t){return t.replace(/(\w+)\s(:)/gi,"$1$2")}function qs(t){return!t||typeof t!="object"?!1:"left"in t&&!("right"in t)}function ks(t){return!t||typeof t!="object"?!1:"left"in t&&"right"in t}function li(t){return qs(t)||ks(t)}function ys(t){return!!(t&&typeof t=="object"&&"term"in t)}function oi(t){try{return it.parse(fr(t))}catch{return null}}function ci(t,i,r=!0){const n=`"${ms(i)}"`;return t.trim()?`${t} ${r?"AND":"NOT"} ${n}`:`${r?"":"NOT "}${n}`}var zs=p(56276),gr=p(45622);const pr=({payload:{dashboardId:t,orgId:i,grafanaVersion:r,queries:n}})=>{try{const o=n[gr.id]?.filter(O=>!O.hide);if(!o?.length)return;const u=o.filter(mr),f=o.filter(O=>!!O.query),v=o.filter(O=>Ft(O)==="logs"),$=o.filter(O=>Ft(O)==="metric"),h=o.filter(O=>Ft(O)==="raw_data"),x=o.filter(O=>Ft(O)==="raw_document"),D=o.filter(hr),L={grafana_version:r,dashboard_id:t,org_id:i,queries_count:o.length,logs_queries_count:v.length,metric_queries_count:$.length,raw_data_queries_count:h.length,raw_document_queries_count:x.length,queries_with_template_variables_count:u.length,queries_with_changed_line_limit_count:D.length,queries_with_lucene_query_count:f.length};(0,zs.rR)("grafana_elasticsearch_dashboard_loaded",L)}catch(o){console.error("error in elasticsearch tracking handler",o)}},Ft=t=>!t.metrics||!t.metrics.length?void 0:["logs","raw_data","raw_document"].includes(t.metrics[0].type)?t.metrics[0].type:"metric",ui=t=>{if(t.metrics?.[0]?.type!=="logs")return;const i=t.metrics?.[0].settings?.limit;return i?parseInt(i,10):void 0},hr=t=>{const i=ui(t);return i!==void 0&&i!==500},mr=t=>ot.test(t.query??""),yr=t=>!!t.startsWith(di);function vr(t,i,r){const{targets:n,app:o}=i;if(!(o===Bs.Jk.Dashboard||o===Bs.Jk.PanelViewer))for(const u of n){if(yr(u.refId))return;(0,zs.rR)("grafana_elasticsearch_query_executed",{app:o,grafana_version:tt.$.buildInfo.version,with_lucene_query:!!u.query,query_type:Ft(u),line_limit:ui(u),alias:u.alias,has_error:t.error!==void 0,has_data:t.data.some(f=>f.length>0),simultaneously_sent_query_count:n.length,time_range_from:i?.range?.from?.toISOString(),time_range_to:i?.range?.to?.toISOString(),time_taken:Date.now()-r.getTime()})}}function xr(t){(0,zs.rR)("grafana_elasticsearch_annotation_query_executed",{grafana_version:tt.$.buildInfo.version,has_target_query:!!t.target?.query,has_query:!!t.query,has_time_field:!!t.timeField,has_time_end_field:!!t.timeEndField,has_tags_field:!!t.tagsField,has_text_field:!!t.textField,has_index:!!t.index})}const Mr={filters:[]},Tr={pipelineVariables:[]},Er={bucketAggs:[],metrics:[]},br=t=>t&&typeof t=="object"&&"responses"in t&&Array.isArray(t.responses)&&t.responses.find(i=>typeof i=="object"&&i!==null&&"hits"in i&&typeof i.hits=="object"&&i.hits!==null&&"hits"in i.hits&&Array.isArray(i.hits.hits)),jr=t=>t&&typeof t=="object"&&"responses"in t&&Array.isArray(t.responses)&&t.responses.find(i=>typeof i=="object"&&i!==null&&"aggregations"in i&&typeof i.aggregations=="object"&&i.aggregations!==null&&Object.keys(i.aggregations).length>0),di="log-volume-",fi="log-sample-",$r=["_index","_type","_id","_source","_size","_field_names","_ignored","_routing","_meta"];class Sr extends ir.iy{constructor(i,r=(0,rr.w)()){super(i),this.templateSrv=r,this.getLogRowContext=async(o,u)=>{const f=this.makeLogContextDataRequest(o,u);return(0,le.s)(this.query(f).pipe((0,ti.W)(v=>{throw{message:"Error during context query. Please check JS console logs.",status:v.status,statusText:v.statusText}})))},this.makeLogContextDataRequest=(o,u)=>{const f=u?.direction||se.ZF.Backward,v={type:"logs",id:"1",settings:{limit:u?.limit?u?.limit.toString():"10",sortDirection:f===se.ZF.Backward?"desc":"asc",searchAfter:o.dataFrame.fields.find(O=>O.name==="sort")?.values[o.rowIndex]??[o.timeEpochMs]}},$={refId:`log-context-${o.dataFrame.refId}-${f}`,metrics:[v],query:""},h=Ar(o.timeEpochMs,f,this.intervalPattern),x={from:h.from,to:h.to,raw:h},D=sr.calculateInterval(x,1);return{requestId:`log-context-request-${o.dataFrame.refId}-${u?.direction}`,targets:[$],interval:D.interval,intervalMs:D.intervalMs,range:x,scopedVars:{},timezone:"UTC",app:Bs.Jk.Explore,startTime:Date.now(),hideFromInspector:!0}},this.basicAuth=i.basicAuth,this.withCredentials=i.withCredentials,this.url=i.url,this.name=i.name,this.isProxyAccess=i.access==="proxy";const n=i.jsonData||{};this.index=n.index??i.database??"",this.timeField=n.timeField,this.indexPattern=new ar(this.index,n.interval),this.intervalPattern=n.interval,this.interval=n.timeInterval,this.maxConcurrentShardRequests=n.maxConcurrentShardRequests,this.queryBuilder=new pt({timeField:this.timeField}),this.logLevelField=n.logLevelField||"",this.dataLinks=n.dataLinks||[],this.includeFrozen=n.includeFrozen??!1,this.databaseVersion=null,this.annotations={QueryEditor:cr},this.logLevelField===""&&(this.logLevelField=void 0),this.languageProvider=new lr(this)}getResourceRequest(i,r,n){return this.getResource(i,r,n)}postResourceRequest(i,r,n){const o=n??{};return o.headers=o.headers??{},o.headers["content-type"]="application/x-ndjson",this.postResource(i,r,o)}async importFromAbstractQueries(i){return i.map(r=>this.languageProvider.importFromAbstractQuery(r))}requestAllIndices(i=(0,z.E2)()){let r=this.indexPattern.getIndexList(i.from,i.to);Array.isArray(r)||(r=[this.indexPattern.getIndexForToday()]);const n=tt.$.featureToggles.elasticsearchCrossClusterSearch?"_field_caps":"_mapping",o=r.map(v=>(v=v.replace(/\/$/,""),v===""?n:`${v}/${n}`)),u=7,f=o.length;return(0,Gi.c)({initialState:0,condition:v=>v<Math.min(f,u),iterate:v=>v+1}).pipe((0,Zi.Z)(v=>{const $=o[f-v-1];return(0,fs.H)(this.getResource($)).pipe((0,ti.W)(h=>(0,Yi.of)({err:h})))}),(0,Ji.j)(v=>v?.err?.status===404),(0,Xi.v)(()=>"Could not find an available index for this time range."),(0,er.$)(),(0,st.T)(v=>{if(v.err)throw v.err;return v}))}annotationQuery(i){const r=this.prepareAnnotationRequest(i);xr(i.annotation);const n=(0,fs.H)(this.postResourceRequest("_msearch",r));return(0,le.s)(n.pipe((0,st.T)(o=>{if(!br(o))return[];const u=o?.responses[0].hits?.hits??[];return this.processHitsToAnnotationEvents(i.annotation,u)})))}prepareAnnotationRequest(i){const r=i.annotation,n=r.timeField||"@timestamp",o=r.timeEndField||null,$=i.dashboard.getVariables().filter($e=>$e.type==="adhoc").filter($e=>$e.datasource?.uid===r.datasource.uid).map($e=>$e.filters).flat(),h=r.query??r.target?.query??"",x=[],D={};if(D[n]={from:i.range.from.valueOf(),to:i.range.to.valueOf(),format:"epoch_millis"},x.push({range:D}),o){const $e={};$e[o]={from:i.range.from.valueOf(),to:i.range.to.valueOf(),format:"epoch_millis"},x.push({range:$e})}const L=this.interpolateLuceneQuery(h),O=this.addAdHocFilters(L,$),G={bool:{filter:[{bool:{should:x,minimum_should_match:1}}]}};O&&G.bool.filter.push({query_string:{query:O}});const wr={query:G,size:1e4},Hs={search_type:"query_then_fetch",ignore_unavailable:!0};return r.index?Hs.index=r.index:Hs.index=this.indexPattern.getIndexList(i.range.from,i.range.to),JSON.stringify(Hs)+`
`+JSON.stringify(wr)+`
`}processHitsToAnnotationEvents(i,r){const n=i.timeField||"@timestamp",o=i.timeEndField||null,u=i.textField||"tags",f=i.tagsField||null,v=[],$=(h,x)=>{if(!x)return;const D=x.split(".");let L=h;for(let O=0;O<D.length;O++)if(L=L[D[O]],!L)return"";return L};for(let h=0;h<r.length;h++){const x=r[h]._source;let D=$(x,n);if(typeof r[h].fields<"u"){const G=r[h].fields;typeof G=="object"&&((0,V.isString)(G[n])||(0,V.isNumber)(G[n]))&&(D=G[n])}const L={annotation:i,time:(0,Z.yT)(D).valueOf(),text:$(x,u)};if(o){const G=$(x,o);G&&(L.timeEnd=(0,Z.yT)(G).valueOf())}if(i.titleField){const G=$(x,i.titleField);G&&(L.text=G+`
`+L.text)}const O=$(x,f);typeof O=="string"?L.tags=O.split(","):L.tags=O,v.push(L)}return v}interpolateLuceneQuery(i,r){return this.templateSrv.replace(i,r,"lucene")}interpolateVariablesInQueries(i,r,n){return i.map(o=>this.applyTemplateVariables(o,r,n))}getQueryHeader(i,r,n){const o={search_type:i,ignore_unavailable:!0,index:this.indexPattern.getIndexList(r,n)};return JSON.stringify(o)}getQueryDisplayText(i){const r=i.metrics,n=i.bucketAggs;let o="";return i.query&&(o+="Query: "+i.query+", "),o+="Metrics: ",o+=r?.reduce((u,f)=>{let $=Q[f.type].label+"(";return de(f)&&($+=f.field),Re(f)&&($+=Ne(f).replace(new RegExp("params.","g"),"")),$+="), ",`${u} ${$}`},""),o+=n?.reduce((u,f,v)=>{const $=W[f.type];let h="";return v===0&&(h+=" Group by: "),h+=$.label+"(",Ke(f)&&(h+=f.field),`${u} ${h}), `},""),i.alias&&(o+="Alias: "+i.alias),o}getSupplementaryRequest(i,r){switch(i){case se.cF.LogsVolume:return this.getLogsVolumeDataProvider(r);case se.cF.LogsSample:return this.getLogsSampleDataProvider(r);default:return}}getSupportedSupplementaryQueryTypes(){return[se.cF.LogsVolume,se.cF.LogsSample]}getSupplementaryQuery(i,r){let n=!1;if(!r.hide)switch(i.type){case se.cF.LogsVolume:if(n=r.metrics?.length===1&&r.metrics[0].type==="logs",!n)return;const o=[],u=this.timeField??"@timestamp";return this.logLevelField&&o.push({id:"2",type:"terms",settings:{min_doc_count:"0",size:"0",order:"desc",orderBy:"_count",missing:se.$b.unknown},field:this.logLevelField}),o.push({id:"3",type:"date_histogram",settings:{interval:"auto",min_doc_count:"0",trimEdges:"0"},field:u}),{refId:`${di}${r.refId}`,query:r.query,metrics:[{type:"count",id:"1"}],timeField:u,bucketAggs:o};case se.cF.LogsSample:return n=Be(r),n?i.limit?{refId:`${fi}${r.refId}`,query:r.query,metrics:[{type:"logs",id:"1",settings:{limit:i.limit.toString()}}]}:{refId:`${fi}${r.refId}`,query:r.query,metrics:[{type:"logs",id:"1"}]}:void 0;default:return}}getLogsVolumeDataProvider(i){const r=(0,V.cloneDeep)(i),n=r.targets.map(o=>this.getSupplementaryQuery({type:se.cF.LogsVolume},o)).filter(o=>!!o);if(n.length)return{...r,targets:n}}getLogsSampleDataProvider(i){const r=(0,V.cloneDeep)(i),u=r.targets.map(f=>this.getSupplementaryQuery({type:se.cF.LogsSample,limit:100},f)).filter(f=>!!f);if(u.length)return{...r,targets:u}}query(i){const r=new Date;return super.query(i).pipe((0,tr.M)(n=>vr(n,i,r)),(0,st.T)(n=>(n.data.forEach(o=>{Fr(o,this.dataLinks)}),n)))}filterQuery(i){return!i.hide}isMetadataField(i){return $r.includes(i)}getFields(i,r){if(tt.$.featureToggles.elasticsearchCrossClusterSearch)return this.getFieldsCrossCluster(i,r);const n={float:"number",double:"number",integer:"number",long:"number",date:"date",date_nanos:"date",string:"string",text:"string",scaled_float:"number",nested:"nested",histogram:"number"};return this.requestAllIndices(r).pipe((0,st.T)(o=>{const u=(h,x)=>this.isMetadataField(x)?!1:!i||i.length===0?!0:i.includes(h.type)||i.includes(n[h.type]),f=[],v={};function $(h){for(const x in h){const D=h[x];if((0,V.isObject)(D.properties)&&(f.push(x),$(D.properties)),(0,V.isObject)(D.fields)&&(f.push(x),$(D.fields)),(0,V.isString)(D.type)){const L=f.concat(x).join(".");u(D,x)&&(v[L]={text:L,type:D.type})}}f.pop()}for(const h in o){const x=o[h];if(x&&x.mappings){const L=x.mappings.properties;$(L)}}return(0,V.map)(v,h=>h)}))}getFieldsCrossCluster(i,r){const n={float:"number",double:"number",integer:"number",long:"number",date:"date",date_nanos:"date",string:"string",text:"string",scaled_float:"number",nested:"nested",histogram:"number"};return this.requestAllIndices(r).pipe((0,st.T)(o=>{const u=$=>{for(const h in $)if(h!=="object"&&!$[h].metadata_field&&(!i||i.length===0||i.includes(h)||i.includes(n[h])))return!0;return!1},f={},v=o.fields;for(const $ in v){const h=v[$];u(h)&&(f[$]={text:$,type:h.type})}return(0,V.map)(f,$=>$)}))}getTerms(i,r=(0,z.E2)(),n=!1){const u=this.getQueryHeader("query_then_fetch",r.from,r.to);let f=JSON.stringify(this.queryBuilder.getTermsQuery(i));f=f.replace(/\$timeFrom/g,r.from.valueOf().toString()),f=f.replace(/\$timeTo/g,r.to.valueOf().toString()),f=u+`
`+f+`
`;const v=this.getMultiSearchUrl();return(0,fs.H)(this.postResourceRequest(v,f)).pipe((0,st.T)($=>{if(!jr($))return[];if(!$||!$.responses[0].aggregations)return[];const h=$.responses[0].aggregations[1].buckets;return(0,V.map)(h,x=>{const D=String(x.key);return{text:x.key_as_string||D,value:n?D:x.key}})}))}getMultiSearchUrl(){const i=new URLSearchParams;return this.maxConcurrentShardRequests&&i.append("max_concurrent_shard_requests",`${this.maxConcurrentShardRequests}`),this.includeFrozen&&i.append("ignore_throttled","false"),("_msearch?"+i.toString()).replace(/\?$/,"")}metricFindQuery(i,r){const n=r?.range,o=JSON.parse(i);if(i){if(o.find==="fields")return o.type=this.interpolateLuceneQuery(o.type),(0,le.s)(this.getFields(o.type,n));if(o.find==="terms")return o.field=this.interpolateLuceneQuery(o.field),o.query=this.interpolateLuceneQuery(o.query),(0,le.s)(this.getTerms(o,n))}return Promise.resolve([])}getTagKeys(){return(0,le.s)(this.getFields())}getTagValues(i){return(0,le.s)(this.getTerms({field:i.key},i.timeRange,!0))}targetContainsTemplate(i){if(this.templateSrv.containsTemplate(i.query)||this.templateSrv.containsTemplate(i.alias))return!0;if(i.bucketAggs){for(const r of i.bucketAggs)if(Ke(r)&&this.templateSrv.containsTemplate(r.field)||this.objectContainsTemplate(r.settings))return!0}if(i.metrics){for(const r of i.metrics)if(de(r)&&(r.field&&this.templateSrv.containsTemplate(r.field)||r.settings&&this.objectContainsTemplate(r.settings)||ur(r)&&this.objectContainsTemplate(r.meta)))return!0}return!1}objectContainsTemplate(i){if(typeof i=="string")return this.templateSrv.containsTemplate(i);if(!i||typeof i!="object")return!1;for(const r in i)if(Array.isArray(i[r])){for(const n of i[r])if(this.objectContainsTemplate(n))return!0}else if(this.objectContainsTemplate(i[r]))return!0;return!1}toggleQueryFilter(i,r){let n=i.query??"";switch(r.type){case"FILTER_FOR":{n=hs(n,r.options.key,r.options.value)?ni(n,r.options.key,r.options.value):St(n,r.options.key,r.options.value);break}case"FILTER_OUT":{hs(n,r.options.key,r.options.value)&&(n=ni(n,r.options.key,r.options.value)),n=St(n,r.options.key,r.options.value,"-");break}}return{...i,query:n}}queryHasFilter(i,r){let n=i.query??"";return hs(n,r.key,r.value)}modifyQuery(i,r){if(!r.options)return i;let n=i.query??"";switch(r.type){case"ADD_FILTER":{n=St(n,r.options.key,r.options.value);break}case"ADD_FILTER_OUT":{n=St(n,r.options.key,r.options.value,"-");break}case"ADD_STRING_FILTER":{n=ci(n,r.options.value);break}case"ADD_STRING_FILTER_OUT":{n=ci(n,r.options.value,!1);break}}return{...i,query:n}}getSupportedQueryModifications(){return["ADD_FILTER","ADD_FILTER_OUT","ADD_STRING_FILTER","ADD_STRING_FILTER_OUT"]}addAdHocFilters(i,r){if(!r)return i;let n=i;return r.forEach(o=>{n=dr(n,o)}),n}applyTemplateVariables(i,r,n){const o=v=>v.type==="filters"?{...v,settings:{...v.settings,filters:v.settings?.filters?.map($=>({...$,query:this.interpolateLuceneQuery($.query,r)||"*"}))}}:v,u={...i,datasource:this.getRef(),query:this.addAdHocFilters(this.interpolateLuceneQuery(i.query||"",r),n),bucketAggs:i.bucketAggs?.map(o)};return JSON.parse(this.templateSrv.replace(JSON.stringify(u),r))}getDatabaseVersionUncached(){const i=(0,fs.H)(this.getResourceRequest(""));return(0,le.s)(i).then(r=>{const n=r?.version?.number;if(typeof n!="string")return null;try{return new Ve.SemVer(n)}catch(o){return console.error(o),null}},r=>(console.error(r),null))}async getDatabaseVersion(i=!0){if(i){const n=this.databaseVersion;if(n!=null)return n}const r=await this.getDatabaseVersionUncached();return this.databaseVersion=r,r}}function Fr(t,i){if(i.length)for(const r of t.fields){const n=i.filter(o=>new RegExp(o.field).test(r.name));n.length!==0&&(r.config=r.config||{},r.config.links=[...(r.config.links,n.map(Ir))])}}function Ir(t){const i=(0,nr.l)();if(t.datasourceUid){const r=i.getInstanceSettings(t.datasourceUid);return{title:t.urlDisplayLabel||"",url:"",internal:{query:{query:t.url},datasourceUid:t.datasourceUid,datasourceName:r?.name??"Data source not found"}}}else return{title:t.urlDisplayLabel||"",url:t.url}}function Ar(t,i,r){if(r){const o=si[r];return i===se.ZF.Forward?{from:(0,Z.KQ)(t).utc(),to:(0,Z.KQ)(t).add(7,o.amount).utc().startOf(o.startOf)}:{from:(0,Z.KQ)(t).subtract(7,o.amount).utc().startOf(o.startOf),to:(0,Z.KQ)(t).utc()}}else return i===se.ZF.Forward?{from:(0,Z.KQ)(t).utc(),to:(0,Z.KQ)(t).add(7,"hours").utc()}:{from:(0,Z.KQ)(t).subtract(7,"hours").utc(),to:(0,Z.KQ)(t).utc()}}const Cr=new S.tD(Sr).setQueryEditor(bi).setConfigEditor(Ki);(0,_.J7)().subscribe(d.gc,pr)},27487:(ce,N)=>{N.escape=function(_){return _.replace(/[\+\-\!\(\)\{\}\[\]\^\"\?\:\\\&\|\'\/\s\*\~]/g,p)};function p(d){return"\\"+d}N.unescape=function(_){return _.replace(/\\([\+\-\!\(\)\{\}\[\]\^\"\?\:\\\&\|\'\/\s\*\~])/g,S)};function S(d,_){return _}N.escapePhrase=function(_){return _.replace(/"/g,p)},N.unescapePhrase=function(_){return _.replace(/\\(")/g,S)}},94601:(ce,N,p)=>{"use strict";var S=p(79148),d=p(27487);N.parse=S.parse.bind(S),N.toString=p(20559),N.term={escape:d.escape,unescape:d.unescape},N.phrase={escape:d.escapePhrase,unescape:d.unescapePhrase}},79148:ce=>{"use strict";function N(d,_){function e(){this.constructor=d}e.prototype=_.prototype,d.prototype=new e}function p(d,_,e,C){this.message=d,this.expected=_,this.found=e,this.location=C,this.name="SyntaxError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,p)}N(p,Error),p.buildMessage=function(d,_){var e={literal:function(M){return'"'+A(M.text)+'"'},class:function(M){var b="",F;for(F=0;F<M.parts.length;F++)b+=M.parts[F]instanceof Array?z(M.parts[F][0])+"-"+z(M.parts[F][1]):z(M.parts[F]);return"["+(M.inverted?"^":"")+b+"]"},any:function(M){return"any character"},end:function(M){return"end of input"},other:function(M){return M.description}};function C(M){return M.charCodeAt(0).toString(16).toUpperCase()}function A(M){return M.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(b){return"\\x0"+C(b)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(b){return"\\x"+C(b)})}function z(M){return M.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(b){return"\\x0"+C(b)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(b){return"\\x"+C(b)})}function K(M){return e[M.type](M)}function q(M){var b=new Array(M.length),F,X;for(F=0;F<M.length;F++)b[F]=K(M[F]);if(b.sort(),b.length>0){for(F=1,X=1;F<b.length;F++)b[F-1]!==b[F]&&(b[X]=b[F],X++);b.length=X}switch(b.length){case 1:return b[0];case 2:return b[0]+" or "+b[1];default:return b.slice(0,-1).join(", ")+", or "+b[b.length-1]}}function J(M){return M?'"'+A(M)+'"':"end of input"}return"Expected "+q(d)+" but "+J(_)+" found."};function S(d,_){_=_!==void 0?_:{};var e={},C={start:ts},A=ts,z=function(s){return s[0]},K=function(){return{}},q=function(s){return{operator:s}},J=function(s,l,c,E){var m={start:s,left:l},E=E.length==0?null:E[0].right==null?E[0].left:E[0];return E!=null&&(m.operator=c==""?"<implicit>":c[0],m.right=E),m},M=function(s,l){return l},b=function(s,l,m){var g={left:s},m=m.length==0?null:m[0].right==null?m[0].left:m[0];return m!=null&&(g.operator=l==""?"<implicit>":l[0],g.right=m),g},F=function(s){return s},X="(",ae=P("(",!1),ye=")",B=P(")",!1),ue=function(s){return s[0].parenthesized=!0,s[0]},It=function(s,l){return l.field=s==null||s.label==""?"<implicit>":s.label,l.fieldLocation=s==null||s.label==""?null:s.location,l},At=function(s,l){return l.field=s.label,l.fieldLocation=s.location,l},rt=function(s,l){var c={field:s==null||s.label==""?"<implicit>":s.label,fieldLocation:s==null||s.label==""?null:s.location};for(var g in l)c[g]=l[g];return c},Oe=/^[:]/,vs=Pe([":"],!1,!1),de=function(s){return{label:s.label,location:s.location}},Se=function(s,l,c,g){var m={term:l,quoted:!0,regex:!1,termLocation:Je()};return c!=""&&(m.proximity=c),g!=""&&(m.boost=g),s!=""&&(m.prefix=s),m},Re=function(s,l){var c={term:l,quoted:!1,regex:!0,termLocation:Je()};return c},xs=function(s,l,c,g){var m={term:l.label,quoted:!1,regex:!1,termLocation:Je()};return c!=""&&(m.similarity=c),g!=""&&(m.boost=g),s!=""&&(m.prefix=s),m},ie="\\",fe=P("\\",!1),Fe=function(s){return"\\"+s},Ct=".",wt=P(".",!1),Q=/^[^ \t\r\n\f{}()"\/\^~[\]]/,Us=Pe([" ","	","\r",`
`,"\f","{","}","(",")",'"',"/","^","~","[","]"],!0,!1),Mt=function(s){return s.join("")},Tt=function(s){return{label:s.join(""),location:Je()}},bs=/^[^: \t\r\n\f{}()"\/\^~[\]]/,Et=Pe([":"," ","	","\r",`
`,"\f","{","}","(",")",'"',"/","^","~","[","]"],!0,!1),ve='"',ge=P('"',!1),nt=function(s){return s.join("")},Ie="/",at=P("/",!1),Ks=function(s){return s.join("")},Dt=Ms(),Ve=function(s){return s},xe="+",Le=P("+",!1),lt="-",Ne=P("-",!1),Pt="!",_t=P("!",!1),Be="{",ot=P("{",!1),Ot="}",R=P("}",!1),Qe="[",We=P("[",!1),qe="]",Ae=P("]",!1),Ce="^",ct=P("^",!1),k="?",Rt=P("?",!1),we=":",Vt=P(":",!1),Lt="&",js=P("&",!1),$s="|",ut=P("|",!1),Nt="'",W=P("'",!1),ke="~",Me=P("~",!1),Bt="*",Qt=P("*",!1),Wt=" ",qt=P(" ",!1),H=function(s){return s},Ss=function(s){return s},Fs=function(s){return s==""||s==null?.5:s},dt="0.",kt=P("0.",!1),Te=/^[0-9]/,ze=Pe([["0","9"]],!1,!1),ft=function(s){return parseFloat("0."+s.join(""))},pe=function(s){return parseInt(s.join(""))},re="TO",He=P("TO",!1),zt=function(s,l){return{term_min:s,term_max:l,inclusive:"both"}},Is=function(s,l){return{term_min:s,term_max:l,inclusive:"none"}},As=function(s,l){return{term_min:s,term_max:l,inclusive:"left"}},be=function(s,l){return{term_min:s,term_max:l,inclusive:"right"}},V=function(s){return s},Ue="OR NOT",Ee=P("OR NOT",!1),gt="AND NOT",Ht=P("AND NOT",!1),Ut="OR",Kt=P("OR",!1),De="AND",le=P("AND",!1),Ke="NOT",Cs=P("NOT",!1),Gt="||",ws=P("||",!1),Yt="&&",Ge=P("&&",!1),je=Xe("whitespace"),Zt=/^[ \t\r\n\f]/,Jt=Pe([" ","	","\r",`
`,"\f"],!1,!1),a=0,I=0,Ye=[{line:1,column:1}],te=0,pt=[],y=0,Ze;if("startRule"in _){if(!(_.startRule in C))throw new Error(`Can't start parsing from rule "`+_.startRule+'".');A=C[_.startRule]}function Gs(){return d.substring(I,a)}function Je(){return he(I,a)}function Ys(s,l){throw l=l!==void 0?l:he(I,a),es([Xe(s)],d.substring(I,a),l)}function Zs(s,l){throw l=l!==void 0?l:he(I,a),Ts(s,l)}function P(s,l){return{type:"literal",text:s,ignoreCase:l}}function Pe(s,l,c){return{type:"class",parts:s,inverted:l,ignoreCase:c}}function Ms(){return{type:"any"}}function Xt(){return{type:"end"}}function Xe(s){return{type:"other",description:s}}function ht(s){var l=Ye[s],c;if(l)return l;for(c=s-1;!Ye[c];)c--;for(l=Ye[c],l={line:l.line,column:l.column};c<s;)d.charCodeAt(c)===10?(l.line++,l.column=1):l.column++,c++;return Ye[s]=l,l}function he(s,l){var c=ht(s),g=ht(l);return{start:{offset:s,line:c.line,column:c.column},end:{offset:l,line:g.line,column:g.column}}}function j(s){a<te||(a>te&&(te=a,pt=[]),pt.push(s))}function Ts(s,l){return new p(s,null,null,l)}function es(s,l,c){return new p(p.buildMessage(s,l),s,l,c)}function ts(){var s,l,c,g;for(s=a,l=[],c=T();c!==e;)l.push(c),c=T();if(l!==e){if(c=[],g=ne(),g!==e)for(;g!==e;)c.push(g),g=ne();else c=e;c!==e?(I=s,l=z(c),s=l):(a=s,s=e)}else a=s,s=e;if(s===e){for(s=a,l=[],c=T();c!==e;)l.push(c),c=T();l!==e&&(I=s,l=K()),s=l,s===e&&(s=a,l=$t(),l!==e&&(I=s,l=K()),s=l)}return s}function ne(){var s,l,c,g,m,E;if(s=a,l=me(),l!==e?(c=$t(),c!==e?(I=s,l=q(l),s=l):(a=s,s=e)):(a=s,s=e),s===e){if(s=a,l=me(),l!==e)if(c=ss(),c!==e){for(g=[],m=me();m!==e;)g.push(m),m=me();if(g!==e){for(m=[],E=ne();E!==e;)m.push(E),E=ne();m!==e?(I=s,l=J(l,c,g,m),s=l):(a=s,s=e)}else a=s,s=e}else a=s,s=e;else a=s,s=e;if(s===e&&(s=a,l=me(),l!==e?(c=ne(),c!==e?(I=s,l=M(l,c),s=l):(a=s,s=e)):(a=s,s=e),s===e))if(s=a,l=ss(),l!==e){for(c=[],g=me();g!==e;)c.push(g),g=me();if(c!==e){for(g=[],m=ne();m!==e;)g.push(m),m=ne();g!==e?(I=s,l=b(l,c,g),s=l):(a=s,s=e)}else a=s,s=e}else a=s,s=e}return s}function ss(){var s,l,c,g;if(s=a,l=rs(),l!==e){for(c=[],g=T();g!==e;)c.push(g),g=T();c!==e?(I=s,l=F(l),s=l):(a=s,s=e)}else a=s,s=e;return s===e&&(s=is()),s}function is(){var s,l,c,g,m,E,w;if(s=a,d.charCodeAt(a)===40?(l=X,a++):(l=e,y===0&&j(ae)),l!==e){for(c=[],g=T();g!==e;)c.push(g),g=T();if(c!==e){if(g=[],m=ne(),m!==e)for(;m!==e;)g.push(m),m=ne();else g=e;if(g!==e)if(d.charCodeAt(a)===41?(m=ye,a++):(m=e,y===0&&j(B)),m!==e){for(E=[],w=T();w!==e;)E.push(w),w=T();E!==e?(I=s,l=ue(g),s=l):(a=s,s=e)}else a=s,s=e;else a=s,s=e}else a=s,s=e}else a=s,s=e;return s}function rs(){var s,l,c;return s=a,l=mt(),l===e&&(l=null),l!==e?(c=Ds(),c!==e?(I=s,l=It(l,c),s=l):(a=s,s=e)):(a=s,s=e),s===e&&(s=a,l=mt(),l!==e?(c=is(),c!==e?(I=s,l=At(l,c),s=l):(a=s,s=e)):(a=s,s=e),s===e&&(s=a,l=mt(),l===e&&(l=null),l!==e?(c=Y(),c!==e?(I=s,l=rt(l,c),s=l):(a=s,s=e)):(a=s,s=e))),s}function mt(){var s,l,c,g,m;if(s=a,l=as(),l!==e)if(Oe.test(d.charAt(a))?(c=d.charAt(a),a++):(c=e,y===0&&j(vs)),c!==e){for(g=[],m=T();m!==e;)g.push(m),m=T();g!==e?(I=s,l=de(l),s=l):(a=s,s=e)}else a=s,s=e;else a=s,s=e;return s}function Y(){var s,l,c,g,m,E,w;if(s=a,l=jt(),l===e&&(l=null),l!==e)if(c=Es(),c!==e)if(g=cs(),g===e&&(g=null),g!==e)if(m=U(),m===e&&(m=null),m!==e){for(E=[],w=T();w!==e;)E.push(w),w=T();E!==e?(I=s,l=Se(l,c,g,m),s=l):(a=s,s=e)}else a=s,s=e;else a=s,s=e;else a=s,s=e;else a=s,s=e;if(s===e){if(s=a,l=jt(),l===e&&(l=null),l!==e)if(c=_e(),c!==e){for(g=[],m=T();m!==e;)g.push(m),m=T();g!==e?(I=s,l=Re(l,c),s=l):(a=s,s=e)}else a=s,s=e;else a=s,s=e;if(s===e)if(s=a,l=jt(),l===e&&(l=null),l!==e)if(c=as(),c!==e)if(g=vt(),g===e&&(g=null),g!==e)if(m=U(),m===e&&(m=null),m!==e){for(E=[],w=T();w!==e;)E.push(w),w=T();E!==e?(I=s,l=xs(l,c,g,m),s=l):(a=s,s=e)}else a=s,s=e;else a=s,s=e;else a=s,s=e;else a=s,s=e}return s}function ns(){var s,l,c;return s=a,d.charCodeAt(a)===92?(l=ie,a++):(l=e,y===0&&j(fe)),l!==e?(c=et(),c!==e?(I=s,l=Fe(c),s=l):(a=s,s=e)):(a=s,s=e),s===e&&(d.charCodeAt(a)===46?(s=Ct,a++):(s=e,y===0&&j(wt)),s===e&&(Q.test(d.charAt(a))?(s=d.charAt(a),a++):(s=e,y===0&&j(Us)))),s}function oe(){var s,l,c;if(s=a,l=[],c=ns(),c!==e)for(;c!==e;)l.push(c),c=ns();else l=e;return l!==e&&(I=s,l=Mt(l)),s=l,s}function as(){var s,l,c;if(s=a,l=[],c=ls(),c!==e)for(;c!==e;)l.push(c),c=ls();else l=e;return l!==e&&(I=s,l=Tt(l)),s=l,s}function ls(){var s,l,c;return s=a,d.charCodeAt(a)===92?(l=ie,a++):(l=e,y===0&&j(fe)),l!==e?(c=et(),c!==e?(I=s,l=Fe(c),s=l):(a=s,s=e)):(a=s,s=e),s===e&&(d.charCodeAt(a)===46?(s=Ct,a++):(s=e,y===0&&j(wt)),s===e&&(bs.test(d.charAt(a))?(s=d.charAt(a),a++):(s=e,y===0&&j(Et)))),s}function Es(){var s,l,c,g;if(s=a,d.charCodeAt(a)===34?(l=ve,a++):(l=e,y===0&&j(ge)),l!==e){for(c=[],g=os();g!==e;)c.push(g),g=os();c!==e?(d.charCodeAt(a)===34?(g=ve,a++):(g=e,y===0&&j(ge)),g!==e?(I=s,l=nt(c),s=l):(a=s,s=e)):(a=s,s=e)}else a=s,s=e;return s}function _e(){var s,l,c,g;if(s=a,d.charCodeAt(a)===47?(l=Ie,a++):(l=e,y===0&&j(at)),l!==e){if(c=[],g=yt(),g!==e)for(;g!==e;)c.push(g),g=yt();else c=e;c!==e?(d.charCodeAt(a)===47?(g=Ie,a++):(g=e,y===0&&j(at)),g!==e?(I=s,l=Ks(c),s=l):(a=s,s=e)):(a=s,s=e)}else a=s,s=e;return s}function os(){var s,l,c;return s=a,l=a,y++,d.charCodeAt(a)===34?(c=ve,a++):(c=e,y===0&&j(ge)),c===e&&(d.charCodeAt(a)===92?(c=ie,a++):(c=e,y===0&&j(fe))),y--,c===e?l=void 0:(a=l,l=e),l!==e?(d.length>a?(c=d.charAt(a),a++):(c=e,y===0&&j(Dt)),c!==e?(I=s,l=Ve(c),s=l):(a=s,s=e)):(a=s,s=e),s===e&&(s=a,d.charCodeAt(a)===92?(l=ie,a++):(l=e,y===0&&j(fe)),l!==e?(c=et(),c!==e?(I=s,l=Fe(c),s=l):(a=s,s=e)):(a=s,s=e)),s}function yt(){var s,l,c;return s=a,l=a,y++,d.charCodeAt(a)===47?(c=Ie,a++):(c=e,y===0&&j(at)),c===e&&(d.charCodeAt(a)===92?(c=ie,a++):(c=e,y===0&&j(fe))),y--,c===e?l=void 0:(a=l,l=e),l!==e?(d.length>a?(c=d.charAt(a),a++):(c=e,y===0&&j(Dt)),c!==e?(I=s,l=Ve(c),s=l):(a=s,s=e)):(a=s,s=e),s===e&&(s=a,d.charCodeAt(a)===92?(l=ie,a++):(l=e,y===0&&j(fe)),l!==e?(c=et(),c!==e?(I=s,l=Fe(c),s=l):(a=s,s=e)):(a=s,s=e)),s}function et(){var s;return d.charCodeAt(a)===43?(s=xe,a++):(s=e,y===0&&j(Le)),s===e&&(d.charCodeAt(a)===45?(s=lt,a++):(s=e,y===0&&j(Ne)),s===e&&(d.charCodeAt(a)===33?(s=Pt,a++):(s=e,y===0&&j(_t)),s===e&&(d.charCodeAt(a)===40?(s=X,a++):(s=e,y===0&&j(ae)),s===e&&(d.charCodeAt(a)===41?(s=ye,a++):(s=e,y===0&&j(B)),s===e&&(d.charCodeAt(a)===123?(s=Be,a++):(s=e,y===0&&j(ot)),s===e&&(d.charCodeAt(a)===125?(s=Ot,a++):(s=e,y===0&&j(R)),s===e&&(d.charCodeAt(a)===91?(s=Qe,a++):(s=e,y===0&&j(We)),s===e&&(d.charCodeAt(a)===93?(s=qe,a++):(s=e,y===0&&j(Ae)),s===e&&(d.charCodeAt(a)===94?(s=Ce,a++):(s=e,y===0&&j(ct)),s===e&&(d.charCodeAt(a)===34?(s=ve,a++):(s=e,y===0&&j(ge)),s===e&&(d.charCodeAt(a)===63?(s=k,a++):(s=e,y===0&&j(Rt)),s===e&&(d.charCodeAt(a)===58?(s=we,a++):(s=e,y===0&&j(Vt)),s===e&&(d.charCodeAt(a)===92?(s=ie,a++):(s=e,y===0&&j(fe)),s===e&&(d.charCodeAt(a)===38?(s=Lt,a++):(s=e,y===0&&j(js)),s===e&&(d.charCodeAt(a)===124?(s=$s,a++):(s=e,y===0&&j(ut)),s===e&&(d.charCodeAt(a)===39?(s=Nt,a++):(s=e,y===0&&j(W)),s===e&&(d.charCodeAt(a)===47?(s=Ie,a++):(s=e,y===0&&j(at)),s===e&&(d.charCodeAt(a)===126?(s=ke,a++):(s=e,y===0&&j(Me)),s===e&&(d.charCodeAt(a)===42?(s=Bt,a++):(s=e,y===0&&j(Qt)),s===e&&(d.charCodeAt(a)===32?(s=Wt,a++):(s=e,y===0&&j(qt)))))))))))))))))))))),s}function cs(){var s,l,c;return s=a,d.charCodeAt(a)===126?(l=ke,a++):(l=e,y===0&&j(Me)),l!==e?(c=bt(),c!==e?(I=s,l=H(c),s=l):(a=s,s=e)):(a=s,s=e),s}function U(){var s,l,c;return s=a,d.charCodeAt(a)===94?(l=Ce,a++):(l=e,y===0&&j(ct)),l!==e?(c=us(),c!==e?(I=s,l=Ss(c),s=l):(a=s,s=e)):(a=s,s=e),s}function vt(){var s,l,c;return s=a,d.charCodeAt(a)===126?(l=ke,a++):(l=e,y===0&&j(Me)),l!==e?(c=xt(),c===e&&(c=null),c!==e?(I=s,l=Fs(c),s=l):(a=s,s=e)):(a=s,s=e),s}function us(){var s;return s=xt(),s===e&&(s=bt()),s}function xt(){var s,l,c,g;if(s=a,d.substr(a,2)===dt?(l=dt,a+=2):(l=e,y===0&&j(kt)),l!==e){if(c=[],Te.test(d.charAt(a))?(g=d.charAt(a),a++):(g=e,y===0&&j(ze)),g!==e)for(;g!==e;)c.push(g),Te.test(d.charAt(a))?(g=d.charAt(a),a++):(g=e,y===0&&j(ze));else c=e;c!==e?(I=s,l=ft(c),s=l):(a=s,s=e)}else a=s,s=e;return s}function bt(){var s,l,c;if(s=a,l=[],Te.test(d.charAt(a))?(c=d.charAt(a),a++):(c=e,y===0&&j(ze)),c!==e)for(;c!==e;)l.push(c),Te.test(d.charAt(a))?(c=d.charAt(a),a++):(c=e,y===0&&j(ze));else l=e;return l!==e&&(I=s,l=pe(l)),s=l,s}function Ds(){var s,l,c,g,m,E,w,ee;if(s=a,d.charCodeAt(a)===91?(l=Qe,a++):(l=e,y===0&&j(We)),l!==e)if(c=oe(),c!==e){for(g=[],m=T();m!==e;)g.push(m),m=T();if(g!==e)if(d.substr(a,2)===re?(m=re,a+=2):(m=e,y===0&&j(He)),m!==e){if(E=[],w=T(),w!==e)for(;w!==e;)E.push(w),w=T();else E=e;E!==e?(w=oe(),w!==e?(d.charCodeAt(a)===93?(ee=qe,a++):(ee=e,y===0&&j(Ae)),ee!==e?(I=s,l=zt(c,w),s=l):(a=s,s=e)):(a=s,s=e)):(a=s,s=e)}else a=s,s=e;else a=s,s=e}else a=s,s=e;else a=s,s=e;if(s===e){if(s=a,d.charCodeAt(a)===123?(l=Be,a++):(l=e,y===0&&j(ot)),l!==e)if(c=oe(),c!==e){for(g=[],m=T();m!==e;)g.push(m),m=T();if(g!==e)if(d.substr(a,2)===re?(m=re,a+=2):(m=e,y===0&&j(He)),m!==e){if(E=[],w=T(),w!==e)for(;w!==e;)E.push(w),w=T();else E=e;E!==e?(w=oe(),w!==e?(d.charCodeAt(a)===125?(ee=Ot,a++):(ee=e,y===0&&j(R)),ee!==e?(I=s,l=Is(c,w),s=l):(a=s,s=e)):(a=s,s=e)):(a=s,s=e)}else a=s,s=e;else a=s,s=e}else a=s,s=e;else a=s,s=e;if(s===e){if(s=a,d.charCodeAt(a)===91?(l=Qe,a++):(l=e,y===0&&j(We)),l!==e)if(c=oe(),c!==e){for(g=[],m=T();m!==e;)g.push(m),m=T();if(g!==e)if(d.substr(a,2)===re?(m=re,a+=2):(m=e,y===0&&j(He)),m!==e){if(E=[],w=T(),w!==e)for(;w!==e;)E.push(w),w=T();else E=e;E!==e?(w=oe(),w!==e?(d.charCodeAt(a)===125?(ee=Ot,a++):(ee=e,y===0&&j(R)),ee!==e?(I=s,l=As(c,w),s=l):(a=s,s=e)):(a=s,s=e)):(a=s,s=e)}else a=s,s=e;else a=s,s=e}else a=s,s=e;else a=s,s=e;if(s===e)if(s=a,d.charCodeAt(a)===123?(l=Be,a++):(l=e,y===0&&j(ot)),l!==e)if(c=oe(),c!==e){for(g=[],m=T();m!==e;)g.push(m),m=T();if(g!==e)if(d.substr(a,2)===re?(m=re,a+=2):(m=e,y===0&&j(He)),m!==e){if(E=[],w=T(),w!==e)for(;w!==e;)E.push(w),w=T();else E=e;E!==e?(w=oe(),w!==e?(d.charCodeAt(a)===93?(ee=qe,a++):(ee=e,y===0&&j(Ae)),ee!==e?(I=s,l=be(c,w),s=l):(a=s,s=e)):(a=s,s=e)):(a=s,s=e)}else a=s,s=e;else a=s,s=e}else a=s,s=e;else a=s,s=e}}return s}function me(){var s,l,c,g,m;for(s=a,l=[],c=T();c!==e;)l.push(c),c=T();if(l!==e)if(c=ds(),c!==e){if(g=[],m=T(),m!==e)for(;m!==e;)g.push(m),m=T();else g=e;g!==e?(I=s,l=V(c),s=l):(a=s,s=e)}else a=s,s=e;else a=s,s=e;if(s===e){for(s=a,l=[],c=T();c!==e;)l.push(c),c=T();l!==e?(c=ds(),c!==e?(g=$t(),g!==e?(I=s,l=V(c),s=l):(a=s,s=e)):(a=s,s=e)):(a=s,s=e)}return s}function ds(){var s;return d.substr(a,6)===Ue?(s=Ue,a+=6):(s=e,y===0&&j(Ee)),s===e&&(d.substr(a,7)===gt?(s=gt,a+=7):(s=e,y===0&&j(Ht)),s===e&&(d.substr(a,2)===Ut?(s=Ut,a+=2):(s=e,y===0&&j(Kt)),s===e&&(d.substr(a,3)===De?(s=De,a+=3):(s=e,y===0&&j(le)),s===e&&(d.substr(a,3)===Ke?(s=Ke,a+=3):(s=e,y===0&&j(Cs)),s===e&&(d.substr(a,2)===Gt?(s=Gt,a+=2):(s=e,y===0&&j(ws)),s===e&&(d.substr(a,2)===Yt?(s=Yt,a+=2):(s=e,y===0&&j(Ge)))))))),s}function jt(){var s,l,c;for(s=a,l=[],c=T();c!==e;)l.push(c),c=T();return l!==e?(c=Ps(),c!==e?(I=s,l=V(c),s=l):(a=s,s=e)):(a=s,s=e),s}function Ps(){var s;return d.charCodeAt(a)===43?(s=xe,a++):(s=e,y===0&&j(Le)),s===e&&(d.charCodeAt(a)===45?(s=lt,a++):(s=e,y===0&&j(Ne)),s===e&&(d.charCodeAt(a)===33?(s=Pt,a++):(s=e,y===0&&j(_t)))),s}function T(){var s,l;if(y++,s=[],Zt.test(d.charAt(a))?(l=d.charAt(a),a++):(l=e,y===0&&j(Jt)),l!==e)for(;l!==e;)s.push(l),Zt.test(d.charAt(a))?(l=d.charAt(a),a++):(l=e,y===0&&j(Jt));else s=e;return y--,s===e&&(l=e,y===0&&j(je)),s}function $t(){var s,l;return s=a,y++,d.length>a?(l=d.charAt(a),a++):(l=e,y===0&&j(Dt)),y--,l===e?s=void 0:(a=s,s=e),s}if(Ze=A(),Ze!==e&&a===d.length)return Ze;throw Ze!==e&&a<d.length&&j(Xt()),es(pt,te<d.length?d.charAt(te):null,te<d.length?he(te,te+1):he(te,te))}ce.exports={SyntaxError:p,parse:S}},20559:ce=>{"use strict";var N="<implicit>";ce.exports=function p(S){if(!S)return"";var d="";return S.start!=null&&(d+=(S.parenthesized?"(":"")+S.start+" "),S.field&&S.field!==N&&(d+=S.field+":"),S.left&&(S.parenthesized&&!S.start&&(d+="("),d+=p(S.left),S.parenthesized&&!S.right&&(d+=")")),S.operator&&(S.left&&(d+=" "),S.operator!==N&&(d+=S.operator)),S.right&&(S.operator&&S.operator!==N&&(d+=" "),d+=p(S.right),S.parenthesized&&(d+=")")),(S.term||S.term===""&&S.quoted)&&(S.prefix&&(d+=S.prefix),S.quoted?(d+='"',d+=S.term,d+='"'):S.regex?(d+="/",d+=S.term,d+="/"):d+=S.term,S.proximity!=null&&(d+="~"+S.proximity),S.boost!=null&&(d+="^"+S.boost)),S.term_min&&(S.inclusive==="both"||S.inclusive==="left"?d+="[":d+="{",d+=S.term_min,d+=" TO ",d+=S.term_max,S.inclusive==="both"||S.inclusive==="right"?d+="]":d+="}"),S.similarity&&(d+="~",S.similarity!==.5&&(d+=S.similarity)),d}},51553:(ce,N,p)=>{"use strict";p.d(N,{c:()=>A});var S=p(31635),d=p(58307),_=p(98820),e=p(72316),C=p(98581);function A(z,K,q,J,M){var b,F,X,ae;arguments.length===1?(b=z,ae=b.initialState,K=b.condition,q=b.iterate,F=b.resultSelector,X=F===void 0?d.D:F,M=b.scheduler):(ae=z,!J||(0,_.m)(J)?(X=d.D,M=J):X=J);function ye(){var B;return(0,S.__generator)(this,function(ue){switch(ue.label){case 0:B=ae,ue.label=1;case 1:return!K||K(B)?[4,X(B)]:[3,4];case 2:ue.sent(),ue.label=3;case 3:return B=q(B),[3,1];case 4:return[2]}})}return(0,e.v)(M?function(){return(0,C.S)(ye(),M)}:ye)}},2174:(ce,N,p)=>{"use strict";p.d(N,{j:()=>_});var S=p(92908),d=p(64878);function _(e){return(0,S.N)(function(C,A){var z=!1,K=0;C.subscribe((0,d._)(A,function(q){return(z||(z=!e(q,K++)))&&A.next(q)}))})}},44575:(ce,N,p)=>{"use strict";p.d(N,{H:()=>e});var S=p(22803),d=p(96540),_=p(29675);function e(A){const{description:z,suffix:K,feature:q}=A,J=`Learn more about ${q}`,M=(0,_.of)(C);return d.createElement("span",{className:M.container},z,d.createElement("a",{"aria-label":J,href:`https://grafana.com/docs/grafana/next/datasources/${K}`,rel:"noreferrer",target:"_blank"},J))}const C=A=>({container:(0,S.css)({color:A.colors.text.secondary,a:(0,S.css)({color:A.colors.text.link,textDecoration:"underline",marginLeft:"5px","&:hover":{textDecoration:"none"}})})})}}]);

//# sourceMappingURL=3325.e45296212946af179059.js.map