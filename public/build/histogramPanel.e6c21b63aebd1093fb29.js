"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[323],{69921:(ct,N,n)=>{n.d(N,{i:()=>R});var v=n(74848),L=n(22803),$=n(29675);const R=({children:f,className:G})=>{const B=(0,$.of)(U);return(0,v.jsx)("div",{className:(0,L.cx)(B.wrapper,G),children:f})},U=f=>({wrapper:(0,L.css)({display:"flex",flexDirection:"column",fontSize:f.typography.bodySmall.fontSize})})},63140:(ct,N,n)=>{n.r(N),n.d(N,{plugin:()=>Rt});var v=n(68256),L=n(62321),$=n(62931),R=n(49448),U=n(63739),f=n(27844),G=n(30040),B=n(13678),J=n(97988),st=n(95118),q=n(10925),y=n(74848),b=n(96540),lt=n(23570),ot=n(29675),s=n(7500),p=n(12963),P=n(36613),C=n(12936),r=n(59141),x=n(18752),g=n(5858),S=n(91371),D=n(73627),m=n(31376),_=n(85832),V=n(87579),X=n(7257);const A={bucketCount:30,bucketOffset:0},I={fillOpacity:80,gradientMode:s.on.None,lineWidth:1};function E(e,t){return Math.floor(e/t)*t}function K(e,t){return Math.ceil(e/t)*t}function j(e){return e.fields[0].type===U.PU.string?1:(0,C.h)(e.fields[1].values[0]-e.fields[0].values[0],9)}function F(e){return e.fields[0].type===U.PU.string?1:(0,C.h)(e.fields[1].values[1]-e.fields[0].values[1],9)}const vt=(e,t)=>{let{min:l,max:o}=e.fields[2].config,i=new g.e,u=e.fields[0].type===U.PU.string,c=j(e),O=F(e),M=O/c,T=O!==c,W=(d,a,h,k,rt,ut)=>{let Q=d.axes[a]._space,Z=d.valToPos(d.data[0][0]+c,"x")-d.valToPos(d.data[0][0],"x"),w=E(l??d.data[0][0],c),Bt=K(o??d.data[0][d.data[0].length-1]+c,c),ht=[],At=Math.ceil(Q/Z);for(let pt=0,dt=w;dt<=Bt;pt++,dt+=c)!(pt%At)&&ht.push(dt);return ht};i.addScale({scaleKey:"x",isTime:!1,distribution:u?s.L4.Ordinal:T?s.L4.Log:s.L4.Linear,log:2,orientation:s.Lt.Horizontal,direction:s.ON.Right,range:T?(d,a,h)=>P.A.rangeLog(a,h*M,2,!0):(d,a,h)=>{l!=null&&(a=l),o!=null&&(h=o);let k=d.data[0][d.data[0].length-1];return a=K(a,c),h=!u&&h===k?h+c:E(h,c),[a,h]}}),i.addScale({scaleKey:"y",isTime:!1,distribution:s.L4.Linear,orientation:s.Lt.Vertical,direction:s.ON.Up,softMin:0});const z=e.fields[0].display,Y=d=>(0,r.cN)(z(d));i.addAxis({scaleKey:"x",isTime:!1,placement:s.vM.Bottom,incrs:u?[1]:T?void 0:f.rW,splits:T||u?void 0:W,values:u?(d,a)=>a:(d,a)=>{const h=a.map(Y),k=h.reduce((Z,w)=>Math.max((0,S.kD)(w,D.pi).width,Z),0),ut=d.bbox.width/((k+10)*devicePixelRatio),Q=Math.ceil(h.length/ut);return h.map((Z,w)=>w%Q===0?Z:null)},theme:t});let et=e.fields[2].display;i.addAxis({scaleKey:"y",isTime:!1,placement:s.vM.Left,formatValue:(d,a)=>(0,r.cN)(et(d,a)),theme:t}),i.setCursor({points:{show:!1},drag:{x:!0,y:!1,setScale:!0}});let it=(0,X.ro)(ft(e));i.setStackingGroups(it);let nt=P.A.paths.bars({align:1,size:[1,1/0]}),at=0;for(let d=2;d<e.fields.length;d++){const a=e.fields[d];a.state=a.state??{},a.state.seriesIndex=at++;const h={...I,...a.config.custom},k="y",rt=(0,x.Qi)(a),Q=(0,x.lz)(a,t).color;i.addSeries({scaleKey:k,lineWidth:h.lineWidth,lineColor:Q,fillOpacity:h.fillOpacity,theme:t,colorMode:rt,pathBuilder:nt,show:!h.hideFrom?.viz,gradientMode:h.gradientMode,thresholds:a.config.thresholds,hardMin:a.config.min,hardMax:a.config.max,softMin:h.axisSoftMin,softMax:h.axisSoftMax,dataFrameFieldIndex:a.state.origin})}return i},ft=e=>({...e,fields:e.fields.filter(t=>t.name!==f.dA)}),xt=(e,t)=>{for(let l=1;l<t.fields.length;l++){let o=t.fields[l].values;for(let i=0;i<o.length;i++)o[i]===0&&(o[i]=null)}return(0,X.bq)(t,e.getStackingGroups())};class yt extends b.Component{constructor(t){super(t),this.state=this.prepState(t)}prepState(t,l=!0){const{alignedFrame:o}=t,i=l?vt(o,this.props.theme):this.state.config,u=ft(o),c=xt(i,u);return{alignedFrame:o,alignedData:c,config:i,xMinOnlyFrame:u}}renderLegend(t){const{legend:l}=this.props;if(!t||l.showLegend===!1)return null;const o=this.props.options.combine?[this.props.alignedFrame]:this.props.rawSeries;return(0,y.jsx)(m.$,{data:o,config:t,maxHeight:"35%",maxWidth:"60%",...l})}componentDidUpdate(t){const{structureRev:l,alignedFrame:o,bucketSize:i,bucketCount:u}=this.props;if(o!==t.alignedFrame){const c=this.state.config==null||u!==t.bucketCount||i!==t.bucketSize||this.props.options!==t.options||this.state.config===void 0||l!==t.structureRev||!l,O=this.prepState(this.props,c);this.setState(O)}}render(){const{width:t,height:l,children:o,alignedFrame:i}=this.props,{config:u}=this.state;return u?(0,y.jsx)(_.KU,{width:t,height:l,legend:this.renderLegend(u),children:(c,O)=>(0,y.jsx)(V.Z,{config:this.state.config,data:this.state.alignedData,width:c,height:O,children:o?o(u,i,this.state.xMinOnlyFrame):null})}):null}}var Ct=n(53823),Mt=n(14411),Pt=n(33409),St=n(69921),Ot=n(37813),Et=n(69598),Tt=n(16725);const Dt=({series:e,xMinOnlyFrame:t,dataIdxs:l,seriesIdx:o,mode:i=s.$N.Single,sortOrder:u=s.xB.None,isPinned:c,maxHeight:O})=>{const M=e.fields[0],T=e.fields[1],{display:W}=M.config.unit!=null?M:T,{display:z}=T.config.unit!=null?T:M,Y=(0,r.cN)(W(M.values[l[0]])),tt=(0,r.cN)(z(T.values[l[1]])),et=M.config.custom?.hideFrom?.tooltip?null:{label:"Bucket",value:`${Y} - ${tt}`},it=(0,b.useMemo)(()=>(0,Ot.cp)(t.fields,M,l,o,i,u),[t.fields,M,l,o,i,u]);let nt;if(c&&o!=null){const at=e.fields[o],d=l[o],a=(0,Et.u6)(at,d);nt=(0,y.jsx)(Mt.S,{dataLinks:a})}return(0,y.jsxs)(St.i,{children:[et!=null&&(0,y.jsx)(Pt.A,{item:et,isPinned:c}),(0,y.jsx)(Ct.o,{items:it,isPinned:c,scrollable:(0,Tt.T5)({mode:i,maxHeight:O}),maxHeight:O}),nt]})},Ut=({data:e,options:t,width:l,height:o})=>{const i=(0,ot.$j)(),u=(0,b.useMemo)(()=>{if(!e.series.length)return;if(e.series.forEach((M,T)=>{M.fields.forEach((W,z)=>{W.state={...W.state,origin:{frameIndex:T,fieldIndex:z}}})}),(0,lt.Fm)(e.series),e.series.length===1){const M=(0,f.ix)(e.series[0]);if(M)return(0,f.cg)(M)}const O=(0,f.p3)(e.series,t);if(O)return(0,f.cg)(O,i)},[e.series,t,i]);if(!u||!u.fields.length)return(0,y.jsx)("div",{className:"panel-empty",children:(0,y.jsx)("p",{children:"No histogram found in response"})});const c=j(u);return(0,y.jsx)(yt,{options:t,theme:i,legend:t.legend,rawSeries:e.series,structureRev:e.structureRev,width:l,height:o,alignedFrame:u,bucketSize:c,bucketCount:t.bucketCount,children:(O,M,T)=>(0,y.jsx)(y.Fragment,{children:t.tooltip.mode!==s.$N.None&&(0,y.jsx)(p.xl,{config:O,hoverMode:t.tooltip.mode===s.$N.Single?p.b3.xOne:p.b3.xAll,render:(W,z,Y,tt=!1)=>(0,y.jsx)(Dt,{series:u,xMinOnlyFrame:T,dataIdxs:z,seriesIdx:Y,mode:t.tooltip.mode,sortOrder:t.tooltip.sort,isPinned:tt,maxHeight:t.tooltip.maxHeight}),maxWidth:t.tooltip.maxWidth})})})},gt={stacking:{mode:s.gs.None,group:"A"}};var mt=n(2543);const Ft=(e,t,l,o)=>{if(t==="graph"&&l.angular.xaxis?.mode==="histogram"){const{fieldConfig:u,options:c}=Lt({...l.angular,fieldConfig:o});return e.fieldConfig=u,c}return{}};function Lt(e){let t={};const l={legend:{displayMode:s.lm.List,showLegend:!0,placement:"bottom",calcs:[]},tooltip:{mode:s.$N.Single,sort:s.xB.None},combine:!1};return e.stack&&(t.stacking={mode:e.percentage?s.gs.Percent:s.gs.Normal,group:gt.stacking.group},l.combine=!1),{fieldConfig:{defaults:(0,mt.omitBy)({custom:t},mt.isNil),overrides:[]},options:l}}function H(e){if(e?.length!==1)return!1;const t=e[0];if(t.fields.length<3||!(0,f.NX)(t.fields[0].name)||!(0,f.H1)(t.fields[1].name))return!1;for(const l of t.fields)if(l.type!==U.PU.number)return!1;return!0}const Rt=new v.m(Ut).setPanelChangeHandler(Ft).setPanelOptions(e=>{e.addCustomEditor({id:"__calc__",path:"__calc__",name:"Values",description:"Showing frequencies that are calculated in the query",editor:()=>null,showIf:(t,l)=>H(l)}).addNumberInput({path:"bucketCount",name:f.Rt.bucketCount.name,description:f.Rt.bucketCount.description,settings:{placeholder:`Default: ${A.bucketCount}`,min:0},showIf:(t,l)=>!H(l)}).addNumberInput({path:"bucketSize",name:f.Rt.bucketSize.name,description:f.Rt.bucketSize.description,settings:{placeholder:"Auto",min:0},defaultValue:A.bucketSize,showIf:(t,l)=>!H(l)}).addNumberInput({path:"bucketOffset",name:f.Rt.bucketOffset.name,description:f.Rt.bucketOffset.description,settings:{placeholder:`Default: ${A.bucketOffset}`,min:0},showIf:(t,l)=>!H(l)}).addBooleanSwitch({path:"combine",name:f.Rt.combine.name,description:f.Rt.combine.description,defaultValue:A.combine,showIf:(t,l)=>!H(l)}),G.D(e),B.H(e)}).useFieldConfig({standardOptions:{[L.uo.Color]:{settings:{byValueSupport:!1,bySeriesSupport:!0,preferThresholdsMode:!1},defaultValue:{mode:$.Y.PaletteClassic}},[L.uo.Links]:{settings:{showOneClick:!0}}},useCustomConfig:e=>{const t=I;e.addCustomEditor({id:"stacking",path:"stacking",name:"Stacking",category:["Histogram"],defaultValue:gt.stacking,editor:q.m,override:q.m,settings:{options:J.t.stacking},process:R.hS,shouldApply:l=>l.type===U.PU.number,showIf:(l,o)=>!H(o)}).addSliderInput({path:"lineWidth",name:"Line width",defaultValue:t.lineWidth,settings:{min:0,max:10,step:1}}).addSliderInput({path:"fillOpacity",name:"Fill opacity",defaultValue:t.fillOpacity,settings:{min:0,max:100,step:1}}).addRadio({path:"gradientMode",name:"Gradient mode",defaultValue:J.t.fillGradient[0].value,settings:{options:J.t.fillGradient}}),st.e(e)}})},16725:(ct,N,n)=>{n.d(N,{B_:()=>q,Fg:()=>lt,O2:()=>b,T5:()=>ot});var v=n(63739),L=n(23570),$=n(59141),R=n(16869),U=n(17177),f=n(66380),G=n(54430),B=n(7500),J=n(24415);function st(s){let p=new Map;return s.map(C=>({...C,fields:C.fields.map(r=>{if(r.type===v.PU.enum){let x=(0,J.M)(r.config,r.type),g=p.get(x);g||(g=[],p.set(x,g));let S=r.values.toArray().slice(),D=r.config.type.enum.text;if(g.length>0)for(let m=0;m<S.length;m++)S[m]+=g.length;return g.push(...D),r.config.type.enum.text=g,{...r,values:S}}return r})}))}function q(s,p,P,C){if(!s?.length)return null;(0,L.Fm)(s);let r=C!=null;C!=null&&C>0&&(s=[{...s[0],fields:[s[0].fields[C],...s[0].fields.filter((D,m)=>m!==C)]}]);for(let D of s)for(let m of D.fields)m.type===v.PU.time&&typeof m.values[0]!="number"&&(m.values=(0,U.s7)(m,{destinationType:v.PU.time}).values);let x=0;t:for(let D of s)for(let m of D.fields)if(m.type===v.PU.enum&&++x>1){s=st(s);break t}let g;const S=[];for(let D of s){const m=[];let _=!1,V=!1,X=r?D:(0,f.M)({frame:D,refFieldPseudoMin:P?.from.valueOf(),refFieldPseudoMax:P?.to.valueOf()});const A=(0,G.C)(X).fields;for(let I=0;I<(A?.length||0);I++){const E=A[I];switch(E.type){case v.PU.time:_=!0,m.push(E);break;case v.PU.number:V=r?I>0:!0,g={...E,values:E.values.map(F=>Number.isFinite(F)||F==null?F:null)},m.push(g);break;case v.PU.enum:V=!0;case v.PU.string:g={...E,values:E.values},m.push(g);break;case v.PU.boolean:V=!0;const K=E.config?.custom??{},j={...E.config,max:1,min:0,custom:K};K.lineInterpolation!==B.dx.StepBefore&&(K.lineInterpolation=B.dx.StepAfter),g={...E,config:j,type:v.PU.number,values:E.values.map(F=>F==null?F:F?1:0)},(0,$.j9)(j.unit)||(j.unit="bool",g.display=(0,R.J)({field:g,theme:p})),m.push(g);break}}(r||_)&&V&&S.push({...D,length:X.length,fields:m})}return S.length?(b(S,p,0),y(S,p),S):null}const y=(s,p)=>{const{palette:P}=p.visualization;for(const C of s)for(const r of C.fields)if(r.type===v.PU.enum){const x=P[r.state?.seriesIndex%P.length],g=p.visualization.getColorByName(x),S=r.config.type.enum;S.color=Array(S.text.length).fill(g),r.display=(0,R.J)({field:r,theme:p})}},b=(s,p,P)=>{let C=0;s.forEach(r=>{r.fields.forEach((x,g)=>{g!==P&&(x.type===v.PU.number||x.type===v.PU.boolean||x.type===v.PU.enum)&&(x.state={...x.state,seriesIndex:C++},x.display=(0,R.J)({field:x,theme:p}))})})};function lt(s,p){return!s||!s.length?[p]:s.map(P=>P?.length?P:p)}const ot=s=>s.mode===B.$N.Multi&&s.maxHeight!=null}}]);

//# sourceMappingURL=histogramPanel.e6c21b63aebd1093fb29.js.map