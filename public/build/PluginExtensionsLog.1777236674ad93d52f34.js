"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[5902],{19040:(bt,ee,S)=>{S.r(ee),S.d(ee,{default:()=>yt});var P=S(74848),be=S(43561),y=S(96540),we=S(70713),b=S(61034),w=S(2543);function F(n,e,...t){let i=!1;typeof window<"u"&&(i=localStorage.getItem("grafana.debug.scenes")==="true"),i&&console.log(`${n}: `,e,...t)}var xe=Object.defineProperty,Ee=Object.defineProperties,Ce=Object.getOwnPropertyDescriptors,te=Object.getOwnPropertySymbols,Pe=Object.prototype.hasOwnProperty,Ie=Object.prototype.propertyIsEnumerable,ie=(n,e,t)=>e in n?xe(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Oe=(n,e)=>{for(var t in e||(e={}))Pe.call(e,t)&&ie(n,t,e[t]);if(te)for(var t of te(e))Ie.call(e,t)&&ie(n,t,e[t]);return n},Ae=(n,e)=>Ee(n,Ce(e));class ne extends b.Bs{constructor(e){var t,i;super(Ae(Oe({},e),{children:(t=e?.children)!=null?t:[],childContexts:(i=e?.childContexts)!=null?i:[]}))}addToScene(e){this.publishEvent(new b.sU(e),!0),this.setState({children:[...this.state.children,e]}),F("SceneContext",`Adding to scene: ${e.constructor.name} key: ${e.state.key}`);const t=e.activate();return()=>{F("SceneContext",`Removing from scene: ${e.constructor.name} key: ${e.state.key}`),this.setState({children:this.state.children.filter(i=>i!==e)}),t()}}findByKey(e){return this.state.children.find(t=>t.state.key===e)}findVariable(e){const t=this.state.$variables;if(t)return t.getByName(e)}addVariable(e){let t=this.state.$variables;return this.publishEvent(new b.sU(e),!0),t?t.setState({variables:[...t.state.variables,e]}):(t=new b.Pj({variables:[e]}),this.setState({$variables:t})),F("SceneContext",`Adding variable: ${e.constructor.name} key: ${e.state.key}`),()=>{t.setState({variables:t.state.variables.filter(i=>i!==e)}),F("SceneContext",`Removing variable: ${e.constructor.name} key: ${e.state.key}`)}}addChildContext(e){var t;this.publishEvent(new b.sU(e),!0),this.setState({childContexts:[...(t=this.state.childContexts)!=null?t:[],e]}),F("SceneContext",`Adding child context: ${e.constructor.name} key: ${e.state.key}`)}removeChildContext(e){var t;this.setState({childContexts:(t=this.state.childContexts)==null?void 0:t.filter(i=>e!==i)}),F("SceneContext",`Remvoing child context: ${e.constructor.name} key: ${e.state.key}`)}}const U=(0,y.createContext)(null);function Te({children:n,timeRange:e,withQueryController:t}){const i=(0,y.useContext)(U),[s,r]=(0,y.useState)(),a=e;if((0,y.useEffect)(()=>{const l={children:[]};t&&(l.$behaviors=[new b.Gg.Hf]),a&&(l.$timeRange=new b.JZ(a));const u=new ne(l);i&&i.addChildContext(u);const c=u.activate();return r(u),()=>{c(),i&&i.removeChildContext(u)}},[i,t]),!s)return null;const o=y.createElement(U.Provider,{value:s},n);return i?o:y.createElement(b.$L,{scene:s,updateUrlOnInit:!0,createBrowserHistorySteps:!0},o)}function R(){const n=(0,y.useContext)(U);if(!n)throw new Error("Cannot find a SceneContext");return n}function wt(){const n=R(),e=sceneGraph.getTimeRange(n),{value:t}=e.useState();return[t,e]}function xt(){const n=R();return sceneGraph.getVariables(n).useState().variables}function Fe({timeRange:n,variables:e=[]}){const t=R(),[i,s]=useState();return useEffect(()=>{const r=new Subscription;if(e&&e.length>0)for(const a of e){const o=sceneGraph.lookupVariable(a,t);o&&r.add(o.subscribeToEvent(SceneVariableValueChangedEvent,()=>{s({variableName:o.state.name,variableValue:o.getValue()})}))}return n&&sceneGraph.getTimeRange(t).subscribeToState((o,l)=>{o.value!==l.value&&s({timeRange:o.value})}),()=>r.unsubscribe()},[t,n,...e]),i}function Et(n){const e=R();return Fe(n),useCallback(t=>sceneGraph.interpolate(e,t),[e])}const z=typeof performance=="object"&&performance&&typeof performance.now=="function"?performance:Date,se=new Set,M=typeof process=="object"&&process?process:{},re=(n,e,t,i)=>{typeof M.emitWarning=="function"?M.emitWarning(n,e,t,i):console.error(`[${t}] ${e}: ${n}`)};let j=globalThis.AbortController,ae=globalThis.AbortSignal;if(typeof j>"u"){ae=class{onabort;_onabort=[];reason;aborted=!1;addEventListener(i,s){this._onabort.push(s)}},j=class{constructor(){e()}signal=new ae;abort(i){if(!this.signal.aborted){this.signal.reason=i,this.signal.aborted=!0;for(const s of this.signal._onabort)s(i);this.signal.onabort?.(i)}}};let n=M.env?.LRU_CACHE_IGNORE_AC_WARNING!=="1";const e=()=>{n&&(n=!1,re("AbortController is not defined. If using lru-cache in node 14, load an AbortController polyfill from the `node-abort-controller` package. A minimal polyfill is provided for use by LRUCache.fetch(), but it should not be relied upon in other contexts (eg, passing it to other APIs that use AbortController/AbortSignal might have undesirable effects). You may disable this with LRU_CACHE_IGNORE_AC_WARNING=1 in the env.","NO_ABORT_CONTROLLER","ENOTSUP",e))}}const Re=n=>!se.has(n),Ct=Symbol("type"),O=n=>n&&n===Math.floor(n)&&n>0&&isFinite(n),oe=n=>O(n)?n<=Math.pow(2,8)?Uint8Array:n<=Math.pow(2,16)?Uint16Array:n<=Math.pow(2,32)?Uint32Array:n<=Number.MAX_SAFE_INTEGER?$:null:null;class $ extends Array{constructor(e){super(e),this.fill(0)}}class L{heap;length;static#l=!1;static create(e){const t=oe(e);if(!t)return[];L.#l=!0;const i=new L(e,t);return L.#l=!1,i}constructor(e,t){if(!L.#l)throw new TypeError("instantiate Stack using Stack.create(n)");this.heap=new t(e),this.length=0}push(e){this.heap[this.length++]=e}pop(){return this.heap[--this.length]}}class H{#l;#u;#p;#m;#F;#R;ttl;ttlResolution;ttlAutopurge;updateAgeOnGet;updateAgeOnHas;allowStale;noDisposeOnSet;noUpdateTTL;maxEntrySize;sizeCalculation;noDeleteOnFetchRejection;noDeleteOnStaleGet;allowStaleOnFetchAbort;allowStaleOnFetchRejection;ignoreFetchAbort;#s;#v;#n;#i;#e;#c;#f;#o;#r;#y;#a;#S;#b;#d;#w;#I;#h;static unsafeExposeInternals(e){return{starts:e.#b,ttls:e.#d,sizes:e.#S,keyMap:e.#n,keyList:e.#i,valList:e.#e,next:e.#c,prev:e.#f,get head(){return e.#o},get tail(){return e.#r},free:e.#y,isBackgroundFetch:t=>e.#t(t),backgroundFetch:(t,i,s,r)=>e.#L(t,i,s,r),moveToTail:t=>e.#T(t),indexes:t=>e.#x(t),rindexes:t=>e.#E(t),isStale:t=>e.#g(t)}}get max(){return this.#l}get maxSize(){return this.#u}get calculatedSize(){return this.#v}get size(){return this.#s}get fetchMethod(){return this.#F}get memoMethod(){return this.#R}get dispose(){return this.#p}get disposeAfter(){return this.#m}constructor(e){const{max:t=0,ttl:i,ttlResolution:s=1,ttlAutopurge:r,updateAgeOnGet:a,updateAgeOnHas:o,allowStale:l,dispose:u,disposeAfter:c,noDisposeOnSet:h,noUpdateTTL:f,maxSize:m=0,maxEntrySize:I=0,sizeCalculation:d,fetchMethod:E,memoMethod:p,noDeleteOnFetchRejection:v,noDeleteOnStaleGet:x,allowStaleOnFetchRejection:g,allowStaleOnFetchAbort:C,ignoreFetchAbort:A}=e;if(t!==0&&!O(t))throw new TypeError("max option must be a nonnegative integer");const T=t?oe(t):Array;if(!T)throw new Error("invalid max value: "+t);if(this.#l=t,this.#u=m,this.maxEntrySize=I||this.#u,this.sizeCalculation=d,this.sizeCalculation){if(!this.#u&&!this.maxEntrySize)throw new TypeError("cannot set sizeCalculation without setting maxSize or maxEntrySize");if(typeof this.sizeCalculation!="function")throw new TypeError("sizeCalculation set to non-function")}if(p!==void 0&&typeof p!="function")throw new TypeError("memoMethod must be a function if defined");if(this.#R=p,E!==void 0&&typeof E!="function")throw new TypeError("fetchMethod must be a function if specified");if(this.#F=E,this.#I=!!E,this.#n=new Map,this.#i=new Array(t).fill(void 0),this.#e=new Array(t).fill(void 0),this.#c=new T(t),this.#f=new T(t),this.#o=0,this.#r=0,this.#y=L.create(t),this.#s=0,this.#v=0,typeof u=="function"&&(this.#p=u),typeof c=="function"?(this.#m=c,this.#a=[]):(this.#m=void 0,this.#a=void 0),this.#w=!!this.#p,this.#h=!!this.#m,this.noDisposeOnSet=!!h,this.noUpdateTTL=!!f,this.noDeleteOnFetchRejection=!!v,this.allowStaleOnFetchRejection=!!g,this.allowStaleOnFetchAbort=!!C,this.ignoreFetchAbort=!!A,this.maxEntrySize!==0){if(this.#u!==0&&!O(this.#u))throw new TypeError("maxSize must be a positive integer if specified");if(!O(this.maxEntrySize))throw new TypeError("maxEntrySize must be a positive integer if specified");this.#k()}if(this.allowStale=!!l,this.noDeleteOnStaleGet=!!x,this.updateAgeOnGet=!!a,this.updateAgeOnHas=!!o,this.ttlResolution=O(s)||s===0?s:1,this.ttlAutopurge=!!r,this.ttl=i||0,this.ttl){if(!O(this.ttl))throw new TypeError("ttl must be a positive integer if specified");this.#_()}if(this.#l===0&&this.ttl===0&&this.#u===0)throw new TypeError("At least one of max, maxSize, or ttl is required");if(!this.ttlAutopurge&&!this.#l&&!this.#u){const G="LRU_CACHE_UNBOUNDED";Re(G)&&(se.add(G),re("TTL caching without ttlAutopurge, max, or maxSize can result in unbounded memory consumption.","UnboundedCacheWarning",G,H))}}getRemainingTTL(e){return this.#n.has(e)?1/0:0}#_(){const e=new $(this.#l),t=new $(this.#l);this.#d=e,this.#b=t,this.#W=(r,a,o=z.now())=>{if(t[r]=a!==0?o:0,e[r]=a,a!==0&&this.ttlAutopurge){const l=setTimeout(()=>{this.#g(r)&&this.#C(this.#i[r],"expire")},a+1);l.unref&&l.unref()}},this.#O=r=>{t[r]=e[r]!==0?z.now():0},this.#P=(r,a)=>{if(e[a]){const o=e[a],l=t[a];if(!o||!l)return;r.ttl=o,r.start=l,r.now=i||s();const u=r.now-l;r.remainingTTL=o-u}};let i=0;const s=()=>{const r=z.now();if(this.ttlResolution>0){i=r;const a=setTimeout(()=>i=0,this.ttlResolution);a.unref&&a.unref()}return r};this.getRemainingTTL=r=>{const a=this.#n.get(r);if(a===void 0)return 0;const o=e[a],l=t[a];if(!o||!l)return 1/0;const u=(i||s())-l;return o-u},this.#g=r=>{const a=t[r],o=e[r];return!!o&&!!a&&(i||s())-a>o}}#O=()=>{};#P=()=>{};#W=()=>{};#g=()=>!1;#k(){const e=new $(this.#l);this.#v=0,this.#S=e,this.#A=t=>{this.#v-=e[t],e[t]=0},this.#D=(t,i,s,r)=>{if(this.#t(i))return 0;if(!O(s))if(r){if(typeof r!="function")throw new TypeError("sizeCalculation must be a function");if(s=r(i,t),!O(s))throw new TypeError("sizeCalculation return invalid (expect positive integer)")}else throw new TypeError("invalid size value (must be positive integer). When maxSize or maxEntrySize is used, sizeCalculation or size must be set.");return s},this.#V=(t,i,s)=>{if(e[t]=i,this.#u){const r=this.#u-e[t];for(;this.#v>r;)this.#z(!0)}this.#v+=e[t],s&&(s.entrySize=i,s.totalCalculatedSize=this.#v)}}#A=e=>{};#V=(e,t,i)=>{};#D=(e,t,i,s)=>{if(i||s)throw new TypeError("cannot set size without setting maxSize or maxEntrySize on cache");return 0};*#x({allowStale:e=this.allowStale}={}){if(this.#s)for(let t=this.#r;!(!this.#U(t)||((e||!this.#g(t))&&(yield t),t===this.#o));)t=this.#f[t]}*#E({allowStale:e=this.allowStale}={}){if(this.#s)for(let t=this.#o;!(!this.#U(t)||((e||!this.#g(t))&&(yield t),t===this.#r));)t=this.#c[t]}#U(e){return e!==void 0&&this.#n.get(this.#i[e])===e}*entries(){for(const e of this.#x())this.#e[e]!==void 0&&this.#i[e]!==void 0&&!this.#t(this.#e[e])&&(yield[this.#i[e],this.#e[e]])}*rentries(){for(const e of this.#E())this.#e[e]!==void 0&&this.#i[e]!==void 0&&!this.#t(this.#e[e])&&(yield[this.#i[e],this.#e[e]])}*keys(){for(const e of this.#x()){const t=this.#i[e];t!==void 0&&!this.#t(this.#e[e])&&(yield t)}}*rkeys(){for(const e of this.#E()){const t=this.#i[e];t!==void 0&&!this.#t(this.#e[e])&&(yield t)}}*values(){for(const e of this.#x())this.#e[e]!==void 0&&!this.#t(this.#e[e])&&(yield this.#e[e])}*rvalues(){for(const e of this.#E())this.#e[e]!==void 0&&!this.#t(this.#e[e])&&(yield this.#e[e])}[Symbol.iterator](){return this.entries()}[Symbol.toStringTag]="LRUCache";find(e,t={}){for(const i of this.#x()){const s=this.#e[i],r=this.#t(s)?s.__staleWhileFetching:s;if(r!==void 0&&e(r,this.#i[i],this))return this.get(this.#i[i],t)}}forEach(e,t=this){for(const i of this.#x()){const s=this.#e[i],r=this.#t(s)?s.__staleWhileFetching:s;r!==void 0&&e.call(t,r,this.#i[i],this)}}rforEach(e,t=this){for(const i of this.#E()){const s=this.#e[i],r=this.#t(s)?s.__staleWhileFetching:s;r!==void 0&&e.call(t,r,this.#i[i],this)}}purgeStale(){let e=!1;for(const t of this.#E({allowStale:!0}))this.#g(t)&&(this.#C(this.#i[t],"expire"),e=!0);return e}info(e){const t=this.#n.get(e);if(t===void 0)return;const i=this.#e[t],s=this.#t(i)?i.__staleWhileFetching:i;if(s===void 0)return;const r={value:s};if(this.#d&&this.#b){const a=this.#d[t],o=this.#b[t];if(a&&o){const l=a-(z.now()-o);r.ttl=l,r.start=Date.now()}}return this.#S&&(r.size=this.#S[t]),r}dump(){const e=[];for(const t of this.#x({allowStale:!0})){const i=this.#i[t],s=this.#e[t],r=this.#t(s)?s.__staleWhileFetching:s;if(r===void 0||i===void 0)continue;const a={value:r};if(this.#d&&this.#b){a.ttl=this.#d[t];const o=z.now()-this.#b[t];a.start=Math.floor(Date.now()-o)}this.#S&&(a.size=this.#S[t]),e.unshift([i,a])}return e}load(e){this.clear();for(const[t,i]of e){if(i.start){const s=Date.now()-i.start;i.start=z.now()-s}this.set(t,i.value,i)}}set(e,t,i={}){if(t===void 0)return this.delete(e),this;const{ttl:s=this.ttl,start:r,noDisposeOnSet:a=this.noDisposeOnSet,sizeCalculation:o=this.sizeCalculation,status:l}=i;let{noUpdateTTL:u=this.noUpdateTTL}=i;const c=this.#D(e,t,i.size||0,o);if(this.maxEntrySize&&c>this.maxEntrySize)return l&&(l.set="miss",l.maxEntrySizeExceeded=!0),this.#C(e,"set"),this;let h=this.#s===0?void 0:this.#n.get(e);if(h===void 0)h=this.#s===0?this.#r:this.#y.length!==0?this.#y.pop():this.#s===this.#l?this.#z(!1):this.#s,this.#i[h]=e,this.#e[h]=t,this.#n.set(e,h),this.#c[this.#r]=h,this.#f[h]=this.#r,this.#r=h,this.#s++,this.#V(h,c,l),l&&(l.set="add"),u=!1;else{this.#T(h);const f=this.#e[h];if(t!==f){if(this.#I&&this.#t(f)){f.__abortController.abort(new Error("replaced"));const{__staleWhileFetching:m}=f;m!==void 0&&!a&&(this.#w&&this.#p?.(m,e,"set"),this.#h&&this.#a?.push([m,e,"set"]))}else a||(this.#w&&this.#p?.(f,e,"set"),this.#h&&this.#a?.push([f,e,"set"]));if(this.#A(h),this.#V(h,c,l),this.#e[h]=t,l){l.set="replace";const m=f&&this.#t(f)?f.__staleWhileFetching:f;m!==void 0&&(l.oldValue=m)}}else l&&(l.set="update")}if(s!==0&&!this.#d&&this.#_(),this.#d&&(u||this.#W(h,s,r),l&&this.#P(l,h)),!a&&this.#h&&this.#a){const f=this.#a;let m;for(;m=f?.shift();)this.#m?.(...m)}return this}pop(){try{for(;this.#s;){const e=this.#e[this.#o];if(this.#z(!0),this.#t(e)){if(e.__staleWhileFetching)return e.__staleWhileFetching}else if(e!==void 0)return e}}finally{if(this.#h&&this.#a){const e=this.#a;let t;for(;t=e?.shift();)this.#m?.(...t)}}}#z(e){const t=this.#o,i=this.#i[t],s=this.#e[t];return this.#I&&this.#t(s)?s.__abortController.abort(new Error("evicted")):(this.#w||this.#h)&&(this.#w&&this.#p?.(s,i,"evict"),this.#h&&this.#a?.push([s,i,"evict"])),this.#A(t),e&&(this.#i[t]=void 0,this.#e[t]=void 0,this.#y.push(t)),this.#s===1?(this.#o=this.#r=0,this.#y.length=0):this.#o=this.#c[t],this.#n.delete(i),this.#s--,t}has(e,t={}){const{updateAgeOnHas:i=this.updateAgeOnHas,status:s}=t,r=this.#n.get(e);if(r!==void 0){const a=this.#e[r];if(this.#t(a)&&a.__staleWhileFetching===void 0)return!1;if(this.#g(r))s&&(s.has="stale",this.#P(s,r));else return i&&this.#O(r),s&&(s.has="hit",this.#P(s,r)),!0}else s&&(s.has="miss");return!1}peek(e,t={}){const{allowStale:i=this.allowStale}=t,s=this.#n.get(e);if(s===void 0||!i&&this.#g(s))return;const r=this.#e[s];return this.#t(r)?r.__staleWhileFetching:r}#L(e,t,i,s){const r=t===void 0?void 0:this.#e[t];if(this.#t(r))return r;const a=new j,{signal:o}=i;o?.addEventListener("abort",()=>a.abort(o.reason),{signal:a.signal});const l={signal:a.signal,options:i,context:s},u=(d,E=!1)=>{const{aborted:p}=a.signal,v=i.ignoreFetchAbort&&d!==void 0;if(i.status&&(p&&!E?(i.status.fetchAborted=!0,i.status.fetchError=a.signal.reason,v&&(i.status.fetchAbortIgnored=!0)):i.status.fetchResolved=!0),p&&!v&&!E)return h(a.signal.reason);const x=m;return this.#e[t]===m&&(d===void 0?x.__staleWhileFetching?this.#e[t]=x.__staleWhileFetching:this.#C(e,"fetch"):(i.status&&(i.status.fetchUpdated=!0),this.set(e,d,l.options))),d},c=d=>(i.status&&(i.status.fetchRejected=!0,i.status.fetchError=d),h(d)),h=d=>{const{aborted:E}=a.signal,p=E&&i.allowStaleOnFetchAbort,v=p||i.allowStaleOnFetchRejection,x=v||i.noDeleteOnFetchRejection,g=m;if(this.#e[t]===m&&(!x||g.__staleWhileFetching===void 0?this.#C(e,"fetch"):p||(this.#e[t]=g.__staleWhileFetching)),v)return i.status&&g.__staleWhileFetching!==void 0&&(i.status.returnedStale=!0),g.__staleWhileFetching;if(g.__returned===g)throw d},f=(d,E)=>{const p=this.#F?.(e,r,l);p&&p instanceof Promise&&p.then(v=>d(v===void 0?void 0:v),E),a.signal.addEventListener("abort",()=>{(!i.ignoreFetchAbort||i.allowStaleOnFetchAbort)&&(d(void 0),i.allowStaleOnFetchAbort&&(d=v=>u(v,!0)))})};i.status&&(i.status.fetchDispatched=!0);const m=new Promise(f).then(u,c),I=Object.assign(m,{__abortController:a,__staleWhileFetching:r,__returned:void 0});return t===void 0?(this.set(e,I,{...l.options,status:void 0}),t=this.#n.get(e)):this.#e[t]=I,I}#t(e){if(!this.#I)return!1;const t=e;return!!t&&t instanceof Promise&&t.hasOwnProperty("__staleWhileFetching")&&t.__abortController instanceof j}async fetch(e,t={}){const{allowStale:i=this.allowStale,updateAgeOnGet:s=this.updateAgeOnGet,noDeleteOnStaleGet:r=this.noDeleteOnStaleGet,ttl:a=this.ttl,noDisposeOnSet:o=this.noDisposeOnSet,size:l=0,sizeCalculation:u=this.sizeCalculation,noUpdateTTL:c=this.noUpdateTTL,noDeleteOnFetchRejection:h=this.noDeleteOnFetchRejection,allowStaleOnFetchRejection:f=this.allowStaleOnFetchRejection,ignoreFetchAbort:m=this.ignoreFetchAbort,allowStaleOnFetchAbort:I=this.allowStaleOnFetchAbort,context:d,forceRefresh:E=!1,status:p,signal:v}=t;if(!this.#I)return p&&(p.fetch="get"),this.get(e,{allowStale:i,updateAgeOnGet:s,noDeleteOnStaleGet:r,status:p});const x={allowStale:i,updateAgeOnGet:s,noDeleteOnStaleGet:r,ttl:a,noDisposeOnSet:o,size:l,sizeCalculation:u,noUpdateTTL:c,noDeleteOnFetchRejection:h,allowStaleOnFetchRejection:f,allowStaleOnFetchAbort:I,ignoreFetchAbort:m,status:p,signal:v};let g=this.#n.get(e);if(g===void 0){p&&(p.fetch="miss");const C=this.#L(e,g,x,d);return C.__returned=C}else{const C=this.#e[g];if(this.#t(C)){const Se=i&&C.__staleWhileFetching!==void 0;return p&&(p.fetch="inflight",Se&&(p.returnedStale=!0)),Se?C.__staleWhileFetching:C.__returned=C}const A=this.#g(g);if(!E&&!A)return p&&(p.fetch="hit"),this.#T(g),s&&this.#O(g),p&&this.#P(p,g),C;const T=this.#L(e,g,x,d),X=T.__staleWhileFetching!==void 0&&i;return p&&(p.fetch=A?"stale":"refresh",X&&A&&(p.returnedStale=!0)),X?T.__staleWhileFetching:T.__returned=T}}async forceFetch(e,t={}){const i=await this.fetch(e,t);if(i===void 0)throw new Error("fetch() returned undefined");return i}memo(e,t={}){const i=this.#R;if(!i)throw new Error("no memoMethod provided to constructor");const{context:s,forceRefresh:r,...a}=t,o=this.get(e,a);if(!r&&o!==void 0)return o;const l=i(e,o,{options:a,context:s});return this.set(e,l,a),l}get(e,t={}){const{allowStale:i=this.allowStale,updateAgeOnGet:s=this.updateAgeOnGet,noDeleteOnStaleGet:r=this.noDeleteOnStaleGet,status:a}=t,o=this.#n.get(e);if(o!==void 0){const l=this.#e[o],u=this.#t(l);return a&&this.#P(a,o),this.#g(o)?(a&&(a.get="stale"),u?(a&&i&&l.__staleWhileFetching!==void 0&&(a.returnedStale=!0),i?l.__staleWhileFetching:void 0):(r||this.#C(e,"expire"),a&&i&&(a.returnedStale=!0),i?l:void 0)):(a&&(a.get="hit"),u?l.__staleWhileFetching:(this.#T(o),s&&this.#O(o),l))}else a&&(a.get="miss")}#j(e,t){this.#f[t]=e,this.#c[e]=t}#T(e){e!==this.#r&&(e===this.#o?this.#o=this.#c[e]:this.#j(this.#f[e],this.#c[e]),this.#j(this.#r,e),this.#r=e)}delete(e){return this.#C(e,"delete")}#C(e,t){let i=!1;if(this.#s!==0){const s=this.#n.get(e);if(s!==void 0)if(i=!0,this.#s===1)this.#$(t);else{this.#A(s);const r=this.#e[s];if(this.#t(r)?r.__abortController.abort(new Error("deleted")):(this.#w||this.#h)&&(this.#w&&this.#p?.(r,e,t),this.#h&&this.#a?.push([r,e,t])),this.#n.delete(e),this.#i[s]=void 0,this.#e[s]=void 0,s===this.#r)this.#r=this.#f[s];else if(s===this.#o)this.#o=this.#c[s];else{const a=this.#f[s];this.#c[a]=this.#c[s];const o=this.#c[s];this.#f[o]=this.#f[s]}this.#s--,this.#y.push(s)}}if(this.#h&&this.#a?.length){const s=this.#a;let r;for(;r=s?.shift();)this.#m?.(...r)}return i}clear(){return this.#$("delete")}#$(e){for(const t of this.#E({allowStale:!0})){const i=this.#e[t];if(this.#t(i))i.__abortController.abort(new Error("deleted"));else{const s=this.#i[t];this.#w&&this.#p?.(i,s,e),this.#h&&this.#a?.push([i,s,e])}}if(this.#n.clear(),this.#e.fill(void 0),this.#i.fill(void 0),this.#d&&this.#b&&(this.#d.fill(0),this.#b.fill(0)),this.#S&&this.#S.fill(0),this.#o=0,this.#r=0,this.#y.length=0,this.#v=0,this.#s=0,this.#h&&this.#a){const t=this.#a;let i;for(;i=t?.shift();)this.#m?.(...i)}}}var le=(n,e,t)=>{if(!e.has(n))throw TypeError("Cannot "+t)},_=(n,e,t)=>(le(n,e,"read from private field"),t?t.call(n):e.get(n)),B=(n,e,t)=>{if(e.has(n))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(n):e.set(n,t)},ce=(n,e,t,i)=>(le(n,e,"write to private field"),i?i.call(n,t):e.set(n,t),t),Ve=(n,e,t,i)=>({set _(s){ce(n,e,s,t)},get _(){return _(n,e,i)}}),W,k,N;class ze{constructor(){B(this,W,void 0),B(this,k,new WeakMap),B(this,N,0),ce(this,W,new H({max:500,ttl:1e3*60*5}))}add(e,t){_(this,W).set(e,t)}get(e){return _(this,W).get(e)}getHashKey(e,t){return Array.isArray(e)?`${t.name}-${e.map(i=>this.getHashKeyElement(i)).join()}`:`${t.name}-${this.getHashKeyElement(e)}`}getByRefHashKey(e){let t=_(this,k).get(e);return t==null&&(t=Ve(this,N)._++,_(this,k).set(e,t)),t}getHashKeyElement(e){return typeof e=="string"||typeof e=="boolean"||typeof e=="number"?e:_e(e)}}W=new WeakMap,k=new WeakMap,N=new WeakMap;let K;function Le(){return K||(K=new ze)}function _e(n){return JSON.stringify(n,(e,t)=>(0,w.isPlainObject)(t)?Object.keys(t).sort().reduce((i,s)=>(i[s]=t[s],i),{}):t)}function We(n){const e=R(),t=(0,y.useId)(),i=Le();let s=n.cacheKey?i.getHashKey(n.cacheKey,n.objectConstructor):void 0,r=e.findByKey(t);return!r&&s&&(r=i.get(s),r&&r.parent!==e&&(b.jh.findObject(e,a=>a===r)?(console.error("A scene object cache key matched an object that is already in the scene"),r=void 0,s=void 0):r.clearParent())),r||(r=n.factory(t),s&&i.add(s,r)),(0,y.useEffect)(()=>e.addToScene(r),[r,e]),r}function De(n){const e=We({factory:t=>new b.dt({key:t,queries:n.queries,maxDataPoints:n.maxDataPoints,datasource:n.datasource,liveStreaming:n.liveStreaming,maxDataPointsFromWidth:n.maxDataPointsFromWidth}),objectConstructor:b.dt,cacheKey:n.cacheKey});return(0,y.useEffect)(()=>{(0,w.isEqual)(e.state.queries,n.queries)||(e.setState({queries:n.queries}),e.runQueries())},[e,n]),e}function Ue(n){const e=R(),t=(0,y.useId)();let i=e.findByKey(t);return i||(i=new b.Es({key:t,$data:new b.wT({source:n.data.getRef()}),transformations:n.transformations})),(0,y.useEffect)(()=>e.addToScene(i),[i,e]),(0,y.useEffect)(()=>{(0,w.isEqual)(i.state.transformations,n.transformations)||(i.setState({transformations:n.transformations}),i.reprocessTransformations())},[i,n.transformations]),i}function Pt(n){const[e,t]=useTimeRange();return React.createElement(TimeRangePicker$1,{isOnCanvas:!0,value:e,onChange:t.onTimeRangeChange,timeZone:t.getTimeZone(),onMoveBackward:()=>{},onMoveForward:()=>{},onZoom:()=>{},onChangeTimeZone:()=>{},onChangeFiscalYearStartMonth:()=>{}})}function It({name:n,hideLabel:e,layout:t}){const i=useSceneContext(),s=sceneGraph.lookupVariable(n,i);return s?React.createElement(VariableValueSelectWrapper,{key:s.state.key,variable:s,hideLabel:e,layout:t}):React.createElement("div",null,"Variable ",n," not found")}var je=S(84596),$e=S(27999);function ke(n){const{title:e,description:t,viz:i,dataProvider:s,displayMode:r,hoverHeader:a,hoverHeaderOffset:o,headerActions:l,menu:u,titleItems:c,extendPanelContext:h,seriesLimit:f,seriesLimitShowAll:m,collapsible:I,collapsed:d}=n,E=R(),p=(0,y.useId)(),v=(0,je.A)(n);let x=E.findByKey(p);return x||(x=new b.Eb({key:p,pluginId:i.pluginId,title:e,titleItems:c,description:t,options:i.options,fieldConfig:i.fieldConfig,pluginVersion:i.pluginVersion,$data:he(s),displayMode:r,hoverHeader:a,hoverHeaderOffset:o,headerActions:l,menu:u,extendPanelContext:h,collapsible:I,collapsed:d,seriesLimit:f,seriesLimitShowAll:m})),(0,y.useEffect)(()=>E.addToScene(x),[x,E]),(0,y.useEffect)(()=>{const g={};if(v){if(e!==v.title&&(g.title=e),t!==v.description&&(g.description=t),r!==v.displayMode&&(g.displayMode=r),a!==v.hoverHeader&&(g.hoverHeader=a),o!==v.hoverHeaderOffset&&(g.hoverHeaderOffset=o),u!==v.menu&&(g.menu=u),c!==v.titleItems&&(g.titleItems=c),l!==v.headerActions&&(g.headerActions=l),s!==v.dataProvider&&(g.$data=he(s)),f!==v.seriesLimit&&(g.seriesLimit=f),m!==v.seriesLimitShowAll&&(g.seriesLimitShowAll=m),I!==v.collapsible&&(g.collapsible=I),d!==v.collapsed&&(g.collapsed=d),i!==v.viz&&i.pluginId===v.viz.pluginId){const C=x.getPlugin();if(C){const A=(0,$e.F)({plugin:C,currentOptions:i.options,currentFieldConfig:i.fieldConfig,isAfterPluginChange:!1});g.options=A.options,g.fieldConfig=A.fieldConfig,x.clearFieldConfigCache()}}Object.keys(g).length>0&&(x.setState(g),F("VizPanel","Updating VizPanel state",g))}},[x,e,t,r,a,o,l,u,c,i,s,f,m,I,d,v]),y.createElement(x.Component,{model:x})}function he(n){return n&&!(n instanceof b.Zv)?new b.wT({source:n.getRef()}):n}var Ge=Object.defineProperty,ue=Object.getOwnPropertySymbols,Me=Object.prototype.hasOwnProperty,He=Object.prototype.propertyIsEnumerable,fe=(n,e,t)=>e in n?Ge(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Be=(n,e)=>{for(var t in e||(e={}))Me.call(e,t)&&fe(n,t,e[t]);if(ue)for(var t of ue(e))He.call(e,t)&&fe(n,t,e[t]);return n};function Ot(n){const e=useSceneContext(),t=useId(),i=usePrevious(n);let s=e.findByKey(t);return s||(s=new SceneRefreshPicker(Be({key:t},n))),useEffect(()=>e.addToScene(s),[s,e]),useEffect(()=>{const r={};i&&(n.refresh!==i.refresh&&(r.refresh=n.refresh),n.withText!==i.withText&&(r.withText=n.withText),s.setState(r))},[s,n,i]),React.createElement(s.Component,{model:s})}function At({name:n}){const e=useSceneContext(),t=sceneGraph.getDataLayers(e),i=Ne(t,n);return i?React.createElement(i.Component,{model:i}):React.createElement("div",null,"Annotation ",n," not found")}function Ne(n,e){for(let t=0;t<n.length;t++){const i=n[t].state.layers.find(s=>s.state.name===e);if(i)return i}}function Tt({query:n,name:e,label:t,hide:i,initialValue:s,isMulti:r,includeAll:a,children:o}){const l=useSceneContext(),[u,c]=useState();let h=l.findVariable(e);return h||(h=new CustomVariable$1({name:e,label:t,query:n,value:s,isMulti:r,includeAll:a,hide:i})),useEffect(()=>{const f=l.addVariable(h);return c(!0),f},[h,l,e]),useEffect(()=>{h?.setState({label:t,query:n,hide:i,isMulti:r,includeAll:a})},[i,a,r,t,n,h]),u?o:null}function Ft({pluginId:n,regex:e,name:t,label:i,hide:s,initialValue:r,isMulti:a,includeAll:o,children:l}){const u=useSceneContext(),[c,h]=useState();let f=u.findVariable(t);return f||(f=new DataSourceVariable$1({pluginId:n,regex:e,name:t,label:i,value:r,isMulti:a,hide:s,includeAll:o})),useEffect(()=>{const m=u.addVariable(f);return h(!0),m},[f,u,t]),useEffect(()=>{c&&(f.state.pluginId===n&&f.state.regex===e&&f.state.label===i&&f.state.hide===s&&f.state.includeAll===o||(f.setState({pluginId:n,regex:e,label:i,hide:s,includeAll:o}),f.refreshOptions()))},[s,o,i,n,e,f,c]),c?l:null}function Rt({query:n,name:e,datasource:t,label:i,hide:s,regex:r,refresh:a,sort:o,initialValue:l,isMulti:u,includeAll:c,children:h}){const f=useSceneContext(),[m,I]=useState();let d=f.findVariable(e);return d||(d=new QueryVariable$1({name:e,label:i,query:n,datasource:t,refresh:a,sort:o,regex:r,value:l,isMulti:u,hide:s,includeAll:c})),useEffect(()=>{const E=f.addVariable(d);return I(!0),E},[d,f,e]),useEffect(()=>{m&&(isEqual(d.state.query,n)&&isEqual(d.state.datasource,t)&&d.state.regex===r&&d.state.label===i&&d.state.hide===s&&d.state.includeAll===c&&d.state.refresh===a&&d.state.sort===o||(d.setState({label:i,query:n,datasource:t,refresh:a,sort:o,regex:r,hide:s,includeAll:c}),d.refreshOptions()))},[t,s,c,i,n,a,r,o,d,m]),m?h:null}const de=(0,y.createContext)({breadcrumbs:[],addBreadcrumb:()=>{},removeBreadcrumb:()=>{}});function Vt({children:n}){const[e,t]=useState([]);return React.createElement(de.Provider,{value:{breadcrumbs:e,addBreadcrumb:useCallback(i=>t(s=>[...s,i]),[]),removeBreadcrumb:useCallback(i=>t(s=>s.filter(r=>r.url!==i.url)),[])}},n)}function zt({text:n,path:e,extraKeys:t}){const{addBreadcrumb:i,removeBreadcrumb:s}=useContext(de),r=Ke();return useEffect(()=>{const a={text:n,url:r(e,t)};return i(a),()=>{s(a)}},[n,e,t,i,r,s]),null}function Ke(){const n=Qe()[0],e=useVariables(),[t,i]=useTimeRange();return useCallback((s,r)=>{const a={};for(const o of e)if(o.urlSync&&!o.state.skipUrlSync){const l=o.urlSync.getUrlState();Object.assign(a,l)}if(i.urlSync){const o=i.urlSync.getUrlState();Object.assign(a,o)}if(r)for(const o of r)n[o]&&(a[o]=n[o]);return urlUtil.renderUrl(s,a)},[e,n,i])}function Qe(){const{search:n}=useLocation(),e=useMemo(()=>locationSearchToObject(n||""),[n]),t=useCallback((i,s)=>locationService.partial(i,s),[]);return[e,t]}function Lt(n){const e=useSceneContext(),t=sceneGraph.lookupVariable(n,e);if(!t)return[void 0,!1];t.useState();const s=t.parent.isVariableLoadingOrWaitingToUpdate(t);let r=t.getValue();return r==null?[void 0,s]:(Array.isArray(r)||(r=[r]),[r,s])}function _t(n){const e=useSceneContext();let t=sceneGraph.lookupVariable(n.name,e);return t||(t=new QueryVariable({name:n.name,datasource:{uid:n.datasource},query:n.query,regex:n.regex})),t instanceof QueryVariable||(t=null),useEffect(()=>{t&&e.addVariable(t)},[t,e]),useEffect(()=>{var i;(((i=t?.state.datasource)==null?void 0:i.uid)!==n.datasource||!isEqual(t?.state.query,n.query)||t?.state.regex!==n.regex)&&(t?.setState({datasource:{uid:n.datasource},query:n.query,regex:n.regex}),t?.refreshOptions())},[n,t]),t}function Wt(n){const e=useSceneContext(),t=sceneGraph.lookupVariable(n,e);if(!t||t instanceof MultiValueVariable&&t.state.isMulti===!0)return[void 0,!1];t.useState();const s=t.parent.isVariableLoadingOrWaitingToUpdate(t);let r=t.getValue();return r==null?[void 0,s]:[r,s]}function Dt({name:n,query:e,children:t}){const i=useSceneContext(),[s,r]=useState();let a=Ze(i,n);return a||(a=new dataLayers.AnnotationsDataLayer({name:n,query:e})),useEffect(()=>{const o=Ye(i,a);return r(!0),o},[i,n,a]),useEffect(()=>{},[s]),s?t:null}function Ze(n,e){const t=n.state.$data;if(t)return t.state.layers.find(i=>i.state.name===e)}function Ye(n,e){let t=n.state.$data;return t?t.setState({layers:[...t.state.layers,e]}):(t=new SceneDataLayerSet({layers:[e]}),n.setState({$data:t})),writeSceneLog("SceneContext",`Adding annotation data layer: ${e.state.name} key: ${e.state.key}`),()=>{t.setState({layers:t.state.layers.filter(i=>i!==e)}),writeSceneLog("SceneContext",`Removing annotation data layer: ${e.state.name} key: ${e.state.key}`)}}var qe=Object.defineProperty,Je=Object.defineProperties,Xe=Object.getOwnPropertyDescriptors,ge=Object.getOwnPropertySymbols,et=Object.prototype.hasOwnProperty,tt=Object.prototype.propertyIsEnumerable,pe=(n,e,t)=>e in n?qe(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,it=(n,e)=>{for(var t in e||(e={}))et.call(e,t)&&pe(n,t,e[t]);if(ge)for(var t of ge(e))tt.call(e,t)&&pe(n,t,e[t]);return n},nt=(n,e)=>Je(n,Xe(e));class st extends b.P1{constructor(e){super(nt(it({},e),{context:new ne}))}}st.Component=({model:n})=>y.createElement(U.Provider,{value:n.state.context},y.createElement(b.P1.Component,{model:n}));var rt=S(29675);function at({children:n,minWidth:e=400,minHeight:t=320}){const i=(0,rt.$j)(),s={display:"grid",flexGrow:1,gridTemplateColumns:`repeat(auto-fit, minmax(${e}px, 1fr))`,gridAutoRows:`minmax(${t}px, auto)`,columnGap:i.spacing(1),rowGap:i.spacing(1)};return y.createElement("div",{style:s},n)}var ot=S(54122),lt=S(77222),Q=S(60484),Z=S(44826);function ct({provider:n,filteredProvider:e,filter:t,onChange:i}){const{pluginIds:s,extensionPointIds:r,severity:a}=ht(n,e,t),o=c=>{const h={...t,pluginIds:Y(c)};(0,w.isEmpty)(t.extensionPointIds)&&(0,w.isEmpty)(t.severity)&&(h.initial=(0,w.isEmpty)(c)?void 0:"pluginId"),i(h)},l=c=>{const h={...t,extensionPointIds:Y(c)};(0,w.isEmpty)(t.pluginIds)&&(0,w.isEmpty)(t.severity)&&(h.initial=(0,w.isEmpty)(c)?void 0:"extensionPointId"),i(h)},u=c=>{const h={...t,severity:Y(c)};(0,w.isEmpty)(t.pluginIds)&&(0,w.isEmpty)(t.extensionPointIds)&&(h.initial=(0,w.isEmpty)(c)?void 0:"severity"),i(h)};return(0,P.jsxs)(lt.C,{children:[(0,P.jsx)(Q.I,{label:"Plugin Id",children:(0,P.jsx)(Z.KF,{options:s,onChange:o})}),(0,P.jsx)(Q.I,{label:"Extension",children:(0,P.jsx)(Z.KF,{options:r,onChange:l})}),(0,P.jsx)(Q.I,{label:"Severity",children:(0,P.jsx)(Z.KF,{options:a,onChange:u})})]})}function ht(n,e,t){const{data:i}=n.useState(),{data:s}=e.useState();return(0,y.useMemo)(()=>{i&&i?.series.length>1&&console.warn("LogViewFilter does not support multiple series in query result.");const r=i?.series[0],a=s?.series[0];if(!r)return{pluginIds:[],extensionPointIds:[],severity:[]};if(!a)return D({severity:r,pluginId:r,extensionPointId:r});switch(t.initial){case"extensionPointId":return D({severity:a,pluginId:a,extensionPointId:r});case"severity":return D({severity:r,pluginId:a,extensionPointId:a});case"pluginId":return D({severity:a,pluginId:r,extensionPointId:a});default:return D({severity:r,pluginId:r,extensionPointId:r})}},[i,s,t])}function Y(n){if(!(n.length<=0))return n.reduce((e,t)=>(t.value&&e.add(t.value),e),new Set)}function q(n){return Array.from(n).reduce((e,t)=>(t&&e.push({value:t,label:t}),e),[])}function D(n){const{severity:e,pluginId:t,extensionPointId:i}=n,s=e.fields.findIndex(c=>c.name==="severity"),r=t.fields.findIndex(c=>c.name==="pluginId"),a=i.fields.findIndex(c=>c.name==="extensionPointId"),o=new Set(e.fields[s].values),l=new Set(t.fields[r].values),u=new Set(i.fields[a].values);return{severity:q(o),pluginIds:q(l),extensionPointIds:q(u)}}var me=S(29405),ve=S(8392),ye=S(4038),ut=S(47370),V=S(63739);class ft extends b.UU{constructor(e,t,i){super(e,t),this.pluginId=e,this.uid=t,this.extensionsLog=i}query(e){const[t]=e.targets;return this.extensionsLog.asObservable().pipe((0,me.S)((i,s)=>{const[r]=i.data;return{data:[dt(t,s,r)],key:t.key??t.refId,state:ve.Gu.Streaming}},{data:[],key:t.key??t.refId,state:ve.Gu.Streaming}))}testDatasource(){return Promise.resolve({status:"success",message:"OK"})}}function dt(n,e,t){const i=t?.fields?.[0]?.values??[],s=t?.fields?.[1]?.values??[],r=t?.fields?.[2]?.values??[],a=t?.fields?.[3]?.values??[],o=t?.fields?.[4]?.values??[],l=t?.fields?.[5]?.values??[],u=t?.fields?.[6]?.values??[];return(0,ye.EI)({refId:n.refId,meta:{type:ut.m.LogLines},fields:[{name:"timestamp",type:V.PU.time,values:[e.timestamp,...i]},{name:"body",type:V.PU.string,values:[e.message,...s]},{name:"severity",type:V.PU.string,values:[e.level,...r]},{name:"id",type:V.PU.string,values:[e.id,...a]},{name:"labels",type:V.PU.other,values:[e.labels,...o]},{name:"pluginId",type:V.PU.string,values:[e.pluginId??null,...l]},{name:"extensionPointId",type:V.PU.string,values:[e.extensionPointId??null,...u]}]})}function gt(n){return function(){return function(t){return t.pipe((0,me.S)((i,s)=>{if((0,w.isEmpty)(n.extensionPointIds)&&(0,w.isEmpty)(n.pluginIds)&&(0,w.isEmpty)(n.severity))return s;for(const r of s){const a=r.fields.findIndex(c=>c.name==="pluginId"),o=r.fields.findIndex(c=>c.name==="extensionPointId"),l=r.fields.findIndex(c=>c.name==="severity");if(a===-1&&!(0,w.isEmpty)(n.pluginIds)||o===-1&&!(0,w.isEmpty)(n.extensionPointIds)||l===-1&&!(0,w.isEmpty)(n.severity))continue;const u={...r,fields:r.fields.map(c=>({...c,values:[]}))};for(let c=0;c<r.length;c++){const h=r.fields[a].values[c],f=r.fields[o].values[c],m=r.fields[l].values[c];!(0,w.isEmpty)(n.pluginIds)&&!n.pluginIds?.has(h)||!(0,w.isEmpty)(n.extensionPointIds)&&!n.extensionPointIds?.has(f)||!(0,w.isEmpty)(n.severity)&&!n.severity?.has(m)||pt(r,u,c)}i.push((0,ye.EI)(u))}return i},[]))}}}function pt(n,e,t){for(let i=0;i<n.fields.length;i++){const s=n.fields[i];e.fields[i]||(e.fields[i]={...s,values:[]});const r=n.fields[i].values[t];e.fields[i].values?.push(r)}}var mt=S(31731);const J={uid:(0,be.Ak)(),type:"grafana-extensionslog-datasource"},vt=b.Uf.logs().setOption("wrapLogMessage",!0).build();b.Go.registerRuntimeDataSource({dataSource:new ft(J.type,J.uid,mt.R)});function yt(){return(0,P.jsx)(Te,{children:(0,P.jsx)(St,{})})}function St(){const[n,e]=(0,y.useState)({}),t=De({datasource:J,queries:[{refId:"A"}],liveStreaming:!0}),i=Ue({transformations:[gt(n)],data:t});return(0,P.jsx)(ot.Y,{navId:"extensions",actions:(0,P.jsx)(ct,{provider:t,filteredProvider:i,filter:n,onChange:e}),children:(0,P.jsx)(we.default,{children:({height:s,width:r})=>(0,P.jsx)(at,{minHeight:s,minWidth:r,children:(0,P.jsx)(ke,{title:"",viz:vt,dataProvider:i})})})})}}}]);

//# sourceMappingURL=PluginExtensionsLog.1777236674ad93d52f34.js.map