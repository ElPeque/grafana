"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[297],{40297:(oe,Q,a)=>{a.d(Q,{Z:()=>n});var g=a(74848),v=a(2543),s=a(96540),$=a(91793),M=a(16753),H=a(29675),N=a(84596),G=a(7500),X=a(56276),y=a(32370),Z=a(20968),W=a(11817),R=a(88231),m=a(22803),x=a(94730);const O=({index:t,log:e,style:o,onOverflow:i,showTime:r,variant:d,wrapLogMessage:u})=>{const p=(0,H.$j)(),h=K(p),L=(0,s.useRef)(null);return(0,s.useEffect)(()=>{if(!i||!L.current)return;const S=typeof o.height=="number"?o.height:void 0,c=(0,x.SC)(L.current,S);c&&i(t,e.uid,c)},[t,e.uid,i,o.height]),(0,g.jsx)("div",{style:o,className:`${h.logLine} ${d}`,ref:i?L:void 0,children:(0,g.jsxs)("div",{className:u?h.wrappedLogLine:h.unwrappedLogLine,children:[r&&(0,g.jsx)("span",{className:`${h.timestamp} level-${e.logLevel}`,children:e.timestamp}),e.logLevel&&(0,g.jsx)("span",{className:`${h.level} level-${e.logLevel}`,children:e.logLevel}),e.body]})})},K=t=>{const e={critical:"#B877D9",error:"#FF5286",warning:"#FBAD37",debug:"#6CCF8E",trace:"#6ed0e0",info:"#6E9FFF"};return{logLine:(0,m.css)({color:t.colors.text.primary,fontFamily:t.typography.fontFamilyMonospace,fontSize:t.typography.fontSize,wordBreak:"break-all","&:hover":{opacity:.7},"&.infinite-scroll":{"&::before":{borderTop:`solid 1px ${t.colors.border.strong}`,content:'""',height:0,left:0,position:"absolute",top:-3,width:"100%"}}}),logLineMessage:(0,m.css)({fontFamily:t.typography.fontFamily,textAlign:"center"}),timestamp:(0,m.css)({color:t.colors.text.secondary,display:"inline-block",marginRight:t.spacing(1),"&.level-critical":{color:e.critical},"&.level-error":{color:e.error},"&.level-info":{color:e.info},"&.level-warning":{color:e.warning},"&.level-debug":{color:e.debug}}),level:(0,m.css)({color:t.colors.text.secondary,fontWeight:t.typography.fontWeightBold,display:"inline-block",marginRight:t.spacing(1),"&.level-critical":{color:e.critical},"&.level-error":{color:e.error},"&.level-warning":{color:e.warning},"&.level-info":{color:e.info},"&.level-debug":{color:e.debug}}),loadMoreButton:(0,m.css)({background:"transparent",border:"none",display:"inline"}),overflows:(0,m.css)({outline:"solid 1px red"}),unwrappedLogLine:(0,m.css)({whiteSpace:"pre",paddingBottom:t.spacing(.75)}),wrappedLogLine:(0,m.css)({whiteSpace:"pre-wrap",paddingBottom:t.spacing(.75)})}},q=({children:t,onClick:e,style:o})=>{const i=(0,H.$j)(),r=K(i);return(0,g.jsx)("div",{style:o,className:`${r.logLine} ${r.logLineMessage}`,children:e?(0,g.jsx)("button",{className:r.loadMoreButton,onClick:e,children:t}):t})},F=({children:t,handleOverflow:e,loadMore:o,logs:i,scrollElement:r,setInitialScrollPosition:d,showTime:u,sortOrder:p,timeRange:h,timeZone:L,wrapLogMessage:S})=>{const[c,b]=(0,s.useState)("idle"),[Y,E]=(0,s.useState)(!1),T=(0,N.A)(i),j=(0,N.A)(p),C=(0,s.useRef)(r?.scrollTop||0),A=(0,s.useRef)(null),J=(0,s.useRef)(0),P=(0,s.useRef)([]);(0,s.useEffect)(()=>{!T||T===i||(c==="loading"?b(i.length===T.length?"out-of-bounds":"idle"):(P.current=[],E(!0)))},[c,i,T]),(0,s.useEffect)(()=>{j&&j!==p&&b("idle")},[j,p]),(0,s.useEffect)(()=>{Y&&(d(),E(!1))},[Y,d]);const B=(0,s.useCallback)(()=>{const f=(0,R.rg)((0,R.K6)(i),h,L,p);if(!f){b("out-of-bounds");return}P.current.push(i[i.length-1].uid),b("loading"),o?.(f),(0,X.rR)("grafana_logs_infinite_scrolling",{direction:"bottom",sort_order:p})},[o,i,p,h,L]);(0,s.useEffect)(()=>{if(!r||!o||!y.$.featureToggles.logsInfiniteScrolling)return;function f(I){if(!r||!o||!i.length||c!=="pre-scroll")return;const ie=(0,R.V7)(I,A.current,J,r,C.current);A.current=I,C.current=r.scrollTop,ie===R.Dh.Bottom&&B()}return r.addEventListener("scroll",f),r.addEventListener("wheel",f),()=>{r.removeEventListener("scroll",f),r.removeEventListener("wheel",f)}},[c,o,i.length,B,r]);const w=(0,s.useCallback)(({index:f,style:I})=>!i[f]&&c!=="idle"?(0,g.jsx)(q,{style:I,onClick:c==="pre-scroll"?B:void 0,children:_(c,p)}):(0,g.jsx)(O,{index:f,log:i[f],showTime:u,style:I,variant:D(i,f,P.current),wrapLogMessage:S,onOverflow:e}),[e,c,i,B,u,p,S]),z=(0,s.useCallback)(f=>{if(!r||c==="loading"||c==="out-of-bounds"||r.scrollHeight<=r.clientHeight)return;const I=i.length-1,ie=i.length-2;f.visibleStopIndex>=I?b("pre-scroll"):f.visibleStartIndex<ie&&b("idle")},[c,i.length,r]),k=(0,s.useCallback)(f=>i[f]?i[f].uid:f.toString(),[i]),ne=i.length&&o&&c!=="idle"?i.length+1:i.length;return(0,g.jsx)(g.Fragment,{children:t({getItemKey:k,itemCount:ne,onItemsRendered:z,Renderer:w})})};function _(t,e){switch(t){case"out-of-bounds":return(0,W.t)("logs.infinite-scroll.end-of-range","End of the selected time range.");case"loading":return(0,g.jsxs)(g.Fragment,{children:[e===G.uH.Ascending?(0,W.t)("logs.infinite-scroll.load-newer","Loading newer logs..."):(0,W.t)("logs.infinite-scroll.load-older","Loading older logs...")," ",(0,g.jsx)(Z.y,{inline:!0})]});case"pre-scroll":return(0,W.t)("logs.infinite-scroll.load-more","Scroll to load more");default:return null}}function D(t,e,o){if(!o.length||!t[e-1])return;const i=t[e-1];for(const r of o)if(i.uid===r)return"infinite-scroll"}var V=a(88090),U=a(48224);const ee=(t,{escape:e,order:o,timeZone:i,wrap:r})=>(0,U.oR)(t,o).map(u=>te(u,{wrap:r,escape:e,timeZone:i,expanded:!1})),te=(t,{escape:e,expanded:o,timeZone:i,wrap:r})=>{let d=t.entry;const u=(0,V.LE)(t.timeEpochMs,{timeZone:i,defaultWithMS:!0});return e&&t.hasUnescapedContent&&(d=(0,U.Hw)(d)),!r&&!o&&(d=d.replace(/(\r\n|\n|\r)/g,"")),{...t,body:d,timestamp:u,dimensions:{timestampWidth:(0,x.WI)(u),levelWidth:(0,x.WI)(t.logLevel)}}},n=({app:t,containerElement:e,eventBus:o,forceEscape:i=!1,initialScrollPosition:r="top",loadMore:d,logs:u,showTime:p,sortOrder:h,timeRange:L,timeZone:S,wrapLogMessage:c})=>{const[b,Y]=(0,s.useState)([]),[E,T]=(0,s.useState)(t===M.Jk.Explore?window.innerHeight*.75:e.clientHeight),j=(0,H.$j)(),C=(0,s.useRef)(null),A=(0,s.useRef)(e.clientWidth),J=(0,s.useRef)(null);(0,s.useEffect)(()=>{(0,x.Ts)(j)},[j]),(0,s.useEffect)(()=>{const w=o.subscribe(x._B,z=>l(z,u.length,C.current));return()=>w.unsubscribe()},[o,u.length]),(0,s.useEffect)(()=>{Y(ee(u,{wrap:c,escape:i,order:h,timeZone:S})),C.current?.resetAfterIndex(0)},[i,u,h,S,c]),(0,s.useEffect)(()=>{const w=(0,v.debounce)(()=>{T(t===M.Jk.Explore?window.innerHeight*.75:e.clientHeight)},50);return window.addEventListener("resize",w),w(),()=>{window.removeEventListener("resize",w)}},[t,e.clientHeight]),(0,s.useLayoutEffect)(()=>{A.current!==e.clientWidth&&((0,x.MY)(),C.current?.resetAfterIndex(0),A.current=e.clientWidth)});const P=(0,s.useCallback)((w,z,k)=>{e&&((0,x.PQ)(z,e,k),C.current?.resetAfterIndex(w))},[e]),B=(0,s.useCallback)(()=>{C.current?.scrollToItem(r==="top"?0:u.length-1)},[r,u.length]);return!e||E==null?null:(0,g.jsx)(F,{handleOverflow:P,logs:b,loadMore:d,scrollElement:J.current,showTime:p,sortOrder:h,timeRange:L,timeZone:S,setInitialScrollPosition:B,wrapLogMessage:c,children:({getItemKey:w,itemCount:z,onItemsRendered:k,Renderer:ne})=>(0,g.jsx)($._m,{height:E,itemCount:z,itemSize:x.gn.bind(null,b,e,{wrap:c,showTime:p}),itemKey:w,layout:"vertical",onItemsRendered:k,outerRef:J,ref:C,style:{overflowY:"scroll"},width:"100%",children:ne})})};function l(t,e,o){t.payload.scrollTo==="top"?o?.scrollTo(0):o?.scrollToItem(e-1)}},94730:(oe,Q,a)=>{a.d(Q,{MY:()=>V,PQ:()=>U,SC:()=>K,Ts:()=>N,WI:()=>R,_B:()=>te,gn:()=>O});var g=a(91733);let v=null,s=8,$=s*.75,M=22,H="canvas";function N(n){const l=`${n.typography.fontSize}px ${n.typography.fontFamilyMonospace}`,t=n.typography.body.letterSpacing;return Z(l,t),X(l,t),s=n.spacing.gridSize,$=s*.75,M=n.typography.fontSize*n.typography.body.lineHeight,W=new Map,V(),G(),!0}function G(){if(!v){H="dom";return}const n=v.measureText("e").width;m("e")-n>=.1&&(console.warn("Virtualized log list: falling back to DOM for measurement"),H="dom")}function X(n,l){v=document.createElement("canvas").getContext("2d"),v&&(v.font=n,v.fontKerning="normal",v.fontStretch="normal",v.fontVariantCaps="normal",v.textRendering="optimizeLegibility",l&&(v.letterSpacing=l))}const y=document.createElement("span");function Z(n,l){y.style.font=n,y.style.visibility="hidden",y.style.position="absolute",y.style.wordBreak="break-all",l&&(y.style.letterSpacing=l)}let W=new Map;function R(n){if(!v)throw new Error("Measuring context canvas is not initialized. Call init() before.");const l=n.length,t=W.get(l);if(t)return t;const e=H==="canvas"?v.measureText(n).width:m(n);return W.set(l,e),e}function m(n){y.textContent=n,document.body.appendChild(y);const l=y.getBoundingClientRect().width;return document.body.removeChild(y),l}function x(n,l,t=0){let e=0;const o=R("e");let i=Math.round(l/o);const r=Math.floor((l-t)/o)-2*o,d=n.split(`
`);if(d.length===1&&n.length<r)return{lines:1,height:M+$};for(const p of d)for(let h=0;h<p.length;){let L,S=0,c=0,b=l-t;do L=p.substring(h,h+i-c),S=R(L),c+=1;while(S>=b);t&&(t=0),e+=1,h+=L.length}const u=e*M+$;return{lines:e,height:u}}function O(n,l,{wrap:t,showTime:e},o){if(!l)return 0;if(!t||!n[o])return M+$;const i=ee(n[o].uid,l);if(i)return i;const r=s;let d=0;e&&(d+=n[o].dimensions.timestampWidth+r),n[o].logLevel&&(d+=n[o].dimensions.levelWidth+r);const{height:u}=x(n[o].body,F(l),d);return u}function K(n,l){const t=l??n.clientHeight;if(n.scrollHeight>t)return n.scrollHeight;const e=n.firstChild;return e instanceof HTMLDivElement&&e.clientHeight<t?e.clientHeight:null}const q=_();function F(n){return n.clientWidth-q}function _(){const n=document.createElement("div");n.style.width="100px",n.style.height="100px",n.style.overflow="scroll",n.style.position="absolute",n.style.top="-9999px",document.body.appendChild(n);const l=n.offsetWidth-n.clientWidth;return document.body.removeChild(n),l}let D=new Map;function V(){D=new Map}function U(n,l,t){const e=`${n}_${F(l)}`;D.set(e,t)}function ee(n,l){const t=`${n}_${F(l)}`;return D.get(t)}class te extends g.x{static{this.type="logs-panel-scroll-to"}}}}]);

//# sourceMappingURL=297.154755d2cfe08380ab1b.js.map