/*! For license information please see module.js.LICENSE.txt */
define(["react","@grafana/data","@grafana/runtime","@grafana/ui","lodash","rxjs","rxjs/operators","@emotion/css","prismjs"],((e,t,r,a,n,s,i,o,l)=>(()=>{var u,c,p={1777:(e,t,r)=>{"use strict";var a=r(4769),n=r(5959),s=a.__importDefault(r(5053));t.A=function(e,t){void 0===t&&(t=[]);var r=s.default(e,t,{loading:!0}),a=r[0],i=r[1];return n.useEffect((function(){i()}),[i]),a}},5053:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(4769),n=r(5959),s=a.__importDefault(r(9812));t.default=function(e,t,r){void 0===t&&(t=[]),void 0===r&&(r={loading:!1});var i=n.useRef(0),o=s.default(),l=n.useState(r),u=l[0],c=l[1],p=n.useCallback((function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=++i.current;return u.loading||c((function(e){return a.__assign(a.__assign({},e),{loading:!0})})),e.apply(void 0,t).then((function(e){return o()&&n===i.current&&c({value:e,loading:!1}),e}),(function(e){return o()&&n===i.current&&c({error:e,loading:!1}),e}))}),t);return[u,p]}},9812:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(5959);t.default=function(){var e=a.useRef(!1),t=a.useCallback((function(){return e.current}),[]);return a.useEffect((function(){return e.current=!0,function(){e.current=!1}}),[]),t}},8044:(e,t,r)=>{"use strict";var a=r(5959),n=Symbol.for("react.element"),s=Symbol.for("react.fragment"),i=Object.prototype.hasOwnProperty,o=a.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function u(e,t,r){var a,s={},u=null,c=null;for(a in void 0!==r&&(u=""+r),void 0!==t.key&&(u=""+t.key),void 0!==t.ref&&(c=t.ref),t)i.call(t,a)&&!l.hasOwnProperty(a)&&(s[a]=t[a]);if(e&&e.defaultProps)for(a in t=e.defaultProps)void 0===s[a]&&(s[a]=t[a]);return{$$typeof:n,type:e,key:u,ref:c,props:s,_owner:o.current}}t.Fragment=s,t.jsx=u,t.jsxs=u},9728:(e,t,r)=>{"use strict";e.exports=r(8044)},9264:(e,t,r)=>{const a=Symbol("SemVer ANY");class n{static get ANY(){return a}constructor(e,t){if(t=s(t),e instanceof n){if(e.loose===!!t.loose)return e;e=e.value}e=e.trim().split(/\s+/).join(" "),u("comparator",e,t),this.options=t,this.loose=!!t.loose,this.parse(e),this.semver===a?this.value="":this.value=this.operator+this.semver.version,u("comp",this)}parse(e){const t=this.options.loose?i[o.COMPARATORLOOSE]:i[o.COMPARATOR],r=e.match(t);if(!r)throw new TypeError(`Invalid comparator: ${e}`);this.operator=void 0!==r[1]?r[1]:"","="===this.operator&&(this.operator=""),r[2]?this.semver=new c(r[2],this.options.loose):this.semver=a}toString(){return this.value}test(e){if(u("Comparator.test",e,this.options.loose),this.semver===a||e===a)return!0;if("string"==typeof e)try{e=new c(e,this.options)}catch(e){return!1}return l(e,this.operator,this.semver,this.options)}intersects(e,t){if(!(e instanceof n))throw new TypeError("a Comparator is required");return""===this.operator?""===this.value||new p(e.value,t).test(this.value):""===e.operator?""===e.value||new p(this.value,t).test(e.semver):!((t=s(t)).includePrerelease&&("<0.0.0-0"===this.value||"<0.0.0-0"===e.value)||!t.includePrerelease&&(this.value.startsWith("<0.0.0")||e.value.startsWith("<0.0.0"))||(!this.operator.startsWith(">")||!e.operator.startsWith(">"))&&(!this.operator.startsWith("<")||!e.operator.startsWith("<"))&&(this.semver.version!==e.semver.version||!this.operator.includes("=")||!e.operator.includes("="))&&!(l(this.semver,"<",e.semver,t)&&this.operator.startsWith(">")&&e.operator.startsWith("<"))&&!(l(this.semver,">",e.semver,t)&&this.operator.startsWith("<")&&e.operator.startsWith(">")))}}e.exports=n;const s=r(9547),{safeRe:i,t:o}=r(5750),l=r(4991),u=r(1064),c=r(4708),p=r(2839)},2839:(e,t,r)=>{const a=/\s+/g;class n{constructor(e,t){if(t=i(t),e instanceof n)return e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease?e:new n(e.raw,t);if(e instanceof o)return this.raw=e.value,this.set=[[e]],this.formatted=void 0,this;if(this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease,this.raw=e.trim().replace(a," "),this.set=this.raw.split("||").map((e=>this.parseRange(e.trim()))).filter((e=>e.length)),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){const e=this.set[0];if(this.set=this.set.filter((e=>!h(e[0]))),0===this.set.length)this.set=[e];else if(this.set.length>1)for(const e of this.set)if(1===e.length&&y(e[0])){this.set=[e];break}}this.formatted=void 0}get range(){if(void 0===this.formatted){this.formatted="";for(let e=0;e<this.set.length;e++){e>0&&(this.formatted+="||");const t=this.set[e];for(let e=0;e<t.length;e++)e>0&&(this.formatted+=" "),this.formatted+=t[e].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(e){const t=((this.options.includePrerelease&&v)|(this.options.loose&&g))+":"+e,r=s.get(t);if(r)return r;const a=this.options.loose,n=a?c[p.HYPHENRANGELOOSE]:c[p.HYPHENRANGE];e=e.replace(n,D(this.options.includePrerelease)),l("hyphen replace",e),e=e.replace(c[p.COMPARATORTRIM],d),l("comparator trim",e),e=e.replace(c[p.TILDETRIM],m),l("tilde trim",e),e=e.replace(c[p.CARETTRIM],f),l("caret trim",e);let i=e.split(" ").map((e=>E(e,this.options))).join(" ").split(/\s+/).map((e=>F(e,this.options)));a&&(i=i.filter((e=>(l("loose invalid filter",e,this.options),!!e.match(c[p.COMPARATORLOOSE]))))),l("range list",i);const u=new Map,y=i.map((e=>new o(e,this.options)));for(const e of y){if(h(e))return[e];u.set(e.value,e)}u.size>1&&u.has("")&&u.delete("");const b=[...u.values()];return s.set(t,b),b}intersects(e,t){if(!(e instanceof n))throw new TypeError("a Range is required");return this.set.some((r=>b(r,t)&&e.set.some((e=>b(e,t)&&r.every((r=>e.every((e=>r.intersects(e,t)))))))))}test(e){if(!e)return!1;if("string"==typeof e)try{e=new u(e,this.options)}catch(e){return!1}for(let t=0;t<this.set.length;t++)if(P(this.set[t],e,this.options))return!0;return!1}}e.exports=n;const s=new(r(122)),i=r(9547),o=r(9264),l=r(1064),u=r(4708),{safeRe:c,t:p,comparatorTrimReplace:d,tildeTrimReplace:m,caretTrimReplace:f}=r(5750),{FLAG_INCLUDE_PRERELEASE:v,FLAG_LOOSE:g}=r(2074),h=e=>"<0.0.0-0"===e.value,y=e=>""===e.value,b=(e,t)=>{let r=!0;const a=e.slice();let n=a.pop();for(;r&&a.length;)r=a.every((e=>n.intersects(e,t))),n=a.pop();return r},E=(e,t)=>(l("comp",e,t),e=w(e,t),l("caret",e),e=S(e,t),l("tildes",e),e=O(e,t),l("xrange",e),e=$(e,t),l("stars",e),e),_=e=>!e||"x"===e.toLowerCase()||"*"===e,S=(e,t)=>e.trim().split(/\s+/).map((e=>T(e,t))).join(" "),T=(e,t)=>{const r=t.loose?c[p.TILDELOOSE]:c[p.TILDE];return e.replace(r,((t,r,a,n,s)=>{let i;return l("tilde",e,t,r,a,n,s),_(r)?i="":_(a)?i=`>=${r}.0.0 <${+r+1}.0.0-0`:_(n)?i=`>=${r}.${a}.0 <${r}.${+a+1}.0-0`:s?(l("replaceTilde pr",s),i=`>=${r}.${a}.${n}-${s} <${r}.${+a+1}.0-0`):i=`>=${r}.${a}.${n} <${r}.${+a+1}.0-0`,l("tilde return",i),i}))},w=(e,t)=>e.trim().split(/\s+/).map((e=>N(e,t))).join(" "),N=(e,t)=>{l("caret",e,t);const r=t.loose?c[p.CARETLOOSE]:c[p.CARET],a=t.includePrerelease?"-0":"";return e.replace(r,((t,r,n,s,i)=>{let o;return l("caret",e,t,r,n,s,i),_(r)?o="":_(n)?o=`>=${r}.0.0${a} <${+r+1}.0.0-0`:_(s)?o="0"===r?`>=${r}.${n}.0${a} <${r}.${+n+1}.0-0`:`>=${r}.${n}.0${a} <${+r+1}.0.0-0`:i?(l("replaceCaret pr",i),o="0"===r?"0"===n?`>=${r}.${n}.${s}-${i} <${r}.${n}.${+s+1}-0`:`>=${r}.${n}.${s}-${i} <${r}.${+n+1}.0-0`:`>=${r}.${n}.${s}-${i} <${+r+1}.0.0-0`):(l("no pr"),o="0"===r?"0"===n?`>=${r}.${n}.${s}${a} <${r}.${n}.${+s+1}-0`:`>=${r}.${n}.${s}${a} <${r}.${+n+1}.0-0`:`>=${r}.${n}.${s} <${+r+1}.0.0-0`),l("caret return",o),o}))},O=(e,t)=>(l("replaceXRanges",e,t),e.split(/\s+/).map((e=>I(e,t))).join(" ")),I=(e,t)=>{e=e.trim();const r=t.loose?c[p.XRANGELOOSE]:c[p.XRANGE];return e.replace(r,((r,a,n,s,i,o)=>{l("xRange",e,r,a,n,s,i,o);const u=_(n),c=u||_(s),p=c||_(i),d=p;return"="===a&&d&&(a=""),o=t.includePrerelease?"-0":"",u?r=">"===a||"<"===a?"<0.0.0-0":"*":a&&d?(c&&(s=0),i=0,">"===a?(a=">=",c?(n=+n+1,s=0,i=0):(s=+s+1,i=0)):"<="===a&&(a="<",c?n=+n+1:s=+s+1),"<"===a&&(o="-0"),r=`${a+n}.${s}.${i}${o}`):c?r=`>=${n}.0.0${o} <${+n+1}.0.0-0`:p&&(r=`>=${n}.${s}.0${o} <${n}.${+s+1}.0-0`),l("xRange return",r),r}))},$=(e,t)=>(l("replaceStars",e,t),e.trim().replace(c[p.STAR],"")),F=(e,t)=>(l("replaceGTE0",e,t),e.trim().replace(c[t.includePrerelease?p.GTE0PRE:p.GTE0],"")),D=e=>(t,r,a,n,s,i,o,l,u,c,p,d)=>`${r=_(a)?"":_(n)?`>=${a}.0.0${e?"-0":""}`:_(s)?`>=${a}.${n}.0${e?"-0":""}`:i?`>=${r}`:`>=${r}${e?"-0":""}`} ${l=_(u)?"":_(c)?`<${+u+1}.0.0-0`:_(p)?`<${u}.${+c+1}.0-0`:d?`<=${u}.${c}.${p}-${d}`:e?`<${u}.${c}.${+p+1}-0`:`<=${l}`}`.trim(),P=(e,t,r)=>{for(let r=0;r<e.length;r++)if(!e[r].test(t))return!1;if(t.prerelease.length&&!r.includePrerelease){for(let r=0;r<e.length;r++)if(l(e[r].semver),e[r].semver!==o.ANY&&e[r].semver.prerelease.length>0){const a=e[r].semver;if(a.major===t.major&&a.minor===t.minor&&a.patch===t.patch)return!0}return!1}return!0}},4708:(e,t,r)=>{const a=r(1064),{MAX_LENGTH:n,MAX_SAFE_INTEGER:s}=r(2074),{safeRe:i,t:o}=r(5750),l=r(9547),{compareIdentifiers:u}=r(1427);class c{constructor(e,t){if(t=l(t),e instanceof c){if(e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease)return e;e=e.version}else if("string"!=typeof e)throw new TypeError(`Invalid version. Must be a string. Got type "${typeof e}".`);if(e.length>n)throw new TypeError(`version is longer than ${n} characters`);a("SemVer",e,t),this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease;const r=e.trim().match(t.loose?i[o.LOOSE]:i[o.FULL]);if(!r)throw new TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+r[1],this.minor=+r[2],this.patch=+r[3],this.major>s||this.major<0)throw new TypeError("Invalid major version");if(this.minor>s||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>s||this.patch<0)throw new TypeError("Invalid patch version");r[4]?this.prerelease=r[4].split(".").map((e=>{if(/^[0-9]+$/.test(e)){const t=+e;if(t>=0&&t<s)return t}return e})):this.prerelease=[],this.build=r[5]?r[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(a("SemVer.compare",this.version,this.options,e),!(e instanceof c)){if("string"==typeof e&&e===this.version)return 0;e=new c(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof c||(e=new c(e,this.options)),u(this.major,e.major)||u(this.minor,e.minor)||u(this.patch,e.patch)}comparePre(e){if(e instanceof c||(e=new c(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let t=0;do{const r=this.prerelease[t],n=e.prerelease[t];if(a("prerelease compare",t,r,n),void 0===r&&void 0===n)return 0;if(void 0===n)return 1;if(void 0===r)return-1;if(r!==n)return u(r,n)}while(++t)}compareBuild(e){e instanceof c||(e=new c(e,this.options));let t=0;do{const r=this.build[t],n=e.build[t];if(a("build compare",t,r,n),void 0===r&&void 0===n)return 0;if(void 0===n)return 1;if(void 0===r)return-1;if(r!==n)return u(r,n)}while(++t)}inc(e,t,r){if(e.startsWith("pre")){if(!t&&!1===r)throw new Error("invalid increment argument: identifier is empty");if(t){const e=`-${t}`.match(this.options.loose?i[o.PRERELEASELOOSE]:i[o.PRERELEASE]);if(!e||e[1]!==t)throw new Error(`invalid identifier: ${t}`)}}switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t,r);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t,r);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t,r),this.inc("pre",t,r);break;case"prerelease":0===this.prerelease.length&&this.inc("patch",t,r),this.inc("pre",t,r);break;case"release":if(0===this.prerelease.length)throw new Error(`version ${this.raw} is not a prerelease`);this.prerelease.length=0;break;case"major":0===this.minor&&0===this.patch&&0!==this.prerelease.length||this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":0===this.patch&&0!==this.prerelease.length||this.minor++,this.patch=0,this.prerelease=[];break;case"patch":0===this.prerelease.length&&this.patch++,this.prerelease=[];break;case"pre":{const e=Number(r)?1:0;if(0===this.prerelease.length)this.prerelease=[e];else{let a=this.prerelease.length;for(;--a>=0;)"number"==typeof this.prerelease[a]&&(this.prerelease[a]++,a=-2);if(-1===a){if(t===this.prerelease.join(".")&&!1===r)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(e)}}if(t){let a=[t,e];!1===r&&(a=[t]),0===u(this.prerelease[0],t)?isNaN(this.prerelease[1])&&(this.prerelease=a):this.prerelease=a}break}default:throw new Error(`invalid increment argument: ${e}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}}e.exports=c},8854:(e,t,r)=>{const a=r(4256);e.exports=(e,t)=>{const r=a(e.trim().replace(/^[=v]+/,""),t);return r?r.version:null}},4991:(e,t,r)=>{const a=r(1409),n=r(6031),s=r(9308),i=r(3833),o=r(2083),l=r(4624);e.exports=(e,t,r,u)=>{switch(t){case"===":return"object"==typeof e&&(e=e.version),"object"==typeof r&&(r=r.version),e===r;case"!==":return"object"==typeof e&&(e=e.version),"object"==typeof r&&(r=r.version),e!==r;case"":case"=":case"==":return a(e,r,u);case"!=":return n(e,r,u);case">":return s(e,r,u);case">=":return i(e,r,u);case"<":return o(e,r,u);case"<=":return l(e,r,u);default:throw new TypeError(`Invalid operator: ${t}`)}}},362:(e,t,r)=>{const a=r(4708),n=r(4256),{safeRe:s,t:i}=r(5750);e.exports=(e,t)=>{if(e instanceof a)return e;if("number"==typeof e&&(e=String(e)),"string"!=typeof e)return null;let r=null;if((t=t||{}).rtl){const a=t.includePrerelease?s[i.COERCERTLFULL]:s[i.COERCERTL];let n;for(;(n=a.exec(e))&&(!r||r.index+r[0].length!==e.length);)r&&n.index+n[0].length===r.index+r[0].length||(r=n),a.lastIndex=n.index+n[1].length+n[2].length;a.lastIndex=-1}else r=e.match(t.includePrerelease?s[i.COERCEFULL]:s[i.COERCE]);if(null===r)return null;const o=r[2],l=r[3]||"0",u=r[4]||"0",c=t.includePrerelease&&r[5]?`-${r[5]}`:"",p=t.includePrerelease&&r[6]?`+${r[6]}`:"";return n(`${o}.${l}.${u}${c}${p}`,t)}},7565:(e,t,r)=>{const a=r(4708);e.exports=(e,t,r)=>{const n=new a(e,r),s=new a(t,r);return n.compare(s)||n.compareBuild(s)}},5699:(e,t,r)=>{const a=r(3440);e.exports=(e,t)=>a(e,t,!0)},3440:(e,t,r)=>{const a=r(4708);e.exports=(e,t,r)=>new a(e,r).compare(new a(t,r))},4952:(e,t,r)=>{const a=r(4256);e.exports=(e,t)=>{const r=a(e,null,!0),n=a(t,null,!0),s=r.compare(n);if(0===s)return null;const i=s>0,o=i?r:n,l=i?n:r,u=!!o.prerelease.length;if(l.prerelease.length&&!u){if(!l.patch&&!l.minor)return"major";if(0===l.compareMain(o))return l.minor&&!l.patch?"minor":"patch"}const c=u?"pre":"";return r.major!==n.major?c+"major":r.minor!==n.minor?c+"minor":r.patch!==n.patch?c+"patch":"prerelease"}},1409:(e,t,r)=>{const a=r(3440);e.exports=(e,t,r)=>0===a(e,t,r)},9308:(e,t,r)=>{const a=r(3440);e.exports=(e,t,r)=>a(e,t,r)>0},3833:(e,t,r)=>{const a=r(3440);e.exports=(e,t,r)=>a(e,t,r)>=0},2479:(e,t,r)=>{const a=r(4708);e.exports=(e,t,r,n,s)=>{"string"==typeof r&&(s=n,n=r,r=void 0);try{return new a(e instanceof a?e.version:e,r).inc(t,n,s).version}catch(e){return null}}},2083:(e,t,r)=>{const a=r(3440);e.exports=(e,t,r)=>a(e,t,r)<0},4624:(e,t,r)=>{const a=r(3440);e.exports=(e,t,r)=>a(e,t,r)<=0},1034:(e,t,r)=>{const a=r(4708);e.exports=(e,t)=>new a(e,t).major},9406:(e,t,r)=>{const a=r(4708);e.exports=(e,t)=>new a(e,t).minor},6031:(e,t,r)=>{const a=r(3440);e.exports=(e,t,r)=>0!==a(e,t,r)},4256:(e,t,r)=>{const a=r(4708);e.exports=(e,t,r=!1)=>{if(e instanceof a)return e;try{return new a(e,t)}catch(e){if(!r)return null;throw e}}},5229:(e,t,r)=>{const a=r(4708);e.exports=(e,t)=>new a(e,t).patch},6513:(e,t,r)=>{const a=r(4256);e.exports=(e,t)=>{const r=a(e,t);return r&&r.prerelease.length?r.prerelease:null}},7618:(e,t,r)=>{const a=r(3440);e.exports=(e,t,r)=>a(t,e,r)},1173:(e,t,r)=>{const a=r(7565);e.exports=(e,t)=>e.sort(((e,r)=>a(r,e,t)))},3238:(e,t,r)=>{const a=r(2839);e.exports=(e,t,r)=>{try{t=new a(t,r)}catch(e){return!1}return t.test(e)}},3559:(e,t,r)=>{const a=r(7565);e.exports=(e,t)=>e.sort(((e,r)=>a(e,r,t)))},9881:(e,t,r)=>{const a=r(4256);e.exports=(e,t)=>{const r=a(e,t);return r?r.version:null}},709:(e,t,r)=>{const a=r(5750),n=r(2074),s=r(4708),i=r(1427),o=r(4256),l=r(9881),u=r(8854),c=r(2479),p=r(4952),d=r(1034),m=r(9406),f=r(5229),v=r(6513),g=r(3440),h=r(7618),y=r(5699),b=r(7565),E=r(3559),_=r(1173),S=r(9308),T=r(2083),w=r(1409),N=r(6031),O=r(3833),I=r(4624),$=r(4991),F=r(362),D=r(9264),P=r(2839),j=r(3238),R=r(3327),L=r(6988),k=r(2366),x=r(7453),A=r(130),V=r(7715),q=r(7379),C=r(110),M=r(284),G=r(8285),U=r(2008);e.exports={parse:o,valid:l,clean:u,inc:c,diff:p,major:d,minor:m,patch:f,prerelease:v,compare:g,rcompare:h,compareLoose:y,compareBuild:b,sort:E,rsort:_,gt:S,lt:T,eq:w,neq:N,gte:O,lte:I,cmp:$,coerce:F,Comparator:D,Range:P,satisfies:j,toComparators:R,maxSatisfying:L,minSatisfying:k,minVersion:x,validRange:A,outside:V,gtr:q,ltr:C,intersects:M,simplifyRange:G,subset:U,SemVer:s,re:a.re,src:a.src,tokens:a.t,SEMVER_SPEC_VERSION:n.SEMVER_SPEC_VERSION,RELEASE_TYPES:n.RELEASE_TYPES,compareIdentifiers:i.compareIdentifiers,rcompareIdentifiers:i.rcompareIdentifiers}},2074:e=>{const t=Number.MAX_SAFE_INTEGER||9007199254740991;e.exports={MAX_LENGTH:256,MAX_SAFE_COMPONENT_LENGTH:16,MAX_SAFE_BUILD_LENGTH:250,MAX_SAFE_INTEGER:t,RELEASE_TYPES:["major","premajor","minor","preminor","patch","prepatch","prerelease"],SEMVER_SPEC_VERSION:"2.0.0",FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2}},1064:e=>{const t="object"==typeof process&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...e)=>console.error("SEMVER",...e):()=>{};e.exports=t},1427:e=>{const t=/^[0-9]+$/,r=(e,r)=>{const a=t.test(e),n=t.test(r);return a&&n&&(e=+e,r=+r),e===r?0:a&&!n?-1:n&&!a?1:e<r?-1:1};e.exports={compareIdentifiers:r,rcompareIdentifiers:(e,t)=>r(t,e)}},122:e=>{e.exports=class{constructor(){this.max=1e3,this.map=new Map}get(e){const t=this.map.get(e);return void 0===t?void 0:(this.map.delete(e),this.map.set(e,t),t)}delete(e){return this.map.delete(e)}set(e,t){if(!this.delete(e)&&void 0!==t){if(this.map.size>=this.max){const e=this.map.keys().next().value;this.delete(e)}this.map.set(e,t)}return this}}},9547:e=>{const t=Object.freeze({loose:!0}),r=Object.freeze({});e.exports=e=>e?"object"!=typeof e?t:e:r},5750:(e,t,r)=>{const{MAX_SAFE_COMPONENT_LENGTH:a,MAX_SAFE_BUILD_LENGTH:n,MAX_LENGTH:s}=r(2074),i=r(1064),o=(t=e.exports={}).re=[],l=t.safeRe=[],u=t.src=[],c=t.t={};let p=0;const d="[a-zA-Z0-9-]",m=[["\\s",1],["\\d",s],[d,n]],f=(e,t,r)=>{const a=(e=>{for(const[t,r]of m)e=e.split(`${t}*`).join(`${t}{0,${r}}`).split(`${t}+`).join(`${t}{1,${r}}`);return e})(t),n=p++;i(e,n,t),c[e]=n,u[n]=t,o[n]=new RegExp(t,r?"g":void 0),l[n]=new RegExp(a,r?"g":void 0)};f("NUMERICIDENTIFIER","0|[1-9]\\d*"),f("NUMERICIDENTIFIERLOOSE","\\d+"),f("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${d}*`),f("MAINVERSION",`(${u[c.NUMERICIDENTIFIER]})\\.(${u[c.NUMERICIDENTIFIER]})\\.(${u[c.NUMERICIDENTIFIER]})`),f("MAINVERSIONLOOSE",`(${u[c.NUMERICIDENTIFIERLOOSE]})\\.(${u[c.NUMERICIDENTIFIERLOOSE]})\\.(${u[c.NUMERICIDENTIFIERLOOSE]})`),f("PRERELEASEIDENTIFIER",`(?:${u[c.NUMERICIDENTIFIER]}|${u[c.NONNUMERICIDENTIFIER]})`),f("PRERELEASEIDENTIFIERLOOSE",`(?:${u[c.NUMERICIDENTIFIERLOOSE]}|${u[c.NONNUMERICIDENTIFIER]})`),f("PRERELEASE",`(?:-(${u[c.PRERELEASEIDENTIFIER]}(?:\\.${u[c.PRERELEASEIDENTIFIER]})*))`),f("PRERELEASELOOSE",`(?:-?(${u[c.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${u[c.PRERELEASEIDENTIFIERLOOSE]})*))`),f("BUILDIDENTIFIER",`${d}+`),f("BUILD",`(?:\\+(${u[c.BUILDIDENTIFIER]}(?:\\.${u[c.BUILDIDENTIFIER]})*))`),f("FULLPLAIN",`v?${u[c.MAINVERSION]}${u[c.PRERELEASE]}?${u[c.BUILD]}?`),f("FULL",`^${u[c.FULLPLAIN]}$`),f("LOOSEPLAIN",`[v=\\s]*${u[c.MAINVERSIONLOOSE]}${u[c.PRERELEASELOOSE]}?${u[c.BUILD]}?`),f("LOOSE",`^${u[c.LOOSEPLAIN]}$`),f("GTLT","((?:<|>)?=?)"),f("XRANGEIDENTIFIERLOOSE",`${u[c.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),f("XRANGEIDENTIFIER",`${u[c.NUMERICIDENTIFIER]}|x|X|\\*`),f("XRANGEPLAIN",`[v=\\s]*(${u[c.XRANGEIDENTIFIER]})(?:\\.(${u[c.XRANGEIDENTIFIER]})(?:\\.(${u[c.XRANGEIDENTIFIER]})(?:${u[c.PRERELEASE]})?${u[c.BUILD]}?)?)?`),f("XRANGEPLAINLOOSE",`[v=\\s]*(${u[c.XRANGEIDENTIFIERLOOSE]})(?:\\.(${u[c.XRANGEIDENTIFIERLOOSE]})(?:\\.(${u[c.XRANGEIDENTIFIERLOOSE]})(?:${u[c.PRERELEASELOOSE]})?${u[c.BUILD]}?)?)?`),f("XRANGE",`^${u[c.GTLT]}\\s*${u[c.XRANGEPLAIN]}$`),f("XRANGELOOSE",`^${u[c.GTLT]}\\s*${u[c.XRANGEPLAINLOOSE]}$`),f("COERCEPLAIN",`(^|[^\\d])(\\d{1,${a}})(?:\\.(\\d{1,${a}}))?(?:\\.(\\d{1,${a}}))?`),f("COERCE",`${u[c.COERCEPLAIN]}(?:$|[^\\d])`),f("COERCEFULL",u[c.COERCEPLAIN]+`(?:${u[c.PRERELEASE]})?`+`(?:${u[c.BUILD]})?(?:$|[^\\d])`),f("COERCERTL",u[c.COERCE],!0),f("COERCERTLFULL",u[c.COERCEFULL],!0),f("LONETILDE","(?:~>?)"),f("TILDETRIM",`(\\s*)${u[c.LONETILDE]}\\s+`,!0),t.tildeTrimReplace="$1~",f("TILDE",`^${u[c.LONETILDE]}${u[c.XRANGEPLAIN]}$`),f("TILDELOOSE",`^${u[c.LONETILDE]}${u[c.XRANGEPLAINLOOSE]}$`),f("LONECARET","(?:\\^)"),f("CARETTRIM",`(\\s*)${u[c.LONECARET]}\\s+`,!0),t.caretTrimReplace="$1^",f("CARET",`^${u[c.LONECARET]}${u[c.XRANGEPLAIN]}$`),f("CARETLOOSE",`^${u[c.LONECARET]}${u[c.XRANGEPLAINLOOSE]}$`),f("COMPARATORLOOSE",`^${u[c.GTLT]}\\s*(${u[c.LOOSEPLAIN]})$|^$`),f("COMPARATOR",`^${u[c.GTLT]}\\s*(${u[c.FULLPLAIN]})$|^$`),f("COMPARATORTRIM",`(\\s*)${u[c.GTLT]}\\s*(${u[c.LOOSEPLAIN]}|${u[c.XRANGEPLAIN]})`,!0),t.comparatorTrimReplace="$1$2$3",f("HYPHENRANGE",`^\\s*(${u[c.XRANGEPLAIN]})\\s+-\\s+(${u[c.XRANGEPLAIN]})\\s*$`),f("HYPHENRANGELOOSE",`^\\s*(${u[c.XRANGEPLAINLOOSE]})\\s+-\\s+(${u[c.XRANGEPLAINLOOSE]})\\s*$`),f("STAR","(<|>)?=?\\s*\\*"),f("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),f("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")},7379:(e,t,r)=>{const a=r(7715);e.exports=(e,t,r)=>a(e,t,">",r)},284:(e,t,r)=>{const a=r(2839);e.exports=(e,t,r)=>(e=new a(e,r),t=new a(t,r),e.intersects(t,r))},110:(e,t,r)=>{const a=r(7715);e.exports=(e,t,r)=>a(e,t,"<",r)},6988:(e,t,r)=>{const a=r(4708),n=r(2839);e.exports=(e,t,r)=>{let s=null,i=null,o=null;try{o=new n(t,r)}catch(e){return null}return e.forEach((e=>{o.test(e)&&(s&&-1!==i.compare(e)||(s=e,i=new a(s,r)))})),s}},2366:(e,t,r)=>{const a=r(4708),n=r(2839);e.exports=(e,t,r)=>{let s=null,i=null,o=null;try{o=new n(t,r)}catch(e){return null}return e.forEach((e=>{o.test(e)&&(s&&1!==i.compare(e)||(s=e,i=new a(s,r)))})),s}},7453:(e,t,r)=>{const a=r(4708),n=r(2839),s=r(9308);e.exports=(e,t)=>{e=new n(e,t);let r=new a("0.0.0");if(e.test(r))return r;if(r=new a("0.0.0-0"),e.test(r))return r;r=null;for(let t=0;t<e.set.length;++t){const n=e.set[t];let i=null;n.forEach((e=>{const t=new a(e.semver.version);switch(e.operator){case">":0===t.prerelease.length?t.patch++:t.prerelease.push(0),t.raw=t.format();case"":case">=":i&&!s(t,i)||(i=t);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${e.operator}`)}})),!i||r&&!s(r,i)||(r=i)}return r&&e.test(r)?r:null}},7715:(e,t,r)=>{const a=r(4708),n=r(9264),{ANY:s}=n,i=r(2839),o=r(3238),l=r(9308),u=r(2083),c=r(4624),p=r(3833);e.exports=(e,t,r,d)=>{let m,f,v,g,h;switch(e=new a(e,d),t=new i(t,d),r){case">":m=l,f=c,v=u,g=">",h=">=";break;case"<":m=u,f=p,v=l,g="<",h="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(o(e,t,d))return!1;for(let r=0;r<t.set.length;++r){const a=t.set[r];let i=null,o=null;if(a.forEach((e=>{e.semver===s&&(e=new n(">=0.0.0")),i=i||e,o=o||e,m(e.semver,i.semver,d)?i=e:v(e.semver,o.semver,d)&&(o=e)})),i.operator===g||i.operator===h)return!1;if((!o.operator||o.operator===g)&&f(e,o.semver))return!1;if(o.operator===h&&v(e,o.semver))return!1}return!0}},8285:(e,t,r)=>{const a=r(3238),n=r(3440);e.exports=(e,t,r)=>{const s=[];let i=null,o=null;const l=e.sort(((e,t)=>n(e,t,r)));for(const e of l)a(e,t,r)?(o=e,i||(i=e)):(o&&s.push([i,o]),o=null,i=null);i&&s.push([i,null]);const u=[];for(const[e,t]of s)e===t?u.push(e):t||e!==l[0]?t?e===l[0]?u.push(`<=${t}`):u.push(`${e} - ${t}`):u.push(`>=${e}`):u.push("*");const c=u.join(" || "),p="string"==typeof t.raw?t.raw:String(t);return c.length<p.length?c:t}},2008:(e,t,r)=>{const a=r(2839),n=r(9264),{ANY:s}=n,i=r(3238),o=r(3440),l=[new n(">=0.0.0-0")],u=[new n(">=0.0.0")],c=(e,t,r)=>{if(e===t)return!0;if(1===e.length&&e[0].semver===s){if(1===t.length&&t[0].semver===s)return!0;e=r.includePrerelease?l:u}if(1===t.length&&t[0].semver===s){if(r.includePrerelease)return!0;t=u}const a=new Set;let n,c,m,f,v,g,h;for(const t of e)">"===t.operator||">="===t.operator?n=p(n,t,r):"<"===t.operator||"<="===t.operator?c=d(c,t,r):a.add(t.semver);if(a.size>1)return null;if(n&&c){if(m=o(n.semver,c.semver,r),m>0)return null;if(0===m&&(">="!==n.operator||"<="!==c.operator))return null}for(const e of a){if(n&&!i(e,String(n),r))return null;if(c&&!i(e,String(c),r))return null;for(const a of t)if(!i(e,String(a),r))return!1;return!0}let y=!(!c||r.includePrerelease||!c.semver.prerelease.length)&&c.semver,b=!(!n||r.includePrerelease||!n.semver.prerelease.length)&&n.semver;y&&1===y.prerelease.length&&"<"===c.operator&&0===y.prerelease[0]&&(y=!1);for(const e of t){if(h=h||">"===e.operator||">="===e.operator,g=g||"<"===e.operator||"<="===e.operator,n)if(b&&e.semver.prerelease&&e.semver.prerelease.length&&e.semver.major===b.major&&e.semver.minor===b.minor&&e.semver.patch===b.patch&&(b=!1),">"===e.operator||">="===e.operator){if(f=p(n,e,r),f===e&&f!==n)return!1}else if(">="===n.operator&&!i(n.semver,String(e),r))return!1;if(c)if(y&&e.semver.prerelease&&e.semver.prerelease.length&&e.semver.major===y.major&&e.semver.minor===y.minor&&e.semver.patch===y.patch&&(y=!1),"<"===e.operator||"<="===e.operator){if(v=d(c,e,r),v===e&&v!==c)return!1}else if("<="===c.operator&&!i(c.semver,String(e),r))return!1;if(!e.operator&&(c||n)&&0!==m)return!1}return!(n&&g&&!c&&0!==m||c&&h&&!n&&0!==m||b||y)},p=(e,t,r)=>{if(!e)return t;const a=o(e.semver,t.semver,r);return a>0?e:a<0||">"===t.operator&&">="===e.operator?t:e},d=(e,t,r)=>{if(!e)return t;const a=o(e.semver,t.semver,r);return a<0?e:a>0||"<"===t.operator&&"<="===e.operator?t:e};e.exports=(e,t,r={})=>{if(e===t)return!0;e=new a(e,r),t=new a(t,r);let n=!1;e:for(const a of e.set){for(const e of t.set){const t=c(a,e,r);if(n=n||null!==t,t)continue e}if(n)return!1}return!0}},3327:(e,t,r)=>{const a=r(2839);e.exports=(e,t)=>new a(e,t).set.map((e=>e.map((e=>e.value)).join(" ").trim().split(" ")))},130:(e,t,r)=>{const a=r(2839);e.exports=(e,t)=>{try{return new a(e,t).range||"*"}catch(e){return null}}},4330:(e,t,r)=>{"use strict";r.d(t,{C:()=>l});var a=r(9728),n=r(6089),s=r(5959),i=r(2007);const o={error:7e3,info:3e3,success:3e3,warning:5e3},l=e=>{const t=(r=(0,i.useTheme2)(),(0,n.css)({position:"absolute",zIndex:r.zIndex.portal,top:0,right:10}));var r;const[l,u]=(0,s.useState)(!1),[c,p]=(0,s.useState)();return(0,s.useEffect)((()=>()=>{c&&clearTimeout(c)}),[c]),(0,s.useEffect)((()=>{if(""!==e.text){u(!0);const t=setTimeout((()=>{u(!1)}),o[e.severity]);p(t)}}),[e.severity,e.text]),(0,a.jsx)(a.Fragment,{children:l&&(0,a.jsx)(i.Alert,{className:t,elevated:!0,onRemove:()=>u(!1),severity:e.severity,title:e.text})})}},2686:(e,t,r)=>{"use strict";r.d(t,{$m:()=>s,eX:()=>a,ob:()=>n});var a=function(e){return e.Basic="basic",e.Gradient="gradient",e.Lcd="lcd",e}({}),n=function(e){return e.Actions="actions",e.Auto="auto",e.BasicGauge="basic",e.ColorBackground="color-background",e.ColorBackgroundSolid="color-background-solid",e.ColorText="color-text",e.Custom="custom",e.DataLinks="data-links",e.Gauge="gauge",e.GradientGauge="gradient-gauge",e.Image="image",e.JSONView="json-view",e.LcdGauge="lcd-gauge",e.Sparkline="sparkline",e}({}),s=function(e){return e.CSV="csv",e.Date="date",e.Distributed="distributed",e.DoubleQuote="doublequote",e.Glob="glob",e.HTML="html",e.JSON="json",e.Lucene="lucene",e.PercentEncode="percentencode",e.Pipe="pipe",e.QueryParam="queryparam",e.Raw="raw",e.Regex="regex",e.SQLString="sqlstring",e.SingleQuote="singlequote",e.Text="text",e.UriEncode="uriencode",e}({})},2181:(e,t,r)=>{"use strict";r.d(t,{A:()=>b,r:()=>E});var a=r(9728),n=r(6089),s=r(3241),i=r(5959),o=r(1777),l=r(4330),u=r(8531),c=r(2007),p=r(3557),d=r(2599),m=r(2190),f=r(2862);function v(e,t,r,a,n,s,i){try{var o=e[s](i),l=o.value}catch(e){return void r(e)}o.done?t(l):Promise.resolve(l).then(a,n)}function g(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function h(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},a=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),a.forEach((function(t){g(e,t,r[t])}))}return e}function y(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t.push.apply(t,r)}return t}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const b=({filter:e,datasource:t,updateFilter:r,isTagsLoading:n,tags:g,setError:b,hideScope:S,hideTag:T,hideValue:w,query:N,addVariablesToOptions:O,isMulti:I=!0,allowCustomValue:$=!0})=>{var F;const D=(0,c.useStyles2)(_),[P,j]=(0,i.useState)(),R=(0,i.useMemo)((()=>(0,f.pE)(e,t.languageProvider)),[t.languageProvider,e]),[L,k]=(0,i.useState)(""),[x,A]=(0,i.useState)(""),V=function(){var r,a=(r=function*(){try{const r=e.tag?yield t.languageProvider.getOptionsV2(R,N):[];return j(void 0),b(null),r}catch(e){(0,u.isFetchError)(e)&&404===(null==e?void 0:e.status)?b(e):e instanceof Error&&j(`Error: ${e.message}`)}return[]},function(){var e=this,t=arguments;return new Promise((function(a,n){var s=r.apply(e,t);function i(e){v(s,a,n,i,o,"next",e)}function o(e){v(s,a,n,i,o,"throw",e)}i(void 0)}))});return function(){return a.apply(this,arguments)}}(),{loading:q,value:C}=(0,o.A)(V,[R,t.languageProvider,b,N]);e.value&&!Array.isArray(e.value)&&C&&!C.find((t=>t.value===e.value))&&C.push({label:e.value.toString(),value:e.value.toString(),type:e.valueType});const M=Object.values(p.d).filter((e=>t.languageProvider.getTags(e).length>0)).map((e=>({label:e,value:e}))),G=null==C?void 0:C.filter((e=>{var t;return e.type===(null===(t=C[0])||void 0===t?void 0:t.type)})),U=(null==C?void 0:C.length)===(null==G?void 0:G.length)?null==C||null===(F=C[0])||void 0===F?void 0:F.type:void 0;let Q=m.II;switch(U){case"keyword":Q=m.fV;break;case"string":Q=m.jN;break;case"int":case"float":Q=m.rx}const B=Q.map(f.wu),X=(e,t)=>(void 0!==t?(0,s.uniq)([t,...e]):e).map((e=>({label:e,value:e}))),J=(0,i.useMemo)((()=>{if(0===L.length)return X(g.slice(0,d.J_),e.tag);const t=L.toLowerCase(),r=g.filter((e=>e.toLowerCase().includes(t))).slice(0,d.J_);return X(r,e.tag)}),[e.tag,L,g]),z=(0,i.useMemo)((()=>{if(!C)return;if(0===x.length)return C.slice(0,d.J_);const e=x.toLowerCase();return C.filter((t=>!!(t.value&&t.value.length>0)&&t.value.toLowerCase().includes(e))).slice(0,d.J_)}),[x,C]);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(c.HorizontalGroup,{spacing:"none",width:"auto",children:[!S&&(0,a.jsx)(c.Select,{className:D.dropdown,inputId:`${e.id}-scope`,options:O?E(M):M,value:e.scope,onChange:t=>r(y(h({},e),{scope:null==t?void 0:t.value,tag:void 0,value:[]})),placeholder:"Select scope","aria-label":`select ${e.id} scope`}),!T&&(0,a.jsx)(c.Select,{className:D.dropdown,inputId:`${e.id}-tag`,isLoading:n,options:O?E(J):J,onInputChange:(e,{action:t})=>{"input-change"===t&&k(e)},onCloseMenu:()=>k(""),onChange:t=>r(y(h({},e),{tag:null==t?void 0:t.value,value:[]})),value:e.tag,placeholder:"Select tag",isClearable:!0,"aria-label":`select ${e.id} tag`,allowCustomValue:!0,virtualized:!0},e.tag),(0,a.jsx)(c.Select,{className:D.dropdown,inputId:`${e.id}-operator`,options:O?E(B):B,value:e.operator,onChange:t=>r(y(h({},e),{operator:null==t?void 0:t.value})),isClearable:!1,"aria-label":`select ${e.id} operator`,allowCustomValue:!0,width:8}),!w&&(0,a.jsx)(c.Select,{virtualized:!0,className:D.dropdown,inputId:`${e.id}-value`,isLoading:q,options:O?E(z):z,value:e.value,onInputChange:(e,{action:t})=>{"input-change"===t&&A(e)},onCloseMenu:()=>A(""),onChange:t=>{var a;Array.isArray(t)?r(y(h({},e),{value:t.map((e=>e.value)),valueType:(null===(a=t[0])||void 0===a?void 0:a.type)||U})):r(y(h({},e),{value:null==t?void 0:t.value,valueType:(null==t?void 0:t.type)||U}))},placeholder:"Select value",isClearable:!0,"aria-label":`select ${e.id} value`,allowCustomValue:$,isMulti:I,allowCreateWhileLoading:!0})]}),P&&(0,a.jsx)(l.C,{severity:"error",text:P})]})},E=e=>[...e||[],...(0,u.getTemplateSrv)().getVariables().map((e=>({label:`$${e.name}`,value:`$${e.name}`})))],_=()=>({dropdown:(0,n.css)({boxShadow:"none"})})},4160:(e,t,r)=>{"use strict";r.d(t,{$:()=>f,A:()=>m});var a=r(9728),n=r(6089),s=r(5959),i=r(6373),o=r(2827),l=r(2007),u=r(3557),c=r(2181),p=r(2862);const d=e=>({vertical:(0,n.css)({display:"flex",flexDirection:"column",gap:e.spacing(.25)}),horizontal:(0,n.css)({display:"flex",flexDirection:"row",gap:e.spacing(1)}),addTag:(0,n.css)({marginLeft:e.spacing(1)})}),m=({updateFilter:e,deleteFilter:t,filters:r,datasource:n,setError:i,staticTags:m,isTagsLoading:v,hideValues:g,requireTagAndValue:h,generateQueryWithoutFilter:y,addVariablesToOptions:b})=>{const E=(0,l.useStyles2)(d),_=(0,s.useCallback)((()=>e({id:f(),operator:"=",scope:u.d.Span})),[e]);(0,s.useEffect)((()=>{(null==r?void 0:r.length)||_()}),[r,_]);const S=e=>{const t=n.languageProvider.getTags(e.scope);return(0,p.l8)(t,m)},T=e=>h?e.tag&&e.value&&e.value.length>0:e.tag;return(0,a.jsx)("div",{className:E.vertical,children:null==r?void 0:r.map(((s,l)=>(0,a.jsxs)("div",{className:E.horizontal,children:[(0,a.jsx)(c.A,{filter:s,datasource:n,setError:i,updateFilter:e,tags:S(s),isTagsLoading:v,hideValue:g,query:y(s),addVariablesToOptions:b}),(T(s)||r.length>1)&&(0,a.jsx)(o.Z,{"aria-label":`Remove tag with ID ${s.id}`,variant:"secondary",icon:"times",onClick:()=>null==t?void 0:t(s),tooltip:"Remove tag"}),T(s)&&l===r.length-1&&(0,a.jsx)("span",{className:E.addTag,children:(0,a.jsx)(o.Z,{"aria-label":"Add tag",variant:"secondary",icon:"plus",onClick:_,tooltip:"Add tag"})})]},s.id)))})},f=()=>(0,i.A)().slice(0,8)},2862:(e,t,r)=>{"use strict";r.d(t,{Jy:()=>b,LL:()=>g,_D:()=>I,hr:()=>_,l8:()=>S,pE:()=>E,r:()=>N,rC:()=>w,rd:()=>T,tH:()=>p,vP:()=>O,wu:()=>$,yV:()=>h});var a=r(3241),n=r(8531),s=r(2686),i=r(3557),o=r(4288);function l(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function u(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},a=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),a.forEach((function(t){l(e,t,r[t])}))}return e}function c(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t.push.apply(t,r)}return t}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const p=(e,t)=>e.map((e=>{var r;const a=c(u({},e),{tag:(0,n.getTemplateSrv)().replace(null!==(r=e.tag)&&void 0!==r?r:"",null!=t?t:{})});var i;return e.value&&(a.value="string"==typeof e.value?(0,n.getTemplateSrv)().replace(null!==(i=e.value)&&void 0!==i?i:"",null!=t?t:{},s.$m.Pipe):e.value.map((e=>(0,n.getTemplateSrv)().replace(null!=e?e:"",null!=t?t:{},s.$m.Pipe)))),a})),d=e=>"=~"===e||"!~"===e,m=e=>{const t=Array.isArray(e.value)&&d(e.operator)?(r=e.value,(0,o.ob)(r)):e.value;var r;return Array.isArray(t)&&t.length>1?`"${t.join("|")}"`:"string"===e.valueType?`"${t}"`:t},f=(e,t)=>{var r;return t.getIntrinsics().find((t=>t===e.tag))?"":(e.scope===i.d.Event||e.scope===i.d.Instrumentation||e.scope===i.d.Link||e.scope===i.d.Resource||e.scope===i.d.Span?null===(r=e.scope)||void 0===r?void 0:r.toLowerCase():"")+"."},v=(e,t)=>{if("duration"===e.tag){const r=t.find((e=>"duration-type"===e.id));return r?"trace"===r.value?"traceDuration":"duration":e.tag}return e.tag},g=(e,t,r)=>Array.isArray(e.value)&&e.value.length>1&&!d(e.operator)?`(${e.value.map((a=>`${f(e,r)}${v(e,t)}${e.operator}${m(c(u({},e),{value:a}))}`)).join(" || ")})`:`${f(e,r)}${v(e,t)}${e.operator}${m(e)}`,h=(e,t)=>`{${e.filter((e=>e.key&&e.operator&&e.value)).map((e=>`${e.key}${e.operator}${y(e,t)}`)).join(" && ")}}`,y=(e,t)=>t.getIntrinsics().find((t=>t===e.key))||parseInt(e.value,10).toString()===e.value?e.value:`"${e.value}"`,b=e=>e.replace(/^(event|instrumentation|link|resource|span)\./,""),E=(e,t)=>f(e,t)+e.tag,_=(e,t)=>"name"===e.tag?"Span Name":"service.name"===e.tag&&e.scope===i.d.Resource?"Service Name":(0,a.startCase)(E(e,t)),S=(e,t)=>[...e].filter((e=>!t.includes(e))),T=e=>(0,a.uniq)(e.map((e=>e.name&&e.name!==i.d.Intrinsic&&e.tags?e.tags:[])).flat()),w=e=>(0,a.uniq)(e.map((e=>e.name&&e.name===i.d.Intrinsic&&e.tags?e.tags:[])).flat()),N=e=>(0,a.uniq)(e.map((e=>e.tags?e.tags:[])).flat()),O=(e,t)=>(0,a.uniq)(e.map((e=>e.name&&e.name===t&&e.tags?e.tags:[])).flat());function I(e,t,r){const a=e.slice(0);return a[t]=r,a}const $=e=>{const t={label:e,value:e};switch(e){case"=":t.description="Equals";break;case"!=":t.description="Not equals";break;case">":t.description="Greater";break;case">=":t.description="Greater or Equal";break;case"<":t.description="Less";break;case"<=":t.description="Less or Equal";break;case"=~":t.description="Matches regex";break;case"!~":t.description="Does not match regex"}return t}},3557:(e,t,r)=>{"use strict";r.d(t,{Ag:()=>a,Jv:()=>s,O8:()=>n,d:()=>i});var a=function(e){return e.Instant="instant",e.Range="range",e}({}),n=function(e){return e.Done="done",e.Error="error",e.Pending="pending",e.Streaming="streaming",e}({}),s=function(e){return e.Raw="raw",e.Spans="spans",e.Traces="traces",e}({}),i=function(e){return e.Event="event",e.Instrumentation="instrumentation",e.Intrinsic="intrinsic",e.Link="link",e.Resource="resource",e.Span="span",e.Unscoped="unscoped",e}({})},4288:(e,t,r)=>{"use strict";r.d(t,{eH:()=>Le,m9:()=>ke,SD:()=>xe,H1:()=>Ve,yJ:()=>Ae,ob:()=>Me});var a=r(3241),n=r(1269),s=r(3059),i=r(709),o=r.n(i),l=r(7781),u=r(8531),c=r(2686),p=r(2862),d=r(9728),m=r(5959),f=r(2007),v=r(2599),g=function(e){return e[e.LabelNames=0]="LabelNames",e[e.LabelValues=1]="LabelValues",e}({});const h=[{label:"Label names",value:0},{label:"Label values",value:1}],y="TempoDatasourceVariableQueryEditor-VariableQuery",b=({onChange:e,query:t,datasource:r})=>{const[a,n]=(0,m.useState)(t.label||""),[s,i]=(0,m.useState)(t.type),[o,l]=(0,m.useState)([]),[u,c]=(0,m.useState)("");(0,m.useEffect)((()=>{1===s&&r.labelNamesQuery().then((e=>{l(e.map((({text:e})=>({label:e,value:e}))))}))}),[r,t,s]);const p=(0,m.useMemo)((()=>{if(0===u.length)return o.slice(0,v.J_);const e=u.toLowerCase();return o.filter((t=>!!(t.value&&t.value.length>0)&&t.value.toLowerCase().includes(e))).slice(0,v.J_)}),[u,o]),g=()=>{void 0!==s&&e({type:s,label:a,refId:y})};return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(f.InlineFieldRow,{children:(0,d.jsx)(f.InlineField,{label:"Query type",labelWidth:20,children:(0,d.jsx)(f.Select,{"aria-label":"Query type",onChange:t=>{i(t.value),void 0!==t.value&&e({type:t.value,label:a,refId:y})},onBlur:g,value:s,options:h,width:32})})}),1===s&&(0,d.jsx)(f.InlineFieldRow,{children:(0,d.jsx)(f.InlineField,{label:"Label",labelWidth:20,children:(0,d.jsx)(f.Select,{"aria-label":"Label",onChange:t=>{const r=t.value||"";n(r),void 0!==s&&e({type:s,label:r,refId:y})},onBlur:g,onInputChange:(e,{action:t})=>{"input-change"===t&&c(e)},onCloseMenu:()=>c(""),value:{label:a,value:a},options:p,width:32,allowCustomValue:!0,virtualized:!0})})})]})};var E=r(3557);const _="traces_service_graph_request_server_seconds_sum",S="traces_service_graph_request_total",T="traces_service_graph_request_failed_total",w="traces_service_graph_request_server_seconds_bucket",N={expr:"sum(rate(traces_spanmetrics_calls_total{}[$__range])) by (span_name)",topk:5,params:[]},O={expr:"sum(rate(traces_spanmetrics_calls_total{}[$__range])) by (span_name)",topk:5,params:['status_code="STATUS_CODE_ERROR"']},I={expr:"histogram_quantile(.9, sum(rate(traces_spanmetrics_latency_bucket{}[$__range])) by (le))",params:[]},$='span_kind="SPAN_KIND_SERVER"',F=[_,S,T,w];function D(e,t,r,a,n){if(!e)return;const s=`Value #${r}`;for(let r=0;r<e.length;r++){const i=e.get(r),o=i.server_service_namespace?`${i.server_service_namespace}/${i.server}`:i.server,l=i.client_service_namespace?`${i.client_service_namespace}/${i.client}`:i.client,u=`${l}_${o}`;n[u]?n[u][t]=(n[u][t]||0)+i[s]:n[u]={target:o,targetName:i.server,targetNamespace:i.server_service_namespace,source:l,sourceName:i.client,sourceNamespace:i.client_service_namespace,[t]:i[s]},a[o]?a[o][t]=(a[o][t]||0)+i[s]:a[o]={name:i.server,namespace:i.server_service_namespace,[t]:i[s]},a[l]||(a[l]={name:i.client,namespace:i.client_service_namespace,[t]:0})}}function P(e,t){if(e)for(let r=0;r<e.length;r++){const a=e.get(r),n=a.server_service_namespace?`${a.server_service_namespace}/${a.server}`:a.server;t[n]&&!0!==t[n].isInstrumented&&(t[n].isInstrumented=""===a.connection_type||"messaging_system"===a.connection_type)}}function j(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function R(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},a=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),a.forEach((function(t){j(e,t,r[t])}))}return e}function L(e,t,r){let a;if(!e.length)return U;const n={};e.forEach((e=>{const a=x(e.series,t);e.series.forEach((e=>{n[e.key]={name:`${e.key}`,type:l.FieldType.string,config:A(e,a,r),values:[]}}))})),a=(0,l.createDataFrame)({name:"Metrics Summary",refId:"metrics-summary",fields:[...Object.values(n).sort(((e,t)=>e.name.localeCompare(t.name))),{name:"spanCount",type:l.FieldType.number,config:{displayNameFromDS:"Span count",custom:{width:150}}},{name:"errorPercentage",type:l.FieldType.number,config:{displayNameFromDS:"Error",unit:"percent",custom:{width:150}}},M("p50"),M("p90"),M("p95"),M("p99")],meta:{preferredVisualisationType:"table"}});const s=e.map(k);a.length=s.length;for(const e of s)for(const t of a.fields)t.values.push(e[t.name]);return a=(0,l.sortDataFrame)(a,0),[a]}const k=e=>{const t=e.errorSpanCount?G(e.errorSpanCount)/G(e.spanCount)*100:"0%",r={spanCount:G(e.spanCount),errorPercentage:t,p50:G(e.p50),p90:G(e.p90),p95:G(e.p95),p99:G(e.p99)};return e.series.forEach((e=>{r[`${e.key}`]=V(e)||""})),r},x=(e,t)=>{const r=e.map((e=>{const t=3===e.value.type||4===e.value.type,r=8===e.value.type||9===e.value.type,a=t||r?"":'"';return`${e.key}=${a}\${__data.fields["`+e.key+'"]}'+`${a}`}));let a="";const n=t.indexOf("}");if(-1!==n){const e=t.substring(n+1);a=t.substring(0,n),r.length>0&&(a+=t.replace(/\s/g,"").includes("{}")?"":" && ",a+=`${r.join(" && ")}`,a+="}"),a+=`${e}`}else a=`{${r.join(" && ")}} | ${t}`;return a},A=(e,t,r)=>{const a={displayNameFromDS:e.key,noValue:"<no value>",links:[{title:"Query in explore",url:"",internal:{datasourceUid:r.uid,datasourceName:r.name,query:{query:t,queryType:"traceql"}}}]};return 7===e.value.type?(n=R({},a),s=null!=(s={unit:"ns"})?s:{},Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):function(e){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t.push.apply(t,r)}return t}(Object(s)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(s,e))})),n):R({},a);var n,s},V=e=>{if(!e.value.type)return"";switch(e.value.type){case 3:return e.value.n;case 4:return e.value.f;case 5:return e.value.s;case 6:return e.value.b;case 7:return e.value.d;case 8:return q(e.value.status);case 9:return C(e.value.kind);default:return""}},q=e=>{if(!e)return"";switch(e){case 0:return"error";case 1:return"ok";default:return"unset"}},C=e=>{if(!e)return"";switch(e){case 1:return"internal";case 2:return"client";case 3:return"server";case 4:return"producer";case 5:return"consumer";default:return"unspecified"}},M=e=>({name:e,type:l.FieldType.number,config:{displayNameFromDS:e,unit:"ns",custom:{width:150}}}),G=e=>{const t=parseInt(e,10);return isNaN(t)?0:t},U=new l.MutableDataFrame({name:"Metrics Summary",refId:"metrics-summary",fields:[],meta:{preferredVisualisationType:"table"}});function Q(e){for(var t={},r=e.length,a=0;a<r;a++){var n=e[a];n&&(t[String(n).toUpperCase().replace(/[-.]/g,"_")]=n)}return t}var B=Q(["cloud.provider","cloud.account.id","cloud.region","cloud.availability_zone","cloud.platform","aws.ecs.container.arn","aws.ecs.cluster.arn","aws.ecs.launchtype","aws.ecs.task.arn","aws.ecs.task.family","aws.ecs.task.revision","aws.eks.cluster.arn","aws.log.group.names","aws.log.group.arns","aws.log.stream.names","aws.log.stream.arns","container.name","container.id","container.runtime","container.image.name","container.image.tag","deployment.environment","device.id","device.model.identifier","device.model.name","faas.name","faas.id","faas.version","faas.instance","faas.max_memory","host.id","host.name","host.type","host.arch","host.image.name","host.image.id","host.image.version","k8s.cluster.name","k8s.node.name","k8s.node.uid","k8s.namespace.name","k8s.pod.uid","k8s.pod.name","k8s.container.name","k8s.replicaset.uid","k8s.replicaset.name","k8s.deployment.uid","k8s.deployment.name","k8s.statefulset.uid","k8s.statefulset.name","k8s.daemonset.uid","k8s.daemonset.name","k8s.job.uid","k8s.job.name","k8s.cronjob.uid","k8s.cronjob.name","os.type","os.description","os.name","os.version","process.pid","process.executable.name","process.executable.path","process.command","process.command_line","process.command_args","process.owner","process.runtime.name","process.runtime.version","process.runtime.description","service.name","service.namespace","service.instance.id","service.version","telemetry.sdk.name","telemetry.sdk.language","telemetry.sdk.version","telemetry.auto.version","webengine.name","webengine.version","webengine.description"]);function X(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function J(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},a=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),a.forEach((function(t){X(e,t,r[t])}))}return e}function z(e){const{nodes:t,edges:r}=function(e){const t=[],r=[],a=new l.DataFrameView(e),n=function(e){let t=0,r=1/0;for(let a=0;a<e.length;a++){const n=e.get(a);n.startTime<r&&(r=n.startTime),n.startTime+n.duration>t&&(t=n.startTime+n.duration)}return t-r}(a),s=function(e){const t={};let r;for(let a=0;r=e(a),r;a++){t[r.id]?t[r.id].span=r.span:t[r.id]={span:r.span,children:[]};for(const e of r.parentIds)e&&(t[e]?t[e].children.push(r.id):t[e]={span:void 0,children:[r.id]})}return t}((t=>{if(t>=e.length)return;const r=a.get(t);return{span:J({},r),id:r.spanID,parentIds:r.parentSpanID?[r.parentSpanID]:[]}}));for(let e=0;e<a.length;e++){const o=a.get(e),u=H(s[o.spanID].children.map((e=>{const t=s[e].span;return[t.startTime,t.startTime+t.duration]}))),c=o.duration-u,p=W(o.duration,n,c);var i;t.push({[l.NodeGraphDataFrameFieldNames.id]:o.spanID,[l.NodeGraphDataFrameFieldNames.title]:null!==(i=o.serviceName)&&void 0!==i?i:"",[l.NodeGraphDataFrameFieldNames.subTitle]:o.operationName,[l.NodeGraphDataFrameFieldNames.mainStat]:p.main,[l.NodeGraphDataFrameFieldNames.secondaryStat]:p.secondary,[l.NodeGraphDataFrameFieldNames.color]:c/n}),o.parentSpanID&&s[o.parentSpanID].span&&r.push({[l.NodeGraphDataFrameFieldNames.id]:o.parentSpanID+"--"+o.spanID,[l.NodeGraphDataFrameFieldNames.target]:o.spanID,[l.NodeGraphDataFrameFieldNames.source]:o.parentSpanID})}return{nodes:t,edges:r}}(e),[a,n]=[new l.MutableDataFrame({fields:[{name:l.NodeGraphDataFrameFieldNames.id,type:l.FieldType.string},{name:l.NodeGraphDataFrameFieldNames.title,type:l.FieldType.string},{name:l.NodeGraphDataFrameFieldNames.subTitle,type:l.FieldType.string},{name:l.NodeGraphDataFrameFieldNames.mainStat,type:l.FieldType.string,config:{displayName:"Total time (% of trace)"}},{name:l.NodeGraphDataFrameFieldNames.secondaryStat,type:l.FieldType.string,config:{displayName:"Self time (% of total)"}},{name:l.NodeGraphDataFrameFieldNames.color,type:l.FieldType.number,config:{color:{mode:"continuous-GrYlRd"},displayName:"Self time / Trace duration"}}],meta:{preferredVisualisationType:"nodeGraph"}}),new l.MutableDataFrame({fields:[{name:l.NodeGraphDataFrameFieldNames.id,type:l.FieldType.string},{name:l.NodeGraphDataFrameFieldNames.target,type:l.FieldType.string},{name:l.NodeGraphDataFrameFieldNames.source,type:l.FieldType.string}],meta:{preferredVisualisationType:"nodeGraph"}})];for(const e of t)a.add(e);for(const e of r)n.add(e);return[a,n]}function H(e){return e.sort(((e,t)=>e[0]-t[0])),e.reduce(((e,t)=>{if(!e.length)return[t];const r=e.slice(-1)[0],[a,n]=r,[s,i]=t;return i<n?e:s>n?[...e,t]:[...e.slice(0,-1),[a,i]]}),[]).reduce(((e,t)=>e+(t[1]-t[0])),0)}function W(e,t,r){return{main:`${Y(e)}ms (${Y(e/t*100)}%)`,secondary:`${Y(r)}ms (${Y(r/e*100)}%)`}}function Y(e){return parseFloat(e.toFixed(2))}function Z(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function K(e){if(e.stringValue)return e.stringValue;if(void 0!==e.boolValue)return Boolean(e.boolValue);if(void 0!==e.intValue)return Number.parseInt(String(e.intValue),10);if(e.doubleValue)return Number.parseFloat(String(e.doubleValue));if(e.arrayValue){const t=[];for(const r of e.arrayValue.values)t.push(K(r));return t}return""}function ee(e){const t=[];let r="OTLPResourceNoServiceName";if(!e)return{serviceName:r,serviceTags:t};for(const a of e.attributes)a.key===B.SERVICE_NAME&&(r=a.value.stringValue||r),t.push({key:a.key,value:K(a.value)});return{serviceName:r,serviceTags:t}}function te(e){const t=[];if(e.attributes)for(const r of e.attributes)t.push({key:r.key,value:K(r.value)});return t}function re(e){let t;if(e.kind){const r=e.kind.toString().toLowerCase().split("_");t=r.length?r[r.length-1]:e.kind.toString()}return t}function ae(e){const t=[];if(e.links)for(const r of e.links){const{traceId:e,spanId:a}=r,n=[];if(r.attributes)for(const e of r.attributes)n.push({key:e.key,value:K(e.value)});t.push({traceID:e,spanID:a,tags:n})}return t}function ne(e){const t=[];if(e.events)for(const r of e.events){const e=[];if(r.attributes)for(const t of r.attributes)e.push({key:t.key,value:K(t.value)});t.push({fields:e,timestamp:r.timeUnixNano/1e6,name:r.name})}return t}function se(e,t,r=!1){const a=e.data[0];if(!a)return ce;const n=null==t?void 0:t.jsonData,s=null==n?void 0:n.tracesToProfiles;let i;if((null==s?void 0:s.datasourceUid)&&(i=(0,u.getDataSourceSrv)().getInstanceSettings(s.datasourceUid)),s&&i){const e=s.customQuery?s.query:void 0;var o;const t={title:"Related profiles",url:"",internal:{datasourceUid:i.uid,datasourceName:i.name,query:{labelSelector:e||"{${__tags}}",groupBy:[],profileTypeId:null!==(o=s.profileTypeId)&&void 0!==o?o:"",queryType:"profile",spanSelector:['${__span.tags["pyroscope.profile.id"]}'],refId:"profile"}},origin:l.DataLinkConfigOrigin.Datasource};a.fields.forEach((e=>{"tags"===e.name&&(e.config.links=[t])}))}let c=[...e.data];return r&&c.push(...z((0,l.toDataFrame)(a))),p=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},a=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),a.forEach((function(t){Z(e,t,r[t])}))}return e}({},e),d=null!=(d={data:c})?d:{},Object.getOwnPropertyDescriptors?Object.defineProperties(p,Object.getOwnPropertyDescriptors(d)):function(e){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t.push.apply(t,r)}return t}(Object(d)).forEach((function(e){Object.defineProperty(p,e,Object.getOwnPropertyDescriptor(d,e))})),p;var p,d}function ie(e,t,r){switch(r){case E.Jv.Spans:return function(e,t){const r={};let a=!1;null==e||e.forEach((e=>oe(e).forEach((e=>{var t;null===(t=e.attributes)||void 0===t||t.forEach((e=>{r[e.key]={name:e.key,type:l.FieldType.string,config:{displayNameFromDS:e.key}}})),e.spans.forEach((e=>{var t;e.name&&(a=!0),null===(t=e.attributes)||void 0===t||t.forEach((e=>{r[e.key]={name:e.key,type:l.FieldType.string,config:{displayNameFromDS:e.key}}}))}))}))));const n=new l.MutableDataFrame({name:"Spans",refId:"traces",fields:[{name:"traceIdHidden",type:l.FieldType.string,config:{custom:{hidden:!0}}},{name:"traceService",type:l.FieldType.string,config:{displayNameFromDS:"Trace Service",custom:{width:200}}},{name:"traceName",type:l.FieldType.string,config:{displayNameFromDS:"Trace Name",custom:{width:200}}},{name:"spanID",type:l.FieldType.string,config:{unit:"string",displayNameFromDS:"Span ID",custom:{width:200},links:[{title:"Span: ${__value.raw}",url:"",internal:{datasourceUid:t.uid,datasourceName:t.name,query:{query:"${__data.fields.traceIdHidden}",queryType:"traceql"},panelsState:{trace:{spanId:"${__value.raw}"}}}}]}},{name:"time",type:l.FieldType.time,config:{displayNameFromDS:"Start time"}},{name:"name",type:l.FieldType.string,config:{displayNameFromDS:"Name",custom:{hidden:!a}}},...Object.values(r).sort(((e,t)=>e.name.localeCompare(t.name))),{name:"duration",type:l.FieldType.number,config:{displayNameFromDS:"Duration",unit:"ns",custom:{width:120}}}],meta:{preferredVisualisationType:"table"}});return e&&e.length?(e.sort(((e,t)=>parseInt(null==t?void 0:t.startTimeUnixNano,10)/1e6-parseInt(null==e?void 0:e.startTimeUnixNano,10)/1e6)).forEach((e=>{oe(e).forEach((t=>{t.spans.forEach((r=>{n.add(ue(r,t,e))}))}))})),[n]):[n]}(e,t);case E.Jv.Raw:return function(e){return[(0,l.createDataFrame)({name:"Raw response",refId:"raw",fields:[{name:"response",type:l.FieldType.string,values:[JSON.stringify(e,null,2)]}]})]}(e);default:return function(e,t){const r=(0,l.createDataFrame)({name:"Traces",refId:"traces",fields:[{name:"traceID",type:l.FieldType.string,config:{unit:"string",displayNameFromDS:"Trace ID",custom:{width:200},links:[{title:"Trace: ${__value.raw}",url:"",internal:{datasourceUid:t.uid,datasourceName:t.name,query:{query:"${__value.raw}",queryType:"traceql"}}}]}},{name:"startTime",type:l.FieldType.time,config:{displayNameFromDS:"Start time",custom:{width:200}}},{name:"traceService",type:l.FieldType.string,config:{displayNameFromDS:"Service"}},{name:"traceName",type:l.FieldType.string,config:{displayNameFromDS:"Name"}},{name:"traceDuration",type:l.FieldType.number,config:{displayNameFromDS:"Duration",unit:"ms",custom:{width:120}}},{name:"nested",type:l.FieldType.nestedFrames}],meta:{preferredVisualisationType:"table",uniqueRowIdFields:[0]}});return(null==e?void 0:e.length)?(r.length=e.length,e.sort(((e,t)=>parseInt(null==t?void 0:t.startTimeUnixNano,10)/1e6-parseInt(null==e?void 0:e.startTimeUnixNano,10)/1e6)).forEach((e=>{const a=function(e){return{traceID:e.traceID,startTime:parseInt(e.startTimeUnixNano,10)/1e6,traceDuration:e.durationMs,traceService:e.rootServiceName||"",traceName:e.rootTraceName||""}}(e);r.fields[0].values.push(a.traceID),r.fields[1].values.push(a.startTime),r.fields[2].values.push(a.traceService),r.fields[3].values.push(a.traceName),r.fields[4].values.push(a.traceDuration?a.traceDuration:"<1ms"),e.spanSets?r.fields[5].values.push(e.spanSets.map((r=>le(e,r,t)))):e.spanSet&&r.fields[5].values.push([le(e,e.spanSet,t)])})),[r]):[r]}(e,t)}}const oe=e=>e.spanSets||(e.spanSet?[e.spanSet]:[]),le=(e,t,r)=>{var a;const n={};let s=!1;null===(a=t.attributes)||void 0===a||a.map((e=>{n[e.key]={name:e.key,type:l.FieldType.string,config:{displayNameFromDS:e.key},values:[]}})),t.spans.forEach((e=>{var t;e.name&&(s=!0),null===(t=e.attributes)||void 0===t||t.forEach((e=>{n[e.key]={name:e.key,type:l.FieldType.string,config:{displayNameFromDS:e.key},values:[]}}))}));const i=new l.MutableDataFrame({fields:[{name:"traceIdHidden",type:l.FieldType.string,config:{custom:{hidden:!0}},values:[]},{name:"spanID",type:l.FieldType.string,values:[],config:{unit:"string",displayNameFromDS:"Span ID",custom:{width:200},links:[{title:"Span: ${__value.raw}",url:"",internal:{datasourceUid:r.uid,datasourceName:r.name,query:{query:"${__data.fields.traceIdHidden}",queryType:"traceql"},panelsState:{trace:{spanId:"${__value.raw}"}}}}]}},{name:"time",type:l.FieldType.time,config:{displayNameFromDS:"Start time",custom:{width:200}}},{name:"name",type:l.FieldType.string,values:[],config:{displayNameFromDS:"Name",custom:{hidden:!s}}},...Object.values(n).sort(((e,t)=>e.name.localeCompare(t.name))),{name:"duration",type:l.FieldType.number,values:[],config:{displayNameFromDS:"Duration",unit:"ns",custom:{width:120}}}],meta:{preferredVisualisationType:"table"}}),o=(0,l.createTheme)();for(const e of i.fields)e.display=(0,l.getDisplayProcessor)({field:e,theme:o});return t.spans.forEach((r=>{i.add(ue(r,t,e))})),i};function ue(e,t,r){const a=parseInt(e.startTimeUnixNano,10)/1e6,n={traceIdHidden:r.traceID,traceService:r.rootServiceName||"",traceName:r.rootTraceName||"",spanID:e.spanID,time:a,duration:parseInt(e.durationNanos,10),name:e.name};let s=[];return t.attributes&&(s=s.concat(t.attributes)),e.attributes&&(s=s.concat(e.attributes)),s.forEach((e=>{var t,r,a,s,i,o,l,u;(e.value.boolValue||(null===(t=e.value.Value)||void 0===t?void 0:t.bool_value))&&(n[e.key]=e.value.boolValue||(null===(i=e.value.Value)||void 0===i?void 0:i.bool_value)),(e.value.doubleValue||(null===(r=e.value.Value)||void 0===r?void 0:r.double_value))&&(n[e.key]=e.value.doubleValue||(null===(o=e.value.Value)||void 0===o?void 0:o.double_value)),(e.value.intValue||(null===(a=e.value.Value)||void 0===a?void 0:a.int_value))&&(n[e.key]=e.value.intValue||(null===(l=e.value.Value)||void 0===l?void 0:l.int_value)),(e.value.stringValue||(null===(s=e.value.Value)||void 0===s?void 0:s.string_value))&&(n[e.key]=e.value.stringValue||(null===(u=e.value.Value)||void 0===u?void 0:u.string_value))})),n}const ce={data:[new l.MutableDataFrame({fields:[{name:"trace",type:l.FieldType.trace,values:[]}],meta:{preferredVisualisationType:"trace",custom:{traceFormat:"otlp"}}})]};var pe=r(6373);function de(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function me(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},a=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),a.forEach((function(t){de(e,t,r[t])}))}return e}function fe(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t.push.apply(t,r)}return t}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}function ve(e,t,r){const a=t.filter((t=>t.name===e.name));return 1===a.length?a[0]:e.labels?a.find((t=>{var r,a;return(0,l.shallowCompare)(null!==(r=e.labels)&&void 0!==r?r:{},null!==(a=t.labels)&&void 0!==a?a:{})})):t[r]}const ge="Summary: total bytes processed";function he(e,t){const r=e.find((e=>e.displayName===ge)),a=t.find((e=>e.displayName===ge));if(null!=a&&null!=r)return[{value:a.value+r.value,displayName:ge,unit:r.unit}];const n=null!=a?a:r;return null!=n?[n]:[]}function ye(e){return fe(me({},e),{data:e.data.map(be)})}function be(e){return fe(me({},e),{fields:e.fields.map((e=>fe(me({},e),{values:e.values})))})}var Ee=r(4340);function _e(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Se(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},a=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),a.forEach((function(t){_e(e,t,r[t])}))}return e}function Te(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t.push.apply(t,r)}return t}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}function we(){return(0,pe.A)()}function Ne(e,t,r){const a=r.range,s=we();let i=l.LoadingState.NotStarted;const o=(0,Ee.hO)(e.step);return(0,u.getGrafanaLiveSrv)().getStream({scope:l.LiveChannelScope.DataSource,namespace:t.uid,path:`metrics/${s}`,data:Te(Se({},e),{step:o,timeRange:{from:a.from.toISOString(),to:a.to.toISOString()}})}).pipe((0,n.takeWhile)((e=>{if("message"in e&&(null==e?void 0:e.message)){const t=e.message.data.values[2][0];if(t===E.O8.Done||t===E.O8.Error)return!1}return!0}),!0),(0,n.map)((e=>{let t={data:[],state:l.LoadingState.NotStarted};if("message"in e&&(null==e?void 0:e.message)){var r,a,n;const o=(0,l.dataFrameFromJSON)(e.message),u=new l.FieldCache(o),c=null===(r=u.getFieldByName("result"))||void 0===r?void 0:r.values[0],p=null===(a=u.getFieldByName("state"))||void 0===a?void 0:a.values[0],d=null===(n=u.getFieldByName("error"))||void 0===n?void 0:n.values[0];switch(p){case E.O8.Done:i=l.LoadingState.Done;break;case E.O8.Streaming:i=l.LoadingState.Streaming;break;case E.O8.Error:throw new Error(d)}var s;t={data:null!==(s=null==c?void 0:c.map(l.dataFrameFromJSON))&&void 0!==s?s:[],state:i}}return t})),(0,n.scan)(((e,t)=>t?e?function(e,t){const r=function(e,t){if(!e)return ye(t);var r,a;t.data.forEach((t=>{const r=e.data.find((e=>function(e,t){var r,a,n,s,i,o;if(e.refId!==t.refId||e.name!==t.name)return!1;const u=null===(r=e.meta)||void 0===r?void 0:r.type;if(u!==(null===(a=t.meta)||void 0===a?void 0:a.type))return!1;if(u===l.DataFrameType.TimeSeriesMulti){const r=e.fields.find((e=>e.type===l.FieldType.number)),a=t.fields.find((e=>e.type===l.FieldType.number));return void 0!==r&&void 0!==a&&(0,l.shallowCompare)(null!==(c=r.labels)&&void 0!==c?c:{},null!==(p=a.labels)&&void 0!==p?p:{});var c,p}const d=null===(s=e.meta)||void 0===s||null===(n=s.custom)||void 0===n?void 0:n.frameType,m=null===(o=t.meta)||void 0===o||null===(i=o.custom)||void 0===i?void 0:i.frameType;return"LabeledTimeValues"===d&&"LabeledTimeValues"===m||d===m}(e,t)));r?function(e,t){var r,a;const n=Math.max(e.fields.length,t.fields.length);for(let r=0;r<n;r++){if(!e.fields[r])continue;const a=ve(e.fields[r],t.fields,r);if(a&&(e.fields[r].values=[].concat.apply(a.values,e.fields[r].values),a.nanos)){var s,i;const a=(null===(s=e.fields[r].nanos)||void 0===s?void 0:s.slice())||[];e.fields[r].nanos=null===(i=t.fields[r].nanos)||void 0===i?void 0:i.concat(a)}}var o,l;e.length+=t.length,e.meta=fe(me({},e.meta),{stats:he(null!==(o=null===(r=e.meta)||void 0===r?void 0:r.stats)&&void 0!==o?o:[],null!==(l=null===(a=t.meta)||void 0===a?void 0:a.stats)&&void 0!==l?l:[])})}(r,t):e.data.push(be(t))}));const n=[...null!==(r=e.errors)&&void 0!==r?r:[],...null!==(a=t.errors)&&void 0!==a?a:[]];var s;n.length>0&&(e.errors=n);const i=null!==(s=e.error)&&void 0!==s?s:t.error;var o,u;null!=i&&(e.error=i);const c=[...null!==(o=e.traceIds)&&void 0!==o?o:[],...null!==(u=t.traceIds)&&void 0!==u?u:[]];return c.length>0&&(e.traceIds=c),e}(ye(e),t);return r.data=r.data.map((e=>{let t=e;const r=e.fields.findIndex((e=>e.type===l.FieldType.time));return r>=0&&(function(e,t){const r=e.fields[t].values.reduce(((e,t,r)=>(e[t]?e[t].push(r):e[t]=[r],e)),{}),a=Object.values(r).filter((e=>e.length>1)).map((e=>e.slice(1))).flat();e.fields.forEach((e=>{e.values=e.values.filter(((e,t)=>!a.includes(t)))}))}(e,r),t=(0,l.sortDataFrame)(e,r)),t})),r.state=t.state,r}(e,t):ye(t):e)))}function Oe(e,t,r){const n={steps:[{color:"blue",value:-1/0},{color:"green",value:75}],mode:l.ThresholdsMode.Absolute};return{refId:"streaming-progress",name:"Streaming Progress",length:1,fields:[{name:"state",type:l.FieldType.string,values:[(0,a.capitalize)(t.toString())],config:{displayNameFromDS:"State"}},{name:"elapsedTime",type:l.FieldType.number,values:[r],config:{unit:"ms",displayNameFromDS:"Elapsed Time"}},{name:"totalBlocks",type:l.FieldType.number,values:[e.totalBlocks],config:{displayNameFromDS:"Total Blocks"}},{name:"completedJobs",type:l.FieldType.number,values:[e.completedJobs],config:{displayNameFromDS:"Completed Jobs"}},{name:"totalJobs",type:l.FieldType.number,values:[e.totalJobs],config:{displayNameFromDS:"Total Jobs"}},{name:"progress",type:l.FieldType.number,values:[t===E.O8.Done?100:(e.completedJobs||0)/(e.totalJobs||1)*100],config:{displayNameFromDS:"Progress",unit:"percent",min:0,max:100,custom:{cellOptions:{type:"gauge",mode:"gradient"}},thresholds:n}}],meta:{preferredVisualisationType:"table"}}}function Ie(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class $e extends l.CustomVariableSupport{query(e){if(!this.datasource)throw new Error("Datasource not initialized");const t=this.datasource.executeVariableQuery(e.targets[0]);return(0,n.from)(t).pipe((0,s.map)((e=>({data:e}))))}constructor(e){super(),Ie(this,"datasource",void 0),Ie(this,"editor",void 0),this.datasource=e,this.editor=b}}function Fe(e,t,r,a,n,s,i){try{var o=e[s](i),l=o.value}catch(e){return void r(e)}o.done?t(l):Promise.resolve(l).then(a,n)}function De(e){return function(){var t=this,r=arguments;return new Promise((function(a,n){var s=e.apply(t,r);function i(e){Fe(s,a,n,i,o,"next",e)}function o(e){Fe(s,a,n,i,o,"throw",e)}i(void 0)}))}}function Pe(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function je(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},a=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),a.forEach((function(t){Pe(e,t,r[t])}))}return e}function Re(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t.push.apply(t,r)}return t}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const Le=20,ke=3;var xe=function(e){return e.searchStreaming="searchStreaming",e.metricsStreaming="metricsStreaming",e}({});const Ae={searchStreaming:"2.2.0",metricsStreaming:"2.7.0"};class Ve extends u.DataSourceWithBackend{executeVariableQuery(e){var t=this;return De((function*(){if(void 0===e.type)return new Promise((()=>[]));switch(e.type){case g.LabelNames:return yield t.labelNamesQuery();case g.LabelValues:return t.labelValuesQuery(e.label);default:throw Error("Invalid query type: "+e.type)}}))()}labelNamesQuery(){var e=this;return De((function*(){return yield e.languageProvider.fetchTags(),e.languageProvider.getAutocompleteTags().filter((e=>void 0!==e)).map((e=>({text:e})))}))()}labelValuesQuery(e){var t=this;return De((function*(){if(!e)return[];let r;try{var a;const n=null===(a=(t.languageProvider.tagsV2||[]).flatMap((e=>e.tags.map((t=>({scope:e.name,name:t}))))).find((t=>t.name===e)))||void 0===a?void 0:a.scope;if(!n)throw Error(`Scope for tag ${e} not found`);const s="intrinsic"===n?e:`${n}.${e}`;r=yield t.languageProvider.getOptionsV2(s)}catch(a){r=yield t.languageProvider.getOptionsV1(e)}return r.flatMap((e=>void 0!==e.value?[{text:e.value}]:[]))}))()}getTagKeys(){var e=this;return De((function*(){return yield e.languageProvider.fetchTags(),(e.languageProvider.tagsV2||[]).map((({name:e,tags:t})=>t.filter((e=>void 0!==e)).map((t=>"intrinsic"!==e?`${e}.${t}`:`${t}`)))).flat().map((e=>({text:e})))}))()}getTagValues(e){const t=(0,p.yV)(e.filters,this.languageProvider);return this.tagValuesQuery(e.key,t)}tagValuesQuery(e,t){var r=this;return De((function*(){let a;try{a=yield r.languageProvider.getOptionsV2(e,t)}catch(t){a=yield r.languageProvider.getOptionsV1((0,p.Jy)(e))}return a.flatMap((e=>void 0!==e.value?[{text:e.value}]:[]))}))()}isFeatureAvailable(e){var t;const r=null!==(t=this.tempoVersion)&&void 0!==t?t:"2.1.0";try{return o().gte(r,Ae[e])}catch(e){return!0}}isStreamingSearchEnabled(){var e;return(null===(e=this.streamingEnabled)||void 0===e?void 0:e.search)&&u.config.liveEnabled}isStreamingMetricsEnabled(){var e;return(null===(e=this.streamingEnabled)||void 0===e?void 0:e.metrics)&&u.config.liveEnabled}isTraceQlMetricsQuery(e){return!!e.trim().match(/\|\s*(rate|count_over_time|avg_over_time|max_over_time|min_over_time|quantile_over_time|histogram_over_time|compare)\s*\(/)}isTraceIdQuery(e){return!!e.trim().match(/^[0-9A-Fa-f]*$/)}query(e){var t,r,i,o,p,d;const m=[],f=e.targets.filter((e=>!e.hide)),v=(0,a.groupBy)(f,(e=>e.queryType||"traceql"));if(v.clear)return(0,n.of)({data:[],state:l.LoadingState.Done});if((null===(t=v.nativeSearch)||void 0===t?void 0:t.length)&&(v.nativeSearch[0].spanName||v.nativeSearch[0].serviceName||v.nativeSearch[0].search||v.nativeSearch[0].maxDuration||v.nativeSearch[0].minDuration||"nativeSearch"===v.nativeSearch[0].queryType)){var g;const e=(0,Ee.d6)(v.nativeSearch[0]);(null===(g=v.traceqlSearch)||void 0===g?void 0:g.length)?v.traceqlSearch.push(e):v.traceqlSearch=[e]}if(null===(r=v.traceql)||void 0===r?void 0:r.length)try{const t=this.applyVariables(v.traceql[0],e.scopedVars),r=(null==t?void 0:t.query)||"";var h,y,b;this.isTraceIdQuery(r)?((0,u.reportInteraction)("grafana_traces_traceID_queried",{datasourceType:"tempo",app:null!==(h=e.app)&&void 0!==h?h:"",grafana_version:u.config.buildInfo.version,hasQuery:""!==r}),m.push(this.handleTraceIdQuery(e,v.traceql))):this.isTraceQlMetricsQuery(r)?((0,u.reportInteraction)("grafana_traces_traceql_metrics_queried",{datasourceType:"tempo",app:null!==(y=e.app)&&void 0!==y?y:"",grafana_version:u.config.buildInfo.version,query:null!=r?r:"",streaming:this.isStreamingMetricsEnabled()}),this.isStreamingMetricsEnabled()?m.push(this.handleMetricsStreamingQuery(e,v.traceql,r)):m.push(this.handleTraceQlMetricsQuery(e,v.traceql))):((0,u.reportInteraction)("grafana_traces_traceql_queried",{datasourceType:"tempo",app:null!==(b=e.app)&&void 0!==b?b:"",grafana_version:u.config.buildInfo.version,query:null!=r?r:"",streaming:this.isStreamingSearchEnabled()}),m.push(this.handleTraceQlQuery(e,v,r)))}catch(e){return(0,n.of)({error:{message:e instanceof Error?e.message:"Unknown error occurred"},data:[]})}if(null===(i=v.traceqlSearch)||void 0===i?void 0:i.length)try{if(u.config.featureToggles.metricsSummary){const t=v.traceqlSearch.find((e=>this.hasGroupBy(e)));if(t){const r=this.applyVariables(t,e.scopedVars),a=this.languageProvider.generateQueryFromFilters(r.filters);m.push(this.handleMetricsSummaryQuery(r,a,e))}}const t=u.config.featureToggles.metricsSummary?v.traceqlSearch.filter((e=>!this.hasGroupBy(e))):v.traceqlSearch;if(t.length>0){const r=this.applyVariables(t[0],e.scopedVars),a=this.languageProvider.generateQueryFromFilters(r.filters);var E,w,F;(0,u.reportInteraction)("grafana_traces_traceql_search_queried",{datasourceType:"tempo",app:null!==(E=e.app)&&void 0!==E?E:"",grafana_version:u.config.buildInfo.version,query:null!=a?a:"",streaming:this.isStreamingSearchEnabled()}),this.isStreamingSearchEnabled()?m.push(this.handleStreamingQuery(e,t,a)):m.push(this._request("/api/search",{q:a,limit:null!==(w=e.targets[0].limit)&&void 0!==w?w:Le,spss:null!==(F=e.targets[0].spss)&&void 0!==F?F:ke,start:e.range.from.unix(),end:e.range.to.unix()}).pipe((0,s.map)((e=>({data:ie(e.data.traces,this.instanceSettings,v.traceqlSearch[0].tableType)}))),(0,s.catchError)((e=>(0,n.of)({error:{message:(0,Ee.u1)(e.data.message)},data:[]})))))}}catch(e){return(0,n.of)({error:{message:e instanceof Error?e.message:"Unknown error occurred"},data:[]})}if(null===(o=v.upload)||void 0===o?void 0:o.length)if(this.uploadedJson){var j;(0,u.reportInteraction)("grafana_traces_json_file_uploaded",{datasourceType:"tempo",app:null!==(j=e.app)&&void 0!==j?j:"",grafana_version:u.config.buildInfo.version});const t=JSON.parse(this.uploadedJson),r=t.batches,a=Array.isArray(t)&&t.some((e=>{var t;return"nodeGraph"===(null==e||null===(t=e.meta)||void 0===t?void 0:t.preferredVisualisationType)}));var R;r?m.push((0,n.of)(function(e,t=!1){const r=new l.MutableDataFrame({fields:[{name:"traceID",type:l.FieldType.string,values:[]},{name:"spanID",type:l.FieldType.string,values:[]},{name:"parentSpanID",type:l.FieldType.string,values:[]},{name:"operationName",type:l.FieldType.string,values:[]},{name:"serviceName",type:l.FieldType.string,values:[]},{name:"kind",type:l.FieldType.string,values:[]},{name:"statusCode",type:l.FieldType.number,values:[]},{name:"statusMessage",type:l.FieldType.string,values:[]},{name:"instrumentationLibraryName",type:l.FieldType.string,values:[]},{name:"instrumentationLibraryVersion",type:l.FieldType.string,values:[]},{name:"traceState",type:l.FieldType.string,values:[]},{name:"serviceTags",type:l.FieldType.other,values:[]},{name:"startTime",type:l.FieldType.number,values:[]},{name:"duration",type:l.FieldType.number,values:[]},{name:"logs",type:l.FieldType.other,values:[]},{name:"references",type:l.FieldType.other,values:[]},{name:"tags",type:l.FieldType.other,values:[]}],meta:{preferredVisualisationType:"trace",custom:{traceFormat:"otlp"}}});try{for(const t of e){const{serviceName:e,serviceTags:o}=ee(t.resource);for(const l of t.instrumentationLibrarySpans)for(const t of l.spans){var a,n,s,i;r.add({traceID:t.traceId.length>16?t.traceId.slice(16):t.traceId,spanID:t.spanId,parentSpanID:t.parentSpanId||"",operationName:t.name||"",serviceName:e,kind:re(t),statusCode:null===(a=t.status)||void 0===a?void 0:a.code,statusMessage:null===(n=t.status)||void 0===n?void 0:n.message,instrumentationLibraryName:null===(s=l.instrumentationLibrary)||void 0===s?void 0:s.name,instrumentationLibraryVersion:null===(i=l.instrumentationLibrary)||void 0===i?void 0:i.version,traceState:t.traceState,serviceTags:o,startTime:t.startTimeUnixNano/1e6,duration:(t.endTimeUnixNano-t.startTimeUnixNano)/1e6,tags:te(t),logs:ne(t),references:ae(t)})}}}catch(e){return console.error(e),{error:{message:"JSON is not valid OpenTelemetry format: "+e},data:[]}}let o=[r];return t&&o.push(...z(r)),{data:o}}(t.batches,null===(R=this.nodeGraph)||void 0===R?void 0:R.enabled))):a?m.push((0,n.of)({data:t,state:l.LoadingState.Done})):m.push((0,n.of)({error:{message:"Unable to parse uploaded data."},data:[]}))}else m.push((0,n.of)({data:[],state:l.LoadingState.Done}));if((null===(p=this.serviceMap)||void 0===p?void 0:p.datasourceUid)&&(null===(d=v.serviceMap)||void 0===d?void 0:d.length)>0){var L;(0,u.reportInteraction)("grafana_traces_service_graph_queried",{datasourceType:"tempo",app:null!==(L=e.app)&&void 0!==L?L:"",grafana_version:u.config.buildInfo.version,hasServiceMapQuery:!!v.serviceMap[0].serviceMapQuery});const t=this.serviceMap.datasourceUid,r=this.uid;m.push((k=e,x=t,A=r,qe(Be(k),x).pipe((0,s.toArray)(),(0,s.map)((e=>{const t=e.find((e=>!!e.error));var r;if(t)throw new Error((0,Ee.u1)(null===(r=t.error)||void 0===r?void 0:r.message));const{nodes:a,edges:n}=function(e){const t=function(e){var t;return((null===(t=e[0])||void 0===t?void 0:t.data)||[]).reduce(((e,t)=>{const r=(0,l.toDataFrame)(t);var a;return e[null!==(a=r.refId)&&void 0!==a?a:"A"]=new l.DataFrameView(r),e}),{})}(e),r={},a={};return D(t[S],"total",S,r,a),D(t[_],"seconds",_,r,a),D(t[T],"failed",T,r,a),P(t[`${S}_labels`],r),P(t[`${_}_labels`],r),P(t[`${T}_labels`],r),function(e,t){const[r,a]=function(){function e(e,t){return new l.MutableDataFrame({name:e,fields:t,meta:{preferredVisualisationType:"nodeGraph"}})}return[e("Nodes",[{name:l.NodeGraphDataFrameFieldNames.id,type:l.FieldType.string,values:[]},{name:l.NodeGraphDataFrameFieldNames.title,type:l.FieldType.string,config:{displayName:"Service name"},values:[]},{name:l.NodeGraphDataFrameFieldNames.subTitle,type:l.FieldType.string,config:{displayName:"Service namespace"},values:[]},{name:l.NodeGraphDataFrameFieldNames.mainStat,type:l.FieldType.number,config:{unit:"ms/r",displayName:"Average response time"},values:[]},{name:l.NodeGraphDataFrameFieldNames.secondaryStat,type:l.FieldType.number,config:{unit:"r/sec",displayName:"Requests per second"},values:[]},{name:l.NodeGraphDataFrameFieldNames.arc+"success",type:l.FieldType.number,config:{displayName:"Success",color:{fixedColor:"green",mode:l.FieldColorModeId.Fixed}},values:[]},{name:l.NodeGraphDataFrameFieldNames.arc+"failed",type:l.FieldType.number,config:{displayName:"Failed",color:{fixedColor:"red",mode:l.FieldColorModeId.Fixed}},values:[]},{name:l.NodeGraphDataFrameFieldNames.isInstrumented,type:l.FieldType.boolean,values:[]}]),e("Edges",[{name:l.NodeGraphDataFrameFieldNames.id,type:l.FieldType.string,values:[]},{name:l.NodeGraphDataFrameFieldNames.source,type:l.FieldType.string,values:[]},{name:"sourceName",type:l.FieldType.string,values:[]},{name:"sourceNamespace",type:l.FieldType.string,values:[]},{name:l.NodeGraphDataFrameFieldNames.target,type:l.FieldType.string,values:[]},{name:"targetName",type:l.FieldType.string,values:[]},{name:"targetNamespace",type:l.FieldType.string,values:[]},{name:l.NodeGraphDataFrameFieldNames.mainStat,type:l.FieldType.number,config:{unit:"ms/r",displayName:"Average response time"},values:[]},{name:l.NodeGraphDataFrameFieldNames.secondaryStat,type:l.FieldType.number,config:{unit:"r/sec",displayName:"Requests per second"},values:[]}])]}();for(const t of Object.keys(e)){const a=e[t];var n;r.add({[l.NodeGraphDataFrameFieldNames.id]:t,[l.NodeGraphDataFrameFieldNames.title]:a.name,[l.NodeGraphDataFrameFieldNames.subTitle]:a.namespace,[l.NodeGraphDataFrameFieldNames.mainStat]:a.total?a.seconds/a.total*1e3:Number.NaN,[l.NodeGraphDataFrameFieldNames.secondaryStat]:a.total?Math.round(100*a.total)/100:Number.NaN,[l.NodeGraphDataFrameFieldNames.arc+"success"]:a.total?(a.total-Math.min(a.failed||0,a.total))/a.total:1,[l.NodeGraphDataFrameFieldNames.arc+"failed"]:a.total?Math.min(a.failed||0,a.total)/a.total:0,[l.NodeGraphDataFrameFieldNames.isInstrumented]:null===(n=a.isInstrumented)||void 0===n||n})}for(const e of Object.keys(t)){const r=t[e];a.add({[l.NodeGraphDataFrameFieldNames.id]:e,[l.NodeGraphDataFrameFieldNames.source]:r.source,sourceName:r.sourceName,sourceNamespace:r.sourceNamespace,[l.NodeGraphDataFrameFieldNames.target]:r.target,targetName:r.targetName,targetNamespace:r.targetNamespace,[l.NodeGraphDataFrameFieldNames.mainStat]:r.total?r.seconds/r.total*1e3:Number.NaN,[l.NodeGraphDataFrameFieldNames.secondaryStat]:r.total?Math.round(100*r.total)/100:Number.NaN})}return{nodes:r,edges:a}}(r,a)}(e,k.range);if(a.fields.length>0&&n.fields.length>0){const e=a.fields[0].values.length,t=n.fields[0].values.length;(0,u.reportInteraction)("grafana_traces_service_graph_size",{datasourceType:"tempo",grafana_version:u.config.buildInfo.version,nodeLength:e,edgeLength:t})}const{serviceMapIncludeNamespace:s,refId:i}=k.targets[0];return a.refId=i,n.refId=i,s?(a.fields[0].config=Ge(x,A,"__data.fields.title",0,void 0,{targetNamespace:"__data.fields.subtitle"}),n.fields[0].config=Ge(x,A,"__data.fields.targetName",0,"__data.fields.sourceName",{targetNamespace:"__data.fields.targetNamespace",sourceNamespace:"__data.fields.sourceNamespace"})):(a.fields[0].config=Ge(x,A,"__data.fields.id"),n.fields[0].config=Ge(x,A,"__data.fields.target",0,"__data.fields.source")),{nodes:a,edges:n,state:l.LoadingState.Done}})))).pipe((0,s.concatMap)((a=>function(e,t,r){const a=Be(e);return a.targets=He([Xe(N,$,e)]),qe(a,r).pipe((0,s.toArray)(),(0,s.map)((e=>{var r;const a=e.find((e=>!!e.error));var n,s;if(a)throw new Error((0,Ee.u1)(null===(n=a.error)||void 0===n?void 0:n.message));return{rates:null!==(s=null===(r=e[0])||void 0===r?void 0:r.data)&&void 0!==s?s:[],nodes:t.nodes,edges:t.edges}})))}(e,a,t).pipe((0,s.concatMap)((a=>function(e,t,r,a){let n=[],i="",o=[],u=[];if(t.rates[0]&&e.app===l.CoreApp.Explore){const e=t.rates[0].fields.find((e=>"span_name"===e.name));e&&e.values&&(u=e.values)}else t.rates&&t.rates.map((e=>{const t=e.fields.find((e=>{var t;return null===(t=e.labels)||void 0===t?void 0:t.span_name}));var r;t&&u.push(null===(r=t.labels)||void 0===r?void 0:r.span_name)}));const p=Me(u);p.length>0&&(i=Xe(O,'span_name=~"'+p.join("|")+'"',e),n.push(i),p.map((t=>{const r=Xe(I,'span_name=~"'+t+'"',e);o.push(r),n.push(r)})));const d=Be(e);return d.targets=He(n),qe(d,r).pipe((0,s.toArray)(),(0,s.map)((n=>{const s=n.find((e=>!!e.error));var u;if(s)throw new Error((0,Ee.u1)(null===(u=s.error)||void 0===u?void 0:u.message));const p=function(e,t,r,a,n,s,i){var o,u;let p={fields:[]};const d=t.rates.filter((t=>t.refId===Xe(N,$,e))),m=r.data.filter((e=>e.refId===a)),f=r.data.filter((e=>{var t;return n.includes(null!==(t=e.refId)&&void 0!==t?t:"")}));if(d.length>0&&(null===(o=d[0].fields)||void 0===o?void 0:o.length)>2&&(p.fields.push(Re(je({},d[0].fields[1]),{name:"Name",config:{filterable:!1}})),p.fields.push(Re(je({},d[0].fields[2]),{name:"Rate",config:{links:[Ce("Rate",Je(Xe(N,'span_name="${__data.fields[0]}"',e)),s,!1)],decimals:2}})),p.fields.push(Re(je({},d[0].fields[2]),{name:"  ",labels:null,config:{color:{mode:"continuous-BlPu"},custom:{cellOptions:{mode:c.eX.Lcd,type:c.ob.Gauge}},decimals:3}}))),m.length>0&&(null===(u=m[0].fields)||void 0===u?void 0:u.length)>2){var v,g,h;const t=null!==(h=null===(v=m[0].fields[1])||void 0===v?void 0:v.values)&&void 0!==h?h:[];var y;const r=null!==(y=null===(g=m[0].fields[2])||void 0===g?void 0:g.values)&&void 0!==y?y:[];let a={};t.map(((e,t)=>{a[e]={value:r[t]}}));const n=ze(je({},d),a);p.fields.push(Re(je({},m[0].fields[2]),{name:"Error Rate",values:n,config:{links:[Ce("Error Rate",Je(Xe(O,'span_name="${__data.fields[0]}"',e)),s,!1)],decimals:2}})),p.fields.push(Re(je({},m[0].fields[2]),{name:"   ",values:n,labels:null,config:{color:{mode:"continuous-RdYlGr"},custom:{cellOptions:{mode:c.eX.Lcd,type:c.ob.Gauge}},decimals:3}}))}if(f.length>0){let t={};f.forEach((e=>{if(e.fields.length>1){var r,a;const n=(null===(r=e.refId)||void 0===r?void 0:r.includes('span_name=~"'))?'span_name=~"':'span_name="',s=null===(a=e.refId)||void 0===a?void 0:a.split(n)[1].split('"}')[0];t[s]={value:e.fields[1].values[0]}}})),Object.keys(t).length>0&&p.fields.push(Re(je({},f[0].fields[1]),{name:"Duration (p90)",values:ze(je({},d),t),config:{links:[Ce("Duration",Je(Xe(I,'span_name="${__data.fields[0]}"',e)),s,!1)],unit:"s"}}))}return p.fields.length>0&&p.fields[0].values&&p.fields.push({name:"Links",type:l.FieldType.string,values:p.fields[0].values.map((()=>"Tempo")),config:{links:[Ue("Tempo",void 0,"","${__data.fields[0]}",i)]}}),p}(e,t,n[0],i,o,r,a);return 0===p.fields.length?{data:[t.nodes,t.edges],state:l.LoadingState.Done}:{data:[p,t.nodes,t.edges],state:l.LoadingState.Done}})))}(e,a,t,r))))))))}var k,x,A;return(0,n.merge)(...m)}applyTemplateVariables(e,t){return this.applyVariables(e,t)}interpolateVariablesInQueries(e,t){return e&&0!==e.length?e.map((e=>je(Re(je({},e),{datasource:this.getRef()}),this.applyVariables(e,t)))):[]}applyVariables(e,t){const r=je({},e);var a,n;return e.filters&&(r.filters=(0,p.tH)(e.filters,t)),e.groupBy&&(r.groupBy=e.groupBy.map((e=>{var r;return Re(je({},e),{tag:this.templateSrv.replace(null!==(r=e.tag)&&void 0!==r?r:"",t)})}))),Re(je({},r),{query:this.templateSrv.replace(null!==(a=e.query)&&void 0!==a?a:"",t,c.$m.Pipe),serviceMapQuery:Array.isArray(e.serviceMapQuery)?e.serviceMapQuery.map((e=>this.templateSrv.replace(e,t))):this.templateSrv.replace(null!==(n=e.serviceMapQuery)&&void 0!==n?n:"",t)})}handleTraceIdQuery(e,t){const r=t.filter((e=>e.query)).map((e=>{var t;return Re(je({},e),{query:null===(t=e.query)||void 0===t?void 0:t.trim(),queryType:"traceId"})}));if(!r.length)return n.EMPTY;const a=this.makeTraceIdRequest(e,r);return super.query(a).pipe((0,s.map)((e=>{var t;return e.error?e:se(e,this.instanceSettings,null===(t=this.nodeGraph)||void 0===t?void 0:t.enabled)})))}handleTraceQlMetricsQuery(e,t){const r=t.filter((e=>e.query)).map((t=>Re(je({},t),{query:this.applyVariables(t,e.scopedVars).query,queryType:"traceql"})));if(!r.length)return n.EMPTY;const a=Re(je({},e),{targets:r});return super.query(a).pipe((0,s.map)((e=>{return t=e,r=this.instanceSettings,null===(a=t.data)||void 0===a||a.filter((e=>{var t;return"exemplar"===e.name&&"annotations"===(null===(t=e.meta)||void 0===t?void 0:t.dataTopic)})).map((e=>{const t=e.fields.find((e=>"traceId"===e.name));if(t){var a;const e=function(e){const t=[];var r;return e.uid&&t.push({title:"View trace",url:"",internal:{query:{query:"${__value.raw}",queryType:"traceql"},datasourceUid:e.uid,datasourceName:null!==(r=null==e?void 0:e.name)&&void 0!==r?r:"Data source not found"}}),t}(r);t.config.links=(null===(a=t.config.links)||void 0===a?void 0:a.length)?[...t.config.links,...e]:e}return e})),t;var t,r,a})),(0,s.catchError)((e=>(0,n.of)({error:{message:(0,Ee.u1)(e.data.message)},data:[]}))))}handleStreamingQuery(e,t,r){return""===r?n.EMPTY:(0,n.merge)(...t.map((t=>function(e,t,r,a){const s=r.range;let i,o=l.LoadingState.NotStarted;const c=performance.now();var p;return(0,u.getGrafanaLiveSrv)().getStream({scope:l.LiveChannelScope.DataSource,namespace:t.uid,path:`search/${we()}`,data:Te(Se({},e),{SpansPerSpanSet:null!==(p=e.spss)&&void 0!==p?p:ke,timeRange:{from:s.from.toISOString(),to:s.to.toISOString()}})}).pipe((0,n.takeWhile)((e=>{if("message"in e&&(null==e?void 0:e.message)){const t=e.message.data.values[2][0];if(t===E.O8.Done||t===E.O8.Error)return!1}return!0}),!0)).pipe((0,n.map)((t=>{if("message"in t&&(null==t?void 0:t.message)){var r,n,s,u;const p=performance.now()-c,d=(0,l.dataFrameFromJSON)(t.message),m=new l.FieldCache(d),f=null===(r=m.getFieldByName("result"))||void 0===r?void 0:r.values[0],v=null===(n=m.getFieldByName("metrics"))||void 0===n?void 0:n.values[0],g=null===(s=m.getFieldByName("state"))||void 0===s?void 0:s.values[0],h=null===(u=m.getFieldByName("error"))||void 0===u?void 0:u.values[0];switch(g){case E.O8.Done:o=l.LoadingState.Done;break;case E.O8.Streaming:o=l.LoadingState.Streaming;break;case E.O8.Error:throw new Error(h)}i=[...ie(f,a,e.tableType),Oe(v,g,p)]}return{data:i||[],state:o}})))}(Re(je({},t),{query:r}),this,e,this.instanceSettings))))}handleMetricsStreamingQuery(e,t,r){return""===r?n.EMPTY:(0,n.merge)(...t.map((t=>Ne(Re(je({},t),{query:r}),this,e))))}makeTraceIdRequest(e,t){var r;const a=Re(je({},e),{targets:t});var n,s;return(null===(r=this.traceQuery)||void 0===r?void 0:r.timeShiftEnabled)?a.range=e.range&&Re(je({},e.range),{from:(0,l.dateTime)(e.range.from).subtract(l.rangeUtil.intervalToMs((null===(n=this.traceQuery)||void 0===n?void 0:n.spanStartTimeShift)||"30m"),"milliseconds"),to:(0,l.dateTime)(e.range.to).add(l.rangeUtil.intervalToMs((null===(s=this.traceQuery)||void 0===s?void 0:s.spanEndTimeShift)||"30m"),"milliseconds")}):a.range={from:(0,l.dateTime)(0),to:(0,l.dateTime)(0),raw:{from:(0,l.dateTime)(0),to:(0,l.dateTime)(0)}},a}metadataRequest(e,t={}){var r=this;return De((function*(){return yield(0,n.lastValueFrom)(r._request(e,t,{method:"GET",hideFromInspector:!0}))}))()}_request(e,t,r){const a=t?l.urlUtil.serializeParams(t):"",n=`${this.instanceSettings.url}${e}${a.length?`?${a}`:""}`,s=Re(je({},r),{url:n});return(0,u.getBackendSrv)().fetch(s)}testDatasource(){var e=this;return De((function*(){var t;const r=[],a={headers:{},method:"GET",url:`${e.instanceSettings.url}/api/echo`};if(r.push((0,u.getBackendSrv)().fetch(a).pipe((0,s.mergeMap)((()=>(0,n.of)({status:"success",message:"Health check succeeded"}))),(0,s.catchError)((e=>(0,n.of)({status:"error",message:(0,Ee.u1)(e.data.message,"Unable to connect with Tempo")}))))),null===(t=e.streamingEnabled)||void 0===t?void 0:t.search){const t=new Date,a=new Date(t);a.setMinutes(a.getMinutes()-15),r.push(e.handleStreamingQuery({range:{from:(0,l.dateTime)(a),to:(0,l.dateTime)(t),raw:{from:"now-15m",to:"now"}},requestId:"",interval:"",intervalMs:0,scopedVars:{},targets:[],timezone:"",app:"",startTime:0},[{datasource:e.instanceSettings,limit:1,query:"{}",queryType:"traceql",refId:"A",tableType:E.Jv.Traces,filters:[]}],"{}").pipe((0,s.mergeMap)((()=>(0,n.of)({status:"success",message:"Streaming test succeeded."}))),(0,s.catchError)((e=>(0,n.of)({status:"error",message:(0,Ee.u1)(e.data.message,"Test for streaming failed, consider disabling streaming")})))))}return yield(0,n.lastValueFrom)((0,n.forkJoin)(r).pipe((0,s.mergeMap)((e=>{const t=e.find((e=>"success"!==e.status));return t?(0,n.of)(t):(0,n.of)({status:"success",message:"Successfully connected to Tempo data source."})}))))}))()}getQueryDisplayText(e){var t;if("traceql"===e.queryType||"traceId"===e.queryType)return null!==(t=e.query)&&void 0!==t?t:"";const r=this.applyVariables(e,{});return this.languageProvider.generateQueryFromFilters(r.filters)}constructor(e,t=(0,u.getTemplateSrv)()){var r,a;super(e),r=this,Pe(this,"instanceSettings",void 0),Pe(this,"templateSrv",void 0),Pe(this,"tracesToLogs",void 0),Pe(this,"serviceMap",void 0),Pe(this,"search",void 0),Pe(this,"nodeGraph",void 0),Pe(this,"traceQuery",void 0),Pe(this,"uploadedJson",void 0),Pe(this,"spanBar",void 0),Pe(this,"tagLimit",void 0),Pe(this,"languageProvider",void 0),Pe(this,"streamingEnabled",void 0),Pe(this,"tempoVersion",void 0),Pe(this,"init",void 0),Pe(this,"formatGroupBy",void 0),Pe(this,"hasGroupBy",void 0),Pe(this,"handleTraceQlQuery",void 0),Pe(this,"handleMetricsSummaryQuery",void 0),this.instanceSettings=e,this.templateSrv=t,this.uploadedJson=null,this.init=De((function*(){const e=yield(0,n.lastValueFrom)(r._request("/api/status/buildinfo").pipe((0,s.map)((e=>e)),(0,s.catchError)((e=>(console.error("Failure in retrieving build information",e.data.message),(0,n.of)({error:e,data:{version:null}}))))));r.tempoVersion=e.data.version})),this.formatGroupBy=e=>null==e?void 0:e.filter((e=>e.tag)).map((e=>e.scope===E.d.Unscoped?`.${e.tag}`:e.scope!==E.d.Intrinsic?`${e.scope}.${e.tag}`:e.tag)).join(", "),this.hasGroupBy=e=>{var t;return null===(t=e.groupBy)||void 0===t?void 0:t.find((e=>e.tag))},this.handleTraceQlQuery=(e,t,r)=>{return this.isStreamingSearchEnabled()?this.handleStreamingQuery(e,t.traceql,r):this._request("/api/search",{q:r,limit:null!==(a=e.targets[0].limit)&&void 0!==a?a:Le,spss:null!==(i=e.targets[0].spss)&&void 0!==i?i:ke,start:e.range.from.unix(),end:e.range.to.unix()}).pipe((0,s.map)((e=>({data:ie(e.data.traces,this.instanceSettings,t.traceql[0].tableType)}))),(0,s.catchError)((e=>(0,n.of)({error:{message:(0,Ee.u1)(e.data.message)},data:[]}))));var a,i},this.handleMetricsSummaryQuery=(e,t,r)=>{var a,i,o;if((0,u.reportInteraction)("grafana_traces_metrics_summary_queried",{datasourceType:"tempo",app:null!==(i=r.app)&&void 0!==i?i:"",grafana_version:u.config.buildInfo.version,filterCount:null!==(o=null===(a=e.groupBy)||void 0===a?void 0:a.length)&&void 0!==o?o:0}),"{}"===t)return(0,n.of)({error:{message:"Please ensure you do not have an empty query. This is so filters are applied and the metrics summary is not generated from all spans."},data:U});const l=e.groupBy?this.formatGroupBy(e.groupBy):"";return this._request("/api/metrics/summary",{q:t,groupBy:l,start:r.range.from.unix(),end:r.range.to.unix()}).pipe((0,s.map)((e=>e.data.summaries?e.data.summaries.some((e=>e.series.length>0))?{data:L(e.data.summaries,t,this.instanceSettings)}:{error:{message:(0,Ee.u1)("No series data. Ensure you are using an up to date version of Tempo")},data:U}:{error:{message:(0,Ee.u1)(`No summary data for '${l}'.`)},data:U})),(0,s.catchError)((e=>(0,n.of)({error:{message:(0,Ee.u1)(e.data.message)},data:U}))))},this.tracesToLogs=e.jsonData.tracesToLogs,this.serviceMap=e.jsonData.serviceMap,this.search=e.jsonData.search,this.nodeGraph=e.jsonData.nodeGraph,this.traceQuery=e.jsonData.traceQuery,this.streamingEnabled=e.jsonData.streamingEnabled,this.languageProvider=new v.Ay(this),(null===(a=this.search)||void 0===a?void 0:a.filters)||(this.search=Re(je({},this.search),{filters:[{id:"service-name",tag:"service.name",operator:"=",scope:E.d.Resource},{id:"span-name",tag:"name",operator:"=",scope:E.d.Span}]})),this.variables=new $e(this)}}function qe(e,t){return(0,n.from)((0,u.getDataSourceSrv)().get(t)).pipe((0,s.mergeMap)((t=>t.query(e))))}function Ce(e,t,r,a){var n,s;return{url:"",title:e,internal:{query:{expr:t,range:!a,exemplar:!a,instant:a},datasourceUid:r,datasourceName:null!==(s=null===(n=(0,u.getDataSourceSrv)().getInstanceSettings(r))||void 0===n?void 0:n.name)&&void 0!==s?s:""}}}function Me(e){return e.map((e=>e.replace(/\\/g,"\\\\\\\\").replace(/[$^*{}\[\]\'+?.()|]/g,"\\\\$&")))}function Ge(e,t,r,a,n,s){let i=n?`client="\${${n}}",`:"",o=`server="\${${r}}"`,l="server";if(void 0!==s){const{targetNamespace:e}=s;if(o+=`,server_service_namespace="\${${e}}"`,l+=", server_service_namespace",i){const{sourceNamespace:e}=s;i+=`client_service_namespace="\${${e}}",`,l+=", client_service_namespace"}}return{links:[Ce("Request rate",`sum by (client, ${l})(rate(${S}{${i}${o}}[$__rate_interval]))`,e,!1),Ce("Request histogram",`histogram_quantile(0.9, sum(rate(${w}{${i}${o}}[$__rate_interval])) by (le, client, ${l}))`,e,!1),Ce("Failed request rate",`sum by (client, ${l})(rate(${T}{${i}${o}}[$__rate_interval]))`,e,!1),Qe("View traces",t,!!(null==s?void 0:s.targetNamespace))]}}function Ue(e,t,r,a,n){var s;let i={refId:"A",queryType:"traceqlSearch",filters:[]};var o;return void 0!==t&&""!==t&&i.filters.push({id:"service-namespace",scope:E.d.Resource,tag:"service.namespace",value:t,operator:"=",valueType:"string"}),""!==r&&i.filters.push({id:"service-name",scope:E.d.Resource,tag:"service.name",value:r,operator:"=",valueType:"string"}),""!==a&&i.filters.push({id:"span-name",scope:E.d.Span,tag:"name",value:a,operator:"=",valueType:"string"}),{url:"",title:e,internal:{query:i,datasourceUid:n,datasourceName:null!==(o=null===(s=(0,u.getDataSourceSrv)().getInstanceSettings(n))||void 0===s?void 0:s.name)&&void 0!==o?o:""}}}function Qe(e,t,r){var a,n;return{url:"",title:e,internal:{datasourceUid:t,datasourceName:null!==(n=null===(a=(0,u.getDataSourceSrv)().getInstanceSettings(t))||void 0===a?void 0:a.name)&&void 0!==n?n:"",query:({replaceVariables:e,scopedVars:t})=>{const a=null==e?void 0:e(`\${__data.fields.${l.NodeGraphDataFrameFieldNames.title}}`,t),n=null==e?void 0:e(`\${__data.fields.${l.NodeGraphDataFrameFieldNames.subTitle}}`,t),s={refId:"A",queryType:"traceqlSearch",filters:[]};if(!1==("false"!==(null==e?void 0:e(`\${__data.fields.${l.NodeGraphDataFrameFieldNames.isInstrumented}}`,t)))){const e=["db.name","db.system","peer.service","messaging.system","net.peer.name"].map((e=>`span.${e}="${a}"`)).join(" || ");s.queryType="traceql",s.query=`{${e}}`}else r&&n&&s.filters.push({id:"service-namespace",scope:E.d.Resource,tag:"service.namespace",value:n,operator:"=",valueType:"string"}),a&&s.filters.push({id:"service-name",scope:E.d.Resource,tag:"service.name",value:a,operator:"=",valueType:"string"});return s}}}}function Be(e){return Re(je({},e),{targets:F.map((t=>{const{serviceMapQuery:r,serviceMapIncludeNamespace:a}=e.targets[0],n=a?", client_service_namespace, server_service_namespace":"",s=Array.isArray(r)?r:[r],i=s.map((e=>`sum by (client, server${n}) (rate(${t}${e||""}[$__range]))`)),o=s.map((e=>`group by (client, connection_type, server${n}) (${t}${e||""})`));return[{format:"table",refId:t,expr:i.join(" OR "),instant:!0},{format:"table",refId:`${t}_labels`,expr:o.join(" OR "),instant:!0}]})).flat()})}function Xe(e,t,r){var a,n;let s=null!==(n=null===(a=r.targets[0])||void 0===a?void 0:a.serviceMapQuery)&&void 0!==n?n:"";const i=(Array.isArray(s)?s:[s]).map((r=>{const a=r.match(/^{(.*)}$/);return(null==a?void 0:a.length)&&(r=a[1]),(r=r.replace("client","service").replace("server","service")).includes("span_name")?e.params.concat(r):e.params.concat(r).concat(t).filter((e=>e))})).map((t=>e.expr.replace("{}","{"+t.join(",")+"}"))).join(" OR ");return e.topk?`topk(${e.topk}, ${i})`:i}function Je(e){return(e=e.replace("topk(5, ","").replace(" by (span_name))","")).replace("__range","__rate_interval")}function ze(e,t){var r,a,n;const s=null!==(n=null===(a=e[0])||void 0===a||null===(r=a.fields[1])||void 0===r?void 0:r.values)&&void 0!==n?n:[];let i=[];for(let e=0;e<s.length;e++)Object.keys(t).includes(s[e])?i.push(t[s[e]].value):i.push("0");return i}function He(e){return e.map((e=>({refId:e,expr:e,instant:!0})))}},2599:(e,t,r)=>{"use strict";r.d(t,{Ay:()=>m,J_:()=>d});var a=r(7781),n=r(8531),s=r(2686),i=r(2862),o=r(3557),l=r(2190);function u(e,t,r,a,n,s,i){try{var o=e[s](i),l=o.value}catch(e){return void r(e)}o.done?t(l):Promise.resolve(l).then(a,n)}function c(e){return function(){var t=this,r=arguments;return new Promise((function(a,n){var s=e.apply(t,r);function i(e){u(s,a,n,i,o,"next",e)}function o(e){u(s,a,n,i,o,"throw",e)}i(void 0)}))}}function p(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const d=1e3;class m extends a.LanguageProvider{fetchTags(){var e=this;return c((function*(){let t,r;try{r=yield e.request("/api/v2/search/tags",{limit:e.getTagsLimit()})}catch(r){t=yield e.request("/api/search/tags",[])}r&&r.scopes?e.setV2Tags(r.scopes):t&&e.setV1Tags(t.tagNames)}))()}getOptionsV1(e){var t=this;return c((function*(){const r=t.encodeTag(e),a=yield t.request(`/api/search/tag/${r}/values`);let n=[];return a&&a.tagValues&&(n=a.tagValues.map((e=>({value:e,label:e})))),n}))()}getOptionsV2(e,t){var r=this;return c((function*(){const a=r.encodeTag(e),i=yield r.request(`/api/v2/search/tag/${a}/values`,t?{q:(0,n.getTemplateSrv)().replace(t,{},s.$m.Pipe),limit:r.getTagsLimit()}:{limit:r.getTagsLimit()});let o=[];return i&&i.tagValues&&i.tagValues.forEach((e=>{e.value&&o.push({type:e.type,value:e.value,label:e.value})})),o}))()}generateQueryFromFilters(e){return e?`{${e.filter((e=>{var t;return e.tag&&e.operator&&(null===(t=e.value)||void 0===t?void 0:t.length)})).map((t=>(0,i.LL)(t,e,this))).join(" && ")}}`:""}constructor(e,t){var r;super(),r=this,p(this,"datasource",void 0),p(this,"tagsV1",void 0),p(this,"tagsV2",void 0),p(this,"request",function(){var e=c((function*(e,t={}){const a=yield r.datasource.metadataRequest(e,t);return null==a?void 0:a.data}));return function(t){return e.apply(this,arguments)}}()),p(this,"start",c((function*(){return r.startTask||(r.startTask=r.fetchTags().then((()=>[]))),r.startTask}))),p(this,"getTagsLimit",(()=>{var e;return(null===(e=this.datasource.instanceSettings.jsonData)||void 0===e?void 0:e.tagLimit)||5e3})),p(this,"setV1Tags",(e=>{this.tagsV1=e})),p(this,"setV2Tags",(e=>{this.tagsV2=e})),p(this,"getIntrinsics",(()=>this.tagsV2?(0,i.rC)(this.tagsV2):l.on)),p(this,"getTags",(e=>this.tagsV2&&e?e===o.d.Unscoped?(0,i.rd)(this.tagsV2):(0,i.vP)(this.tagsV2,e):this.tagsV1?(this.tagsV1.find((e=>"status"===e))||this.tagsV1.push("status"),this.tagsV1):[])),p(this,"getMetricsSummaryTags",(e=>this.tagsV2&&e?e===o.d.Unscoped?(0,i.rd)(this.tagsV2):(0,i.vP)(this.tagsV2,e):this.tagsV1?this.tagsV1:[])),p(this,"getTraceqlAutocompleteTags",(e=>this.tagsV2?e?e===o.d.Unscoped?(0,i.rd)(this.tagsV2):(0,i.vP)(this.tagsV2,e):(0,i.rd)(this.tagsV2):this.tagsV1?(this.tagsV1.find((e=>"status"===e))||this.tagsV1.push("status"),this.tagsV1):[])),p(this,"getAutocompleteTags",(()=>this.tagsV2?(0,i.r)(this.tagsV2):this.tagsV1?(this.tagsV1.find((e=>"status.code"===e))||this.tagsV1.push("status.code"),this.tagsV1):[])),p(this,"encodeTag",(e=>encodeURIComponent(encodeURIComponent(e)))),this.datasource=e,Object.assign(this,t)}}},2190:(e,t,r)=>{"use strict";r.d(t,{II:()=>a,UD:()=>m,Wu:()=>u,YG:()=>d,fV:()=>n,jN:()=>s,on:()=>o,rx:()=>i});const a=["=","!=",">","<",">=","<=","=~","!~"],n=["=","!="],s=["=","!=","=~","!~"],i=["=","!=",">","<",">=","<="],o=["duration","kind","name","rootName","rootServiceName","status","statusMessage","traceDuration"],l=o.concat(["event:name","event:timeSinceStart","instrumentation:name","instrumentation:version","link:spanID","link:traceID","span:duration","span:id","span:kind","span:name","span:status","span:statusMessage","trace:duration","trace:id","trace:rootName","trace:rootService"]),u=["event","instrumentation","link","resource","span"],c=["avg","count","max","min","sum"].concat(["by","count_over_time","histogram_over_time","quantile_over_time","rate","select"]),p=l.concat(u),d={id:"traceql",extensions:[".traceql"],aliases:["tempo","traceql"],mimetypes:[],def:{language:{ignoreCase:!1,defaultToken:"",tokenPostfix:".traceql",keywords:p,operators:a,statusValues:["ok","unset","error","false","true"],functions:c,symbols:/[=><!~?:&|+\-*\/^%]+/,escapes:/\\(?:[abfnrtv\\"']|x[0-9A-Fa-f]{1,4}|u[0-9A-Fa-f]{4}|U[0-9A-Fa-f]{8})/,digits:/\d+(_+\d+)*/,octaldigits:/[0-7]+(_+[0-7]+)*/,binarydigits:/[0-1]+(_+[0-1]+)*/,tokenizer:{root:[[/\/\/.*/,"comment"],[/\/\*.*\*\//,"comment"],[/[0-9]+(.[0-9]+)?(us|µs|ns|ms|s|m|h)/,"number"],[/^\s*[0-9A-Fa-f]+\s*$/,"tag"],[`(?:${p.join("|")})`,{cases:{"@keywords":"keyword","@default":"tag"}}],[/(?:\w|^[^{}()=~!<>&|," ]|"(?:\\"|\\\\|[^\\"])*")+/,{cases:{"@functions":"predefined","@statusValues":"type","@default":"tag"}}],[/"([^"\\]|\\.)*$/,"string.invalid"],[/'([^'\\]|\\.)*$/,"string.invalid"],[/([^\w])(")/,[{token:""},{token:"string",next:"@string_double"}]],[/([^\w])(')/,[{token:""},{token:"string",next:"@string_single"}]],[/([^\w])(`)/,[{token:""},{token:"string",next:"@string_back"}]],[/[{}()\[\]]/,"delimiter.bracket"],[/@symbols/,{cases:{"@operators":"delimiter","@default":""}}],[/(@digits)[eE]([\-+]?(@digits))?[fFdD]?/,"number.float"],[/(@digits)\.(@digits)([eE][\-+]?(@digits))?[fFdD]?/,"number.float"],[/0(@octaldigits)[Ll]?/,"number.octal"],[/0[bB](@binarydigits)[Ll]?/,"number.binary"],[/(@digits)[fFdD]/,"number.float"],[/(@digits)[lL]?/,"number"]],string_double:[[/[^\\"]+/,"string"],[/@escapes/,"string.escape"],[/\\./,"string.escape.invalid"],[/"/,"string","@pop"]],string_single:[[/[^\\']+/,"string"],[/@escapes/,"string.escape"],[/\\./,"string.escape.invalid"],[/'/,"string","@pop"]],string_back:[[/[^\\`]+/,"string"],[/@escapes/,"string.escape"],[/\\./,"string.escape.invalid"],[/`/,"string","@pop"]]}},languageConfiguration:{wordPattern:/(-?\d*\.\d\w*)|([^`~!#%^&*()\-=+\[{\]}\\|;:'",.<>\/?\s]+)/g,brackets:[["{","}"],["(",")"]],autoClosingPairs:[{open:"{",close:"}"},{open:"(",close:")"},{open:'"',close:'"'},{open:"'",close:"'"}],surroundingPairs:[{open:"{",close:"}"},{open:"(",close:")"},{open:'"',close:'"'},{open:"'",close:"'"}],folding:{}}}},m={comment:{pattern:/\/\/.*/},"span-set":{pattern:/\{[^}]*}/,inside:{filter:{pattern:/([\w:.\/-]+)\s*(=|!=|<=|>=|=~|!~|>|<)\s*("[^"]*"|[\w.\/-]+)(\s*(\&\&|\|\|)\s*([\w:.\/-]+)\s*(=|!=|<=|>=|=~|!~|>|<)\s*("[^"]*"|[\w.\/-]+))*/g,inside:{comment:{pattern:/#.*/},"label-key":{pattern:/[a-z_.][\w./_-]*(:[\w./_-]+)?(?=\s*(=|!=|>|<|>=|<=|=~|!~))/,alias:"attr-name"},"label-value":{pattern:/("(?:\\.|[^\\"])*")|(\w+)/,alias:"attr-value"}}},punctuation:/[}{&|]/}},number:/\b-?\d+((\.\d*)?([eE][+-]?\d+)?)?\b/,operator:new RegExp("/[-+*/=%^~]|&&?|\\|?\\||!=?|<(?:=>?|<|>)?|>[>=]?|","i"),punctuation:/[{};()`,.]/}},4340:(e,t,r)=>{"use strict";r.d(t,{d6:()=>p,hO:()=>d,q$:()=>u,u1:()=>l});var a=r(7781),n=r(8531),s=r(4160),i=r(3557);function o(e,t,r,a,n,s,i){try{var o=e[s](i),l=o.value}catch(e){return void r(e)}o.done?t(l):Promise.resolve(l).then(a,n)}const l=(e,t)=>`${t||"Error"}${e?` (${e})`:""}. Please check the server logs for more details.`;function u(e){return c.apply(this,arguments)}function c(){var e;return e=function*(e){if(!e)return;const t=(0,n.getDataSourceSrv)();try{return yield t.get(e)}catch(e){return void console.error("Failed to load data source",e)}},c=function(){var t=this,r=arguments;return new Promise((function(a,n){var s=e.apply(t,r);function i(e){o(s,a,n,i,l,"next",e)}function l(e){o(s,a,n,i,l,"throw",e)}i(void 0)}))},c.apply(this,arguments)}const p=e=>{let t=[];if(e.spanName&&t.push({id:"span-name",scope:i.d.Span,tag:"name",operator:"=",value:[e.spanName],valueType:"string"}),e.serviceName&&t.push({id:"service-name",scope:i.d.Resource,tag:"service.name",operator:"=",value:[e.serviceName],valueType:"string"}),(e.minDuration||e.maxDuration)&&t.push({id:"duration-type",value:"trace"}),e.minDuration&&t.push({id:"min-duration",tag:"duration",operator:">",value:[e.minDuration],valueType:"duration"}),e.maxDuration&&t.push({id:"max-duration",tag:"duration",operator:"<",value:[e.maxDuration],valueType:"duration"}),e.search){const r=e.search.split(" ");for(const e of r){const[r,a]=e.split("=");r&&a&&t.push({id:(0,s.$)(),scope:i.d.Unscoped,tag:r,operator:"=",value:[a.replace(/(^"|"$)/g,"")],valueType:a.startsWith('"')&&a.endsWith('"')?"string":void 0})}}return{datasource:e.datasource,filters:t,groupBy:e.groupBy,limit:e.limit,query:e.query,queryType:"traceqlSearch",refId:e.refId}},d=e=>{if(!e)return 0;const t=e.match(/(\d+)(.+)/),r=null==t?void 0:t[1],n=null==t?void 0:t[2];if(r){if("ns"===n)return parseInt(r,10);if("µs"===n)return 1e3*parseInt(r,10);if("ms"===n)return 1e6*parseInt(r,10);const t=(0,a.parseDuration)(e);return 1e9*(t.seconds||0)+6e10*(t.minutes||0)+36e11*(t.hours||0)}return 0}},6089:e=>{"use strict";e.exports=o},7781:e=>{"use strict";e.exports=t},8531:e=>{"use strict";e.exports=r},2007:e=>{"use strict";e.exports=a},3241:e=>{"use strict";e.exports=n},8146:e=>{"use strict";e.exports=l},5959:t=>{"use strict";t.exports=e},1269:e=>{"use strict";e.exports=s},3059:e=>{"use strict";e.exports=i},2827:(e,t,r)=>{"use strict";r.d(t,{Z:()=>i});var a=r(6089),n=r(5959),s=(r(7781),r(2007));const i=({className:e,...t})=>{const r=(0,s.useStyles2)(o);return n.createElement(s.Button,{...t,className:(0,a.cx)(e,r.button)})},o=e=>({button:(0,a.css)({paddingLeft:e.spacing(1.5),paddingRight:e.spacing(1.5)})})},4769:(e,t,r)=>{"use strict";r.r(t),r.d(t,{__addDisposableResource:()=>k,__assign:()=>s,__asyncDelegator:()=>N,__asyncGenerator:()=>w,__asyncValues:()=>O,__await:()=>T,__awaiter:()=>f,__classPrivateFieldGet:()=>j,__classPrivateFieldIn:()=>L,__classPrivateFieldSet:()=>R,__createBinding:()=>g,__decorate:()=>o,__disposeResources:()=>A,__esDecorate:()=>u,__exportStar:()=>h,__extends:()=>n,__generator:()=>v,__importDefault:()=>P,__importStar:()=>D,__makeTemplateObject:()=>I,__metadata:()=>m,__param:()=>l,__propKey:()=>p,__read:()=>b,__rest:()=>i,__rewriteRelativeImportExtension:()=>V,__runInitializers:()=>c,__setFunctionName:()=>d,__spread:()=>E,__spreadArray:()=>S,__spreadArrays:()=>_,__values:()=>y,default:()=>q});var a=function(e,t){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},a(e,t)};function n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var s=function(){return s=Object.assign||function(e){for(var t,r=1,a=arguments.length;r<a;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e},s.apply(this,arguments)};function i(e,t){var r={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(r[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(a=Object.getOwnPropertySymbols(e);n<a.length;n++)t.indexOf(a[n])<0&&Object.prototype.propertyIsEnumerable.call(e,a[n])&&(r[a[n]]=e[a[n]])}return r}function o(e,t,r,a){var n,s=arguments.length,i=s<3?t:null===a?a=Object.getOwnPropertyDescriptor(t,r):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,a);else for(var o=e.length-1;o>=0;o--)(n=e[o])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i}function l(e,t){return function(r,a){t(r,a,e)}}function u(e,t,r,a,n,s){function i(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var o,l=a.kind,u="getter"===l?"get":"setter"===l?"set":"value",c=!t&&e?a.static?e:e.prototype:null,p=t||(c?Object.getOwnPropertyDescriptor(c,a.name):{}),d=!1,m=r.length-1;m>=0;m--){var f={};for(var v in a)f[v]="access"===v?{}:a[v];for(var v in a.access)f.access[v]=a.access[v];f.addInitializer=function(e){if(d)throw new TypeError("Cannot add initializers after decoration has completed");s.push(i(e||null))};var g=(0,r[m])("accessor"===l?{get:p.get,set:p.set}:p[u],f);if("accessor"===l){if(void 0===g)continue;if(null===g||"object"!=typeof g)throw new TypeError("Object expected");(o=i(g.get))&&(p.get=o),(o=i(g.set))&&(p.set=o),(o=i(g.init))&&n.unshift(o)}else(o=i(g))&&("field"===l?n.unshift(o):p[u]=o)}c&&Object.defineProperty(c,a.name,p),d=!0}function c(e,t,r){for(var a=arguments.length>2,n=0;n<t.length;n++)r=a?t[n].call(e,r):t[n].call(e);return a?r:void 0}function p(e){return"symbol"==typeof e?e:"".concat(e)}function d(e,t,r){return"symbol"==typeof t&&(t=t.description?"[".concat(t.description,"]"):""),Object.defineProperty(e,"name",{configurable:!0,value:r?"".concat(r," ",t):t})}function m(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function f(e,t,r,a){return new(r||(r=Promise))((function(n,s){function i(e){try{l(a.next(e))}catch(e){s(e)}}function o(e){try{l(a.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,o)}l((a=a.apply(e,t||[])).next())}))}function v(e,t){var r,a,n,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=o(0),i.throw=o(1),i.return=o(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function o(o){return function(l){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;i&&(i=0,o[0]&&(s=0)),s;)try{if(r=1,a&&(n=2&o[0]?a.return:o[0]?a.throw||((n=a.return)&&n.call(a),0):a.next)&&!(n=n.call(a,o[1])).done)return n;switch(a=0,n&&(o=[2&o[0],n.value]),o[0]){case 0:case 1:n=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,a=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!((n=(n=s.trys).length>0&&n[n.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!n||o[1]>n[0]&&o[1]<n[3])){s.label=o[1];break}if(6===o[0]&&s.label<n[1]){s.label=n[1],n=o;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(o);break}n[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],a=0}finally{r=n=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,l])}}}var g=Object.create?function(e,t,r,a){void 0===a&&(a=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,a,n)}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]};function h(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||g(t,e,r)}function y(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],a=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&a>=e.length&&(e=void 0),{value:e&&e[a++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function b(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var a,n,s=r.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(a=s.next()).done;)i.push(a.value)}catch(e){n={error:e}}finally{try{a&&!a.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}return i}function E(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(b(arguments[t]));return e}function _(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var a=Array(e),n=0;for(t=0;t<r;t++)for(var s=arguments[t],i=0,o=s.length;i<o;i++,n++)a[n]=s[i];return a}function S(e,t,r){if(r||2===arguments.length)for(var a,n=0,s=t.length;n<s;n++)!a&&n in t||(a||(a=Array.prototype.slice.call(t,0,n)),a[n]=t[n]);return e.concat(a||Array.prototype.slice.call(t))}function T(e){return this instanceof T?(this.v=e,this):new T(e)}function w(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var a,n=r.apply(e,t||[]),s=[];return a=Object.create(("function"==typeof AsyncIterator?AsyncIterator:Object).prototype),i("next"),i("throw"),i("return",(function(e){return function(t){return Promise.resolve(t).then(e,u)}})),a[Symbol.asyncIterator]=function(){return this},a;function i(e,t){n[e]&&(a[e]=function(t){return new Promise((function(r,a){s.push([e,t,r,a])>1||o(e,t)}))},t&&(a[e]=t(a[e])))}function o(e,t){try{(r=n[e](t)).value instanceof T?Promise.resolve(r.value.v).then(l,u):c(s[0][2],r)}catch(e){c(s[0][3],e)}var r}function l(e){o("next",e)}function u(e){o("throw",e)}function c(e,t){e(t),s.shift(),s.length&&o(s[0][0],s[0][1])}}function N(e){var t,r;return t={},a("next"),a("throw",(function(e){throw e})),a("return"),t[Symbol.iterator]=function(){return this},t;function a(a,n){t[a]=e[a]?function(t){return(r=!r)?{value:T(e[a](t)),done:!1}:n?n(t):t}:n}}function O(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,r=e[Symbol.asyncIterator];return r?r.call(e):(e=y(e),t={},a("next"),a("throw"),a("return"),t[Symbol.asyncIterator]=function(){return this},t);function a(r){t[r]=e[r]&&function(t){return new Promise((function(a,n){!function(e,t,r,a){Promise.resolve(a).then((function(t){e({value:t,done:r})}),t)}(a,n,(t=e[r](t)).done,t.value)}))}}}function I(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}var $=Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t},F=function(e){return F=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},F(e)};function D(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=F(e),a=0;a<r.length;a++)"default"!==r[a]&&g(t,e,r[a]);return $(t,e),t}function P(e){return e&&e.__esModule?e:{default:e}}function j(e,t,r,a){if("a"===r&&!a)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?a:"a"===r?a.call(e):a?a.value:t.get(e)}function R(e,t,r,a,n){if("m"===a)throw new TypeError("Private method is not writable");if("a"===a&&!n)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===a?n.call(e,r):n?n.value=r:t.set(e,r),r}function L(e,t){if(null===t||"object"!=typeof t&&"function"!=typeof t)throw new TypeError("Cannot use 'in' operator on non-object");return"function"==typeof e?t===e:e.has(t)}function k(e,t,r){if(null!=t){if("object"!=typeof t&&"function"!=typeof t)throw new TypeError("Object expected.");var a,n;if(r){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");a=t[Symbol.asyncDispose]}if(void 0===a){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");a=t[Symbol.dispose],r&&(n=a)}if("function"!=typeof a)throw new TypeError("Object not disposable.");n&&(a=function(){try{n.call(this)}catch(e){return Promise.reject(e)}}),e.stack.push({value:t,dispose:a,async:r})}else r&&e.stack.push({async:!0});return t}var x="function"==typeof SuppressedError?SuppressedError:function(e,t,r){var a=new Error(r);return a.name="SuppressedError",a.error=e,a.suppressed=t,a};function A(e){function t(t){e.error=e.hasError?new x(t,e.error,"An error was suppressed during disposal."):t,e.hasError=!0}var r,a=0;return function n(){for(;r=e.stack.pop();)try{if(!r.async&&1===a)return a=0,e.stack.push(r),Promise.resolve().then(n);if(r.dispose){var s=r.dispose.call(r.value);if(r.async)return a|=2,Promise.resolve(s).then(n,(function(e){return t(e),n()}))}else a|=1}catch(e){t(e)}if(1===a)return e.hasError?Promise.reject(e.error):Promise.resolve();if(e.hasError)throw e.error}()}function V(e,t){return"string"==typeof e&&/^\.\.?\//.test(e)?e.replace(/\.(tsx)$|((?:\.d)?)((?:\.[^./]+?)?)\.([cm]?)ts$/i,(function(e,r,a,n,s){return r?t?".jsx":".js":!a||n&&s?a+n+"."+s.toLowerCase()+"js":e})):e}const q={__extends:n,__assign:s,__rest:i,__decorate:o,__param:l,__esDecorate:u,__runInitializers:c,__propKey:p,__setFunctionName:d,__metadata:m,__awaiter:f,__generator:v,__createBinding:g,__exportStar:h,__values:y,__read:b,__spread:E,__spreadArrays:_,__spreadArray:S,__await:T,__asyncGenerator:w,__asyncDelegator:N,__asyncValues:O,__makeTemplateObject:I,__importStar:D,__importDefault:P,__classPrivateFieldGet:j,__classPrivateFieldSet:R,__classPrivateFieldIn:L,__addDisposableResource:k,__disposeResources:A,__rewriteRelativeImportExtension:V}},6373:(e,t,r)=>{"use strict";r.d(t,{A:()=>o});const a={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let n;const s=new Uint8Array(16),i=[];for(let e=0;e<256;++e)i.push((e+256).toString(16).slice(1));const o=function(e,t,r){if(a.randomUUID&&!t&&!e)return a.randomUUID();const o=(e=e||{}).random??e.rng?.()??function(){if(!n){if("undefined"==typeof crypto||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");n=crypto.getRandomValues.bind(crypto)}return n(s)}();if(o.length<16)throw new Error("Random bytes length must be >= 16");if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,t){if((r=r||0)<0||r+16>t.length)throw new RangeError(`UUID byte range ${r}:${r+15} is out of buffer bounds`);for(let e=0;e<16;++e)t[r+e]=o[e];return t}return function(e,t=0){return(i[e[t+0]]+i[e[t+1]]+i[e[t+2]]+i[e[t+3]]+"-"+i[e[t+4]]+i[e[t+5]]+"-"+i[e[t+6]]+i[e[t+7]]+"-"+i[e[t+8]]+i[e[t+9]]+"-"+i[e[t+10]]+i[e[t+11]]+i[e[t+12]]+i[e[t+13]]+i[e[t+14]]+i[e[t+15]]).toLowerCase()}(o)}}},d={};function m(e){var t=d[e];if(void 0!==t)return t.exports;var r=d[e]={id:e,exports:{}};return p[e](r,r.exports,m),r.exports}m.m=p,m.amdO={},m.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return m.d(t,{a:t}),t},m.d=(e,t)=>{for(var r in t)m.o(t,r)&&!m.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},m.f={},m.e=e=>Promise.all(Object.keys(m.f).reduce(((t,r)=>(m.f[r](e,t),t)),[])),m.u=e=>e+".js",m.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),m.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),u={},c="tempo:",m.l=(e,t,r,a)=>{if(u[e])u[e].push(t);else{var n,s;if(void 0!==r)for(var i=document.getElementsByTagName("script"),o=0;o<i.length;o++){var l=i[o];if(l.getAttribute("src")==e||l.getAttribute("data-webpack")==c+r){n=l;break}}n||(s=!0,(n=document.createElement("script")).charset="utf-8",n.timeout=120,m.nc&&n.setAttribute("nonce",m.nc),n.setAttribute("data-webpack",c+r),n.src=e),u[e]=[t];var p=(t,r)=>{n.onerror=n.onload=null,clearTimeout(d);var a=u[e];if(delete u[e],n.parentNode&&n.parentNode.removeChild(n),a&&a.forEach((e=>e(r))),t)return t(r)},d=setTimeout(p.bind(null,void 0,{type:"timeout",target:n}),12e4);n.onerror=p.bind(null,n.onerror),n.onload=p.bind(null,n.onload),s&&document.head.appendChild(n)}},m.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},m.p="public/plugins/tempo/",(()=>{m.b=document.baseURI||self.location.href;var e={4231:0};m.f.j=(t,r)=>{var a=m.o(e,t)?e[t]:void 0;if(0!==a)if(a)r.push(a[2]);else{var n=new Promise(((r,n)=>a=e[t]=[r,n]));r.push(a[2]=n);var s=m.p+m.u(t),i=new Error;m.l(s,(r=>{if(m.o(e,t)&&(0!==(a=e[t])&&(e[t]=void 0),a)){var n=r&&("load"===r.type?"missing":r.type),s=r&&r.target&&r.target.src;i.message="Loading chunk "+t+" failed.\n("+n+": "+s+")",i.name="ChunkLoadError",i.type=n,i.request=s,a[1](i)}}),"chunk-"+t,t)}};var t=(t,r)=>{var a,n,[s,i,o]=r,l=0;if(s.some((t=>0!==e[t]))){for(a in i)m.o(i,a)&&(m.m[a]=i[a]);o&&o(m)}for(t&&t(r);l<s.length;l++)n=s[l],m.o(e,n)&&e[n]&&e[n][0](),e[n]=0},r=globalThis.webpackChunktempo=globalThis.webpackChunktempo||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})(),m.nc=void 0;var f={};return(()=>{"use strict";m.r(f),m.d(f,{plugin:()=>d});var e=m(9728),t=m(5959),r=m(7781),a=m(8531),n=m(2007),s=m(4288);const i=e=>(Array.isArray(e)?e:[e]).some((e=>(0,a.getTemplateSrv)().containsTemplate(e)));function o(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function l(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},a=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),a.forEach((function(t){o(e,t,r[t])}))}return e}const u=(0,t.lazy)((()=>Promise.all([m.e(328),m.e(3777)]).then(m.bind(m,8864)))),c=(0,t.lazy)((()=>Promise.all([m.e(1077),m.e(14)]).then(m.bind(m,14)))),p=(0,t.lazy)((()=>m.e(465).then(m.bind(m,465)))),d=new r.DataSourcePlugin(s.H1).setQueryEditor((function(r){return(0,e.jsx)(t.Suspense,{fallback:(0,e.jsx)(n.LoadingPlaceholder,{text:"Loading editor"}),children:(0,e.jsx)(u,l({},r))})})).setConfigEditor((function(r){return(0,e.jsx)(t.Suspense,{fallback:(0,e.jsx)(n.LoadingPlaceholder,{text:"Loading editor"}),children:(0,e.jsx)(c,l({},r))})})).setQueryEditorHelp((function(){return(0,e.jsx)(t.Suspense,{fallback:null,children:(0,e.jsx)(p,{})})}));(0,a.getAppEvents)().subscribe(r.DashboardLoadedEvent,(({payload:{dashboardId:e,orgId:t,grafanaVersion:r,queries:n}})=>{try{const s=n.tempo;if(!(null==s?void 0:s.length))return;let o={grafana_version:r,dashboard_id:e,org_id:t,service_map_query_count:0,traceql_query_count:0,upload_query_count:0,service_map_queries_with_template_variables_count:0,traceql_queries_with_template_variables_count:0};for(const e of s)e.hide||("serviceMap"===e.queryType?(o.service_map_query_count++,e.serviceMapQuery&&i(e.serviceMapQuery)&&o.service_map_queries_with_template_variables_count++):"traceql"===e.queryType?(o.traceql_query_count++,i(e.query)&&o.traceql_queries_with_template_variables_count++):"upload"===e.queryType&&o.upload_query_count++);(0,a.reportInteraction)("grafana_tempo_dashboard_loaded",o)}catch(e){console.error("error in tempo tracking handler",e)}}))})(),f})()));
//# sourceMappingURL=module.js.map