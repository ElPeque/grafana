"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[6199],{71839:(Y,A,t)=>{t.d(A,{o:()=>n});var p=t(74848),g=t(96540),v=t(40462),D=t(38075),x=t(63739),f=t(47286),K=t(85832),I=t(87579),C=t(7257),r=t(6248);function u(s,e,l=[]){for(const a of l)if(typeof a=="function"){if(!a(s,e))return!1}else if(e[a]!==s[a])return!1;return!0}const d={x:v.sJ.get(D.Ct.firstTimeField).get({}),y:v.sJ.get(D.Ct.byTypes).get(new Set([x.PU.number,x.PU.enum]))};class n extends g.Component{constructor(e){super(e),this.getTimeRange=()=>this.props.timeRange;let l=this.prepState(e);l.alignedData=l.config.prepData([l.alignedFrame]),this.state=l,this.plotInstance=g.createRef()}prepState(e,l=!0){let a=null;const{frames:o,fields:i=d,preparePlotFrame:E,replaceVariables:T,dataLinkPostProcessor:h}=e,F=E??r.m,B=o.some(y=>y.fields.some(H=>(H.config.links?.length??0)>0)),m=F(o,{...i,y:B?()=>!0:i.y},e.timeRange);if((0,C.uY)("GraphNG",!1,"data aligned",m),m){let y=m;if(B){const S=Array.isArray(this.props.timeZone)?this.props.timeZone[0]:this.props.timeZone;let N=o.map((V,M)=>({...V,fields:m.fields.filter((L,W)=>W===0||L.state?.origin?.frameIndex===M),length:m.length}));N.forEach((V,M)=>{V.fields.forEach(L=>{L.getLinks=(0,f._M)(V,L,{...L.state?.scopedVars,__dataContext:{value:{data:N,field:L,frame:V,frameIndex:M}}},T,S,h)})}),y={...m,fields:m.fields.filter((V,M)=>M===0||i.y(V,m,[m]))}}if(e.omitHideFromViz){const S=y.fields.filter(N=>N.config.custom?.hideFrom?.viz!==!0);y={...y,fields:S,length:S.length}}let H=this.state?.config;l&&(H=e.prepConfig(y,this.props.frames,this.getTimeRange),(0,C.uY)("GraphNG",!1,"config prepared",H)),a={alignedFrame:y,config:H},(0,C.uY)("GraphNG",!1,"data prepared",a.alignedData)}return a}componentDidUpdate(e){const{frames:l,structureRev:a,timeZone:o,cursorSync:i,propsToDiff:E}=this.props,T=!u(e,this.props,E);if(l!==e.frames||T||o!==e.timeZone||i!==e.cursorSync){let h=this.prepState(this.props,!1);h&&((this.state.config===void 0||o!==e.timeZone||i!==e.cursorSync||a!==e.structureRev||!a||T)&&(h.config=this.props.prepConfig(h.alignedFrame,this.props.frames,this.getTimeRange),(0,C.uY)("GraphNG",!1,"config recreated",h.config)),h.alignedData=h.config.prepData([h.alignedFrame]),this.setState(h))}}render(){const{width:e,height:l,children:a,renderLegend:o}=this.props,{config:i,alignedFrame:E,alignedData:T}=this.state;return i?(0,p.jsx)(K.KU,{width:e,height:l,legend:o(i),children:(h,F)=>(0,p.jsx)(I.Z,{config:i,data:T,width:h,height:F,plotRef:B=>this.plotInstance.current=B,children:a?a(i,E):null})}):null}}},6248:(Y,A,t)=>{t.d(A,{m:()=>C});var p=t(63739),g=t(77230),v=t(66380);function D(r,u,d){let n,s;for(let e=0;e<u.length;e++)if(u[e]==null)s==null&&n!=null&&(s=e);else{if(s!=null&&n!=null){if(r[e]-n<d)for(;s<e;)u[s++]=void 0;s=null}n=r[e]}return u}var x=t(7500);function f(r){return r.type===p.PU.number&&r.config.custom?.drawStyle===x.GR.Bars&&!r.config.custom?.hideFrom?.viz}function K(r,u){return r.fields.find(d=>u!=null?d.name===u:d.type===p.PU.time)}function I(r,u){const d=K(r,u);let n=d?.values;for(let s=0;s<r.fields.length;s++){let e=r.fields[s];if(e===d||f(e))continue;let l=e.config.custom?.spanNulls;typeof l=="number"&&l!==-1&&n&&(e.values=D(n,e.values,l))}return r}function C(r,u,d){let n;t:for(let a of r)for(let o of a.fields)if(u.x(o,a,r)){n=o;break t}r=r.map(a=>n?.state?.nullThresholdApplied?a:(0,v.M)({frame:a,refFieldName:n.name,refFieldPseudoMin:d?.from.valueOf(),refFieldPseudoMax:d?.to.valueOf()}));let s=r.reduce((a,o)=>a+o.fields.reduce((i,E)=>i+(f(E)?1:0),0),0),e=1/0;s>1&&r.forEach(a=>{if(!a.fields.some(f))return;const o=n.values;for(let i=0;i<o.length;i++)i>0&&(e=Math.min(e,o[i]-o[i-1]))});let l=(0,g.Fd)({frames:r,joinBy:u.x,keep:u.y,keepOriginIndices:!0,keepDisplayNames:!0,nullMode:a=>{if(f(a))return g.WO;let o=a.config.custom?.spanNulls;return o===!0?g.RC:o===-1?g.WO:g.JI}});return l?(l=I(l,n.name),e!==1/0&&(l.fields.forEach((a,o)=>{let i=a.values;if(o===0){let E=i[i.length-1];i.push(E+e,E+2*e)}else f(a)?i.push(null,null):i.push(void 0,void 0)}),l.length+=2),l):null}},42515:(Y,A,t)=>{t.d(A,{I:()=>u});var p=t(74848),g=t(96540),v=t(62931),D=t(63739),x=t(7500),f=t(85832),K=t(43987),I=t(71839),C=t(90825);const r=["rowHeight","colWidth","showValue","mergeValues","alignValue","tooltip","paginationRev"];class u extends g.Component{constructor(){super(...arguments),this.getValueColor=(n,s,e)=>{const l=this.props.frames[n]?.fields[s];if(l?.display){const a=l.display(e);if(a.color)return a.color}return v.F},this.prepConfig=(n,s,e)=>(0,C.iE)({frame:n,getTimeRange:e,allFrames:this.props.frames,...this.props,timeZones:Array.isArray(this.props.timeZone)?this.props.timeZone:[this.props.timeZone],rowHeight:n.fields.length>2?this.props.rowHeight:1,getValueColor:this.getValueColor,hoverMulti:this.props.tooltip?.mode===x.$N.Multi}),this.renderLegend=n=>{const{legend:s,legendItems:e}=this.props;return!n||!e||!s||s.showLegend===!1?null:(0,p.jsx)(f.KU.Legend,{placement:s.placement,children:(0,p.jsx)(K.t,{placement:s.placement,items:e,displayMode:s.displayMode,readonly:!0})})}}render(){return(0,p.jsx)(I.o,{...this.props,fields:{x:n=>n.type===D.PU.time,y:n=>n.type===D.PU.number||n.type===D.PU.boolean||n.type===D.PU.string||n.type===D.PU.enum},prepConfig:this.prepConfig,propsToDiff:r,renderLegend:this.renderLegend,omitHideFromViz:!0})}}},4266:(Y,A,t)=>{t.d(A,{K:()=>d});var p=t(74848),g=t(63739),v=t(7500),D=t(53823),x=t(14411),f=t(33409),K=t(69921),I=t(37813),C=t(90825),r=t(69598),u=t(16725);const d=({series:n,dataIdxs:s,seriesIdx:e,mode:l=v.$N.Single,sortOrder:a=v.xB.None,isPinned:o,annotate:i,timeRange:E,withDuration:T,maxHeight:h,replaceVariables:F,dataLinks:B})=>{const m=n.fields[0],y=e!=null?s[e]:s.find(M=>M!=null),H=m.display(m.values[y]).text;l=o?v.$N.Single:l;const S=(0,I.cp)(n.fields,m,s,e,l,a);if(T&&l===v.$N.Single){const M=n.fields[e],L=(0,C.GY)(M,y);let W;L&&(W=m.values[L]);const Q=m.values[y];let c;if(W)c=W&&(0,C.c5)(W-Q);else{const P=E.to.valueOf();c=(0,C.c5)(P-Q)}S.push({label:"Duration",value:c})}let N;if(e!=null){const M=n.fields[e],L=B.some(W=>W.oneClick===!0);if(o||L){const W=s[e],Q=(0,r.OG)(n,M,F,W);N=(0,p.jsx)(x.S,{dataLinks:B,actions:Q,annotate:i})}}const V={label:m.type===g.PU.time?"":m.state?.displayName??m.name,value:H};return(0,p.jsxs)(K.i,{children:[(0,p.jsx)(f.A,{item:V,isPinned:o}),(0,p.jsx)(D.o,{items:S,isPinned:o,scrollable:(0,u.T5)({mode:l,maxHeight:h}),maxHeight:h}),N]})}},24275:(Y,A,t)=>{t.r(A),t.d(A,{plugin:()=>Q});var p=t(68256),g=t(62321),v=t(62931),D=t(63739),x=t(49448),f=t(7500),K=t(95118),I=t(59698),C=t(13678),r=t(30040),u=t(58016),d=t(75029),n=t(74848),s=t(96540),e=t(74958),l=t(29675),a=t(90415),o=t(72778),i=t(12963),E=t(42515),T=t(90825),h=t(4188),F=t(37604),B=t(16725),m=t(4266),y=t(25450);const H=({data:c,timeRange:P,timeZone:U,options:O,width:_,height:z,replaceVariables:J,onChangeTimeRange:Z})=>{const R=(0,l.$j)(),[j,G]=(0,s.useState)(null),{sync:$,eventsScope:it,canAddAnnotations:et,dataLinkPostProcessor:rt,eventBus:ut}=(0,a.d2)(),q=$?.()??e.y.Off,{frames:dt,warn:nt}=(0,s.useMemo)(()=>(0,T.Qe)(c.series,O.mergeValues??!0,P,R),[c.series,O.mergeValues,P,R]),{paginatedFrames:X,paginationRev:ft,paginationElement:gt,paginationHeight:mt}=(0,y.W)(dt,O.perPage),ct=(0,s.useMemo)(()=>(0,T.Or)(X,O.legend,R),[X,O.legend,R]),pt=(0,s.useMemo)(()=>(0,B.Fg)(O.timezone,U),[O.timezone,U]);if(!X||nt)return(0,n.jsx)("div",{className:"panel-empty",children:(0,n.jsx)("p",{children:nt??"No data found in response"})});const at=!!(et&&et());return(0,n.jsxs)("div",{className:y.i.container,children:[(0,n.jsx)(E.I,{theme:R,frames:X,structureRev:c.structureRev,paginationRev:ft,timeRange:P,timeZone:pt,width:_,height:z-mt,legendItems:ct,...O,mode:T.pm.Changes,replaceVariables:J,dataLinkPostProcessor:rt,cursorSync:q,children:(w,b)=>(0,n.jsxs)(n.Fragment,{children:[q!==e.y.Off&&(0,n.jsx)(o.K,{config:w,eventBus:ut,frame:b}),O.tooltip.mode!==f.$N.None&&(0,n.jsx)(i.xl,{config:w,hoverMode:O.tooltip.mode===f.$N.Multi?i.b3.xAll:i.b3.xOne,queryZoom:Z,syncMode:q,syncScope:it,getDataLinks:(k,tt)=>b.fields[k].getLinks?.({valueRowIndex:tt})??[],render:(k,tt,ht,vt,st,lt,Et,Mt)=>{if(at&&lt!=null){G(lt),st();return}const Pt=()=>{let ot=k.posToVal(k.cursor.left,"x");G({from:ot,to:ot}),st()};return(0,n.jsx)(m.K,{series:b,dataIdxs:tt,seriesIdx:ht,mode:Et?f.$N.Multi:O.tooltip.mode,sortOrder:O.tooltip.sort,isPinned:vt,timeRange:P,annotate:at?Pt:void 0,withDuration:!0,maxHeight:O.tooltip.maxHeight,replaceVariables:J,dataLinks:Mt})},maxWidth:O.tooltip.maxWidth}),b.fields[0].config.custom?.axisPlacement!==f.vM.Hidden&&(0,n.jsx)(h.W,{annotations:c.annotations??[],config:w,timeZone:U,newRange:j,setNewRange:G,canvasRegionRendering:!1}),(0,n.jsx)(F.U,{config:w,onChangeTimeRange:Z})]})}),gt]})};var S=t(2543),N=t(65329);const V=(c,P,U)=>{let O=c.options??{};if(P==="natel-discrete-panel"&&U.angular){const _=U.angular,z=c.fieldConfig??{defaults:{},overrides:[]};_.units&&(z.defaults.unit=_.units);const J={fillOpacity:100,lineWidth:0};z.defaults.custom=J,O.mergeValues=!0;const Z={type:N.d.ValueToText,options:{}};if(z.defaults.mappings=[Z],(0,S.isArray)(_.colorMaps))for(const R of _.colorMaps){const j=R.color;j&&(Z.options[R.text]={color:j})}if((0,S.isArray)(_.valueMaps))for(const R of _.valueMaps){const j=R.text,G=R.value;if(j&&G){let $=Z.options[G];$?$.text=j:Z.options[G]={text:j}}}if((0,S.isArray)(_.rangeMaps))for(const R of _.rangeMaps){let j=+R.from,G=+R.to;const $=R.text;$&&z.defaults.mappings.push({type:N.d.RangeToText,options:{from:j,to:G,result:{text:$}}})}c.fieldConfig=z}return O};var M=t(51587),L=t(18550);class W{getSuggestionsForData(P){const{dataSummary:U}=P;if(!U.hasData||!U.hasTimeField||!U.hasStringField&&!U.hasNumberField||U.numberFieldCount>=30||U.preferredVisualisationType==="logs")return;P.getListAppender({name:"",pluginId:"state-timeline",options:{},fieldConfig:{defaults:{custom:{}},overrides:[]}}).append({name:L.m.StateTimeline})}}const Q=new p.m(H).setPanelChangeHandler(V).useFieldConfig({standardOptions:{[g.uo.Color]:{settings:{byValueSupport:!0},defaultValue:{mode:v.Y.ContinuousGrYlRd}},[g.uo.Links]:{settings:{showOneClick:!0}},[g.uo.Actions]:{hideFromDefaults:!1}},useCustomConfig:c=>{c.addSliderInput({path:"lineWidth",name:"Line width",defaultValue:M.Q.lineWidth,settings:{min:0,max:10,step:1}}).addSliderInput({path:"fillOpacity",name:"Fill opacity",defaultValue:M.Q.fillOpacity,settings:{min:0,max:100,step:1}}).addCustomEditor({id:"spanNulls",path:"spanNulls",name:"Connect null values",defaultValue:!1,editor:d.e,override:d.e,shouldApply:P=>P.type!==D.PU.time,process:x.hS,settings:{isTime:!0}}).addCustomEditor({id:"insertNulls",path:"insertNulls",name:"Disconnect values",defaultValue:!1,editor:u.Z,override:u.Z,shouldApply:P=>P.type!==D.PU.time,process:x.hS,settings:{isTime:!0}}),K.e(c),I.Wq(c,P=>P===f.vM.Auto||P===f.vM.Hidden),I.T4(c)}}).setPanelOptions(c=>{c.addBooleanSwitch({path:"mergeValues",name:"Merge equal consecutive values",defaultValue:M.K.mergeValues}).addRadio({path:"showValue",name:"Show values",settings:{options:[{value:f.yL.Auto,label:"Auto"},{value:f.yL.Always,label:"Always"},{value:f.yL.Never,label:"Never"}]},defaultValue:M.K.showValue}).addRadio({path:"alignValue",name:"Align values",settings:{options:[{value:"left",label:"Left"},{value:"center",label:"Center"},{value:"right",label:"Right"}]},defaultValue:M.K.alignValue}).addSliderInput({path:"rowHeight",name:"Row height",settings:{min:0,max:1,step:.01},defaultValue:M.K.rowHeight}).addNumberInput({path:"perPage",name:"Page size (enable pagination)",settings:{min:1,step:1,integer:!0}}),C.H(c,!1),r.D(c)}).setSuggestionsSupplier(new W).setDataSupport({annotations:!0})},51587:(Y,A,t)=>{t.d(A,{K:()=>g,Q:()=>v});var p=t(7500);const g={alignValue:"left",mergeValues:!0,perPage:20,rowHeight:.9,showValue:p.yL.Auto},v={fillOpacity:70,lineWidth:0}},25450:(Y,A,t)=>{t.d(A,{W:()=>r,i:()=>I});var p=t(74848),g=t(22803),v=t(96540),D=t(49185),x=t(16110),f=t(90825),K=t(51587);const I={container:(0,g.css)({display:"flex",flexDirection:"column"})},C={paginationContainer:(0,g.css)({display:"flex",justifyContent:"center",width:"100%"}),paginationElement:(0,g.css)({marginTop:"8px"})};function r(u,d){const[n,s]=(0,v.useState)(1),[e,{height:l,width:a}]=(0,D.A)(),o=(0,v.useMemo)(()=>!d||u==null?u:(0,f.uB)(u),[u,d]);if(!d||o==null)return{paginatedFrames:o,paginationRev:"disabled",paginationElement:void 0,paginationHeight:0};d||=K.K.perPage;const i=Math.ceil(o.length/d),E=Math.min(n,i),T=(E-1)*d,h=o.slice(T,T+d),F=`${E}/${d}`,B=a<550,m=(0,p.jsx)("div",{className:C.paginationContainer,ref:e,children:(0,p.jsx)(x.d,{className:C.paginationElement,currentPage:E,numberOfPages:i,showSmallVersion:B,onNavigate:s})});return{paginatedFrames:h,paginationRev:F,paginationElement:m,paginationHeight:l}}}}]);

//# sourceMappingURL=stateTimelinePanel.772f8350ce5762503324.js.map