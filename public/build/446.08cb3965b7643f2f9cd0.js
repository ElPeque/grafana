"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[446],{47761:(O,P,o)=>{o.d(P,{l:()=>v});var e=o(74848),x=o(22803),w=o(96540),p=o(49785);function v({defaultValues:R,onSubmit:j,validateOnMount:g=!1,validateFieldsOnMount:b,children:h,validateOn:y="onSubmit",maxWidth:u=600,...C}){const{handleSubmit:d,trigger:D,formState:m,...L}=(0,p.mN)({mode:y,defaultValues:R});return(0,w.useEffect)(()=>{g&&D(b)},[D,b,g]),(0,e.jsx)("form",{className:(0,x.css)({maxWidth:u!=="none"?u+"px":u,width:"100%"}),onSubmit:d(j),...C,children:h({errors:m.errors,formState:m,trigger:D,...L})})}},50870:(O,P,o)=>{o.d(P,{P:()=>g});var e=o(74848),x=o(22803),w=o(53027),p=o(29675),v=o(19550),R=o(20968),j=o(54594);const g=({initPhase:h})=>{const y=(0,p.of)(b),u=()=>{w.Ny.push("/")};return(0,e.jsx)("div",{className:y.dashboardLoading,children:(0,e.jsx)("div",{className:y.dashboardLoadingText,children:(0,e.jsxs)(v.gW,{spacing:"md",children:[(0,e.jsxs)(v.Gy,{align:"center",justify:"center",spacing:"xs",children:[(0,e.jsx)(R.y,{inline:!0})," ",h]})," ",(0,e.jsx)(v.Gy,{align:"center",justify:"center",children:(0,e.jsx)(j.$n,{variant:"secondary",size:"md",icon:"repeat",onClick:u,children:"Cancel loading dashboard"})})]})})})},b=h=>{const y="0.5s",u=(0,x.keyframes)`
    0% { opacity: 0%; }
    100% { opacity: 100%; }
  `;return{dashboardLoading:(0,x.css)({height:"60vh",display:"flex",opacity:"0%",alignItems:"center",justifyContent:"center",[h.transitions.handleMotion("no-preference","reduce")]:{animation:`${u} 0s step-end ${y} 1 normal forwards`}}),dashboardLoadingText:(0,x.css)({fontSize:h.typography.h4.fontSize})}}},1877:(O,P,o)=>{o.d(P,{N:()=>ct});var e=o(74848),x=o(46942),w=o.n(x),p=o(96540),v=o(66816),R=o.n(v),j=o(64423),g=o(32370),b=o(22492),h=o(40828),y=o(61351),u=o(76802),C=o(91830),d=o(22803),D=o(84140),m=o(29675),L=o(99764),K=o(11817),A=o(43518);const k=({panel:a,dashboard:t})=>{const s=r=>{r.preventDefault(),t.removePanel(a)},i=r=>{const{gridPos:l}=a,c={...r.model,gridPos:l,libraryPanel:r};t.addPanel(c),t.removePanel(a)},n=(0,m.of)(Y);return(0,e.jsx)("div",{className:n.wrapper,children:(0,e.jsxs)("div",{className:n.callToAction,children:[(0,e.jsxs)("div",{className:(0,d.cx)(n.headerRow,"grid-drag-handle"),children:[(0,e.jsx)("span",{children:(0,e.jsx)(K.x6,{i18nKey:"library-panel.add-widget.title",children:"Add panel from panel library"})}),(0,e.jsx)("div",{className:"flex-grow-1"}),(0,e.jsx)(L.K,{"aria-label":"Close 'Add Panel' widget",name:"times",onClick:s,tooltip:"Close widget"})]}),(0,e.jsx)(A.j,{onClick:i,variant:A.s.Tight,showPanelFilter:!0})]})})},Y=a=>{const t=(0,d.keyframes)({"0%":{boxShadow:`0 0 0 2px ${a.colors.background.canvas}, 0 0 0px 4px ${a.colors.primary.main}`},"50%":{boxShadow:`0 0 0 2px ${a.components.dashboard.background}, 0 0 0px 4px ${(0,D.A)(a.colors.primary.main).darken(20).toHexString()}`},"100%":{boxShadow:`0 0 0 2px ${a.components.dashboard.background}, 0 0 0px 4px  ${a.colors.primary.main}`}});return{wrapper:(0,d.css)({height:"100%",paddingTop:`${a.spacing(.5)}`}),headerRow:(0,d.css)({display:"flex",alignItems:"center",height:"38px",flexShrink:0,width:"100%",fontSize:a.typography.fontSize,fontWeight:a.typography.fontWeightMedium,paddingLeft:`${a.spacing(1)}`,[a.transitions.handleMotion("no-preference","reduce")]:{transition:"background-color 0.1s ease-in-out"},cursor:"move","&:hover":{background:`${a.colors.background.secondary}`}}),callToAction:(0,d.css)({backgroundColor:a.components.panel.background,border:`1px solid ${a.components.panel.borderColor}`,borderRadius:a.shape.radius.default,display:"flex",flex:"1 1 0",flexDirection:"column",height:"100%",position:"relative",width:"100%",outline:"2px dotted transparent",outlineOffset:"2px",overflow:"hidden",[a.transitions.handleMotion("no-preference","reduce")]:{animation:`${t} 2s ease infinite`}})}};var Q=o(2543),z=o(58779),J=o(86833),X=o(39736),Z=o(54731),T=o(79784),I=o(11747),q=o(43908),$=o(25356),B=o(86489),_=o(34128),tt=o(37e3),N=o(54594),st=o(47761),et=o(66732);const at=({repeat:a,title:t,warning:s,onUpdate:i,onCancel:n})=>{const[r,l]=(0,p.useState)(a),c=(0,p.useCallback)(f=>l(f),[l]);return(0,e.jsx)(st.l,{defaultValues:{title:t},onSubmit:f=>{i(f.title,r)},children:({register:f})=>(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(B.D,{label:"Title",children:(0,e.jsx)(_.p,{...f("title"),type:"text"})}),(0,e.jsx)(B.D,{label:"Repeat for",children:(0,e.jsx)(et.G,{repeat:r,onChange:c})}),s&&(0,e.jsx)(tt.F,{"data-testid":z.Tp.pages.Dashboard.Rows.Repeated.ConfigSection.warningMessage,severity:"warning",title:"",topSpacing:3,bottomSpacing:0,children:s}),(0,e.jsxs)($.a.ButtonRow,{children:[(0,e.jsx)(N.$n,{type:"button",variant:"secondary",onClick:n,fill:"outline",children:"Cancel"}),(0,e.jsx)(N.$n,{type:"submit",children:"Update"})]})]})})},ot=({repeat:a,title:t,onDismiss:s,onUpdate:i,warning:n})=>{const r=(0,m.of)(nt);return(0,e.jsx)($.a,{isOpen:!0,title:"Row options",icon:"copy",onDismiss:s,className:r.modal,children:(0,e.jsx)(at,{repeat:a,title:t,onCancel:s,onUpdate:i,warning:n})})},nt=()=>({modal:(0,d.css)({label:"RowOptionsModal",width:"500px"})}),F=({repeat:a,title:t,onUpdate:s,warning:i})=>{const n=r=>(l,c)=>{s(l,c),r()};return(0,e.jsx)(q.$s,{children:({showModal:r,hideModal:l})=>(0,e.jsx)("button",{type:"button",className:"pointer","aria-label":"Row options",onClick:()=>{r(ot,{title:t,repeat:a,onDismiss:l,onUpdate:n(l),warning:i})},children:(0,e.jsx)(T.I,{name:"cog"})})})};F.displayName="RowOptionsButton";class it extends p.Component{constructor(){super(...arguments),this.onVariableUpdated=()=>{this.forceUpdate()},this.onToggle=()=>{this.props.dashboard.toggleRow(this.props.panel)},this.getWarning=()=>{if((this.props.panel.panels?.length?this.props.panel.panels:this.props.dashboard.getRowPanels((0,Q.indexOf)(this.props.dashboard.panels,this.props.panel))).some(i=>i.datasource?.uid===I.K))return(0,e.jsxs)("div",{children:[(0,e.jsxs)("p",{children:["Panels in this row use the ",I.K," data source. These panels will reference the panel in the original row, not the ones in the repeated rows."]}),(0,e.jsx)(Z.Y,{external:!0,href:"https://grafana.com/docs/grafana/latest/dashboards/build-dashboards/create-dashboard/#configure-repeating-rows",children:"Learn more"})]})},this.onUpdate=(t,s)=>{this.props.panel.setProperty("title",t),this.props.panel.setProperty("repeat",s??void 0),this.props.panel.render(),this.props.dashboard.processRepeats(),this.forceUpdate()},this.onDelete=()=>{b.A.publish(new C.bY({title:"Delete row",text:"Are you sure you want to remove this row and all its panels?",altActionText:"Delete row only",icon:"trash-alt",onConfirm:()=>{this.props.dashboard.removeRow(this.props.panel,!0)},onAltAction:()=>{this.props.dashboard.removeRow(this.props.panel,!1)}}))}}componentDidMount(){this.sub=this.props.dashboard.events.subscribe(J._,this.onVariableUpdated)}componentWillUnmount(){this.sub&&this.sub.unsubscribe()}render(){const t=(0,X.w)().replace(this.props.panel.title,this.props.panel.scopedVars,"text"),s=this.props.panel.panels?this.props.panel.panels.length:0,i=s===1?"panel":"panels",n=this.props.dashboard.meta.canEdit===!0,r=this.props.panel.collapsed,l=lt(this.props.theme);return(0,e.jsxs)("div",{className:(0,d.cx)(l.dashboardRow,{[l.dashboardRowCollapsed]:r}),"data-testid":"dashboard-row-container",children:[(0,e.jsxs)("button",{"aria-expanded":!r,className:(0,d.cx)(l.title,"pointer"),type:"button","data-testid":z.Tp.components.DashboardRow.title(t),onClick:this.onToggle,children:[(0,e.jsx)(T.I,{name:r?"angle-right":"angle-down"}),t,(0,e.jsxs)("span",{className:(0,d.cx)(l.count,{[l.countCollapsed]:r}),children:["(",s," ",i,")"]})]}),n&&(0,e.jsxs)("div",{className:l.actions,children:[(0,e.jsx)(F,{title:this.props.panel.title,repeat:this.props.panel.repeat,onUpdate:this.onUpdate,warning:this.getWarning()}),(0,e.jsx)("button",{type:"button",className:"pointer",onClick:this.onDelete,"aria-label":"Delete row",children:(0,e.jsx)(T.I,{name:"trash-alt"})})]}),r===!0&&(0,e.jsx)("div",{className:(0,d.cx)({[l.toggleTargetCollapsed]:r}),onClick:this.onToggle,children:"\xA0"}),n&&(0,e.jsx)("div",{"data-testid":"dashboard-row-drag",className:(0,d.cx)(l.dragHandle,"grid-drag-handle",{[l.dragHandleCollapsed]:r})})]})}}const rt=(0,m.cV)(it),lt=a=>{const t=(0,d.css)({color:a.colors.text.secondary,opacity:0,[a.transitions.handleMotion("no-preference","reduce")]:{transition:"200ms opacity ease-in 200ms"},button:{color:a.colors.text.secondary,paddingLeft:a.spacing(2),background:"transparent",border:"none","&:hover":{color:a.colors.text.maxContrast}}});return{dashboardRow:(0,d.css)({display:"flex",alignItems:"center",height:"100%","&:hover, &:focus-within":{[`.${t}`]:{opacity:1}}}),dashboardRowCollapsed:(0,d.css)({background:a.components.panel.background}),toggleTargetCollapsed:(0,d.css)({flex:1,cursor:"pointer",marginRight:"15px"}),title:(0,d.css)({flexGrow:0,fontSize:a.typography.h5.fontSize,fontWeight:a.typography.fontWeightMedium,color:a.colors.text.primary,background:"transparent",border:"none",".fa":{color:a.colors.text.secondary,fontSize:a.typography.size.xs,padding:a.spacing(0,1)}}),actions:t,count:(0,d.css)({paddingLeft:a.spacing(2),color:a.colors.text.secondary,fontStyle:"italic",fontSize:a.typography.size.sm,fontWeight:"normal",display:"none"}),countCollapsed:(0,d.css)({display:"inline-block"}),dragHandle:(0,d.css)({cursor:"move",width:"16px",height:"100%",background:'url("public/img/grab_dark.svg") no-repeat 50% 50%',backgroundSize:"8px",visibility:"hidden",position:"absolute",top:0,right:0}),dragHandleCollapsed:(0,d.css)({visibility:"visible",opacity:1})}};var dt=o(29998),ht=o(59051);const V="systemPanelFilterVar";class ct extends p.PureComponent{constructor(t){super(t),this.panelMap={},this.eventSubs=new j.yU,this.windowHeight=1200,this.windowWidth=1920,this.gridWidth=0,this.lastPanelBottom=0,this.isLayoutInitialized=!1,this.onLayoutChange=s=>{if(!this.state.panelFilter){for(const i of s)this.panelMap[i.i].updateGridPos(i,this.isLayoutInitialized);this.isLayoutInitialized&&(this.isLayoutInitialized=!0),this.props.dashboard.sortPanelsByGridPos(),this.forceUpdate()}},this.triggerForceUpdate=()=>{this.forceUpdate()},this.updateGridPos=(s,i)=>{this.panelMap[s.i].updateGridPos(s)},this.onResize=(s,i,n)=>{this.panelMap[n.i].updateGridPos(n)},this.onResizeStop=(s,i,n)=>{this.updateGridPos(n,s)},this.onDragStop=(s,i,n)=>{this.updateGridPos(n,s)},this.onGetWrapperDivRef=s=>{s&&y.TP.user.authenticatedBy!=="render"&&setTimeout(()=>{s.classList.add("react-grid-layout--enable-move-animations")},50)},this.rootEl=null,this.onMeasureRef=s=>{if(!s){this.rootEl&&this.resizeObserver&&this.resizeObserver.unobserve(this.rootEl);return}this.rootEl=s,this.resizeObserver=new ResizeObserver(i=>{i.forEach(n=>{this.setState({width:n.contentRect.width})})}),this.resizeObserver.observe(s)},this.state={panelFilter:void 0,width:document.body.clientWidth}}componentDidMount(){const{dashboard:t}=this.props;if(g.$.featureToggles.panelFilterVariable){for(const s of t.getVariables())if(s.id===V){"query"in s&&this.setPanelFilter(s.query);break}this.eventSubs.add(b.A.subscribe(u.og,s=>{if(s.payload.variable?.id===V&&"current"in s.payload.variable){let i=s.payload.variable.current;"value"in i&&typeof i.value=="string"&&this.setPanelFilter(i.value)}}))}this.eventSubs.add(t.events.subscribe(C.Q$,this.triggerForceUpdate))}componentWillUnmount(){this.eventSubs.unsubscribe()}setPanelFilter(t){let s;t.length>0&&(s=new RegExp(t,"i")),this.setState({panelFilter:s})}buildLayout(){const t=[];this.panelMap={};const{panelFilter:s}=this.state;let i=0;for(const n of this.props.dashboard.panels){if(n.key||(n.key=`panel-${n.id}-${Date.now()}`),this.panelMap[n.key]=n,!n.gridPos){console.log("panel without gridpos");continue}const r={i:n.key,x:n.gridPos.x,y:n.gridPos.y,w:n.gridPos.w,h:n.gridPos.h};n.type==="row"&&(r.w=h.cV,r.h=1,r.isResizable=!1,r.isDraggable=n.collapsed),s?s.test(n.title)&&(r.isResizable=!1,r.isDraggable=!1,r.x=i%2*h.cV,r.y=Math.floor(i/2),t.push(r),i++):t.push(r)}return t}getPanelScreenPos(t,s){let i=0;return s<g.$.theme2.breakpoints.values.md?i=this.lastPanelBottom+h.dU:i=U(t.gridPos.y)+h.dU,this.lastPanelBottom=i+U(t.gridPos.h),{top:i,bottom:this.lastPanelBottom}}renderPanels(t,s){const{panelFilter:i}=this.state,n=[];this.lastPanelBottom=0,this.gridWidth!==t&&(this.windowHeight=window.innerHeight??1e3,this.windowWidth=window.innerWidth,this.gridWidth=t);for(const r of this.props.dashboard.panels){const l=w()({"react-grid-item--fullscreen":r.isViewing}),c=(0,e.jsx)(G,{className:l,"data-panelid":r.id,gridPos:r.gridPos,gridWidth:t,windowHeight:this.windowHeight,windowWidth:this.windowWidth,isViewing:r.isViewing,children:(f,W)=>this.renderPanel(r,f,W,s)},r.key);i?i.test(r.title)&&n.push(c):n.push(c)}return n}renderPanel(t,s,i,n){return t.type==="row"?(0,e.jsx)(rt,{panel:t,dashboard:this.props.dashboard},t.key):t.type==="add-library-panel"?(0,e.jsx)(k,{panel:t,dashboard:this.props.dashboard},t.key):(0,e.jsx)(ht.L,{stateKey:t.key,panel:t,dashboard:this.props.dashboard,isEditing:t.isEditing,isViewing:t.isViewing,isDraggable:n,width:s,height:i,hideMenu:this.props.hidePanelMenus},t.key)}render(){const{isEditable:t,dashboard:s}=this.props,{width:i}=this.state;if(s.panels.length===0)return(0,e.jsx)(dt.A,{dashboard:s,canCreate:t});const n=i<=g.$.theme2.breakpoints.values.md?!1:t;return(0,e.jsx)("div",{ref:this.onMeasureRef,style:{flex:"1 1 auto",position:"relative",zIndex:1,display:this.props.editPanel?"none":void 0},children:(0,e.jsx)("div",{style:{width:i,height:"100%"},ref:this.onGetWrapperDivRef,children:(0,e.jsx)(R(),{width:i,isDraggable:n,isResizable:t,containerPadding:[0,0],useCSSTransforms:!0,margin:[h.dU,h.dU],cols:h.cV,rowHeight:h.sD,draggableHandle:".grid-drag-handle",draggableCancel:".grid-drag-cancel",layout:this.buildLayout(),onDragStop:this.onDragStop,onResize:this.onResize,onResizeStop:this.onResizeStop,onLayoutChange:this.onLayoutChange,children:this.renderPanels(i,n)})})})}}const G=p.forwardRef((a,t)=>{const s=g.$.theme2;let i=100,n=100;const{gridWidth:r,gridPos:l,isViewing:c,windowHeight:f,windowWidth:W,...H}=a,S=a.style??{};if(c)i=r,n=f*.85,S.height=n,S.width="100%";else if(W<s.breakpoints.values.md)i=a.gridWidth,n=U(l.h),S.height=n,S.width="100%";else if(a.style){const{width:E,height:M}=a.style;E!=null&&(i=typeof E=="number"?E:parseFloat(E)),M!=null&&(n=typeof M=="number"?M:parseFloat(M))}return(0,e.jsx)("div",{...H,style:{...H.style},ref:t,children:[a.children[0](i,n),a.children.slice(1)]})});function U(a){return a*(h.sD+h.dU)-h.dU}G.displayName="GridItemWithDimensions"}}]);

//# sourceMappingURL=446.08cb3965b7643f2f9cd0.js.map