"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[4176],{47761:(y,D,e)=>{e.d(D,{l:()=>P});var o=e(74848),s=e(22803),u=e(96540),v=e(49785);function P({defaultValues:A,onSubmit:t,validateOnMount:l=!1,validateFieldsOnMount:E,children:i,validateOn:d="onSubmit",maxWidth:a=600,...R}){const{handleSubmit:h,trigger:f,formState:C,...M}=(0,v.mN)({mode:d,defaultValues:A});return(0,u.useEffect)(()=>{l&&f(E)},[f,E,l]),(0,o.jsx)("form",{className:(0,s.css)({maxWidth:a!=="none"?a+"px":a,width:"100%"}),onSubmit:h(t),...R,children:i({errors:C.errors,formState:C,trigger:f,...M})})}},60156:(y,D,e)=>{e.d(D,{y:()=>l});var o=e(74848),s=e(96540),u=e(41053),v=e(87638),P=e(61491),A=e(71623),t=e(26185);const l=({basicRole:E,roles:i,userId:d,orgId:a,onBasicRoleChange:R,roleOptions:h,disabled:f,basicRoleDisabled:C,basicRoleDisabledMessage:M,apply:j=!1,onApplyRoles:c,pendingRoles:r,maxWidth:x,width:B,isLoading:U})=>{const[{loading:F,value:L=i||[]},I]=(0,u.A)(async()=>{try{if(i)return i;if(j&&r?.length)return r;if(v.TP.hasPermission(P.AccessControlAction.ActionUserRolesList)&&d>0)return await(0,t.Xh)(d,a)}catch{console.error("Error loading options")}return[]},[a,d,r,i]);(0,s.useEffect)(()=>{a&&I()},[I,a]);const N=async m=>{j?c&&c(m,d,a):(await(0,t.eA)(m,d,a),await I())},O=v.TP.hasPermission(P.AccessControlAction.ActionUserRolesAdd)&&v.TP.hasPermission(P.AccessControlAction.ActionUserRolesRemove);return(0,o.jsx)(A.n,{appliedRoles:L,basicRole:E,onRolesChange:N,onBasicRoleChange:R,roleOptions:h,isLoading:F||U,disabled:f,basicRoleDisabled:C,basicRoleDisabledMessage:M,showBasicRole:!0,apply:j,canUpdateRoles:O,maxWidth:x,width:B})}},97531:(y,D,e)=>{e.d(D,{I:()=>a});var o=e(74848),s=e(49785),u=e(35095),v=e(54731),P=e(58528),A=e(86489),t=e(60641),l=e(11817),E=e(61491);const i=Object.keys(E.OrgRole).map(u.z),d=(0,o.jsxs)(l.x6,{i18nKey:"role-picker.title.description",children:["Assign roles to users to ensure granular control over access to Grafana\u2018s features and resources. Find out more in our"," ",(0,o.jsx)(v.Y,{external:!0,href:"https://grafana.com/docs/grafana/latest/administration/roles-and-permissions/#organization-roles",children:"documentation"}),"."]}),a=({onClose:R})=>{const h=(0,s.xW)(),{control:f,getValues:C,setValue:M}=h,[j,c]=C(["name","roles"]);return(0,o.jsx)(P._,{title:j,subtitle:d,onClose:R,children:(0,o.jsx)(A.D,{label:(0,l.t)("role-picker-drawer.basic-roles.label","Basic Roles"),children:(0,o.jsx)(s.xI,{name:"role",control:f,render:({field:{onChange:r,ref:x,...B}})=>(0,o.jsx)(t.z,{...B,options:i,onChange:U=>{M("roleCollection",[U,...c]),r(U)}})})})})}},68031:(y,D,e)=>{e.d(D,{r:()=>A});var o=e(74848),s=e(83827),u=e(44826);const P=Object.values(s.X).filter(t=>t!==s.X.None).map(t=>({label:t,value:t}));function A({value:t,onChange:l,"aria-label":E,inputId:i,autoFocus:d,...a}){return(0,o.jsx)(u.l6,{inputId:i,value:t,options:P,onChange:R=>l(R.value??s.X.None),placeholder:"Choose role...","aria-label":E,autoFocus:d,...a})}},94616:(y,D,e)=>{e.r(D),e.d(D,{ServiceAccountCreatePage:()=>I,default:()=>N});var o=e(74848),s=e(96540),u=e(49785),v=e(28082),P=e(53027),A=e(32370),t=e(44617),l=e(86489),E=e(34128),i=e(54594),d=e(47761),a=e(54122),R=e(60156),h=e(26185),f=e(35095),C=e(44826),M=e(97531);const j=({})=>{const[O,m]=(0,s.useState)(!1),{control:K}=(0,u.xW)(),W=()=>m(!O);return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(u.xI,{name:"role-collection",control:K,render:({field:{ref:z,value:S,...$}})=>(0,o.jsx)(C.KF,{...$,onOpenMenu:W,onChange:()=>{},value:S?.map(f.z)})}),O&&(0,o.jsx)(M.I,{onClose:W})]})};var c=e(87638),r=e(11817),x=e(61491),B=e(68031);const U=async O=>{const m=await(0,v.AI)().post("/api/serviceaccounts/",O);return await c.TP.fetchUserPermissions(),m},F=async(O,m)=>(0,v.AI)().patch(`/api/serviceaccounts/${O}`,m),L={id:0,uid:"",orgId:c.TP.user.orgId,role:c.TP.licensedAccessControlEnabled()?x.OrgRole.None:x.OrgRole.Viewer,tokens:0,name:"",login:"",isDisabled:!1,createdAt:"",teams:[]},I=({})=>{const[O,m]=(0,s.useState)([]),[K,W]=(0,s.useState)([]),z=(0,u.mN)({defaultValues:{name:"",role:L.role,roleCollection:[L.role],roles:[]}}),{formState:{errors:S},register:$}=z,V=c.TP.user.orgId,[T,b]=(0,s.useState)(L);(0,s.useEffect)(()=>{async function g(){try{if(c.TP.hasPermission(x.AccessControlAction.ActionRolesList)){let n=await(0,h.RL)(V);m(n)}}catch(n){console.error("Error loading options",n)}}c.TP.licensedAccessControlEnabled()&&g()},[V]);const Y=(0,s.useCallback)(async g=>{g.role=T.role;const n=await U(g);try{const p={avatarUrl:n.avatarUrl,id:n.id,uid:n.uid,isDisabled:n.isDisabled,login:n.login,name:n.name,orgId:n.orgId,role:n.role,tokens:n.tokens};await F(p.uid,g),c.TP.licensedAccessControlEnabled()&&c.TP.hasPermission(x.AccessControlAction.ActionUserRolesAdd)&&c.TP.hasPermission(x.AccessControlAction.ActionUserRolesRemove)&&await(0,h.eA)(K,p.id,p.orgId)}catch(p){console.error(p)}P.Ny.push(`/org/serviceaccounts/${n.uid}`)},[T.role,K]),X=g=>{b({...T,role:g})},G=(g,n,p)=>{W(g)};return(0,o.jsx)(a.Y,{navId:"serviceaccounts",pageNav:{text:(0,r.t)("service-account-create-page.page-nav.label","Create service account")},children:(0,o.jsxs)(a.Y.Contents,{children:[A.$.featureToggles.rolePickerDrawer&&(0,o.jsx)(u.Op,{...z,children:(0,o.jsxs)("form",{children:[(0,o.jsxs)(t.n,{children:[(0,o.jsx)(l.D,{label:(0,r.t)("service-account-create-page.name.label","Display name"),required:!0,invalid:!!S.name,error:S.name?(0,r.t)("service-account-create-page.name.required-error","Display name is required"):void 0,children:(0,o.jsx)(E.p,{id:"name",...$("name",{required:!0}),autoFocus:!0})}),(0,o.jsx)(l.D,{label:(0,r.t)("service-account-create-page.role.label","Role"),children:(0,o.jsx)(j,{})})]}),(0,o.jsx)(i.$n,{type:"submit",children:(0,o.jsx)(r.x6,{i18nKey:"service-account-create-page.create.button",children:"Create"})})]})}),!A.$.featureToggles.rolePickerDrawer&&(0,o.jsx)(d.l,{onSubmit:Y,validateOn:"onSubmit",children:({register:g,errors:n})=>(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(t.n,{children:[(0,o.jsx)(l.D,{label:(0,r.t)("service-account-create-page.name.label","Display name"),required:!0,invalid:!!n.name,error:n.name?(0,r.t)("service-account-create-page.name.required-error","Display name is required"):void 0,children:(0,o.jsx)(E.p,{id:"display-name-input",...g("name",{required:!0}),autoFocus:!0})}),(0,o.jsx)(l.D,{label:(0,r.t)("service-account-create-page.role.label","Role"),children:c.TP.licensedAccessControlEnabled()?(0,o.jsx)(R.y,{apply:!0,userId:T.id||0,orgId:T.orgId,basicRole:T.role,onBasicRoleChange:X,roleOptions:O,onApplyRoles:G,pendingRoles:K,maxWidth:"100%"}):(0,o.jsx)(B.r,{"aria-label":(0,r.t)("service-account-create-page.role.label","Role"),value:T.role,onChange:X})})]}),(0,o.jsx)(i.$n,{type:"submit",children:(0,o.jsx)(r.x6,{i18nKey:"service-account-create-page.create.button",children:"Create"})})]})})]})})},N=I}}]);

//# sourceMappingURL=ServiceAccountCreatePage.b3d1b6f4f745ca3d740d.js.map