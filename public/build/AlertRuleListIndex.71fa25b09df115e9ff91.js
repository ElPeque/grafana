"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[3511],{68093:(pe,S,n)=>{n.r(S),n.d(S,{default:()=>rs});var e=n(74848),a=n(96540),y=n(32370),M=n(54148),E=n(41053),x=n(10940),v=n(93407),P=n(18729),D=n(48583),o=n(54594),l=n(65539),d=n(11817),g=n(61491),j=n(83893),oe=n(32174),G=n(62592),W=n(59830),K=n(54731),H=n(45246);const Ce=()=>{const{canCreateGrafanaRules:s,canCreateCloudRules:t}=(0,H.V)(),r=s||t;return(0,e.jsx)("div",{children:(0,e.jsx)(W.p,{message:"You haven't created any rules yet",variant:"call-to-action",button:r?(0,e.jsxs)(D.B,{direction:"row",alignItems:"center",justifyContent:"center",children:[r&&(0,e.jsx)(o.z9,{variant:"primary",icon:"plus",size:"lg",href:"alerting/new/alerting",children:(0,e.jsx)(d.x6,{i18nKey:"alerting.list-view.empty.new-alert-rule",children:"New alert rule"})}),t&&(0,e.jsx)(o.z9,{variant:"primary",icon:"plus",size:"lg",href:"alerting/new/recording",children:(0,e.jsx)(d.x6,{i18nKey:"alerting.list-view.empty.new-recording-rule",children:"New recording rule"})})]}):null,children:(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)(d.x6,{i18nKey:"alerting.list-view.empty.provisioning",children:["You can also define rules through file provisioning or Terraform."," ",(0,e.jsx)(K.Y,{href:"https://grafana.com/docs/grafana/latest/alerting/set-up/provision-alerting-resources/",external:!0,children:"Learn more"})]})})})})};var Q=n(6774),f=n(22803),ke=n(55127),Ne=n.n(ke),qe=n(78685),se=n(29675),rn=n(37e3),Ye=n(6736),ge=n(9912),L=n(88214),Oe=n(85651),X=n(82700);function _e(){const[s,t]=(0,a.useState)(!1),[r,u]=(0,qe.A)("grafana.unifiedalerting.hideErrors",!1),c=(0,ge.$)(i=>i.promRules),m=(0,ge.$)(i=>i.rulerRules),h=(0,se.of)($),R=(0,a.useMemo)(()=>{const[i,I]=[c,m].map(B=>(0,L.qi)().reduce((w,T)=>{const J=B[T.name]?.error;return B[T.name]&&J&&!(0,X.$7)(B[T.name])?[...w,{dataSource:T,error:J}]:w},[])),V=c[L.hY]?.error,q=m[L.hY]?.error,b=[];return V&&b.push((0,e.jsxs)(e.Fragment,{children:["Failed to load Grafana rules state: ",V.message||"Unknown error."]})),q&&b.push((0,e.jsxs)(e.Fragment,{children:["Failed to load Grafana rules config: ",q.message||"Unknown error."]})),i.forEach(({dataSource:B,error:w})=>b.push((0,e.jsxs)(e.Fragment,{children:["Failed to load rules state from"," ",(0,e.jsx)("a",{href:(0,Oe.GD)(B.uid),className:h.dsLink,children:B.name}),": ",w.message||"Unknown error."]}))),I.forEach(({dataSource:B,error:w})=>b.push((0,e.jsxs)(e.Fragment,{children:["Failed to load rules config from"," ",(0,e.jsx)("a",{href:(0,Oe.GD)(B.uid),className:h.dsLink,children:B.name}),": ",w.message||"Unknown error."]}))),b},[c,m,h.dsLink]);return(0,e.jsxs)(e.Fragment,{children:[!!R.length&&r&&(0,e.jsx)(F,{count:R.length,onClick:()=>u(i=>!i)}),!!R.length&&!r&&(0,e.jsxs)(rn.F,{"data-testid":"cloud-rulessource-errors",title:"Errors loading rules",severity:"error",onRemove:()=>u(!0),children:[s&&R.map((i,I)=>(0,e.jsx)("div",{children:i},I)),!s&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{children:R[0]}),R.length>=2&&(0,e.jsxs)(o.$n,{className:h.moreButton,fill:"text",icon:"angle-right",size:"sm",onClick:()=>t(!0),children:[R.length-1," more ",Ne()("error",R.length-1)]})]})]})]})}const F=({count:s,onClick:t})=>{const r=(0,se.of)($);return(0,e.jsx)("div",{className:r.floatRight,children:(0,e.jsx)(Ye.m,{content:"Show all errors",placement:"bottom",children:(0,e.jsx)(o.$n,{fill:"text",variant:"destructive",icon:"exclamation-triangle",onClick:t,children:s>1?(0,e.jsxs)(e.Fragment,{children:[s," errors"]}):(0,e.jsx)(e.Fragment,{children:"1 error"})})})})},$=s=>({moreButton:(0,f.css)({padding:0}),floatRight:(0,f.css)({display:"flex",justifyContent:"flex-end"}),dsLink:(0,f.css)({fontWeight:s.typography.fontWeightBold})});var A=n(747),U=n(57323),le=n(45565),te=n(81876),ye=n(20968),Fe=n(16110),Le=n(40828),Ae=n(99797),fe=n(15686),me=n(4013),Ue=n(58779),Ge=n(66384),on=n(65164),$e=n(79784),Z=n(27106),ze=n(83394),Me=n(5240),ve=n(48542),p=n(25779),Y=n(10372);const{useDeleteRuleGroupFromNamespaceMutation:Ie}=Me.hK,{useLazyDiscoverDsFeaturesQuery:O}=Z.L;function We(){const[s]=Ie(),[t]=O();return(0,p.Yb)(async r=>{const{dataSourceName:u,namespaceName:c,groupName:m}=r,{rulerConfig:h}=await t({rulesSourceName:u}).unwrap();if(!h)throw(0,Y._)(u);const R=await s({rulerConfig:h,namespace:c,group:m}).unwrap();return await(0,ze.JD)((0,ve.Lc)({rulesSourceName:u})),R})}var je=n(34657),Be=n(3161),Ee=n(79653),Ve=n(33911),Ke=n(75319),be=n(41494),Je=n(65071);function en({folder:s,onClose:t}){const[r,u]=(0,a.useState)("yaml");return(0,e.jsx)(be.m,{title:`Export ${s.title} rules`,activeTab:r,onTabChange:u,onClose:t,formatProviders:Object.values(Je.sl),children:(0,e.jsx)(ln,{folder:s,exportFormat:r,onClose:t})})}function ln({folder:s,exportFormat:t,onClose:r}){const{currentData:u="",isFetching:c}=Me.hK.endpoints.exportRules.useQuery({folderUid:s.uid,format:t});if(c)return(0,e.jsx)(te._,{text:"Loading...."});const m=`${s.title}-${s.uid}`;return(0,e.jsx)(Ke.J,{format:t,textDefinition:u,downloadFileName:m,onClose:r})}function cn({folderUid:s,groupName:t,onClose:r}){const[u,c]=(0,a.useState)("yaml");return(0,e.jsx)(be.m,{title:`Export ${t} rules`,activeTab:u,onTabChange:c,onClose:r,formatProviders:Object.values(Je.sl),children:(0,e.jsx)(nn,{folderUid:s,groupName:t,exportFormat:u,onClose:r})})}function nn({folderUid:s,groupName:t,exportFormat:r,onClose:u}){const{currentData:c="",isFetching:m}=Me.hK.endpoints.exportRules.useQuery({folderUid:s,group:t,format:r});return m?(0,e.jsx)(te._,{text:"Loading...."}):(0,e.jsx)(Ke.J,{format:r,textDefinition:c,downloadFileName:t,onClose:u})}var Qe=n(66976),ie=n(70437),dn=n(40295),z=n(57095),ce=n(46942),Te=n.n(ce),xe=n(1932),ee=n(25356),ae=n(44873),sn=n(76206),tn=n(68639);const un=s=>{const t=(0,se.of)(we),{group:r,namespace:u,onClose:c,folderUid:m}=s,[h,R]=(0,a.useState)([]),[i,I]=(0,ae.ts)(),V=(0,p.VP)(I),{currentData:q,isLoading:b}=Me.hK.endpoints.getRuleGroupForNamespace.useQuery({rulerConfig:s.rulerConfig,namespace:m??u.name,group:r.name},{refetchOnMountOrArgChange:!0}),[B,w]=(0,a.useState)([]);(0,a.useEffect)(()=>{q&&w(q?.rules)},[q]);const T=(0,a.useCallback)(N=>{if(!N.destination)return;const _=[N.source.index,N.destination.index];R((0,xe.jM)(h,Pe=>{Pe.push(_)}));const Re=(0,xe.jM)(B,Pe=>{(0,sn.Ct)(Pe,_)});w(Re)},[B,h]),J=(0,a.useCallback)(async()=>{const N=(0,X.y1)(u.rulesSource),_={dataSourceName:N,groupName:r.name,namespaceName:m??u.name};await i.execute(_,h),await(0,ze.JD)((0,ve.eB)({rulesSourceName:N})),c()},[u.rulesSource,u.name,r.name,m,i,h,c]),de=B.map(N=>({...N,uid:(0,tn.Ns)(N)}));return(0,e.jsxs)(ee.a,{className:t.modal,isOpen:!0,title:(0,e.jsx)(gn,{namespace:u,group:r}),onDismiss:c,onClickBackdrop:c,children:[b&&"Loading...",de.length>0&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(z.DragDropContext,{onDragEnd:T,children:(0,e.jsx)(z.Droppable,{droppableId:"alert-list",mode:"standard",renderClone:(N,_,Re)=>(0,e.jsx)(C,{provided:N,rule:de[Re.source.index],isClone:!0}),children:N=>(0,e.jsxs)("div",{ref:N.innerRef,className:Te()(t.listContainer,V&&t.disabled),...N.droppableProps,children:[de.map((_,Re)=>(0,e.jsx)(z.Draggable,{draggableId:_.uid,index:Re,isDragDisabled:V,children:Pe=>(0,e.jsx)(C,{provided:Pe,rule:_},_.uid)},_.uid)),N.placeholder]})})}),(0,e.jsxs)(ee.a.ButtonRow,{children:[(0,e.jsx)(o.$n,{variant:"secondary",fill:"outline",onClick:c,children:(0,e.jsx)(d.x6,{i18nKey:"common.cancel",children:"Cancel"})}),(0,e.jsx)(o.$n,{onClick:()=>J(),disabled:V,children:(0,e.jsx)(d.x6,{i18nKey:"common.save",children:"Save"})})]})]})]})},C=({provided:s,rule:t,isClone:r=!1,isDragging:u=!1})=>{const c=(0,se.of)(we);return(0,e.jsxs)("div",{"data-testid":"reorder-alert-rule",className:Te()(c.listItem,r&&"isClone",u&&"isDragging"),ref:s.innerRef,...s.draggableProps,...s.dragHandleProps,children:[(0,X.lT)(t)&&(0,e.jsx)("div",{className:c.listItemName,children:t.grafana_alert.title}),(0,X.i7)(t)&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:c.listItemName,children:t.record}),(0,e.jsx)(Ge.E,{text:"Recording",color:"purple"})]}),(0,X.$y)(t)&&(0,e.jsx)("div",{className:c.listItemName,children:t.alert}),(0,e.jsx)($e.I,{name:"draggabledots"})]})},gn=({namespace:s,group:t})=>{const r=(0,se.of)(we);return(0,e.jsxs)("div",{className:r.header,children:[(0,e.jsx)($e.I,{name:"folder"}),(0,L.Eb)(s.rulesSource)&&(0,e.jsx)(Ye.m,{content:s.rulesSource.name,placement:"top",children:(0,e.jsx)("img",{alt:s.rulesSource.meta.name,className:r.dataSourceIcon,src:s.rulesSource.meta.info.logos.small})}),(0,e.jsx)("span",{children:s.name}),(0,e.jsx)($e.I,{name:"angle-right"}),(0,e.jsx)("span",{children:t.name})]})},we=s=>({modal:(0,f.css)({maxWidth:"640px",maxHeight:"80%",overflow:"hidden"}),listItem:(0,f.css)({display:"flex",flexDirection:"row",alignItems:"center",gap:s.spacing(),background:s.colors.background.primary,color:s.colors.text.secondary,borderBottom:`solid 1px ${s.colors.border.medium}`,padding:`${s.spacing(1)} ${s.spacing(2)}`,"&:last-child":{borderBottom:"none"},"&.isClone":{border:`solid 1px ${s.colors.primary.shade}`}}),listContainer:(0,f.css)({userSelect:"none",border:`solid 1px ${s.colors.border.medium}`}),disabled:(0,f.css)({opacity:"0.5",pointerEvents:"none"}),listItemName:(0,f.css)({flex:1,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}),header:(0,f.css)({display:"flex",alignItems:"center",gap:s.spacing(1)}),dataSourceIcon:(0,f.css)({width:s.spacing(2),height:s.spacing(2)})});var He=n(31237),hn=n(88755);const{useDiscoverDsFeaturesQuery:jn}=Z.L,k=a.memo(({group:s,namespace:t,expandAll:r,viewMode:u})=>{const{rulesSource:c}=t,m=(0,L.EV)(c),h=(0,hn.ZI)(c),[R]=We(),i=(0,se.of)(Pn),[I,V]=(0,a.useState)(!1),[q,b]=(0,a.useState)(!1),[B,w]=(0,a.useState)(!1),[T,J]=(0,a.useState)(void 0),[de,N]=(0,a.useState)(!r),{canEditRules:_}=(0,H.V)();(0,a.useEffect)(()=>{N(!r)},[r]);const{hasRuler:Re,rulerConfig:Pe}=(0,Be.y)(t.rulesSource),{currentData:re}=jn({rulesSourceName:m}),Ze=s.rules[0]?.rulerRule,an=Ze&&(0,X.lT)(Ze)&&Ze.grafana_alert.namespace_uid||void 0,{folder:De}=(0,je.a4)(an),mn=Re&&h&&!s.rules.find(Se=>!!Se.rulerRule),pn=(0,X.YN)(s),xn=s.rules.some(Se=>(0,X.lT)(Se.rulerRule)&&Se.rulerRule.grafana_alert.provenance),ue=u==="list",ne=u==="grouped",fn=(0,a.useMemo)(()=>{const Se=t.uid??t.name,ls=s.name,is=(0,L.EV)(t.rulesSource);return{namespaceName:Se,groupName:ls,dataSourceName:is}},[t,s.name]),On=async()=>{await R.execute(fn),b(!1)},he=[];if(mn)he.push((0,e.jsxs)(D.B,{children:[(0,e.jsx)(ye.y,{}),"deleting"]},"is-deleting"));else if(c===L.hY){if(an){const Se=(0,Oe.NH)(an);De?.canSave&&(ne&&!xn&&(he.push((0,e.jsx)(ie.M,{"aria-label":"edit rule group","data-testid":"edit-group",icon:"pen",tooltip:"edit rule group",onClick:()=>V(!0)},"edit")),he.push((0,e.jsx)(ie.M,{"data-testid":"reorder-group",icon:"exchange-alt",tooltip:"reorder rules",className:i.rotate90,onClick:()=>w(!0)},"reorder"))),ue&&(he.push((0,e.jsx)(ie.M,{"aria-label":"go to folder",icon:"folder-open",tooltip:"go to folder",to:Se,target:"__blank"},"goto")),De?.canAdmin&&he.push((0,e.jsx)(ie.M,{"aria-label":"manage permissions",icon:"lock",tooltip:"manage permissions",to:Se+"/permissions",target:"__blank"},"manage-perms")))),De&&(ue?he.push((0,e.jsx)(ie.M,{"aria-label":"export rule folder","data-testid":"export-folder",icon:"download-alt",tooltip:"Export rules folder",onClick:()=>J("folder")},"export-folder")):ne&&he.push((0,e.jsx)(ie.M,{"aria-label":"export rule group","data-testid":"export-group",icon:"download-alt",tooltip:"Export rule group",onClick:()=>J("group")},"export-group")))}}else _(c.name)&&Re&&(pn||(he.push((0,e.jsx)(ie.M,{"aria-label":"edit rule group","data-testid":"edit-group",icon:"pen",tooltip:"edit rule group",onClick:()=>V(!0)},"edit")),he.push((0,e.jsx)(ie.M,{"data-testid":"reorder-group",icon:"exchange-alt",tooltip:"reorder rules",className:i.rotate90,onClick:()=>w(!0)},"reorder"))),he.push((0,e.jsx)(ie.M,{"aria-label":"delete rule group","data-testid":"delete-group",icon:"trash-alt",tooltip:"delete rule group",onClick:()=>b(!0)},"delete-group")));const vn=ue?(0,e.jsx)(Ve.c,{namespace:(0,Qe.EL)(t).name}):(0,e.jsx)(Ve.c,{namespace:(0,Qe.EL)(t).name,group:s.name}),os=(Se=!1)=>{Se||(0,j.fH)(j.le.leavingRuleGroupEdit),V(!1)};return(0,e.jsxs)("div",{className:i.wrapper,"data-testid":"rule-group",children:[(0,e.jsxs)("div",{className:i.header,"data-testid":"rule-group-header",children:[(0,e.jsx)(Ee.e,{size:"sm",className:i.collapseToggle,isCollapsed:de,onToggle:N,"data-testid":Ue.Tp.components.AlertRules.groupToggle}),(0,e.jsx)(Rn,{isCollapsed:de}),(0,e.jsx)(En,{rulesSource:c}),(0,e.jsxs)("div",{className:i.groupName,onClick:()=>N(!de),children:[pn&&(0,e.jsx)(Ge.E,{color:"purple",text:"Federated"})," ",vn]}),(0,e.jsx)("div",{className:i.spacer}),(0,e.jsx)("div",{className:i.headerStats,children:(0,e.jsx)(He.j7,{group:s})}),xn&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:i.actionsSeparator,children:"|"}),(0,e.jsx)("div",{className:i.actionIcons,children:(0,e.jsx)(Ge.E,{color:"purple",text:"Provisioned"})})]}),!!he.length&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:i.actionsSeparator,children:"|"}),(0,e.jsx)("div",{className:i.actionIcons,children:(0,e.jsx)(D.B,{gap:.5,children:he})})]})]}),!de&&(0,e.jsx)(hn.sF,{showSummaryColumn:!0,className:i.rulesTable,showGuidelines:!0,showNextEvaluationColumn:!!s.interval,rules:s.rules}),I&&Pe&&(0,e.jsx)(dn.dh,{ruleGroupIdentifier:fn,rulerConfig:Pe,folderTitle:(0,Qe.EL)(t).name,onClose:()=>os(),folderUrl:De?.canEdit?(0,Oe.qN)(De.uid):void 0}),B&&re?.rulerConfig&&(0,e.jsx)(un,{group:s,folderUid:an,namespace:t,onClose:()=>w(!1),rulerConfig:re.rulerConfig}),(0,e.jsx)(on.u,{isOpen:q,title:"Delete group",body:(0,e.jsxs)("div",{children:[(0,e.jsxs)("p",{children:['Deleting "',(0,e.jsx)("strong",{children:s.name}),'" will permanently remove the group and'," ",s.rules.length," alert ",Ne()("rule",s.rules.length)," belonging to it."]}),(0,e.jsx)("p",{children:"Are you sure you want to delete this group?"})]}),onConfirm:On,onDismiss:()=>b(!1),confirmText:"Delete"}),De&&T==="folder"&&(0,e.jsx)(en,{folder:De,onClose:()=>J(void 0)}),De&&T==="group"&&(0,e.jsx)(cn,{folderUid:De.uid,groupName:s.name,onClose:()=>J(void 0)})]})});k.displayName="RulesGroup";const En=a.memo(({rulesSource:s})=>{const t=(0,se.of)(Pn);return(0,L.Eb)(s)?(0,e.jsx)(Ye.m,{content:s.name,placement:"top",children:(0,e.jsx)("img",{alt:s.meta.name,className:t.dataSourceIcon,src:s.meta.info.logos.small})}):null});En.displayName="CloudSourceLogo";const Rn=a.memo(({isCollapsed:s})=>(0,e.jsx)($e.I,{name:s?"folder":"folder-open"}));Rn.displayName="FolderIcon";const Pn=s=>({wrapper:(0,f.css)({}),header:(0,f.css)({display:"flex",flexDirection:"row",alignItems:"center",padding:`${s.spacing(1)} ${s.spacing(1)} ${s.spacing(1)} 0`,flexWrap:"nowrap",borderBottom:`1px solid ${s.colors.border.weak}`,"&:hover":{backgroundColor:s.components.table.rowHoverBackground}}),headerStats:(0,f.css)({flexShrink:0,span:{verticalAlign:"middle"},[s.breakpoints.down("sm")]:{order:2,width:"100%",paddingLeft:s.spacing(1)}}),groupName:(0,f.css)({marginLeft:s.spacing(1),marginBottom:0,cursor:"pointer",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}),spacer:(0,f.css)({flex:1}),collapseToggle:(0,f.css)({background:"none",border:"none",marginTop:`-${s.spacing(1)}`,marginBottom:`-${s.spacing(1)}`,svg:{marginBottom:0}}),dataSourceIcon:(0,f.css)({width:s.spacing(2),height:s.spacing(2),marginLeft:s.spacing(2)}),dataSourceOrigin:(0,f.css)({marginRight:"1em",color:s.colors.text.disabled}),actionsSeparator:(0,f.css)({margin:`0 ${s.spacing(2)}`}),actionIcons:(0,f.css)({width:"80px",alignItems:"center",flexShrink:0}),rulesTable:(0,f.css)({margin:s.spacing(2,0)}),rotate90:(0,f.css)({transform:"rotate(90deg)"})});function Dn(s){return(0,a.useMemo)(()=>s.flatMap(t=>t.groups.map(r=>({namespace:t,group:r}))),[s])}const Ln=({namespaces:s,expandAll:t})=>{const r=(0,se.of)(An),u=(0,ge.$)(T=>T.promRules),c=(0,a.useMemo)(L.qi,[]),m=Dn(s),h=(0,a.useMemo)(()=>c.filter(T=>(0,me.ML)(u[T.name])),[u,c]),R=c.some(T=>!!u[T.name]?.result?.length),i=c.length>0,I=h.length>0,V=s.length>0,{numberOfPages:q,onPageChange:b,page:B,pageItems:w}=(0,Ae.W)(m,1,Le.FG);return(0,e.jsxs)("section",{className:r.wrapper,children:[(0,e.jsx)("div",{className:r.sectionHeader,children:(0,e.jsxs)("div",{className:r.headerRow,children:[(0,e.jsx)(le.E,{element:"h2",variant:"h5",children:(0,e.jsx)(d.x6,{i18nKey:"alerting.list-view.section.dataSourceManaged.title",children:"Data source-managed"})}),h.length?(0,e.jsx)(te._,{className:r.loader,text:`Loading rules from ${h.length} ${Ne()("source",h.length)}`}):(0,e.jsx)("div",{}),(0,e.jsx)(Bn,{})]})}),w.map(({group:T,namespace:J})=>(0,e.jsx)(k,{group:T,namespace:J,expandAll:t,viewMode:"grouped"},`${(0,L.v0)(J.rulesSource)}-${J.name}-${T.name}`)),!i&&(0,e.jsx)("p",{children:"There are no Prometheus or Loki data sources configured."}),i&&!I&&!V&&(0,e.jsx)("p",{children:"No rules found."}),!R&&I&&(0,e.jsx)(ye.y,{size:"xl",className:r.spinner}),(0,e.jsx)(Fe.d,{className:r.pagination,currentPage:B,numberOfPages:q,onNavigate:b,hideWhenSinglePage:!0})]})},An=s=>({loader:(0,f.css)({marginBottom:0}),sectionHeader:(0,f.css)({display:"flex",justifyContent:"space-between"}),wrapper:(0,f.css)({marginBottom:s.spacing(4)}),spinner:(0,f.css)({textAlign:"center",padding:s.spacing(2)}),pagination:(0,fe.H)(s),headerRow:(0,f.css)({display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%",marginBottom:s.spacing(1)})});function Bn(){const[s,t]=(0,A.Ej)(A.RY.CreateExternalAlertRule),r=(0,M.zy)();return s&&t?(0,e.jsx)(o.z9,{href:v.kM.renderUrl("alerting/new/recording",{returnTo:r.pathname+r.search}),tooltip:"Create new Data source-managed recording rule",icon:"plus",variant:"secondary",children:"New recording rule"},"new-recording-rule"):null}var Tn=n(42941),Cn=n(91064),yn=n(35874);function Nn({onClose:s}){const[t,r]=(0,a.useState)("yaml");return(0,e.jsx)(be.m,{activeTab:t,onTabChange:r,onClose:s,formatProviders:Object.values(Je.sl),children:(0,e.jsx)(Fn,{exportFormat:t,onClose:s})})}function Fn({exportFormat:s,onClose:t}){const{currentData:r="",isFetching:u}=Me.hK.endpoints.exportRules.useQuery({format:s}),c=`alert-rules-${new Date().getTime()}`;return u?(0,e.jsx)(te._,{text:"Loading...."}):(0,e.jsx)(Ke.J,{format:s,textDefinition:r,downloadFileName:c,onClose:t})}const Un=({namespaces:s,expandAll:t})=>{const r=(0,se.of)(Wn),[u]=(0,l.s)(),{prom:c,ruler:m}=(0,ge.$)(re=>({prom:re.promRules[L.hY]||me.jA,ruler:re.rulerRules[L.hY]||me.jA})),h=c.loading||m.loading,R=!!c.result||!!m.result,i=u.view==="list",I=i?(0,Cn.Jr)(s):s,V=Dn(I),{numberOfPages:q,onPageChange:b,page:B,pageItems:w}=(0,Ae.W)(V,1,Le.FG),[T,J]=(0,A.Ej)(A.RY.ExportGrafanaManagedRules),de=T&&J,[N,_]=(0,Tn.A)(!1),Re=s.length>0,Pe=y.$.featureToggles.grafanaManagedRecordingRules;return(0,e.jsxs)("section",{className:r.wrapper,children:[(0,e.jsx)("div",{className:r.sectionHeader,children:(0,e.jsxs)("div",{className:r.headerRow,children:[(0,e.jsx)(le.E,{element:"h2",variant:"h5",children:(0,e.jsx)(d.x6,{i18nKey:"alerting.list-view.section.grafanaManaged.title",children:"Grafana-managed"})}),h?(0,e.jsx)(te._,{className:r.loader,text:(0,d.t)("alerting.list-view.section.grafanaManaged.loading","Loading...")}):(0,e.jsx)("div",{}),(0,e.jsxs)(D.B,{direction:"row",alignItems:"center",justifyContent:"flex-end",children:[Re&&de&&(0,e.jsx)(o.$n,{"aria-label":"export all grafana rules","data-testid":"export-all-grafana-rules",icon:"download-alt",tooltip:"Export all Grafana-managed rules",onClick:_,variant:"secondary",children:(0,e.jsx)(d.x6,{i18nKey:"alerting.list-view.section.grafanaManaged.export-rules",children:"Export rules"})}),Pe&&(0,e.jsx)(o.z9,{href:(0,yn.G)("/alerting/new/grafana-recording",{returnTo:"/alerting/list"+location.search}),icon:"plus",variant:"secondary",tooltip:"Create new Grafana-managed recording rule",onClick:()=>(0,j.fH)(j.le.grafanaRecording),children:(0,e.jsx)(d.x6,{i18nKey:"alerting.list-view.section.grafanaManaged.new-recording-rule",children:"New recording rule"})})]})]})}),w.map(({group:re,namespace:Ze})=>(0,e.jsx)(k,{group:re,namespace:Ze,expandAll:t,viewMode:i?"list":"grouped"},`${Ze.name}-${re.name}`)),R&&I?.length===0&&(0,e.jsx)("p",{children:"No rules found."}),!R&&h&&(0,e.jsx)(ye.y,{size:"xl",className:r.spinner}),(0,e.jsx)(Fe.d,{className:r.pagination,currentPage:B,numberOfPages:q,onNavigate:b,hideWhenSinglePage:!0}),de&&N&&(0,e.jsx)(Nn,{onClose:_})]})},Wn=s=>({loader:(0,f.css)({marginBottom:0}),sectionHeader:(0,f.css)({display:"flex",justifyContent:"space-between",marginBottom:s.spacing(1)}),wrapper:(0,f.css)({marginBottom:s.spacing(4)}),spinner:(0,f.css)({textAlign:"center",padding:s.spacing(2)}),pagination:(0,fe.H)(s),headerRow:(0,f.css)({display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%",flexDirection:"row"})}),Kn=({namespaces:s,expandAll:t})=>{const[r,u]=(0,a.useMemo)(()=>{const c=s.map(m=>({...m,groups:m.groups.sort((h,R)=>h.name.localeCompare(R.name))})).sort((m,h)=>m.name.localeCompare(h.name));return[c.filter(m=>(0,L.z2)(m.rulesSource)),c.filter(m=>(0,L.Eb)(m.rulesSource))]},[s]);return(0,a.useEffect)(()=>{(0,j.fH)(j.le.loadedList)},[]),(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(U._,{actions:[A.RY.ViewAlertRule],children:(0,e.jsx)(Un,{namespaces:r,expandAll:t})}),(0,e.jsx)(U._,{actions:[A.RY.ViewExternalAlertRule],children:(0,e.jsx)(Ln,{namespaces:u,expandAll:t})})]})};var Gn=n(49185),$n=n(37008),zn=n(13676),Xe=n(51876),Vn=n(94925),wn=n(46258),Hn=n(78032),Yn=n(12626);const bn=({namespaces:s})=>{const[t,{width:r}]=(0,Gn.A)(),u=Xn(),m=(0,a.useMemo)(()=>{const h=new Map([[Xe.cF.Firing,[]],[Xe.cF.Pending,[]],[Xe.cF.Inactive,[]]]);return s.forEach(R=>R.groups.forEach(i=>i.rules.forEach(I=>{I.promRule&&(0,X.Z8)(I.promRule)&&I.promRule.state&&h.get(I.promRule.state)?.push(I)}))),h.forEach(R=>R.sort((i,I)=>i.name.localeCompare(I.name))),h},[s]).entries();return(0,e.jsxs)("ul",{role:"tree",ref:t,children:[u&&(0,e.jsx)($n.G,{width:r}),(0,e.jsx)(D.B,{direction:"column",children:Array.from(m).map(([h,R])=>(0,e.jsx)(Qn,{state:h,rules:R},h))})]})},Jn={[Xe.cF.Firing]:"Firing",[Xe.cF.Pending]:"Pending",[Xe.cF.Inactive]:"Normal"},Qn=({state:s,rules:t})=>{const{page:r,pageItems:u,numberOfPages:c,onPageChange:m}=(0,Ae.W)(t,1,Le.FG),h=s!==Xe.cF.Firing,R=t.length>0;return(0,e.jsx)(wn.i,{title:(0,e.jsxs)(D.B,{alignItems:"center",gap:0,children:[Jn[s]??"Unknown",(0,e.jsx)(zn.p,{value:t.length})]}),collapsed:h||R,pagination:(0,e.jsx)(Fe.d,{currentPage:r,numberOfPages:c,onNavigate:m,hideWhenSinglePage:!0}),children:u.map(i=>{const{rulerRule:I,promRule:V}=i,q=I?(0,X.Nv)(I):!1,b=(0,X.Z8)(i.promRule)?(0,Hn.rf)(i.instanceTotals):void 0;if(!V)return null;const B=(0,X.uo)(i.promRule);return(0,e.jsx)(Vn.WG,{name:i.name,href:(0,Oe.w$)(i.namespace.rulesSource,i),summary:i.annotations.summary,state:s,health:i.promRule?.health,error:i.promRule?.lastError,labels:i.promRule?.labels,isProvisioned:q,instancesCount:b,namespace:i.namespace.name,group:i.group.name,actions:(0,e.jsx)(Yn.l,{compact:!0,rule:i,rulesSource:i.namespace.rulesSource}),origin:B},(0,tn.jY)(V))})})};function Xn(){const s=(0,ge.$)(m=>m.promRules),t=(0,a.useMemo)(L.qi,[]),r=(0,ge.$)(m=>{const h=(0,me.ML)(m.promRules[L.hY]),R=(0,me.ML)(m.rulerRules[L.hY]);return h||R}),u=t.some(m=>(0,me.ML)(s[m.name]));return r||u}var Zn=n(3674),Mn=n(19127),kn=n(83466);const In={groups:Kn,state:bn},qn=Q.Ys+1,Sn=(0,Zn.w)(),_n=()=>{const s=(0,g.useDispatch)(),t=(0,a.useMemo)(L.gR,[]),[r,u]=(0,a.useState)(!1),c=(0,a.useCallback)(()=>u(!1),[]),[m]=(0,l.s)(),{filterState:h,hasActiveFilters:R}=(0,Mn.dI)(),i=h.labels.length>0,I=m.view,V=I==="state"||I==="groups"?I:"groups",q=In[V]?V:"groups",b=In[q],B=(0,ge.$)(ue=>ue.promRules),w=(0,ge.$)(ue=>ue.rulerRules),T=t.some(ue=>B[ue]?.loading||w[ue]?.loading),J=Object.entries(B),de=Object.entries(w),N=J.every(([ue,ne])=>ne.dispatched&&(ne?.result!==void 0||ne?.error!==void 0)),_=de.every(([ue,ne])=>ne.dispatched&&(ne?.result!==void 0||ne?.error!==void 0)),Re=J.every(([ue,ne])=>ne.dispatched&&ne?.result?.length===0),Pe=de.every(([ue,ne])=>Object.entries(ne?.result??{}).every(([he,vn])=>vn?.length===0)&&ne.dispatched),re=i?void 0:qn,[Ze,an]=(0,E.A)(async()=>{T||(Sn?(await s((0,ve.eB)({rulesSourceName:L.hY})),await s((0,ve.nV)(!1,{limitAlerts:re}))):await s((0,ve.yo)(!1,{limitAlerts:re})))},[T,re,s]);(0,a.useEffect)(()=>{(0,j.Sq)().catch(()=>{})},[]),(0,a.useEffect)(()=>{Sn?(s((0,ve.eB)({rulesSourceName:L.hY})),s((0,ve.nV)(!1,{limitAlerts:re}))):s((0,ve.yo)(!1,{limitAlerts:re}))},[s,re]),(0,x.A)(an,kn.HH);const De=N&&Re&&J.length>0&&Pe&&_,mn=!De,pn=(0,Cn.dy)(),xn=(0,Mn.i7)(pn,h);return(0,e.jsx)(oe.d,{navId:"alert-list",isLoading:!1,actions:mn&&(0,e.jsxs)(D.B,{gap:1,children:[(0,e.jsx)(es,{})," ",(0,e.jsx)(ns,{})]}),children:(0,e.jsxs)(D.B,{direction:"column",children:[(0,e.jsx)(_e,{}),(0,e.jsx)(G.A,{onClear:c}),mn&&(0,e.jsx)(D.B,{direction:"row",alignItems:"center",children:q==="groups"&&R&&(0,e.jsx)(o.$n,{icon:r?"angle-double-up":"angle-double-down",variant:"secondary",onClick:()=>u(!r),children:r?"Collapse all":"Expand all"})}),(0,e.jsx)(He.M_,{namespaces:xn}),De&&(0,e.jsx)(Ce,{}),mn&&(0,e.jsx)(b,{expandAll:r,namespaces:xn})]})})};function es(){const[s,t]=(0,A.Ej)(A.RY.CreateAlertRule),[r,u]=(0,A.Ej)(A.RY.CreateExternalAlertRule),c=(0,M.zy)();return s&&t||r&&u?(0,e.jsx)(o.z9,{href:v.kM.renderUrl("alerting/new/alerting",{returnTo:c.pathname+c.search}),icon:"plus",onClick:()=>(0,P.fH)(j.le.alertRuleFromScratch),children:(0,e.jsx)(d.x6,{i18nKey:"alerting.rule-list.new-alert-rule",children:"New alert rule"})}):null}function ns(){const s=location.pathname+location.search,t=(0,yn.G)("/alerting/export-new-rule",{returnTo:s});return(0,e.jsx)(o.z9,{href:t,icon:"download-alt",variant:"secondary",tooltip:"Export new grafana rule",onClick:()=>(0,P.fH)(j.le.exportNewGrafanaRule),children:(0,e.jsx)(d.x6,{i18nKey:"alerting.list-view.section.grafanaManaged.export-new-rule",children:"Export rule definition"})})}var ss=n(37104);const ts=(0,a.lazy)(()=>n.e(9392).then(n.bind(n,79392))),as=()=>{const s=y.$.featureToggles.alertingListViewV2;return(0,e.jsx)(a.Suspense,{children:s?(0,e.jsx)(ts,{}):(0,e.jsx)(_n,{})})},rs=(0,ss.S)(as)},57323:(pe,S,n)=>{n.d(S,{_:()=>E});var e=n(74848),a=n(2543),y=n.n(a),M=n(747);const E=({actions:l,children:d})=>{const g=(0,a.filter)(l,D),j=(0,a.filter)(l,o);return g.length?(0,e.jsx)(x,{actions:g,children:d}):j.length?(0,e.jsx)(v,{actions:j,children:d}):null},x=({actions:l,children:d})=>{const g=(0,M.iI)();return P(g,l)?(0,e.jsx)(e.Fragment,{children:d}):null},v=({actions:l,children:d})=>{const g=(0,M.e2)();return P(g,l)?(0,e.jsx)(e.Fragment,{children:d}):null};function P(l,d){return(0,a.chain)(l).pick(d).values().value().some(([g,j])=>j===!0)}function D(l){return Object.values(M.QI).includes(l)}function o(l){return Object.values(M.RY).includes(l)}},3538:(pe,S,n)=>{n.d(S,{G:()=>P});var e=n(74848),a=n(22803),y=n(29675),M=n(26676),E=n(48583),x=n(79784),v=n(45565);function P({contentText:o,externalLink:l,linkText:d,title:g="Need help?"}){const j=(0,y.of)(D);return(0,e.jsx)(M.G,{content:(0,e.jsx)("div",{className:j.mutedText,children:o}),title:(0,e.jsxs)(E.B,{gap:.5,direction:"row",alignItems:"center",children:[(0,e.jsx)(x.I,{name:"question-circle"}),g]}),footer:l?(0,e.jsx)("a",{href:l,target:"_blank",rel:"noreferrer",children:(0,e.jsx)(E.B,{direction:"row",gap:.5,alignItems:"center",children:(0,e.jsxs)(v.E,{color:"link",children:[d," ",(0,e.jsx)(x.I,{size:"sm",name:"external-link-alt"})]})})}):void 0,closeButton:!0,placement:"bottom-start",children:(0,e.jsx)("div",{className:j.helpInfo,children:(0,e.jsxs)(E.B,{direction:"row",alignItems:"center",gap:.5,children:[(0,e.jsx)(x.I,{name:"question-circle",size:"sm"}),(0,e.jsx)(v.E,{variant:"bodySmall",color:"primary",children:"Need help?"})]})})})}const D=o=>({mutedText:(0,a.css)({color:o.colors.text.secondary,fontSize:o.typography.size.sm}),helpInfo:(0,a.css)({cursor:"pointer",textDecoration:"underline"})})},16213:(pe,S,n)=>{n.d(S,{P:()=>D});var e=n(74848),a=n(22803),y=n(58779),M=n(29675),E=n(44617),x=n(48583),v=n(45565),P=n(29010);const D=({title:l,stepNo:d,children:g,fullWidth:j=!1,description:oe,switchMode:G})=>{const W=(0,M.of)(o),K=y.Tp.components.AlertRules;return(0,e.jsx)("div",{className:W.parent,"data-testid":K.step(d.toString()),children:(0,e.jsx)(E.n,{className:(0,a.cx)(j&&W.fullWidth),label:(0,e.jsxs)(x.B,{direction:"row",alignItems:"center",justifyContent:"space-between",children:[(0,e.jsxs)(v.E,{variant:"h3",children:[d,". ",l]}),G&&(0,e.jsx)(v.E,{variant:"bodySmall",children:(0,e.jsx)(P.K,{"data-testid":K.stepAdvancedModeSwitch(d.toString()),value:G.isAdvancedMode,onChange:H=>{G.setAdvancedMode(H.currentTarget.checked)},label:"Advanced options",showLabel:!0,transparent:!0,className:W.reverse})})]}),children:(0,e.jsxs)(x.B,{direction:"column",children:[oe&&(0,e.jsx)("div",{className:W.description,children:oe}),g]})})})},o=l=>({parent:(0,a.css)({display:"flex",flexDirection:"row",border:`solid 1px ${l.colors.border.weak}`,borderRadius:l.shape.radius.default,padding:`${l.spacing(2)} ${l.spacing(3)}`}),description:(0,a.css)({marginTop:`-${l.spacing(2)}`}),fullWidth:(0,a.css)({width:"100%"}),reverse:(0,a.css)({flexDirection:"row-reverse",gap:l.spacing(1)})})},70437:(pe,S,n)=>{n.d(S,{M:()=>M});var e=n(74848),a=n(6736),y=n(54594);const M=({tooltip:E,icon:x,to:v,target:P,onClick:D,className:o,tooltipPlacement:l="top",...d})=>{const g=typeof E=="string"?E:void 0;return(0,e.jsx)(a.m,{content:E,placement:l,children:v?(0,e.jsx)(y.z9,{variant:"secondary",fill:"text",icon:x,href:v,size:"sm",target:P,...d,"aria-label":g}):(0,e.jsx)(y.$n,{className:o,variant:"secondary",fill:"text",size:"sm",icon:x,type:"button",onClick:D,...d,"aria-label":g})})}},62592:(pe,S,n)=>{n.d(S,{A:()=>ve});var e=n(74848),a=n(22803),y=n(96540),M=n(49785),E=n(32370),x=n(29675),v=n(79784),P=n(48583),D=n(86489),o=n(40271),l=n(6736),d=n(60641),g=n(34128),j=n(54594),oe=n(93403),G=n(87638),W=n(11817),K=n(72614),H=n(61491),Ce=n(51876),Q=n(83893),f=n(19127),ke=n(13893),Ne=n(60344),qe=n(13005),se=n(88214),rn=n(82700),Ye=n(2178),ge=n(61809),L=n(3021),Oe=n(58779),X=n(98437),_e=n(65502),F=n(44826),$=n(50278);const A=p=>{const Y=(0,X.l)(),[Ie,O]=(0,y.useState)(),We=(z,ce)=>{if(ce.action==="clear"&&p.onClear){p.onClear();return}const Te=z[z.length-1];let xe,ee;ce.action==="pop-value"||ce.action==="remove-value"?(xe=ce.removedValue?.value,ee="remove"):(xe=Te.value,ee="add");const ae=Y.getInstanceSettings(xe);ae&&(p.onChange(ae,ee),O({error:void 0}))},je=()=>{const{current:z,hideTextValue:ce,noDefault:Te}=p;if(!(!z&&Te))return z?.map(xe=>{const ee=Y.getInstanceSettings(xe);if(ee)return{label:ee.name.slice(0,37),value:ee.name,imgUrl:ee.meta.info.logos.small,hideText:ce,meta:ee.meta};const ae=(0,ge.Iz)(xe);return ae===_e.dR.uid||ae===_e.dR.name?{label:ae,value:ae,hideText:ce}:{label:(ae??"no name")+" - not found",value:ae??void 0,imgUrl:"",hideText:ce}})},Be=()=>{const{alerting:z,tracing:ce,metrics:Te,mixed:xe,dashboard:ee,variables:ae,annotations:sn,pluginId:tn,type:un,filter:C,logs:gn}=p,we=Y.getList({alerting:z,tracing:ce,metrics:Te,logs:gn,dashboard:ee,mixed:xe,variables:ae,annotations:sn,pluginId:tn,filter:C,type:un}),He=we.filter(se.hP).map(k=>({value:k.name,label:`${k.name}${k.isDefault?" (default)":""}`,imgUrl:k.meta.info.logos.small,meta:k.meta})),hn=we.filter(k=>!(0,se.hP)(k)).map(k=>({value:k.name,label:`${k.name}${k.isDefault?" (default)":""}`,imgUrl:k.meta.info.logos.small,meta:k.meta}));return[{label:"Data sources with configured alert rules",options:He,expanded:!0},{label:"Other data sources",options:hn,expanded:!0}]},{autoFocus:Ee,onBlur:Ve,onClear:Ke,openMenuOnFocus:be,placeholder:Je,width:en,inputId:ln,disabled:cn=!1,isLoading:nn=!1}=p,Qe=Be(),ie=je(),dn=typeof Ke=="function";return(0,e.jsx)("div",{"data-testid":Oe.Tp.components.DataSourcePicker.container,children:(0,e.jsx)(F.KF,{isLoading:nn,disabled:cn,"data-testid":Oe.Tp.components.DataSourcePicker.inputV2,inputId:ln||"data-source-picker",className:"ds-picker select-container",isClearable:dn,backspaceRemovesValue:!0,onChange:We,options:Qe,autoFocus:Ee,onBlur:Ve,width:en,openMenuOnFocus:be,maxMenuHeight:500,placeholder:Je,noOptionsMessage:"No datasources found",value:ie??[],invalid:!!Ie?.error||!!p.invalid,getOptionLabel:z=>z.meta&&(0,L.x)(z.meta.signature)&&z!==ie?(0,e.jsxs)(P.B,{alignItems:"center",justifyContent:"space-between",children:[(0,e.jsx)("span",{children:z.label})," ",(0,e.jsx)($.B,{status:z.meta.signature})]}):z.label||""})})};var U=n(84558);const le=[{icon:"folder",label:"Grouped",value:"grouped"},{icon:"list-ul",label:"List",value:"list"}];function te(){const[p,Y]=(0,U.l)(),{hasActiveFilters:Ie}=(0,f.dI)(),O=p.get("view")==="list",We=Ie||O?"list":"grouped",je=Be=>{Be==="list"?(Y({view:Be}),(0,Q.aL)({view:Be})):Y({view:void 0,search:void 0})};return(0,e.jsx)(d.z,{options:le,value:We,onChange:je})}const ye=[{label:"Grouped",value:"grouped"},{label:"List",value:"list"},{label:"State",value:"state"}];function Fe(){const[p,Y]=(0,U.l)(),Ie=p.get("view"),O=Le(Ie),We=je=>{Y({view:je})};return(0,e.jsx)(d.z,{options:ye,value:O,onChange:We})}function Le(p){return p==="list"?"list":p==="state"?"state":"grouped"}const Ae=E.$.featureToggles.alertingListViewV2?te:Fe,fe=[{label:"Alert ",value:Ce.JS.Alerting},{label:"Recording ",value:Ce.JS.Recording}],me=[{label:"Ok",value:Ne.Jc.Ok},{label:"No Data",value:Ne.Jc.NoData},{label:"Error",value:Ne.Jc.Error}],Ue=Object.entries(Ce.cF).map(([p,Y])=>({label:(0,rn.XI)(Y),value:Y})),Ge=({onClear:p=()=>{}})=>{const Y=(0,x.of)(on),{pluginsFilterEnabled:Ie}=Me(),{filterState:O,hasActiveFilters:We,searchQuery:je,setSearchQuery:Be,updateFilters:Ee}=(0,f.dI)(),[Ve,Ke]=(0,y.useState)(Math.floor(Math.random()*100)),be=`dataSource-${Ve}`,Je=`queryString-${Ve}`,en=(0,y.useRef)(null),{handleSubmit:ln,register:cn,setValue:nn}=(0,M.mN)({defaultValues:{searchQuery:je}}),{ref:Qe,...ie}=cn("searchQuery");(0,y.useEffect)(()=>{nn("searchQuery",je)},[je,nn]);const dn=(C,gn)=>{const we=gn==="add"?[...O.dataSourceNames].concat([C.name]):O.dataSourceNames.filter(He=>He!==C.name);Ee({...O,dataSourceNames:we}),Ke(He=>He+1),(0,Q.Sn)("dataSourceNames")},z=C=>{Ee({...O,dashboardUid:C}),(0,Q.Sn)("dashboardUid")},ce=()=>{Ee({...O,dataSourceNames:[]}),Ke(C=>C+1)},Te=C=>{(0,Q.fH)(Q.le.clickingAlertStateFilters),Ee({...O,ruleState:C}),(0,Q.Sn)("ruleState")},xe=C=>{Ee({...O,ruleType:C}),(0,Q.Sn)("ruleType")},ee=C=>{Ee({...O,ruleHealth:C}),(0,Q.Sn)("ruleHealth")},ae=()=>{Be(void 0),p(),setTimeout(()=>Ke(Ve+1),100)},sn=C=>{Ee({...O,contactPoint:C}),(0,Q.Sn)("contactPoint")},tn=(G.TP.hasPermission(H.AccessControlAction.AlertingReceiversRead)&&E.$.featureToggles.alertingSimplifiedRouting)??!1,un=(0,e.jsx)(v.I,{name:"search"});return(0,e.jsxs)(P.B,{direction:"column",gap:0,children:[(0,e.jsxs)(P.B,{direction:"row",gap:1,wrap:"wrap",children:[(0,e.jsx)(D.D,{className:Y.dsPickerContainer,label:(0,e.jsx)(o.J,{htmlFor:"data-source-picker",children:(0,e.jsxs)(P.B,{gap:.5,alignItems:"center",children:[(0,e.jsx)("span",{children:"Search by data sources"}),(0,e.jsx)(l.m,{content:(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{children:"Data sources containing configured alert rules are Mimir or Loki data sources where alert rules are stored and evaluated in the data source itself."}),(0,e.jsx)("p",{children:"In these data sources, you can select Manage alerts via Alerting UI to be able to manage these alert rules in the Grafana UI as well as in the data source where they were configured."})]}),children:(0,e.jsx)(v.I,{id:"data-source-picker-inline-help",name:"info-circle",size:"sm",title:"Search by data sources help"})})]})}),children:(0,e.jsx)(A,{alerting:!0,noDefault:!0,placeholder:"All data sources",current:O.dataSourceNames,onChange:dn,onClear:ce},be)}),(0,e.jsx)(D.D,{className:Y.dashboardPickerContainer,label:(0,e.jsx)(o.J,{htmlFor:"filters-dashboard-picker",children:"Dashboard"}),children:(0,e.jsx)(oe.b,{inputId:"filters-dashboard-picker",value:O.dashboardUid,onChange:C=>z(C?.uid),isClearable:!0,cacheOptions:!0},O.dashboardUid?"dashboard-defined":"dashboard-not-defined")}),(0,e.jsxs)("div",{children:[(0,e.jsx)(o.J,{children:"State"}),(0,e.jsx)(d.z,{options:Ue,value:O.ruleState,onChange:Te})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)(o.J,{children:"Rule type"}),(0,e.jsx)(d.z,{options:fe,value:O.ruleType,onChange:xe})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)(o.J,{children:"Health"}),(0,e.jsx)(d.z,{options:me,value:O.ruleHealth,onChange:ee})]}),tn&&(0,e.jsx)(qe.b9,{accessType:"notification",alertmanagerSourceName:se.hY,children:(0,e.jsx)(P.B,{direction:"column",gap:0,children:(0,e.jsx)(D.D,{label:(0,e.jsx)(o.J,{htmlFor:"contactPointFilter",children:(0,e.jsx)(W.x6,{i18nKey:"alerting.contactPointFilter.label",children:"Contact point"})}),children:(0,e.jsx)(K.u,{selectedContactPointName:O.contactPoint,selectProps:{inputId:"contactPointFilter",width:40,onChange:C=>{sn(C?.value?.name)},isClearable:!0}})})})}),Ie&&(0,e.jsxs)("div",{children:[(0,e.jsx)(o.J,{children:"Plugin rules"}),(0,e.jsx)(d.z,{options:[{label:"Show",value:void 0},{label:"Hide",value:"hide"}],value:O.plugins,onChange:C=>Ee({...O,plugins:C})})]})]}),(0,e.jsxs)(P.B,{direction:"column",gap:0,children:[(0,e.jsxs)(P.B,{direction:"row",gap:1,children:[(0,e.jsxs)("form",{className:Y.searchInput,onSubmit:ln(C=>{Be(C.searchQuery),en.current?.blur(),(0,Q.zs)({oldQuery:je,newQuery:C.searchQuery})}),children:[(0,e.jsx)(D.D,{label:(0,e.jsx)(o.J,{htmlFor:"rulesSearchInput",children:(0,e.jsxs)(P.B,{gap:.5,alignItems:"center",children:[(0,e.jsx)("span",{children:"Search"}),(0,e.jsx)(Ye.B,{content:(0,e.jsx)($e,{}),children:(0,e.jsx)(v.I,{name:"info-circle",size:"sm",tabIndex:0,title:"Search help"})})]})}),children:(0,e.jsx)(g.p,{id:"rulesSearchInput",prefix:un,ref:C=>{Qe(C),en.current=C},...ie,placeholder:"Search","data-testid":"search-query-input"},Je)}),(0,e.jsx)("input",{type:"submit",hidden:!0})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)(o.J,{children:"View as"}),(0,e.jsx)(Ae,{})]})]}),We&&(0,e.jsx)("div",{children:(0,e.jsx)(j.$n,{fullWidth:!1,icon:"times",variant:"secondary",onClick:ae,children:"Clear filters"})})]})]})},on=p=>({dsPickerContainer:(0,a.css)({width:p.spacing(60),flexGrow:0,margin:0}),dashboardPickerContainer:(0,a.css)({minWidth:p.spacing(50)}),searchInput:(0,a.css)({flex:1,margin:0})});function $e(){const p=(0,x.of)(ze);return(0,e.jsxs)("div",{children:[(0,e.jsx)("div",{children:"Search syntax allows to query alert rules by the parameters defined below."}),(0,e.jsx)("hr",{}),(0,e.jsxs)("div",{className:p.grid,children:[(0,e.jsx)("div",{children:"Filter type"}),(0,e.jsx)("div",{children:"Expression"}),(0,e.jsx)(Z,{title:"Datasources",expr:"datasource:mimir datasource:prometheus"}),(0,e.jsx)(Z,{title:"Folder/Namespace",expr:"namespace:global"}),(0,e.jsx)(Z,{title:"Group",expr:"group:cpu-usage"}),(0,e.jsx)(Z,{title:"Rule",expr:'rule:"cpu 80%"'}),(0,e.jsx)(Z,{title:"Labels",expr:"label:team=A label:cluster=a1"}),(0,e.jsx)(Z,{title:"State",expr:"state:firing|normal|pending"}),(0,e.jsx)(Z,{title:"Type",expr:"type:alerting|recording"}),(0,e.jsx)(Z,{title:"Health",expr:"health:ok|nodata|error"}),(0,e.jsx)(Z,{title:"Dashboard UID",expr:"dashboard:eadde4c7-54e6-4964-85c0-484ab852fd04"}),(0,e.jsx)(Z,{title:"Contact point",expr:"contactPoint:slack"})]})]})}function Z({title:p,expr:Y}){const Ie=(0,x.of)(ze);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{children:p}),(0,e.jsx)("code",{className:Ie.code,children:Y})]})}const ze=p=>({grid:(0,a.css)({display:"grid",gridTemplateColumns:"max-content auto",gap:p.spacing(1),alignItems:"center"}),code:(0,a.css)({display:"block",textAlign:"center"})});function Me(){const{components:p}=(0,ke.u)();return{pluginsFilterEnabled:p.length>0}}const ve=Ge},13893:(pe,S,n)=>{n.d(S,{u:()=>y});var e=n(93253),a=n(75177);function y(){return(0,a.f)({extensionPointId:e.S.AlertingHomePage,limitPerPlugin:1})}},94925:(pe,S,n)=>{n.d(S,{Om:()=>Oe,WG:()=>rn,nh:()=>Ye});var e=n(74848),a=n(22803),y=n(55127),M=n.n(y),E=n(96540),x=n(45565),v=n(54731),P=n(48583),D=n(29675),o=n(37e3),l=n(79784),d=n(6736),g=n(11817),j=n(51876),oe=n(83893),G=n(76778),W=n(27219),K=n(20206),H=n(88214),Ce=n(98775),Q=n(70584),f=n(85651),ke=n(91527),Ne=n(69957),qe=n(96543),se=n(87446);const rn=F=>{const{name:$,summary:A,state:U,health:le,error:te,href:ye,isProvisioned:Fe,lastEvaluation:Le,evaluationInterval:Ae,isPaused:fe=!1,instancesCount:me=0,namespace:Ue,group:Ge,rulesSource:on,application:$e,contactPoint:Z,labels:ze,origin:Me,actions:ve=null}=F,p=[];return Ue&&Ge&&p.push((0,e.jsx)(x.E,{color:"secondary",variant:"bodySmall",children:(0,e.jsx)(X,{namespace:Ue,group:Ge,rulesSource:on,application:$e})})),fe||(Le&&Ae&&p.push((0,e.jsx)(L,{lastEvaluation:Le,evaluationInterval:Ae,state:U})),me&&p.push((0,e.jsx)(G.P,{icon:"layers-alt",children:(0,e.jsx)(v.Y,{href:ye+"?tab=instances",variant:"bodySmall",color:"primary",inline:!1,children:M()("instance",me,!0)})}))),(0,Q.rm)(ze)>0&&p.push((0,e.jsx)(G.P,{icon:"tag-alt",children:(0,e.jsx)(v.Y,{href:ye,variant:"bodySmall",color:"primary",inline:!1,children:M()("label",(0,Q.rm)(ze),!0)})})),!fe&&Z&&p.push((0,e.jsxs)(G.P,{icon:"at",children:[(0,e.jsx)(g.x6,{i18nKey:"alerting.contact-points.delivered-to",children:"Delivered to"})," ",(0,e.jsx)(v.Y,{href:(0,f.bI)(Z,H.hY),variant:"bodySmall",color:"primary",inline:!1,children:Z})]})),(0,e.jsx)(ke.c,{title:(0,e.jsxs)(P.B,{direction:"row",alignItems:"center",children:[(0,e.jsx)(v.Y,{href:ye,inline:!1,children:$}),Me&&(0,e.jsx)(K.T,{pluginId:Me.pluginId,size:"sm"}),Fe&&!Me&&(0,e.jsx)(W.rS,{})]}),description:(0,e.jsx)(ge,{content:A,error:te}),icon:(0,e.jsx)(qe.c,{state:U,health:le,isPaused:fe}),actions:ve,meta:p})};function Ye({name:F,namespace:$,group:A,rulesSource:U,application:le,href:te,health:ye,isProvisioned:Fe,error:Le,isPaused:Ae,origin:fe,actions:me}){const Ue=[];return $&&A&&Ue.push((0,e.jsx)(x.E,{color:"secondary",variant:"bodySmall",children:(0,e.jsx)(X,{namespace:$,group:A,rulesSource:U,application:le})})),(0,e.jsx)(ke.c,{title:(0,e.jsxs)(P.B,{direction:"row",alignItems:"center",children:[(0,e.jsx)(v.Y,{href:te,inline:!1,children:F}),fe&&(0,e.jsx)(K.T,{pluginId:fe.pluginId,size:"sm"}),Fe&&!fe&&(0,e.jsx)(W.rS,{})]}),description:(0,e.jsx)(ge,{error:Le}),icon:(0,e.jsx)(qe.c,{recording:!0,health:ye,isPaused:Ae}),actions:me,meta:Ue})}function ge({content:F,error:$}){return $?(0,e.jsx)(x.E,{variant:"bodySmall",color:"error",weight:"light",truncate:!0,element:"p",children:$}):F?(0,e.jsx)(x.E,{variant:"bodySmall",color:"secondary",children:F}):null}function L({lastEvaluation:F,evaluationInterval:$,state:A}){const U=(0,se.C)(F,$);return A===j.cF.Firing&&U?(0,e.jsxs)(G.P,{icon:"clock-nine",children:[(0,e.jsx)(g.x6,{i18nKey:"alerting.alert-rules.firing-for",children:"Firing for"})," ",(0,e.jsx)(x.E,{color:"primary",children:"2m 34s"}),U&&(0,e.jsxs)(e.Fragment,{children:["\xB7 ",(0,e.jsx)(g.x6,{i18nKey:"alerting.alert-rules.next-evaluation-in",children:"next evaluation in"})," ",U.humanized]})]}):U?(0,e.jsxs)(G.P,{icon:"clock-nine",children:[(0,e.jsx)(g.x6,{i18nKey:"alerting.alert-rules.next-evaluation",children:"Next evaluation"})," ",U.humanized]}):null}const Oe=({rule:F,groupIdentifier:$})=>{const A=(0,D.of)(_e);return(0,E.useEffect)(()=>{const{namespace:U,groupName:le}=$,te={name:F.name,groupName:le,namespace:JSON.stringify(U),rulesSource:(0,Ce.rO)($)};(0,oe.vV)(new Error("unknown rule type"),te)},[F,$]),(0,e.jsx)(o.F,{title:"Unknown rule type",className:A.resetMargin,children:(0,e.jsxs)("details",{children:[(0,e.jsx)("summary",{children:(0,e.jsx)(g.x6,{i18nKey:"alerting.alert-rules.rule-definition",children:"Rule definition"})}),(0,e.jsx)("pre",{children:(0,e.jsx)("code",{children:JSON.stringify(F,null,2)})})]})})},X=({namespace:F,group:$,rulesSource:A,application:U})=>{const le=U==="grafana",te=!!A&&!!U&&!le;return(0,e.jsxs)(P.B,{direction:"row",alignItems:"center",gap:.5,children:[le&&(0,e.jsx)(l.I,{size:"xs",name:"folder"}),te&&(0,e.jsx)(d.m,{content:A.name,children:(0,e.jsx)("span",{children:(0,e.jsx)(Ne.H,{application:U,size:14})})}),(0,e.jsxs)(P.B,{direction:"row",alignItems:"center",gap:0,children:[F,(0,e.jsx)(l.I,{size:"sm",name:"angle-right"}),$]})]})},_e=F=>({alertListItemContainer:(0,a.css)({position:"relative",listStyle:"none",background:F.colors.background.primary,borderBottom:`solid 1px ${F.colors.border.weak}`,padding:F.spacing(1,1,1,1.5)}),resetMargin:(0,a.css)({margin:0})})},91527:(pe,S,n)=>{n.d(S,{c:()=>v});var e=n(74848),a=n(22803),y=n(96540),M=n(29675),E=n(48583),x=n(45565);const v=l=>{const d=(0,M.of)(o),{icon:g=null,title:j,description:oe,meta:G,metaRight:W,actions:K,"data-testid":H}=l;return(0,e.jsx)("li",{className:d.alertListItemContainer,role:"treeitem","aria-selected":"false","data-testid":H,children:(0,e.jsxs)(E.B,{direction:"row",alignItems:"start",gap:1,wrap:!1,children:[g,(0,e.jsxs)(E.B,{direction:"column",gap:0,flex:"1",minWidth:0,children:[(0,e.jsxs)(E.B,{direction:"column",gap:0,children:[(0,e.jsx)("div",{className:d.textOverflow,children:j}),(0,e.jsx)("div",{className:d.textOverflow,children:oe})]}),(0,e.jsx)(E.B,{direction:"row",gap:.5,alignItems:"center",children:G?.map((Ce,Q)=>(0,e.jsxs)(y.Fragment,{children:[Q>0&&(0,e.jsx)(D,{}),Ce]},Q))})]}),(0,e.jsxs)(E.B,{direction:"row",alignItems:"center",gap:1,wrap:!1,children:[W,K]})]})})},P=()=>jsx(v,{icon:jsx(Skeleton,{width:16,height:16,circle:!0}),title:jsx(Skeleton,{height:16,width:350}),actions:jsx(Skeleton,{height:10,width:200})}),D=()=>(0,e.jsx)(x.E,{color:"secondary",variant:"bodySmall",children:"\xB7"}),o=l=>({alertListItemContainer:(0,a.css)({position:"relative",listStyle:"none",background:l.colors.background.primary,borderBottom:`solid 1px ${l.colors.border.weak}`,padding:`${l.spacing(1)} ${l.spacing(1)}`}),textOverflow:(0,a.css)({overflow:"hidden",textOverflow:"ellipsis",color:"inherit"})})},46258:(pe,S,n)=>{n.d(S,{i:()=>l});var e=n(74848),a=n(22803),y=n(2543),M=n.n(y),E=n(42941),x=n(29675),v=n(48583),P=n(99764),D=n(11817),o=n(7484);const l=({children:g,title:j,collapsed:oe=!1,actions:G=null,pagination:W=null})=>{const K=(0,x.of)(d),[H,Ce]=(0,E.A)(oe);return(0,e.jsxs)("li",{className:K.wrapper,role:"treeitem","aria-selected":"false",children:[(0,e.jsx)("div",{className:K.sectionTitle,children:(0,e.jsxs)(v.B,{alignItems:"center",children:[(0,e.jsxs)(v.B,{alignItems:"center",gap:0,children:[(0,e.jsx)(P.K,{name:H?"angle-right":"angle-down",onClick:Ce,"aria-label":(0,D.t)("common.collapse","Collapse")}),j]}),G&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(o.h,{}),G]})]})}),!(0,y.isEmpty)(g)&&!H&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("ul",{role:"group",className:K.groupItemsWrapper,children:g}),W]})]})},d=g=>({groupItemsWrapper:(0,a.css)({position:"relative",borderRadius:g.shape.radius.default,border:`solid 1px ${g.colors.border.weak}`,borderBottom:"none",marginLeft:g.spacing(1.5)}),wrapper:(0,a.css)({display:"flex",flexDirection:"column",gap:g.spacing(1)}),sectionTitle:(0,a.css)({padding:`${g.spacing(.5)} ${g.spacing(1)}`,background:g.colors.background.secondary,border:`solid 1px ${g.colors.border.weak}`,borderRadius:g.shape.radius.default})})},69957:(pe,S,n)=>{n.d(S,{H:()=>v});var e=n(74848),a=n(22803),y=n(79784),M=n(51876),E=n(72974);const x=({children:o,name:l,href:d,application:g})=>{const j=useStyles2(P);return jsxs("li",{className:j.namespaceWrapper,role:"treeitem","aria-selected":"false",children:[jsx("div",{className:j.namespaceTitle,children:jsxs(Stack,{alignItems:"center",gap:1,children:[jsx(v,{application:g}),d?jsx(WithReturnButton,{title:"Alert rules",component:jsx(TextLink,{href:d,inline:!1,children:l})}):l]})}),o&&jsx("ul",{role:"group",className:j.groupItemsWrapper,children:o})]})},v=({application:o,size:l=16})=>{switch(o){case M.N1.Prometheus:return(0,e.jsx)("img",{width:l,height:l,src:"public/app/plugins/datasource/prometheus/img/prometheus_logo.svg",alt:"Prometheus"});case M.N1.Mimir:return(0,e.jsx)("img",{width:l,height:l,src:"public/app/plugins/datasource/prometheus/img/mimir_logo.svg",alt:"Mimir"});case"Loki":return(0,e.jsx)("img",{width:l,height:l,src:"public/app/plugins/datasource/loki/img/loki_icon.svg",alt:"Loki"});case"grafana":default:return(0,e.jsx)(y.I,{name:"grafana"})}},P=o=>({groupItemsWrapper:css({position:"relative",borderRadius:o.shape.radius.default,border:`solid 1px ${o.colors.border.weak}`,borderBottom:"none",marginLeft:o.spacing(3),"&:before":{content:"''",position:"absolute",height:"100%",borderLeft:`solid 1px ${o.colors.border.weak}`,marginTop:0,marginLeft:`-${o.spacing(2.5)}`}}),namespaceWrapper:css({display:"flex",flexDirection:"column",gap:o.spacing(1)}),namespaceTitle:css({padding:`${o.spacing(1)} ${o.spacing(1.5)}`})});var D=null},96543:(pe,S,n)=>{n.d(S,{c:()=>l});var e=n(74848),a=n(96540),y=n(6736),M=n(45565),E=n(79784),x=n(51876),v=n(78032);const P={[x.cF.Inactive]:"check-circle",[x.cF.Pending]:"circle",[x.cF.Firing]:"exclamation-circle"},D={[x.cF.Inactive]:"success",[x.cF.Pending]:"warning",[x.cF.Firing]:"error"},o={[x.cF.Inactive]:"Normal",[x.cF.Pending]:"Pending",[x.cF.Firing]:"Firing"},l=(0,a.memo)(function({state:g,health:j,recording:oe=!1,isPaused:G=!1}){let W=g?P[g]:"circle",K=g?D[g]:"secondary",H=g?o[g]:"unknown";return oe&&(W="record-audio",K="success",H="Recording"),j==="nodata"&&(W="exclamation-triangle",K="warning",H="Insufficient data"),(0,v.lf)(j)&&(W="times-circle",K="error",H="Failed to evaluate rule"),G&&(W="pause-circle",K="warning",H="Paused"),(0,e.jsx)(y.m,{content:H,placement:"right",children:(0,e.jsx)("div",{children:(0,e.jsx)(M.E,{color:K,children:(0,e.jsx)(E.I,{name:W,size:"lg"})})})})})},10940:(pe,S,n)=>{n.d(S,{A:()=>y});var e=n(96540),a=function(M,E){var x=(0,e.useRef)(function(){});(0,e.useEffect)(function(){x.current=M}),(0,e.useEffect)(function(){if(E!==null){var v=setInterval(function(){return x.current()},E||0);return function(){return clearInterval(v)}}},[E])};const y=a}}]);

//# sourceMappingURL=AlertRuleListIndex.71fa25b09df115e9ff91.js.map