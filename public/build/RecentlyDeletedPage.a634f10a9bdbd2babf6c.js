"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[6299],{78763:(J,R,e)=>{e.r(R),e.d(R,{default:()=>ae});var s=e(74848),E=e(22803),i=e(96540),g=e(70713),M=e(29675),y=e(22560),a=e(54122),o=e(11817),m=e(69889),I=e(92914),c=e(61491),d=e(93719),L=e(40286);class _ extends L.lC{setStateAndDoSearch(h){const p=h.sort||this.state.sort||localStorage.getItem(d.w7)||void 0,l=h.query??this.state.query,K=h.tag??this.state.tag,T=l.length===0&&K.length===0;this.setState({sort:p,result:T?void 0:this.state.result,...h}),this.updateLocation({query:this.state.query.length===0?null:this.state.query,tag:this.state.tag,datasource:this.state.datasource,panel_type:this.state.panel_type,starred:this.state.starred?this.state.starred:null,sort:this.state.sort}),this.hasSearchFilters()&&this.doSearchWithDebounce()}}let C;function O(){return C||(C=new _({...L.ue,includePanels:!1,deleted:!0})),C}function n(){const u=O();return[u.useState(),u]}var S=e(56276),t=e(48583),r=e(54594),f=e(22492),A=e(91830),P=e(15664),x=e(86843),N=e(65164),W=e(45565);const b=({onConfirm:u,onDismiss:h,selectedDashboards:p,isLoading:l,...K})=>{const T=p.length,j=async()=>{(0,S.rR)("grafana_delete_permanently_confirm_clicked",{item_counts:{dashboard:T}}),await u(),h()};return(0,s.jsx)(N.u,{body:(0,s.jsx)(W.E,{element:"p",children:(0,s.jsxs)(o.x6,{i18nKey:"recently-deleted.permanently-delete-modal.text",count:T,children:["This action will delete ",{numberOfDashboards:T}," dashboards."]})}),title:(0,o.t)("recently-deleted.permanently-delete-modal.title","Permanently Delete Dashboards"),confirmationText:(0,o.t)("recently-deleted.permanently-delete-modal.confirm-text","Delete"),confirmText:l?(0,o.t)("recently-deleted.permanently-delete-modal.delete-loading","Deleting..."):(0,o.t)("recently-deleted.permanently-delete-modal.delete-button","Delete"),confirmButtonVariant:"destructive",onConfirm:j,onDismiss:h,...K})};var V=e(9968),$=e(62851);const z=({onConfirm:u,onDismiss:h,selectedDashboards:p,dashboardOrigin:l,isLoading:K,...T})=>{const[j,H]=(0,i.useState)(()=>l.length>0&&l.every(G=>G===l[0])?l[0]:void 0),D=p.length,Q=async()=>{(0,S.rR)("grafana_restore_confirm_clicked",{item_counts:{dashboard:D}}),j!==void 0&&(await u(j),h())};return(0,s.jsx)(N.u,{body:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(W.E,{element:"p",children:(0,s.jsxs)(o.x6,{i18nKey:"recently-deleted.restore-modal.text",count:D,children:["This action will restore ",{numberOfDashboards:D}," dashboards."]})}),(0,s.jsx)(V.$,{v:3}),(0,s.jsx)(W.E,{element:"p",children:(0,s.jsx)(o.x6,{i18nKey:"recently-deleted.restore-modal.folder-picker-text",count:D,children:"Please choose a folder where your dashboards will be restored."})}),(0,s.jsx)(V.$,{v:1}),(0,s.jsx)($.d,{onChange:H,value:j})]}),confirmText:K?(0,o.t)("recently-deleted.restore-modal.restore-loading","Restoring..."):(0,o.t)("recently-deleted.restore-modal.restore-button","Restore"),confirmButtonVariant:"primary",onDismiss:h,onConfirm:Q,title:(0,o.t)("recently-deleted.restore-modal.title","Restore Dashboards"),disabled:j===void 0,...T})};function v(){const u=(0,c.useDispatch)(),h=(0,x.xK)(),[p,l]=n(),[K,{isLoading:T}]=(0,P.vR)(),[j,{isLoading:H}]=(0,P.D$)(),D=(0,i.useMemo)(()=>Object.entries(h.dashboard).filter(([B,F])=>F).map(([B])=>B),[h.dashboard]),Q=[];if(p.result)for(const B of D){const F=p.result.view.fields.uid.values.findIndex(Z=>Z===B),X=p.result.view.fields.location.values[F],w=X===d.TF?"":X;Q.push(w)}const G=()=>{u((0,x.cT)({isSelected:!1,folderUID:void 0})),l.doSearchWithDebounce()},ne=async B=>{const F=l.state.result?.view.toArray();if(!F)return;const X=D.map(Z=>K({dashboardUID:Z,targetFolderUID:B}));await Promise.all(X);const w=new Set;for(const Z of D){const k=F.find(de=>de.uid===Z);if(!k)continue;const ie=k.location===d.TF?void 0:k.location;w.add(ie)}u((0,x.xN)(Array.from(w))),G()},oe=async()=>{const B=D.map(F=>j({dashboardUID:F}));await Promise.all(B),G()},re=()=>{(0,S.rR)("grafana_restore_clicked",{item_counts:{dashboard:D.length}}),f.A.publish(new A.S8({component:z,props:{selectedDashboards:D,dashboardOrigin:Q,onConfirm:ne,isLoading:T}}))},le=()=>{(0,S.rR)("grafana_delete_permanently_clicked",{item_counts:{dashboard:D.length}}),f.A.publish(new A.S8({component:b,props:{selectedDashboards:D,onConfirm:oe,isLoading:H}}))};return(0,s.jsxs)(t.B,{gap:1,children:[(0,s.jsx)(r.$n,{onClick:re,variant:"secondary",children:(0,s.jsx)(o.x6,{i18nKey:"recently-deleted.buttons.restore",children:"Restore"})}),(0,s.jsx)(r.$n,{onClick:le,variant:"destructive",children:(0,s.jsx)(o.x6,{i18nKey:"recently-deleted.buttons.delete",children:"Delete permanently"})})]})}var U=e(59830);const Y=({searchState:u})=>{const h=!!(u.query||u.tag.length);return(0,s.jsx)(U.p,{message:h?(0,o.t)("recently-deleted.page.no-search-result","No results found for your query"):(0,o.t)("recently-deleted.page.no-deleted-dashboards","You haven't deleted any dashboards recently."),variant:h?"not-found":"completed",role:"alert",children:(0,s.jsx)(o.x6,{i18nKey:"recently-deleted.page.no-deleted-dashboards-text",children:"When you delete a dashboard, it will appear here for 30 days before being permanently deleted. Your organization administrator can restore recently-deleted dashboards."})})};var ee=e(3822),te=e(30962);const q=(0,i.memo)(()=>{const u=(0,c.useDispatch)(),h=(0,M.of)(se),[p,l]=n(),K=(0,x.QE)(),{canEditFolders:T,canEditDashboards:j}=(0,te.N)(),H=T||j;return(0,i.useEffect)(()=>{l.initStateFromUrl(void 0),u((0,x.cT)({isSelected:!1,folderUID:void 0}))},[u,l]),(0,s.jsx)(a.Y,{navId:"dashboards/recently-deleted",children:(0,s.jsxs)(a.Y.Contents,{className:h.pageContents,children:[(0,s.jsx)("div",{children:(0,s.jsx)(y.Z,{placeholder:(0,o.t)("recentlyDeleted.filter.placeholder","Search for dashboards"),value:p.query,escapeRegex:!1,onChange:l.onQueryChange})}),K?(0,s.jsx)(v,{}):(0,s.jsx)("div",{className:h.filters,children:(0,s.jsx)(m.bj,{state:p,getTagOptions:l.getTagOptions,getSortOptions:(0,I.S)().getSortOptions,sortPlaceholder:(0,I.S)().sortPlaceholder,onLayoutChange:l.onLayoutChange,onSortChange:l.onSortChange,onTagFilterChange:l.onTagFilterChange,onDatasourceChange:l.onDatasourceChange,onPanelTypeChange:l.onPanelTypeChange,onSetIncludePanels:l.onSetIncludePanels})}),(0,s.jsx)("div",{className:h.subView,children:(0,s.jsx)(g.default,{children:({width:D,height:Q})=>(0,s.jsx)(ee.Q,{canSelect:H,width:D,height:Q,searchStateManager:l,searchState:p,emptyState:(0,s.jsx)(Y,{searchState:p})})})})]})})}),se=u=>({pageContents:(0,E.css)({display:"flex",flexDirection:"column",gap:u.spacing(1),height:"100%"}),subView:(0,E.css)({height:"100%"}),filters:(0,E.css)({display:"none",[u.breakpoints.up("md")]:{display:"block"}})});q.displayName="RecentlyDeletedPage";const ae=q},3822:(J,R,e)=>{e.d(R,{Q:()=>_});var s=e(74848),E=e(96540),i=e(94626),g=e(4038),M=e(59830),y=e(54594),a=e(11817),o=e(51253),m=e(98022),I=e(61491),c=e(86843);const d=25,L={view:new i.R((0,g.Vc)({fields:[{name:"uid",display:!0,values:Array(d).fill(null)},{name:"kind",display:!0,values:Array(d).fill("dashboard")},{name:"name",display:!0,values:Array(d).fill("")},{name:"location",display:!0,values:Array(d).fill("")},{name:"tags",display:!0,values:Array(d).fill([])}],meta:{custom:{locationInfo:[]}}})),loadMoreItems:()=>Promise.resolve(),isItemLoaded:()=>!1,totalRows:d};function _({width:O,height:n,canSelect:S,searchState:t,searchStateManager:r,emptyState:f}){const A=(0,I.useDispatch)(),P=(0,I.useSelector)(v=>v.browseDashboards.selectedItems),x=(0,c.QE)(),{keyboardEvents:N}=(0,o.d)(),W=t.result??L,b=(0,E.useCallback)((v,U)=>v?v==="*"&&U==="*"?x:v==="*"?!1:P[C(v)][U]??!1:!1,[P,x]),V=(0,E.useCallback)(()=>{A((0,c.cT)({isSelected:!1,folderUID:void 0}))},[A]),$=(0,E.useCallback)((v,U)=>{const Y=!b(v,U);A((0,c.t$)({item:{kind:C(v),uid:U},isSelected:Y}))},[b,A]);if(W.totalRows===0){const v=f??(0,s.jsx)(M.p,{button:(0,s.jsx)(y.$n,{variant:"secondary",onClick:r.onClearSearchAndFilters,children:(0,s.jsx)(a.x6,{i18nKey:"browse-dashboards.no-results.clear",children:"Clear search and filters"})}),message:(0,a.t)("browse-dashboards.no-results.text","No results found for your query"),variant:"not-found",role:"alert"});return(0,s.jsx)("div",{style:{width:O},children:v})}const z={response:W,selection:S?b:void 0,selectionToggle:S?$:void 0,clearSelection:V,width:O,height:n,onTagSelected:r.onAddTag,keyboardEvents:N,onDatasourceChange:t.datasource?r.onDatasourceChange:void 0,onClickItem:r.onSearchItemClicked};return(0,s.jsx)(m.P,{...z})}function C(O){switch(O){case"folder":return"folder";case"dashboard":return"dashboard";case"panel":return"panel"}throw new Error("Unsupported kind"+O)}},30962:(J,R,e)=>{e.d(R,{N:()=>y});var s=e(32370),E=e(87638),i=e(61491);function g(a,o){return o?E.TP.hasPermissionInMetadata(a,o):E.TP.hasPermission(a)}function M(a){return a&&a.uid!=="general"&&!s.$.featureToggles.nestedFolders?!1:s.$.featureToggles.accessActionSets?g(i.AccessControlAction.FoldersCreate,a):!a||a.uid==="general"?g(i.AccessControlAction.FoldersCreate):g(i.AccessControlAction.FoldersCreate)&&g(i.AccessControlAction.FoldersWrite,a)}function y(a){const o=g(i.AccessControlAction.DashboardsCreate,a),m=M(a),I=g(i.AccessControlAction.FoldersDelete,a),c=g(i.AccessControlAction.DashboardsWrite,a),d=g(i.AccessControlAction.FoldersWrite,a),L=g(i.AccessControlAction.FoldersPermissionsWrite,a),_=g(i.AccessControlAction.FoldersPermissionsRead,a);return{canCreateDashboards:o,canCreateFolders:m,canDeleteFolders:I,canEditDashboards:c,canEditFolders:d,canSetPermissions:L,canViewPermissions:_}}},69889:(J,R,e)=>{e.d(R,{bj:()=>C});var s=e(74848),E=e(22803),i=e(32370),g=e(29675),M=e(48583),y=e(81942),a=e(54594),o=e(60641),m=e(89963),I=e(96601),c=e(11817),d=e(70663);function L(){return[{value:d.P.Folders,icon:"folder",description:(0,c.t)("search.actions.view-as-folders","View by folders")},{value:d.P.List,icon:"list-ul",description:(0,c.t)("search.actions.view-as-list","View as list")}]}function _(n){const S=n.layout??d.P.Folders;return S===d.P.Folders&&(n.query||n.sort||n.starred||n.tag.length>0)?d.P.List:S}const C=({state:n,showStarredFilter:S,showLayout:t,sortPlaceholder:r,onLayoutChange:f,onSortChange:A,onStarredFilterChange:P=()=>{},onTagFilterChange:x,getTagOptions:N,getSortOptions:W,onDatasourceChange:b,onPanelTypeChange:V,onSetIncludePanels:$})=>{const z=(0,g.of)(O),v=_(n),U=n.tag.length||n.starred||n.query||n.datasource||n.panel_type?[d.P.Folders]:[];return(0,s.jsxs)(M.B,{justifyContent:"space-between",alignItems:"center",children:[(0,s.jsxs)(M.B,{gap:2,alignItems:"center",children:[(0,s.jsx)(I.$,{isClearable:!1,tags:n.tag,tagOptions:N,onChange:x}),i.$.featureToggles.panelTitleSearch&&(0,s.jsx)(y.S,{"data-testid":"include-panels",disabled:v===d.P.Folders,value:n.includePanels,onChange:()=>$(!n.includePanels),label:(0,c.t)("search.actions.include-panels","Include panels")}),S&&(0,s.jsx)("div",{className:z.checkboxWrapper,children:(0,s.jsx)(y.S,{label:(0,c.t)("search.actions.starred","Starred"),onChange:P,value:n.starred})}),n.datasource&&(0,s.jsx)(a.$n,{icon:"times",variant:"secondary",onClick:()=>b(void 0),children:(0,s.jsxs)(c.x6,{i18nKey:"search.actions.remove-datasource-filter",children:["Datasource: ",{datasource:n.datasource}]})}),n.panel_type&&(0,s.jsxs)(a.$n,{icon:"times",variant:"secondary",onClick:()=>V(void 0),children:["Panel: ",n.panel_type]})]}),(0,s.jsxs)(M.B,{gap:2,children:[t&&(0,s.jsx)(o.z,{options:L(),disabledOptions:U,onChange:f,value:v}),(0,s.jsx)(m.r,{onChange:Y=>A(Y?.value),value:n.sort,getSortOptions:W,placeholder:r||(0,c.t)("search.actions.sort-placeholder","Sort"),isClearable:!0})]})]})};C.displayName="ActionRow";const O=n=>({checkboxWrapper:(0,E.css)({label:{lineHeight:"1.2"}})})},40286:(J,R,e)=>{e.d(R,{ET:()=>n,lC:()=>_,ue:()=>c});var s=e(2543),E=e.n(s),i=e(53027),g=e(5761),M=e(82856),y=e(93719),a=e(19614),o=e(92914),m=e(70663),I=e(10867);const c={query:"",tag:[],starred:!1,layout:m.P.Folders,sort:void 0,prevSort:void 0,eventTrackingNamespace:"dashboard_search",deleted:!1},d={sort:null,starred:null,query:null,tag:null,layout:null},L=()=>localStorage.getItem(y.YU)===m.P.List?m.P.List:m.P.Folders;class _ extends g.Q{constructor(){super(...arguments),this.updateLocation=(0,s.debounce)(t=>i.Ny.partial(t,!0),300),this.doSearchWithDebounce=(0,s.debounce)(()=>this.doSearch(),300),this.lastSearchTimestamp=0,this.onCloseSearch=()=>{this.updateLocation({search:null,folder:null,...d})},this.onClearSearchAndFilters=()=>{this.setStateAndDoSearch({query:"",datasource:void 0,tag:[],panel_type:void 0,starred:void 0,sort:void 0})},this.onQueryChange=t=>{this.setStateAndDoSearch({query:t})},this.onRemoveTag=t=>{this.setStateAndDoSearch({tag:this.state.tag.filter(r=>r!==t)})},this.onTagFilterChange=t=>{this.setStateAndDoSearch({tag:t})},this.onAddTag=t=>{this.state.tag&&this.state.tag.includes(t)||this.setStateAndDoSearch({tag:[...this.state.tag,t]})},this.onDatasourceChange=t=>{this.setStateAndDoSearch({datasource:t})},this.onPanelTypeChange=t=>{this.setStateAndDoSearch({panel_type:t})},this.onStarredFilterChange=t=>{const r=t.currentTarget.checked;this.setStateAndDoSearch({starred:r})},this.onClearStarred=()=>{this.setStateAndDoSearch({starred:!1})},this.onSetStarred=t=>{t!==this.state.starred&&this.setStateAndDoSearch({starred:t})},this.onSortChange=t=>{t?localStorage.setItem(y.w7,t):localStorage.removeItem(y.w7),this.state.layout===m.P.Folders?this.setStateAndDoSearch({sort:t,layout:m.P.List}):this.setStateAndDoSearch({sort:t})},this.onLayoutChange=t=>{localStorage.setItem(y.YU,t),this.state.sort&&t===m.P.Folders?this.setStateAndDoSearch({layout:t,prevSort:this.state.sort,sort:void 0}):this.setStateAndDoSearch({layout:t,sort:this.state.prevSort})},this.onSetIncludePanels=t=>{this.setStateAndDoSearch({includePanels:t}),M.A.set(y.d7,t)},this.getTagOptions=()=>{const t=this.lastQuery??{kind:["dashboard","folder"],query:"*"};return(0,o.S)().tags(t)},this.onSearchItemClicked=t=>{(0,a.MK)(this.state.eventTrackingNamespace,{layout:this.state.layout,starred:this.state.starred,sortValue:this.state.sort,query:this.state.query,tagCount:this.state.tag?.length,includePanels:this.state.includePanels,deleted:this.state.deleted})},this.onReportSearchUsage=()=>{(0,a.Pf)(this.state.eventTrackingNamespace,{layout:this.state.layout,starred:this.state.starred,sortValue:this.state.sort,query:this.state.query,tagCount:this.state.tag?.length,includePanels:this.state.includePanels,deleted:this.state.deleted})}}initStateFromUrl(t,r=!0){const f=(0,I.N1)(i.Ny.getSearchObject());(f.query||f.datasource||f.panel_type)&&(f.layout=m.P.List);const A=L(),P=localStorage.getItem(y.w7)??void 0,x=A===m.P.List?f.sort||P:null;this.setState({...c,...f,layout:A,sort:x??c.sort,prevSort:P,folderUid:t,eventTrackingNamespace:t?"manage_dashboards":"dashboard_search",deleted:this.state.deleted}),r&&this.hasSearchFilters()&&this.doSearch()}setStateAndDoSearch(t){const r=t.sort||this.state.sort||localStorage.getItem(y.w7)||void 0;this.setState({sort:r,...t}),this.updateLocation({query:this.state.query.length===0?null:this.state.query,tag:this.state.tag,datasource:this.state.datasource,panel_type:this.state.panel_type,starred:this.state.starred?this.state.starred:null,sort:this.state.sort}),this.hasSearchFilters()&&this.doSearchWithDebounce()}hasSearchFilters(){return!!(this.state.query||this.state.tag.length||this.state.starred||this.state.panel_type||this.state.sort||this.state.deleted||this.state.layout===m.P.List)}getSearchQuery(){const t={query:this.state.query,tags:this.state.tag,ds_uid:this.state.datasource,panel_type:this.state.panel_type,location:this.state.folderUid,sort:this.state.sort,explain:this.state.explain,withAllowedActions:this.state.explain,starred:this.state.starred,deleted:this.state.deleted};return t.sort?.length&&!t.sort.includes("name")&&(t.kind=["dashboard","folder"]),t.query?.length||(t.query="*",t.location||(t.kind=["dashboard","folder"])),!this.state.includePanels&&!t.kind&&(t.kind=["dashboard","folder"]),t.panel_type?.length&&(t.kind=["panel"]),t}doSearch(){const t={layout:this.state.layout,starred:this.state.starred,sortValue:this.state.sort,query:this.state.query,tagCount:this.state.tag?.length,includePanels:this.state.includePanels,deleted:this.state.deleted};(0,a.J$)(this.state.eventTrackingNamespace,t),this.lastQuery=this.getSearchQuery(),this.setState({loading:!0});const r=(0,o.S)(),f=Date.now();(this.state.starred?r.starred(this.lastQuery):r.search(this.lastQuery)).then(P=>{f>this.lastSearchTimestamp&&(this.setState({result:P,loading:!1}),this.lastSearchTimestamp=f)}).catch(P=>{(0,a.KZ)(this.state.eventTrackingNamespace,{...t,error:P?.message}),this.setState({loading:!1})})}}let C;function O(){if(!C){const t=localStorage.getItem(y.YU)??c.layout;let r=M.A.getBool(y.d7,!0);r&&(r=!1),C=new _({...c,layout:t,includePanels:r})}return C}function n(){const S=O();return[S.useState(),S]}}}]);

//# sourceMappingURL=RecentlyDeletedPage.a634f10a9bdbd2babf6c.js.map