"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[2004],{727:(C,p,s)=>{s.d(p,{S:()=>e});var o=s(74848),n=s(96540),E=s(49785),g=s(58779),d=s(32370),c=s(29675),m=s(37e3),h=s(86489),u=s(48583),_=s(54594),P=s(6736),r=s(11817),i=s(5325),a=s(34191),t=s(1361);const e=({onSubmit:l,onSkip:M,showDefaultPasswordWarning:D})=>{const O=(0,c.of)(i.$),[w,x]=(0,n.useState)(!1),[L,f]=(0,n.useState)(!0),{handleSubmit:y,register:v,getValues:I,formState:{errors:A},watch:T}=(0,E.mN)({defaultValues:{newPassword:"",confirmNew:""}}),U=T("newPassword"),W=B=>{l(B.newPassword)};return(0,o.jsxs)("form",{onSubmit:y(W),children:[D&&(0,o.jsx)(m.F,{severity:"info",title:"Continuing to use the default password exposes you to security risks."}),(0,o.jsx)(h.D,{label:"New password",invalid:!!A.newPassword,error:A?.newPassword?.message,children:(0,o.jsx)(a.s,{onFocus:()=>x(!0),...v("newPassword",{required:"New Password is required",onBlur:()=>f(!1),validate:{strongPasswordValidationRegister:t.DP}}),id:"new-password",autoFocus:!0,autoComplete:"new-password"})}),w&&(0,o.jsx)(t.zJ,{pristine:L,password:U,strongPasswordValidations:t.NQ}),(0,o.jsx)(h.D,{label:"Confirm new password",invalid:!!A.confirmNew,error:A?.confirmNew?.message,children:(0,o.jsx)(a.s,{...v("confirmNew",{required:"Confirmed Password is required",validate:B=>B===I().newPassword||"Passwords must match!"}),id:"confirm-new-password",autoComplete:"new-password"})}),(0,o.jsxs)(u.B,{direction:"column",children:[(0,o.jsx)(_.$n,{type:"submit",className:O.submitButton,children:(0,o.jsx)(r.x6,{i18nKey:"forgot-password.change-password.submit-button",children:"Submit"})}),!d.$.auth.basicAuthStrongPasswordPolicy&&M&&(0,o.jsx)(P.m,{content:"If you skip you will be prompted to change password next time you log in.",placement:"bottom",children:(0,o.jsx)(_.$n,{className:O.skipButton,fill:"text",onClick:M,type:"button","data-testid":g.Tp.pages.Login.skip,children:(0,o.jsx)(r.x6,{i18nKey:"forgot-password.change-password.skip-button",children:"Skip"})})})]})]})}},93712:(C,p,s)=>{s.d(p,{A:()=>_});var o=s(74848),n=s(96540),E=s(53027),g=s(28082),d=s(88023),c=s(11817);const m=()=>!!d.Ay.oauth&&Object.keys(d.Ay.oauth).length>0,h=()=>!!E.Ny.getSearch().get("code");class u extends n.PureComponent{constructor(a){super(a),this.changePassword=t=>{const e={newPassword:t,confirmNew:t,oldPassword:"admin"};if(this.props.resetCode){const l={code:this.props.resetCode,newPassword:t,confirmPassword:t};(0,g.AI)().post("/api/user/password/reset",l).then(()=>{this.toGrafana()})}else(0,g.AI)().put("/api/user/password",e).then(()=>{this.toGrafana()}).catch(l=>console.error(l))},this.login=t=>{this.setState({loginErrorMessage:void 0,isLoggingIn:!0}),(0,g.AI)().post("/login",t,{showErrorAlert:!1}).then(e=>{if(this.result=e,t.password!=="admin"||d.Ay.ldapEnabled||d.Ay.authProxyEnabled){this.toGrafana();return}else this.changeView(t.password==="admin")}).catch(e=>{const l=(0,g.NF)(e)?P(e):void 0;this.setState({isLoggingIn:!1,loginErrorMessage:l||(0,c.t)("login.error.unknown","Unknown error occurred")})})},this.passwordlessStart=t=>{this.setState({loginErrorMessage:void 0,isLoggingIn:!0}),(0,g.AI)().post("/api/login/passwordless/start",t,{showErrorAlert:!1}).then(e=>{window.location.assign(e.URL)}).catch(e=>{const l=(0,g.NF)(e)?P(e):void 0;this.setState({isLoggingIn:!1,loginErrorMessage:l||(0,c.t)("login.error.unknown","Unknown error occurred")})})},this.passwordlessConfirm=t=>{this.setState({loginErrorMessage:void 0,isLoggingIn:!0}),(0,g.AI)().post("/api/login/passwordless/authenticate",t,{showErrorAlert:!1}).then(e=>{this.result=e,this.toGrafana()}).catch(e=>{const l=(0,g.NF)(e)?P(e):void 0;this.setState({isLoggingIn:!1,loginErrorMessage:l||(0,c.t)("login.error.unknown","Unknown error occurred")})})},this.changeView=t=>{this.setState({isChangingPassword:!0,showDefaultPasswordWarning:t})},this.toGrafana=()=>{if(d.Ay.featureToggles.useSessionStorageForRedirection){window.location.assign(d.Ay.appSubUrl+"/");return}this.result?.redirectUrl?d.Ay.appSubUrl!==""&&!this.result.redirectUrl.startsWith(d.Ay.appSubUrl)?window.location.assign(d.Ay.appSubUrl+this.result.redirectUrl):window.location.assign(this.result.redirectUrl):window.location.assign(d.Ay.appSubUrl+"/")},this.state={isLoggingIn:!1,isChangingPassword:!1,showDefaultPasswordWarning:!1,loginErrorMessage:r(d.Ay.loginError)}}render(){const{children:a}=this.props,{isLoggingIn:t,isChangingPassword:e,showDefaultPasswordWarning:l,loginErrorMessage:M}=this.state,{login:D,toGrafana:O,changePassword:w,passwordlessStart:x,passwordlessConfirm:L}=this,{loginHint:f,passwordHint:y,disableLoginForm:v,disableUserSignUp:I}=d.Ay;return(0,o.jsx)(o.Fragment,{children:a({isOauthEnabled:m(),loginHint:f,passwordHint:y,disableLoginForm:v,disableUserSignUp:I,login:D,passwordlessStart:x,passwordlessConfirm:L,showPasswordlessConfirmation:h(),isLoggingIn:t,changePassword:w,skipPasswordChange:O,isChangingPassword:e,showDefaultPasswordWarning:l,loginErrorMessage:M})})}}const _=u;function P(i){switch(i.data?.messageId){case"password-auth.empty":case"password-auth.failed":case"password-auth.invalid":return(0,c.t)("login.error.invalid-user-or-password","Invalid username or password");case"login-attempt.blocked":return(0,c.t)("login.error.blocked","You have exceeded the number of login attempts for this user. Please try again later.");default:return i.data?.message}}function r(i){switch(i){case"oauth.login.error":return(0,c.t)("oauth.login.error","Login provider denied login request");default:return i}}},5325:(C,p,s)=>{s.d(p,{$:()=>i,Q:()=>r});var o=s(74848),n=s(22803),E=s(96540),g=s(49785),d=s(58779),c=s(29675),m=s(86489),h=s(34128),u=s(54594),_=s(11817),P=s(34191);const r=({children:a,onSubmit:t,isLoggingIn:e,passwordHint:l,loginHint:M})=>{const D=(0,c.of)(i),O=(0,E.useId)(),w=(0,E.useId)(),{handleSubmit:x,register:L,formState:{errors:f}}=(0,g.mN)({mode:"onChange"});return(0,o.jsx)("div",{className:D.wrapper,children:(0,o.jsxs)("form",{onSubmit:x(t),children:[(0,o.jsx)(m.D,{label:(0,_.t)("login.form.username-label","Email or username"),invalid:!!f.user,error:f.user?.message,children:(0,o.jsx)(h.p,{...L("user",{required:(0,_.t)("login.form.username-required","Email or username is required")}),id:O,autoFocus:!0,autoCapitalize:"none",placeholder:M||(0,_.t)("login.form.username-placeholder","email or username"),"data-testid":d.Tp.pages.Login.username})}),(0,o.jsx)(m.D,{label:(0,_.t)("login.form.password-label","Password"),invalid:!!f.password,error:f.password?.message,children:(0,o.jsx)(P.s,{...L("password",{required:(0,_.t)("login.form.password-required","Password is required")}),id:w,autoComplete:"current-password",placeholder:l||(0,_.t)("login.form.password-placeholder","password")})}),(0,o.jsx)(u.$n,{type:"submit","data-testid":d.Tp.pages.Login.submit,className:D.submitButton,disabled:e,children:e?(0,_.t)("login.form.submit-loading-label","Logging in..."):(0,_.t)("login.form.submit-label","Log in")}),a]})})},i=a=>({wrapper:(0,n.css)({width:"100%",paddingBottom:a.spacing(2)}),submitButton:(0,n.css)({justifyContent:"center",width:"100%"}),skipButton:(0,n.css)({alignSelf:"flex-start"})})},67293:(C,p,s)=>{s.d(p,{GU:()=>u,YO:()=>P,qm:()=>h});var o=s(74848),n=s(22803),E=s(96540),g=s(29675),d=s(11817),c=s(77455),m=s(50363);const h=({children:r,enterAnimation:i=!0})=>{const a=(0,g.of)(P);return(0,o.jsx)("div",{className:(0,n.cx)(a.loginInnerBox,i&&a.enterAnimation),children:r})},u=({children:r,branding:i,isChangingPassword:a})=>{const t=(0,g.of)(P),[e,l]=(0,E.useState)(!1),M=i?.loginSubtitle??c.M.GetLoginSubTitle(),D=i?.loginTitle??c.M.LoginTitle,O=i?.loginBoxBackground||c.M.LoginBoxBackground(),w=i?.loginLogo,x=i?.hideEdition??c.M.HideEdition;return(0,E.useEffect)(()=>l(!0),[]),(0,o.jsxs)(c.M.LoginBackground,{className:(0,n.cx)(t.container,e&&t.loginAnim,i?.loginBackground),children:[(0,o.jsx)("div",{className:t.loginMain,children:(0,o.jsxs)("div",{className:(0,n.cx)(t.loginContent,O,"login-content-box"),children:[(0,o.jsxs)("div",{className:t.loginLogoWrapper,children:[(0,o.jsx)(c.M.LoginLogo,{className:t.loginLogo,logo:w}),(0,o.jsx)("div",{className:t.titleWrapper,children:a?(0,o.jsx)("h1",{className:t.mainTitle,children:(0,o.jsx)(d.x6,{i18nKey:"login.layout.update-password",children:"Update your password"})}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("h1",{className:t.mainTitle,children:D}),M&&(0,o.jsx)("h3",{className:t.subTitle,children:M})]})})]}),(0,o.jsx)("div",{className:t.loginOuterBox,children:r})]})}),i?.hideFooter?(0,o.jsx)(o.Fragment,{}):(0,o.jsx)(m.wi,{hideEdition:x,customLinks:i?.footerLinks})]})},_=(0,n.keyframes)`
from{
  opacity: 0;
  transform: translate(-60px, 0px);
}

to{
  opacity: 1;
  transform: translate(0px, 0px);
}`,P=r=>({loginMain:(0,n.css)({flexGrow:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minWidth:"100%"}),container:(0,n.css)({minHeight:"100%",backgroundPosition:"center",backgroundRepeat:"no-repeat",flex:1,minWidth:"100%",marginLeft:0,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"}),loginAnim:(0,n.css)({"&:before":{opacity:1},".login-content-box":{opacity:1}}),submitButton:(0,n.css)({justifyContent:"center",width:"100%"}),loginLogo:(0,n.css)({width:"100%",maxWidth:60,marginBottom:r.spacing(2),[r.breakpoints.up("sm")]:{maxWidth:100}}),loginLogoWrapper:(0,n.css)({display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column",padding:r.spacing(3)}),titleWrapper:(0,n.css)({textAlign:"center"}),mainTitle:(0,n.css)({fontSize:22,[r.breakpoints.up("sm")]:{fontSize:32}}),subTitle:(0,n.css)({fontSize:r.typography.size.md,color:r.colors.text.secondary}),loginContent:(0,n.css)({maxWidth:478,width:"calc(100% - 2rem)",display:"flex",alignItems:"stretch",flexDirection:"column",position:"relative",justifyContent:"flex-start",zIndex:1,minHeight:320,borderRadius:r.shape.radius.default,padding:r.spacing(2,0),opacity:0,[r.transitions.handleMotion("no-preference","reduce")]:{transition:"opacity 0.5s ease-in-out"},[r.breakpoints.up("sm")]:{minHeight:r.spacing(40),justifyContent:"center"}}),loginOuterBox:(0,n.css)({display:"flex",overflowY:"hidden",alignItems:"center",justifyContent:"center"}),loginInnerBox:(0,n.css)({padding:r.spacing(0,2,2,2),display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",flexGrow:1,maxWidth:415,width:"100%",transform:"translate(0px, 0px)",[r.transitions.handleMotion("no-preference")]:{transition:"0.25s ease"}}),enterAnimation:(0,n.css)({[r.transitions.handleMotion("no-preference")]:{animation:`${_} ease-out 0.2s`}})})},34191:(C,p,s)=>{s.d(p,{s:()=>c});var o=s(74848),n=s(96540),E=s(58779),g=s(34128),d=s(99764);const c=(0,n.forwardRef)((m,h)=>{const[u,_]=(0,n.useState)(!1);return(0,o.jsx)(g.p,{...m,type:u?"text":"password","data-testid":E.Tp.pages.Login.password,ref:h,suffix:(0,o.jsx)(d.K,{name:u?"eye-slash":"eye","aria-controls":m.id,role:"switch","aria-checked":u,onClick:()=>{_(!u)},tooltip:u?"Hide password":"Show password"})})});c.displayName="PasswordField"},1361:(C,p,s)=>{s.d(p,{DP:()=>_,NQ:()=>u,zJ:()=>P});var o=s(74848),n=s(22803),E=s(90231),g=s(29675),d=s(79784),c=s(45565),m=s(88023),h=s(11817);const u=[{message:"At least 12 characters",validation:a=>a.length>=12},{message:"One uppercase letter",validation:a=>/[A-Z]+/.test(a)},{message:"One lowercase letter",validation:a=>/[a-z]+/.test(a)},{message:"One number",validation:a=>/[0-9]+/.test(a)},{message:"One symbol",validation:a=>/[\W]/.test(a)}],_=a=>!m.Ay.auth.basicAuthStrongPasswordPolicy||u.every(t=>t.validation(a))||(0,h.t)("profile.change-password.strong-password-validation-register","Password does not comply with the strong password policy"),P=({strongPasswordValidations:a,password:t,pristine:e})=>(0,o.jsx)(E.a,{marginBottom:2,children:a.map(l=>(0,o.jsx)(r,{strongPasswordValidation:l,password:t,pristine:e},l.message))}),r=({strongPasswordValidation:a,password:t,pristine:e})=>{const l=(0,g.of)(i),{basicAuthStrongPasswordPolicy:M}=m.Ay.auth;if(!M)return null;const{message:D,validation:O}=a,w=t.length>0&&O(t),x=w||e?"check":"exclamation-triangle",L=w?"secondary":e?"primary":"error";let f;return w?f=l.icon.valid:e?f=l.icon.pending:f=l.icon.error,(0,o.jsxs)(E.a,{display:"flex",alignItems:"center",marginTop:1,children:[(0,o.jsx)(d.I,{className:(0,n.cx)(l.icon.style,f),name:x}),(0,o.jsx)(c.E,{color:L,children:D})]},D)},i=a=>({icon:{style:(0,n.css)({marginRight:a.spacing(1)}),valid:(0,n.css)({color:a.colors.success.text}),pending:(0,n.css)({color:a.colors.secondary.text}),error:(0,n.css)({color:a.colors.error.text})}})}}]);

//# sourceMappingURL=2004.b9c6be599979bfe886e3.js.map