"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[2472],{47761:(J,D,s)=>{s.d(D,{l:()=>B});var e=s(74848),i=s(22803),S=s(96540),C=s(49785);function B({defaultValues:P,onSubmit:I,validateOnMount:E=!1,validateFieldsOnMount:L,children:T,validateOn:g="onSubmit",maxWidth:o=600,...M}){const{handleSubmit:W,trigger:a,formState:y,...A}=(0,C.mN)({mode:g,defaultValues:P});return(0,S.useEffect)(()=>{E&&a(L)},[a,L,E]),(0,e.jsx)("form",{className:(0,i.css)({maxWidth:o!=="none"?o+"px":o,width:"100%"}),onSubmit:W(I),...M,children:T({errors:y.errors,formState:y,trigger:a,...A})})}},22447:(J,D,s)=>{s.d(D,{A:()=>ee,u:()=>V});var e=s(74848),i=s(22803),S=s(96540),C=s(71985),B=s(16753),P=s(58779),I=s(56276),E=s(32370),L=s(44617),T=s(86489),g=s(54731),o=s(51064),M=s(40271),W=s(14749),a=s(45282),y=s(83508),A=s(54594),K=s(90617),H=s(93403),l=s(11817),N=s(1783),n=s(33237),t=s(97267);function q(){const Y=N.Yj.map(d=>({value:d.code,label:d.name})).sort((d,r)=>d.value===N.wi?1:r.value===N.wi?-1:d.label.localeCompare(r.label));return[{value:"",label:(0,l.t)("common.locale.default","Default")},...Y]}class V extends S.PureComponent{constructor(u){super(u),this.onSubmitForm=async r=>{if(r.preventDefault(),this.props.onConfirm?await this.props.onConfirm():!0){const{homeDashboardUID:w,theme:x,timezone:G,weekStart:F,language:Q,queryHistory:k,navbar:p}=this.state;await this.service.update({homeDashboardUID:w,theme:x,timezone:G,weekStart:F,language:Q,queryHistory:k,navbar:p}),window.location.reload()}},this.onThemeChanged=r=>{this.setState({theme:r.value}),(0,I.rR)("grafana_preferences_theme_changed",{toTheme:r.value,preferenceType:this.props.preferenceType}),r.value&&(0,t.K)(r.value,!0)},this.onTimeZoneChanged=r=>{typeof r=="string"&&this.setState({timezone:r})},this.onWeekStartChanged=r=>{this.setState({weekStart:r})},this.onHomeDashboardChanged=r=>{this.setState({homeDashboardUID:r})},this.onLanguageChanged=r=>{this.setState({language:r}),(0,I.rR)("grafana_preferences_language_changed",{toLanguage:r,preferenceType:this.props.preferenceType})},this.service=new n.W(u.resourceUri),this.state={isLoading:!1,theme:"",timezone:"",weekStart:"",language:"",queryHistory:{homeTab:""},navbar:{bookmarkUrls:[]}};const d=[];E.$.featureToggles.extraThemes&&d.push("debug"),E.$.featureToggles.grafanaconThemes&&(d.push("desertbloom"),d.push("gildedgrove"),d.push("sapphiredusk"),d.push("tron"),d.push("gloom")),this.themeOptions=(0,C.k)(d).map(r=>({value:r.id,label:X(r)})),this.themeOptions.unshift({value:"",label:(0,l.t)("shared-preferences.theme.default-label","Default")})}async componentDidMount(){this.setState({isLoading:!0});const u=await this.service.load();this.setState({isLoading:!1,homeDashboardUID:u.homeDashboardUID,theme:u.theme,timezone:u.timezone,weekStart:u.weekStart,language:u.language,queryHistory:u.queryHistory,navbar:u.navbar})}render(){const{theme:u,timezone:d,weekStart:r,homeDashboardUID:Z,language:w,isLoading:x}=this.state,{disabled:G}=this.props,F=se(),Q=q(),k=this.themeOptions.find(p=>p.value===u)??this.themeOptions[0];return(0,e.jsxs)("form",{onSubmit:this.onSubmitForm,className:F.form,children:[(0,e.jsxs)(L.n,{label:(0,e.jsx)(l.x6,{i18nKey:"shared-preferences.title",children:"Preferences"}),disabled:G,children:[(0,e.jsx)(T.D,{loading:x,disabled:x,label:(0,l.t)("shared-preferences.fields.theme-label","Interface theme"),description:E.$.featureToggles.grafanaconThemes&&E.$.feedbackLinksEnabled?(0,e.jsxs)(l.x6,{i18nKey:"shared-preferences.fields.theme-description",children:["Enjoying the limited edition themes? Tell us what you'd like to see"," ",(0,e.jsx)(g.Y,{variant:"bodySmall",external:!0,href:"https://docs.google.com/forms/d/e/1FAIpQLSeRKAY8nUMEVIKSYJ99uOO-dimF6Y69_If1Q1jTLOZRWqK1cw/viewform?usp=dialog",children:"here."})]}):void 0,children:(0,e.jsx)(o.G,{options:this.themeOptions,value:k.value,onChange:this.onThemeChanged,id:"shared-preferences-theme-select"})}),(0,e.jsx)(T.D,{loading:x,disabled:x,label:(0,e.jsx)(M.J,{htmlFor:"home-dashboard-select",children:(0,e.jsx)("span",{className:F.labelText,children:(0,e.jsx)(l.x6,{i18nKey:"shared-preferences.fields.home-dashboard-label",children:"Home Dashboard"})})}),"data-testid":"User preferences home dashboard drop down",children:(0,e.jsx)(H.b,{value:Z,onChange:p=>this.onHomeDashboardChanged(p?.uid??""),defaultOptions:!0,isClearable:!0,placeholder:(0,l.t)("shared-preferences.fields.home-dashboard-placeholder","Default dashboard"),inputId:"home-dashboard-select"})}),(0,e.jsx)(T.D,{loading:x,disabled:x,label:(0,l.t)("shared-dashboard.fields.timezone-label","Timezone"),"data-testid":P.Tp.components.TimeZonePicker.containerV2,children:(0,e.jsx)(W.U,{includeInternal:!0,value:d,onChange:this.onTimeZoneChanged,inputId:"shared-preferences-timezone-picker"})}),(0,e.jsx)(T.D,{loading:x,disabled:x,label:(0,l.t)("shared-preferences.fields.week-start-label","Week start"),"data-testid":P.Tp.components.WeekStartPicker.containerV2,children:(0,e.jsx)(a.l,{value:r||"",onChange:this.onWeekStartChanged,inputId:"shared-preferences-week-start-picker"})}),(0,e.jsx)(T.D,{loading:x,disabled:x,label:(0,e.jsxs)(M.J,{htmlFor:"locale-select",children:[(0,e.jsx)("span",{className:F.labelText,children:(0,e.jsx)(l.x6,{i18nKey:"shared-preferences.fields.locale-label",children:"Language"})}),(0,e.jsx)(y.y,{featureState:B.Ay.beta})]}),"data-testid":"User preferences language drop down",children:(0,e.jsx)(o.G,{value:Q.find(p=>p.value===w)?.value||"",onChange:p=>this.onLanguageChanged(p?.value??""),options:Q,placeholder:(0,l.t)("shared-preferences.fields.locale-placeholder","Choose language"),id:"locale-select"})})]}),(0,e.jsx)(A.$n,{type:"submit",variant:"primary","data-testid":P.Tp.components.UserProfile.preferencesSaveButton,children:(0,e.jsx)(l.x6,{i18nKey:"common.save",children:"Save"})})]})}}const ee=V,se=(0,K.N)(()=>({labelText:(0,i.css)({marginRight:"6px"}),form:(0,i.css)({width:"100%",maxWidth:"600px"})}));function X(Y){switch(Y.id){case"dark":return(0,l.t)("shared.preferences.theme.dark-label","Dark");case"light":return(0,l.t)("shared.preferences.theme.light-label","Light");case"system":return(0,l.t)("shared.preferences.theme.system-label","System preference");default:return Y.name}}},37474:(J,D,s)=>{s.r(D),s.d(D,{UserProfileEditPage:()=>re,default:()=>fe});var e=s(74848),i=s(96540),S=s(71468),C=s(4392),B=s(93253),P=s(58779),I=s(70415),E=s(48583),L=s(10247),T=s(88849),g=s(11238),o=s(54122),M=s(22447),W=s(65539),a=s(11817),y=s(81876),A=s(99134),K=s(54594);class H extends i.PureComponent{render(){const{isLoading:U,orgs:j,user:v}=this.props;return U?(0,e.jsx)(y._,{text:"Loading organizations..."}):j.length===0?null:(0,e.jsxs)("div",{children:[(0,e.jsx)("h3",{className:"page-sub-heading",children:(0,e.jsx)(a.x6,{i18nKey:"user-orgs.title",children:"Organizations"})}),(0,e.jsx)(A.P,{overflowY:"visible",overflowX:"auto",width:"100%",children:(0,e.jsxs)("table",{className:"filter-table form-inline","data-testid":P.Tp.components.UserProfile.orgsTable,children:[(0,e.jsx)("thead",{children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{children:(0,e.jsx)(a.x6,{i18nKey:"user-orgs.name-column",children:"Name"})}),(0,e.jsx)("th",{children:(0,e.jsx)(a.x6,{i18nKey:"user-orgs.role-column",children:"Role"})}),(0,e.jsx)("th",{})]})}),(0,e.jsx)("tbody",{children:j.map((f,c)=>(0,e.jsxs)("tr",{children:[(0,e.jsx)("td",{children:f.name}),(0,e.jsx)("td",{children:f.role}),(0,e.jsx)("td",{className:"text-right",children:f.orgId===v?.orgId?(0,e.jsx)(K.$n,{variant:"secondary",size:"sm",disabled:!0,children:(0,e.jsx)(a.x6,{i18nKey:"user-orgs.current-org-button",children:"Current"})}):(0,e.jsx)(K.$n,{variant:"secondary",size:"sm",onClick:()=>{this.props.setUserOrg(f)},children:(0,e.jsx)(a.x6,{i18nKey:"user-orgs.select-org-button",children:"Select organisation"})})})]},c))})]})})]})}}const l=H;var N=s(44617),n=s(86489),t=s(34128),q=s(6736),V=s(79784),ee=s(47761),se=s(88023);const{disableLoginForm:X}=se.Ay,u=({user:m,isSavingUser:U,updateProfile:j})=>{const v=O=>{j(O)},f=(m&&m.isExternal)??!1,c=f&&m&&m.authLabels?m.authLabels[0]:"",b=c?` (Synced via ${c})`:"",R=X||f;return(0,e.jsx)(ee.l,{onSubmit:v,validateOn:"onBlur",children:({register:O,errors:_})=>(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(N.n,{children:[(0,e.jsx)(n.D,{label:(0,a.t)("user-profile.fields.name-label","Name")+b,invalid:!!_.name,error:(0,e.jsx)(a.x6,{i18nKey:"user-profile.fields.name-error",children:"Name is required"}),disabled:R,children:(0,e.jsx)(t.p,{...O("name",{required:!0}),id:"edit-user-profile-name",placeholder:(0,a.t)("user-profile.fields.name-label","Name"),defaultValue:m?.name??"",suffix:(0,e.jsx)(d,{})})}),(0,e.jsx)(n.D,{label:(0,a.t)("user-profile.fields.email-label","Email")+b,invalid:!!_.email,error:(0,e.jsx)(a.x6,{i18nKey:"user-profile.fields.email-error",children:"Email is required"}),disabled:R,children:(0,e.jsx)(t.p,{...O("email",{required:!0}),id:"edit-user-profile-email",placeholder:(0,a.t)("user-profile.fields.email-label","Email"),defaultValue:m?.email??"",suffix:(0,e.jsx)(d,{})})}),(0,e.jsx)(n.D,{label:(0,a.t)("user-profile.fields.username-label","Username")+b,disabled:R,children:(0,e.jsx)(t.p,{...O("login"),id:"edit-user-profile-username",defaultValue:m?.login??"",placeholder:(0,a.t)("user-profile.fields.username-label","Username")+b,suffix:(0,e.jsx)(d,{})})})]}),(0,e.jsx)(K.$n,{variant:"primary",disabled:U||R,"data-testid":P.Tp.components.UserProfile.profileSaveButton,type:"submit",children:(0,e.jsx)(a.x6,{i18nKey:"common.save",children:"Save"})})]})})},d=()=>X?(0,e.jsx)(q.m,{content:"Login details locked because they are managed in another system.",children:(0,e.jsx)(V.I,{name:"lock"})}):null;var r=s(22803),Z=s(29272),w=s(13171);class x extends i.PureComponent{render(){const{isLoading:U,sessions:j,revokeUserSession:v}=this.props,f=G();return U?(0,e.jsx)(y._,{text:(0,e.jsx)(a.x6,{i18nKey:"user-sessions.loading",children:"Loading sessions..."})}):(0,e.jsx)("div",{className:f.wrapper,children:j.length>0&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("h3",{className:"page-sub-heading",children:"Sessions"}),(0,e.jsx)(A.P,{overflowY:"visible",overflowX:"auto",width:"100%",children:(0,e.jsxs)("table",{className:"filter-table form-inline","data-testid":P.Tp.components.UserProfile.sessionsTable,children:[(0,e.jsx)("thead",{children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{children:(0,e.jsx)(a.x6,{i18nKey:"user-session.seen-at-column",children:"Last seen"})}),(0,e.jsx)("th",{children:(0,e.jsx)(a.x6,{i18nKey:"user-session.created-at-column",children:"Logged on"})}),(0,e.jsx)("th",{children:(0,e.jsx)(a.x6,{i18nKey:"user-session.ip-column",children:"IP address"})}),(0,e.jsx)("th",{children:(0,e.jsx)(a.x6,{i18nKey:"user-session.browser-column",children:"Browser & OS"})}),(0,e.jsx)("th",{children:(0,e.jsx)(a.x6,{i18nKey:"user-session.identity-provider-column",children:"Identity Provider"})}),(0,e.jsx)("th",{})]})}),(0,e.jsx)("tbody",{children:j.map((c,b)=>(0,e.jsxs)("tr",{children:[c.isActive?(0,e.jsx)("td",{children:"Now"}):(0,e.jsx)("td",{children:c.seenAt}),(0,e.jsx)("td",{children:(0,w.Y)(c.createdAt,{dateStyle:"long"})}),(0,e.jsx)("td",{children:c.clientIp}),(0,e.jsxs)("td",{children:[c.browser," on ",c.os," ",c.osVersion]}),(0,e.jsx)("td",{children:c.authModule&&(0,e.jsx)(Z.E,{label:c.authModule,removeIcon:!1,count:0})}),(0,e.jsx)("td",{children:(0,e.jsx)(K.$n,{size:"sm",variant:"destructive",tooltip:(0,a.t)("user-session.revoke","Revoke user session"),onClick:()=>v(c.id),"aria-label":(0,a.t)("user-session.revoke","Revoke user session"),children:(0,e.jsx)(V.I,{name:"power"})})})]},b))})]})})]})})}}const G=()=>({wrapper:(0,r.css)({maxWidth:"100%"})}),F=x;class Q extends i.PureComponent{render(){const{isLoading:U,teams:j}=this.props;return U?(0,e.jsx)(y._,{text:"Loading teams..."}):j.length===0?null:(0,e.jsxs)("div",{children:[(0,e.jsx)("h3",{className:"page-sub-heading",children:"Teams"}),(0,e.jsxs)("table",{className:"filter-table form-inline","aria-label":"User teams table",children:[(0,e.jsx)("thead",{children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{}),(0,e.jsx)("th",{children:"Name"}),(0,e.jsx)("th",{children:"Email"}),(0,e.jsx)("th",{children:"Members"})]})}),(0,e.jsx)("tbody",{children:j.map((v,f)=>(0,e.jsxs)("tr",{children:[(0,e.jsx)("td",{className:"width-4 text-center",children:(0,e.jsx)("img",{className:"filter-table__avatar",src:v.avatarUrl,alt:""})}),(0,e.jsx)("td",{children:v.name}),(0,e.jsx)("td",{children:v.email}),(0,e.jsx)("td",{children:v.memberCount})]},f))})]})]})}}const k=null;var p=s(50132);const te="tab",ne="general";function he(m){const U=m.user,{user:j,teams:v,orgs:f,sessions:c,teamsAreLoading:b,orgsAreLoading:R,sessionsAreLoading:O,isUpdating:_}=U;return{orgsAreLoading:R,sessionsAreLoading:O,teamsAreLoading:b,orgs:f,sessions:c,teams:v,isUpdating:_,user:j}}const ue={initUserProfilePage:p.Qe,revokeUserSession:p._O,changeUserOrg:p.Aj,updateUserProfile:p.eg},me=(0,S.connect)(he,ue);function re({orgsAreLoading:m,sessionsAreLoading:U,teamsAreLoading:j,initUserProfilePage:v,orgs:f,sessions:c,teams:b,isUpdating:R,user:O,revokeUserSession:_,changeUserOrg:ge,updateUserProfile:xe}){const[pe,je]=(0,W.s)(),oe=pe[te],[ae,ve]=(0,i.useState)(typeof oe=="string"?oe:ne);(0,C.A)(()=>v());const{extensions:ie}=(0,I.kr)({extensionPointId:B.S.UserProfileTab}),le=ie.reduce((h,z)=>{const{title:$}=z;return h[$]?h[$].push(z):h[$]=[z],h},{}),de=h=>h.toLowerCase(),Pe=ie.length>0,Ee=[{id:ne,title:(0,a.t)("user-profile.tabs.general","General")},...Object.keys(le).map(h=>({id:de(h),title:h}))],ce=()=>(0,e.jsxs)(E.B,{direction:"column",gap:2,children:[(0,e.jsx)(u,{updateProfile:xe,isSavingUser:R,user:O}),(0,e.jsx)(M.A,{resourceUri:"user",preferenceType:"user"}),(0,e.jsxs)(E.B,{direction:"column",gap:6,children:[(0,e.jsx)(Q,{isLoading:j,teams:b}),(0,e.jsx)(l,{isLoading:m,setUserOrg:ge,orgs:f,user:O}),(0,e.jsx)(F,{isLoading:U,revokeUserSession:_,sessions:c})]})]}),Te=()=>(0,e.jsx)("div",{"data-testid":P.Tp.components.UserProfile.extensionPointTabs,children:(0,e.jsxs)(E.B,{direction:"column",gap:2,children:[(0,e.jsx)(L.U,{children:Ee.map(({id:h,title:z})=>(0,e.jsx)(T.o,{label:z,active:ae===h,onChangeTab:()=>{ve(h),je({[te]:h})},"data-testid":P.Tp.components.UserProfile.extensionPointTab(h)},h))}),(0,e.jsxs)(g.J,{children:[ae===ne&&(0,e.jsx)(ce,{}),Object.entries(le).map(([h,z])=>{const $=de(h);return ae===$?(0,e.jsx)(i.Fragment,{children:z.map(({component:Ue},Oe)=>(0,e.jsx)(Ue,{},`${$}-${Oe}`))},$):null})]})]})});return(0,e.jsx)(o.Y,{navId:"profile/settings",children:(0,e.jsx)(o.Y.Contents,{isLoading:!O,children:Pe?(0,e.jsx)(Te,{}):(0,e.jsx)(ce,{})})})}const fe=me(re)},50132:(J,D,s)=>{s.d(D,{ec:()=>M,Aj:()=>l,Qe:()=>W,YW:()=>a,_O:()=>H,eg:()=>N});var e=s(32370),i=s(28082);async function S(n){try{await(0,i.AI)().put("/api/user/password",n)}catch(t){console.error(t)}}function C(){return(0,i.AI)().get("/api/user")}function B(){return(0,i.AI)().get("/api/user/teams")}function P(){return(0,i.AI)().get("/api/user/orgs")}function I(){return(0,i.AI)().get("/api/user/auth-tokens")}async function E(n){await(0,i.AI)().post("/api/user/revoke-auth-token",{authTokenId:n})}async function L(n){await(0,i.AI)().post("/api/user/using/"+n.orgId,{})}async function T(n){try{await(0,i.AI)().put("/api/user",n)}catch(t){console.error(t)}}const g={changePassword:S,revokeUserSession:E,loadUser:C,loadSessions:I,loadOrgs:P,loadTeams:B,setUserOrg:L,updateUserProfile:T};var o=s(89880);function M(n){return async function(t){t((0,o.Nm)({updating:!0})),await g.changePassword(n),t((0,o.Nm)({updating:!1}))}}function W(){return async function(n){await n(a()),n(y()),n(A()),n(K())}}function a(){return async function(n){const t=await g.loadUser();n((0,o.HO)({user:t}))}}function y(){return async function(n){n((0,o.ri)());const t=await g.loadTeams();n((0,o.Q9)({teams:t}))}}function A(){return async function(n){n((0,o.Mj)());const t=await g.loadOrgs();n((0,o.ny)({orgs:t}))}}function K(){return async function(n){n((0,o.uh)());const t=await g.loadSessions();n((0,o.RS)({sessions:t}))}}function H(n){return async function(t){t((0,o.Nm)({updating:!0})),await g.revokeUserSession(n),t((0,o.g$)({tokenId:n}))}}function l(n){return async function(t){t((0,o.Nm)({updating:!0})),await g.setUserOrg(n),window.location.href=e.$.appSubUrl+"/profile"}}function N(n){return async function(t){t((0,o.Nm)({updating:!0})),await g.updateUserProfile(n),await t(a()),t((0,o.Nm)({updating:!1}))}}},4392:(J,D,s)=>{s.d(D,{A:()=>S});var e=s(94701),i=function(C){(0,e.A)(function(){C()})};const S=i}}]);

//# sourceMappingURL=UserProfileEditPage.f4b510919bbc12c1b106.js.map