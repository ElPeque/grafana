"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[8054],{60156:(de,M,t)=>{t.d(M,{y:()=>d});var e=t(74848),h=t(96540),K=t(41053),E=t(87638),D=t(61491),S=t(71623),A=t(26185);const d=({basicRole:g,roles:b,userId:x,orgId:i,onBasicRoleChange:I,roleOptions:H,disabled:J,basicRoleDisabled:Q,basicRoleDisabledMessage:c,apply:N=!1,onApplyRoles:U,pendingRoles:T,maxWidth:z,width:G,isLoading:V})=>{const[{loading:$,value:Y=b||[]},L]=(0,K.A)(async()=>{try{if(b)return b;if(N&&T?.length)return T;if(E.TP.hasPermission(D.AccessControlAction.ActionUserRolesList)&&x>0)return await(0,A.Xh)(x,i)}catch{console.error("Error loading options")}return[]},[i,x,T,b]);(0,h.useEffect)(()=>{i&&L()},[L,i]);const q=async w=>{N?U&&U(w,x,i):(await(0,A.eA)(w,x,i),await L())},_=E.TP.hasPermission(D.AccessControlAction.ActionUserRolesAdd)&&E.TP.hasPermission(D.AccessControlAction.ActionUserRolesRemove);return(0,e.jsx)(S.n,{appliedRoles:Y,basicRole:g,onRolesChange:q,onBasicRoleChange:I,roleOptions:H,isLoading:$||V,disabled:J,basicRoleDisabled:Q,basicRoleDisabledMessage:c,showBasicRole:!0,apply:N,canUpdateRoles:_,maxWidth:z,width:G})}},68031:(de,M,t)=>{t.d(M,{r:()=>S});var e=t(74848),h=t(83827),K=t(44826);const D=Object.values(h.X).filter(A=>A!==h.X.None).map(A=>({label:A,value:A}));function S({value:A,onChange:d,"aria-label":g,inputId:b,autoFocus:x,...i}){return(0,e.jsx)(K.l6,{inputId:b,value:A,options:D,onChange:I=>d(I.value??h.X.None),placeholder:"Choose role...","aria-label":g,autoFocus:x,...i})}},21466:(de,M,t)=>{t.r(M),t.d(M,{UserAdminPage:()=>me,default:()=>$e});var e=t(74848),h=t(96540),K=t(71468),E=t(54148),D=t(32864),S=t(48583),A=t(54122),d=t(87638),g=t(61491),b=t(88090),x=t(54594),i=t(11817),I=t(29272);const H="dddd YYYY-MM-DD HH:mm zz",J="/admin/authentication/ldap";class Q extends h.PureComponent{constructor(){super(...arguments),this.onUserSync=()=>{this.props.onUserSync()}}render(){const{ldapSyncInfo:s,user:o}=this.props,l=s&&s.nextSync?(0,b.LE)(s.nextSync,{format:H}):"",r=`${J}?user=${o&&o.login}`,u=d.TP.hasPermission(g.AccessControlAction.LDAPUsersRead),m=d.TP.hasPermission(g.AccessControlAction.LDAPUsersSync);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("h3",{className:"page-heading",children:(0,e.jsx)(i.x6,{i18nKey:"admin.ldap-sync.title",children:"LDAP Synchronisation"})}),(0,e.jsxs)("div",{className:"gf-form-group",children:[(0,e.jsx)("div",{className:"gf-form",children:(0,e.jsx)("table",{className:"filter-table form-inline",children:(0,e.jsxs)("tbody",{children:[(0,e.jsxs)("tr",{children:[(0,e.jsx)("td",{children:(0,e.jsx)(i.x6,{i18nKey:"admin.ldap-sync.external-sync-label",children:"External sync"})}),(0,e.jsx)("td",{children:(0,e.jsx)(i.x6,{i18nKey:"admin.ldap-sync.external-sync-description",children:"User synced via LDAP. Some changes must be done in LDAP or mappings."})}),(0,e.jsx)("td",{children:(0,e.jsx)(I.E,{label:"LDAP",removeIcon:!1,count:0,onClick:void 0})})]}),(0,e.jsxs)("tr",{children:[(0,e.jsx)("td",{children:(0,e.jsx)(i.x6,{i18nKey:"admin.ldap-sync.next-sync-label",children:"Next scheduled synchronization"})}),(0,e.jsx)("td",{colSpan:2,children:s.enabled?l:(0,e.jsx)(i.x6,{i18nKey:"admin.ldap-sync.not-enabled",children:"Not enabled"})})]})]})})}),(0,e.jsxs)("div",{className:"gf-form-button-row",children:[m&&(0,e.jsx)(x.$n,{variant:"secondary",onClick:this.onUserSync,children:(0,e.jsx)(i.x6,{i18nKey:"admin.ldap-sync.sync-button",children:"Sync user"})}),u&&(0,e.jsx)(x.z9,{variant:"secondary",href:r,children:(0,e.jsx)(i.x6,{i18nKey:"admin.ldap-sync.debug-button",children:"Debug LDAP Mapping"})})]})]})]})}}var c=t(22803),N=t(90617),U=t(91396),T=t(29675),z=t(25356),G=t(86489),V=t(6736),$=t(79784),Y=t(60156),L=t(26185),q=t(41053),_=t(28082),w=t(44826);function he(n){return{value:n,label:n.name}}function pe({onSelected:n,className:s,inputId:o,autoFocus:a,excludeOrgs:l,defaultOrganization:r}){const[u,m]=(0,h.useState)(r?he(r):void 0);(0,h.useEffect)(()=>{a&&o&&document.getElementById(o)?.focus()},[a,o]);const[R,f]=(0,q.A)(async()=>{const j=(await(0,_.AI)().get("/api/orgs")).map(he);if(l){let C=l.map(P=>P.orgId);return j.filter(P=>P.value!==void 0&&!C.includes(P.value.id))}else return j});return(0,e.jsx)(w.DW,{inputId:o,className:s,isLoading:R.loading,defaultOptions:!0,loadOptions:f,filterOption:(p,j)=>{const C=j.toLowerCase();return!!p.value?.name.toLowerCase().includes(C)},onChange:p=>{n(p),m(p)},value:u,placeholder:"Select organization",noOptionsMessage:"No organizations found"})}var fe=t(68031);class je extends h.PureComponent{constructor(){super(...arguments),this.addToOrgButtonRef=(0,h.createRef)(),this.state={showAddOrgModal:!1},this.showOrgAddModal=()=>{this.setState({showAddOrgModal:!0})},this.dismissOrgAddModal=()=>{this.setState({showAddOrgModal:!1},()=>{this.addToOrgButtonRef.current?.focus()})}}render(){const{user:s,orgs:o,isExternalUser:a,onOrgRoleChange:l,onOrgRemove:r,onOrgAdd:u}=this.props,{showAddOrgModal:m}=this.state,R=d.TP.hasPermission(g.AccessControlAction.OrgUsersAdd)&&!a;return(0,e.jsxs)("div",{children:[(0,e.jsx)("h3",{className:"page-heading",children:(0,e.jsx)(i.x6,{i18nKey:"admin.user-orgs.title",children:"Organizations"})}),(0,e.jsxs)(S.B,{gap:1.5,direction:"column",children:[(0,e.jsx)("table",{className:"filter-table form-inline",children:(0,e.jsx)("tbody",{children:o.map((f,p)=>(0,e.jsx)(ye,{isExternalUser:a,user:s,org:f,onOrgRoleChange:l,onOrgRemove:r},`${f.orgId}-${p}`))})}),(0,e.jsx)("div",{children:R&&(0,e.jsx)(x.$n,{variant:"secondary",onClick:this.showOrgAddModal,ref:this.addToOrgButtonRef,children:(0,e.jsx)(i.x6,{i18nKey:"admin.user-orgs.add-button",children:"Add user to organization"})})}),(0,e.jsx)(Re,{user:s,userOrgs:o,isOpen:m,onOrgAdd:u,onDismiss:this.dismissOrgAddModal})]})]})}}const ve=(0,N.N)(n=>({removeButton:(0,c.css)({marginRight:"0.6rem",textDecoration:"underline",color:n.v1.palette.blue95}),label:(0,c.css)({fontWeight:500}),disabledTooltip:(0,c.css)({display:"flex"}),tooltipItem:(0,c.css)({marginLeft:"5px"}),tooltipItemLink:(0,c.css)({color:n.v1.palette.blue95}),rolePickerWrapper:(0,c.css)({display:"flex"}),rolePicker:(0,c.css)({flex:"auto",marginRight:n.spacing(1)})}));class Ce extends h.PureComponent{constructor(){super(...arguments),this.state={currentRole:this.props.org.role,isChangingRole:!1,roleOptions:[]},this.onOrgRemove=async()=>{const{org:s}=this.props;this.props.onOrgRemove(s.orgId)},this.onChangeRoleClick=()=>{const{org:s}=this.props;this.setState({isChangingRole:!0,currentRole:s.role})},this.onOrgRoleChange=s=>{this.setState({currentRole:s})},this.onOrgRoleSave=()=>{this.props.onOrgRoleChange(this.props.org.orgId,this.state.currentRole)},this.onCancelClick=()=>{this.setState({isChangingRole:!1})},this.onBasicRoleChange=s=>{this.props.onOrgRoleChange(this.props.org.orgId,s)}}componentDidMount(){d.TP.licensedAccessControlEnabled()&&d.TP.hasPermission(g.AccessControlAction.ActionRolesList)&&(0,L.RL)(this.props.org.orgId).then(s=>this.setState({roleOptions:s})).catch(s=>console.error(s))}render(){const{user:s,org:o,isExternalUser:a,theme:l}=this.props,r=s?.authLabels?.length&&s?.authLabels[0],u=r?`Synced via ${r}`:"",{currentRole:m,isChangingRole:R}=this.state,f=ve(l),p=(0,c.cx)("width-16",f.label),j=d.TP.hasPermission(g.AccessControlAction.OrgUsersWrite),C=d.TP.hasPermission(g.AccessControlAction.OrgUsersRemove)&&!a,P=a||!j,k=`${o.name}-input`;return(0,e.jsxs)("tr",{children:[(0,e.jsx)("td",{className:p,children:(0,e.jsx)("label",{htmlFor:k,children:o.name})}),d.TP.licensedAccessControlEnabled()?(0,e.jsx)("td",{children:(0,e.jsxs)("div",{className:f.rolePickerWrapper,children:[(0,e.jsx)("div",{className:f.rolePicker,children:(0,e.jsx)(Y.y,{userId:s?.id||0,orgId:o.orgId,basicRole:o.role,roleOptions:this.state.roleOptions,onBasicRoleChange:this.onBasicRoleChange,basicRoleDisabled:P,basicRoleDisabledMessage:`This user's role is not editable because it is synchronized from your auth provider.
                    Refer to the Grafana authentication docs for details.`})}),a&&(0,e.jsx)(ge,{lockMessage:u})]})}):(0,e.jsxs)(e.Fragment,{children:[R?(0,e.jsx)("td",{children:(0,e.jsx)(fe.r,{inputId:k,value:m,onChange:this.onOrgRoleChange,autoFocus:!0})}):(0,e.jsx)("td",{className:"width-25",children:o.role}),(0,e.jsx)("td",{colSpan:1,children:j&&(0,e.jsx)(Oe,{lockMessage:u,isExternalUser:a,onChangeRoleClick:this.onChangeRoleClick,onCancelClick:this.onCancelClick,onOrgRoleSave:this.onOrgRoleSave})})]}),(0,e.jsx)("td",{colSpan:1,children:C&&(0,e.jsx)(U.Z,{confirmText:"Confirm removal",confirmVariant:"destructive",onCancel:this.onCancelClick,onConfirm:this.onOrgRemove,children:(0,i.t)("admin.user-orgs.remove-button","Remove from organization")})})]})}}const ye=(0,T.cV)(Ce),Ae=(0,N.N)(()=>({modal:(0,c.css)({width:"500px"}),buttonRow:(0,c.css)({textAlign:"center"}),modalContent:(0,c.css)({overflow:"visible"})}));class Re extends h.PureComponent{constructor(){super(...arguments),this.state={selectedOrg:null,role:g.OrgRole.Viewer,roleOptions:[],pendingOrgId:null,pendingUserId:null,pendingRoles:[]},this.onOrgSelect=s=>{const o=this.props.userOrgs.find(a=>a.orgId===s.value?.id);this.setState({selectedOrg:s.value,role:o?.role||g.OrgRole.Viewer}),d.TP.licensedAccessControlEnabled()&&d.TP.hasPermission(g.AccessControlAction.ActionRolesList)&&(0,L.RL)(s.value?.id).then(a=>this.setState({roleOptions:a})).catch(a=>console.error(a))},this.onOrgRoleChange=s=>{this.setState({role:s})},this.onAddUserToOrg=async()=>{const{selectedOrg:s,role:o}=this.state;this.props.onOrgAdd(s.id,o),d.TP.licensedAccessControlEnabled()&&d.TP.hasPermission(g.AccessControlAction.ActionUserRolesAdd)&&this.state.pendingUserId&&(await(0,L.eA)(this.state.pendingRoles,this.state.pendingUserId,this.state.pendingOrgId),this.setState({pendingOrgId:null,pendingRoles:[],pendingUserId:null}))},this.onCancel=()=>{this.setState({selectedOrg:null,pendingRoles:[],pendingOrgId:null,pendingUserId:null}),this.props.onDismiss&&this.props.onDismiss()},this.onRoleUpdate=async(s,o,a)=>{this.setState({pendingRoles:s,pendingOrgId:a,pendingUserId:o})}}render(){const{isOpen:s,user:o,userOrgs:a}=this.props,{role:l,roleOptions:r,selectedOrg:u}=this.state,m=Ae();return(0,e.jsxs)(z.a,{className:m.modal,contentClassName:m.modalContent,title:"Add to an organization",isOpen:s,onDismiss:this.onCancel,children:[(0,e.jsx)(G.D,{label:"Organization",children:(0,e.jsx)(pe,{inputId:"new-org-input",onSelected:this.onOrgSelect,excludeOrgs:a,autoFocus:!0})}),(0,e.jsx)(G.D,{label:"Role",disabled:u===null,children:(0,e.jsx)(Y.y,{userId:o?.id||0,orgId:u?.id,basicRole:l,onBasicRoleChange:this.onOrgRoleChange,basicRoleDisabled:!1,roleOptions:r,apply:!0,onApplyRoles:this.onRoleUpdate,pendingRoles:this.state.pendingRoles})}),(0,e.jsx)(z.a.ButtonRow,{children:(0,e.jsxs)(S.B,{gap:2,justifyContent:"center",children:[(0,e.jsx)(x.$n,{variant:"secondary",fill:"outline",onClick:this.onCancel,children:(0,e.jsx)(i.x6,{i18nKey:"admin.user-orgs-modal.cancel-button",children:"Cancel"})}),(0,e.jsx)(x.$n,{variant:"primary",disabled:u===null,onClick:this.onAddUserToOrg,children:(0,e.jsx)(i.x6,{i18nKey:"admin.user-orgs-modal.add-button",children:"Add to organization"})})]})})]})}}const Pe=n=>({disabledTooltip:(0,c.css)({display:"flex"}),tooltipItemLink:(0,c.css)({color:n.v1.palette.blue95}),lockMessageClass:(0,c.css)({fontStyle:"italic",marginLeft:"1.8rem",marginRight:"0.6rem"}),icon:(0,c.css)({lineHeight:2})});function Oe({lockMessage:n,onChangeRoleClick:s,isExternalUser:o,onOrgRoleSave:a,onCancelClick:l}){const r=(0,T.of)(Pe);return(0,e.jsx)("div",{className:r.disabledTooltip,children:o?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("span",{className:r.lockMessageClass,children:n}),(0,e.jsx)(V.m,{placement:"right-end",interactive:!0,content:(0,e.jsx)("div",{children:(0,e.jsxs)(i.x6,{i18nKey:"admin.user-orgs.role-not-editable",children:["This user's role is not editable because it is synchronized from your auth provider. Refer to the\xA0",(0,e.jsx)("a",{className:r.tooltipItemLink,href:"https://grafana.com/docs/grafana/latest/auth",rel:"noreferrer",target:"_blank",children:"Grafana authentication docs"}),"\xA0for details."]})}),children:(0,e.jsx)("div",{className:r.icon,children:(0,e.jsx)($.I,{name:"question-circle"})})})]}):(0,e.jsx)(U.Z,{confirmText:"Save",onClick:s,onCancel:l,onConfirm:a,disabled:o,children:(0,i.t)("admin.user-orgs.change-role-button","Change role")})})}const ge=({lockMessage:n})=>{const s=(0,T.of)(Se);return(0,e.jsxs)("div",{className:s.disabledTooltip,children:[(0,e.jsx)("span",{className:s.lockMessageClass,children:n}),(0,e.jsx)(V.m,{placement:"right-end",interactive:!0,content:(0,e.jsx)("div",{children:(0,e.jsxs)(i.x6,{i18nKey:"admin.user-orgs.external-user-tooltip",children:["This user's built-in role is not editable because it is synchronized from your auth provider. Refer to the\xA0",(0,e.jsx)("a",{className:s.tooltipItemLink,href:"https://grafana.com/docs/grafana/latest/auth",rel:"noreferrer noopener",target:"_blank",children:"Grafana authentication docs"}),"\xA0for details."]})}),children:(0,e.jsx)($.I,{name:"question-circle"})})]})},Se=n=>({disabledTooltip:(0,c.css)({display:"flex"}),tooltipItemLink:(0,c.css)({color:n.v1.palette.blue95}),lockMessageClass:(0,c.css)({fontStyle:"italic",marginLeft:"1.8rem",marginRight:"0.6rem"})});var be=t(60641);const Ue=[{label:"Yes",value:!0},{label:"No",value:!1}];function Te({isGrafanaAdmin:n,isExternalUser:s,lockMessage:o,onGrafanaAdminChange:a}){const[l,r]=(0,h.useState)(!1),[u,m]=(0,h.useState)(n),R=()=>r(!0),f=()=>{r(!1),m(n)},p=()=>a(u),j=d.TP.hasPermission(g.AccessControlAction.UsersPermissionsUpdate)&&!s,C=(0,T.of)(De);return(0,e.jsxs)("div",{children:[(0,e.jsx)("h3",{className:"page-heading",children:(0,e.jsx)(i.x6,{i18nKey:"admin.user-permissions.title",children:"Permissions"})}),(0,e.jsx)("table",{className:"filter-table form-inline",children:(0,e.jsx)("tbody",{children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("td",{className:"width-16",children:(0,e.jsx)(i.x6,{i18nKey:"admin.user-permissions.grafana-admin-key",children:"Grafana Admin"})}),l?(0,e.jsx)("td",{colSpan:2,children:(0,e.jsx)(be.z,{options:Ue,value:u,onChange:m,autoFocus:!0})}):(0,e.jsx)("td",{colSpan:2,children:n?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)($.I,{name:"shield"})," ",(0,e.jsx)(i.x6,{i18nKey:"admin.user-permissions.grafana-admin-yes",children:"Yes"})]}):(0,e.jsx)(i.x6,{i18nKey:"admin.user-permissions.grafana-admin-no",children:"No"})}),(0,e.jsxs)("td",{children:[j&&(0,e.jsx)(U.Z,{onClick:R,onConfirm:p,onCancel:f,confirmText:"Change",children:(0,i.t)("admin.user-permissions.change-button","Change")}),s&&(0,e.jsx)("div",{className:C.lockMessageClass,children:(0,e.jsx)(ge,{lockMessage:o})})]})]})})})]})}const De=n=>({lockMessageClass:(0,c.css)({display:"flex",justifyContent:"flex-end",fontStyle:"italic",marginRight:n.spacing(.6)})});var ee=t(65164),ue=t(92732),Le=t(34128);function Me({user:n,onUserUpdate:s,onUserDelete:o,onUserDisable:a,onUserEnable:l,onPasswordChange:r}){const[u,m]=(0,h.useState)(!1),[R,f]=(0,h.useState)(!1),p=(0,h.useRef)(null),j=y=>()=>{m(y),!y&&p.current&&p.current.focus()},C=(0,h.useRef)(null),P=y=>()=>{f(y),!y&&C.current&&C.current.focus()},k=()=>o(n.uid),se=()=>a(n.uid),ne=()=>l(n.uid),te=y=>{s({...n,name:y})},Z=y=>{s({...n,email:y})},oe=y=>{s({...n,login:y})},X=n.authLabels?.length&&n.authLabels[0],B=X?`Synced via ${X}`:"",W=n.isExternal||!d.TP.hasPermissionInMetadata(g.AccessControlAction.UsersWrite,n),ie=n.isExternal||!d.TP.hasPermissionInMetadata(g.AccessControlAction.UsersPasswordUpdate,n),ae=d.TP.hasPermissionInMetadata(g.AccessControlAction.UsersDelete,n),le=d.TP.hasPermissionInMetadata(g.AccessControlAction.UsersDisable,n),re=d.TP.hasPermissionInMetadata(g.AccessControlAction.UsersEnable,n);return(0,e.jsxs)("div",{children:[(0,e.jsx)("h3",{className:"page-heading",children:(0,e.jsx)(i.x6,{i18nKey:"admin.user-profile.title",children:"User information"})}),(0,e.jsxs)(S.B,{direction:"column",gap:1.5,children:[(0,e.jsx)("div",{children:(0,e.jsx)("table",{className:"filter-table form-inline",children:(0,e.jsxs)("tbody",{children:[(0,e.jsx)(F,{label:"Numerical identifier",value:n.id.toString(),locked:!0}),(0,e.jsx)(F,{label:"Name",value:n.name,locked:W,lockMessage:B,onChange:te}),(0,e.jsx)(F,{label:"Email",value:n.email,locked:W,lockMessage:B,onChange:Z}),(0,e.jsx)(F,{label:"Username",value:n.login,locked:W,lockMessage:B,onChange:oe}),(0,e.jsx)(F,{label:"Password",value:"********",inputType:"password",locked:ie,lockMessage:B,onChange:r})]})})}),(0,e.jsxs)(S.B,{gap:2,children:[ae&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(x.$n,{variant:"destructive",onClick:j(!0),ref:p,children:(0,e.jsx)(i.x6,{i18nKey:"admin.user-profile.delete-button",children:"Delete user"})}),(0,e.jsx)(ee.u,{isOpen:u,title:"Delete user",body:"Are you sure you want to delete this user?",confirmText:"Delete user",onConfirm:k,onDismiss:j(!1)})]}),n.isDisabled&&re&&(0,e.jsx)(x.$n,{variant:"secondary",onClick:ne,children:(0,e.jsx)(i.x6,{i18nKey:"admin.user-profile.enable-button",children:"Enable user"})}),!n.isDisabled&&le&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(x.$n,{variant:"secondary",onClick:P(!0),ref:C,children:(0,e.jsx)(i.x6,{i18nKey:"admin.user-profile.disable-button",children:"Disable user"})}),(0,e.jsx)(ee.u,{isOpen:R,title:"Disable user",body:"Are you sure you want to disable this user?",confirmText:"Disable user",onConfirm:se,onDismiss:P(!1)})]})]})]})]})}class F extends h.PureComponent{constructor(){super(...arguments),this.state={editing:!1,value:this.props.value||""},this.setInputElem=s=>{this.inputElem=s},this.onEditClick=()=>{this.props.inputType==="password"?this.setState({editing:!0,value:""},this.focusInput):this.setState({editing:!0},this.focusInput)},this.onCancelClick=()=>{this.setState({editing:!1,value:this.props.value||""})},this.onInputChange=(s,o)=>{o!==ue.O.Invalid&&this.setState({value:s.target.value})},this.onInputBlur=(s,o)=>{o!==ue.O.Invalid&&this.setState({value:s.target.value})},this.focusInput=()=>{this.inputElem&&this.inputElem.focus&&this.inputElem.focus()},this.onSave=()=>{this.props.onChange&&this.props.onChange(this.state.value)}}static{this.defaultProps={value:"",locked:!1,lockMessage:"",inputType:"text"}}render(){const{label:s,locked:o,lockMessage:a,inputType:l}=this.props,{value:r}=this.state,u=(0,c.cx)("width-16",(0,c.css)({fontWeight:500}));if(o)return(0,e.jsx)(Ee,{label:s,value:r,lockMessage:a});const m=`${s}-input`;return(0,e.jsxs)("tr",{children:[(0,e.jsx)("td",{className:u,children:(0,e.jsx)("label",{htmlFor:m,children:s})}),(0,e.jsx)("td",{className:"width-25",colSpan:2,children:this.state.editing?(0,e.jsx)(Le.p,{id:m,type:l,defaultValue:r,onBlur:this.onInputBlur,onChange:this.onInputChange,ref:this.setInputElem,width:30}):(0,e.jsx)("span",{children:this.props.value})}),(0,e.jsx)("td",{children:(0,e.jsx)(U.Z,{confirmText:"Save",onClick:this.onEditClick,onConfirm:this.onSave,onCancel:this.onCancelClick,children:(0,i.t)("admin.user-profile.edit-button","Edit")})})]})}}const Ee=({label:n,value:s,lockMessage:o})=>{const a=(0,c.css)({fontStyle:"italic",marginRight:"0.6rem"}),l=(0,c.cx)("width-16",(0,c.css)({fontWeight:500}));return(0,e.jsxs)("tr",{children:[(0,e.jsx)("td",{className:l,children:n}),(0,e.jsx)("td",{className:"width-25",colSpan:2,children:s}),(0,e.jsx)("td",{children:(0,e.jsx)("span",{className:a,children:o})})]})};var Ie=t(13171);class Ne extends h.PureComponent{constructor(){super(...arguments),this.forceAllLogoutButton=(0,h.createRef)(),this.state={showLogoutModal:!1},this.showLogoutConfirmationModal=()=>{this.setState({showLogoutModal:!0})},this.dismissLogoutConfirmationModal=()=>{this.setState({showLogoutModal:!1},()=>{this.forceAllLogoutButton.current?.focus()})},this.onSessionRevoke=s=>()=>{this.props.onSessionRevoke(s)},this.onAllSessionsRevoke=()=>{this.setState({showLogoutModal:!1}),this.props.onAllSessionsRevoke()}}render(){const{sessions:s}=this.props,{showLogoutModal:o}=this.state,a=d.TP.hasPermission(g.AccessControlAction.UsersLogout);return(0,e.jsxs)("div",{children:[(0,e.jsx)("h3",{className:"page-heading",children:(0,e.jsx)(i.x6,{i18nKey:"admin.user-sessions.title",children:"Sessions"})}),(0,e.jsxs)(S.B,{direction:"column",gap:1.5,children:[(0,e.jsx)("div",{children:(0,e.jsxs)("table",{className:"filter-table form-inline",children:[(0,e.jsx)("thead",{children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{children:(0,e.jsx)(i.x6,{i18nKey:"admin.user-sessions.last-seen-column",children:"Last seen"})}),(0,e.jsx)("th",{children:(0,e.jsx)(i.x6,{i18nKey:"admin.user-sessions.logged-on-column",children:"Logged on"})}),(0,e.jsx)("th",{children:(0,e.jsx)(i.x6,{i18nKey:"admin.user-sessions.ip-column",children:"IP address"})}),(0,e.jsx)("th",{children:(0,e.jsx)(i.x6,{i18nKey:"admin.user-sessions.browser-column",children:"Browser and OS"})}),(0,e.jsx)("th",{colSpan:2,children:(0,e.jsx)(i.x6,{i18nKey:"user-session.auth-module-column",children:"Identity Provider"})})]})}),(0,e.jsx)("tbody",{children:s&&s.map((l,r)=>(0,e.jsxs)("tr",{children:[(0,e.jsx)("td",{children:l.isActive?"Now":l.seenAt}),(0,e.jsx)("td",{children:(0,Ie.Y)(l.createdAt,{dateStyle:"long"})}),(0,e.jsx)("td",{children:l.clientIp}),(0,e.jsx)("td",{children:`${l.browser} on ${l.os} ${l.osVersion}`}),(0,e.jsx)("td",{children:l.authModule&&(0,e.jsx)(I.E,{label:l.authModule,removeIcon:!1,count:0})}),(0,e.jsx)("td",{children:a&&(0,e.jsx)(U.Z,{confirmText:"Confirm logout",confirmVariant:"destructive",onConfirm:this.onSessionRevoke(l.id),children:(0,i.t)("admin.user-sessions.force-logout-button","Force logout")})})]},`${l.id}-${r}`))})]})}),(0,e.jsxs)("div",{children:[a&&s.length>0&&(0,e.jsx)(x.$n,{variant:"secondary",onClick:this.showLogoutConfirmationModal,ref:this.forceAllLogoutButton,children:(0,e.jsx)(i.x6,{i18nKey:"admin.user-sessions.force-logout-all-button",children:"Force logout from all devices"})}),(0,e.jsx)(ee.u,{isOpen:o,title:"Force logout from all devices",body:"Are you sure you want to force logout from all devices?",confirmText:"Force logout",onConfirm:this.onAllSessionsRevoke,onDismiss:this.dismissLogoutConfirmationModal})]})]})]})}}const ke=Ne;var v=t(8476);const me=({loadAdminUserPage:n,user:s,orgs:o,sessions:a,ldapSyncInfo:l,isLoading:r,updateUser:u,setUserPassword:m,deleteUser:R,disableUser:f,enableUser:p,updateUserPermissions:j,deleteOrgUser:C,updateOrgUserRole:P,addOrgUser:k,revokeSession:se,revokeAllSessions:ne,syncLdapUser:te})=>{const{id:Z=""}=(0,E.g)();(0,h.useEffect)(()=>{n(Z)},[Z,n]);const oe=O=>{s&&m(s.uid,O)},X=O=>{s&&j(s.uid,O)},B=O=>{s&&C(s.uid,O)},W=(O,ce)=>{s&&P(s.uid,O,ce)},ie=(O,ce)=>{s&&k(s,O,ce)},ae=O=>{s&&se(O,s.uid)},le=()=>{s&&ne(s.uid)},re=()=>{s&&te(s.id,s.uid)},y=s?.isExternal&&s?.authLabels?.includes("LDAP"),we=d.TP.hasPermission(g.AccessControlAction.UsersAuthTokenList),Fe=d.TP.hasPermission(g.AccessControlAction.LDAPStatusRead),xe=s?.authLabels?.[0],We=xe?`Synced via ${xe}`:"",ze={text:s?.login??"",icon:"shield",subTitle:"Manage settings for an individual user."};return(0,e.jsx)(A.Y,{navId:"global-users",pageNav:ze,children:(0,e.jsx)(A.Y.Contents,{isLoading:r,children:(0,e.jsxs)(S.B,{gap:5,direction:"column",children:[s&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(Me,{user:s,onUserUpdate:u,onUserDelete:R,onUserDisable:f,onUserEnable:p,onPasswordChange:oe}),y&&s?.isExternallySynced&&(0,D.a)("ldapsync")&&l&&Fe&&(0,e.jsx)(Q,{ldapSyncInfo:l,user:s,onUserSync:re}),(0,e.jsx)(Te,{isGrafanaAdmin:s.isGrafanaAdmin,isExternalUser:s?.isGrafanaAdminExternallySynced,lockMessage:We,onGrafanaAdminChange:X})]}),o&&(0,e.jsx)(je,{user:s,orgs:o,isExternalUser:s?.isExternallySynced,onOrgRemove:B,onOrgRoleChange:W,onOrgAdd:ie}),a&&we&&(0,e.jsx)(ke,{sessions:a,onSessionRevoke:ae,onAllSessionsRevoke:le})]})})})},Be=n=>({user:n.userAdmin.user,sessions:n.userAdmin.sessions,orgs:n.userAdmin.orgs,ldapSyncInfo:n.ldap.syncInfo,isLoading:n.userAdmin.isLoading,error:n.userAdmin.error}),Ke={loadAdminUserPage:v.kz,updateUser:v.TK,setUserPassword:v.ly,disableUser:v.MV,enableUser:v.nr,deleteUser:v.hG,updateUserPermissions:v.N6,addOrgUser:v.nh,updateOrgUserRole:v.P3,deleteOrgUser:v.Pi,revokeSession:v.T$,revokeAllSessions:v.VR,syncLdapUser:v.mI},$e=(0,K.connect)(Be,Ke)(me)}}]);

//# sourceMappingURL=UserAdminPage.df25b2e2b784ea1e8204.js.map