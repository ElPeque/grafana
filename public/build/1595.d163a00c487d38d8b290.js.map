{"version":3,"file":"1595.d163a00c487d38d8b290.js","mappings":"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","sources":["webpack://grafana/./public/app/features/alerting/unified/components/receivers/form/CollapsibleSection.tsx","webpack://grafana/./public/app/features/alerting/unified/components/receivers/form/fields/KeyValueMapInput.tsx","webpack://grafana/./public/app/features/alerting/unified/components/receivers/form/fields/StringArrayInput.tsx","webpack://grafana/./public/app/features/alerting/unified/components/receivers/form/fields/styles.ts","webpack://grafana/./public/app/features/alerting/unified/components/receivers/form/fields/SubformArrayField.tsx","webpack://grafana/./public/app/features/alerting/unified/components/receivers/form/fields/SubformField.tsx","webpack://grafana/./public/app/features/alerting/unified/components/receivers/form/fields/TemplateContentAndPreview.tsx","webpack://grafana/./public/app/features/alerting/unified/components/receivers/form/fields/TemplateSelector.tsx","webpack://grafana/./public/app/features/alerting/unified/components/receivers/form/fields/OptionField.tsx","webpack://grafana/./public/app/features/alerting/unified/hooks/useControlledFieldArray.ts","webpack://grafana/./public/app/features/alerting/unified/utils/receiver-form.ts"],"sourcesContent":["import { css, cx } from '@emotion/css';\nimport { useState } from 'react';\nimport * as React from 'react';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { IconSize, useStyles2 } from '@grafana/ui';\n\nimport { CollapseToggle } from '../../CollapseToggle';\n\ninterface Props {\n  label: string;\n  description?: string;\n  className?: string;\n  size?: IconSize;\n}\n\nexport const CollapsibleSection = ({\n  label,\n  description,\n  children,\n  className,\n  size = 'xl',\n}: React.PropsWithChildren<Props>) => {\n  const styles = useStyles2(getStyles);\n  const [isCollapsed, setIsCollapsed] = useState(true);\n\n  const toggleCollapse = () => setIsCollapsed(!isCollapsed);\n\n  return (\n    <div className={cx(styles.wrapper, className)}>\n      <CollapseToggle\n        className={styles.toggle}\n        size={size}\n        onToggle={toggleCollapse}\n        isCollapsed={isCollapsed}\n        text={label}\n      />\n      {description && <p className={styles.description}>{description}</p>}\n      <div className={isCollapsed ? styles.hidden : styles.content}>{children}</div>\n    </div>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  wrapper: css({\n    marginTop: theme.spacing(1),\n    paddingBottom: theme.spacing(1),\n  }),\n  toggle: css({\n    margin: theme.spacing(1, 0),\n    padding: 0,\n  }),\n  hidden: css({\n    display: 'none',\n  }),\n  description: css({\n    color: theme.colors.text.secondary,\n    fontSize: theme.typography.size.sm,\n    fontWeight: theme.typography.fontWeightRegular,\n    margin: 0,\n  }),\n  content: css({\n    paddingLeft: theme.spacing(3),\n  }),\n});\n","import { css } from '@emotion/css';\nimport { useEffect, useState } from 'react';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { Button, Input, useStyles2 } from '@grafana/ui';\n\nimport { ActionIcon } from '../../../rules/ActionIcon';\n\ninterface Props {\n  value?: Record<string, string>;\n  readOnly?: boolean;\n  onChange: (value: Record<string, string>) => void;\n}\n\nexport const KeyValueMapInput = ({ value, onChange, readOnly = false }: Props) => {\n  const styles = useStyles2(getStyles);\n  const [pairs, setPairs] = useState(recordToPairs(value));\n  useEffect(() => setPairs(recordToPairs(value)), [value]);\n\n  const emitChange = (pairs: Array<[string, string]>) => {\n    onChange(pairsToRecord(pairs));\n  };\n\n  const deleteItem = (index: number) => {\n    const newPairs = pairs.slice();\n    const removed = newPairs.splice(index, 1)[0];\n    setPairs(newPairs);\n    if (removed[0]) {\n      emitChange(newPairs);\n    }\n  };\n\n  const updatePair = (values: [string, string], index: number) => {\n    const old = pairs[index];\n    const newPairs = pairs.map((pair, i) => (i === index ? values : pair));\n    setPairs(newPairs);\n    if (values[0] || old[0]) {\n      emitChange(newPairs);\n    }\n  };\n\n  return (\n    <div>\n      {!!pairs.length && (\n        <table className={styles.table}>\n          <thead>\n            <tr>\n              <th>Name</th>\n              <th>Value</th>\n              {!readOnly && <th />}\n            </tr>\n          </thead>\n          <tbody>\n            {pairs.map(([key, value], index) => (\n              <tr key={index}>\n                <td>\n                  <Input\n                    readOnly={readOnly}\n                    value={key}\n                    onChange={(e) => updatePair([e.currentTarget.value, value], index)}\n                  />\n                </td>\n                <td>\n                  <Input\n                    readOnly={readOnly}\n                    value={value}\n                    onChange={(e) => updatePair([key, e.currentTarget.value], index)}\n                  />\n                </td>\n                {!readOnly && (\n                  <td>\n                    <ActionIcon icon=\"trash-alt\" tooltip=\"delete\" onClick={() => deleteItem(index)} />\n                  </td>\n                )}\n              </tr>\n            ))}\n          </tbody>\n        </table>\n      )}\n      {!readOnly && (\n        <Button\n          className={styles.addButton}\n          type=\"button\"\n          variant=\"secondary\"\n          icon=\"plus\"\n          size=\"sm\"\n          onClick={() => setPairs([...pairs, ['', '']])}\n        >\n          Add\n        </Button>\n      )}\n    </div>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  addButton: css({\n    marginTop: theme.spacing(1),\n  }),\n  table: css({\n    'tbody td': {\n      padding: `0 ${theme.spacing(1)} ${theme.spacing(1)} 0`,\n    },\n  }),\n});\n\nconst pairsToRecord = (pairs: Array<[string, string]>): Record<string, string> => {\n  const record: Record<string, string> = {};\n  for (const [key, value] of pairs) {\n    if (key) {\n      record[key] = value;\n    }\n  }\n  return record;\n};\n\nconst recordToPairs = (obj?: Record<string, string>): Array<[string, string]> => Object.entries(obj ?? {});\n","import { css } from '@emotion/css';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { Button, Input, useStyles2 } from '@grafana/ui';\n\nimport { ActionIcon } from '../../../rules/ActionIcon';\n\ninterface Props {\n  value?: string[];\n  readOnly?: boolean;\n  onChange: (value: string[]) => void;\n}\n\nexport const StringArrayInput = ({ value, onChange, readOnly = false }: Props) => {\n  const styles = useStyles2(getStyles);\n\n  const deleteItem = (index: number) => {\n    if (!value) {\n      return;\n    }\n    const newValue = value.slice();\n    newValue.splice(index, 1);\n    onChange(newValue);\n  };\n\n  const updateValue = (itemValue: string, index: number) => {\n    if (!value) {\n      return;\n    }\n    onChange(value.map((v, i) => (i === index ? itemValue : v)));\n  };\n\n  return (\n    <div>\n      {!!value?.length &&\n        value.map((v, index) => (\n          <div key={index} className={styles.row}>\n            <Input readOnly={readOnly} value={v} onChange={(e) => updateValue(e.currentTarget.value, index)} />\n            {!readOnly && (\n              <ActionIcon\n                className={styles.deleteIcon}\n                icon=\"trash-alt\"\n                tooltip=\"delete\"\n                onClick={() => deleteItem(index)}\n              />\n            )}\n          </div>\n        ))}\n      {!readOnly && (\n        <Button\n          className={styles.addButton}\n          type=\"button\"\n          variant=\"secondary\"\n          icon=\"plus\"\n          size=\"sm\"\n          onClick={() => onChange([...(value ?? []), ''])}\n        >\n          Add\n        </Button>\n      )}\n    </div>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  row: css({\n    display: 'flex',\n    flexDirection: 'row',\n    marginBottom: theme.spacing(1),\n    alignItems: 'center',\n  }),\n  deleteIcon: css({\n    marginLeft: theme.spacing(1),\n  }),\n  addButton: css({\n    marginTop: theme.spacing(1),\n  }),\n});\n","import { css } from '@emotion/css';\n\nimport { GrafanaTheme2 } from '@grafana/data';\n\nexport const getReceiverFormFieldStyles = (theme: GrafanaTheme2) => ({\n  collapsibleSection: css({\n    margin: 0,\n    padding: 0,\n  }),\n  wrapper: css({\n    margin: theme.spacing(2, 0),\n    padding: theme.spacing(1),\n    border: `solid 1px ${theme.colors.border.medium}`,\n    borderRadius: theme.shape.radius.default,\n    position: 'relative',\n  }),\n  description: css({\n    color: theme.colors.text.secondary,\n    fontSize: theme.typography.size.sm,\n    fontWeight: theme.typography.fontWeightRegular,\n    margin: 0,\n  }),\n  deleteIcon: css({\n    position: 'absolute',\n    right: theme.spacing(1),\n    top: theme.spacing(1),\n  }),\n  addButton: css({\n    marginTop: theme.spacing(1),\n  }),\n});\n","import { DeepMap, FieldError, useFormContext } from 'react-hook-form';\n\nimport { Button, useStyles2 } from '@grafana/ui';\nimport { useControlledFieldArray } from 'app/features/alerting/unified/hooks/useControlledFieldArray';\nimport { NotificationChannelOption } from 'app/types';\n\nimport { ActionIcon } from '../../../rules/ActionIcon';\nimport { CollapsibleSection } from '../CollapsibleSection';\n\nimport { OptionField } from './OptionField';\nimport { getReceiverFormFieldStyles } from './styles';\n\ninterface Props {\n  defaultValues?: any[];\n  option: NotificationChannelOption;\n  pathPrefix: string;\n  errors?: Array<DeepMap<any, FieldError>>;\n  readOnly?: boolean;\n}\n\nexport const SubformArrayField = ({ option, pathPrefix, errors, defaultValues, readOnly = false }: Props) => {\n  const styles = useStyles2(getReceiverFormFieldStyles);\n  const path = `${pathPrefix}${option.propertyName}`;\n  const formAPI = useFormContext();\n  const { fields, append, remove } = useControlledFieldArray({ name: path, formAPI, defaults: defaultValues });\n\n  return (\n    <div className={styles.wrapper}>\n      <CollapsibleSection\n        className={styles.collapsibleSection}\n        label={`${option.label} (${fields.length})`}\n        description={option.description}\n      >\n        {(fields ?? defaultValues ?? []).map((field, itemIndex) => {\n          return (\n            <div key={itemIndex} className={styles.wrapper}>\n              {!readOnly && (\n                <ActionIcon\n                  data-testid={`${path}.${itemIndex}.delete-button`}\n                  icon=\"trash-alt\"\n                  tooltip=\"delete\"\n                  onClick={() => remove(itemIndex)}\n                  className={styles.deleteIcon}\n                />\n              )}\n              {option.subformOptions?.map((option) => (\n                <OptionField\n                  readOnly={readOnly}\n                  defaultValue={field?.[option.propertyName]}\n                  key={option.propertyName}\n                  option={option}\n                  pathPrefix={`${path}.${itemIndex}.`}\n                  error={errors?.[itemIndex]?.[option.propertyName]}\n                />\n              ))}\n            </div>\n          );\n        })}\n        {!readOnly && (\n          <Button\n            data-testid={`${path}.add-button`}\n            className={styles.addButton}\n            type=\"button\"\n            variant=\"secondary\"\n            icon=\"plus\"\n            size=\"sm\"\n            onClick={() => append({ __id: String(Math.random()) })}\n          >\n            Add\n          </Button>\n        )}\n      </CollapsibleSection>\n    </div>\n  );\n};\n","import { useState } from 'react';\nimport { DeepMap, FieldError, useFormContext } from 'react-hook-form';\n\nimport { Button, useStyles2 } from '@grafana/ui';\nimport { NotificationChannelOption, NotificationChannelSecureFields } from 'app/types';\n\nimport { ActionIcon } from '../../../rules/ActionIcon';\n\nimport { OptionField } from './OptionField';\nimport { getReceiverFormFieldStyles } from './styles';\n\ninterface Props {\n  defaultValue: any;\n  option: NotificationChannelOption;\n  pathPrefix: string;\n  errors?: DeepMap<any, FieldError>;\n  readOnly?: boolean;\n  secureFields?: NotificationChannelSecureFields;\n  onResetSecureField?: (propertyName: string) => void;\n}\n\nexport const SubformField = ({\n  option,\n  pathPrefix,\n  errors,\n  defaultValue,\n  readOnly = false,\n  secureFields = {},\n  onResetSecureField,\n}: Props) => {\n  const styles = useStyles2(getReceiverFormFieldStyles);\n  const name = `${pathPrefix}${option.propertyName}`;\n  const { watch } = useFormContext();\n  const _watchValue = watch(name);\n  const value = _watchValue === undefined ? defaultValue : _watchValue;\n\n  const [show, setShow] = useState(!!value);\n\n  return (\n    <div className={styles.wrapper} data-testid={`${name}.container`}>\n      <h6>{option.label}</h6>\n      {option.description && <p className={styles.description}>{option.description}</p>}\n      {show && (\n        <>\n          {!readOnly && (\n            <ActionIcon\n              data-testid={`${name}.delete-button`}\n              icon=\"trash-alt\"\n              tooltip=\"delete\"\n              onClick={() => setShow(false)}\n              className={styles.deleteIcon}\n            />\n          )}\n          {(option.subformOptions ?? []).map((subOption) => {\n            return (\n              <OptionField\n                readOnly={readOnly}\n                secureFields={secureFields}\n                onResetSecureField={onResetSecureField}\n                defaultValue={defaultValue?.[subOption.propertyName]}\n                parentOption={option}\n                key={subOption.propertyName}\n                option={subOption}\n                pathPrefix={`${name}.`}\n                error={errors?.[subOption.propertyName]}\n              />\n            );\n          })}\n        </>\n      )}\n      {!show && !readOnly && (\n        <Button\n          className={styles.addButton}\n          type=\"button\"\n          variant=\"secondary\"\n          icon=\"plus\"\n          size=\"sm\"\n          onClick={() => setShow(true)}\n          data-testid={`${name}.add-button`}\n        >\n          Add\n        </Button>\n      )}\n    </div>\n  );\n};\n","import { css, cx } from '@emotion/css';\nimport * as React from 'react';\nimport AutoSizer from 'react-virtualized-auto-sizer';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { Box, useStyles2 } from '@grafana/ui';\nimport { useAlertmanager } from 'app/features/alerting/unified/state/AlertmanagerContext';\nimport { GRAFANA_RULES_SOURCE_NAME } from 'app/features/alerting/unified/utils/datasource';\n\nimport { EditorColumnHeader } from '../../../contact-points/templates/EditorColumnHeader';\nimport { TemplateEditor } from '../../TemplateEditor';\nimport { getPreviewResults } from '../../TemplatePreview';\nimport { usePreviewTemplate } from '../../usePreviewTemplate';\n\nexport function TemplateContentAndPreview({\n  payload,\n  templateContent,\n  templateName,\n  payloadFormatError,\n  setPayloadFormatError,\n  className,\n}: {\n  payload: string;\n  templateName: string;\n  payloadFormatError: string | null;\n  setPayloadFormatError: (value: React.SetStateAction<string | null>) => void;\n  className?: string;\n  templateContent: string;\n}) {\n  const styles = useStyles2(getStyles);\n\n  const { selectedAlertmanager } = useAlertmanager();\n  const isGrafanaAlertManager = selectedAlertmanager === GRAFANA_RULES_SOURCE_NAME;\n\n  const { data, error } = usePreviewTemplate(templateContent, templateName, payload, setPayloadFormatError);\n  const previewToRender = getPreviewResults(error, payloadFormatError, data);\n\n  const templatePreviewId = 'template-preview';\n\n  return (\n    <div className={cx(className, styles.mainContainer)}>\n      <div className={styles.container}>\n        <EditorColumnHeader label=\"Template content\" />\n        <Box flex={1}>\n          <div className={styles.viewerContainer({ height: 400 })}>\n            <AutoSizer>\n              {({ width, height }) => (\n                <TemplateEditor\n                  value={templateContent}\n                  containerStyles={styles.editorContainer}\n                  width={width}\n                  height={height}\n                  readOnly\n                />\n              )}\n            </AutoSizer>\n          </div>\n        </Box>\n      </div>\n\n      {isGrafanaAlertManager && (\n        <div className={styles.container}>\n          <EditorColumnHeader id={templatePreviewId} label=\"Preview with the default payload\" />\n          <Box flex={1}>\n            <div\n              role=\"presentation\"\n              aria-describedby={templatePreviewId}\n              className={styles.viewerContainer({ height: 'minHeight' })}\n            >\n              {previewToRender}\n            </div>\n          </Box>\n        </div>\n      )}\n    </div>\n  );\n}\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  mainContainer: css({\n    display: 'flex',\n    flexDirection: 'column',\n    gap: theme.spacing(2),\n  }),\n  container: css({\n    label: 'template-preview-container',\n    display: 'flex',\n    flexDirection: 'column',\n    borderRadius: theme.shape.radius.default,\n    border: `1px solid ${theme.colors.border.medium}`,\n  }),\n  viewerContainer: ({ height }: { height: number | string }) =>\n    css({\n      height,\n      overflow: 'auto',\n      backgroundColor: theme.colors.background.primary,\n    }),\n  editorContainer: css({\n    width: 'fit-content',\n    border: 'none',\n  }),\n});\n","import { css, cx } from '@emotion/css';\nimport { PropsWithChildren, useEffect, useMemo, useState } from 'react';\nimport { useFormContext } from 'react-hook-form';\nimport { useCopyToClipboard } from 'react-use';\n\nimport { GrafanaTheme2, SelectableValue } from '@grafana/data';\nimport {\n  Button,\n  Drawer,\n  IconButton,\n  Label,\n  RadioButtonGroup,\n  Select,\n  Stack,\n  Text,\n  TextArea,\n  useStyles2,\n} from '@grafana/ui';\nimport { Trans } from 'app/core/internationalization';\nimport {\n  trackEditInputWithTemplate,\n  trackUseCustomInputInTemplate,\n  trackUseSingleTemplateInInput,\n} from 'app/features/alerting/unified/Analytics';\nimport { templatesApi } from 'app/features/alerting/unified/api/templateApi';\nimport {\n  NotificationTemplate,\n  useNotificationTemplates,\n} from 'app/features/alerting/unified/components/contact-points/useNotificationTemplates';\nimport { useAlertmanager } from 'app/features/alerting/unified/state/AlertmanagerContext';\nimport { NotificationChannelOption } from 'app/types';\n\nimport { defaultPayloadString } from '../../TemplateForm';\n\nimport { TemplateContentAndPreview } from './TemplateContentAndPreview';\nimport { getTemplateName, getUseTemplateText, matchesOnlyOneTemplate, parseTemplates } from './utils';\n\nconst { useGetDefaultTemplatesQuery } = templatesApi;\n\ninterface TemplatesPickerProps {\n  onSelect: (temnplate: string) => void;\n  option: NotificationChannelOption;\n  valueInForm: string;\n}\nexport function TemplatesPicker({ onSelect, option, valueInForm }: TemplatesPickerProps) {\n  const [showTemplates, setShowTemplates] = useState(false);\n  const onClick = () => {\n    setShowTemplates(true);\n    trackEditInputWithTemplate();\n  };\n  const handleClose = () => setShowTemplates(false);\n\n  return (\n    <>\n      <Button\n        icon=\"edit\"\n        tooltip={`Edit ${option.label.toLowerCase()} using existing notification templates.`}\n        onClick={onClick}\n        variant=\"secondary\"\n        size=\"sm\"\n      >\n        {`Edit ${option.label}`}\n      </Button>\n\n      {showTemplates && (\n        <Drawer title={`Edit ${option.label}`} size=\"md\" onClose={handleClose}>\n          <TemplateSelector onSelect={onSelect} onClose={handleClose} option={option} valueInForm={valueInForm} />\n        </Drawer>\n      )}\n    </>\n  );\n}\n\ntype TemplateFieldOption = 'Existing' | 'Custom';\n\nexport function getTemplateOptions(templateFiles: NotificationTemplate[], defaultTemplates: Template[] = []) {\n  // Add default templates\n  const templateMap = new Map<string, SelectableValue<Template>>();\n  templateFiles.forEach(({ content }) => {\n    const templates: Template[] = parseTemplates(content);\n    templates.forEach((template) => {\n      templateMap.set(template.name, {\n        label: template.name,\n        value: {\n          name: template.name,\n          content: template.content,\n        },\n      });\n    });\n  });\n  // Add default templates to the map\n  defaultTemplates.forEach((template) => {\n    templateMap.set(template.name, {\n      label: template.name,\n      value: {\n        name: template.name,\n        content: template.content,\n      },\n    });\n  });\n  // return the sum of default and custom templates\n  return Array.from(templateMap.values());\n}\n\nexport interface Template {\n  name: string;\n  content: string;\n}\ninterface TemplateSelectorProps {\n  onSelect: (template: string) => void;\n  onClose: () => void;\n  option: NotificationChannelOption;\n  valueInForm: string;\n}\n\nfunction TemplateSelector({ onSelect, onClose, option, valueInForm }: TemplateSelectorProps) {\n  const styles = useStyles2(getStyles);\n  const valueInFormIsCustom = Boolean(valueInForm) && !matchesOnlyOneTemplate(valueInForm);\n  const [template, setTemplate] = useState<SelectableValue<Template> | undefined>(undefined);\n  const [customTemplateValue, setCustomTemplateValue] = useState<string>(valueInForm);\n\n  const { selectedAlertmanager } = useAlertmanager();\n  const { data = [], error, isLoading } = useNotificationTemplates({ alertmanager: selectedAlertmanager! });\n  const { data: defaultTemplates } = useGetDefaultTemplatesQuery();\n  const [templateOption, setTemplateOption] = useState<TemplateFieldOption | undefined>(\n    valueInFormIsCustom ? 'Custom' : 'Existing'\n  );\n  const [_, copyToClipboard] = useCopyToClipboard();\n\n  const templateOptions: Array<SelectableValue<TemplateFieldOption>> = [\n    {\n      label: 'Select notification template',\n      ariaLabel: 'Select notification template',\n      value: 'Existing',\n      description: `Select an existing notification template and preview it, or copy it to paste it in the custom tab. ${templateOption === 'Existing' ? 'Clicking Save saves your changes to the selected template.' : ''}`,\n    },\n    {\n      label: `Enter custom ${option.label.toLowerCase()}`,\n      ariaLabel: `Enter custom ${option.label.toLowerCase()}`,\n      value: 'Custom',\n      description: `Enter custom ${option.label.toLowerCase()}. ${templateOption === 'Custom' ? 'Clicking Save will save the custom value only.' : ''}`,\n    },\n  ];\n\n  useEffect(() => {\n    if (template?.value?.name) {\n      setCustomTemplateValue(getUseTemplateText(template.value.name));\n    }\n  }, [template]);\n\n  function onCustomTemplateChange(customInput: string) {\n    setCustomTemplateValue(customInput);\n  }\n\n  const onTemplateOptionChange = (option: TemplateFieldOption) => {\n    setTemplateOption(option);\n  };\n\n  const options = useMemo(() => {\n    if (!defaultTemplates || !data || isLoading || error) {\n      return [];\n    }\n    return getTemplateOptions(data, defaultTemplates);\n  }, [data, defaultTemplates, isLoading, error]);\n\n  const defaultTemplateValue = useMemo(() => {\n    if (!options.length || !Boolean(valueInForm) || !matchesOnlyOneTemplate(valueInForm)) {\n      return null;\n    }\n    const nameOfTemplateInForm = getTemplateName(valueInForm);\n\n    return options.find((option) => option.label === nameOfTemplateInForm) || null;\n  }, [options, valueInForm]);\n\n  if (error) {\n    return <div>Error loading templates</div>;\n  }\n\n  if (isLoading || !data || !defaultTemplates) {\n    return <div>Loading...</div>;\n  }\n\n  return (\n    <Stack direction=\"column\" gap={1} justifyContent=\"space-between\" height=\"100%\">\n      <Stack direction=\"column\" gap={1}>\n        <RadioButtonGroup\n          options={templateOptions}\n          value={templateOption}\n          onChange={onTemplateOptionChange}\n          className={styles.templateTabOption}\n        />\n\n        {templateOption === 'Existing' ? (\n          <Stack direction=\"column\" gap={1}>\n            <Stack direction=\"row\" gap={1} alignItems=\"center\">\n              <Select<Template>\n                data-testid=\"existing-templates-selector\"\n                placeholder=\"Choose notification template\"\n                aria-label=\"Choose notification template\"\n                onChange={(value: SelectableValue<Template>, _) => {\n                  setTemplate(value);\n                }}\n                options={options}\n                width={50}\n                defaultValue={defaultTemplateValue}\n              />\n              <IconButton\n                tooltip=\"Copy selected notification template to clipboard. You can use it in the custom tab.\"\n                onClick={() =>\n                  copyToClipboard(getUseTemplateText(template?.value?.name ?? defaultTemplateValue?.value?.name ?? ''))\n                }\n                name=\"copy\"\n              />\n            </Stack>\n\n            <TemplateContentAndPreview\n              templateContent={template?.value?.content ?? defaultTemplateValue?.value?.content ?? ''}\n              payload={defaultPayloadString}\n              templateName={template?.value?.name ?? defaultTemplateValue?.value?.name ?? ''}\n              setPayloadFormatError={() => {}}\n              className={cx(styles.templatePreview, styles.minEditorSize)}\n              payloadFormatError={null}\n            />\n          </Stack>\n        ) : (\n          <OptionCustomfield\n            option={option}\n            onCustomTemplateChange={onCustomTemplateChange}\n            initialValue={customTemplateValue}\n          />\n        )}\n      </Stack>\n      <div className={styles.actions}>\n        <Button variant=\"secondary\" onClick={onClose}>\n          <Trans i18nKey=\"alerting.common.cancel\">Cancel</Trans>\n        </Button>\n        <Button\n          variant=\"primary\"\n          onClick={() => {\n            if (templateOption === 'Custom') {\n              trackUseCustomInputInTemplate();\n              onSelect(customTemplateValue);\n            } else {\n              trackUseSingleTemplateInInput();\n              const name = template?.value?.name ?? defaultTemplateValue?.value?.name ?? '';\n              onSelect(getUseTemplateText(name));\n            }\n            return onClose();\n          }}\n        >\n          <Trans i18nKey=\"common.save\">Save</Trans>\n        </Button>\n      </div>\n    </Stack>\n  );\n}\n\nfunction OptionCustomfield({\n  option,\n  onCustomTemplateChange,\n  initialValue,\n}: {\n  option: NotificationChannelOption;\n  onCustomTemplateChange(customInput: string): void;\n  initialValue: string;\n}) {\n  const id = `custom-template-${option.label}`;\n  return (\n    <Stack direction=\"column\" gap={1}>\n      <Label htmlFor={id}>\n        <Trans i18nKey=\"alerting.contact-points.custom-template-value\">Custom template value</Trans>\n      </Label>\n      <TextArea\n        id={id}\n        label=\"Custom template\"\n        placeholder={option.placeholder}\n        onChange={(e) => onCustomTemplateChange(e.currentTarget.value)}\n        defaultValue={initialValue}\n      />\n    </Stack>\n  );\n}\n\ninterface WrapWithTemplateSelectionProps extends PropsWithChildren {\n  useTemplates: boolean;\n  onSelectTemplate: (template: string) => void;\n  option: NotificationChannelOption;\n  name: string;\n}\nexport function WrapWithTemplateSelection({\n  useTemplates,\n  onSelectTemplate,\n  option,\n  name,\n  children,\n}: WrapWithTemplateSelectionProps) {\n  const styles = useStyles2(getStyles);\n  const { getValues } = useFormContext();\n  const value = getValues(name) ?? '';\n  // if the placeholder does not contain a template, we don't need to show the template picker\n  if (!option.placeholder.includes('{{ template ') || typeof value !== 'string') {\n    return <>{children}</>;\n  }\n  // Otherwise, we can use templates on this field\n  // if the value is empty, we only show the template picker\n  if (!value) {\n    return (\n      <div className={styles.inputContainer}>\n        <Stack direction=\"row\" gap={1} alignItems=\"center\">\n          {useTemplates && (\n            <TemplatesPicker onSelect={onSelectTemplate} option={option} valueInForm={getValues(name) ?? ''} />\n          )}\n        </Stack>\n      </div>\n    );\n  }\n  const onlyOneTemplate = value ? matchesOnlyOneTemplate(value) : false;\n  if (onlyOneTemplate) {\n    return (\n      <div className={styles.inputContainer}>\n        <Stack direction=\"row\" gap={1} alignItems=\"center\">\n          <Text variant=\"bodySmall\">{`Template: ${getTemplateName(value)}`}</Text>\n          {useTemplates && (\n            <TemplatesPicker onSelect={onSelectTemplate} option={option} valueInForm={getValues(name) ?? ''} />\n          )}\n        </Stack>\n      </div>\n    );\n  }\n  // custom template  field\n  return (\n    <div className={styles.inputContainer}>\n      <Stack direction=\"row\" gap={1} alignItems=\"center\">\n        {children}\n        {useTemplates && (\n          <TemplatesPicker onSelect={onSelectTemplate} option={option} valueInForm={getValues(name) ?? ''} />\n        )}\n      </Stack>\n    </div>\n  );\n}\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  actions: css({\n    flex: 0,\n    justifyContent: 'flex-end',\n    display: 'flex',\n    gap: theme.spacing(1),\n  }),\n  templatePreview: css({\n    flex: 1,\n    display: 'flex',\n  }),\n  templateTabOption: css({\n    width: 'fit-content',\n  }),\n  minEditorSize: css({\n    minHeight: 300,\n    minWidth: 300,\n  }),\n  inputContainer: css({\n    marginTop: theme.spacing(1.5),\n  }),\n});\n","import { css } from '@emotion/css';\nimport { isEmpty } from 'lodash';\nimport { FC, useEffect } from 'react';\nimport { Controller, DeepMap, FieldError, useFormContext } from 'react-hook-form';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport {\n  Checkbox,\n  Field,\n  Input,\n  RadioButtonList,\n  SecretInput,\n  SecretTextArea,\n  Select,\n  TextArea,\n  useStyles2,\n} from '@grafana/ui';\nimport { NotificationChannelOption, NotificationChannelSecureFields } from 'app/types';\n\nimport { KeyValueMapInput } from './KeyValueMapInput';\nimport { StringArrayInput } from './StringArrayInput';\nimport { SubformArrayField } from './SubformArrayField';\nimport { SubformField } from './SubformField';\nimport { WrapWithTemplateSelection } from './TemplateSelector';\n\ninterface Props {\n  defaultValue: any;\n  option: NotificationChannelOption;\n  // this is defined if the option is rendered inside a subform\n  parentOption?: NotificationChannelOption;\n  invalid?: boolean;\n  pathPrefix: string;\n  pathSuffix?: string;\n  error?: FieldError | DeepMap<any, FieldError>;\n  readOnly?: boolean;\n  customValidator?: (value: string) => boolean | string | Promise<boolean | string>;\n  onResetSecureField?: (propertyName: string) => void;\n  secureFields?: NotificationChannelSecureFields;\n}\n\nexport const OptionField: FC<Props> = ({\n  option,\n  parentOption,\n  invalid,\n  pathPrefix,\n  pathSuffix = '',\n  error,\n  defaultValue,\n  readOnly = false,\n  customValidator,\n  onResetSecureField,\n  secureFields = {},\n}) => {\n  const optionPath = `${pathPrefix}${pathSuffix}`;\n\n  if (option.element === 'subform') {\n    return (\n      <SubformField\n        secureFields={secureFields}\n        onResetSecureField={onResetSecureField}\n        readOnly={readOnly}\n        defaultValue={defaultValue}\n        option={option}\n        errors={error}\n        pathPrefix={optionPath}\n      />\n    );\n  }\n  if (option.element === 'subform_array') {\n    return (\n      <SubformArrayField\n        readOnly={readOnly}\n        defaultValues={defaultValue}\n        option={option}\n        pathPrefix={optionPath}\n        errors={error as Array<DeepMap<any, FieldError>> | undefined}\n      />\n    );\n  }\n  return (\n    <Field\n      label={option.element !== 'checkbox' && option.element !== 'radio' ? option.label : undefined}\n      description={option.description || undefined}\n      invalid={!!error}\n      error={error?.message}\n      data-testid={`${optionPath}${option.propertyName}`}\n    >\n      <OptionInput\n        id={`${optionPath}${option.propertyName}`}\n        defaultValue={defaultValue}\n        option={option}\n        invalid={invalid}\n        pathPrefix={optionPath}\n        readOnly={readOnly}\n        pathIndex={pathPrefix}\n        parentOption={parentOption}\n        customValidator={customValidator}\n        onResetSecureField={onResetSecureField}\n        secureFields={secureFields}\n      />\n    </Field>\n  );\n};\n\nconst OptionInput: FC<Props & { id: string; pathIndex?: string }> = ({\n  option,\n  invalid,\n  id,\n  pathPrefix = '',\n  pathIndex = '',\n  readOnly = false,\n  customValidator,\n  onResetSecureField,\n  secureFields = {},\n  parentOption,\n}) => {\n  const styles = useStyles2(getStyles);\n  const { control, register, unregister, getValues, setValue } = useFormContext();\n\n  const name = `${pathPrefix}${option.propertyName}`;\n  const nestedKey = parentOption ? `${parentOption.propertyName}.${option.propertyName}` : option.propertyName;\n\n  const isEncryptedInput = secureFields?.[nestedKey];\n\n  // workaround for https://github.com/react-hook-form/react-hook-form/issues/4993#issuecomment-829012506\n  useEffect(\n    () => () => {\n      unregister(name, { keepValue: false });\n    },\n    [unregister, name]\n  );\n\n  const useTemplates = option.placeholder.includes('{{ template');\n\n  function onSelectTemplate(template: string) {\n    setValue(name, template);\n  }\n\n  switch (option.element) {\n    case 'checkbox':\n      return (\n        <Checkbox\n          id={id}\n          readOnly={readOnly}\n          disabled={readOnly}\n          className={styles.checkbox}\n          {...register(name)}\n          label={option.label}\n          description={option.description}\n        />\n      );\n    case 'input':\n      return (\n        <WrapWithTemplateSelection\n          useTemplates={useTemplates}\n          option={option}\n          name={name}\n          onSelectTemplate={onSelectTemplate}\n        >\n          {isEncryptedInput ? (\n            <SecretInput onReset={() => onResetSecureField?.(nestedKey)} isConfigured />\n          ) : (\n            <Input\n              id={id}\n              readOnly={readOnly || useTemplates || determineReadOnly(option, getValues, pathIndex)}\n              invalid={invalid}\n              type={option.inputType}\n              {...register(name, {\n                required: determineRequired(option, getValues, pathIndex),\n                validate: {\n                  validationRule: (v) =>\n                    option.validationRule ? validateOption(v, option.validationRule, option.required) : true,\n                  customValidator: (v) => (customValidator ? customValidator(v) : true),\n                },\n                setValueAs: option.setValueAs,\n              })}\n              placeholder={option.placeholder}\n            />\n          )}\n        </WrapWithTemplateSelection>\n      );\n\n    case 'select':\n      return (\n        <Controller\n          render={({ field: { onChange, ref, ...field } }) => (\n            <Select\n              disabled={readOnly}\n              options={option.selectOptions ?? undefined}\n              invalid={invalid}\n              onChange={(value) => onChange(value.value)}\n              {...field}\n            />\n          )}\n          control={control}\n          name={name}\n          defaultValue={option.defaultValue?.value}\n          rules={{\n            validate: {\n              customValidator: (v) => (customValidator ? customValidator(v) : true),\n            },\n          }}\n        />\n      );\n    case 'radio':\n      return (\n        <>\n          <legend className={styles.legend}>{option.label}</legend>\n          <Controller\n            render={({ field: { ref, ...field } }) => (\n              <RadioButtonList disabled={readOnly} options={option.selectOptions ?? []} {...field} />\n            )}\n            control={control}\n            defaultValue={option.defaultValue?.value}\n            name={name}\n            rules={{\n              required: option.required ? 'Option is required' : false,\n              validate: {\n                validationRule: (v) =>\n                  option.validationRule ? validateOption(v, option.validationRule, option.required) : true,\n                customValidator: (v) => (customValidator ? customValidator(v) : true),\n              },\n            }}\n          />\n        </>\n      );\n    case 'textarea':\n      return (\n        <WrapWithTemplateSelection\n          useTemplates={useTemplates}\n          option={option}\n          name={name}\n          onSelectTemplate={onSelectTemplate}\n        >\n          {isEncryptedInput ? (\n            <SecretTextArea onReset={() => onResetSecureField?.(nestedKey)} isConfigured />\n          ) : (\n            <TextArea\n              id={id}\n              readOnly={readOnly || useTemplates}\n              invalid={invalid}\n              placeholder={option.placeholder}\n              {...register(name, {\n                required: option.required ? 'Required' : false,\n                validate: (v) =>\n                  option.validationRule !== '' ? validateOption(v, option.validationRule, option.required) : true,\n              })}\n            />\n          )}\n        </WrapWithTemplateSelection>\n      );\n    case 'string_array':\n      return (\n        <Controller\n          render={({ field: { value, onChange } }) => (\n            <StringArrayInput readOnly={readOnly} value={value} onChange={onChange} />\n          )}\n          control={control}\n          name={name}\n        />\n      );\n    case 'key_value_map':\n      return (\n        <Controller\n          render={({ field: { value, onChange } }) => (\n            <KeyValueMapInput readOnly={readOnly} value={value} onChange={onChange} />\n          )}\n          control={control}\n          name={name}\n        />\n      );\n\n    default:\n      console.error('Element not supported', option.element);\n      return null;\n  }\n};\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  checkbox: css({\n    height: 'auto', // native checkbox has fixed height which does not take into account description\n  }),\n  legend: css({\n    fontSize: theme.typography.h6.fontSize,\n  }),\n});\n\nconst validateOption = (value: string, validationRule: string, required: boolean) => {\n  if (value === '' && !required) {\n    return true;\n  }\n\n  return RegExp(validationRule).test(value) ? true : 'Invalid format';\n};\n\nconst determineRequired = (option: NotificationChannelOption, getValues: any, pathIndex: string) => {\n  const secureFields = getValues(`${pathIndex}secureFields`);\n  const secureSettings = getValues(`${pathIndex}secureSettings`);\n\n  if (!option.dependsOn) {\n    return option.required ? 'Required' : false;\n  }\n  if (isEmpty(secureFields) || !secureFields[option.dependsOn]) {\n    const dependentOn = Boolean(secureSettings[option.dependsOn]);\n    return !dependentOn && option.required ? 'Required' : false;\n  } else {\n    const dependentOn = Boolean(secureFields[option.dependsOn]);\n    return !dependentOn && option.required ? 'Required' : false;\n  }\n};\n\nconst determineReadOnly = (option: NotificationChannelOption, getValues: any, pathIndex: string) => {\n  if (!option.dependsOn) {\n    return false;\n  }\n  if (isEmpty(getValues(`${pathIndex}secureFields`))) {\n    return getValues(`${pathIndex}secureSettings.${option.dependsOn}`);\n  } else {\n    return getValues(`${pathIndex}secureFields.${option.dependsOn}`);\n  }\n};\n","import { set } from 'lodash';\nimport { useCallback } from 'react';\nimport { UseFormReturn } from 'react-hook-form';\n\ninterface Options<R> {\n  name: string;\n  formAPI: UseFormReturn<any>;\n  defaults?: R[];\n\n  // if true, sets `__deleted: true` but does not remove item from the array in values\n  softDelete?: boolean;\n}\n\nexport type ControlledField<R> = R & {\n  __deleted?: boolean;\n};\n\nconst EMPTY_ARRAY = [] as const;\n\n/*\n * react-hook-form's own useFieldArray is uncontrolled and super buggy.\n * this is a simple controlled version. It's dead simple and more robust at the cost of re-rendering the form\n * on every change to the sub forms in the array.\n * Warning: you'll have to take care of your own unique identiifer to use as `key` for the ReactNode array.\n * Using index will cause problems.\n */\nexport function useControlledFieldArray<R>(options: Options<R>) {\n  const { name, formAPI, defaults, softDelete } = options;\n  const { watch, getValues, reset, setValue } = formAPI;\n\n  const fields: Array<ControlledField<R>> = watch(name) ?? defaults ?? EMPTY_ARRAY;\n\n  const update = useCallback(\n    (updateFn: (fields: R[]) => R[]) => {\n      const values = JSON.parse(JSON.stringify(getValues()));\n      const newItems = updateFn(fields ?? []);\n      reset(set(values, name, newItems));\n    },\n    [getValues, name, reset, fields]\n  );\n\n  return {\n    fields,\n    append: useCallback((values: R) => update((fields) => [...fields, values]), [update]),\n    remove: useCallback(\n      (index: number) => {\n        if (softDelete) {\n          setValue(`${name}.${index}.__deleted`, true);\n        } else {\n          update((items) => {\n            const newItems = items.slice();\n            newItems.splice(index, 1);\n            return newItems;\n          });\n        }\n      },\n      [update, name, setValue, softDelete]\n    ),\n  };\n}\n","import { get, has, isArray, isNil, omit, omitBy, reduce } from 'lodash';\n\nimport {\n  AlertmanagerReceiver,\n  GrafanaManagedContactPoint,\n  GrafanaManagedReceiverConfig,\n  Receiver,\n} from 'app/plugins/datasource/alertmanager/types';\nimport { CloudNotifierType, NotificationChannelOption, NotifierDTO, NotifierType } from 'app/types';\n\nimport {\n  CloudChannelConfig,\n  CloudChannelMap,\n  CloudChannelValues,\n  GrafanaChannelMap,\n  GrafanaChannelValues,\n  ReceiverFormValues,\n} from '../types/receiver-form';\n\nexport function grafanaReceiverToFormValues(\n  receiver: GrafanaManagedContactPoint,\n  notifiers: NotifierDTO[]\n): [ReceiverFormValues<GrafanaChannelValues>, GrafanaChannelMap] {\n  const channelMap: GrafanaChannelMap = {};\n  // giving each form receiver item a unique id so we can use it to map back to \"original\" items\n  // as well as to use as `key` prop.\n  // @TODO use uid once backend is fixed to provide it. then we can get rid of the GrafanaChannelMap\n  let idCounter = 1;\n  const values = {\n    name: receiver.name,\n    items:\n      receiver.grafana_managed_receiver_configs?.map((channel) => {\n        const id = String(idCounter++);\n        channelMap[id] = channel;\n        const notifier = notifiers.find(({ type }) => type === channel.type);\n        return grafanaChannelConfigToFormChannelValues(id, channel, notifier);\n      }) ?? [],\n  };\n  return [values, channelMap];\n}\n\nexport function cloudReceiverToFormValues(\n  receiver: Receiver,\n  notifiers: NotifierDTO[]\n): [ReceiverFormValues<CloudChannelValues>, CloudChannelMap] {\n  const channelMap: CloudChannelMap = {};\n  // giving each form receiver item a unique id so we can use it to map back to \"original\" items\n  let idCounter = 1;\n  const items: CloudChannelValues[] = Object.entries(receiver)\n    // filter out only config items that are relevant to cloud\n    .filter(([type]) => type.endsWith('_configs') && type !== 'grafana_managed_receiver_configs')\n    // map property names to cloud notifier types by removing the `_config` suffix\n    .map(([type, configs]): [CloudNotifierType, CloudChannelConfig[]] => [\n      type.replace('_configs', '') as CloudNotifierType,\n      configs,\n    ])\n    // convert channel configs to form values\n    .map(([type, configs]) =>\n      configs.map((config) => {\n        const id = String(idCounter++);\n        channelMap[id] = { type, config };\n        const notifier = notifiers.find((notifier) => notifier.type === type);\n        if (!notifier) {\n          throw new Error(`unknown cloud notifier: ${type}`);\n        }\n        return cloudChannelConfigToFormChannelValues(id, type, config);\n      })\n    )\n    .flat();\n  const values = {\n    name: receiver.name,\n    items,\n  };\n  return [values, channelMap];\n}\n\nexport function formValuesToGrafanaReceiver(\n  values: ReceiverFormValues<GrafanaChannelValues>,\n  channelMap: GrafanaChannelMap,\n  defaultChannelValues: GrafanaChannelValues,\n  notifiers: NotifierDTO[]\n): Receiver {\n  return {\n    name: values.name,\n    grafana_managed_receiver_configs: (values.items ?? []).map((channelValues) => {\n      const existing: GrafanaManagedReceiverConfig | undefined = channelMap[channelValues.__id];\n      const notifier = notifiers.find((notifier) => notifier.type === channelValues.type);\n\n      return formChannelValuesToGrafanaChannelConfig(\n        channelValues,\n        defaultChannelValues,\n        values.name,\n        existing,\n        notifier\n      );\n    }),\n  };\n}\n\nexport function formValuesToCloudReceiver(\n  values: ReceiverFormValues<CloudChannelValues>,\n  defaults: CloudChannelValues\n): Receiver {\n  const recv: AlertmanagerReceiver = {\n    name: values.name,\n  };\n  values.items.forEach(({ __id, type, settings, sendResolved }) => {\n    const channelWithOmmitedIdentifiers = omitEmptyValues({\n      ...omitTemporaryIdentifiers(settings),\n      send_resolved: sendResolved ?? defaults.sendResolved,\n    });\n\n    const channel =\n      type === 'jira' ? convertJiraFieldToJson(channelWithOmmitedIdentifiers) : channelWithOmmitedIdentifiers;\n\n    if (!(`${type}_configs` in recv)) {\n      recv[`${type}_configs`] = [channel];\n    } else {\n      recv[`${type}_configs`]?.push(channel);\n    }\n  });\n  return recv;\n}\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport function convertJiraFieldToJson(object: Record<string, any>) {\n  // Only for cloud alert manager. Jira fields option can be a nested object. We need to convert it to JSON.\n\n  const objectCopy = structuredClone(object);\n\n  if (typeof objectCopy.fields === 'object') {\n    for (const [optionName, optionValue] of Object.entries(objectCopy.fields)) {\n      let valueForField;\n      try {\n        // eslint-disable-next-line\n        valueForField = JSON.parse(optionValue as string); // is a stringified object\n      } catch {\n        valueForField = optionValue; // is not a stringified object\n      }\n      objectCopy.fields[optionName] = valueForField;\n    }\n  }\n\n  return objectCopy;\n}\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport function convertJsonToJiraField(object: Record<string, any>) {\n  // Only for cloud alert manager. Convert JSON back to nested Jira fields option.\n\n  const objectCopy = structuredClone(object);\n\n  if (typeof objectCopy.fields === 'object') {\n    for (const [optionName, optionValue] of Object.entries(objectCopy.fields)) {\n      let valueForField;\n      if (typeof optionValue === 'object') {\n        valueForField = JSON.stringify(optionValue);\n      } else {\n        valueForField = optionValue;\n      }\n      objectCopy.fields[optionName] = valueForField;\n    }\n  }\n\n  return objectCopy;\n}\n\nfunction cloudChannelConfigToFormChannelValues(\n  id: string,\n  type: CloudNotifierType,\n  channel: CloudChannelConfig\n): CloudChannelValues {\n  return {\n    __id: id,\n    type,\n    settings: {\n      ...(type === 'jira' ? convertJsonToJiraField(channel) : channel),\n    },\n    secureFields: {},\n    secureSettings: {},\n    sendResolved: channel.send_resolved,\n  };\n}\n\nfunction grafanaChannelConfigToFormChannelValues(\n  id: string,\n  channel: GrafanaManagedReceiverConfig,\n  notifier?: NotifierDTO\n): GrafanaChannelValues {\n  const values: GrafanaChannelValues = {\n    __id: id,\n    type: channel.type as NotifierType,\n    provenance: channel.provenance,\n    secureSettings: {},\n    settings: { ...channel.settings },\n    secureFields: { ...channel.secureFields },\n    disableResolveMessage: channel.disableResolveMessage,\n  };\n\n  notifier?.options.forEach((option) => {\n    if (option.secure && values.settings[option.propertyName]) {\n      values.secureSettings[option.propertyName] = values.settings[option.propertyName];\n      delete values.settings[option.propertyName];\n    }\n  });\n\n  return values;\n}\n\n/**\n * Recursively find all keys that should be marked a secure fields, using JSONpath for nested fields.\n */\nexport function getSecureFieldNames(notifier: NotifierDTO): string[] {\n  // eg. ['foo', 'bar.baz']\n  const secureFieldPaths: string[] = [];\n\n  // we'll pass in the prefix for each iteration so we can track the JSON path\n  function findSecureOptions(options: NotificationChannelOption[], prefix?: string) {\n    for (const option of options) {\n      const key = prefix ? `${prefix}.${option.propertyName}` : option.propertyName;\n\n      // if the field is a subform, recurse\n      if (option.subformOptions) {\n        findSecureOptions(option.subformOptions, key);\n        continue;\n      }\n\n      if (option.secure) {\n        secureFieldPaths.push(key);\n        continue;\n      }\n    }\n  }\n\n  findSecureOptions(notifier.options);\n\n  return secureFieldPaths;\n}\n\nexport function formChannelValuesToGrafanaChannelConfig(\n  values: GrafanaChannelValues,\n  defaults: GrafanaChannelValues,\n  name: string,\n  existing?: GrafanaManagedReceiverConfig,\n  notifier?: NotifierDTO\n): GrafanaManagedReceiverConfig {\n  const channel: GrafanaManagedReceiverConfig = {\n    settings: omitEmptyValues({\n      ...(existing && existing.type === values.type ? (existing.settings ?? {}) : {}),\n      ...(values.settings ?? {}),\n    }),\n    secureSettings: omitEmptyUnlessExisting(values.secureSettings, existing?.secureFields),\n    type: values.type,\n    name,\n    disableResolveMessage:\n      values.disableResolveMessage ?? existing?.disableResolveMessage ?? defaults.disableResolveMessage,\n  };\n\n  // find all secure field definitions\n  const secureFieldNames = notifier ? getSecureFieldNames(notifier) : [];\n\n  // we make sure all fields that are marked as \"secure\" will be moved to \"SecureSettings\" instead of \"settings\"\n  const secureSettings = reduce(\n    secureFieldNames,\n    (acc: Record<string, unknown> = {}, key) => {\n      // the value for secure settings can come from either the \"settings\" (accidental) or \"secureFields\" if editing an existing receiver\n      acc[key] = get(channel.settings, key) ?? get(values.secureFields, key);\n      return acc;\n    },\n    {}\n  );\n\n  channel.secureSettings = {\n    ...secureSettings,\n    ...channel.secureSettings,\n  };\n\n  // remove the secure ones from the regular settings\n  channel.settings = omit(channel.settings, secureFieldNames);\n\n  if (existing) {\n    channel.uid = existing.uid;\n  }\n\n  return channel;\n}\n\n// null, undefined and '' are deemed unacceptable\nconst isUnacceptableValue = (value: unknown) => isNil(value) || value === '';\n\n// will remove properties that have empty ('', null, undefined) object properties.\n// traverses nested objects and arrays as well. in place, mutates the object.\n// this is needed because form will submit empty string for not filled in fields,\n// but for cloud alertmanager receiver config to use global default value the property must be omitted entirely\n// this isn't a perfect solution though. No way for user to intentionally provide an empty string. Will need rethinking later\nexport function omitEmptyValues<T>(obj: T): T {\n  if (isArray(obj)) {\n    obj.forEach(omitEmptyValues);\n  } else if (typeof obj === 'object' && obj !== null) {\n    Object.entries(obj).forEach(([key, value]) => {\n      if (isUnacceptableValue(value)) {\n        delete (obj as any)[key];\n      } else {\n        omitEmptyValues(value);\n      }\n    });\n  }\n  return obj;\n}\n\n// Will remove empty ('', null, undefined) object properties unless they were previously defined.\n// existing is a map of property names that were previously defined.\nexport function omitEmptyUnlessExisting(settings = {}, existing = {}): Record<string, unknown> {\n  return omitBy(settings, (value, key) => isUnacceptableValue(value) && !has(existing, key));\n}\n\nexport function omitTemporaryIdentifiers<T>(object: Readonly<T>): T {\n  function omitIdentifiers<T>(obj: T) {\n    if (isArray(obj)) {\n      obj.forEach(omitIdentifiers);\n    } else if (typeof obj === 'object' && obj !== null) {\n      if ('__id' in obj) {\n        delete obj.__id;\n      }\n      Object.values(obj).forEach(omitIdentifiers);\n    }\n  }\n\n  const objectCopy = structuredClone(object);\n  omitIdentifiers(objectCopy);\n\n  return objectCopy;\n}\n"],"names":["CollapsibleSection","label","description","children","className","size","styles","getStyles","isCollapsed","setIsCollapsed","toggleCollapse","theme","KeyValueMapInput","value","onChange","readOnly","pairs","setPairs","recordToPairs","emitChange","pairsToRecord","deleteItem","index","newPairs","removed","updatePair","values","old","pair","i","key","Input","e","ActionIcon","Button","record","obj","StringArrayInput","newValue","updateValue","itemValue","v","getReceiverFormFieldStyles","SubformArrayField","option","pathPrefix","errors","defaultValues","path","formAPI","fields","append","remove","useControlledFieldArray","field","itemIndex","OptionField","SubformField","defaultValue","secureFields","onResetSecureField","name","watch","_watchValue","show","setShow","subOption","TemplateContentAndPreview","payload","templateContent","templateName","payloadFormatError","setPayloadFormatError","selectedAlertmanager","isGrafanaAlertManager","data","error","usePreviewTemplate","previewToRender","templatePreviewId","EditorColumnHeader","Box","width","height","TemplateEditor","useGetDefaultTemplatesQuery","TemplatesPicker","onSelect","valueInForm","showTemplates","setShowTemplates","onClick","handleClose","Drawer","TemplateSelector","getTemplateOptions","templateFiles","defaultTemplates","templateMap","content","template","onClose","valueInFormIsCustom","setTemplate","customTemplateValue","setCustomTemplateValue","isLoading","useNotificationTemplates","templateOption","setTemplateOption","_","copyToClipboard","useCopyToClipboard","templateOptions","onCustomTemplateChange","customInput","onTemplateOptionChange","options","defaultTemplateValue","nameOfTemplateInForm","Stack","RadioButtonGroup","Select","IconButton","OptionCustomfield","initialValue","id","Label","TextArea","WrapWithTemplateSelection","useTemplates","onSelectTemplate","getValues","Text","parentOption","invalid","pathSuffix","customValidator","optionPath","Field","OptionInput","pathIndex","control","register","unregister","setValue","nestedKey","isEncryptedInput","Checkbox","SecretInput","determineReadOnly","determineRequired","validateOption","ref","RadioButtonList","SecretTextArea","validationRule","required","secureSettings","EMPTY_ARRAY","defaults","softDelete","reset","update","updateFn","newItems","items","grafanaReceiverToFormValues","receiver","notifiers","channelMap","idCounter","channel","notifier","type","grafanaChannelConfigToFormChannelValues","cloudReceiverToFormValues","configs","config","cloudChannelConfigToFormChannelValues","formValuesToGrafanaReceiver","defaultChannelValues","channelValues","existing","formChannelValuesToGrafanaChannelConfig","formValuesToCloudReceiver","recv","__id","settings","sendResolved","channelWithOmmitedIdentifiers","omitEmptyValues","omitTemporaryIdentifiers","convertJiraFieldToJson","object","objectCopy","optionName","optionValue","valueForField","convertJsonToJiraField","getSecureFieldNames","secureFieldPaths","findSecureOptions","prefix","omitEmptyUnlessExisting","secureFieldNames","acc","isUnacceptableValue","omitIdentifiers"],"sourceRoot":""}