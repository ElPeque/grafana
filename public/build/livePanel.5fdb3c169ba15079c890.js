"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[5413],{24520:(w,N,t)=>{t.d(N,{X:()=>y,k:()=>o});var v=t(47286),n=t(52718),E=t(63739),M=t(84099),f=t(28082),S=t(87638),R=t(65874),I=t(35874);const o=(m,C,P,A,e,i)=>!e||e.length===0?[]:e.map(u=>{const d=(0,v.vd)(m,C,P),l={...P,__dataContext:d},b=(x,g,j)=>A(x,{...l,...g},j);i.valueRowIndex!==void 0&&!isNaN(i.valueRowIndex)?d.value.rowIndex=i.valueRowIndex:d.value.calculatedValue=i.calculatedValue;const T=A(u.title,l),h=A(u.confirmation||`Are you sure you want to ${u.title}?`,l);return{title:T,confirmation:h,onClick:(x,g)=>{F(u,b)},oneClick:u.oneClick??!1}}).filter(u=>!!u),F=(m,C)=>{try{const P=new URL(K(C(m.fetch.url))),A={};let e={url:P.toString(),method:m.fetch.method,data:J(m,C),headers:A};m.fetch.headers&&m.fetch.headers.forEach(([i,c])=>{A[C(i)]=C(c)}),m.fetch.queryParams&&(m.fetch.queryParams?.forEach(([i,c])=>{P.searchParams.append(C(i),C(c))}),e.url=P.toString()),A["X-Grafana-Action"]="1",e.headers=A,(0,f.AI)().fetch(e).subscribe({error:i=>{S.lE.emit(n.r1.alertError,["An error has occurred. Check console output for more details."]),console.error(i)},complete:()=>{S.lE.emit(n.r1.alertSuccess,["API call was successful"])}})}catch(P){S.lE.emit(n.r1.alertError,["An error has occurred. Check console output for more details."]),console.error(P);return}},y=(m=[],C=[])=>({name:"Default field",type:E.PU.string,config:{links:m,actions:C},values:[]}),K=m=>{if(m.startsWith("/")){const P=M.sQ.sanitizeUrl(m);m=(0,I.z)(P,[])}return m},J=(m,C)=>{let P=m.fetch.body?C(m.fetch.body):"{}";return m.fetch.method===R.DO.GET&&(P=void 0),P}},92946:(w,N,t)=>{t.d(N,{l:()=>E});var v=t(26701),n=t(28082);async function E(){return(0,n.AI)().get("api/live/list").then(M=>{const f=M.channels??[],S={},R=f.map(I=>{if(I.data){const o=new Set,F=(0,v.or)(I.data);for(const y of F.fields)o.add(y.name);S[I.channel]=Array.from(o).map(y=>({value:y,label:y}))}return{value:I.channel,label:I.channel+" ["+I.minute_rate+" msg/min]"}});return{channelFields:S,channels:R}})}},65874:(w,N,t)=>{t.d(N,{DO:()=>M,en:()=>v,gR:()=>n,xp:()=>E});var v=(o=>(o.Center="center",o.Left="left",o.LeftRight="leftright",o.Right="right",o.Scale="scale",o))(v||{}),n=(o=>(o.Bottom="bottom",o.Center="center",o.Scale="scale",o.Top="top",o.TopBottom="topbottom",o))(n||{}),E=(o=>(o.Contain="contain",o.Cover="cover",o.Fill="fill",o.Original="original",o.Tile="tile",o))(E||{}),M=(o=>(o.GET="GET",o.POST="POST",o.PUT="PUT",o))(M||{}),f=(o=>(o.Straight="straight",o))(f||{});const S={vertices:[]},R={connections:[]},I={infinitePan:!0,inlineEditing:!0,panZoom:!0,showAdvancedTypes:!0}},13765:(w,N,t)=>{t.r(N),t.d(N,{plugin:()=>H});var v=t(68256),n=t(74848),E=t(22803),M=t(96540),f=t(17162),S=t(37e3),R=t(40271),I=t(44826),o=t(90617),F=t(88023),y=t(92946);const K=[{label:"Grafana",value:f.qD.Grafana,description:"Core grafana live features"},{label:"Data Sources",value:f.qD.DataSource,description:"Data sources with live support"},{label:"Plugins",value:f.qD.Plugin,description:"Plugins with live support"},{label:"Stream",value:f.qD.Stream,description:"data streams (eg, influx style)"}];function J(a){const[r,s]=(0,M.useState)([]),[p,B]=(0,M.useMemo)(()=>{const D=[],V=[],X=a.value.scope,Y=a.value.namespace;if(!X?.length)return[D,V];const k={};for(let q of r){const $=(0,f.DG)(q.value);!$||$.scope!==X||(k[$.namespace]||(D.push({value:$.namespace,label:$.namespace}),k[$.namespace]=!0),Y?.length&&Y===$.namespace&&V.push({...q,value:$.path}))}return[D,V]},[r,a.value.scope,a.value.namespace]);(0,M.useEffect)(()=>{(0,y.l)().then(D=>{s(D.channels)})},[a.value.scope]);const U=D=>{D.value&&a.onChange({scope:D.value,namespace:void 0,path:void 0})},_=D=>{a.onChange({scope:a.value?.scope,namespace:D?.value,path:void 0})},Z=D=>{const{value:V,onChange:X}=a;X({scope:V.scope,namespace:V.namespace,path:D?.value})},{scope:O,namespace:W,path:ee}=a.value,Q=C(F.$W.theme2);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(S.F,{title:"Grafana Live",severity:"info",children:"This supports real-time event streams in grafana core. This feature is under heavy development. Expect the intefaces and structures to change as this becomes more production ready."}),(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{className:Q.dropWrap,children:[(0,n.jsx)(R.J,{children:"Scope"}),(0,n.jsx)(I.l6,{options:K,value:K.find(D=>D.value===O),onChange:U})]}),O&&(0,n.jsxs)("div",{className:Q.dropWrap,children:[(0,n.jsx)(R.J,{children:"Namespace"}),(0,n.jsx)(I.l6,{options:p,value:p.find(D=>D.value===W)??(W?{label:W,value:W}:void 0),onChange:_,allowCustomValue:!0,backspaceRemovesValue:!0,isClearable:!0})]}),O&&W&&(0,n.jsxs)("div",{className:Q.dropWrap,children:[(0,n.jsx)(R.J,{children:"Path"}),(0,n.jsx)(I.l6,{options:B,value:m(B,ee),onChange:Z,allowCustomValue:!0,backspaceRemovesValue:!0,isClearable:!0})]})]})]})}function m(a,r){const s=a.find(p=>p.value===r);if(s)return s;if(r)return{label:r,value:r}}const C=(0,o.N)(a=>({dropWrap:(0,E.css)({marginBottom:a.spacing(1)})}));var P=t(2543),A=t(59765),e=t(47286),i=t(8392),c=t(32370),u=t(37633),d=t(67676),l=t(67893),b=t(88464),T=t(28082),h=t(3886),L=t(54594),x=(a=>(a.Raw="raw",a.JSON="json",a.Auto="auto",a.None="none",a))(x||{}),g=(a=>(a.None="none",a.JSON="json",a.Influx="influx",a))(g||{});function j({height:a,mode:r,body:s,addr:p,onSave:B}){const U=(0,M.useMemo)(()=>r===g.JSON?s?JSON.stringify(s,null,2):"{ }":s==null?"":`${s}`,[r,s]),_=O=>{r===g.JSON?B(JSON.parse(O)):B(O)},Z=async()=>{if(r===g.Influx){if(p?.scope!=="stream"){alert("expected stream scope!");return}return(0,T.AI)().post(`api/live/push/${p.namespace}`,s)}if(!(0,f.aj)(p)){alert("invalid address");return}const O=await(0,u.oF)().publish(p,s);console.log("onPublishClicked (response from publish)",O)};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(h.B,{height:a-32,language:r===g.JSON?"json":"text",value:U,onBlur:_,onSave:_,showMiniMap:!1,showLineNumbers:!0}),(0,n.jsx)("div",{style:{height:32},children:(0,n.jsx)(L.$n,{onClick:Z,children:"Publish"})})]})}class G extends M.PureComponent{constructor(r){super(r),this.styles=z(c.$.theme2),this.streamObserver={next:s=>{(0,f.ew)(s)?this.setState({status:s,changed:Date.now()}):(0,f.Z7)(s)?this.setState({message:s.message,changed:Date.now()}):console.log("ignore",s)}},this.unsubscribe=()=>{this.subscription&&(this.subscription.unsubscribe(),this.subscription=void 0)},this.isValid=!!(0,u.oF)(),this.state={changed:0}}async componentDidMount(){this.loadChannel()}componentWillUnmount(){this.subscription&&this.subscription.unsubscribe()}componentDidUpdate(r){this.props.options?.channel!==r.options?.channel&&this.loadChannel()}async loadChannel(){const r=this.props.options?.channel;if(!(0,f.aj)(r)){console.log("INVALID",r),this.unsubscribe(),this.setState({addr:void 0});return}if((0,P.isEqual)(r,this.state.addr)){console.log("Same channel",this.state.addr);return}const s=(0,u.oF)();if(!s){console.log("INVALID",r),this.unsubscribe(),this.setState({addr:void 0});return}this.unsubscribe(),console.log("LOAD",r);try{this.subscription=s.getStream(r).subscribe(this.streamObserver),this.setState({addr:r,error:void 0})}catch(p){this.setState({addr:void 0,error:p})}}renderNotEnabled(){return(0,n.jsxs)(S.F,{title:"Grafana Live",severity:"info",children:[(0,n.jsx)("p",{children:"Grafana live requires a feature flag to run"}),(0,n.jsx)("b",{children:"custom.ini:"}),(0,n.jsx)("pre",{children:`[feature_toggles]
    enable = live`})]})}renderMessage(r){const{options:s}=this.props,{message:p}=this.state;if(!p)return(0,n.jsxs)("div",{children:[(0,n.jsx)("h4",{children:"Waiting for data:"}),s.channel?.scope,"/",s.channel?.namespace,"/",s.channel?.path]});if(s.display===x.JSON)return(0,n.jsx)(d.B,{json:p,open:5});if(s.display===x.Auto&&p instanceof A.k9){const B={series:(0,e.we)({data:[p],theme:c.$.theme2,replaceVariables:_=>_,fieldConfig:{defaults:{},overrides:[]}}),state:i.Gu.Streaming},U={...this.props,options:{frameIndex:0,showHeader:!0}};return(0,n.jsx)(b.L,{...U,data:B,height:r})}return(0,n.jsx)("pre",{children:JSON.stringify(p)})}renderPublish(r){const{options:s}=this.props;return(0,n.jsx)(j,{height:r,body:s.message,mode:s.publish??g.JSON,onSave:p=>this.props.onOptionsChange({...s,message:p}),addr:this.state.addr})}renderStatus(){const{status:r}=this.state;if(r?.state===f.ZF.Connected)return;let s="";return r&&(s=this.styles.status[r.state]),(0,n.jsx)("div",{className:(0,E.cx)(s,this.styles.statusWrap),children:r?.state})}renderBody(){const{status:r}=this.state,{options:s,height:p}=this.props;if(s.publish===g.JSON||s.publish===g.Influx){if(s.display===x.None)return this.renderPublish(p);const U=p/2;return(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{style:{height:U,overflow:"hidden"},children:(0,n.jsx)(l.E,{autoHeightMin:"100%",autoHeightMax:"100%",children:this.renderMessage(U)})}),(0,n.jsx)("div",{children:this.renderPublish(U)})]})}return s.display===x.None?(0,n.jsx)("pre",{children:JSON.stringify(r)}):(0,n.jsx)("div",{style:{overflow:"hidden",height:p},children:(0,n.jsx)(l.E,{autoHeightMin:"100%",autoHeightMax:"100%",children:this.renderMessage(p)})})}render(){if(!this.isValid)return this.renderNotEnabled();const{addr:r,error:s}=this.state;return r?s?(0,n.jsxs)("div",{children:[(0,n.jsx)("h2",{children:"ERROR"}),(0,n.jsx)("div",{children:JSON.stringify(s)})]}):(0,n.jsxs)(n.Fragment,{children:[this.renderStatus(),this.renderBody()]}):(0,n.jsx)(S.F,{title:"Grafana Live",severity:"info",children:"Use the panel editor to pick a channel"})}}const z=(0,o.N)(a=>({statusWrap:(0,E.css)({margin:"auto",position:"absolute",top:0,right:0,background:a.components.panel.background,padding:"10px",zIndex:a.zIndex.modal}),status:{[f.ZF.Pending]:(0,E.css)({border:`1px solid ${a.v1.palette.orange}`}),[f.ZF.Connected]:(0,E.css)({border:`1px solid ${a.colors.success.main}`}),[f.ZF.Connecting]:(0,E.css)({border:`1px solid ${a.v1.palette.brandWarning}`}),[f.ZF.Disconnected]:(0,E.css)({border:`1px solid ${a.colors.warning.main}`}),[f.ZF.Shutdown]:(0,E.css)({border:`1px solid ${a.colors.error.main}`}),[f.ZF.Invalid]:(0,E.css)({border:"1px solid red"})}})),H=new v.m(G).setPanelOptions(a=>{a.addCustomEditor({category:["Channel"],id:"channel",path:"channel",name:"Channel",editor:J,defaultValue:{}}),a.addRadio({path:"display",name:"Show message",description:"Display the last message received on this channel",settings:{options:[{value:x.Raw,label:"Raw Text"},{value:x.JSON,label:"JSON"},{value:x.Auto,label:"Auto"},{value:x.None,label:"None"}]},defaultValue:x.JSON}).addRadio({path:"publish",name:"Publish",description:"Display a form to publish values",settings:{options:[{value:g.None,label:"None"},{value:g.JSON,label:"JSON"},{value:g.Influx,label:"Influx"}]},defaultValue:g.None})})},88464:(w,N,t)=>{t.d(N,{L:()=>m});var v=t(74848),n=t(22803),E=t(74958),M=t(23570),f=t(38075),S=t(350),R=t(32370),I=t(29675),o=t(90415),F=t(32991),y=t(44826),K=t(24520),J=t(50959);function m(d){const{data:l,height:b,width:T,options:h,fieldConfig:L,id:x,timeRange:g,replaceVariables:j}=d,G=(0,I.$j)(),z=(0,o.d2)(),H=(0,J.gy)(l.series)?(0,J.S5)(l.series):l.series,a=H?.length,r=H.some(O=>O.fields.length>0),s=C(H,h),p=H[s];let B=b;if(!a||!r)return(0,v.jsx)(S.a,{panelId:x,fieldConfig:L,data:l});if(a>1){const O=G.spacing.gridSize*G.components.height.md,W=G.spacing.gridSize;B=b-O-W}const U=z.sync&&z.sync()!==E.y.Off,_=(0,v.jsx)(F.X,{height:B,width:T,data:p,noHeader:!h.showHeader,showTypeIcons:h.showTypeIcons,resizable:!0,initialSortBy:h.sortBy,onSortByChange:O=>A(O,d),onColumnResize:(O,W)=>P(O,W,d),onCellFilterAdded:z.onAddAdHocFilter,footerOptions:h.footer,enablePagination:h.footer?.enablePagination,cellHeight:h.cellHeight,timeRange:g,enableSharedCrosshair:R.$.featureToggles.tableSharedCrosshair&&U,fieldConfig:L,getActions:c,replaceVariables:j});if(a===1)return _;const Z=H.map((O,W)=>({label:(0,M.Ri)(O),value:W}));return(0,v.jsxs)("div",{className:u.wrapper,children:[_,(0,v.jsx)("div",{className:u.selectWrapper,children:(0,v.jsx)(y.l6,{options:Z,value:Z[s],onChange:O=>e(O,d)})})]})}function C(d,l){return l.frameIndex>0&&l.frameIndex<d.length?l.frameIndex:0}function P(d,l,b){const{fieldConfig:T}=b,{overrides:h}=T,L=f.Ct.byName,x="custom.width",g=h.find(j=>j.matcher.id===L&&j.matcher.options===d);if(g){const j=g.properties.find(G=>G.id===x);j?j.value=l:g.properties.push({id:x,value:l})}else h.push({matcher:{id:L,options:d},properties:[{id:x,value:l}]});b.onFieldConfigChange({...T,overrides:h})}function A(d,l){l.onOptionsChange({...l.options,sortBy:d})}function e(d,l){l.onOptionsChange({...l.options,frameIndex:d.value||0})}const i=d=>d,c=(d,l,b,T)=>{if(!R.$.featureToggles?.vizActions)return[];const h=[],L=new Set;return(0,K.k)(d,l,l.state.scopedVars,T??i,l.config.actions??[],{valueRowIndex:b}).forEach(g=>{const j=`${g.title}`;L.has(j)||(h.push(g),L.add(j))}),h},u={wrapper:(0,n.css)({display:"flex",flexDirection:"column",justifyContent:"space-between",height:"100%"}),selectWrapper:(0,n.css)({padding:"8px 8px 0px 8px"})}},50959:(w,N,t)=>{t.d(N,{S5:()=>P,fq:()=>S,gy:()=>A,l1:()=>m});var v=t(2543),n=t.n(v),E=t(38075),M=t(99116),f=t(63739);const S=e=>(!e.pluginVersion&&"columns"in e&&console.log("Was angular table",e),e.options),R={timeseries_to_rows:"seriesToRows",timeseries_to_columns:"seriesToColumns",timeseries_aggregations:"reduce",table:"merge"},I={avg:"mean",min:"min",max:"max",total:"sum",current:"lastNotNull",count:"count"},o={cell:"color-background",row:"color-background",value:"color-text"},F=(e,i)=>[-1/0,...e].map((c,u)=>({color:i[u],value:(0,v.isNumber)(c)?c:parseInt(c,10)})),y=(e,i)=>{const c=e.transformations??[];if(Object.keys(R).includes(i.transform)){const u={reducers:[]};i.transform==="timeseries_aggregations"&&(u.includeTimeField=!1,u.reducers=i.columns.map(d=>I[d.value])),c.push({id:R[i.transform],options:u})}return c},K=e=>{const c={matcher:{id:/^\/.*\/$/.test(e.pattern)?E.Ct.byRegexp:E.Ct.byName,options:e.pattern},properties:[]};return e.alias&&c.properties.push({id:"displayName",value:e.alias}),e.unit&&c.properties.push({id:"unit",value:e.unit}),e.decimals&&c.properties.push({id:"decimals",value:e.decimals}),e.type==="date"&&c.properties.push({id:"unit",value:`time: ${e.dateFormat}`}),e.type==="hidden"&&c.properties.push({id:"custom.hidden",value:!0}),e.link&&c.properties.push({id:"links",value:[{title:(0,v.defaultTo)(e.linkTooltip,""),url:(0,v.defaultTo)(e.linkUrl,""),targetBlank:(0,v.defaultTo)(e.linkTargetBlank,!1)}]}),e.colorMode&&c.properties.push({id:"custom.cellOptions",value:{type:o[e.colorMode]}}),e.align&&c.properties.push({id:"custom.align",value:e.align==="auto"?null:e.align}),e.thresholds?.length&&c.properties.push({id:"thresholds",value:{mode:M.O.Absolute,steps:F(e.thresholds,e.colors)}}),c},J=e=>{let i={custom:{}};if(e){if(i=(0,v.omitBy)({unit:e.unit,decimals:e.decimals,displayName:e.alias,custom:{align:e.align==="auto"?null:e.align}},v.isNil),e.thresholds.length){const c={mode:M.O.Absolute,steps:F(e.thresholds,e.colors)};i.thresholds=c}e.colorMode&&(i.custom.cellOptions={type:o[e.colorMode]})}return i},m=(e,i,c)=>{if(i==="table-old"&&c.angular){const u=c.angular,d=y(e,u),l=u.styles.find(h=>h.pattern==="/.*/"),b=J(l),T=u.styles.filter(h=>h.pattern!=="/.*/").map(K);e.transformations=d,e.fieldConfig={defaults:b,overrides:T}}return{}},C=e=>e?.filter(i=>i.meta?.custom?.parentRowIndex===void 0)||[e?.[0]],P=e=>{const i=[];return C(e).filter(u=>!!u&&u.length!==0)?.forEach(u=>{const d=e?.filter(h=>u.refId===h.refId&&h.meta?.custom?.parentRowIndex!==void 0),l=(0,v.groupBy)(d,h=>h.meta?.custom?.parentRowIndex),b=Object.keys(l).map(h=>l[h]),T={...u};d&&d.length>0&&T.fields.push({name:"nested",type:f.PU.nestedFrames,config:{},values:b}),i.push(T)}),i},A=e=>e?.some(i=>i.meta?.custom?.parentRowIndex!==void 0)}}]);

//# sourceMappingURL=livePanel.5fdb3c169ba15079c890.js.map