"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[9392],{79392:(Or,ie,u)=>{u.r(ie),u.d(ie,{default:()=>Nr});var s=u(74848),_e=u(32174),y=u(96540),qe=u(32370),et=u(62592);const tt=(0,y.lazy)(()=>u.e(9e3).then(u.bind(u,59e3))),rt=t=>{const e=qe.$.featureToggles.alertingFilterV2;return(0,s.jsx)(y.Suspense,{children:e?(0,s.jsx)(tt,{...t}):(0,s.jsx)(et.A,{...t})})};var nt=u(19127),at=u(84558),d=u(31635);function st(t,e,n){if(typeof e>"u")return t;switch(n){case 0:return function(){return t.call(e)};case 1:return function(r){return t.call(e,r)};case 2:return function(r,a){return t.call(e,r,a)};case 3:return function(r,a,o){return t.call(e,r,a,o)};default:return function(){return t.apply(e,arguments)}}}function $r(t){return t}function N(t){return(0,d.__awaiter)(this,void 0,void 0,function*(){return t})}const ot=t=>typeof t=="number",le=t=>typeof t=="boolean",S=t=>typeof t=="function",L=t=>t!=null&&Object(t)===t,X=t=>L(t)&&S(t.then);function ce(t){return L(t)&&ot(t.length)}function ue(t){return t!=null&&S(t[Symbol.iterator])}function it(t){return L(t)&&!S(t[Symbol.iterator])&&S(t.next)}function de(t){return L(t)&&S(t[Symbol.asyncIterator])}function fe(t){return t!=null&&Object(t)===t&&typeof t.subscribe=="function"}const lt=t=>L(t)&&S(t.pipe)&&S(t._read)&&le(t.readable)&&L(t._readableState),ct=t=>L(t)&&S(t.end)&&S(t._write)&&le(t.writable)&&L(t._writableState),ut=t=>L(t)&&S(t.cancel)&&S(t.getReader),Dr=t=>L(t)&&S(t.abort)&&S(t.getWriter),Wr=t=>L(t)&&ut(t.body);function dt(t){const e=Number(t);return isNaN(e)?0:e===0||!isFinite(e)?e:(e>0?1:-1)*Math.floor(Math.abs(e))}const ft=Math.pow(2,53)-1;function ht(t){const e=dt(t);return Math.min(Math.max(e,0),ft)}class T extends Error{constructor(e="The operation has been aborted"){super(e),Object.setPrototypeOf(this,T.prototype),Error.captureStackTrace(this,this.constructor),this.name="AbortError"}get[Symbol.toStringTag](){return"AbortError"}}function P(t){if(t&&t.aborted)throw new T}Object.defineProperty(T,Symbol.hasInstance,{writable:!0,configurable:!0,value(t){return L(t)&&(t.constructor.name==="AbortError"||t[Symbol.toStringTag]==="AbortError")}});class w{forEach(e,n,r){var a,o,l,i;return(0,d.__awaiter)(this,void 0,void 0,function*(){const c=r?new me(this,r):this;let h=0;try{for(var p=!0,m=(0,d.__asyncValues)(c),f;f=yield m.next(),a=f.done,!a;p=!0){i=f.value,p=!1;const g=i;yield e.call(n,g,h++,r)}}catch(g){o={error:g}}finally{try{!p&&!a&&(l=m.return)&&(yield l.call(m))}finally{if(o)throw o.error}}})}pipe(...e){let n=-1;const r=e.length;let a=this;for(;++n<r;)a=e[n](w.as(a));return a}static from(e,n=N,r){const a=st(n,r,2);if(ue(e)||de(e))return new q(e,a);if(X(e))return new he(e,a);if(fe(e))return new pe(e,a);if(ce(e))return new U(e,a);if(it(e))return new q({[Symbol.asyncIterator]:()=>e},a);throw new TypeError("Input type not supported")}static as(e){return e instanceof w?e:typeof e=="string"?new U([e],N):ue(e)||de(e)?new q(e,N):X(e)?new he(e,N):fe(e)?new pe(e,N):ce(e)?new U(e,N):new U([e],N)}}w.prototype[Symbol.toStringTag]="AsyncIterableX",Object.defineProperty(w,Symbol.hasInstance,{writable:!0,configurable:!0,value(t){return!!(t&&t[Symbol.toStringTag]==="AsyncIterableX")}});const pt="value",_="error";class mt{constructor(){this._ended=!1,this._values=[],this._resolvers=[]}[Symbol.asyncIterator](){return this}write(e){this._push({type:pt,value:e})}error(e){this._push({type:_,error:e})}_push(e){if(this._ended)throw new Error("AsyncSink already ended");if(this._resolvers.length>0){const{resolve:n,reject:r}=this._resolvers.shift();e.type===_?r(e.error):n({done:!1,value:e.value})}else this._values.push(e)}next(){if(this._values.length>0){const{type:e,value:n,error:r}=this._values.shift();return e===_?Promise.reject(r):Promise.resolve({done:!1,value:n})}return this._ended?Promise.resolve({done:!0}):new Promise((e,n)=>{this._resolvers.push({resolve:e,reject:n})})}end(){for(;this._resolvers.length>0;)this._resolvers.shift().resolve({done:!0});this._ended=!0}}class U extends w{constructor(e,n){super(),this._source=e,this._selector=n}[Symbol.asyncIterator](){return(0,d.__asyncGenerator)(this,arguments,function*(){let n=0;const r=ht(this._source.length);for(;n<r;)yield yield(0,d.__await)(yield(0,d.__await)(this._selector(this._source[n],n++)))})}}class q extends w{constructor(e,n){super(),this._source=e,this._selector=n}[Symbol.asyncIterator](e){return(0,d.__asyncGenerator)(this,arguments,function*(){var r,a,o,l,i,c,h,p;let m=0;if(e&&this._source instanceof w)try{for(var f=!0,g=(0,d.__asyncValues)(new me(this._source,e)),j;j=yield(0,d.__await)(g.next()),r=j.done,!r;f=!0){l=j.value,f=!1;const v=l;yield yield(0,d.__await)(yield(0,d.__await)(this._selector(v,m++)))}}catch(v){a={error:v}}finally{try{!f&&!r&&(o=g.return)&&(yield(0,d.__await)(o.call(g)))}finally{if(a)throw a.error}}else{P(e);try{for(var x=!0,b=(0,d.__asyncValues)(this._source),R;R=yield(0,d.__await)(b.next()),i=R.done,!i;x=!0){p=R.value,x=!1;const v=p;P(e);const I=yield(0,d.__await)(this._selector(v,m++));P(e),yield yield(0,d.__await)(I)}}catch(v){c={error:v}}finally{try{!x&&!i&&(h=b.return)&&(yield(0,d.__await)(h.call(b)))}finally{if(c)throw c.error}}}})}}class he extends w{constructor(e,n){super(),this._source=e,this._selector=n}[Symbol.asyncIterator](){return(0,d.__asyncGenerator)(this,arguments,function*(){const n=yield(0,d.__await)(this._source);yield yield(0,d.__await)(yield(0,d.__await)(this._selector(n,0)))})}}class pe extends w{constructor(e,n){super(),this._observable=e,this._selector=n}[Symbol.asyncIterator](e){return(0,d.__asyncGenerator)(this,arguments,function*(){P(e);const r=new mt,a=this._observable.subscribe({next(i){r.write(i)},error(i){r.error(i)},complete(){r.end()}});function o(){r.error(new T)}e&&e.addEventListener("abort",o);let l=0;try{for(let i;!(i=yield(0,d.__await)(r.next())).done;)P(e),yield yield(0,d.__await)(yield(0,d.__await)(this._selector(i.value,l++)))}finally{e&&e.removeEventListener("abort",o),a.unsubscribe()}})}}class me{constructor(e,n){this._source=e,this._signal=n}[Symbol.asyncIterator](){return this._source[Symbol.asyncIterator](this._signal)}}try{(t=>{if(t)return;w.prototype.pipe=n;const e=(r,a=r._writableState||{objectMode:!0})=>a;function n(...r){let a=-1,o;const l=r.length;let i=this,c;for(;++a<l;)if(c=r[a],typeof c=="function")i=c(w.as(i));else if(ct(c))return{end:o=!0}=r[a+1]||{},lt(i)?i.pipe(c,{end:o}):w.as(i).toNodeStream(e(c)).pipe(c,{end:o});return i}})(typeof window=="object"&&typeof document=="object"&&document.nodeType===9)}catch{}const Vr=w.as,ge=w.from;class K extends w{constructor(e,n){super(),this._source=e,this._signal=n}withAbort(e){return new K(this._source,e)}[Symbol.asyncIterator](){return this._source[Symbol.asyncIterator](this._signal)}}function gt(t){return function(n){return new K(n,t)}}function V(t,e){return e?new K(t,e):t}class yt extends w{constructor(e,n){super(),this._source=e,this._count=n}[Symbol.asyncIterator](e){return(0,d.__asyncGenerator)(this,arguments,function*(){var r,a,o,l;P(e);let i=this._count;if(i>0)try{for(var c=!0,h=(0,d.__asyncValues)(V(this._source,e)),p;p=yield(0,d.__await)(h.next()),r=p.done,!r;c=!0){l=p.value,c=!1;const m=l;if(yield yield(0,d.__await)(m),--i===0)break}}catch(m){a={error:m}}finally{try{!c&&!r&&(o=h.return)&&(yield(0,d.__await)(o.call(h)))}finally{if(a)throw a.error}}})}}function vt(t){return function(n){return new yt(n,t)}}const O=t=>{};function xt(t,e,n){const r=t;return r&&typeof r=="object"?{next:S(r.next)?a=>r.next(a):O,error:S(r.error)?a=>r.error(a):O,complete:S(r.complete)?()=>r.complete():O}:{next:S(t)?t:O,error:S(e)?e:O,complete:S(n)?n:O}}function Ur(t){typeof t?.return=="function"&&t.return()}function ye(t){return(0,d.__awaiter)(this,void 0,void 0,function*(){typeof t?.return=="function"&&(yield t.return())})}class jt extends w{constructor(e,n){super(),this._source=e,this._observer=n}[Symbol.asyncIterator](e){return(0,d.__asyncGenerator)(this,arguments,function*(){P(e);const r=this._observer,a=this._source[Symbol.asyncIterator](e);try{for(let o;!(o=yield(0,d.__await)(a.next())).done;)r.next&&(yield(0,d.__await)(r.next(o.value))),yield yield(0,d.__await)(o.value);r.complete&&(yield(0,d.__await)(r.complete()))}catch(o){throw!(o instanceof T)&&r.error&&(yield(0,d.__await)(r.error(o))),o}finally{yield(0,d.__await)(ye(a))}})}}function bt(t,e,n){return function(a){return new jt(a,xt(t,e,n))}}var wt=u(59830),E=u(48583),Rt=u(6210),B=u(45565),A=u(11817),z=u(25779),M=u(68639),ve=u(5240),xe=u(27106),$=u(82700),ee=u(35874),C=u(94925),H=u(54594),It=u(38310),St=u(34542),At=u(90319),Gt=u(19423),je=u(747);function be({compact:t,rule:e,promRule:n,groupIdentifier:r}){const a=!t,[o,l]=(0,St.w)(a),[i,c]=(0,y.useState)(!1),[h,p]=(0,y.useState)(void 0),m=(0,$.lT)(e)&&!!e.grafana_alert.provenance,[f,g]=(0,je.mW)(e,r,je.j5.Update),j=f&&g,x=[],b=t?"sm":"md",R=M.co(r,e);if(j){const v=(0,ee.G)(`/alerting/${encodeURIComponent(M.$9(R))}/edit`);x.push((0,s.jsx)(H.z9,{title:"Edit",size:b,variant:"secondary",icon:"pen",href:v,children:(0,s.jsx)(A.x6,{i18nKey:"common.edit",children:"Edit"})},"edit"))}return(0,s.jsxs)(E.B,{gap:1,alignItems:"center",wrap:"nowrap",children:[x,(0,s.jsx)(It.A,{buttonSize:b,rulerRule:e,promRule:n,groupIdentifier:r,identifier:R,handleDelete:()=>l(R,r),handleSilence:()=>c(!0),handleDuplicateRule:()=>p({identifier:R,isProvisioned:m})}),o,(0,$.pv)(e)&&i&&(0,s.jsx)(Gt.A,{rulerRule:e,onClose:()=>c(!1)}),h?.identifier&&(0,s.jsx)(At.Z,{identifier:h.identifier,isProvisioned:h.isProvisioned,onDismiss:()=>p(void 0)})]})}var Q=u(70255);function we(){return(0,s.jsx)(Q.A,{width:50,height:16})}const{useDiscoverDsFeaturesQuery:Pt}=xe.L,{useGetRuleGroupForNamespaceQuery:Et}=ve.hK,Re=(0,y.memo)(function({rule:e,groupIdentifier:n}){const{rulesSource:r,namespace:a,groupName:o}=n,l=(0,M.Lg)(r.name,a.name,o,e),i=Lt(l),c=(0,$.uo)(e),{data:h}=Pt({uid:r.uid}),{isLoading:p,data:m}=Et({namespace:a.name,group:o,rulerConfig:h?.rulerConfig},{skip:!h?.rulerConfig}),f=(0,y.useMemo)(()=>{if(m)return m.rules.find(j=>(0,M.LC)((0,M.P1)(r.name,a.name,o,j),l))},[r,a,o,l,m]),g=(0,y.useMemo)(()=>p?(0,s.jsx)(we,{}):f?(0,s.jsx)(be,{rule:f,promRule:e,groupIdentifier:n,compact:!0}):null,[n,p,e,f]);return(0,$.Z8)(e)?(0,s.jsx)(C.WG,{name:e.name,rulesSource:r,application:h?.application,group:o,namespace:a.name,href:i,summary:e.annotations?.summary,state:e.state,health:e.health,error:e.lastError,labels:e.labels,isProvisioned:void 0,instancesCount:e.alerts?.length,actions:g,origin:c}):(0,$.KB)(e)?(0,s.jsx)(C.nh,{name:e.name,rulesSource:r,application:h?.application,group:o,namespace:a.name,href:i,health:e.health,error:e.lastError,labels:e.labels,isProvisioned:void 0,actions:g,origin:c}):(0,s.jsx)(C.Om,{rule:e,groupIdentifier:n})});function Lt(t,e){const n=encodeURIComponent((0,M.$9)(t)),r=encodeURIComponent(t.ruleSourceName);return(0,ee.G)(`/alerting/${r}/${n}/view`,e?{returnTo:e}:{})}var Ie=u(51876),D=u(88214),Se=u(91527),Ft=u(96543);function te(){return(0,s.jsx)(Se.c,{title:(0,s.jsx)(Q.A,{width:64}),icon:(0,s.jsx)(Ft.c,{isPaused:!1}),description:(0,s.jsx)(Q.A,{width:256}),actions:(0,s.jsx)(we,{}),"data-testid":"alert-rule-list-item-loader"})}function Mt({rule:t}){return(0,s.jsx)(Se.c,{title:t.name,description:(0,A.t)("alerting.rule-list.rulerrule-loading-error","Failed to load the rule"),"data-testid":"ruler-rule-loading-error"})}const{useGetGrafanaRulerGroupQuery:Nt}=ve.hK;function Ae({rule:t,groupIdentifier:e,namespaceName:n}){const{data:r,isError:a}=Nt(e),o=r?.rules.find(f=>f.grafana_alert.uid===t.uid);if(!o)return a?(0,s.jsx)(Mt,{rule:t}):(0,s.jsx)(te,{});const{grafana_alert:{title:l,provenance:i,is_paused:c},annotations:h={},labels:p={}}=o,m={name:l,rulesSource:D.r6,group:e.groupName,namespace:n,href:(0,ee.G)(`/alerting/grafana/${t.uid}/view`),health:t.health,error:t.lastError,labels:p,isProvisioned:!!i,isPaused:c,application:"grafana",actions:(0,s.jsx)(be,{rule:o,promRule:t,groupIdentifier:e,compact:!0})};return t.type===Ie.JS.Alerting?(0,s.jsx)(C.WG,{...m,summary:h.summary,state:t.state,instancesCount:t.alerts?.length}):t.type===Ie.JS.Recording?(0,s.jsx)(C.nh,{...m}):(0,s.jsx)(C.Om,{rule:t,groupIdentifier:e})}var Tt=function(t,e){var n=(0,y.useState)(null),r=n[0],a=n[1];return(0,y.useEffect)(function(){if(t.current&&typeof IntersectionObserver=="function"){var o=function(i){a(i[0])},l=new IntersectionObserver(o,e);return l.observe(t.current),function(){a(null),l.disconnect()}}return function(){}},[t.current,e.threshold,e.root,e.rootMargin]),r};const Ct=Tt;function Ot({handleLoad:t}){const e=(0,y.useRef)(null),n=Ct(e,{root:null,threshold:1});return(0,y.useEffect)(()=>{n&&n.intersectionRatio>0&&t()},[n,t]),(0,s.jsx)("div",{ref:e,"data-testid":"load-more-helper"})}const Bt=Ot;function Ge(t){return t===null||typeof t!="object"&&typeof t!="function"}const re=new WeakMap;function Pe(t){let e;return new Promise((r,a)=>{e={resolve:r,reject:a};for(const o of t){if(Ge(o)){Promise.resolve(o).then(r,a);continue}let l=re.get(o);l===void 0?(l={deferreds:new Set([e]),settled:!1},re.set(o,l),Promise.resolve(o).then(i=>{for(const{resolve:c}of l.deferreds)c(i);l.deferreds.clear(),l.settled=!0},i=>{for(const{reject:c}of l.deferreds)c(i);l.deferreds.clear(),l.settled=!0})):l.settled?Promise.resolve(o).then(r,a):l.deferreds.add(e)}}).finally(()=>{for(const r of t)Ge(r)||re.get(r).deferreds.delete(e)})}const $t=new Promise(()=>{});function Ee(t,e){return t.then(({value:n,done:r})=>({value:n,done:r,index:e})).catch(n=>({error:n,index:e}))}class Dt extends w{constructor(e){super(),this._source=e}[Symbol.asyncIterator](e){return(0,d.__asyncGenerator)(this,arguments,function*(){P(e);const r=this._source.length,a=new Array(r),o=new Array(r);let l=r;for(let i=0;i<r;i++){const c=V(this._source[i],e)[Symbol.asyncIterator]();a[i]=c,o[i]=Ee(c.next(),i)}for(;l>0;){const i=yield(0,d.__await)(Pe(o));if(i.hasOwnProperty("error"))throw i.error;if(i.done)o[i.index]=$t,l--;else{const c=a[i.index];o[i.index]=Ee(c.next(),i.index),yield yield(0,d.__await)(i.value)}}})}}function Le(t,...e){return new Dt([t,...e])}class Wt extends w{constructor(e,n,r){super(),this._source=e,this._predicate=n,this._thisArg=r}[Symbol.asyncIterator](e){return(0,d.__asyncGenerator)(this,arguments,function*(){var r,a,o,l;P(e);let i=0;try{for(var c=!0,h=(0,d.__asyncValues)(V(this._source,e)),p;p=yield(0,d.__await)(h.next()),r=p.done,!r;c=!0){l=p.value,c=!1;const m=l;(yield(0,d.__await)(this._predicate.call(this._thisArg,m,i++)))&&(yield yield(0,d.__await)(m))}}catch(m){a={error:m}}finally{try{!c&&!r&&(o=h.return)&&(yield(0,d.__await)(o.call(h)))}finally{if(a)throw a.error}}})}}function Y(t,e){return function(r){return new Wt(r,t,e)}}const Fe=new Promise(()=>{});function Me(t){return function(n){if(t.aborted&&n instanceof T)return Fe;throw n}}function Ne(t,e,n,r){return(0,d.__asyncGenerator)(this,arguments,function*(){var o,l,i,c;P(r);try{for(var h=!0,p=(0,d.__asyncValues)(V(t,r)),m;m=yield(0,d.__await)(p.next()),o=m.done,!o;h=!0){c=m.value,h=!1;const f=c;P(r),yield yield(0,d.__await)({type:n,index:e,value:f})}}catch(f){l={error:f}}finally{try{!h&&!o&&(i=p.return)&&(yield(0,d.__await)(i.call(p)))}finally{if(l)throw l.error}}return yield(0,d.__await)({type:n,index:e,value:void 0})})}class Vt extends w{constructor(e,n,r,a,o){super(),this._source=e,this._selector=n,this._concurrent=r,this._switchMode=a,this._thisArg=o,this._concurrent=this._switchMode?1:Math.max(r,1)}[Symbol.asyncIterator](e){return(0,d.__asyncGenerator)(this,arguments,function*(){P(e);let r=0,a=0,o=!1;const l=this._thisArg,i=this._selector,c=this._switchMode,h=this._concurrent,p=new Array(0),m=new Array(0),f=new Array(isFinite(h)?h:0),g=new Array(isFinite(h)?h:0),j=Ne(this._source,0,0,e),x=[j.next()];try{do{const{done:v=!1,value:{type:I,value:G,index:F}}=yield(0,d.__await)(Pe(x));if(v)switch(x[F]=Fe,I){case 0:{o=!0;break}case 1:{for(--r,m.push(F);r<h&&p.length;)b(p.shift());break}}else switch(I){case 0:{c&&(r=0),r<h?b(G):p.push(G),x[0]=j.next();break}case 1:{yield yield(0,d.__await)(G);const{[F-1]:Tr}=g,{[F-1]:{signal:Cr}}=f;x[F]=Tr.next().catch(Me(Cr));break}}}while(!o||r+p.length>0)}finally{f.forEach(v=>v?.abort()),yield(0,d.__await)(Promise.all([j,...g].map(ye)))}function b(v){++r;const I=m.pop()||r;c&&f[I-1]&&f[I-1].abort(),f[I-1]=new AbortController;const G=f[I-1].signal,F=i.call(l,v,a++,G);x[I]=R(I,G,F).catch(Me(G))}function R(v,I,G){return X(G)?G.then(F=>R(v,I,F)):(g[v-1]=Ne(w.as(G),v,1,I)).next()}})}}function Te(t,e=1/0,n){return function(a){return new Vt(a,t,e,!1,n)}}class Ut extends w{constructor(e,n,r){super(),this._source=e,this._selector=n,this._thisArg=r}[Symbol.asyncIterator](e){return(0,d.__asyncGenerator)(this,arguments,function*(){var r,a,o,l;P(e);let i=0;try{for(var c=!0,h=(0,d.__asyncValues)(V(this._source,e)),p;p=yield(0,d.__await)(h.next()),r=p.done,!r;c=!0){l=p.value,c=!1;const m=l,f=yield(0,d.__await)(this._selector.call(this._thisArg,m,i++,e));yield yield(0,d.__await)(f)}}catch(m){a={error:m}}finally{try{!c&&!r&&(o=h.return)&&(yield(0,d.__await)(o.call(h)))}finally{if(a)throw a.error}}})}}function ne(t,e){return function(r){return new Ut(r,t,e)}}var ae=u(2543),Kt=u(1814),zt=u(83466),Ht=u(55936),Qt=u(79120),Yt=u(76204);const Zt=Qt.H.injectEndpoints({endpoints:t=>({getGroups:t.query({query:({ruleSource:e,namespace:n,groupName:r,ruleName:a,groupLimit:o,excludeAlerts:l,groupNextToken:i})=>{if(e.uid===D.hY)throw new Error("Please use getGrafanaGroups endpoint for grafana rules");return{url:`api/prometheus/${e.uid}/api/v1/rules`,params:{"file[]":n,"group[]":r,"rule[]":a,exclude_alerts:l?.toString(),group_limit:o?.toFixed(0),group_next_token:i}}},transformResponse:e=>({...e,data:{...e.data,groups:e.data.groups.map(Yt.JY)}})}),getGrafanaGroups:t.query({query:({namespace:e,groupName:n,ruleName:r,groupLimit:a,excludeAlerts:o,groupNextToken:l})=>({url:"api/prometheus/grafana/api/v1/rules",params:{"file[]":e,"group[]":n,"rule[]":r,exclude_alerts:o?.toString(),group_limit:a?.toFixed(0),group_next_token:l}})})})}),{useLazyGetGroupsQuery:Jt,useLazyGetGrafanaGroupsQuery:kt}=Zt;function Ce(){const[t]=Jt();return(0,y.useCallback)(async function*(e,n){yield*Be(a=>t({ruleSource:{uid:e.uid},...a}),n)},[t])}function Oe(){const[t]=kt();return(0,y.useCallback)(async function*(e){yield*Be(t,e)},[t])}async function*Be(t,e){const n=await t({groupLimit:e});if(!n.isSuccess)return;n.data?.data&&(yield*n.data.data.groups);let r;for(n.data?.data?.groupNextToken&&(r=n.data.data.groupNextToken);r;){const a=await t({groupNextToken:r,groupLimit:e});if(!a.isSuccess)return;a.data?.data&&(yield*a.data.data.groups),r=a.data?.data?.groupNextToken}}function Xt(){const t=(0,D.TG)(),e=Ce(),n=Oe();return{getFilteredRulesIterator:(a,o)=>{const l=er(a),i=a.dataSourceNames.length?a.dataSourceNames.map(f=>({name:f,uid:(0,D.w5)(f),ruleSourceType:"datasource"})):t,c=ge(n(o)).pipe(Y(f=>$e(f,l)),Te(f=>f.rules.map(g=>[f,g])),Y(([f,g])=>De(g,l)),ne(([f,g])=>qt(f,g))),[h,...p]=i.map(f=>ge(e(f,o)).pipe(ne(g=>[f,g]))),m=Le(h,...p).pipe(Y(([f,g])=>$e(g,l)),Te(([f,g])=>g.rules.map(j=>[f,g,j])),Y(([f,g,j])=>De(j,a)),ne(([f,g,j])=>_t(f,g,j)));return Le(c,m)}}}function _t(t,e,n){return{rule:n,groupIdentifier:{rulesSource:t,namespace:{name:e.file},groupName:e.name,groupOrigin:"datasource"},origin:"datasource"}}function qt(t,e){return{rule:e,groupIdentifier:{namespace:{uid:t.folderUid},groupName:t.name,groupOrigin:"grafana"},namespaceName:t.file,origin:"grafana"}}function $e(t,e){const{name:n,file:r}=t;return!(e.namespace&&!r.toLowerCase().includes(e.namespace)||e.groupName&&!n.toLowerCase().includes(e.groupName))}function De(t,e){const{name:n,labels:r={},health:a,type:o}=t,l=n.toLowerCase();if(e.freeFormWords.length>0&&!e.freeFormWords.some(i=>l.includes(i))||e.ruleName&&!l.includes(e.ruleName))return!1;if(e.labels.length>0){const i=(0,ae.compact)(e.labels.map(tr));if(!(i.length>0&&(0,Kt.Av)(r,i)))return!1}return e.ruleType&&o!==e.ruleType||e.ruleState&&(!(0,$.Z8)(t)||t.state!==e.ruleState)||e.ruleHealth&&a!==e.ruleHealth?!1:e.dashboardUid?t.labels?t.labels[zt.YH.dashboardUID]===e.dashboardUid:!1:!0}function er(t){return{...t,freeFormWords:t.freeFormWords.map(e=>e.toLowerCase()),ruleName:t.ruleName?.toLowerCase(),groupName:t.groupName?.toLowerCase(),namespace:t.namespace?.toLowerCase()}}function tr(t){try{return(0,Ht.qR)(t)}catch{return{name:t,value:"",isRegex:!0,isEqual:!0}}}const rr=100,nr=2e3;function ar({filterState:t}){return(0,s.jsx)(sr,{filterState:t},JSON.stringify(t))}function sr({filterState:t}){const[e,n]=(0,y.useTransition)(),{getFilteredRulesIterator:r}=Xt(),a=(0,y.useRef)(new AbortController),o=(0,y.useRef)(r(t,nr).pipe(gt(a.current.signal),or(()=>h(!0)))),[l,i]=(0,y.useState)([]),[c,h]=(0,y.useState)(!1),[{execute:p},m]=(0,z.Yb)(async()=>{for await(const x of o.current.pipe(vt(rr)))n(()=>{i(b=>b.concat({key:ir(x),...x}))})});(0,y.useEffect)(()=>{const x=a.current;return()=>{x.abort()}},[a]);const f=(0,z.VP)(m)||e,g=l.length,j=g===0&&!f;return j&&c?(0,s.jsx)(wt.p,{variant:"not-found",message:"No matching rules found",children:(0,s.jsx)(A.x6,{i18nKey:"alerting.rule-list.filter-view.no-rules-found",children:"No alert or recording rules matched your current set of filters."})}):(0,s.jsxs)(E.B,{direction:"column",gap:0,children:[(0,s.jsxs)("ul",{"aria-label":"filtered-rule-list",children:[l.map(x=>{const{key:b,rule:R,groupIdentifier:v,origin:I}=x;switch(I){case"grafana":return(0,s.jsx)(Ae,{rule:R,groupIdentifier:v,namespaceName:x.namespaceName},b);case"datasource":return(0,s.jsx)(Re,{rule:R,groupIdentifier:v},b);default:return(0,s.jsx)(C.Om,{rule:R,groupIdentifier:v},b)}}),f&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(te,{}),(0,s.jsx)(te,{})]})]}),c&&!j&&(0,s.jsx)(Rt.Z,{children:(0,s.jsx)(B.E,{color:"secondary",children:(0,s.jsxs)(A.x6,{i18nKey:"alerting.rule-list.filter-view.no-more-results",children:["No more results \u2013 showing ",{numberOfRules:g}," rules"]})})}),!c&&!f&&(0,s.jsx)(Bt,{handleLoad:p})]})}function or(t){return bt(void 0,void 0,t)}function ir(t){return t.origin==="grafana"?lr(t):cr(t)}function lr(t){const{groupIdentifier:{namespace:e,groupName:n},rule:r}=t;return`grafana-${e.uid}-${n}-${r.uid}}`}function cr(t){const{rule:e,groupIdentifier:{rulesSource:n,namespace:r,groupName:a}}=t;return`${n.name}-${r.name}-${a}-${e.name}-${e.type}-${(0,M.jY)(e)}`}var Z=u(79784),J=u(22803),We=u(42941),se=u(29675),oe=u(99764),Ve=u(35004),Ue=u(7484),ur=u(72974),dr=u(85651),fr=u(69957),hr=u(49185),pr=u(37008),Kr=u(99797),zr=u(76778),Hr=u(5127);const Qr=({name:t,provenance:e,interval:n,onToggle:r,isOpen:a=!1,children:o})=>{const l=useStyles2(mr),i=!!e;return jsxs(Stack,{direction:"column",role:"treeitem","aria-expanded":a,"aria-selected":"false",gap:0,children:[jsx("div",{className:l.headerWrapper,children:jsxs(Stack,{direction:"row",alignItems:"center",gap:1,children:[jsx("button",{className:cx(l.hiddenButton,l.largerClickTarget),type:"button",onClick:r,children:jsxs(Stack,{alignItems:"center",gap:.5,children:[jsx(Icon,{name:a?"angle-down":"angle-right"}),jsx(Text,{truncate:!0,variant:"body",children:t})]})}),i&&jsx(Badge,{color:"purple",text:"Provisioned"}),jsx(Spacer,{}),n&&jsx(MetaText,{icon:"history",children:n}),jsx(Button,{size:"sm",icon:"pen",variant:"secondary",disabled:i,"data-testid":"edit-group-action",children:jsx(Trans,{i18nKey:"common.edit",children:"Edit"})}),jsx(Dropdown,{overlay:jsxs(Menu,{children:[jsx(Menu.Item,{label:"Re-order rules",icon:"flip",disabled:i}),jsx(Menu.Divider,{}),jsx(Menu.Item,{label:"Export",icon:"download-alt"}),jsx(Menu.Item,{label:"Delete",icon:"trash-alt",destructive:!0,disabled:i})]}),children:jsx(MoreButton,{size:"sm"})})]})}),a&&jsx("div",{role:"group",children:o})]})},mr=t=>({headerWrapper:css({padding:`${t.spacing(1)} ${t.spacing(1)}`,background:t.colors.background.secondary,border:"none",borderBottom:`solid 1px ${t.colors.border.weak}`,borderTopLeftRadius:t.shape.radius.default,borderTopRightRadius:t.shape.radius.default}),hiddenButton:css({border:"none",background:"transparent"}),largerClickTarget:css({padding:t.spacing(.5),margin:`-${t.spacing(.5)}`})}),gr=15,Yr=({name:t,provenance:e,interval:n,namespace:r,rulerConfig:a})=>{const[o,l]=useToggle(!1),[i,{currentData:c,isLoading:h,error:p}]=alertRuleApi.endpoints.prometheusRuleNamespaces.useLazyQuery(),m=c?.flatMap(b=>b.groups).flatMap(b=>b.rules),{page:f,pageItems:g,onPageChange:j,numberOfPages:x}=usePagination(m??[],1,gr);return useEffect(()=>{o&&a&&i({namespace:r,groupName:t,ruleSourceName:a.dataSourceName})},[i,o,t,r,a]),jsx(EvaluationGroup,{name:t,interval:n,provenance:e,isOpen:o,onToggle:l,children:p?jsx(Alert,{title:"Something went wrong when trying to fetch group details",children:String(p)}):jsxs(Fragment,{children:[h?jsx(vr,{}):g.map((b,R)=>(AlertRuleListItem,PromAlertingRuleState.Inactive,b.name,isAlertingRule(b)&&b.annotations?.summary,null)),x>1&&jsx(Pagination,{currentPage:f,numberOfPages:x,onNavigate:j})]})})},yr=({datasourceUid:t})=>{const[e,{width:n}]=(0,hr.A)();return(0,s.jsx)("div",{ref:e,"data-testid":`ds-loading-indicator-${t}`,children:(0,s.jsx)(pr.G,{width:n})})},vr=()=>{const[t,{width:e}]=useMeasure();return jsxs("div",{ref:t,children:[jsx(LoadingBar,{width:e}),jsx(SkeletonListItem,{})]})},k=({uid:t,name:e,application:n,children:r,loader:a,isLoading:o=!1,description:l=null})=>{const i=(0,se.of)(xr),[c,h]=(0,We.A)(!1),p=t===Ve.l$?(0,dr.qc)()?"/alerting/admin":void 0:`/connections/datasources/edit/${String(t)}`;return(0,s.jsx)("section",{"aria-labelledby":`datasource-${String(t)}-heading`,role:"listitem",children:(0,s.jsxs)(E.B,{direction:"column",gap:1,children:[(0,s.jsxs)(E.B,{direction:"column",gap:0,children:[o&&(0,s.jsx)(yr,{datasourceUid:String(t)}),(0,s.jsx)("div",{className:i.dataSourceSectionTitle,children:a??(0,s.jsxs)(E.B,{alignItems:"center",children:[(0,s.jsx)(oe.K,{name:c?"angle-right":"angle-down",onClick:h,"aria-label":(0,A.t)("common.collapse","Collapse")}),n&&(0,s.jsx)(fr.H,{application:n}),(0,s.jsx)(B.E,{variant:"body",weight:"bold",element:"h2",id:`datasource-${String(t)}-heading`,children:e}),l&&(0,s.jsxs)(s.Fragment,{children:["\xB7",l]}),(0,s.jsx)(Ue.h,{}),p&&(0,s.jsx)(ur.d,{title:(0,A.t)("alerting.rule-list.return-button.title","Alert rules"),component:(0,s.jsx)(H.z9,{variant:"secondary",size:"sm",href:p,children:(0,s.jsx)(A.x6,{i18nKey:"alerting.rule-list.configure-datasource",children:"Configure"})})})]})})]}),!c&&(0,s.jsx)("div",{className:i.itemsWrapper,children:r})]})})},xr=t=>({itemsWrapper:(0,J.css)({position:"relative",marginLeft:t.spacing(1.5),"&:before":{content:"''",position:"absolute",height:"100%",marginLeft:`-${t.spacing(1.5)}`,borderLeft:`solid 1px ${t.colors.border.weak}`}}),dataSourceSectionTitle:(0,J.css)({background:t.colors.background.secondary,padding:`${t.spacing(1)} ${t.spacing(1.5)}`,border:`solid 1px ${t.colors.border.weak}`,borderRadius:t.shape.radius.default})});function Ke({canMoveForward:t,canMoveBackward:e,nextPage:n,previousPage:r}){return(0,s.jsxs)(E.B,{direction:"row",gap:1,children:[(0,s.jsx)(H.$n,{"aria-label":(0,A.t)("alerting.rule-list.pagination.previous-page","previous page"),size:"sm",variant:"secondary",onClick:r,disabled:!e,children:(0,s.jsx)(Z.I,{name:"angle-left"})}),(0,s.jsx)(H.$n,{"aria-label":(0,A.t)("alerting.rule-list.pagination.next-page","next page"),size:"sm",variant:"secondary",onClick:n,disabled:!t,children:(0,s.jsx)(Z.I,{name:"angle-right"})})]})}const ze=({name:t,description:e,isOpen:n=!0,metaRight:r=null,actions:a=null,children:o})=>{const l=(0,se.of)(He),[i,c]=(0,We.A)(n);return(0,s.jsxs)("div",{className:l.groupWrapper,role:"treeitem","aria-expanded":i,"aria-selected":"false",children:[(0,s.jsx)(jr,{onToggle:()=>c(),isOpen:i,description:e,name:t,metaRight:r,actions:a}),i&&(0,s.jsx)("div",{role:"group",children:o})]})},jr=t=>{const{name:e,description:n,metaRight:r=null,actions:a=null,isOpen:o=!1,onToggle:l}=t,i=(0,se.of)(He);return(0,s.jsx)("div",{className:i.headerWrapper,children:(0,s.jsxs)(E.B,{direction:"row",alignItems:"center",gap:1,children:[(0,s.jsxs)(E.B,{alignItems:"center",gap:0,children:[(0,s.jsx)(oe.K,{name:o?"angle-down":"angle-right",onClick:l,"aria-label":(0,A.t)("common.collapse","Collapse")}),(0,s.jsx)(B.E,{truncate:!0,variant:"body",element:"h4",children:e})]}),n,(0,s.jsx)(Ue.h,{}),r,a]})})},He=t=>({groupWrapper:(0,J.css)({display:"flex",flexDirection:"column"}),headerWrapper:(0,J.css)({padding:`${t.spacing(.5)} ${t.spacing(1)}`,background:t.colors.background.secondary,border:"none",borderBottom:`solid 1px ${t.colors.border.weak}`,borderTopLeftRadius:t.shape.radius.default,borderTopRightRadius:t.shape.radius.default})});var Qe=u(46258),br=u(60232),W=u(19224);function Ye(){return(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(br.m,{overlay:(0,s.jsxs)(W.W,{children:[(0,s.jsx)(W.W.Item,{label:(0,A.t)("alerting.group-actions.edit","Edit"),icon:"pen","data-testid":"edit-group-action"}),(0,s.jsx)(W.W.Item,{label:(0,A.t)("alerting.group-actions.reorder","Re-order rules"),icon:"flip"}),(0,s.jsx)(W.W.Divider,{}),(0,s.jsx)(W.W.Item,{label:(0,A.t)("alerting.group-actions.export","Export"),icon:"download-alt"}),(0,s.jsx)(W.W.Item,{label:(0,A.t)("alerting.group-actions.delete","Delete"),icon:"trash-alt",destructive:!0})]}),children:(0,s.jsx)(oe.K,{name:"ellipsis-h","aria-label":(0,A.t)("alerting.group-actions.actions-trigger","Rule group actions")})})})}function Ze(t,e){const[n,r]=(0,y.useState)(1),[a,o]=(0,y.useState)([]),[l,i]=(0,y.useState)(void 0),[{execute:c},h]=(0,z.Yb)(async R=>{let v=!1;const I=[];for(;I.length<R;){const G=await t.next();if(G.done){v=!0;break}const F=G.value;I.push(F)}if(v){const G=a.length+I.length;i(Math.ceil(G/e))}o(G=>[...G,...I])}),p=(0,z.VP)(h),m=!p&&(!l||n<l),f=n>1,g=(0,y.useCallback)(async()=>{m&&r(R=>R+1)},[m]),j=(0,y.useCallback)(async()=>{f&&r(R=>R-1)},[f]);a.length-e<e*n&&l===void 0&&!p&&c(e);const b=(0,y.useMemo)(()=>a.slice((n-1)*e,n*e),[a,n,e]);return{isLoading:p,page:b,nextPage:g,previousPage:j,canMoveForward:m,canMoveBackward:f}}const Je=40;function wr({rulesSourceIdentifier:t,application:e}){const{uid:n,name:r}=t,a=Ce(),o=(0,y.useRef)(a(t,Je));(0,y.useEffect)(()=>{const g=o.current;return()=>{g.return()}},[o]);const{page:l,nextPage:i,previousPage:c,canMoveForward:h,canMoveBackward:p,isLoading:m}=Ze(o.current,Je),f=(0,y.useMemo)(()=>(0,ae.groupBy)(l,"file"),[l]);return(0,s.jsx)(k,{name:r,application:e,uid:n,isLoading:m,children:(0,s.jsxs)(E.B,{direction:"column",gap:1,children:[Object.entries(f).map(([g,j])=>(0,s.jsx)(Qe.i,{title:(0,s.jsxs)(E.B,{direction:"row",gap:1,alignItems:"center",children:[(0,s.jsx)(Z.I,{name:"folder"})," ",(0,s.jsx)(B.E,{variant:"body",element:"h3",children:g})]}),children:j.map(x=>(0,s.jsx)(Rr,{group:x,rulesSourceIdentifier:t,namespaceName:g},`${t.uid}-${g}-${x.name}`))},g)),(0,s.jsx)(Ke,{nextPage:i,previousPage:c,canMoveForward:h,canMoveBackward:p})]})})}function Rr({rulesSourceIdentifier:t,group:e,namespaceName:n}){const r=(0,y.useMemo)(()=>e.rules.map(a=>{const o={rulesSource:t,namespace:{name:n},groupName:e.name,groupOrigin:"datasource"};return{rule:a,groupIdentifier:o}}),[e,n,t]);return(0,s.jsx)(ze,{name:e.name,isOpen:!1,actions:(0,s.jsx)(Ye,{}),children:r.map(({rule:a,groupIdentifier:o})=>(0,s.jsx)(Re,{rule:a,groupIdentifier:o},(0,M.jY)(a)))},e.name)}const ke=40;function Ir(){const t=Oe(),e=(0,y.useRef)(t(ke));(0,y.useEffect)(()=>{const h=e.current;return()=>{h.return()}},[]);const{page:n,nextPage:r,previousPage:a,canMoveForward:o,canMoveBackward:l,isLoading:i}=Ze(e.current,ke),c=(0,y.useMemo)(()=>(0,ae.groupBy)(n,"folderUid"),[n]);return(0,s.jsx)(k,{name:"Grafana",application:"grafana",uid:Ve.l$,isLoading:i,children:(0,s.jsxs)(E.B,{direction:"column",gap:1,children:[Object.entries(c).map(([h,p])=>{const m=p[0].file;return(0,s.jsx)(Qe.i,{title:(0,s.jsxs)(E.B,{direction:"row",gap:1,alignItems:"center",children:[(0,s.jsx)(Z.I,{name:"folder"})," ",(0,s.jsx)(B.E,{variant:"body",element:"h3",children:m})]}),children:p.map(f=>(0,s.jsx)(Sr,{group:f,namespaceName:m},`grafana-ns-${h}-${f.name}`))},h)}),(0,s.jsx)(Ke,{nextPage:r,previousPage:a,canMoveForward:o,canMoveBackward:l})]})})}function Sr({group:t,namespaceName:e}){const n={groupName:t.name,namespace:{uid:t.folderUid},groupOrigin:"grafana"};return(0,s.jsx)(ze,{name:t.name,isOpen:!1,actions:(0,s.jsx)(Ye,{}),children:t.rules.map(r=>(0,s.jsx)(Ae,{rule:r,namespaceName:e,groupIdentifier:n},r.uid))},t.name)}var Ar=u(49816),Gr=u(37e3),Pr=u(32336);function Xe({children:t,rulesSourceIdentifier:e}){return(0,s.jsx)(Ar.tH,{children:({error:n,errorInfo:r})=>{if(n||r){const{uid:a,name:o}=e;return(0,s.jsx)(k,{uid:a,name:o,children:(0,s.jsxs)(Gr.F,{title:(0,A.t)("alerting.rule-list.ds-error-boundary.title","Unable to load rules from this data source"),children:[(0,s.jsx)(B.E,{children:(0,s.jsx)(A.x6,{i18nKey:"alerting.rule-list.ds-error-boundary.description",children:"Check the data source configuration. Does the data source support Prometheus API?"})}),(0,s.jsx)(Pr.D,{error:n,errorInfo:r,title:(0,A.t)("alerting.rule-list.ds-error-boundary.title","Unable to load rules from this data source")})]})})}return t}})}const{useDiscoverDsFeaturesQuery:Er}=xe.L;function Lr(){const t=(0,y.useMemo)(()=>(0,D.TG)(),[]);return(0,s.jsxs)(E.B,{direction:"column",gap:1,role:"list",children:[(0,s.jsx)(Xe,{rulesSourceIdentifier:D.r6,children:(0,s.jsx)(Ir,{})}),t.map(e=>(0,s.jsx)(Fr,{rulesSourceIdentifier:e},e.uid))]})}function Zr(){return jsx(DataSourceSection,{name:"Grafana",application:"grafana",uid:"grafana",isLoading:!0})}function Fr({rulesSourceIdentifier:t}){const{data:e,isLoading:n}=Er({uid:t.uid}),{uid:r,name:a}=t;return n?(0,s.jsx)(k,{loader:(0,s.jsx)(Q.A,{width:250,height:16}),uid:r,name:a}):e?(0,s.jsx)(Xe,{rulesSourceIdentifier:t,children:(0,s.jsx)(wr,{rulesSourceIdentifier:t,application:e.application},t.uid)}):null}function Mr(){const[t]=(0,at.l)(),{filterState:e,hasActiveFilters:n}=(0,nt.dI)(),r=t.get("view")==="list"?"list":"grouped",a=n||r==="list";return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(rt,{onClear:()=>{}}),a?(0,s.jsx)(ar,{filterState:e}):(0,s.jsx)(Lr,{})]})}function Nr(){return(0,s.jsx)(_e.d,{navId:"alert-list",isLoading:!1,actions:null,children:(0,s.jsx)(Mr,{})})}}}]);

//# sourceMappingURL=9392.29432c53010e594eb69e.js.map