"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[1743],{60156:(te,E,a)=>{a.d(E,{y:()=>O});var e=a(74848),l=a(96540),u=a(41053),y=a(87638),j=a(61491),v=a(71623),m=a(26185);const O=({basicRole:o,roles:D,userId:P,orgId:x,onBasicRoleChange:L,roleOptions:M,disabled:Z,basicRoleDisabled:X,basicRoleDisabledMessage:T,apply:S=!1,onApplyRoles:W,pendingRoles:b,maxWidth:G,width:w,isLoading:Y})=>{const[{loading:re,value:oe=D||[]},B]=(0,u.A)(async()=>{try{if(D)return D;if(S&&b?.length)return b;if(y.TP.hasPermission(j.AccessControlAction.ActionUserRolesList)&&P>0)return await(0,m.Xh)(P,x)}catch{console.error("Error loading options")}return[]},[x,P,b,D]);(0,l.useEffect)(()=>{x&&B()},[B,x]);const _=async V=>{S?W&&W(V,P,x):(await(0,m.eA)(V,P,x),await B())},H=y.TP.hasPermission(j.AccessControlAction.ActionUserRolesAdd)&&y.TP.hasPermission(j.AccessControlAction.ActionUserRolesRemove);return(0,e.jsx)(v.n,{appliedRoles:oe,basicRole:o,onRolesChange:_,onBasicRoleChange:L,roleOptions:M,isLoading:re||Y,disabled:Z,basicRoleDisabled:X,basicRoleDisabledMessage:T,showBasicRole:!0,apply:S,canUpdateRoles:H,maxWidth:G,width:w})}},97531:(te,E,a)=>{a.d(E,{I:()=>x});var e=a(74848),l=a(49785),u=a(35095),y=a(54731),j=a(58528),v=a(86489),m=a(60641),O=a(11817),o=a(61491);const D=Object.keys(o.OrgRole).map(u.z),P=(0,e.jsxs)(O.x6,{i18nKey:"role-picker.title.description",children:["Assign roles to users to ensure granular control over access to Grafana\u2018s features and resources. Find out more in our"," ",(0,e.jsx)(y.Y,{external:!0,href:"https://grafana.com/docs/grafana/latest/administration/roles-and-permissions/#organization-roles",children:"documentation"}),"."]}),x=({onClose:L})=>{const M=(0,l.xW)(),{control:Z,getValues:X,setValue:T}=M,[S,W]=X(["name","roles"]);return(0,e.jsx)(j._,{title:S,subtitle:P,onClose:L,children:(0,e.jsx)(v.D,{label:(0,O.t)("role-picker-drawer.basic-roles.label","Basic Roles"),children:(0,e.jsx)(l.xI,{name:"role",control:Z,render:({field:{onChange:b,ref:G,...w}})=>(0,e.jsx)(m.z,{...w,options:D,onChange:Y=>{T("roleCollection",[Y,...W]),b(Y)}})})})})}},68031:(te,E,a)=>{a.d(E,{r:()=>v});var e=a(74848),l=a(83827),u=a(44826);const j=Object.values(l.X).filter(m=>m!==l.X.None).map(m=>({label:m,value:m}));function v({value:m,onChange:O,"aria-label":o,inputId:D,autoFocus:P,...x}){return(0,e.jsx)(u.l6,{inputId:D,value:m,options:j,onChange:L=>O(L.value??l.X.None),placeholder:"Choose role...","aria-label":o,autoFocus:P,...x})}},99002:(te,E,a)=>{a.r(E),a.d(E,{default:()=>ys});var e=a(74848),l=a(22803),u=a(96540),y=a(58779),j=a(32370),v=a(88849),m=a(29675),O=a(10247),o=a(11817),D=a(61351),P=a(71488),x=a(54122),L=a(61491),M=a(71468),Z=a(60997),X=a(37e3),T=a(87638),S=a(87116),W=a(93604),b=a(54594),G=a(17097);const w={revokeInvite:G.eb},Y=(0,M.connect)(null,w);class re extends u.PureComponent{render(){const{invitee:n,revokeInvite:t}=this.props;return(0,e.jsxs)("tr",{children:[(0,e.jsx)("td",{children:n.email}),(0,e.jsx)("td",{children:n.name}),(0,e.jsxs)("td",{className:"text-right",children:[(0,e.jsx)(W.b,{icon:"copy",variant:"secondary",size:"sm",getText:()=>n.url,children:"Copy Invite"}),"\xA0"]}),(0,e.jsx)("td",{children:(0,e.jsx)(b.$n,{variant:"destructive",size:"sm",icon:"times",onClick:()=>t(n.code),"aria-label":"Revoke Invite"})})]})}}const oe=Y(re);class B extends u.PureComponent{render(){const{invitees:n}=this.props;return(0,e.jsxs)("table",{className:"filter-table form-inline",children:[(0,e.jsx)("thead",{children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{children:"Email"}),(0,e.jsx)("th",{children:"Name"}),(0,e.jsx)("th",{}),(0,e.jsx)("th",{style:{width:"34px"}})]})}),(0,e.jsx)("tbody",{"data-testid":"InviteesTable-body",children:n.map((t,i)=>(0,e.jsx)(oe,{invitee:t},`${t.id}-${i}`))})]})}}var _=a(25508),H=a(85545);const{selectAll:V,selectById:Te,selectTotal:he}=H.Tp,xe=(s,n)=>n,ve=(0,_.Mz)([V,xe],(s,n)=>{const t=new RegExp(n,"i");return s.filter(g=>t.test(g.name)||t.test(g.email))});var N=a(56276),A=a(60484),z=a(22560),K=a(60641),ee=a(88023),ie=a(2543),$=a(28082),se=a(15084),I=a(11488);function R(){return async(s,n)=>{try{s((0,I.Cj)());const{perPage:t,page:i,searchQuery:g,sort:h}=n().users,p=await(0,$.AI)().get("/api/org/users/search",(0,se.F)({perpage:t,page:i,query:g,sort:h}));if(T.TP.licensedAccessControlEnabled()&&T.TP.hasPermission(L.AccessControlAction.ActionUserRolesList)){s((0,I.dJ)());const d=T.TP.user.orgId,C=p?.orgUsers.map(f=>f.userId),r=await(0,$.AI)().post("/api/access-control/users/roles/search?includeMapped=true",{userIds:C,orgId:d});p.orgUsers.forEach(f=>{f.roles=r?r[f.userId]||[]:[]}),s((0,I.jE)())}s((0,I.Y_)(p))}catch{(0,I.g4)()}}}const ae=(0,ie.debounce)(s=>s(R()),300);function le(s){return async n=>{await(0,$.AI)().patch(`/api/org/users/${s.userId}`,{role:s.role}),n(R())}}function ue(s){return async n=>{await(0,$.AI)().delete(`/api/org/users/${s}`),n(R())}}function je(s){return async n=>{n((0,I.EC)(s)),n(R())}}function fe({sortBy:s}){const n=s.length?`${s[0].id}-${s[0].desc?"desc":"asc"}`:void 0;return async t=>{t((0,I.$u)(n)),t(R())}}function c(s){return async n=>{n((0,I.t_)(s)),ae(n)}}const U=s=>{const n=new RegExp(s.searchQuery,"i");return s.users.filter(t=>n.test(t.login)||n.test(t.email)||n.test(t.name))},J=s=>s.searchQuery;var be=a(23431);function k(s){return{searchQuery:J(s.users),pendingInvitesCount:he(s.invites),externalUserMngLinkName:s.users.externalUserMngLinkName,externalUserMngLinkUrl:s.users.externalUserMngLinkUrl}}const pe={changeSearchQuery:c},Qe=(0,M.connect)(k,pe)(({externalUserMngLinkName:s,externalUserMngLinkUrl:n,searchQuery:t,pendingInvitesCount:i,changeSearchQuery:g,onShowInvites:h,showInvites:p})=>{const d=[{label:"Users",value:"users"},{label:`Pending Invites (${i})`,value:"invites"}],r=T.TP.hasPermission(L.AccessControlAction.OrgUsersAdd)&&!(ee.Ay.disableLoginForm&&ee.Ay.externalUserMngInfo),f=()=>{(0,N.rR)("users_admin_actions_clicked",{category:"org_users",item:"manage_users_external"})};return(0,e.jsxs)("div",{className:"page-action-bar","data-testid":"users-action-bar",children:[(0,e.jsx)(A.I,{grow:!0,children:(0,e.jsx)(z.Z,{value:t,onChange:g,placeholder:"Search user by login, email or name"})}),i>0&&(0,e.jsx)("div",{style:{marginLeft:"1rem"},children:(0,e.jsx)(K.z,{value:p?"invites":"users",options:d,onChange:h})}),r&&(0,e.jsx)(b.z9,{href:"org/users/invite",children:"Invite"}),n&&(0,e.jsx)(b.z9,{onClick:f,href:(0,be.o)("manage-users"),target:"_blank",rel:"noopener",children:s})]})});function Ge(s){const n=J(s.users);return{users:U(s.users),searchQuery:J(s.users),page:s.users.page,totalPages:s.users.totalPages,perPage:s.users.perPage,invitees:ve(s.invites,n),externalUserMngInfo:s.users.externalUserMngInfo,isLoading:s.users.isLoading,rolesLoading:s.users.rolesLoading}}const Ye={loadUsers:R,fetchInvitees:G.G7,changePage:je,changeSort:fe,updateUser:le,removeUser:ue},ye=(0,M.connect)(Ge,Ye)(({users:s,page:n,totalPages:t,invitees:i,externalUserMngInfo:g,isLoading:h,rolesLoading:p,loadUsers:d,fetchInvitees:C,changePage:r,updateUser:f,removeUser:ge,changeSort:ne})=>{const[Q,De]=(0,u.useState)(!1),Fe=g?(0,Z.G)(g):"";(0,u.useEffect)(()=>{d(),C()},[C,d]);const As=(Le,Cs)=>{f({...Cs,role:Le})},Us=Le=>ge(Le.userId),Ds=()=>{De(!Q)},Ls=()=>{d()},Ts=()=>Q?(0,e.jsx)(B,{invitees:i}):(0,e.jsx)(S.b,{users:s,orgId:T.TP.user.orgId,rolesLoading:p,onRoleChange:As,onRemoveUser:Us,onUserRolesChange:Ls,fetchData:ne,changePage:r,page:n,totalPages:t});return(0,e.jsxs)(x.Y.Contents,{isLoading:!h,children:[(0,e.jsx)(Qe,{onShowInvites:Ds,showInvites:Q}),Fe&&(0,e.jsx)(X.F,{severity:"info",title:"",children:(0,e.jsx)("div",{dangerouslySetInnerHTML:{__html:Fe}})}),h&&Ts()]})});function Os(){return jsx(Page,{navId:"users",children:jsx(ye,{})})}var Ze=a(59830),Ee=a(40232),Xe=a(54731),q=a(48583),ce=a(6736),me=a(79784),Ie=a(45565),Re=a(73903),Oe=a(14123),Me=a(16110),we=a(29272),Be=a(90231);const He=({units:s,icon:n})=>s?.length?s.length>1?(0,e.jsx)(ce.m,{placement:"top",content:(0,e.jsx)(q.B,{direction:"column",children:s?.map(t=>(0,e.jsx)("span",{children:t.name},t.name))}),children:(0,e.jsx)(Pe,{icon:n,children:s.length})}):(0,e.jsx)(Pe,{icon:n,children:s[0].name}):null,Pe=(0,u.forwardRef)(({children:s,icon:n},t)=>(0,e.jsxs)(Be.a,{ref:t,display:"flex",alignItems:"center",marginRight:1,children:[(0,e.jsx)(me.I,{name:n})," ",(0,e.jsx)(Be.a,{marginLeft:1,children:s})]}));Pe.displayName="TooltipContent";const Ve=({users:s,showPaging:n,totalPages:t,onChangePage:i,currentPage:g,fetchData:h})=>{const p=(0,u.useMemo)(()=>s.some(r=>r.licensedRole),[s]),d=(0,u.useMemo)(()=>s.some(r=>r.orgs),[s]),C=(0,u.useMemo)(()=>[{id:"avatarUrl",header:"",cell:({cell:{value:r}})=>r&&(0,e.jsx)(Ee.e,{src:r,alt:"User avatar"})},{id:"login",header:"Login",cell:({row:{original:r}})=>(0,e.jsx)(Xe.Y,{color:"primary",inline:!1,href:`/admin/users/edit/${r.uid}`,title:"Edit user",children:r.login}),sortType:"string"},{id:"email",header:"Email",cell:({cell:{value:r}})=>r,sortType:"string"},{id:"name",header:"Name",cell:({cell:{value:r}})=>r,sortType:"string"},...d?[{id:"orgs",header:"Belongs to",cell:({cell:{value:r,row:f}})=>(0,e.jsxs)(q.B,{alignItems:"center",children:[(0,e.jsx)(He,{units:r,icon:"building"}),f.original.isAdmin&&(0,e.jsx)(ce.m,{placement:"top",content:"Grafana Admin",children:(0,e.jsx)(me.I,{name:"shield"})})]})}]:[],...p?[{id:"licensedRole",header:"Licensed role",cell:({cell:{value:r}})=>r==="None"?(0,e.jsxs)(Ie.E,{color:"disabled",children:[(0,e.jsx)(o.x6,{i18nKey:"admin.users-table.no-licensed-roles",children:"Not assigned"}),(0,e.jsx)(ce.m,{placement:"top",content:"A licensed role will be assigned when this user signs in",children:(0,e.jsx)(me.I,{name:"question-circle",style:{margin:"0 0 4 4"}})})]}):r}]:[],{id:"lastSeenAtAge",header:"Last active",headerTooltip:{content:"Time since user was seen using Grafana",iconName:"question-circle"},cell:({cell:{value:r}})=>(0,e.jsx)(e.Fragment,{children:r&&(0,e.jsx)(e.Fragment,{children:r==="10 years"?(0,e.jsx)(Ie.E,{color:"disabled",children:(0,e.jsx)(o.x6,{i18nKey:"admin.users-table.last-seen-never",children:"Never"})}):r})}),sortType:(r,f)=>new Date(r.original.lastSeenAt).getTime()-new Date(f.original.lastSeenAt).getTime()},{id:"authLabels",header:"Origin",cell:({cell:{value:r}})=>(0,e.jsx)(e.Fragment,{children:Array.isArray(r)&&r.length>0&&(0,e.jsx)(we.E,{label:r[0],removeIcon:!1,count:0})})},{id:"isDisabled",header:"",cell:({cell:{value:r}})=>(0,e.jsx)(e.Fragment,{children:r&&(0,e.jsx)(Re.v,{colorIndex:9,name:"Disabled"})})},{id:"edit",header:"",cell:({row:{original:r}})=>(0,e.jsx)(b.z9,{variant:"secondary",size:"sm",icon:"pen",href:`admin/users/edit/${r.uid}`,"aria-label":`Edit user ${r.name}`,tooltip:"Edit user"})}],[p,d]);return(0,e.jsxs)(q.B,{direction:"column",gap:2,children:[(0,e.jsx)(Oe.j,{columns:C,data:s,getRowId:r=>String(r.id),fetchData:h}),n&&(0,e.jsx)(q.B,{justifyContent:"flex-end",children:(0,e.jsx)(Me.d,{numberOfPages:t,currentPage:g,onNavigate:i})})]})};var F=a(8476);const Se=[],Ms=s=>{Se.push(s)},Je=y.Tp.pages.UserListPage.UserListAdminPage,ke={fetchUsers:F.hU,changeQuery:F.nM,changePage:F.yd,changeFilter:F.$u,changeSort:F.Vk},qe=s=>({users:s.userListAdmin.users,query:s.userListAdmin.query,showPaging:s.userListAdmin.showPaging,totalPages:s.userListAdmin.totalPages,page:s.userListAdmin.page,filters:s.userListAdmin.filters,isLoading:s.userListAdmin.isLoading}),Ne=(0,M.connect)(qe,ke)(({fetchUsers:s,query:n,changeQuery:t,users:i,showPaging:g,changeFilter:h,filters:p,totalPages:d,page:C,changePage:r,changeSort:f,isLoading:ge})=>{const ne=(0,m.of)(_e);return(0,u.useEffect)(()=>{s()},[s]),(0,e.jsxs)(x.Y.Contents,{children:[(0,e.jsx)("div",{className:ne.actionBar,"data-testid":Je.container,children:(0,e.jsxs)("div",{className:ne.row,children:[(0,e.jsx)(z.Z,{placeholder:"Search user by login, email, or name.",autoFocus:!0,value:n,onChange:t,escapeRegex:!1}),(0,e.jsx)(K.z,{options:[{label:"All users",value:!1},{label:"Active last 30 days",value:!0}],onChange:Q=>h({name:"activeLast30Days",value:Q}),value:p.find(Q=>Q.name==="activeLast30Days")?.value,className:ne.filter}),Se.map((Q,De)=>(0,e.jsx)(Q,{filters:p,onChange:h,className:ne.filter},De)),T.TP.hasPermission(L.AccessControlAction.UsersCreate)&&(0,e.jsx)(b.z9,{href:"admin/users/create",variant:"primary",children:(0,e.jsx)(o.x6,{i18nKey:"admin.users-list.create-button",children:"New user"})})]})}),!ge&&i.length===0?(0,e.jsx)(Ze.p,{message:(0,o.t)("users.empty-state.message","No users found"),variant:"not-found"}):(0,e.jsx)(Ve,{users:i,showPaging:g,totalPages:d,onChangePage:r,currentPage:C,fetchData:f})]})});function Ns(){return jsx(Page,{navId:"global-users",children:jsx(Ne,{})})}const _e=s=>({filter:(0,l.css)({margin:s.spacing(0,1),[s.breakpoints.down("sm")]:{margin:0}}),actionBar:(0,l.css)({marginBottom:s.spacing(2),display:"flex",alignItems:"flex-start",gap:s.spacing(2),[s.breakpoints.down("sm")]:{flexWrap:"wrap"}}),row:(0,l.css)({display:"flex",alignItems:"flex-start",textAlign:"left",marginBottom:s.spacing(.5),flexGrow:1,[s.breakpoints.down("sm")]:{flexWrap:"wrap",gap:s.spacing(2),width:"100%"}})}),Ks=null;var es=a(66384),ss=a(4158);const as=s=>{if(!s.includes(" "))return{browser:s,computer:""};const n=s.split(" ");return{browser:n[0],computer:n[1]}},Ke=(s,n)=>s.length>n?s.substring(0,n)+"...":s,ns=({value:s})=>{const n=as(s);return(0,e.jsx)(ce.m,{theme:"info-alt",content:s,placement:"top-end",interactive:!0,children:(0,e.jsxs)("span",{children:[Ke(n.browser,10),Ke(n.computer,10)]})})},ts=({devices:s,showPaging:n,totalPages:t,onChangePage:i,currentPage:g,fetchData:h})=>{const p=(0,u.useMemo)(()=>[{id:"avatarUrl",header:"",cell:({cell:{value:d}})=>d&&(0,e.jsx)(Ee.e,{src:d,alt:"User avatar"})},{id:"login",header:"Login",cell:({cell:{value:d}})=>"Anonymous"},{id:"userAgent",header:"User Agent",cell:({cell:{value:d}})=>(0,e.jsx)(ns,{value:d}),sortType:"string"},{id:"updatedAt",header:"Last active",cell:({cell:{value:d}})=>d,sortType:(d,C)=>new Date(d.original.updatedAt).getTime()-new Date(C.original.updatedAt).getTime()},{id:"clientIp",header:"Origin IP (address)",cell:({cell:{value:d}})=>d&&(0,e.jsx)(es.E,{text:d,color:"orange"})}],[]);return(0,e.jsxs)(q.B,{direction:"column",gap:2,children:[(0,e.jsx)(Oe.j,{columns:p,data:s,getRowId:d=>d.deviceId,fetchData:h}),n&&(0,e.jsx)(q.B,{justifyContent:"flex-end",children:(0,e.jsx)(Me.d,{numberOfPages:t,currentPage:g,onNavigate:i})}),s.length===0&&(0,e.jsx)(ss.Z,{children:(0,e.jsx)("span",{children:(0,e.jsx)(o.x6,{i18nKey:"admin.anon-users.not-found",children:"No anonymous users found."})})})]})},rs={fetchUsersAnonymousDevices:F.xq,changeAnonUserSort:F.A5,changeAnonPage:F.is,changeAnonQuery:F.Bc},os=s=>({devices:s.userListAnonymousDevices.devices,query:s.userListAnonymousDevices.query,showPaging:s.userListAnonymousDevices.showPaging,totalPages:s.userListAnonymousDevices.totalPages,page:s.userListAnonymousDevices.page,filters:s.userListAnonymousDevices.filters}),is=y.Tp.pages.UserListPage.UserListAdminPage,We=(0,M.connect)(os,rs)(({devices:s,fetchUsersAnonymousDevices:n,query:t,changeAnonQuery:i,filters:g,showPaging:h,totalPages:p,page:d,changeAnonPage:C,changeAnonUserSort:r})=>{const f=(0,m.of)(ls);return(0,u.useEffect)(()=>{n()},[n]),(0,e.jsxs)(x.Y.Contents,{children:[(0,e.jsx)("div",{className:f.actionBar,"data-testid":is.container,children:(0,e.jsxs)("div",{className:f.row,children:[(0,e.jsx)(z.Z,{placeholder:"Search devices by IP address.",autoFocus:!0,value:t,onChange:i}),(0,e.jsx)(K.z,{options:[{label:"Active last 30 days",value:!0}],value:g.find(ge=>ge.name==="activeLast30Days")?.value,className:f.filter})]})}),(0,e.jsx)(ts,{devices:s,showPaging:h,totalPages:p,onChangePage:C,currentPage:d,fetchData:r})]})});function $s(){return jsx(Page,{navId:"anonymous-users",children:jsx(We,{})})}const ls=s=>({filter:(0,l.css)({margin:s.spacing(0,1),[s.breakpoints.down("sm")]:{margin:0}}),actionBar:(0,l.css)({marginBottom:s.spacing(2),display:"flex",alignItems:"flex-start",gap:s.spacing(2),[s.breakpoints.down("sm")]:{flexWrap:"wrap"}}),row:(0,l.css)({display:"flex",alignItems:"flex-start",textAlign:"left",marginBottom:s.spacing(.5),flexGrow:1,[s.breakpoints.down("sm")]:{flexWrap:"wrap",gap:s.spacing(2),width:"100%"}})}),Fs=null;var Ae=a(65728),Ue=a(25356),cs=a(81876),ze=a(43908);const ds=y.Tp.pages.UserListPage.UsersListPublicDashboardsPage.DashboardsListModal,gs=({email:s,onDismiss:n})=>{const t=(0,m.of)(us),{data:i,isLoading:g}=(0,Ae.kd)(s);return(0,e.jsx)(Ue.a,{className:t.modal,isOpen:!0,title:j.$.featureToggles.newDashboardSharingComponent?(0,o.t)("public-dashboard-users-access-list.modal.shared-dashboard-modal-title","Shared dashboards"):(0,o.t)("public-dashboard-users-access-list.modal.dashboard-modal-title","Public dashboards"),onDismiss:n,children:g?(0,e.jsx)("div",{className:t.loading,children:(0,e.jsx)(cs._,{text:(0,o.t)("public-dashboard-users-access-list.dashboard-modal.loading-text","Loading...")})}):i?.map(h=>(0,e.jsxs)("div",{className:t.listItem,"data-testid":ds.listItem(h.dashboardUid),children:[(0,e.jsx)("p",{className:t.dashboardTitle,children:h.dashboardTitle}),(0,e.jsxs)("div",{className:t.urlsContainer,children:[(0,e.jsx)("a",{rel:"noreferrer",target:"_blank",className:(0,l.cx)("external-link",t.url),href:(0,P.mL)(h.publicDashboardAccessToken),onClick:n,children:j.$.featureToggles.newDashboardSharingComponent?(0,e.jsx)(o.x6,{i18nKey:"public-dashboard-users-access-list.dashboard-modal.external-link",children:"External link"}):(0,e.jsx)(o.x6,{i18nKey:"public-dashboard-users-access-list.dashboard-modal.public-dashboard-link",children:"Public dashboard URL"})}),(0,e.jsx)("span",{className:t.urlsDivider,children:"\u2022"}),(0,e.jsx)("a",{className:(0,l.cx)("external-link",t.url),href:(0,P.gN)(h.dashboardUid,h.slug),onClick:n,children:j.$.featureToggles.newDashboardSharingComponent?(0,e.jsx)(o.x6,{i18nKey:"public-dashboard-users-access-list.dashboard-modal.sharing-setting",children:"Sharing settings"}):(0,e.jsx)(o.x6,{i18nKey:"public-dashboard-users-access-list.dashboard-modal.public-dashboard-setting",children:"Public dashboard settings"})})]}),(0,e.jsx)("hr",{className:t.divider})]},h.dashboardUid))})},hs=({email:s})=>{const n=(0,o.t)("public-dashboard-users-access-list.dashboard-modal.open-dashboard-list-text","Open dashboards list");return(0,e.jsx)(ze.$s,{children:({showModal:t,hideModal:i})=>(0,e.jsx)(b.$n,{variant:"secondary",size:"sm",icon:"question-circle",title:n,"aria-label":n,onClick:()=>t(gs,{email:s,onDismiss:i})})})},us=s=>({modal:(0,l.css)({width:"590px"}),loading:(0,l.css)({display:"flex",justifyContent:"center"}),listItem:(0,l.css)({display:"flex",flexDirection:"column",gap:s.spacing(.5)}),divider:(0,l.css)({margin:s.spacing(1.5,0),color:s.colors.text.secondary}),urlsContainer:(0,l.css)({display:"flex",gap:s.spacing(.5),[s.breakpoints.down("sm")]:{flexDirection:"column"}}),urlsDivider:(0,l.css)({color:s.colors.text.secondary,[s.breakpoints.down("sm")]:{display:"none"}}),dashboardTitle:(0,l.css)({fontSize:s.typography.body.fontSize,fontWeight:s.typography.fontWeightBold,marginBottom:0}),url:(0,l.css)({fontSize:s.typography.body.fontSize})}),ms=({user:s,hideModal:n})=>{const[t]=(0,Ae.g9)(),i=(0,m.of)(vs),g=()=>{t({email:s.email}),n()};return(0,e.jsxs)(Ue.a,{className:i.modal,isOpen:!0,title:(0,o.t)("public-dashboard-users-access-list.delete-user-modal.revoke-access-title","Revoke access"),onDismiss:n,children:[(0,e.jsx)("p",{className:i.description,children:(0,e.jsxs)(o.x6,{i18nKey:"public-dashboard-users-access-list.delete-user-modal.revoke-user-access-modal-desc-line1",children:["Are you sure you want to revoke access for ",{email:s.email},"?"]})}),(0,e.jsx)("p",{className:i.description,children:j.$.featureToggles.newDashboardSharingComponent?(0,e.jsxs)(o.x6,{i18nKey:"public-dashboard-users-access-list.delete-user-shared-dashboards-modal.revoke-user-access-modal-desc-line2",shouldUnescape:!0,children:["This action will immediately revoke ",{email:s.email},"'s access to all shared dashboards."]}):(0,e.jsxs)(o.x6,{i18nKey:"public-dashboard-users-access-list.delete-user-modal.revoke-user-access-modal-desc-line2",shouldUnescape:!0,children:["This action will immediately revoke ",{email:s.email},"'s access to all public dashboards."]})}),(0,e.jsxs)(Ue.a.ButtonRow,{children:[(0,e.jsx)(b.$n,{type:"button",variant:"secondary",onClick:n,fill:"outline",children:(0,e.jsx)(o.x6,{i18nKey:"public-dashboard-users-access-list.delete-user-modal.delete-user-cancel-button",children:"Cancel"})}),(0,e.jsx)(b.$n,{type:"button",variant:"destructive",onClick:g,children:(0,e.jsx)(o.x6,{i18nKey:"public-dashboard-users-access-list.delete-user-modal.delete-user-revoke-access-button",children:"Revoke access"})})]})]})},xs=({user:s})=>{const n=(0,o.t)("public-dashboard-users-access-list.delete-user-modal.delete-user-button-text","Delete user");return(0,e.jsx)(ze.$s,{children:({showModal:t,hideModal:i})=>(0,e.jsx)(b.$n,{size:"sm",variant:"destructive",onClick:()=>t(ms,{user:s,hideModal:i}),icon:"times","aria-label":n,title:n})})},vs=s=>({modal:(0,l.css)({width:"500px"}),description:(0,l.css)({fontSize:s.typography.body.fontSize,margin:0})}),js=y.Tp.pages.UserListPage.publicDashboards,fs=()=>{const{data:s,isLoading:n}=(0,Ae.AK)();return(0,e.jsx)(x.Y.Contents,{isLoading:n,children:(0,e.jsxs)("table",{className:"filter-table form-inline","data-testid":js.container,children:[(0,e.jsx)("thead",{children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{children:(0,e.jsx)(o.x6,{i18nKey:"public-dashboard-users-access-list.table-header.email-label",children:"Email"})}),(0,e.jsxs)("th",{children:[(0,e.jsx)("span",{children:(0,e.jsx)(o.x6,{i18nKey:"public-dashboard-users-access-list.table-header.activated-label",children:"Activated"})}),(0,e.jsx)(ce.m,{placement:"top",content:(0,o.t)("public-dashboard-users-access-list.table-header.activated-tooltip","Earliest time user has been an active user to a dashboard"),children:(0,e.jsx)(me.I,{name:"info-circle"})})]}),(0,e.jsx)("th",{children:(0,e.jsx)(o.x6,{i18nKey:"public-dashboard-users-access-list.table-header.last-active-label",children:"Last active"})}),(0,e.jsx)("th",{children:(0,e.jsx)(o.x6,{i18nKey:"public-dashboard-users-access-list.table-header.origin-label",children:"Origin"})}),(0,e.jsx)("th",{children:(0,e.jsx)(o.x6,{i18nKey:"public-dashboard-users-access-list.table-header.role-label",children:"Role"})}),(0,e.jsx)("th",{})]})}),(0,e.jsx)("tbody",{children:s?.map(t=>(0,e.jsxs)("tr",{children:[(0,e.jsx)("td",{className:"max-width-10",children:(0,e.jsx)("span",{className:"ellipsis",title:t.email,children:t.email})}),(0,e.jsx)("td",{className:"max-width-10",children:t.firstSeenAtAge}),(0,e.jsx)("td",{className:"max-width-10",children:t.lastSeenAtAge}),(0,e.jsx)("td",{className:"max-width-10",children:(0,e.jsxs)(q.B,{gap:2,children:[(0,e.jsx)("span",{children:(0,e.jsxs)(o.x6,{i18nKey:"public-dashboard-users-access-list.table-body.dashboard-count",count:t.totalDashboards,children:[{count:t.totalDashboards}," dashboards"]})}),(0,e.jsx)(hs,{email:t.email})]})}),(0,e.jsx)("td",{className:"max-width-10",children:(0,e.jsx)(Re.v,{name:"Viewer",colorIndex:19})}),(0,e.jsx)("td",{className:"text-right",children:(0,e.jsx)(xs,{user:t})})]},t.email))})]})})};var bs=(s=>(s.ADMIN="admin",s.ORG="org",s.PUBLIC_DASHBOARDS="public-dashboards",s.ANON="anon",s))(bs||{});const de=y.Tp.pages.UserListPage,$e=({view:s,setView:n})=>(0,e.jsx)(v.o,{label:j.$.featureToggles.newDashboardSharingComponent?(0,o.t)("users-access-list.tabs.shared-dashboard-users-tab-title","Shared dashboard users"):(0,o.t)("users-access-list.tabs.public-dashboard-users-tab-title","Public dashboard users"),active:s==="public-dashboards",onChangeTab:()=>n("public-dashboards"),"data-testid":de.tabs.publicDashboardsUsers}),ps={admin:(0,e.jsx)(Ne,{}),org:(0,e.jsx)(ye,{}),"public-dashboards":(0,e.jsx)(fs,{}),anon:(0,e.jsx)(We,{})};function ys(){const s=(0,m.of)(Ps),n=D.TP.hasPermission(L.AccessControlAction.UsersRead),t=D.TP.hasPermission(L.AccessControlAction.OrgUsersRead),[i,g]=(0,u.useState)(()=>n?"admin":t?"org":null),h=t&&n;return(0,e.jsxs)(x.Y,{navId:"global-users",children:[h?(0,e.jsxs)(O.U,{className:s.tabsMargin,children:[(0,e.jsx)(v.o,{label:"All users",active:i==="admin",onChangeTab:()=>g("admin"),"data-testid":de.tabs.allUsers}),(0,e.jsx)(v.o,{label:"Organization users",active:i==="org",onChangeTab:()=>g("org"),"data-testid":de.tabs.orgUsers}),j.$.anonymousEnabled&&(0,e.jsx)(v.o,{label:"Anonymous devices",active:i==="anon",onChangeTab:()=>g("anon"),"data-testid":de.tabs.anonUserDevices}),(0,P.AY)()&&(0,e.jsx)($e,{view:i,setView:g})]}):(0,P.AY)()&&(0,e.jsxs)(O.U,{className:s.tabsMargin,children:[(0,e.jsx)(v.o,{label:"Users",active:i==="org",onChangeTab:()=>g("org"),"data-testid":de.tabs.users}),(0,e.jsx)($e,{view:i,setView:g})]}),i?ps[i]:(0,e.jsx)(ye,{})]})}const Ps=s=>({tabsMargin:(0,l.css)({marginBottom:s.spacing(3)})})},87116:(te,E,a)=>{a.d(E,{b:()=>ve});var e=a(74848),l=a(96540),u=a(58779),y=a(32370),j=a(40232),v=a(45565),m=a(90231),O=a(6736),o=a(79784),D=a(73903),P=a(54594),x=a(48583),L=a(14123),M=a(16110),Z=a(65164),X=a(60156),T=a(26185),S=a(22803),W=a(49785),b=a(29675),G=a(66384),w=a(97531);const Y=({disabled:N,user:A})=>{const[z,K]=(0,l.useState)(!1),{badge:ee,badgeDisabled:ie}=(0,b.of)(re),$=N?ie:ee,se=(0,W.mN)({defaultValues:{name:A.name,role:A.role,roles:A.roles}}),{watch:I}=se,R=()=>{N||K(!0)};return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(x.B,{gap:1,children:[(0,e.jsx)(G.E,{className:$,color:"blue",onClick:R,text:I("role")}),A.roles&&A.roles.length>0&&(0,e.jsx)(G.E,{className:$,color:"blue",onClick:R,text:`+${A.roles.length}`})]}),z&&(0,e.jsx)(W.Op,{...se,children:(0,e.jsx)(w.I,{onClose:()=>K(!1)})})]})};function re(N){return{badge:(0,S.css)({cursor:"pointer"}),badgeDisabled:(0,S.css)({cursor:"not-allowed"})}}var oe=a(29272),B=a(87638),_=a(11817),H=a(61491),V=a(68031);const Te=`This user's role is not editable because it is synchronized from your auth provider.
Refer to the Grafana authentication docs for details.`,he=N=>{const A=N?.isExternallySynced;return!B.TP.hasPermissionInMetadata(H.AccessControlAction.OrgUsersWrite,N)||A},xe=u.Tp.pages.UserListPage.UsersListPage,ve=({users:N,orgId:A,onRoleChange:z,onUserRolesChange:K,onRemoveUser:ee,fetchData:ie,changePage:$,page:se,totalPages:I,rolesLoading:R})=>{const[ae,le]=(0,l.useState)(null),[ue,je]=(0,l.useState)([]);(0,l.useEffect)(()=>{async function c(){try{if(B.TP.hasPermission(H.AccessControlAction.ActionRolesList)){let U=await(0,T.RL)(A);je(U)}}catch{console.error("Error loading options")}}B.TP.licensedAccessControlEnabled()&&c()},[A]);const fe=(0,l.useMemo)(()=>[{id:"avatarUrl",header:"",cell:({cell:{value:c}})=>c&&(0,e.jsx)(j.e,{src:c,alt:"User avatar"})},{id:"login",header:"Login",cell:({cell:{value:c}})=>(0,e.jsx)("div",{children:c}),sortType:"string"},{id:"email",header:"Email",cell:({cell:{value:c}})=>c,sortType:"string"},{id:"name",header:"Name",cell:({cell:{value:c}})=>c,sortType:"string"},{id:"lastSeenAtAge",header:"Last active",cell:({cell:{value:c}})=>(0,e.jsx)(e.Fragment,{children:c&&(0,e.jsx)(e.Fragment,{children:c==="10 years"?(0,e.jsx)(v.E,{color:"disabled",children:(0,e.jsx)(_.x6,{i18nKey:"admin.org-uers.last-seen-never",children:"Never"})}):c})}),sortType:(c,U)=>new Date(c.original.lastSeenAt).getTime()-new Date(U.original.lastSeenAt).getTime()},{id:"role",header:"Role",cell:({cell:{value:c},row:{original:U}})=>{const J=he(U),be=async(k,pe,Ce)=>{await(0,T.eA)(k,pe,Ce),K&&K()};return y.$.featureToggles.rolePickerDrawer?(0,e.jsx)(Y,{disabled:J,user:U}):B.TP.licensedAccessControlEnabled()?(0,e.jsx)(X.y,{userId:U.userId,roles:U.roles,apply:!0,onApplyRoles:be,isLoading:R,orgId:A,roleOptions:ue,basicRole:c,onBasicRoleChange:k=>z(k,U),basicRoleDisabled:J,basicRoleDisabledMessage:Te,width:40}):(0,e.jsx)(V.r,{"aria-label":"Role",value:c,disabled:J,onChange:k=>z(k,U)})}},{id:"info",header:"",cell:({row:{original:c}})=>he(c)&&(0,e.jsx)(m.a,{display:"flex",alignItems:"center",marginLeft:1,children:(0,e.jsx)(O.m,{interactive:!0,content:(0,e.jsx)("div",{children:(0,e.jsxs)(_.x6,{i18nKey:"admin.org-users.not-editable",children:["This user's role is not editable because it is synchronized from your auth provider. Refer to the\xA0",(0,e.jsx)("a",{href:"https://grafana.com/docs/grafana/latest/administration/user-management/manage-org-users/#change-a-users-organization-permissions",rel:"noreferrer",target:"_blank",children:"Grafana authentication docs"}),"\xA0for details."]})}),children:(0,e.jsx)(o.I,{name:"question-circle"})})})},{id:"authLabels",header:"Origin",cell:({cell:{value:c}})=>(0,e.jsx)(e.Fragment,{children:Array.isArray(c)&&c.length>0&&(0,e.jsx)(oe.E,{label:c[0],removeIcon:!1,count:0})})},{id:"isDisabled",header:"",cell:({cell:{value:c}})=>(0,e.jsx)(e.Fragment,{children:c&&(0,e.jsx)(D.v,{colorIndex:9,name:"Disabled"})})},{id:"delete",header:"",cell:({row:{original:c}})=>B.TP.hasPermissionInMetadata(H.AccessControlAction.OrgUsersRemove,c)&&(0,e.jsx)(P.$n,{size:"sm",variant:"destructive",onClick:()=>{le(c)},icon:"times","aria-label":`Delete user ${c.name}`})}],[R,A,ue,K,z]);return(0,e.jsxs)(x.B,{direction:"column",gap:2,"data-testid":xe.container,children:[(0,e.jsx)(L.j,{columns:fe,data:N,getRowId:c=>String(c.userId),fetchData:ie}),(0,e.jsx)(x.B,{justifyContent:"flex-end",children:(0,e.jsx)(M.d,{onNavigate:$,currentPage:se,numberOfPages:I,hideWhenSinglePage:!0})}),!!ae&&(0,e.jsx)(Z.u,{body:`Are you sure you want to delete user ${ae?.login}?`,confirmText:"Delete",title:"Delete",onDismiss:()=>{le(null)},isOpen:!0,onConfirm:()=>{ae&&(ee(ae),le(null))}})]})}},4158:(te,E,a)=>{a.d(E,{Z:()=>y});var e=a(74848),l=a(22803),u=a(29675);const y=({children:v})=>{const m=(0,u.of)(j);return(0,e.jsx)("div",{className:m.container,children:v})},j=v=>({container:(0,l.css)({backgroundColor:v.colors.background.secondary,color:v.colors.text.secondary,padding:v.spacing(4),textAlign:"center"})})}}]);

//# sourceMappingURL=UserListPage.808f57304e9248aa7a4f.js.map