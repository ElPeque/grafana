"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[6777],{60156:(ee,I,t)=>{t.d(I,{y:()=>d});var e=t(74848),y=t(96540),l=t(41053),B=t(87638),a=t(61491),P=t(71623),c=t(26185);const d=({basicRole:A,roles:u,userId:f,orgId:h,onBasicRoleChange:L,roleOptions:N,disabled:F,basicRoleDisabled:k,basicRoleDisabledMessage:J,apply:r=!1,onApplyRoles:s,pendingRoles:n,maxWidth:g,width:S,isLoading:x})=>{const[{loading:U,value:W=u||[]},M]=(0,l.A)(async()=>{try{if(u)return u;if(r&&n?.length)return n;if(B.TP.hasPermission(a.AccessControlAction.ActionUserRolesList)&&f>0)return await(0,c.Xh)(f,h)}catch{console.error("Error loading options")}return[]},[h,f,n,u]);(0,y.useEffect)(()=>{h&&M()},[M,h]);const $=async O=>{r?s&&s(O,f,h):(await(0,c.eA)(O,f,h),await M())},z=B.TP.hasPermission(a.AccessControlAction.ActionUserRolesAdd)&&B.TP.hasPermission(a.AccessControlAction.ActionUserRolesRemove);return(0,e.jsx)(P.n,{appliedRoles:W,basicRole:A,onRolesChange:$,onBasicRoleChange:L,roleOptions:N,isLoading:U||x,disabled:F,basicRoleDisabled:k,basicRoleDisabledMessage:J,showBasicRole:!0,apply:r,canUpdateRoles:z,maxWidth:g,width:S})}},68031:(ee,I,t)=>{t.d(I,{r:()=>P});var e=t(74848),y=t(83827),l=t(44826);const a=Object.values(y.X).filter(c=>c!==y.X.None).map(c=>({label:c,value:c}));function P({value:c,onChange:d,"aria-label":A,inputId:u,autoFocus:f,...h}){return(0,e.jsx)(l.l6,{inputId:u,value:c,options:a,onChange:L=>d(L.value??y.X.None),placeholder:"Choose role...","aria-label":A,autoFocus:f,...h})}},80877:(ee,I,t)=>{t.r(I),t.d(I,{ServiceAccountsListPageUnconnected:()=>ne,default:()=>Ee});var e=t(74848),y=t(22803),l=t(55127),B=t.n(l),a=t(96540),P=t(71468),c=t(29675),d=t(54594),A=t(48583),u=t(60484),f=t(22560),h=t(90231),L=t(60641),N=t(59830),F=t(65164),k=t(54122),J=t(88023),r=t(87638),s=t(11817),n=t(61491),g=t(70255),S=t(14123),x=t(16110),U=t(40232),W=t(54731),M=t(79784),$=t(99764),z=t(60156),O=t(68031);const j=({services:o,onRoleChange:i,roleOptions:K,onRemoveButtonClick:D,onDisable:v,onEnable:C,onAddTokenClick:V,showPaging:Y,totalPages:se,onChangePage:_,currentPage:ae,isLoading:b})=>{const q=(0,a.useMemo)(()=>[{id:"avatarUrl",header:"",cell:({cell:{value:m},row:{original:p}})=>X(m,p,b,"avatarUrl")},{id:"name",header:"Account",cell:({cell:{value:m},row:{original:p}})=>X(m,p,b),sortType:"string"},{id:"id",header:"ID",cell:({cell:{value:m},row:{original:p}})=>X(m,p,b,"id")},{id:"role",header:"Roles",cell:({cell:{value:m},row:{original:p}})=>G(m,p,b,K,i)},{id:"tokens",header:"Tokens",cell:({cell:{value:m},row:{original:p}})=>X(m,p,b,"tokens")},{id:"actions",header:"",cell:({row:{original:m}})=>te(m,b,V,C,v,D)}],[b,V,v,C,D,i,K]);return(0,e.jsxs)(A.B,{direction:"column",gap:2,children:[(0,e.jsx)(S.j,{columns:q,data:o,getRowId:m=>String(m.id)}),Y&&se>1&&(0,e.jsx)(A.B,{justifyContent:"flex-end",children:(0,e.jsx)(x.d,{numberOfPages:se,currentPage:ae,onNavigate:_})})]})},X=(o,i,K,D)=>{if(K)return D==="avatarUrl"?(0,e.jsx)(g.A,{circle:!0,width:24,height:24}):(0,e.jsx)(g.A,{width:100});const v=`/org/serviceaccounts/${i.uid}`,C=`Edit service account's ${name} details`;switch(D){case"avatarUrl":return(0,e.jsx)("a",{"aria-label":C,href:v,children:(0,e.jsx)(U.e,{src:o,alt:"User avatar"})});case"id":return(0,e.jsx)(W.Y,{href:v,"aria-label":C,color:"secondary",inline:!1,children:i.login});case"tokens":return(0,e.jsxs)(A.B,{alignItems:"center",children:[(0,e.jsx)(M.I,{name:"key-skeleton-alt"}),(0,e.jsx)(W.Y,{href:v,"aria-label":C,color:"primary",inline:!1,children:o||"No tokens"})]});default:return(0,e.jsx)(W.Y,{href:v,"aria-label":C,color:"primary",inline:!1,children:o})}},G=(o,i,K,D,v)=>{const C=r.TP.hasPermission(n.AccessControlAction.ActionRolesList)&&r.TP.hasPermission(n.AccessControlAction.ActionUserRolesList),V=r.TP.hasPermissionInMetadata(n.AccessControlAction.ServiceAccountsWrite,i);return K?(0,e.jsx)(g.A,{width:100}):r.TP.licensedAccessControlEnabled()?C&&(0,e.jsx)(z.y,{userId:i.id,orgId:i.orgId,basicRole:o,roles:i.roles||[],onBasicRoleChange:Y=>v(Y,i),roleOptions:D,basicRoleDisabled:!V,disabled:i.isExternal||i.isDisabled,width:40}):(0,e.jsx)(O.r,{"aria-label":"Role",value:o,disabled:i.isExternal||!V||i.isDisabled,onChange:Y=>v(Y,i)})},te=(o,i,K,D,v,C)=>i?(0,e.jsx)(g.A,{width:100}):o.isExternal?(0,e.jsx)(A.B,{alignItems:"center",justifyContent:"flex-end",children:(0,e.jsx)($.K,{disabled:!0,name:"lock",size:"md",tooltip:"This is a managed service account and cannot be modified."})}):(0,e.jsxs)(A.B,{alignItems:"center",justifyContent:"flex-end",children:[r.TP.hasPermission(n.AccessControlAction.ServiceAccountsWrite)&&!o.tokens&&(0,e.jsx)(d.$n,{onClick:()=>K(o),disabled:o.isDisabled,children:"Add token"}),r.TP.hasPermissionInMetadata(n.AccessControlAction.ServiceAccountsWrite,o)&&(o.isDisabled?(0,e.jsx)(d.$n,{variant:"secondary",size:"md",onClick:()=>D(o),children:"Enable"}):(0,e.jsx)(d.$n,{variant:"secondary",size:"md",onClick:()=>v(o),children:"Disable"})),r.TP.hasPermissionInMetadata(n.AccessControlAction.ServiceAccountsDelete,o)&&(0,e.jsx)($.K,{name:"trash-alt","aria-label":`Delete service account ${o.name}`,variant:"secondary",onClick:()=>C(o)})]});j.displayName="ServiceAccountTable";var oe=t(51706),R=t(42042);function w(o){return{...o.serviceAccounts}}const ce={changePage:R.yd,changeQuery:R.nM,fetchACOptions:R.pJ,fetchServiceAccounts:R.iJ,deleteServiceAccount:R.W4,updateServiceAccount:R.mV,changeStateFilter:R.qS,createServiceAccountToken:R.yC},re=(0,P.connect)(w,ce),Q=[{label:"All",value:n.ServiceAccountStateFilter.All},{label:"With expired tokens",value:n.ServiceAccountStateFilter.WithExpiredTokens},{label:"Disabled",value:n.ServiceAccountStateFilter.Disabled}];J.Ay.featureToggles.externalServiceAccounts&&Q.push({label:"Managed",value:n.ServiceAccountStateFilter.External});const ne=({page:o,changePage:i,totalPages:K,serviceAccounts:D,isLoading:v,roleOptions:C,query:V,serviceAccountStateFilter:Y,changeQuery:se,fetchACOptions:_,fetchServiceAccounts:ae,deleteServiceAccount:b,updateServiceAccount:q,changeStateFilter:m,createServiceAccountToken:p})=>{const[Pe,le]=(0,a.useState)(!1),[De,de]=(0,a.useState)(!1),[fe,ue]=(0,a.useState)(!1),[xe,ve]=(0,a.useState)(""),[T,H]=(0,a.useState)(null),Ce=(0,c.of)(Z);(0,a.useEffect)(()=>{ae({withLoadingIndicator:!0}),r.TP.licensedAccessControlEnabled()&&_()},[_,ae]);const ie=D.length===0&&Y===n.ServiceAccountStateFilter.All&&!V,Te=async(E,We)=>{const Ke={...We,role:E};q(Ke),r.TP.licensedAccessControlEnabled()&&_()},ye=E=>{se(E)},ge=E=>{m(E)},Me=E=>{H(E),de(!0)},je=async()=>{T&&b(T.uid),Ae()},Se=E=>{H(E),ue(!0)},Oe=()=>{T&&q({...T,isDisabled:!0}),he()},Re=E=>{q({...E,isDisabled:!1})},pe=E=>{H(E),le(!0)},Ie=async E=>{T&&p(T.uid,E,ve)},Be=()=>{le(!1),H(null),ve("")},Ae=()=>{de(!1),H(null)},he=()=>{ue(!1),H(null)},Le=(0,e.jsx)("a",{className:"external-link",href:"https://grafana.com/docs/grafana/latest/administration/service-accounts/",target:"_blank",rel:"noopener noreferrer",children:"documentation."}),Ue=(0,e.jsxs)("span",{children:["Service accounts and their tokens can be used to authenticate against the Grafana API. Find out more in our"," ",Le]});return(0,e.jsx)(k.Y,{navId:"serviceaccounts",subTitle:Ue,actions:(0,e.jsx)(e.Fragment,{children:!ie&&r.TP.hasPermission(n.AccessControlAction.ServiceAccountsCreate)&&(0,e.jsx)(d.z9,{href:"org/serviceaccounts/create",variant:"primary",children:"Add service account"})}),children:(0,e.jsxs)(k.Y.Contents,{children:[(0,e.jsxs)(A.B,{justifyContent:"space-between",wrap:"wrap",children:[(0,e.jsx)(u.I,{grow:!0,children:(0,e.jsx)(f.Z,{className:Ce.filterInput,placeholder:"Search service account by name",value:V,onChange:ye})}),(0,e.jsx)(h.a,{marginBottom:1,children:(0,e.jsx)(L.z,{options:Q,onChange:ge,value:Y})})]}),!v&&!ie&&D.length===0&&(0,e.jsx)(N.p,{variant:"not-found",message:(0,s.t)("service-accounts.empty-state.message","No services accounts found")}),!v&&ie&&(0,e.jsx)(N.p,{variant:"call-to-action",button:(0,e.jsx)(d.z9,{disabled:!r.TP.hasPermission(n.AccessControlAction.ServiceAccountsCreate),href:"org/serviceaccounts/create",icon:"key-skeleton-alt",size:"lg",children:(0,e.jsx)(s.x6,{i18nKey:"service-accounts.empty-state.button-title",children:"Add service account"})}),message:(0,s.t)("service-accounts.empty-state.title","You haven't created any service accounts yet"),children:(0,e.jsx)(s.x6,{i18nKey:"service-accounts.empty-state.more-info",children:"Remember, you can provide specific permissions for API access to other applications"})}),(v||D.length!==0)&&(0,e.jsx)(j,{services:D,showPaging:!0,totalPages:K,onChangePage:i,currentPage:o,onRoleChange:Te,roleOptions:C,onRemoveButtonClick:Me,onDisable:Se,onEnable:Re,onAddTokenClick:pe,isLoading:v}),T&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(F.u,{isOpen:De,body:`Are you sure you want to delete '${T.name}'${T.tokens?` and ${T.tokens} accompanying ${B()("token",T.tokens)}`:""}?`,confirmText:"Delete",title:"Delete service account",onConfirm:je,onDismiss:Ae}),(0,e.jsx)(F.u,{isOpen:fe,title:"Disable service account",body:`Are you sure you want to disable '${T.name}'?`,confirmText:"Disable service account",onConfirm:Oe,onDismiss:he}),(0,e.jsx)(oe.z,{isOpen:Pe,token:xe,serviceAccountLogin:T.login,onCreateToken:Ie,onClose:Be})]})]})})},Z=o=>({filterInput:(0,y.css)({maxWidth:o.spacing(50)})}),Ee=re(ne)},51706:(ee,I,t)=>{t.d(I,{z:()=>F});var e=t(74848),y=t(22803),l=t(96540),B=t(24726),a=t(32370),P=t(29675),c=t(25356),d=t(86489),A=t(34128),u=t(60641),f=t(45225),h=t(54594),L=t(93604);const N=[{label:"No expiration",value:!1},{label:"Set expiration date",value:!0}],F=({isOpen:r,token:s,serviceAccountLogin:n,onCreateToken:g,onClose:S})=>{const x=new Date;x.setDate(x.getDate()+1);const U=new Date;a.$.tokenExpirationDayLimit!==void 0&&a.$.tokenExpirationDayLimit>-1?U.setDate(U.getDate()+a.$.tokenExpirationDayLimit+1):U.setDate(864e13);const W=a.$.tokenExpirationDayLimit!==void 0&&a.$.tokenExpirationDayLimit>0,[M,$]=(0,l.useState)(""),[z,O]=(0,l.useState)(""),[j,X]=(0,l.useState)(W),[G,te]=(0,l.useState)(x),[oe,R]=(0,l.useState)(G!==""),w=(0,P.of)(J);(0,l.useEffect)(()=>{r&&$(`${n}-${(0,B.A)()}`)},[n,r]);const ce=Z=>{R(Z!==""),te(Z)},re=()=>{g({name:z||M,secondsToLive:j?k(G):void 0})},Q=()=>{O(""),$(""),X(W),te(x),R(G!==""),S()},ne=s?"Service account token created":"Add service account token";return(0,e.jsx)(c.a,{isOpen:r,title:ne,onDismiss:Q,className:w.modal,children:s?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(d.D,{label:"Token",description:"Copy the token now as you will not be able to see it again. Losing a token requires creating a new one.",children:(0,e.jsxs)("div",{className:w.modalTokenRow,children:[(0,e.jsx)(A.p,{name:"tokenValue",value:s,readOnly:!0}),(0,e.jsx)(L.b,{className:w.modalCopyToClipboardButton,variant:"primary",size:"md",icon:"copy",getText:()=>s,children:"Copy clipboard"})]})}),(0,e.jsxs)(c.a.ButtonRow,{children:[(0,e.jsx)(L.b,{variant:"primary",getText:()=>s,onClipboardCopy:Q,children:"Copy to clipboard and close"}),(0,e.jsx)(h.$n,{variant:"secondary",onClick:Q,children:"Close"})]})]}):(0,e.jsxs)("div",{children:[(0,e.jsx)(d.D,{label:"Display name",description:"Name to easily identify the token",required:!0,children:(0,e.jsx)(A.p,{name:"tokenName",value:z,placeholder:M,onChange:Z=>{O(Z.currentTarget.value)}})}),(0,e.jsx)(d.D,{label:"Expiration",children:(0,e.jsx)(u.z,{options:N,value:j,onChange:X,size:"md"})}),j&&(0,e.jsx)(d.D,{label:"Expiration date",children:(0,e.jsx)(f.l,{onChange:ce,value:G,placeholder:"",minDate:x,maxDate:U})}),(0,e.jsx)(c.a.ButtonRow,{children:(0,e.jsx)(h.$n,{onClick:re,disabled:j&&!oe,children:"Generate token"})})]})})},k=r=>{const s=new Date(r),n=new Date;return Math.ceil((s.getTime()-n.getTime())/1e3)},J=r=>({modal:(0,y.css)({width:"550px"}),modalTokenRow:(0,y.css)({display:"flex"}),modalCopyToClipboardButton:(0,y.css)({marginLeft:r.spacing(.5)})})},42042:(ee,I,t)=>{t.d(I,{W4:()=>L,iJ:()=>u,mV:()=>h,nM:()=>k,pJ:()=>A,qS:()=>J,yC:()=>N,yd:()=>r});var e=t(2543),y=t.n(e),l=t(28082),B=t(26185),a=t(61351),P=t(61491),c=t(83410);const d="/api/serviceaccounts";function A(){return async s=>{try{if(a.TP.licensedAccessControlEnabled()&&a.TP.hasPermission(P.AccessControlAction.ActionRolesList)){const n=await(0,B.RL)();s((0,c.ew)(n))}}catch(n){console.error(n)}}}function u({withLoadingIndicator:s}={withLoadingIndicator:!1}){return async(n,g)=>{try{if(a.TP.hasPermission(P.AccessControlAction.ServiceAccountsRead)){s&&n((0,c.FW)());const{perPage:S,page:x,query:U,serviceAccountStateFilter:W}=g().serviceAccounts,M=await(0,l.AI)().get(`/api/serviceaccounts/search?perpage=${S}&page=${x}&query=${U}${F(W)}&accesscontrol=true`);if(a.TP.licensedAccessControlEnabled()&&a.TP.hasPermission(P.AccessControlAction.ActionUserRolesList)){n((0,c.dJ)());const $=a.TP.user.orgId,z=M?.serviceAccounts.map(j=>j.id),O=await(0,l.AI)().post("/api/access-control/users/roles/search",{userIds:z,orgId:$});M.serviceAccounts.forEach(j=>{j.roles=O?O[j.id]||[]:[]}),n((0,c.jE)())}n((0,c.zh)(M))}}catch(S){console.error(S)}finally{n((0,c.Yh)())}}}const f=(0,e.debounce)(s=>s(u()),500,{leading:!0});function h(s){return async n=>{await(0,l.AI)().patch(`${d}/${s.uid}?accesscontrol=true`,{...s}),n(u())}}function L(s){return async n=>{await(0,l.AI)().delete(`${d}/${s}`),n(u())}}function N(s,n,g){return async S=>{const x=await(0,l.AI)().post(`${d}/${s}/tokens`,n);g(x.key),S(u())}}const F=s=>{switch(s){case P.ServiceAccountStateFilter.WithExpiredTokens:return"&expiredTokens=true";case P.ServiceAccountStateFilter.Disabled:return"&disabled=true";case P.ServiceAccountStateFilter.External:return"&external=true";default:return""}};function k(s){return async n=>{n((0,c.L5)(s)),f(n)}}function J(s){return async n=>{n((0,c.c3)(s)),n(u())}}function r(s){return async n=>{n((0,c.EC)(s)),n(u())}}}}]);

//# sourceMappingURL=ServiceAccountsPage.2042ea8c386828852a87.js.map