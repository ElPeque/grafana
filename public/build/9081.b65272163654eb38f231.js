"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[9081],{2203:(Q,W,n)=>{n.d(W,{z:()=>x,e:()=>M});var l=n(74848),h=n(96540),N=n(63739),V=n(16669),z=n(86932),u=n(22803),$=n(34743),E=n(83505),Y=n(46885),I=n(59141),D=n(58779),Z=n(29675),A=n(75606),H=n(83525),B=n(94219);function d(t){const o={position:"relative",top:"auto",right:"auto",marginRight:0};return(0,l.jsx)("div",{style:{width:"100%",display:"flex",justifyContent:"flex-end",paddingBottom:"6px"},children:(0,l.jsx)(B.J,{onClick:t.onClick,style:t.style??o})})}const g=({timeZone:t,dataFrame:o,dataFrameFieldIndex:s,config:r,exemplarColor:e,clickedExemplarFieldIndex:a,setClickedExemplarFieldIndex:c})=>{const i=(0,Z.of)(f),[p,m]=(0,h.useState)(!1),[v,b]=(0,h.useState)(!1),y=[(0,$.UU)({fallbackAxisSideDirection:"end",crossAxis:!1,boundary:document.body}),(0,$.BN)()],{context:L,refs:j,floatingStyles:R}=(0,E.we)({open:p,placement:"bottom",onOpenChange:m,middleware:y,whileElementsMounted:Y.ll,strategy:"fixed"}),T=(0,E.s9)(L),P=(0,E.Mk)(L,{handleClose:(0,E.iB)(),enabled:a===void 0}),{getReferenceProps:G,getFloatingProps:U}=(0,E.bv)([T,P]);(0,h.useEffect)(()=>{a?.fieldIndex===s.fieldIndex&&a?.frameIndex===s.frameIndex||b(!1)},[a,s]);const F=()=>{const C=[(0,l.jsx)("rect",{fill:e,x:"3.38672",width:"4.78985",height:"4.78985",transform:"rotate(45 3.38672 0)"},"diamond"),(0,l.jsx)("path",{fill:e,d:"M1.94444 3.49988L0 5.44432L1.55552 6.99984L3.49996 5.05539L5.4444 6.99983L6.99992 5.44431L5.05548 3.49988L6.99983 1.55552L5.44431 0L3.49996 1.94436L1.5556 0L8.42584e-05 1.55552L1.94444 3.49988Z"},"x"),(0,l.jsx)("path",{fill:e,d:"M4 0L7.4641 6H0.535898L4 0Z"},"triangle"),(0,l.jsx)("rect",{fill:e,width:"5",height:"5"},"rectangle"),(0,l.jsx)("path",{fill:e,d:"M3 0.5L5.85317 2.57295L4.76336 5.92705H1.23664L0.146831 2.57295L3 0.5Z"},"pentagon"),(0,l.jsx)("path",{fill:e,d:"m2.35672,4.2425l0,2.357l1.88558,0l0,-2.357l2.3572,0l0,-1.88558l-2.3572,0l0,-2.35692l-1.88558,0l0,2.35692l-2.35672,0l0,1.88558l2.35672,0z"},"plus")];return C[s.frameIndex%C.length]},q=()=>{b(!0)},_=(0,h.useCallback)(()=>{const C=o.fields.filter(k=>k.config.links?.length&&k.config.links?.length>0)||[],et=[...C,...o.fields.filter(k=>!C.includes(k))],st=()=>{b(!1),m(!1),c(void 0)};let X=[],J=[];et.map((k,lt)=>{const O=k.values[s.fieldIndex];k.config.links?.length&&J?.push(...k.getLinks?.({valueRowIndex:s.fieldIndex})||[]);const nt=k.display?k.display(O):{text:`${O}`,numeric:+O};X.push({name:k.name,value:O,valueString:(0,I.cN)(nt),highlight:!1})});const ot={position:"relative",top:"35px",right:"5px",marginRight:0};return(0,l.jsxs)("div",{className:i.tooltip,ref:j.setFloating,style:R,...U(),children:[v&&(0,l.jsx)(d,{onClick:st,style:ot}),(0,l.jsx)(H.i,{displayValues:X,links:J})]})},[o.fields,s,i,v,c,R,U,j.setFloating]),tt=r.getSeries().find(C=>C.props.dataFrameFieldIndex?.frameIndex===s.frameIndex)?.props.lineColor,K=()=>{c(s),q()};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{ref:j.setReference,className:i.markerWrapper,"data-testid":D.Tp.components.DataSource.Prometheus.exemplarMarker,role:"button",tabIndex:0,...G(),onClick:K,onKeyDown:C=>{C.key==="Enter"&&K()},children:(0,l.jsx)("svg",{viewBox:"0 0 7 7",width:"7",height:"7",style:{fill:tt},className:(0,u.cx)(i.marble,(p||v)&&i.activeMarble),children:F()})}),(p||v)&&(0,l.jsx)(A.ZL,{children:_()})]})},f=t=>{const o=t.isDark?t.v1.palette.dark2:t.v1.palette.white,s=t.isDark?t.v1.palette.dark9:t.v1.palette.gray5,r=t.isDark?t.v1.palette.black:t.v1.palette.white,e=t.isDark?t.v1.palette.dark3:t.v1.palette.gray6;return{markerWrapper:(0,u.css)({padding:"0 4px 4px 4px",width:"8px",height:"8px",boxSizing:"content-box",transform:"translate3d(-50%, 0, 0)","&:hover":{"> svg":{transform:"scale(1.3)",opacity:1,filter:"drop-shadow(0 0 8px rgba(0, 0, 0, 0.5))"}}}),marker:(0,u.css)({width:0,height:0,borderLeft:"4px solid transparent",borderRight:"4px solid transparent",borderBottom:`4px solid ${t.v1.palette.red}`,pointerEvents:"none"}),wrapper:(0,u.css)({background:o,border:`1px solid ${s}`,borderRadius:t.shape.borderRadius(2),boxShadow:`0 0 20px ${r}`,padding:t.spacing(1)}),exemplarsTable:(0,u.css)({width:"100%","tr td":{padding:"5px 10px",whiteSpace:"nowrap",borderBottom:`4px solid ${t.components.panel.background}`},tr:{backgroundColor:t.colors.background.primary,"&:nth-child(even)":{backgroundColor:e}}}),valueWrapper:(0,u.css)({display:"flex",flexDirection:"row",flexWrap:"wrap",columnGap:t.spacing(1),"> span":{flexGrow:0},"> *":{flex:"1 1",alignSelf:"center"}}),tooltip:(0,u.css)({background:"none",padding:0,overflowY:"auto",maxHeight:"95vh",boxShadow:t.shadows.z2}),header:(0,u.css)({background:s,padding:"6px 10px",display:"flex"}),title:(0,u.css)({fontWeight:t.typography.fontWeightMedium,paddingRight:t.spacing(2),overflow:"hidden",display:"inline-block",whiteSpace:"nowrap",textOverflow:"ellipsis",flexGrow:1}),body:(0,u.css)({fontWeight:t.typography.fontWeightMedium,borderRadius:t.shape.borderRadius(2),overflow:"hidden"}),marble:(0,u.css)({display:"block",opacity:.5,[t.transitions.handleMotion("no-preference")]:{transition:"transform 0.15s ease-out"}}),activeMarble:(0,u.css)({transform:"scale(1.3)",opacity:1,filter:"drop-shadow(0 0 8px rgba(0, 0, 0, 0.5))"})}},x=({exemplars:t,timeZone:o,config:s,visibleSeries:r})=>{const e=(0,h.useRef)(),[a,c]=(0,h.useState)();(0,h.useLayoutEffect)(()=>{s.addHook("init",m=>{e.current=m})},[s]);const i=(0,h.useCallback)((m,v)=>{const b=m.fields.find(P=>P.name===N.LE),y=m.fields.find(P=>P.name===N.Bc);if(!b||!y||!e.current)return;const L=Object.keys(e.current.scales).find(P=>!["x","y"].some(G=>G===P))??V.s,j=e.current.scales[L].min,R=e.current.scales[L].max;let T=y.values[v.fieldIndex];return j!=null&&T<j&&(T=j),R!=null&&T>R&&(T=R),{x:e.current.valToPos(b.values[v.fieldIndex],"x"),y:e.current.valToPos(T,L)}},[]),p=(0,h.useCallback)((m,v)=>{const b=r!==void 0?w(r,m,v):!0,y=r!==void 0?S(m,v,r):void 0;return b?(0,l.jsx)(g,{setClickedExemplarFieldIndex:c,clickedExemplarFieldIndex:a,timeZone:o,dataFrame:m,dataFrameFieldIndex:v,config:s,exemplarColor:y}):(0,l.jsx)(l.Fragment,{})},[s,o,r,c,a]);return(0,l.jsx)(z.a,{config:s,id:"exemplars",events:t,renderEventMarker:p,mapEventToXYCoords:i})},M=(t,o)=>{const s=t.series.filter(e=>e.props.show),r=[];return o?.length&&s.forEach(e=>{const a=e.props?.dataFrameFieldIndex?.frameIndex,c=e.props?.dataFrameFieldIndex?.fieldIndex;if(a!==void 0&&c!==void 0){const i=o[a]?.fields[c];i?.labels&&r.push({labels:i.labels,color:e.props?.lineColor??""})}}),{labels:r,totalSeriesCount:t.series.length}},S=(t,o,s)=>{let r;return s.labels.some(e=>{const a=Object.keys(e.labels),c=t.fields.filter(i=>a.find(p=>p===i.name));return c.length&&c.every((p,m,v)=>{const b=p.values[o.fieldIndex];return e.labels[p.name]===b})?(r=e.color,!0):!1}),r},w=(t,o,s)=>{let r=!1;return t.labels.length===t.totalSeriesCount?r=!0:t.labels.some(e=>{const a=Object.keys(e.labels);if(Object.keys(e.labels).length===0)r=!0;else{const c=o.fields.filter(i=>a.find(p=>p===i.name));c.length&&(r=t.labels.some(i=>Object.keys(i.labels).every(p=>{const m=i.labels[p];return c.find(v=>v.values[s.fieldIndex]===m)})))}return r}),r}},87719:(Q,W,n)=>{n.d(W,{p:()=>B});var l=n(74848),h=n(96540),N=n(63739),V=n(59141),z=n(24415),u=n(22803),$=n(2543),E=n(55794),Y=n.n(E),I=n(29675);const D=({step:d,y:g,dragBounds:f,mapPositionToValue:x,formatValue:M,onChange:S})=>{const w=(0,I.$j)();let t=g,o="none";g<(f.top??0)&&(o="top"),g>(f.bottom??0)+22&&(o="bottom"),o==="bottom"&&(t=f.bottom??g),o==="top"&&(t=f.top??g);const s=typeof S!="function",r=(0,I.of)(Z,d,o,s),[e,a]=(0,h.useState)(d.value),c=(0,h.useMemo)(()=>w.colors.getContrastText(w.visualization.getColorByName(d.color)),[d.color,w]);return(0,l.jsx)(Y(),{axis:"y",grid:[1,1],disabled:s,onStop:s?$.noop:(i,p)=>(S(x(p.lastY)),!1),onDrag:(i,p)=>a(x(p.lastY)),position:{x:0,y:t},bounds:f,children:(0,l.jsx)("div",{className:r.handle,style:{color:c},children:(0,l.jsx)("span",{className:r.handleText,children:M(e)})})})};D.displayName="ThresholdDragHandle";const Z=(d,g,f,x)=>{const M=d.visualization.getColorByName(g.color),S=A(f),w=f!=="none";return{handle:(0,u.css)({display:"flex",alignItems:"center",position:"absolute",left:0,width:"calc(100% - 9px)",height:"18px",marginTop:"-9px",borderColor:M,cursor:x?"initial":"grab",borderTopRightRadius:d.shape.radius.default,borderBottomRightRadius:d.shape.radius.default,background:M,fontSize:d.typography.bodySmall.fontSize,"&:before":S},w&&{marginTop:0,borderRadius:d.shape.radius.default}),handleText:(0,u.css)({textAlign:"center",width:"100%",display:"block",textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden"})}};function A(d){const g=d==="none",f=x=>({content:"''",position:"absolute",bottom:0,top:0,width:0,height:0,left:0,borderRightStyle:"solid",borderRightWidth:`${x}px`,borderRightColor:"inherit",borderTop:`${x}px solid transparent`,borderBottom:`${x}px solid transparent`});return g?(0,u.css)({...f(9),left:"-9px"}):d==="top"?(0,u.css)({...f(5),left:"calc(50% - 2.5px)",top:"-7px",transform:"rotate(90deg)"}):d==="bottom"?(0,u.css)({...f(5),left:"calc(50% - 2.5px)",top:"calc(100% - 2.5px)",transform:"rotate(-90deg)"}):""}const H=60,B=({config:d,fieldConfig:g,onThresholdsChange:f})=>{const x=(0,h.useRef)(),[M,S]=(0,h.useState)(0);(0,h.useLayoutEffect)(()=>{d.setPadding([0,H,0,0]),d.addHook("init",t=>{x.current=t}),d.addHook("draw",()=>{S(t=>t+1)})},[d]);const w=(0,h.useMemo)(()=>{const t=x.current;if(!t)return null;const o=g.defaults.thresholds;if(!o)return null;const s=(0,z.M)(g.defaults,N.PU.number),r=g.defaults.decimals,e=[];for(let a=0;a<o.steps.length;a++){const c=o.steps[a],i=t.valToPos(c.value,s);if(Number.isNaN(i)||!Number.isFinite(i))continue;const p=t.bbox.height/window.devicePixelRatio,v=typeof f=="function"?y=>{const L=[...o.steps.slice(0,a),...o.steps.slice(a+1),{...o.steps[a],value:y}].sort((j,R)=>j.value-R.value);f({...o,steps:L})}:void 0,b=(0,l.jsx)(D,{step:c,y:i,dragBounds:{top:0,bottom:p},mapPositionToValue:y=>t.posToVal(y,s),formatValue:y=>(0,V.j_)(s)(y,r).text,onChange:v},`${c.value}-${a}`);e.push(b)}return e},[M,g,f]);return x.current?(0,l.jsx)("div",{style:{position:"absolute",overflow:"visible",left:`${(x.current.bbox.left+x.current.bbox.width)/window.devicePixelRatio}px`,top:`${x.current.bbox.top/window.devicePixelRatio}px`,width:`${H}px`,height:`${x.current.bbox.height/window.devicePixelRatio}px`},children:w}):null};B.displayName="ThresholdControlsPlugin"}}]);

//# sourceMappingURL=9081.b65272163654eb38f231.js.map