"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[8979],{43269:(ne,I,t)=>{t.d(I,{o:()=>N});var e=t(96540),a=t(61491),O=t(40449);function N(C){const j=(0,a.useDispatch)(),S=(0,e.useRef)(C);S.current=C,(0,e.useEffect)(()=>()=>{j((0,O.N)({cleanupAction:S.current}))},[j])}},3991:(ne,I,t)=>{t.d(I,{D:()=>j});var e=t(74848),a=t(22803),O=t(29675),N=t(40271),C=t(48583);function j({label:h,actions:X,id:F}){const H=(0,O.of)(S);return(0,e.jsxs)("div",{className:H.container,children:[(0,e.jsx)(N.J,{className:H.label,id:F,children:h}),(0,e.jsx)(C.B,{direction:"row",gap:1,children:X})]})}const S=h=>({container:(0,a.css)({display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",padding:h.spacing(1,2),backgroundColor:h.colors.background.secondary,borderBottom:`1px solid ${h.colors.border.medium}`}),label:(0,a.css)({margin:0})})},38979:(ne,I,t)=>{t.d(I,{By:()=>yt,R_:()=>be});var e=t(74848),a=t(22803),O=t(16172);function N(n,i,l){return(0,O.f)(n,-i,l)}const C=null;var j=t(61501),S=t(29407);function h(n,i,l){const s=(0,S.a)(n,l?.in);return s.setTime(s.getTime()+i*j.Cg),s}const X=null;var F=t(79197);function H(n,i,l){return(0,F.A)(n,i*j.s0,l)}const _=null;function G(n,i,l){return H(n,-i,l)}const Se=null;var b=t(96540),ee=t(49785),oe=t(42941),k=t(70713),m=t(53027),A=t(28082),R=t(29675),K=t(13147),L=t(48583),y=t(54594),q=t(37e3),ie=t(90231),he=t(44617),ge=t(60484),xe=t(34128),re=t(60232),W=t(19224),ve=t(58528),Be=t(45565),Me=t(17687),Ie=t(43269),Z=t(11817),Ae=t(6353),We=t(91536),Ue=t(9912),Ee=t(88214),ye=t(85651),Fe=t(4013),De=t(27219),Ce=t(3991),de=t(50292),Ke=t(26676),we=t(3886),Re=t(91793),Ve=t(79784),ze=t(6736),Ge=t(73903),ce=t(25356),$e=t(22560),Pe=t(81876),Je=t(9365),ae=t(70584),Oe=t(88663);function He({onSelect:n,isOpen:i,onClose:l}){const s=(0,R.of)(Ze),[d,B]=(0,b.useState)(),[u,T]=(0,b.useState)(null),{useGetAlertmanagerAlertsQuery:$}=Je.m,{currentData:E=[],isFetching:g,isError:Y}=$({amSourceName:Ee.hY,filter:{inhibited:!0,silenced:!0,active:!0}}),[U,J]=(0,b.useState)(""),M=(0,b.useMemo)(()=>{const r={};return!g&&E&&E.forEach(o=>{r[o.labels.alertname]||(r[o.labels.alertname]=[]);const f=Object.fromEntries(Object.entries(o.annotations).filter(([V])=>!V.startsWith("__"))),P=Object.fromEntries(Object.entries(o.labels).filter(([V])=>!V.startsWith("__")));o={...o,annotations:f,labels:P},r[o.labels.alertname].push(o)}),r},[g,E]),D=(0,b.useCallback)(r=>{B(r),T(null)},[]),x=(0,b.useMemo)(()=>{const r=Object.keys(M).filter(f=>f.toLowerCase().includes(U.toLowerCase())),o={};return r.forEach(f=>{o[f]=M[f]}),o},[M,U]);if(Y)return null;const c=Object.keys(x||[]),v=({index:r,style:o})=>{if(!x)return null;const f=c[r],P=f===d;return(0,e.jsxs)("button",{type:"button",title:f,style:o,className:(0,a.cx)(s.rowButton,{[s.rowOdd]:r%2===1,[s.rowSelected]:P}),onClick:()=>D(f),children:[(0,e.jsx)("div",{className:(0,a.cx)(s.ruleTitle,s.rowButtonTitle),children:f}),(0,e.jsx)("div",{className:s.alertFolder,children:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(Ve.I,{name:"folder"})," ",x[f][0].labels.grafana_folder??""]})})]})},w=(r,o)=>{const P=r.map(p=>p.labels).map(ae.Dd),V=(0,Oe.Q)(P),te=(0,Oe.$)((0,ae.Dd)(o.labels),V);return te.length?(0,ae.M4)((0,ae.zm)(te)):(0,ae.M4)(o.labels)},Q=({index:r,style:o})=>{const f=(0,b.useMemo)(()=>d?M[d]:[],[]),P=f[r],V=u?.includes(P),te=(0,b.useMemo)(()=>w(f,P),[f,P]),pe=()=>{if(V&&u){T(u.filter(p=>p!==P));return}T([...u||[],P])};return(0,e.jsx)("button",{type:"button",style:o,className:(0,a.cx)(s.rowButton,s.instanceButton,{[s.rowOdd]:r%2===1,[s.rowSelected]:V}),onClick:pe,children:(0,e.jsx)("div",{className:s.rowButtonTitle,title:P.labels.alertname,children:(0,e.jsx)(ze.m,{placement:"bottom",content:(0,e.jsx)("pre",{children:JSON.stringify(P,null,2)}),theme:"info",children:(0,e.jsx)("div",{children:te.map((p,z)=>(0,e.jsx)(Ge.v,{name:p,className:s.tag},z))})})})})},me=()=>{const r=u?.map(o=>({status:"firing",annotations:o.annotations,labels:o.labels,startsAt:o.startsAt,endsAt:o.endsAt,generatorURL:o.generatorURL,fingerprint:o.fingerprint}))||[];n(r),ue()},ue=()=>{B(void 0),T(null),J(""),se("")},fe=()=>{ue(),l()},se=r=>{J(r)};return(0,e.jsx)("div",{children:(0,e.jsxs)(ce.a,{title:"Select alert instances",className:s.modal,closeOnEscape:!0,isOpen:i,onDismiss:fe,contentClassName:s.modalContent,children:[(0,e.jsxs)("div",{className:s.container,children:[(0,e.jsx)($e.Z,{value:U,onChange:se,title:"Search alert rule",placeholder:"Search alert rule",autoFocus:!0}),(0,e.jsx)("div",{children:d&&"Select one or more instances from the list below"||""}),(0,e.jsxs)("div",{className:s.column,children:[g&&(0,e.jsx)(Pe._,{text:"Loading rules...",className:s.loadingPlaceholder}),!g&&(0,e.jsx)(k.default,{children:({height:r,width:o})=>(0,e.jsx)(Re.Y1,{itemSize:50,height:r,width:o,itemCount:c.length,children:v})})]}),(0,e.jsxs)("div",{className:s.column,children:[!d&&!g&&(0,e.jsx)("div",{className:s.selectedRulePlaceholder,children:(0,e.jsx)("div",{children:"Select an alert rule to get a list of available firing instances"})}),g&&(0,e.jsx)(Pe._,{text:"Loading rule...",className:s.loadingPlaceholder}),d&&M[d].length&&!g&&(0,e.jsx)(k.default,{children:({width:r,height:o})=>(0,e.jsx)(Re.Y1,{itemSize:32,height:o,width:r,itemCount:M[d].length||0,children:Q})})]})]}),(0,e.jsxs)(ce.a.ButtonRow,{children:[(0,e.jsx)(y.$n,{type:"button",variant:"secondary",onClick:fe,children:(0,e.jsx)(Z.x6,{i18nKey:"alerting.common.cancel",children:"Cancel"})}),(0,e.jsx)(y.$n,{type:"button",variant:"primary",disabled:!(d&&u),onClick:()=>{d&&u&&me()},children:"Add alert data to payload"})]})]})})}const Ze=n=>{const i=(0,y.my)(n);return{container:(0,a.css)({display:"grid",gridTemplateColumns:"1fr 1.5fr",gridTemplateRows:"min-content auto",gap:n.spacing(2),flex:1}),tag:(0,a.css)({margin:"5px"}),column:(0,a.css)({flex:"1 1 auto"}),alertLabels:(0,a.css)({overflowX:"auto",height:"32px"}),ruleTitle:(0,a.css)({height:"22px",fontWeight:n.typography.fontWeightBold}),rowButton:(0,a.css)(i,{padding:n.spacing(.5),overflow:"hidden",textOverflow:"ellipsis",textAlign:"left",whiteSpace:"nowrap",cursor:"pointer",border:"2px solid transparent","&:disabled":{cursor:"not-allowed",color:n.colors.text.disabled}}),rowButtonTitle:(0,a.css)({overflowX:"auto"}),rowSelected:(0,a.css)({borderColor:n.colors.primary.border}),rowOdd:(0,a.css)({backgroundColor:n.colors.background.secondary}),instanceButton:(0,a.css)({display:"flex",gap:n.spacing(1),justifyContent:"space-between",alignItems:"center"}),loadingPlaceholder:(0,a.css)({height:"100%",display:"flex",justifyContent:"center",alignItems:"center"}),selectedRulePlaceholder:(0,a.css)({width:"100%",height:"100%",display:"flex",flexDirection:"column",justifyContent:"center",textAlign:"center",fontWeight:n.typography.fontWeightBold}),modal:(0,a.css)({height:"100%"}),modalContent:(0,a.css)({flex:1,display:"flex",flexDirection:"column"}),modalAlert:(0,a.css)({flexGrow:0}),warnIcon:(0,a.css)({fill:n.colors.warning.main}),labels:(0,a.css)({justifyContent:"flex-start"}),alertFolder:(0,a.css)({height:"20px",fontSize:n.typography.bodySmall.fontSize,color:n.colors.text.secondary,display:"flex",flexDirection:"row",justifyContent:"flex-start",columnGap:n.spacing(1),alignItems:"center"})}},Ye=[{name:"Receiver",type:"string",notes:"Name of the contact point that the notification is being sent to."},{name:"Status",type:"string",notes:"firing if at least one alert is firing, otherwise resolved"},{name:"Alerts",type:"[]Alert",notes:"List of alert objects that are included in this notification."},{name:"Alerts.Firing",type:"[]Alert",notes:"List of firing alerts"},{name:"Alerts.Resolved",type:"[]Alert",notes:"List of resolved alerts"},{name:"GroupLabels",type:"KeyValue",notes:"Labels these alerts were grouped by."},{name:"CommonLabels",type:"KeyValue",notes:"Labels common to all the alerts included in this notification."},{name:"CommonAnnotations",type:"KeyValue",notes:"Annotations common to all the alerts included in this notification."},{name:"ExternalURL",type:"string",notes:"Back link to the Grafana that sent the notification."}],Qe=[{name:"labels",type:"Object{}",notes:"Set of labels attached to the alert."},{name:"annotations",type:"Object{}",notes:"Set of annotations attached to the alert."},{name:"startsAt",type:"string (ISO8601)",notes:"Time the alert started firing."},{name:"endsAt",type:"string (ISO8601)",notes:"Time the alert ends firing."}],Xe=[{name:"Status",type:"string",notes:"firing or resolved."},{name:"Labels",type:"KeyValue",notes:"Set of labels attached to the alert."},{name:"Annotations",type:"KeyValue",notes:"Set of annotations attached to the alert."},{name:"Values",type:"KeyValue",notes:"The values of all instant queries, reduce and math expressions, and classic conditions for the alert. It does not contain time series data."},{name:"StartsAt",type:"time.Time",notes:"Time the alert started firing."},{name:"EndsAt",type:"time.Time",notes:"Only set if the end time of an alert is known. Otherwise set to a configurable timeout period from the time since the last alert was received."},{name:"GeneratorURL",type:"string",notes:"A back link to Grafana or external Alertmanager."},{name:"SilenceURL",type:"string",notes:"Link to Grafana silence for with labels for this alert pre-filled. Only for Grafana managed alerts."},{name:"DashboardURL",type:"string",notes:"Link to Grafana dashboard, if alert rule belongs to one. Only for Grafana managed alerts."},{name:"PanelURL",type:"string",notes:"Link to Grafana dashboard panel, if alert rule belongs to one. Only for Grafana managed alerts."},{name:"Fingerprint",type:"string",notes:"Fingerprint that can be used to identify the alert."},{name:"ValueString",type:"string",notes:"String that contains the labels and value of each reduced expression in the alert."}],ke=[{name:"SortedPairs",returns:"KeyValue",notes:"Returns sorted list of key & value string pairs"},{name:"Remove",args:"[]string",returns:"KeyValue",notes:"Returns a copy of the Key/Value map without the given keys."},{name:"Names",returns:"[]string",notes:"List of label names"},{name:"Values",returns:"[]string",notes:"List of label values"}],qe=`{
  "summary": "alert summary",
  "description": "alert description"
}
`;var Le=t(2178);function _e(){const n=(0,R.of)(et),i=(0,e.jsx)(je,{caption:(0,e.jsxs)("h4",{className:n.header,children:["Alert template data ",(0,e.jsx)("span",{children:"Available only when in the context of an Alert (e.g. inside .Alerts loop)"})]}),dataItems:Xe});return(0,e.jsx)(L.B,{gap:2,children:(0,e.jsx)(je,{caption:(0,e.jsxs)("h4",{className:n.header,children:["Notification template data ",(0,e.jsx)("span",{children:"Available in the context of a notification."})," "]}),dataItems:Ye,typeRenderer:l=>l==="[]Alert"?(0,e.jsx)(Le.B,{content:i,children:(0,e.jsx)("div",{className:n.interactiveType,children:l})}):l==="KeyValue"?(0,e.jsx)(Le.B,{content:(0,e.jsx)(tt,{}),children:(0,e.jsx)("div",{className:n.interactiveType,children:l})}):l})})}const et=n=>({header:(0,a.css)({color:n.colors.text.primary,span:{color:n.colors.text.secondary,fontSize:n.typography.bodySmall.fontSize}}),interactiveType:(0,a.css)({color:n.colors.text.link})});function je({dataItems:n,caption:i,typeRenderer:l}){const s=(0,R.of)(Te);return(0,e.jsxs)("table",{className:s.table,children:[i&&(0,e.jsx)("caption",{children:i}),(0,e.jsx)("thead",{children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{children:"Name"}),(0,e.jsx)("th",{children:"Type"}),(0,e.jsx)("th",{children:"Notes"})]})}),(0,e.jsx)("tbody",{children:n.map(({name:d,type:B,notes:u},T)=>(0,e.jsxs)("tr",{children:[(0,e.jsx)("td",{children:d}),(0,e.jsx)("td",{children:l?l(B):B}),(0,e.jsx)("td",{children:u})]},T))})]})}function tt(){const n=(0,R.of)(Te);return(0,e.jsxs)("div",{children:["KeyValue is a set of key/value string pairs that represent labels and annotations.",(0,e.jsx)("pre",{children:(0,e.jsx)("code",{children:qe})}),(0,e.jsxs)("table",{className:n.table,children:[(0,e.jsx)("caption",{children:"Key-value methods"}),(0,e.jsx)("thead",{children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{children:"Name"}),(0,e.jsx)("th",{children:"Arguments"}),(0,e.jsx)("th",{children:"Returns"}),(0,e.jsx)("th",{children:"Notes"})]})}),(0,e.jsx)("tbody",{children:ke.map(({name:i,args:l,returns:s,notes:d})=>(0,e.jsxs)("tr",{children:[(0,e.jsx)("td",{children:i}),(0,e.jsx)("td",{children:l}),(0,e.jsx)("td",{children:s}),(0,e.jsx)("td",{children:d})]},i))})]})]})}const Te=n=>({table:(0,a.css)({borderCollapse:"collapse",width:"100%",caption:{captionSide:"top"},"td, th":{padding:n.spacing(1,1)},thead:{fontWeight:n.typography.fontWeightBold},"tbody tr:nth-child(2n + 1)":{backgroundColor:n.colors.background.secondary},"tbody td:nth-child(1)":{fontWeight:n.typography.fontWeightBold},"tbody td:nth-child(2)":{fontStyle:"italic"}})});var nt=t(2543),at=t(6210),st=t(60641),lt=t(1530),ot=t(30378);const it={annotations:[{key:"",value:""}],labels:[{key:"",value:""}],status:"firing"},rt=({isOpen:n,onDismiss:i,onAccept:l})=>{const s=(0,R.of)(dt),[d,B]=(0,b.useState)([]),u=(0,ee.mN)({defaultValues:it,mode:"onBlur"}),T=u.watch("annotations"),$=u.watch("labels"),[E,g]=(0,b.useState)("firing"),Y=()=>{const D={annotations:T.filter(({key:x,value:c})=>!!x&&!!c).reduce((x,{key:c,value:v})=>({...x,[c]:v}),{}),labels:$.filter(({key:x,value:c})=>!!x&&!!c).reduce((x,{key:c,value:v})=>({...x,[c]:v}),{}),startsAt:"2023-04-01T00:00:00Z",endsAt:E==="firing"?(0,O.f)(new Date,1).toISOString():N(new Date,1).toISOString(),status:E,fingerprint:(0,nt.uniqueId)("fingerprint_")};B(x=>[...x,D]),u.reset()},U=()=>{l(d),B([]),u.reset(),g("firing")},J=()=>{const D=$.some(c=>c.key!==""&&c.value!==""),x=T.some(c=>c.key!==""&&c.value!=="");return D||x},M=[{label:"Firing",value:"firing"},{label:"Resolved",value:"resolved"}];return(0,e.jsx)(ce.a,{onDismiss:i,isOpen:n,title:"Add custom alerts",children:(0,e.jsx)(ee.Op,{...u,children:(0,e.jsxs)("form",{onSubmit:D=>{D.preventDefault(),D.stopPropagation(),u.reset(),g("firing")},children:[(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(at.Z,{children:(0,e.jsxs)(L.B,{direction:"column",gap:1,children:[(0,e.jsx)("div",{className:s.section,children:(0,e.jsx)(lt.A,{})}),(0,e.jsx)("div",{className:s.section,children:(0,e.jsx)(ot.Ay,{})}),(0,e.jsxs)("div",{className:s.flexWrapper,children:[(0,e.jsx)(st.z,{value:E,options:M,onChange:D=>g(D)}),(0,e.jsx)(y.$n,{onClick:Y,className:s.onAddButton,icon:"plus-circle",type:"button",variant:"secondary",disabled:!J(),children:"Add alert data"})]})]})})}),(0,e.jsx)("div",{className:s.onSubmitWrapper}),d.length>0&&(0,e.jsxs)(L.B,{direction:"column",gap:1,children:[(0,e.jsx)("h5",{children:" Review alert data to add to the payload:"}),(0,e.jsx)("pre",{className:s.result,"data-testid":"payloadJSON",children:JSON.stringify(d,null,2)})]}),(0,e.jsx)("div",{className:s.onSubmitWrapper,children:(0,e.jsx)(ce.a.ButtonRow,{children:(0,e.jsx)(y.$n,{onClick:U,disabled:d.length===0,className:s.onSubmitButton,children:"Add alert data to payload"})})})]})})})},dt=n=>({section:(0,a.css)({marginBottom:n.spacing(2)}),onAddButton:(0,a.css)({flex:"none",width:"fit-content",paddingRight:n.spacing(1),marginLeft:"auto"}),flexWrapper:(0,a.css)({display:"flex",flexDirection:"row",justifyContent:"space-between"}),onSubmitWrapper:(0,a.css)({display:"flex",flexDirection:"row",alignItems:"baseline",justifyContent:"flex-end"}),onSubmitButton:(0,a.css)({marginLeft:n.spacing(2)}),result:(0,a.css)({width:"570px",height:"363px"})}),ct="Reset to defaults";function mt({payload:n,setPayload:i,defaultPayload:l,setPayloadFormatError:s,payloadFormatError:d,className:B}){const u=(0,R.of)(ft),T=()=>{i(l)},[$,E]=(0,b.useState)(!1),g=()=>{E(!1)},Y=d!==null,U=()=>{try{const v=JSON.parse(n);JSON.stringify([...v]),s(null)}catch(v){throw s(v instanceof Error?v.message:"Invalid JSON."),v}},J=()=>{try{U(),E(!0)}catch{}},M=()=>{try{U(),c(!0)}catch{}},D=v=>{g(),c(!1),i(w=>{const Q=JSON.parse(w);return JSON.stringify([...Q,...v],void 0,2)})},[x,c]=(0,b.useState)(!1);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("div",{className:(0,a.cx)(u.wrapper,B),children:[(0,e.jsx)(Ce.D,{label:"Payload",actions:(0,e.jsxs)(L.B,{direction:"row",alignItems:"center",gap:.5,children:[(0,e.jsx)(re.m,{overlay:(0,e.jsxs)(W.W,{children:[(0,e.jsx)(W.W.Item,{label:"Use existing alert instances",disabled:Y,onClick:M}),(0,e.jsx)(W.W.Item,{label:"Add custom alert instance",disabled:Y,onClick:J}),(0,e.jsx)(W.W.Divider,{}),(0,e.jsx)(W.W.Item,{label:ct,onClick:T,destructive:!0})]}),children:(0,e.jsx)(y.$n,{variant:"secondary",size:"sm",icon:"angle-down",children:"Edit payload"})}),(0,e.jsx)(Ke.G,{content:(0,e.jsx)(ut,{}),placement:"top",fitContent:!0,children:(0,e.jsx)(y.$n,{variant:"secondary",fill:"outline",size:"sm",icon:"question-circle",children:"Reference"})})]})}),(0,e.jsx)("div",{className:u.editorWrapper,children:(0,e.jsx)(k.default,{children:({width:v,height:w})=>(0,e.jsx)(we.B,{containerStyles:u.editorContainer,width:v,height:w,language:"json",showLineNumbers:!0,showMiniMap:!1,value:n,readOnly:!1,onBlur:i,monacoOptions:{scrollBeyondLastLine:!1}})})})]}),(0,e.jsx)(rt,{isOpen:$,onDismiss:g,onAccept:D}),(0,e.jsx)(He,{onSelect:D,isOpen:x,onClose:()=>c(!1)})]})}const ut=()=>(0,e.jsx)(je,{dataItems:Qe}),ft=n=>({wrapper:(0,a.css)({display:"flex",flexDirection:"column",height:"100%"}),tooltip:(0,a.css)({paddingLeft:n.spacing(1)}),label:(0,a.css)({margin:0}),editorWrapper:(0,a.css)({flex:1}),editorContainer:(0,a.css)({width:"fit-content",border:"none"}),templateDataDocsHeader:(0,a.css)({color:n.colors.text.primary,span:{color:n.colors.text.secondary,fontSize:n.typography.bodySmall.fontSize}})}),pt=[{description:"Default templates for notification titles",example:`{{- /* This is a copy of the "default.title" template. */ -}}
{{- /* Edit the template name and template content as needed. */ -}}
{{ define "default.title.copy" }}
  [{{ .Status | toUpper }}{{ if eq .Status "firing" }}:{{ .Alerts.Firing | len }}{{ if gt (.Alerts.Resolved | len) 0 }}, RESOLVED:{{ .Alerts.Resolved | len }}{{ end }}{{ end }}] {{ .GroupLabels.SortedPairs.Values | join " " }} {{ if gt (len .CommonLabels) (len .GroupLabels) }}({{ with .CommonLabels.Remove .GroupLabels.Names }}{{ .Values | join " " }}{{ end }}){{ end }}
{{ end }}`},{description:"Default templates for notification messages",example:`{{- /* This is a copy of the "default.message" template. */ -}}
{{- /* Edit the template name and template content as needed. */ -}}
{{ define "default.message.copy" }}{{ if gt (len .Alerts.Firing) 0 }}**Firing**
{{ template "__text_alert_list.copy" .Alerts.Firing }}{{ if gt (len .Alerts.Resolved) 0 }}

{{ end }}{{ end }}{{ if gt (len .Alerts.Resolved) 0 }}**Resolved**
{{ template "__text_alert_list.copy" .Alerts.Resolved }}{{ end }}{{ end }}

{{ define "__text_alert_list.copy" }}{{ range . }}
Value: {{ template "__text_values_list.copy" . }}
Labels:
{{ range .Labels.SortedPairs }} - {{ .Name }} = {{ .Value }}
{{ end }}Annotations:
{{ range .Annotations.SortedPairs }} - {{ .Name }} = {{ .Value }}
{{ end }}{{ if gt (len .GeneratorURL) 0 }}Source: {{ .GeneratorURL }}
{{ end }}{{ if gt (len .SilenceURL) 0 }}Silence: {{ .SilenceURL }}
{{ end }}{{ if gt (len .DashboardURL) 0 }}Dashboard: {{ .DashboardURL }}
{{ end }}{{ if gt (len .PanelURL) 0 }}Panel: {{ .PanelURL }}
{{ end }}{{ end }}{{ end }}

{{ define "__text_values_list.copy" }}{{ if len .Values }}{{ $first := true }}{{ range $refID, $value := .Values -}}
{{ if $first }}{{ $first = false }}{{ else }}, {{ end }}{{ $refID }}={{ $value }}{{ end -}}
{{ else }}[no value]{{ end }}{{ end }}`},{description:"Print alerts with summary and description",example:`{{- /* Example displaying the summary and description annotations of each alert in the notification. */ -}}
{{- /* Edit the template name and template content as needed. */ -}}
{{ define "custom.alerts" -}}
{{ len .Alerts }} alert(s)
{{ range .Alerts -}}
  {{ template "alert.summary_and_description" . -}}
{{ end -}}
{{ end -}}

{{ define "alert.summary_and_description" }}
  Summary: {{.Annotations.summary}}
  Status: {{ .Status }}
  Description: {{.Annotations.description}}
{{ end -}}`},{description:"Print firing and resolved alerts",example:`{{- /* Example displaying firing and resolved alerts separately in the notification. */ -}}
{{- /* Edit the template name and template content as needed. */ -}}
{{ define "custom.firing_and_resolved_alerts" -}}
{{ len .Alerts.Resolved }} resolved alert(s)
{{ range .Alerts.Resolved -}}
  {{ template "alert.summary_and_description" . -}}
{{ end }}
{{ len .Alerts.Firing }} firing alert(s)
{{ range .Alerts.Firing -}}
  {{ template "alert.summary_and_description" . -}}
{{ end -}}
{{ end -}}

{{ define "alert.summary_and_description" }}
  Summary: {{.Annotations.summary}}
  Status: {{ .Status }}
  Description: {{.Annotations.description}}
{{ end -}}`},{description:"Print common labels and annotations",example:`{{- /* Example displaying labels and annotations that are common to all alerts in the notification.*/ -}}
{{- /* Edit the template name and template content as needed. */ -}}
{{ define "custom.common_labels_and_annotations" -}}
{{ len .Alerts.Resolved }} resolved alert(s)
{{ len .Alerts.Firing }} firing alert(s)

Common labels: {{ len .CommonLabels.SortedPairs }}
{{ range .CommonLabels.SortedPairs -}}
- {{ .Name }} = {{ .Value }}
{{ end }}

Common annotations: {{ len .CommonAnnotations.SortedPairs }}
{{ range .CommonAnnotations.SortedPairs }}
- {{ .Name }} = {{ .Value }}
{{ end }}

{{ end -}}`},{description:"Print individual labels and annotations",example:`{{- /* Example displaying all labels and annotations for each alert in the notification.*/ -}}
{{- /* Edit the template name and template content as needed. */ -}}
{{ define "custom.alert_labels_and_annotations" -}}
{{ len .Alerts.Resolved }} resolved alert(s)
{{ range .Alerts.Resolved -}}
  {{ template "alert.labels_and_annotations" . -}}
{{ end }}
{{ len .Alerts.Firing }} firing alert(s)
{{ range .Alerts.Firing -}}
  {{ template "alert.labels_and_annotations" . -}}
{{ end -}}
{{ end -}}

{{ define "alert.labels_and_annotations" }}
Alert labels: {{ len .Labels.SortedPairs }}
{{ range .Labels.SortedPairs -}}
- {{ .Name }} = {{ .Value }}
{{ end -}}
Alert annotations: {{ len .Annotations.SortedPairs }}
{{ range .Annotations.SortedPairs -}}
- {{ .Name }} = {{ .Value }}
{{ end -}}
{{ end -}}`},{description:"Print URLs for runbook and alert data in Grafana",example:`{{- /* Example displaying additional information, such as runbook link, DashboardURL and SilenceURL, for each alert in the notification.*/ -}}
{{- /* Edit the template name and template content as needed. */ -}}
{{ define "custom.alert_additional_details" -}}
{{ len .Alerts.Resolved }} resolved alert(s)
{{ range .Alerts.Resolved -}}
  {{ template "alert.additional_details" . -}}
{{ end }}
{{ len .Alerts.Firing }} firing alert(s)
{{ range .Alerts.Firing -}}
  {{ template "alert.additional_details" . -}}
{{ end -}}
{{ end -}}

{{ define "alert.additional_details" }}
- Dashboard: {{ .DashboardURL }}
- Panel: {{ .PanelURL }}
- AlertGenerator: {{ .GeneratorURL }}
- Silence: {{ .SilenceURL }}
- RunbookURL: {{ .Annotations.runbook_url}}
{{ end -}}`}];var ht=t(12314),gt=t(91835),xt=t(30930);const vt=Object.freeze({title:"",content:""}),At=n=>n.pathname.endsWith("/duplicate"),yt=({originalTemplate:n,prefill:i,alertmanager:l})=>{const s=(0,R.of)(Ne),d=(0,Me._2)(),[B]=(0,de.xW)({alertmanager:l}),[u]=(0,de.A1)({alertmanager:l}),{titleIsUnique:T}=(0,de.lx)({alertmanager:l,originalTemplate:n});(0,Ie.o)(p=>p.unifiedAlerting.saveAMConfig=Fe.jA);const $=(0,b.useRef)(null),E=l===Ee.hY,{error:g}=(0,Ue.$)(p=>p.saveAMConfig),[Y,U]=(0,oe.A)(!1),[J,M]=(0,b.useState)(be),[D,x]=(0,b.useState)(null),{isProvisioned:c}=(0,de.OA)(n),v=n?{title:n.title,content:n.content}:void 0,w=(0,K.h)({direction:"column",initialSize:E?.5:1,dragPosition:"middle"}),Q=(0,K.h)({direction:"row",initialSize:E?.6:1,dragPosition:"middle"}),me=(0,ee.mN)({mode:"onSubmit",defaultValues:i??v??vt}),{handleSubmit:ue,register:fe,formState:{errors:se,isSubmitting:r},getValues:o,setValue:f,watch:P}=me,V=async p=>{const z=(0,ye.nL)("/alerting/notifications",l,{tab:Ae.ActiveTab.NotificationTemplates});try{n?await u.execute({template:n,patch:p}):await B.execute({templateValues:p}),d.success("Template saved",`Template ${p.title} has been saved`),m.Ny.push(z)}catch(le){d.error("Error saving template",(0,ye.JZ)(le))}},te=p=>{const z=o("content"),le=z?`${z}
${p}`:p;f("content",le)},pe=(0,e.jsxs)(L.B,{children:[(0,e.jsx)(y.$n,{onClick:()=>$.current?.requestSubmit(),variant:"primary",size:"sm",disabled:r,children:(0,e.jsx)(Z.x6,{i18nKey:"common.save",children:"Save"})}),(0,e.jsx)(y.z9,{disabled:r,href:(0,ye.nL)("alerting/notifications",l,{tab:Ae.ActiveTab.NotificationTemplates}),variant:"secondary",size:"sm",children:(0,e.jsx)(Z.x6,{i18nKey:"common.cancel",children:"Cancel"})})]});return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(ee.Op,{...me,children:[(0,e.jsx)(We.H,{actions:pe}),(0,e.jsxs)("form",{onSubmit:ue(V),ref:$,className:s.form,"aria-label":"Template form",children:[g&&(0,e.jsx)(q.F,{severity:"error",title:"Error saving template",children:g.message||(0,A.NF)(g)&&g.data?.message||String(g)}),c&&(0,e.jsx)(ie.a,{grow:0,children:(0,e.jsx)(De.Yi,{resource:De.hk.Template})}),(0,e.jsxs)(he.n,{disabled:c,className:s.fieldset,children:[(0,e.jsx)(ge.I,{label:"Template group name",error:se?.title?.message,invalid:!!se.title?.message,required:!0,className:s.nameField,children:(0,e.jsx)(xe.p,{...fe("title",{required:{value:!0,message:"Required."},validate:{titleIsUnique:T}}),placeholder:"Give your template group a name",width:42,autoFocus:!0,id:"new-template-name"})}),(0,e.jsxs)("div",{...Q.containerProps,className:s.contentContainer,children:[(0,e.jsx)("div",{...Q.primaryProps,children:(0,e.jsxs)("div",{...w.containerProps,className:s.contentField,children:[(0,e.jsx)("div",{...w.primaryProps,children:(0,e.jsxs)("div",{className:(0,a.cx)(s.flexColumn,s.containerWithBorderAndRadius,s.minEditorSize),children:[(0,e.jsx)("div",{children:(0,e.jsx)(Ce.D,{label:"Template group",actions:(0,e.jsxs)(e.Fragment,{children:[E&&(0,e.jsx)(re.m,{overlay:(0,e.jsxs)(W.W,{children:[pt.map((p,z)=>(0,e.jsx)(W.W.Item,{label:p.description,onClick:()=>te(p.example)},z)),(0,e.jsx)(W.W.Divider,{}),(0,e.jsx)(W.W.Item,{label:"Examples documentation",url:"https://grafana.com/docs/grafana/latest/alerting/configure-notifications/template-notifications/examples/",target:"_blank",icon:"external-link-alt"})]}),children:(0,e.jsx)(y.$n,{variant:"secondary",size:"sm",icon:"angle-down",children:(0,e.jsx)(Z.x6,{i18nKey:"alerting.templates.editor.add-example",children:"Add example"})})}),(0,e.jsx)(y.$n,{icon:"question-circle",size:"sm",fill:"outline",variant:"secondary",onClick:U,children:(0,e.jsx)(Z.x6,{i18nKey:"common.help",children:"Help"})})]})})}),(0,e.jsx)(ie.a,{flex:1,children:(0,e.jsx)(k.default,{children:({width:p,height:z})=>(0,e.jsx)(ht.K,{value:o("content"),onBlur:le=>f("content",le),containerStyles:s.editorContainer,width:p,height:z})})})]})}),E&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{...w.splitterProps}),(0,e.jsx)("div",{...w.secondaryProps,children:(0,e.jsx)("div",{className:(0,a.cx)(s.containerWithBorderAndRadius,s.minEditorSize,s.payloadEditor,s.flexFull),children:(0,e.jsx)(mt,{payload:J,defaultPayload:be,setPayload:M,setPayloadFormatError:x,payloadFormatError:D})})})]})]})}),E&&(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)("div",{...Q.secondaryProps,children:[(0,e.jsx)("div",{...Q.splitterProps}),(0,e.jsx)(gt.p,{payload:J,templateName:P("title"),setPayloadFormatError:x,payloadFormatError:D,className:(0,a.cx)(s.templatePreview,s.minEditorSize)})]})})]})]})]})]}),Y&&(0,e.jsx)(ve._,{title:"Templating cheat sheet",onClose:U,size:"lg",children:(0,e.jsx)(bt,{})})]})};function jt(){const n=(0,R.of)(Ne),i=(0,Z.t)("alerting.templates.help.intro",`Notification templates use Go templating language to create notification messages.

In Grafana, a template group can define multiple notification templates using {{ define "<NAME>" }}.
These templates can then be used in contact points and within other notification templates by calling {{ template "<NAME>" }}.
For detailed information about notification templates, refer to our documentation.`);return(0,e.jsx)(q.F,{title:"",severity:"info",children:(0,e.jsxs)(L.B,{direction:"column",gap:2,children:[(0,e.jsxs)(L.B,{direction:"row",children:[(0,e.jsx)("div",{style:{whiteSpace:"pre"},children:i}),(0,e.jsx)("div",{children:(0,e.jsx)(y.z9,{href:"https://grafana.com/docs/grafana/latest/alerting/manage-notifications/template-notifications/",target:"_blank",icon:"external-link-alt",variant:"secondary",children:(0,e.jsx)(Z.x6,{i18nKey:"alerting.templates.editor.goto-docs",children:"Notification templates documentation"})})})]}),(0,e.jsxs)(Be.E,{variant:"bodySmall",children:[(0,e.jsx)(Z.x6,{i18nKey:"alerting.templates.editor.auto-complete",children:"For auto-completion of common templating code, type the following keywords in the content editor:"}),(0,e.jsx)("div",{className:n.code,children:Object.values(xt.L).map(l=>l.label).join(", ")})]})]})})}function bt(){return(0,e.jsxs)(L.B,{direction:"column",gap:1,children:[(0,e.jsx)(jt,{}),(0,e.jsx)(_e,{})]})}const Ne=n=>{const i=n.breakpoints.down("md");return{flexFull:(0,a.css)({flex:1}),minEditorSize:(0,a.css)({minHeight:300,minWidth:300}),payloadEditor:(0,a.css)({minHeight:0}),containerWithBorderAndRadius:(0,a.css)({borderRadius:n.shape.radius.default,border:`1px solid ${n.colors.border.medium}`}),flexColumn:(0,a.css)({display:"flex",flex:1,flexDirection:"column"}),form:(0,a.css)({label:"template-form",height:"100%",display:"flex",flexDirection:"column"}),fieldset:(0,a.css)({label:"template-fieldset",flex:1,display:"flex",flexDirection:"column"}),label:(0,a.css)({margin:0}),nameField:(0,a.css)({marginBottom:n.spacing(1)}),contentContainer:(0,a.css)({flex:1,display:"flex",flexDirection:"row"}),contentField:(0,a.css)({display:"flex",flexDirection:"column",flex:1,marginBottom:0}),templatePreview:(0,a.css)({flex:1,display:"flex"}),templatePayload:(0,a.css)({flex:1}),editorContainer:(0,a.css)({width:"fit-content",border:"none"}),payloadCollapseButton:(0,a.css)({backgroundColor:n.colors.info.transparent,margin:0,[i]:{display:"none"}}),code:(0,a.css)({color:n.colors.text.secondary,fontWeight:n.typography.fontWeightBold})}},St=[{status:"firing",annotations:{summary:"Instance instance1 has been down for more than 5 minutes"},labels:{alertname:"InstanceDown",instance:"instance1"},startsAt:N(new Date,1).toISOString(),endsAt:h(new Date,5).toISOString(),fingerprint:"a5331f0d5a9d81d4",generatorURL:"http://grafana.com/alerting/grafana/cdeqmlhvflz40f/view"},{status:"resolved",annotations:{summary:"CPU usage above 90%"},labels:{alertname:"CpuUsage",instance:"instance1"},startsAt:G(new Date,4).toISOString(),endsAt:new Date().toISOString(),fingerprint:"b77d941310f9d381",generatorURL:"http://grafana.com/alerting/grafana/oZSMdGj7z/view"}],be=JSON.stringify(St,null,2)},91835:(ne,I,t)=>{t.d(I,{P:()=>k,p:()=>Se});var e=t(74848),a=t(22803),O=t(2543),N=t.n(O),C=t(49785),j=t(70713),S=t(29675),h=t(54594),X=t(90231),F=t(37e3),H=t(85651),_=t(3991),G=t(2876);function Se({payload:m,templateName:A,payloadFormatError:R,setPayloadFormatError:K,className:L}){const y=(0,S.of)(oe),{watch:q}=(0,C.xW)(),ie=q("content"),{data:he,isLoading:ge,onPreview:xe,error:re}=(0,G.g)(ie,A,m,K),W=k(re,R,he);return(0,e.jsxs)("div",{className:(0,a.cx)(y.container,L),children:[(0,e.jsx)(_.D,{label:"Preview",actions:(0,e.jsx)(h.$n,{disabled:ge,icon:"sync","aria-label":"Refresh preview",onClick:xe,size:"sm",variant:"secondary",children:"Refresh"})}),(0,e.jsx)(X.a,{flex:1,children:(0,e.jsx)(j.default,{disableWidth:!0,children:({height:ve})=>(0,e.jsx)("div",{className:y.viewerContainer({height:ve}),children:W})})})]})}function b({previews:m}){const A=(0,S.of)(oe),R=m.length===1;return(0,e.jsx)("ul",{className:A.viewer.container,children:m.map(K=>(0,e.jsxs)("li",{className:A.viewer.box,children:[R?null:(0,e.jsx)("header",{className:A.viewer.header,children:K.name}),(0,e.jsx)("pre",{className:A.viewer.pre,children:K.text??"<Empty>"})]},K.name))})}function ee({errors:m}){return m.map(A=>(0,e.jsx)(F.F,{title:(0,O.compact)([A.name,A.kind]).join(" \u2013 "),children:A.message},(0,O.uniqueId)("errors-list")))}const oe=m=>({container:(0,a.css)({label:"template-preview-container",display:"flex",flexDirection:"column",borderRadius:m.shape.radius.default,border:`1px solid ${m.colors.border.medium}`}),viewerContainer:({height:A})=>(0,a.css)({height:A,overflow:"auto",backgroundColor:m.colors.background.primary}),viewer:{container:(0,a.css)({display:"flex",flexDirection:"column",height:"inherit"}),box:(0,a.css)({display:"flex",flexDirection:"column",borderBottom:`1px solid ${m.colors.border.medium}`,height:"inherit"}),header:(0,a.css)({fontSize:m.typography.bodySmall.fontSize,padding:m.spacing(1,2),borderBottom:`1px solid ${m.colors.border.medium}`,backgroundColor:m.colors.background.secondary}),errorText:(0,a.css)({color:m.colors.error.text}),pre:(0,a.css)({backgroundColor:"transparent",margin:0,border:"none",padding:m.spacing(2)})}});function k(m,A,R){const K=m?(0,H.JZ)(m):void 0,L=A||K,y=R?.results??[],q=R?.errors;return(0,e.jsxs)(e.Fragment,{children:[L&&(0,e.jsx)(F.F,{severity:"error",title:"Error",children:L}),q&&(0,e.jsx)(ee,{errors:q}),y&&(0,e.jsx)(b,{previews:y})]})}},2876:(ne,I,t)=>{t.d(I,{g:()=>O});var e=t(96540),a=t(71409);function O(N,C,j,S){const[h,{data:X,error:F,isLoading:H}]=(0,a.vj)(),_=(0,e.useCallback)(()=>{try{const G=JSON.parse(j);JSON.stringify([...G]),h({template:N,alerts:G,name:C}),S(null)}catch(G){S(G instanceof Error?G.message:"Invalid JSON.")}},[N,C,j,S,h]);return(0,e.useEffect)(()=>_(),[_]),{data:X,error:F,isLoading:H,onPreview:_}}},88663:(ne,I,t)=>{t.d(I,{$:()=>O,Q:()=>N});var e=t(2543),a=t.n(e);function O(C,j){return C.filter(S=>!j.find(h=>JSON.stringify(h)===JSON.stringify(S)))}function N(C){const j=C.flatMap(h=>h);return(0,e.uniqBy)(j.filter(h=>j.filter(F=>(0,e.isEqual)(h,F)).length===Object.keys(C).length),h=>JSON.stringify(h))}}}]);

//# sourceMappingURL=8979.2090ea866922ac66860d.js.map