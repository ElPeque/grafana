(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[8051],{11908:(y,v,c)=>{"use strict";c.d(v,{s:()=>s});var s;(function(a){a[a.UNSET=0]="UNSET",a[a.OK=1]="OK",a[a.ERROR=2]="ERROR"})(s||(s={}))},75888:(y,v,c)=>{"use strict";y.exports=function(s,a){var u=this,x=u.constructor;return u.options=Object.assign({storeInstancesGlobally:!0},a||{}),u.callbacks={},u.directMap={},u.sequenceLevels={},u.resetTimer=null,u.ignoreNextKeyup=!1,u.ignoreNextKeypress=!1,u.nextExpectedAction=!1,u.element=s,u.addEvents(),u.options.storeInstancesGlobally&&x.instances.push(u),u},y.exports.prototype.bind=c(61210),y.exports.prototype.bindMultiple=c(74382),y.exports.prototype.unbind=c(43709),y.exports.prototype.trigger=c(43149),y.exports.prototype.reset=c(26726),y.exports.prototype.stopCallback=c(84446),y.exports.prototype.handleKey=c(94320),y.exports.prototype.addEvents=c(96687),y.exports.prototype.bindSingle=c(22214),y.exports.prototype.getKeyInfo=c(84174),y.exports.prototype.pickBestAction=c(16004),y.exports.prototype.getReverseMap=c(95193),y.exports.prototype.getMatches=c(19132),y.exports.prototype.resetSequences=c(55610),y.exports.prototype.fireCallback=c(7922),y.exports.prototype.bindSequence=c(90875),y.exports.prototype.resetSequenceTimer=c(80602),y.exports.prototype.detach=c(93502),y.exports.instances=[],y.exports.reset=c(6255),y.exports.REVERSE_MAP=null},96687:(y,v,c)=>{"use strict";y.exports=function(){var s=this,a=c(12904),u=s.element;s.eventHandler=c(88178).bind(s),a(u,"keypress",s.eventHandler),a(u,"keydown",s.eventHandler),a(u,"keyup",s.eventHandler)}},61210:y=>{"use strict";y.exports=function(v,c,s){var a=this;return v=v instanceof Array?v:[v],a.bindMultiple(v,c,s),a}},74382:y=>{"use strict";y.exports=function(v,c,s){for(var a=this,u=0;u<v.length;++u)a.bindSingle(v[u],c,s)}},90875:(y,v,c)=>{"use strict";y.exports=function(s,a,u,x){var _=this;_.sequenceLevels[s]=0;function w(C){return function(){_.nextExpectedAction=C,++_.sequenceLevels[s],_.resetSequenceTimer()}}function D(C){var k;_.fireCallback(u,C,s),x!=="keyup"&&(k=c(23970),_.ignoreNextKeyup=k(C)),setTimeout(function(){_.resetSequences()},10)}for(var g=0;g<a.length;++g){var H=g+1===a.length,F=H?D:w(x||_.getKeyInfo(a[g+1]).action);_.bindSingle(a[g],F,x,s,g)}}},22214:y=>{"use strict";y.exports=function(v,c,s,a,u){var x=this;x.directMap[v+":"+s]=c,v=v.replace(/\s+/g," ");var _=v.split(" "),w;if(_.length>1){x.bindSequence(v,_,c,s);return}w=x.getKeyInfo(v,s),x.callbacks[w.key]=x.callbacks[w.key]||[],x.getMatches(w.key,w.modifiers,{type:w.action},a,v,u),x.callbacks[w.key][a?"unshift":"push"]({callback:c,modifiers:w.modifiers,action:w.action,seq:a,level:u,combo:v})}},93502:(y,v,c)=>{var s=c(12904).off;y.exports=function(){var a=this,u=a.element;s(u,"keypress",a.eventHandler),s(u,"keydown",a.eventHandler),s(u,"keyup",a.eventHandler)}},12904:y=>{y.exports=v,y.exports.on=v,y.exports.off=c;function v(s,a,u,x){return!s.addEventListener&&(a="on"+a),(s.addEventListener||s.attachEvent).call(s,a,u,x),u}function c(s,a,u,x){return!s.removeEventListener&&(a="on"+a),(s.removeEventListener||s.detachEvent).call(s,a,u,x),u}},7922:(y,v,c)=>{"use strict";y.exports=function(s,a,u,x){var _=this,w,D;_.stopCallback(a,a.target||a.srcElement,u,x)||s(a,u)===!1&&(w=c(12156),w(a),D=c(31849),D(a))}},84174:(y,v,c)=>{"use strict";y.exports=function(s,a){var u=this,x,_,w,D,g=[],H,F,C;for(x=c(27486),_=x(s),H=c(7641),F=c(57984),C=c(95962),D=0;D<_.length;++D)w=_[D],H[w]&&(w=H[w]),a&&a!=="keypress"&&F[w]&&(w=F[w],g.push("shift")),C(w)&&g.push(w);return a=u.pickBestAction(w,g,a),{key:w,modifiers:g,action:a}}},19132:(y,v,c)=>{"use strict";y.exports=function(s,a,u,x,_,w){var D=this,g,H,F=[],C=u.type,k,R;if(C==="keypress"&&!(u.code&&u.code.slice(0,5)==="Arrow")){var A=D.callbacks["any-character"]||[];A.forEach(function(ye){F.push(ye)})}if(!D.callbacks[s])return F;for(k=c(95962),C==="keyup"&&k(s)&&(a=[s]),g=0;g<D.callbacks[s].length;++g)if(H=D.callbacks[s][g],!(!x&&H.seq&&D.sequenceLevels[H.seq]!==H.level)&&C===H.action&&(R=c(27238),C==="keypress"&&!u.metaKey&&!u.ctrlKey||R(a,H.modifiers))){var ee=!x&&H.combo===_,re=x&&H.seq===x&&H.level===w;(ee||re)&&D.callbacks[s].splice(g,1),F.push(H)}return F}},95193:(y,v,c)=>{"use strict";y.exports=function(){var s=this,a=s.constructor,u;if(!a.REVERSE_MAP){a.REVERSE_MAP={},u=c(56814);for(var x in u)x>95&&x<112||u.hasOwnProperty(x)&&(a.REVERSE_MAP[u[x]]=x)}return a.REVERSE_MAP}},94320:(y,v,c)=>{"use strict";y.exports=function(s,a,u){var x=this,_,w,D={},g=0,H=!1,F,C;for(_=x.getMatches(s,a,u),w=0;w<_.length;++w)_[w].seq&&(g=Math.max(g,_[w].level));for(w=0;w<_.length;++w){if(_[w].seq){if(_[w].level!==g)continue;H=!0,D[_[w].seq]=1,x.fireCallback(_[w].callback,u,_[w].combo,_[w].seq);continue}H||x.fireCallback(_[w].callback,u,_[w].combo)}C=u.type==="keypress"&&x.ignoreNextKeypress,F=c(95962),u.type===x.nextExpectedAction&&!F(s)&&!C&&x.resetSequences(D),x.ignoreNextKeypress=H&&u.type==="keydown"}},88178:(y,v,c)=>{"use strict";y.exports=function(s){var a=this,u,x;typeof s.which!="number"&&(s.which=s.keyCode),u=c(23970);var _=u(s);if(_!==void 0){if(s.type==="keyup"&&a.ignoreNextKeyup===_){a.ignoreNextKeyup=!1;return}x=c(25273),a.handleKey(_,x(s),s)}}},27238:y=>{"use strict";y.exports=function(v,c){return v.sort().join(",")===c.sort().join(",")}},16004:y=>{"use strict";y.exports=function(v,c,s){var a=this;return s||(s=a.getReverseMap()[v]?"keydown":"keypress"),s==="keypress"&&c.length&&(s="keydown"),s}},26726:y=>{"use strict";y.exports=function(){var v=this;return v.callbacks={},v.directMap={},this}},80602:y=>{"use strict";y.exports=function(){var v=this;clearTimeout(v.resetTimer),v.resetTimer=setTimeout(function(){v.resetSequences()},1e3)}},55610:y=>{"use strict";y.exports=function(v){var c=this;v=v||{};var s=!1,a;for(a in c.sequenceLevels){if(v[a]){s=!0;continue}c.sequenceLevels[a]=0}s||(c.nextExpectedAction=!1)}},84446:y=>{"use strict";y.exports=function(v,c){if((" "+c.className+" ").indexOf(" combokeys ")>-1)return!1;var s=c.tagName.toLowerCase();return s==="input"||s==="select"||s==="textarea"||c.isContentEditable}},43149:y=>{"use strict";y.exports=function(v,c){var s=this;return s.directMap[v+":"+c]&&s.directMap[v+":"+c]({},v),this}},43709:y=>{"use strict";y.exports=function(v,c){var s=this;return s.bind(v,function(){},c)}},6255:y=>{"use strict";y.exports=function(){var v=this;v.instances.forEach(function(c){c.reset()})}},23970:(y,v,c)=>{"use strict";y.exports=function(s){var a,u;if(a=c(56814),u=c(14082),s.type==="keypress"){var x=String.fromCharCode(s.which);return s.shiftKey||(x=x.toLowerCase()),x}return a[s.which]!==void 0?a[s.which]:u[s.which]!==void 0?u[s.which]:String.fromCharCode(s.which).toLowerCase()}},25273:y=>{"use strict";y.exports=function(v){var c=[];return v.shiftKey&&c.push("shift"),v.altKey&&c.push("alt"),v.ctrlKey&&c.push("ctrl"),v.metaKey&&c.push("meta"),c}},95962:y=>{"use strict";y.exports=function(v){return v==="shift"||v==="ctrl"||v==="alt"||v==="meta"}},27486:y=>{"use strict";y.exports=function(v){return v==="+"?["+"]:v.split("+")}},12156:y=>{"use strict";y.exports=function(v){if(v.preventDefault){v.preventDefault();return}v.returnValue=!1}},57984:y=>{"use strict";y.exports={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"}},7641:y=>{"use strict";y.exports={option:"alt",command:"meta",return:"enter",escape:"esc",mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"meta":"ctrl"}},14082:y=>{"use strict";y.exports={106:"*",107:"plus",109:"minus",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"}},56814:y=>{"use strict";y.exports={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",173:"minus",187:"plus",189:"minus",224:"meta"};for(var v=1;v<20;++v)y.exports[111+v]="f"+v;for(v=0;v<=9;++v)y.exports[v+96]=v},31849:y=>{"use strict";y.exports=function(v){if(v.stopPropagation){v.stopPropagation();return}v.cancelBubble=!0}},62884:(y,v,c)=>{"use strict";c.d(v,{V:()=>ys});var s=c(74848),a=c(22803),u=c(96540),x=c(42941),_=c(16753),w=c(46399);function D(p){if(p?.tracesToLogsV2)return p.tracesToLogsV2;if(!p?.tracesToLogs)return;const m={customQuery:!1};return m.datasourceUid=p.tracesToLogs.datasourceUid,m.tags=p.tracesToLogs.mapTagNamesEnabled?p.tracesToLogs.mappedTags:p.tracesToLogs.tags?.map(S=>({key:S})),m.filterByTraceID=p.tracesToLogs.filterByTraceID,m.filterBySpanID=p.tracesToLogs.filterBySpanID,m.spanStartTimeShift=p.tracesToLogs.spanStartTimeShift,m.spanEndTimeShift=p.tracesToLogs.spanEndTimeShift,m}function g({options:p,onOptionsChange:m}){const S=["loki","elasticsearch","grafana-splunk-datasource","grafana-opensearch-datasource","grafana-falconlogscale-datasource","googlecloud-logging-datasource"],b=useMemo(()=>D(p.jsonData)||{customQuery:!1},[p.jsonData]),{query:T="",tags:M,customQuery:L}=b,O=useCallback($=>{m({...p,jsonData:{...p.jsonData,tracesToLogsV2:{...b,...$},tracesToLogs:void 0}})},[m,p,b]);return jsxs("div",{className:css({width:"100%"}),children:[jsx(InlineFieldRow,{children:jsx(InlineField,{tooltip:"The logs data source the trace is going to navigate to",label:"Data source",labelWidth:26,children:jsx(DataSourcePicker,{inputId:"trace-to-logs-data-source-picker",filter:$=>S.includes($.type),current:b.datasourceUid,noDefault:!0,width:40,onChange:$=>O({datasourceUid:$.uid}),onClear:()=>O({datasourceUid:void 0})})})}),jsx(InlineFieldRow,{children:jsx(IntervalInput,{label:F("start"),tooltip:C("start","0"),value:b.spanStartTimeShift||"",onChange:$=>{O({spanStartTimeShift:$})},isInvalidError:k})}),jsx(InlineFieldRow,{children:jsx(IntervalInput,{label:F("end"),tooltip:C("end","0"),value:b.spanEndTimeShift||"",onChange:$=>{O({spanEndTimeShift:$})},isInvalidError:k})}),jsx(InlineFieldRow,{children:jsx(InlineField,{tooltip:"Tags that will be used in the query. Default tags: 'cluster', 'hostname', 'namespace', 'pod', 'service.name', 'service.namespace'",label:"Tags",labelWidth:26,children:jsx(TagMappingInput,{values:M??[],onChange:$=>O({tags:$})})})}),jsx(H,{disabled:L,type:"trace",id:"filterByTraceID",value:!!b.filterByTraceID,onChange:$=>O({filterByTraceID:$})}),jsx(H,{disabled:L,type:"span",id:"filterBySpanID",value:!!b.filterBySpanID,onChange:$=>O({filterBySpanID:$})}),jsx(InlineFieldRow,{children:jsx(InlineField,{tooltip:"Use a custom query with the possibility to interpolate variables from the trace or span",label:"Use custom query",labelWidth:26,children:jsx(InlineSwitch,{id:"customQuerySwitch",value:L,onChange:$=>O({customQuery:$.currentTarget.checked})})})}),L&&jsx(InlineField,{label:"Query",labelWidth:26,tooltip:"The query that will run when navigating from a trace to logs data source. Interpolate tags using the `$__tags` keyword",grow:!0,children:jsx(Input,{label:"Query",type:"text",allowFullScreen:!0,value:T,onChange:$=>O({query:$.currentTarget.value})})})]})}function H(p){return jsx(InlineFieldRow,{children:jsx(InlineField,{disabled:p.disabled,label:`Filter by ${p.type} ID`,labelWidth:26,grow:!0,tooltip:`Filters logs by ${p.type} ID, where the ${p.type} ID should be part of the log line`,children:jsx(InlineSwitch,{id:p.id,value:p.value,onChange:m=>p.onChange(m.currentTarget.checked)})})})}const F=p=>`Span ${p} time shift`,C=(p,m)=>`Shifts the ${p} time of the span. Default: ${m} (Time units can be used here, for example: 5s, -1m, 3h)`,k="Invalid time shift. See tooltip for examples.",R=({options:p,onOptionsChange:m})=>{let S=p.type;return S+=p.type==="tempo"?"/configure-tempo-data-source/#trace-to-logs":"/#trace-to-logs",jsx(ConfigSection,{title:"Trace to logs",description:jsx(ConfigDescriptionLink,{description:"Navigate from a trace span to the selected data source's logs.",suffix:S,feature:"trace to logs"}),isCollapsible:!0,isInitiallyOpen:!0,children:jsx(g,{options:p,onOptionsChange:m})})};var A=c(39736),ee=c(29675),re=c(10059),ye=c(10743),J=c(61491),we=c(3414),fe=c(26935),ve=c(41811);const dt=(p,m,S)=>{let b;return S?b=m?.childSpanIds.find(T=>p.has(T)&&p.get(T).startTime+p.get(T).duration<S):b=m.childSpanIds[0],b?p.get(b):void 0},Ke=p=>{const m=[],S=[];p.forEach(M=>{if(M.references[0]?.refType==="FOLLOWS_FROM"){m.push(M.spanID);const L=p.get(M.references[0].spanID);L.childSpanIds=L.childSpanIds.filter(O=>O!==M.spanID),p.set(L.spanID,{...L})}});const b=M=>{M.forEach(L=>{const O=p.get(L);O.hasChildren&&(S.push(...O.childSpanIds),b(O.childSpanIds))})};return b(m),[...m,...S].forEach(M=>p.delete(M)),p},Z=p=>{let m=[...p.keys()];return m.forEach(S=>{const b=p.get(S);if(!(b&&b.references.length&&b.depth))return;const T=p.get(b.references[0].spanID);if(!T){p.delete(b.spanID);return}const M=b.startTime+b.duration,L=T.startTime+T.duration;if(b.startTime>=T.startTime){if(b.startTime>=L){p.delete(b.spanID),T.childSpanIds=T.childSpanIds.filter(O=>O!==b.spanID);return}if(M>L){p.set(b.spanID,{...b,duration:L-b.startTime});return}return}M<=T.startTime?(p.delete(b.spanID),T.childSpanIds=T.childSpanIds.filter(O=>O!==b.spanID)):M<=L?p.set(b.spanID,{...b,startTime:T.startTime,duration:M-T.startTime}):p.set(b.spanID,{...b,startTime:T.startTime,duration:L-T.startTime})}),m=[...p.keys()],m.forEach(S=>{const b=p.get(S);if(b.references.length){const T=p.get(b.references[0].spanID);b.references[0].span=T,p.set(S,{...b})}}),p},Re=(p,m,S,b)=>{const T=p.get(m);if(!T)return S;const M=dt(p,T,b);let L;if(M)L={spanId:T.spanID,section_start:M.startTime+M.duration,section_end:b||T.startTime+T.duration},L.section_start!==L.section_end&&S.push(L),Re(p,M.spanID,S);else if(L={spanId:T.spanID,section_start:T.startTime,section_end:b||T.startTime+T.duration},L.section_start!==L.section_end&&S.push(L),T.references.length){const O=T.references.filter($=>$.refType==="CHILD_OF")[0].spanID;Re(p,O,S,T.startTime)}return S};function P(p){let m=[];const S=p?.spans[0].spanID;if(S){const b=p.spans.reduce((T,M)=>(T.set(M.spanID,M),T),new Map);try{const T=Ke(b),M=Z(T);m=Re(M,S,m)}catch(T){console.log("error while computing critical path for a trace",T)}}return m}const G=(0,ve.default)(P);var q=c(90617),te=c(72386),oe=c(60306);const X=.8,$e=2,Be=200,Ae=10,ge=60,De=6;function Fe(p,m,S,b,T){const M=new Map,L=m.length<ge?ge:Math.min(m.length,Be),O=window.innerWidth*2;p.width=O,p.height=L;const $=Math.min(De,Math.max($e,L/m.length)),se=L/m.length,de=p.getContext("2d",{alpha:!1});if(de){de.fillStyle=T,de.fillRect(0,0,O,L);for(let me=0;me<m.length;me++){const{valueWidth:xe,valueOffset:Me,serviceName:et}=m[me],at=Me/S*O;let Ge=xe/S*O;Ge<Ae&&(Ge=Ae);let Oe=M.get(et);Oe||(Oe=`rgba(${b(et).concat(X).join()})`,M.set(et,Oe)),de.fillStyle=Oe,de.fillRect(at,me*se,Ge,$)}}}const je=(0,q.N)(p=>({CanvasSpanGraph:(0,a.css)({label:"CanvasSpanGraph",background:(0,te.R)(p,"#fafafa"),height:"60px",position:"absolute",width:"100%"})}));class We extends u.PureComponent{constructor(m){super(m),this.getColor=S=>(0,oe.rY)(S,this.props.theme),this._setCanvasRef=S=>{this._canvasElm=S},this._canvasElm=void 0}componentDidMount(){this._draw()}componentDidUpdate(){this._draw()}_draw(){if(this._canvasElm){const{valueWidth:m,items:S}=this.props;Fe(this._canvasElm,S,m,this.getColor,(0,te.R)(this.props.theme,"#fff"))}}render(){return(0,s.jsx)("canvas",{className:je(this.props.theme).CanvasSpanGraph,ref:this._setCanvasRef,"data-testid":"CanvasSpanGraph"})}}const be=(0,ee.cV)(We);var Ce=c(14115);const ke=()=>({TickLabels:(0,a.css)({label:"TickLabels",height:"1rem",position:"relative"}),TickLabelsLabel:(0,a.css)({label:"TickLabelsLabel",color:"#717171",fontSize:"0.7rem",position:"absolute",userSelect:"none"})});function Ue(p){const{numTicks:m,duration:S}=p,b=(0,ee.of)(ke),T=[];for(let M=0;M<m+1;M++){const L=M/m,O=L===1?{right:"0%"}:{left:`${L*100}%`};T.push((0,s.jsx)("div",{className:b.TickLabelsLabel,style:O,"data-testid":"tick",children:(0,Ce.a3)(S*L)},L))}return(0,s.jsx)("div",{className:b.TickLabels,"data-testid":"TickLabels",children:T})}var nt=c(46942),Te=c.n(nt),Ot=c(54594),ht=c(61890);const cs=()=>({GraphTick:(0,a.css)({label:"GraphTick",stroke:"#aaa",strokeWidth:"1px"})});function ds(p){const{numTicks:m}=p,S=(0,ee.of)(cs),b=[];for(let T=1;T<m;T++){const M=`${T/m*100}%`;b.push((0,s.jsx)("line",{className:S.GraphTick,x1:M,y1:"0%",x2:M,y2:"100%"},T/m))}return(0,s.jsx)("g",{"data-testid":"ticks","aria-hidden":"true",children:b})}const us=()=>({ScrubberHandleExpansion:Te()((0,a.css)({label:"ScrubberHandleExpansion",cursor:"col-resize",fillOpacity:0,fill:"#44f"}),"scrubber-handle-expansion"),ScrubberHandle:Te()((0,a.css)({label:"ScrubberHandle",cursor:"col-resize",fill:"#555"}),"scrubber-handle"),ScrubberLine:Te()((0,a.css)({label:"ScrubberLine",pointerEvents:"none",stroke:"#555"}),"scrubber-line"),ScrubberDragging:(0,a.css)({label:"ScrubberDragging","& .scrubber-handle-expansion":{fillOpacity:1},"& .scrubber-handle":{fill:"#44f"},"& > .scrubber-line":{stroke:"#44f"}}),ScrubberHandles:(0,a.css)({label:"ScrubberHandles","&:hover > .scrubber-handle-expansion":{fillOpacity:1},"&:hover > .scrubber-handle":{fill:"#44f"},"&:hover + .scrubber.line":{stroke:"#44f"}})});function Le({isDragging:p,onMouseDown:m,onMouseEnter:S,onMouseLeave:b,position:T}){const M=`${T*100}%`,L=(0,ee.of)(us),O=Te()({[L.ScrubberDragging]:p});return(0,s.jsxs)("g",{className:O,"data-testid":"scrubber-component",children:[(0,s.jsxs)("g",{"data-testid":"scrubber-component-g",className:L.ScrubberHandles,onMouseDown:m,onMouseEnter:S,onMouseLeave:b,children:[(0,s.jsx)("rect",{"data-testid":"scrubber-component-rect-1",x:M,className:L.ScrubberHandleExpansion,style:{transform:"translate(-4.5px)"},width:"9",height:"20"}),(0,s.jsx)("rect",{"data-testid":"scrubber-component-rect-2",x:M,className:L.ScrubberHandle,style:{transform:"translate(-1.5px)"},width:"3",height:"20"})]}),(0,s.jsx)("line",{className:L.ScrubberLine,y2:"100%",x1:M,x2:M,"data-testid":"scrubber-component-line"})]})}const xt=(0,q.N)(p=>{const m="JaegerUiComponents__ViewingLayerResetZoomHoverClassName",S=(0,a.css)({label:"ViewingLayerResetZoom",display:"none",position:"absolute",right:"1%",top:"10%",zIndex:1});return{ViewingLayer:(0,a.css)({label:"ViewingLayer",cursor:"vertical-text",position:"relative",zIndex:1,[`&:hover > .${m}`]:{display:"unset"}}),ViewingLayerGraph:(0,a.css)({label:"ViewingLayerGraph",border:`1px solid ${(0,te.R)(p,"#999")}`,overflow:"visible !important",position:"relative",transformOrigin:"0 0",width:"100%"}),ViewingLayerInactive:(0,a.css)({label:"ViewingLayerInactive",fill:(0,te.R)(p,"rgba(214, 214, 214, 0.5)")}),ViewingLayerCursorGuide:(0,a.css)({label:"ViewingLayerCursorGuide",stroke:(0,te.R)(p,"#f44"),strokeWidth:1}),ViewingLayerDraggedShift:(0,a.css)({label:"ViewingLayerDraggedShift",fillOpacity:.2}),ViewingLayerDrag:(0,a.css)({label:"ViewingLayerDrag",fill:(0,te.R)(p,"#44f")}),ViewingLayerFullOverlay:(0,a.css)({label:"ViewingLayerFullOverlay",bottom:0,cursor:"col-resize",left:0,position:"fixed",right:0,top:0,userSelect:"none"}),ViewingLayerResetZoom:S,ViewingLayerResetZoomHoverClassName:m}}),Je={SHIFT_END:"SHIFT_END",SHIFT_START:"SHIFT_START",REFRAME:"REFRAME"};function hs(p,m){const[S,b]=p<m?[p,m]:[m,p];return{x:`${S*100}%`,width:`${(b-S)*100}%`,leadingX:`${m*100}%`}}class Et extends u.PureComponent{constructor(m){super(m),this._setRoot=S=>{this._root=S},this._getDraggingBounds=S=>{if(!this._root)throw new Error("invalid state");const{left:b,width:T}=this._root.getBoundingClientRect(),[M,L]=this.props.viewRange.time.current;let O=1,$=0;return S===Je.SHIFT_START?O=L:S===Je.SHIFT_END&&($=M),{clientXLeft:b,maxValue:O,minValue:$,width:T}},this._handleReframeMouseMove=({value:S})=>{this.props.updateNextViewRangeTime({cursor:S})},this._handleReframeMouseLeave=()=>{this._draggerReframe.resetBounds(),this.props.updateNextViewRangeTime({cursor:null})},this._handleReframeDragUpdate=({value:S})=>{const b=S,{time:T}=this.props.viewRange,L={reframe:{anchor:T.reframe?T.reframe.anchor:b,shift:b}};this.props.updateNextViewRangeTime(L)},this._handleReframeDragEnd=({manager:S,value:b})=>{const{time:T}=this.props.viewRange,M=T.reframe?T.reframe.anchor:b,[L,O]=b<M?[b,M]:[M,b];S.resetBounds(),this.props.updateViewRangeTime(L,O,"minimap")},this._handleScrubberEnterLeave=({type:S})=>{const b=S===ht.EUpdateTypes.MouseEnter;this.setState({preventCursorLine:b})},this._handleScrubberDragUpdate=({event:S,tag:b,type:T,value:M})=>{T===ht.EUpdateTypes.DragStart&&S.stopPropagation(),b===Je.SHIFT_START?this.props.updateNextViewRangeTime({shiftStart:M}):b===Je.SHIFT_END&&this.props.updateNextViewRangeTime({shiftEnd:M})},this._handleScrubberDragEnd=({manager:S,tag:b,value:T})=>{const[M,L]=this.props.viewRange.time.current;let O;if(b===Je.SHIFT_START)O=[T,L];else if(b===Je.SHIFT_END)O=[M,T];else throw new Error("bad state");S.resetBounds(),this.setState({preventCursorLine:!1}),this.props.updateViewRangeTime(O[0],O[1],"minimap")},this._resetTimeZoomClickHandler=()=>{this.props.updateViewRangeTime(0,1)},this._draggerReframe=new ht.default({getBounds:this._getDraggingBounds,onDragEnd:this._handleReframeDragEnd,onDragMove:this._handleReframeDragUpdate,onDragStart:this._handleReframeDragUpdate,onMouseMove:this._handleReframeMouseMove,onMouseLeave:this._handleReframeMouseLeave,tag:Je.REFRAME}),this._draggerStart=new ht.default({getBounds:this._getDraggingBounds,onDragEnd:this._handleScrubberDragEnd,onDragMove:this._handleScrubberDragUpdate,onDragStart:this._handleScrubberDragUpdate,onMouseEnter:this._handleScrubberEnterLeave,onMouseLeave:this._handleScrubberEnterLeave,tag:Je.SHIFT_START}),this._draggerEnd=new ht.default({getBounds:this._getDraggingBounds,onDragEnd:this._handleScrubberDragEnd,onDragMove:this._handleScrubberDragUpdate,onDragStart:this._handleScrubberDragUpdate,onMouseEnter:this._handleScrubberEnterLeave,onMouseLeave:this._handleScrubberEnterLeave,tag:Je.SHIFT_END}),this._root=void 0,this.state={preventCursorLine:!1}}componentWillUnmount(){this._draggerReframe.dispose(),this._draggerEnd.dispose(),this._draggerStart.dispose()}_getMarkers(m,S){const b=xt(this.props.theme),T=hs(m,S);return[(0,s.jsx)("rect",{className:Te()(b.ViewingLayerDraggedShift,b.ViewingLayerDrag),x:T.x,y:"0",width:T.width,height:this.props.height-2},"fill"),(0,s.jsx)("rect",{className:Te()(b.ViewingLayerDrag),x:T.leadingX,y:"0",width:"1",height:this.props.height-2},"edge")]}render(){const{height:m,viewRange:S,numTicks:b,theme:T}=this.props,{preventCursorLine:M}=this.state,{current:L,cursor:O,shiftStart:$,shiftEnd:se,reframe:de}=S.time,me=$!=null||se!=null||de!=null,[xe,Me]=L;let et=0;xe&&(et=xe*100);let at=100;Me&&(at=100-Me*100);let Ge;!me&&O!=null&&!M&&(Ge=`${O*100}%`);const Oe=xt(T);return(0,s.jsxs)("div",{"aria-hidden":!0,className:Oe.ViewingLayer,style:{height:m},children:[(xe!==0||Me!==1)&&(0,s.jsx)(Ot.$n,{onClick:this._resetTimeZoomClickHandler,className:Te()(Oe.ViewingLayerResetZoom,Oe.ViewingLayerResetZoomHoverClassName),type:"button",variant:"secondary",children:"Reset Selection"}),(0,s.jsxs)("svg",{height:m,className:Oe.ViewingLayerGraph,ref:this._setRoot,onMouseDown:this._draggerReframe.handleMouseDown,onMouseLeave:this._draggerReframe.handleMouseLeave,onMouseMove:this._draggerReframe.handleMouseMove,children:[et>0&&(0,s.jsx)("rect",{x:0,y:0,height:"100%",width:`${et}%`,className:Oe.ViewingLayerInactive,"data-testid":"left-ViewingLayerInactive"}),at>0&&(0,s.jsx)("rect",{x:`${100-at}%`,y:0,height:"100%",width:`${at}%`,className:Oe.ViewingLayerInactive,"data-testid":"right-ViewingLayerInactive"}),(0,s.jsx)(ds,{numTicks:b}),Ge&&(0,s.jsx)("line",{className:Oe.ViewingLayerCursorGuide,x1:Ge,y1:"0",x2:Ge,y2:m-2,strokeWidth:"1","data-testid":"ViewingLayerCursorGuide"}),$!=null&&this._getMarkers(xe,$),se!=null&&this._getMarkers(Me,se),(0,s.jsx)(Le,{isDragging:$!=null,onMouseDown:this._draggerStart.handleMouseDown,onMouseEnter:this._draggerStart.handleMouseEnter,onMouseLeave:this._draggerStart.handleMouseLeave,position:xe||0}),(0,s.jsx)(Le,{isDragging:se!=null,position:Me||1,onMouseDown:this._draggerEnd.handleMouseDown,onMouseEnter:this._draggerEnd.handleMouseEnter,onMouseLeave:this._draggerEnd.handleMouseLeave}),de!=null&&this._getMarkers(de.anchor,de.shift)]}),me&&(0,s.jsx)("div",{className:Oe.ViewingLayerFullOverlay})]})}}const gs=(0,ee.cV)(Et),Wt=()=>({container:(0,a.css)({padding:"0 0.5rem 0.5rem 0.5rem"}),canvasContainer:(0,a.css)({position:"relative"})}),zt=60,_t=4;function Kt(p){return{valueOffset:p.relativeStartTime,valueWidth:p.duration,serviceName:p.process.serviceName}}function At(p){return p.spans.map(Kt)}const ps=(0,ve.default)(At);class tn extends u.PureComponent{static{this.defaultProps={height:zt}}render(){const{height:m,trace:S,viewRange:b,updateNextViewRangeTime:T,updateViewRangeTime:M}=this.props,L=Wt();if(!S)return(0,s.jsx)("div",{});const O=ps(S);return(0,s.jsxs)("div",{className:L.container,children:[(0,s.jsx)(Ue,{numTicks:_t,duration:S.duration}),(0,s.jsxs)("div",{className:L.canvasContainer,children:[(0,s.jsx)(be,{valueWidth:S.duration,items:O}),(0,s.jsx)(gs,{viewRange:b,numTicks:_t,height:m||zt,updateViewRangeTime:M,updateNextViewRangeTime:T})]})]})}}var fs=c(32160);function Se(){const[p,m]=(0,u.useState)(new Set),S=(0,u.useCallback)(function($){if(p.size===0)return;let se=-1,de=!0;const me=$.reduce((xe,Me)=>(Me.depth<=se&&(de=!0),de&&xe.has(Me.spanID)&&(xe.delete(Me.spanID),de=!1,se=Me.depth),xe),new Set(p));m(me)},[p]),b=(0,u.useCallback)(function($){if(Ut($,p))return;let se;const de=$.reduce((me,xe)=>(se&&xe.depth<=se.depth?(me.add(se.spanID),xe.hasChildren&&(se=xe)):xe.hasChildren&&!me.has(xe.spanID)&&(se=xe),me),new Set(p));se&&de.add(se.spanID),m(de)},[p]),T=(0,u.useCallback)(function(){m(new Set)},[]),M=(0,u.useCallback)(function($){if(Ut($,p))return;const se=$.reduce((de,me)=>(me.hasChildren&&de.add(me.spanID),de),new Set);m(se)},[p]),L=(0,u.useCallback)(function($){const se=new Set(p);p.has($)?se.delete($):se.add($),m(se)},[p]);return{childrenHiddenIDs:p,expandOne:S,collapseOne:b,expandAll:T,collapseAll:M,childrenToggle:L}}function Ut(p,m){return p.filter(b=>b.hasChildren).length===m.size}function rt(p){const[m,S]=(0,u.useState)(new Map);(0,u.useEffect)(()=>{S(new Map)},[p,S]);const b=(0,u.useCallback)(function(O){const $=new Map(m);$.has(O)?$.delete(O):$.set(O,new fe.DetailState),S($)},[m]),T=(0,u.useCallback)(function(O,$){const se=m.get(O);if(!se)return;const de=se.toggleLogItem($),me=new Map(m);return me.set(O,de),S(me)},[m]),M=(0,u.useCallback)(function(O,$){const se=m.get(O);if(!se)return;const de=se.toggleReferenceItem($),me=new Map(m);return me.set(O,de),S(me)},[m]);return{detailStates:m,toggleDetail:b,detailLogItemToggle:T,detailLogsToggle:(0,u.useCallback)(L=>yt("logs",m,S)(L),[m]),detailWarningsToggle:(0,u.useCallback)(L=>yt("warnings",m,S)(L),[m]),detailStackTracesToggle:(0,u.useCallback)(L=>yt("stackTraces",m,S)(L),[m]),detailReferenceItemToggle:M,detailReferencesToggle:(0,u.useCallback)(L=>yt("references",m,S)(L),[m]),detailProcessToggle:(0,u.useCallback)(L=>yt("process",m,S)(L),[m]),detailTagsToggle:(0,u.useCallback)(L=>yt("tags",m,S)(L),[m])}}function yt(p,m,S){return b=>{const T=m.get(b);if(!T)return;let M;p==="tags"?M=T.toggleTags():p==="process"?M=T.toggleProcess():p==="warnings"?M=T.toggleWarnings():p==="references"?M=T.toggleReferences():p==="stackTraces"?M=T.toggleStackTraces():M=T.toggleLogs();const L=new Map(m);L.set(b,M),S(L)}}function ms(){const[p,m]=(0,u.useState)(new Set),S=(0,u.useCallback)(function(M){m(L=>{const O=new Set(L);return O.add(M),O})},[]),b=(0,u.useCallback)(function(M){m(L=>{const O=new Set(L);return O.delete(M),O})},[]);return{hoverIndentGuideIds:p,addHoverIndentGuideId:S,removeHoverIndentGuideId:b}}var vs=c(2973);function xs(){const[p,m]=(0,u.useState)({time:{current:[0,1]}}),S=(0,u.useCallback)(function(M){m(L=>{const O={...L.time,...M};return{...L,time:O}})},[]),b=(0,u.useCallback)(function(M,L){const $={current:[M,L]};m(se=>({...se,time:$}))},[]);return{viewRange:p,updateViewRangeTime:b,updateNextViewRangeTime:S}}const qe=p=>({noDataMsg:(0,a.css)({height:"100%",width:"100%",display:"grid",placeItems:"center",fontSize:p.typography.h4.fontSize,color:p.colors.text.secondary})});function ys(p){const{traceProp:m,datasource:S,topOfViewRef:b,exploreId:T,createSpanLink:M,focusedSpanId:L,createFocusSpanLink:O,spanFilters:$}=p,{detailStates:se,toggleDetail:de,detailLogItemToggle:me,detailLogsToggle:xe,detailProcessToggle:Me,detailReferencesToggle:et,detailReferenceItemToggle:at,detailTagsToggle:Ge,detailWarningsToggle:Oe,detailStackTracesToggle:Ss}=rt(p.dataFrames[0]),{removeHoverIndentGuideId:gt,addHoverIndentGuideId:Is,hoverIndentGuideIds:Gt}=ms(),{viewRange:ue,updateViewRangeTime:pt,updateNextViewRangeTime:Zt}=xs(),{expandOne:Qt,collapseOne:Ts,childrenToggle:ws,collapseAll:Ds,childrenHiddenIDs:Xt,expandAll:Cs}=Se(),{search:Ft,setSearch:Rs,spanFilterMatches:Bt}=(0,vs.SQ)(m?.spans,$),[ks,Es]=(0,u.useState)(""),[Yt,Ls]=(0,x.A)(!1),[Ns,js]=(0,u.useState)(100),[Ms,Jt]=(0,u.useState)({}),[Os,_s]=(0,u.useState)({}),As=(0,ee.of)(qe),[ft,Fs]=(0,u.useState)(.4),[Bs,Pt]=bs({refId:p.dataFrames[0]?.refId,exploreId:p.exploreId,datasource:S,splitOpenFn:p.splitOpenFn}),Ps=L??Bs,bt=O??Pt,Vs=(0,u.useMemo)(()=>({childrenHiddenIDs:Xt,detailStates:se,hoverIndentGuideIds:Gt,spanNameColumnWidth:ft,traceID:p.traceProp?.traceID}),[Xt,se,Gt,ft,p.traceProp?.traceID]),Dt=(0,re.tR)().getInstanceSettings(S?.name),qt=D(Dt?.jsonData),Vt=Dt?.jsonData?.tracesToMetrics,Ht=Dt?.jsonData?.tracesToProfiles,Hs=Dt?.jsonData,$s=(0,u.useMemo)(()=>M??(0,fs.lU)({splitOpenFn:p.splitOpenFn,traceToLogsOptions:qt,traceToMetricsOptions:Vt,traceToProfilesOptions:Ht,dataFrame:p.dataFrames[0],createFocusSpanLink:bt,trace:m}),[p.splitOpenFn,qt,Vt,Ht,p.dataFrames,bt,m,M]),es=(0,J.useSelector)(zs=>(0,ye.O)(zs.user)),ts=S?S?.type:"unknown",Ws=p.scrollElement?p.scrollElement:document.getElementsByClassName(p.scrollElementClass??"")[0],ss=G(m);return(0,s.jsx)(s.Fragment,{children:p.dataFrames?.length&&m?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(fe.TracePageHeader,{trace:m,data:p.dataFrames[0],timeZone:es,search:Ft,setSearch:Rs,showSpanFilters:Yt,setShowSpanFilters:Ls,setFocusedSpanIdForSearch:Es,spanFilterMatches:Bt,datasourceType:ts,setHeaderHeight:js,app:T?_.Jk.Explore:_.Jk.Unknown}),(0,s.jsx)(tn,{trace:m,viewRange:ue,updateNextViewRangeTime:Zt,updateViewRangeTime:pt}),(0,s.jsx)(fe.TraceTimelineViewer,{findMatchesIDs:Bt,trace:m,traceToProfilesOptions:Ht,datasourceType:ts,spanBarOptions:Hs?.spanBar,traceTimeline:Vs,updateNextViewRangeTime:Zt,updateViewRangeTime:pt,viewRange:ue,timeZone:es,setSpanNameColumnWidth:Fs,collapseAll:Ds,collapseOne:Ts,expandAll:Cs,expandOne:Qt,childrenToggle:ws,detailLogItemToggle:me,detailLogsToggle:xe,detailWarningsToggle:Oe,detailStackTracesToggle:Ss,detailReferencesToggle:et,detailReferenceItemToggle:at,detailProcessToggle:Me,detailTagsToggle:Ge,detailToggle:de,addHoverIndentGuideId:Is,removeHoverIndentGuideId:gt,linksGetter:()=>[],createSpanLink:$s,scrollElement:Ws,focusedSpanId:Ps,focusedSpanIdForSearch:ks,showSpanFilterMatchesOnly:Ft.matchesOnly,showCriticalPathSpansOnly:Ft.criticalPathOnly,createFocusSpanLink:bt,topOfViewRef:b,headerHeight:Ns,criticalPath:ss,traceFlameGraphs:Ms,setTraceFlameGraphs:Jt,redrawListView:Os,setRedrawListView:_s})]}):(0,s.jsx)("div",{className:As.noDataMsg,children:"No data"})})}function bs(p){const m=(0,J.useSelector)(O=>O.explore.panes[p.exploreId]?.panelsState.trace),S=m?.spanId,b=(0,J.useDispatch)(),T=O=>b((0,we.EA)(p.exploreId,"trace",{...m,spanId:O})),M=(0,J.useSelector)(O=>O.explore.panes[p.exploreId]?.queries.find($=>$.refId===p.refId));return[S,(O,$)=>{const se={title:"Deep link to this span",url:"",internal:{datasourceUid:p.datasource?.uid,datasourceName:p.datasource?.name,query:{...M,query:O},panelsState:{trace:{spanId:$}}}},de=M?.queryType==="traceql"&&M.query===O;return(0,w.u)({link:se,internalLink:se.internal,scopedVars:{},field:{},onClickFn:de?()=>T(S===$?void 0:$):p.splitOpenFn?()=>p.splitOpenFn({datasourceUid:p.datasource?.uid,queries:[{...M,query:O}],panelsState:{trace:{spanId:$}}}):void 0,replaceVariables:(0,A.w)().replace.bind((0,A.w)())})}]}},72386:(y,v,c)=>{"use strict";c.d(v,{R:()=>a});var s=c(84140);function a(u,x,_){if(u.isLight)return x;{if(_){const g=(0,s.A)(x);return s.A.mostReadable(_,[g.clone().lighten(25),g.clone().lighten(10),g,g.clone().darken(10),g.clone().darken(25)],{includeFallbackColors:!1}).toHex8String()}const w=(0,s.A)(x).toHsl();w.l=1-w.l;const D=(0,s.A)(w);return D.isLight()?D.darken(5).toHex8String():D.lighten(5).toHex8String()}}},92955:(y,v,c)=>{"use strict";c.d(v,{T:()=>k});var s=c(74848),a=c(22803),u=c(4392),x=c(35095),_=c(20301),w=c(29675),D=c(48583),g=c(44826),H=c(34128),F=c(2973),C=c(3091);const k=({search:A,trace:ee,setSearch:re,tagKeys:ye,setTagKeys:J,tagValues:we,setTagValues:fe})=>{const ve={...(0,w.of)(R)},ze=()=>{ye||J((0,C._g)(ee).map(x.z))},dt=Z=>(0,C.Io)(ee,Z).map(x.z);(0,u.A)(()=>{A.tags&&A.tags.forEach(Z=>{Z.key&&fe({...we,[Z.id]:dt(Z.key)})})});const _e=(Z,Re)=>{re({...A,tags:A.tags?.map(W=>W.id===Z.id?{...W,key:Re?.value||"",value:void 0}:W)}),(async()=>{if(Re?.value)fe({...we,[Z.id]:dt(Re.value)});else{const W={...we};W[Z.id]&&delete W[Z.id],fe(W)}})()},Ke=()=>{const Z={id:(0,F.zE)(),operator:"="};re({...A,tags:[...A.tags,Z]})},ut=Z=>{let Re=A.tags.filter(P=>P.id!==Z);Re.length===0&&(Re=[{id:(0,F.zE)(),operator:"="}]),re({...A,tags:Re})};return(0,s.jsx)("div",{children:A.tags?.map((Z,Re)=>(0,s.jsx)("div",{children:(0,s.jsxs)(D.B,{gap:0,width:"auto",justifyContent:"flex-start",alignItems:"center",children:[(0,s.jsx)("div",{children:(0,s.jsx)(g.l6,{"aria-label":"Select tag key",isClearable:!0,onChange:P=>_e(Z,P),onOpenMenu:ze,options:ye||(Z.key?[Z.key].map(x.z):[]),placeholder:"Select tag",value:Z.key||null},Z.key)}),(0,s.jsx)("div",{children:(0,s.jsx)(g.l6,{"aria-label":"Select tag operator",onChange:P=>{re({...A,tags:A.tags?.map(W=>W.id===Z.id?{...W,operator:P.value}:W)})},options:[(0,x.z)("="),(0,x.z)("!="),(0,x.z)("=~"),(0,x.z)("!~")],value:Z.operator})}),(0,s.jsxs)("span",{className:ve.tagValues,children:[(Z.operator==="="||Z.operator==="!=")&&(0,s.jsx)(g.l6,{"aria-label":"Select tag value",isClearable:!0,onChange:P=>{re({...A,tags:A.tags?.map(W=>W.id===Z.id?{...W,value:P?.value||""}:W)})},options:we[Z.id]?we[Z.id]:Z.value?[Z.value].map(x.z):[],placeholder:"Select value",value:Z.value},Z.value),(Z.operator==="=~"||Z.operator==="!~")&&(0,s.jsx)(H.p,{"aria-label":"Input tag value",onChange:P=>{re({...A,tags:A.tags?.map(W=>W.id===Z.id?{...W,value:P?.currentTarget?.value||""}:W)})},placeholder:"Tag value",width:18,value:Z.value||""})]}),(Z.key||Z.value||A.tags.length>1)&&(0,s.jsx)(_.Z,{"aria-label":"Remove tag",variant:"secondary",icon:"times",onClick:()=>ut(Z.id),tooltip:"Remove tag"}),(Z.key||Z.value)&&Re===A.tags.length-1&&(0,s.jsx)("span",{className:ve.addTag,children:(0,s.jsx)(_.Z,{"aria-label":"Add tag",variant:"secondary",icon:"plus",onClick:Ke,tooltip:"Add tag"})})]})},Z.id))})},R=A=>({addTag:(0,a.css)({marginLeft:A.spacing(1)}),tagValues:(0,a.css)({maxWidth:"200px"})})},14145:(y,v,c)=>{"use strict";c.d(v,{ID:()=>D,Nd:()=>s,XQ:()=>a,Zh:()=>_,gz:()=>w,mT:()=>x,x9:()=>u});const s="kind",a="status",u="status.message",x="library.name",_="library.version",w="trace.state",D="id"},26935:(y,v,c)=>{"use strict";c.d(v,{DetailState:()=>it,TracePageHeader:()=>Tn,TraceTimelineViewer:()=>Xn,filterSpans:()=>Pr,transformTraceData:()=>oa});var s=c(74848),a=c(22803),u=c(96540),x=c(56276),_=c(32370),w=c(90617),D=c(29675),g=c(72386),H=c(75888),F=c.n(H);const k={scrollPageDown:{binding:"s",label:"Scroll down"},scrollPageUp:{binding:"w",label:"Scroll up"},scrollToNextVisibleSpan:{binding:"f",label:"Scroll to the next visible span"},scrollToPrevVisibleSpan:{binding:"b",label:"Scroll to the previous visible span"},panLeft:{binding:["a","left"],label:"Pan left"},panLeftFast:{binding:["shift+a","shift+left"],label:"Pan left \u2014 Large"},panRight:{binding:["d","right"],label:"Pan right"},panRightFast:{binding:["shift+d","shift+right"],label:"Pan right \u2014 Large"},zoomIn:{binding:"up",label:"Zoom in"},zoomInFast:{binding:"shift+up",label:"Zoom in \u2014 Large"},zoomOut:{binding:"down",label:"Zoom out"},zoomOutFast:{binding:"shift+down",label:"Zoom out \u2014 Large"},collapseAll:{binding:"]",label:"Collapse All"},expandAll:{binding:"[",label:"Expand All"},collapseOne:{binding:"p",label:"Collapse One Level"},expandOne:{binding:"o",label:"Expand One Level"},searchSpans:{binding:"ctrl+b",label:"Search Spans"},clearSearch:{binding:"escape",label:"Clear Search"}};let R;function A(){if(R)return R;const e=new(F())(document.body);return R=e,e}function ee(e){const t=A();Object.keys(e).forEach(n=>{const r=e[n];r&&t.bind(k[n].binding,r)})}function re(){A().reset()}var ye=c(46942),J=c.n(ye),we=c(14115);function fe(e){const{min:t,max:n,viewStart:r,viewEnd:i}=e,o=n-t,l=t+r*o,h=n-(1-i)*o-l;return(f,I)=>({start:(f-l)/h,end:(I-l)/h})}function ve(e,t,n){return!Array.isArray(n.tags)||!n.tags.length?!1:n.tags.some(r=>r.key===e&&r.value===t)}const ze=e=>e.kind==="client",dt=ve.bind(null,"span.kind","client"),_e=e=>ze(e)||dt(e),Ke=e=>e.kind==="server",ut=ve.bind(null,"span.kind","server"),Z=e=>Ke(e)||ut(e),Re=e=>e.statusCode===2,P=ve.bind(null,"error",!0),W=ve.bind(null,"error","true"),G=e=>Re(e)||P(e)||W(e);function q(e,t){const{depth:n}=e[t];let r=t+1;for(;r<e.length&&e[r].depth>n;r++)if(G(e[r]))return!0;return!1}function te(e){if(e.length<=1||!_e(e[0]))return!1;const n=e[0].depth+1;let r=1;for(;r<e.length&&e[r].depth===n;){if(Z(e[r]))return e[r];r++}return null}const oe=e=>e.kind?e.kind==="client":e.tags.some(({key:t,value:n})=>t==="span.kind"&&n==="client"),X=e=>({Ticks:(0,a.css)({label:"Ticks",pointerEvents:"none"}),TicksTick:(0,a.css)({label:"TicksTick",position:"absolute",height:"100%",width:"1px",background:(0,g.R)(e,"#d8d8d8"),"&:last-child":{width:0}}),TicksTickLabel:(0,a.css)({label:"TicksTickLabel",left:"0.25rem",position:"absolute"}),TicksTickLabelEndAnchor:(0,a.css)({label:"TicksTickLabelEndAnchor",left:"initial",right:"0.25rem"})});function $e({endTime:e=null,numTicks:t,showLabels:n=null,startTime:r=null}){let i;if(n){i=[];const d=(e||0)-(r||0);for(let h=0;h<t;h++){const f=(r||0)+h/(t-1)*d;i.push((0,we.a3)(f))}}const o=(0,D.of)(X),l=[];for(let d=0;d<t;d++){const h=d/(t-1);l.push((0,s.jsx)("div",{"data-testid":"TicksID",className:o.TicksTick,style:{left:`${h*100}%`},children:i&&(0,s.jsx)("span",{className:J()(o.TicksTickLabel,{[o.TicksTickLabelEndAnchor]:h>=1}),children:i[d]})},h))}return(0,s.jsx)("div",{className:o.Ticks,children:l})}const Be=()=>({row:(0,a.css)({display:"flex",flex:"0 1 auto",flexDirection:"row"}),rowCell:(0,a.css)({position:"relative"})});function Ae({children:e,className:t="",...n}){const r=(0,D.of)(Be);return(0,s.jsx)("div",{className:J()(r.row,t),...n,children:e})}function ge({children:e,className:t="",width:n,style:r={},...i}){const o=`${n*100}%`,l={...r,flexBasis:o,maxWidth:o},d=(0,D.of)(Be);return(0,s.jsx)("div",{className:J()(d.rowCell,t),style:l,"data-testid":"TimelineRowCell",...i,children:e})}Ae.Cell=ge;var De=c(99764);const Fe=()=>({TimelineCollapser:(0,a.css)({alignItems:"center",display:"flex",flex:"none",justifyContent:"center",marginRight:"0.5rem"})});function je(e){const{onExpandAll:t,onExpandOne:n,onCollapseAll:r,onCollapseOne:i}=e,o=(0,D.of)(Fe);return(0,s.jsxs)("div",{className:o.TimelineCollapser,"data-testid":"TimelineCollapser",children:[(0,s.jsx)(De.K,{tooltip:"Expand +1",size:"xl",tooltipPlacement:"top",name:"angle-down",onClick:n}),(0,s.jsx)(De.K,{tooltip:"Collapse +1",size:"xl",tooltipPlacement:"top",name:"angle-right",onClick:i}),(0,s.jsx)(De.K,{tooltip:"Expand All",size:"xl",tooltipPlacement:"top",name:"angle-double-down",onClick:t}),(0,s.jsx)(De.K,{tooltip:"Collapse All",size:"xl",tooltipPlacement:"top",name:"angle-double-right",onClick:r})]})}var We=c(61890);const be=()=>({TimelineColumnResizer:(0,a.css)({left:0,position:"absolute",right:0,top:0}),wrapper:(0,a.css)({bottom:0,position:"absolute",top:0}),dragger:(0,a.css)({borderLeft:"2px solid transparent",cursor:"col-resize",height:"5000px",marginLeft:"-1px",position:"absolute",top:0,width:"1px",zIndex:10,"&:hover":{borderLeft:"2px solid rgba(0, 0, 0, 0.3)"},"&::before":{position:"absolute",top:0,bottom:0,left:"-8px",right:0,content:'" "'}}),draggerDragging:(0,a.css)({background:"rgba(136, 0, 136, 0.05)",width:"unset","&::before":{left:-2e3,right:-2e3}}),draggerDraggingLeft:(0,a.css)({borderLeft:"2px solid #808",borderRight:"1px solid #999"}),draggerDraggingRight:(0,a.css)({borderLeft:"1px solid #999",borderRight:"2px solid #808"}),gripIcon:(0,a.css)({position:"absolute",top:0,bottom:0,"&::before, &::after":{borderRight:"1px solid #ccc",content:'" "',height:"9px",position:"absolute",right:"9px",top:"25px"},"&::after":{right:"5px"}}),gripIconDragging:(0,a.css)({"&::before, &::after":{borderRight:"1px solid rgba(136, 0, 136, 0.5)"}})});class Ce extends u.PureComponent{constructor(t){super(t),this._setRootElm=n=>{this._rootElm=n},this._getDraggingBounds=()=>{if(!this._rootElm)throw new Error("invalid state");const{left:n,width:r}=this._rootElm.getBoundingClientRect(),{min:i,max:o}=this.props;return{clientXLeft:n,width:r,maxValue:o,minValue:i}},this._handleDragUpdate=({value:n})=>{this.setState({dragPosition:n})},this._handleDragEnd=({manager:n,value:r})=>{n.resetBounds(),this.setState({dragPosition:null}),this.props.onChange(r)},this._dragManager=new We.default({getBounds:this._getDraggingBounds,onDragEnd:this._handleDragEnd,onDragMove:this._handleDragUpdate,onDragStart:this._handleDragUpdate}),this._rootElm=void 0,this.state={dragPosition:null}}componentWillUnmount(){this._dragManager.dispose()}render(){let t,n;const{position:r,columnResizeHandleHeight:i}=this.props,{dragPosition:o}=this.state;t=`${r*100}%`;const l={left:t};let d=!1,h=!1;const f=be();if(this._dragManager.isDragging()&&this._rootElm&&o!=null){d=o<r,h=o>r;const j=`${Math.min(r,o)*100}%`,E=`calc(${(1-Math.max(r,o))*100}% - 1px)`;n={left:j,right:E}}else n=l;n.height=i;const I=d||h;return(0,s.jsxs)("div",{className:f.TimelineColumnResizer,ref:this._setRootElm,"data-testid":"TimelineColumnResizer",children:[(0,s.jsx)("div",{className:J()(f.gripIcon,I&&f.gripIconDragging),style:l,"data-testid":"TimelineColumnResizer--gripIcon"}),(0,s.jsx)("div",{"aria-hidden":!0,className:J()(f.dragger,I&&f.draggerDragging,h&&f.draggerDraggingRight,d&&f.draggerDraggingLeft),onMouseDown:this._dragManager.handleMouseDown,style:n,"data-testid":"TimelineColumnResizer--dragger"})]})}}const ke=(0,w.N)(()=>({TimelineViewingLayer:(0,a.css)({label:"TimelineViewingLayer",bottom:0,cursor:"vertical-text",left:0,position:"absolute",right:0,top:0}),TimelineViewingLayerCursorGuide:(0,a.css)({label:"TimelineViewingLayerCursorGuide",position:"absolute",top:0,bottom:0,left:0,width:"1px",backgroundColor:"red"}),TimelineViewingLayerDragged:(0,a.css)({label:"TimelineViewingLayerDragged",position:"absolute",top:0,bottom:0}),TimelineViewingLayerDraggedDraggingLeft:(0,a.css)({label:"TimelineViewingLayerDraggedDraggingLeft",borderLeft:"1px solid"}),TimelineViewingLayerDraggedDraggingRight:(0,a.css)({label:"TimelineViewingLayerDraggedDraggingRight",borderRight:"1px solid"}),TimelineViewingLayerDraggedShiftDrag:(0,a.css)({label:"TimelineViewingLayerDraggedShiftDrag",backgroundColor:"rgba(68, 68, 255, 0.2)",borderColor:"#44f"}),TimelineViewingLayerDraggedReframeDrag:(0,a.css)({label:"TimelineViewingLayerDraggedReframeDrag",backgroundColor:"rgba(255, 68, 68, 0.2)",borderColor:"#f44"}),TimelineViewingLayerFullOverlay:(0,a.css)({label:"TimelineViewingLayerFullOverlay",bottom:0,cursor:"col-resize",left:0,position:"fixed",right:0,top:0,userSelect:"none"})}));function Ue(e){return Reflect.has(e,"isOutOfView")}function nt(e,t,n){return e+n*(t-e)}function Te(e,t,n){return(n-e)/(t-e)}function Ot(e,t){let[n,r]=e<t?[e,t]:[t,e];return n>=1||r<=0?{isOutOfView:!0}:(n<0&&(n=0),r>1&&(r=1),{isDraggingLeft:e>t,left:`${n*100}%`,width:`${(r-n)*100}%`})}function ht(e,t,n,r,i){const o=Te(e,t,n),l=Te(e,t,r),d=Ot(o,l);if(Ue(d))return null;const{isDraggingLeft:h,left:f,width:I}=d,j=ke(),E=(0,a.cx)({[j.TimelineViewingLayerDraggedDraggingRight]:!h,[j.TimelineViewingLayerDraggedReframeDrag]:!i,[j.TimelineViewingLayerDraggedShiftDrag]:i});return(0,s.jsx)("div",{className:(0,a.cx)(j.TimelineViewingLayerDragged,j.TimelineViewingLayerDraggedDraggingLeft,E),style:{left:f,width:I},"data-testid":"Dragged"})}class cs extends u.PureComponent{constructor(t){super(t),this._setRoot=n=>{this._root=n},this._getDraggingBounds=()=>{if(!this._root)throw new Error("invalid state");const{left:n,width:r}=this._root.getBoundingClientRect();return{clientXLeft:n,width:r}},this._handleReframeMouseMove=({value:n})=>{const[r,i]=this.props.viewRangeTime.current,o=nt(r,i,n);this.props.updateNextViewRangeTime({cursor:o})},this._handleReframeMouseLeave=()=>{this.props.updateNextViewRangeTime({cursor:void 0})},this._handleReframeDragUpdate=({value:n})=>{const{current:r,reframe:i}=this.props.viewRangeTime,[o,l]=r,d=nt(o,l,n),f={reframe:{anchor:i?i.anchor:d,shift:d}};this.props.updateNextViewRangeTime(f)},this._handleReframeDragEnd=({manager:n,value:r})=>{const{current:i,reframe:o}=this.props.viewRangeTime,[l,d]=i,h=nt(l,d,r),f=o?o.anchor:h,[I,j]=h<f?[h,f]:[f,h];n.resetBounds(),this.props.updateViewRangeTime(I,j,"timeline-header")},this._draggerReframe=new We.default({getBounds:this._getDraggingBounds,onDragEnd:this._handleReframeDragEnd,onDragMove:this._handleReframeDragUpdate,onDragStart:this._handleReframeDragUpdate,onMouseLeave:this._handleReframeMouseLeave,onMouseMove:this._handleReframeMouseMove}),this._root=void 0}UNSAFE_componentWillReceiveProps(t){const{boundsInvalidator:n}=this.props;n!==t.boundsInvalidator&&this._draggerReframe.resetBounds()}componentWillUnmount(){this._draggerReframe.dispose()}render(){const{viewRangeTime:t}=this.props,{current:n,cursor:r,reframe:i,shiftEnd:o,shiftStart:l}=t,[d,h]=n,f=i!=null||o!=null||l!=null;let I;!f&&r!=null&&r>=d&&r<=h&&(I=`${Te(d,h,r)*100}%`);const j=ke();return(0,s.jsxs)("div",{"aria-hidden":!0,className:j.TimelineViewingLayer,ref:this._setRoot,onMouseDown:this._draggerReframe.handleMouseDown,onMouseLeave:this._draggerReframe.handleMouseLeave,onMouseMove:this._draggerReframe.handleMouseMove,"data-testid":"TimelineViewingLayer",children:[I!=null&&(0,s.jsx)("div",{className:j.TimelineViewingLayerCursorGuide,style:{left:I},"data-testid":"TimelineViewingLayer--cursorGuide"}),i!=null&&ht(d,h,i.anchor,i.shift,!1),o!=null&&ht(d,h,h,o,!0),l!=null&&ht(d,h,d,l,!0)]})}}const ds=e=>({TimelineHeaderRow:(0,a.css)({label:"TimelineHeaderRow",background:(0,g.R)(e,"#ececec"),borderBottom:`1px solid ${(0,g.R)(e,"#ccc")}`,height:"38px",lineHeight:"38px",width:"100%",zIndex:4,position:"relative"}),TimelineHeaderRowTitle:(0,a.css)({label:"TimelineHeaderRowTitle",flex:1,overflow:"hidden",margin:0,textOverflow:"ellipsis",whiteSpace:"nowrap"}),TimelineHeaderWrapper:(0,a.css)({label:"TimelineHeaderWrapper",alignItems:"center",display:"flex",paddingLeft:e.spacing(1),paddingRight:e.spacing(1)})});function us(e){const{duration:t,nameColumnWidth:n,numTicks:r,onCollapseAll:i,onCollapseOne:o,onColummWidthChange:l,onExpandAll:d,onExpandOne:h,updateViewRangeTime:f,updateNextViewRangeTime:I,viewRangeTime:j,columnResizeHandleHeight:E}=e,[N,z]=j.current,B=(0,D.of)(ds);return(0,s.jsxs)(Ae,{className:B.TimelineHeaderRow,"data-testid":"TimelineHeaderRow",children:[(0,s.jsxs)(Ae.Cell,{className:B.TimelineHeaderWrapper,width:n,children:[(0,s.jsx)("h4",{className:B.TimelineHeaderRowTitle,children:"Service & Operation"}),(0,s.jsx)(je,{onCollapseAll:i,onExpandAll:d,onCollapseOne:o,onExpandOne:h})]}),(0,s.jsxs)(Ae.Cell,{width:1-n,children:[(0,s.jsx)(cs,{boundsInvalidator:n,updateNextViewRangeTime:I,updateViewRangeTime:f,viewRangeTime:j}),(0,s.jsx)($e,{numTicks:r,startTime:N*t,endTime:z*t,showLabels:!0})]}),(0,s.jsx)(Ce,{columnResizeHandleHeight:E,position:n,onChange:l,min:.2,max:.85})]})}var Le=c(2543),xt=c(41811),Je=c(52120);const hs="peer.service";var Et=c(60306);class gs{constructor(t){this.ys=[],this.heights=[],this.bufferLen=t,this.dataLen=-1,this.lastI=-1}profileData(t){t!==this.dataLen&&(this.dataLen=t,this.ys.length=t,this.heights.length=t,this.lastI>=t&&(this.lastI=t-1))}calcHeights(t,n,r){r!=null&&(this.lastI=r);let i=t+this.bufferLen;if(i<=this.lastI)return;i>=this.heights.length&&(i=this.heights.length-1);let o=this.lastI;for(this.lastI===-1&&(o=0,this.ys[0]=0);o<=i;){const l=this.heights[o]=n(o);this.ys[o+1]=this.ys[o]+l,o++}this.lastI=i}calcYs(t,n){for(;(this.ys[this.lastI]==null||t>this.ys[this.lastI])&&this.lastI<this.dataLen-1;)this.calcHeights(this.lastI,n)}confirmHeight(t,n){let r=t;if(r>this.lastI){this.calcHeights(r,n);return}const i=n(r);if(i===this.heights[r])return;const o=i-this.heights[r];for(this.heights[r]=i;++r<=this.lastI;)this.ys[r]+=o;this.ys[this.lastI+1]!=null&&(this.ys[this.lastI+1]+=o)}findFloorIndex(t,n){this.calcYs(t,n);let r=0,i=this.lastI;if(this.ys.length<2||t<this.ys[1])return 0;if(t>this.ys[i])return i;let o;for(;r<i;)if(o=r+.5*(i-r)|0,t>this.ys[o]){if(t<=this.ys[o+1])return o;r=o}else if(t<this.ys[o]){if(t>=this.ys[o-1])return o-1;i=o}else return o;throw new Error(`unable to find floor index for y=${t}`)}getRowPosition(t,n){return this.confirmHeight(t,n),{height:this.heights[t],y:this.ys[t]}}getEstimatedHeight(){const t=this.ys[this.lastI]+this.heights[this.lastI];return this.lastI>=this.dataLen-1?t|0:t/(this.lastI+1)*this.heights.length|0}}const Wt=100;class zt extends u.Component{constructor(t){super(t),this.getViewHeight=()=>this._viewHeight,this.getBottomVisibleIndex=()=>{const n=this._scrollTop+this._viewHeight;return this._yPositions.findFloorIndex(n,this._getHeight)},this.getTopVisibleIndex=()=>this._yPositions.findFloorIndex(this._scrollTop,this._getHeight),this.getRowPosition=n=>this._yPositions.getRowPosition(n,this._getHeight),this.scrollToIndex=(n,r)=>{const{scrollElement:i}=this.props,o=i?.getBoundingClientRect().top||0,d=(i?.scrollTop||0)+(this._itemHolderElm?.getBoundingClientRect().top||0)-o,h=this.getRowPosition(n).y;this.props.scrollElement?.scrollTo({top:h+d-r-80})},this._onScroll=()=>{this._isScrolledOrResized||(this._isScrolledOrResized=!0,window.requestAnimationFrame(this._positionList))},this._positionList=()=>{if(this._isScrolledOrResized=!1,!this._wrapperElm)return;this._calcViewIndexes();const n=this.props.viewBufferMin>this._startIndex?0:this._startIndex-this.props.viewBufferMin,r=this.props.viewBufferMin<this.props.dataLength-this._endIndex?this._endIndex+this.props.viewBufferMin:this.props.dataLength-1;(n<this._startIndexDrawn||r>this._endIndexDrawn)&&this.forceUpdate()},this._initWrapper=n=>{this.props.windowScroller&&(this._wrapperElm=n,n&&(this._viewHeight=n.clientHeight))},this._initItemHolder=n=>{this._itemHolderElm=n,this._scanItemHeights()},this._scanItemHeights=()=>{const n=this.props.getIndexFromKey;if(!this._itemHolderElm)return;let r=null,i=null,o=!1;const l=this._itemHolderElm.childNodes,d=l.length;for(let h=0;h<d;h++){const f=l[h];if(f instanceof HTMLElement){const I=f.getAttribute("data-item-key");if(!I){console.warn("itemKey not found");continue}const E=(f.firstElementChild||f).clientHeight,N=this._knownHeights.get(I);E!==N&&(this._knownHeights.set(I,E),o?i=I:(o=!0,r=i=I))}}if(r!=null&&i!=null){const h=n(r),f=i===r?h:n(i);this._yPositions.calcHeights(f,this._getHeight,h),this.forceUpdate()}},this._getHeight=n=>{const r=this.props.getKeyFromIndex(n),i=this._knownHeights.get(r);return i!=null&&i===i?i:this.props.itemHeightGetter(n,r)},this._yPositions=new gs(200),this._knownHeights=new Map,this._startIndexDrawn=2**20,this._endIndexDrawn=-(2**20),this._startIndex=0,this._endIndex=0,this._viewHeight=-1,this._scrollTop=-1,this._isScrolledOrResized=!1,this._htmlTopOffset=-1,this._windowScrollListenerAdded=!1,this._htmlElm=document.documentElement,this._wrapperElm=void 0,this._itemHolderElm=void 0}static{this.defaultProps={initialDraw:Wt,itemsWrapperClassName:"",windowScroller:!1}}componentDidMount(){if(this.props.windowScroller){if(this._wrapperElm){const{top:t}=this._wrapperElm.getBoundingClientRect();this._htmlTopOffset=t+this._htmlElm.scrollTop}window.addEventListener("scroll",this._onScroll),this._windowScrollListenerAdded=!0}else this._wrapperElm=this.props.scrollElement,this._wrapperElm?.addEventListener("scroll",this._onScroll)}componentDidUpdate(t){this._itemHolderElm&&this._scanItemHeights(),!this.props.windowScroller&&t.scrollElement!==this.props.scrollElement&&(t.scrollElement?.removeEventListener("scroll",this._onScroll),this._wrapperElm=this.props.scrollElement,this._wrapperElm?.addEventListener("scroll",this._onScroll))}componentWillUnmount(){this._windowScrollListenerAdded?window.removeEventListener("scroll",this._onScroll):this._wrapperElm?.removeEventListener("scroll",this._onScroll)}_isViewChanged(){if(!this._wrapperElm)return!1;const t=this.props.windowScroller,n=t?this._htmlElm.clientHeight:this._wrapperElm.clientHeight,r=t?this._htmlElm.scrollTop:this._wrapperElm.scrollTop;return n!==this._viewHeight||r!==this._scrollTop}_calcViewIndexes(){if(this.props.windowScroller)this._viewHeight=window.innerHeight-this._htmlTopOffset,this._scrollTop=window.scrollY;else{if(!this._wrapperElm){this._viewHeight=-1,this._startIndex=0,this._endIndex=0;return}this._viewHeight=this._wrapperElm.clientHeight,this._scrollTop=this._wrapperElm.scrollTop}const n=this._scrollTop,r=this._scrollTop+this._viewHeight;this._startIndex=this._yPositions.findFloorIndex(n,this._getHeight),this._endIndex=this._yPositions.findFloorIndex(r,this._getHeight)}render(){const{dataLength:t,getKeyFromIndex:n,initialDraw:r=Wt,itemRenderer:i,viewBuffer:o,viewBufferMin:l}=this.props,d=this._getHeight,h=[];let f,I;if(this._yPositions.profileData(t),!this._wrapperElm)f=0,I=(r<t?r:t)-1;else{this._isViewChanged()&&this._calcViewIndexes();const N=l>this._startIndex?0:this._startIndex-l,z=l<t-this._endIndex?this._endIndex+l:t-1;N<this._startIndexDrawn||z>this._endIndexDrawn?(f=o>this._startIndex?0:this._startIndex-o,I=this._endIndex+o,I>=t&&(I=t-1)):(f=this._startIndexDrawn>t-1?0:this._startIndexDrawn,I=this._endIndexDrawn>t-1?t-1:this._endIndexDrawn)}this._yPositions.calcHeights(I,d,f||-1),this._startIndexDrawn=f,this._endIndexDrawn=I,h.length=I-f+1;for(let N=f;N<=I;N++){const{y:z,height:B}=this._yPositions.getRowPosition(N,d),Y={height:B,top:z,position:"absolute"},U=n(N),K={"data-item-key":U};h.push(i(U,Y,N,K))}const j={style:{position:"relative"},ref:this._initWrapper};this.props.windowScroller||(j.onScroll=this._onScroll,j.style.height="100%",j.style.overflowY="auto");const E={position:"relative",height:this._yPositions.getEstimatedHeight()};return(0,s.jsx)("div",{...j,"data-testid":"ListView",children:(0,s.jsx)("div",{style:E,children:(0,s.jsx)("div",{style:{position:"absolute",top:0,margin:0,padding:0},className:this.props.itemsWrapperClassName,ref:this._initItemHolder,children:h})})})}}const _t="None",Kt="Duration",At="Tag";function ps({options:e,onOptionsChange:t}){const n=useStyles2(fs),r=[_t,Kt,At].map(toOption);return jsxs("div",{className:css({width:"100%"}),children:[jsx(InlineFieldRow,{className:n.row,children:jsx(InlineField,{label:"Label",labelWidth:26,tooltip:"Default: duration",grow:!0,children:jsx(Select,{inputId:"label",options:r,value:e.jsonData.spanBar?.type||"",onChange:i=>{updateDatasourcePluginJsonDataOption({onOptionsChange:t,options:e},"spanBar",{...e.jsonData.spanBar,type:i?.value??""})},placeholder:"Duration",isClearable:!0,"aria-label":"select-label-name",width:40})})}),e.jsonData.spanBar?.type===At&&jsx(InlineFieldRow,{className:n.row,children:jsx(InlineField,{label:"Tag key",labelWidth:26,tooltip:"Tag key which will be used to get the tag value. A span's attributes and resources will be searched for the tag key",children:jsx(Input,{type:"text",placeholder:"Enter tag key",onChange:i=>updateDatasourcePluginJsonDataOption({onOptionsChange:t,options:e},"spanBar",{...e.jsonData.spanBar,tag:i.currentTarget.value}),value:e.jsonData.spanBar?.tag||"",width:40})})})]})}const tn=({options:e,onOptionsChange:t})=>{let n=e.type;return n+=e.type==="tempo"?"/configure-tempo-data-source/#span-bar":"/#span-bar",jsx(ConfigSubSection,{title:"Span bar",description:jsx(ConfigDescriptionLink,{description:"Add additional info next to the service and operation on a span bar row in the trace view.",suffix:n,feature:"the span bar"}),children:jsx(ps,{options:e,onOptionsChange:t})})},fs=e=>({infoText:css({label:"infoText",paddingBottom:e.spacing(2),color:e.colors.text.secondary}),row:css({label:"row",alignItems:"baseline"})});var Se=c(79784),Ut=c(58779),rt=c(6736),yt=c(52706),ms=c(95486);function vs({children:e,content:t,overlayClassName:n}){const r=(0,u.useRef)(null);return(0,s.jsx)(yt.I,{content:t,hideAfter:300,children:(i,o,l)=>(0,s.jsxs)(s.Fragment,{children:[r.current&&(0,s.jsx)(ms.A,{...l,referenceElement:r.current,wrapperClassName:n,onMouseLeave:o,onMouseEnter:i}),(0,u.cloneElement)(e,{ref:r,onMouseEnter:i,onMouseLeave:o})]})})}const xs="label";var qe=c(54594);const ys=()=>({CopyIcon:(0,a.css)({backgroundColor:"transparent",border:"none",color:"inherit",height:"100%",overflow:"hidden","&:focus":{backgroundColor:"rgba(255, 255, 255, 0.25)",color:"inherit"}})});function bs({copyText:e,icon:t="copy",tooltipTitle:n}){const r=(0,D.of)(ys),[i,o]=(0,u.useState)(!1),l=()=>{navigator.clipboard.writeText(e),o(!0)};return(0,s.jsx)(rt.m,{content:i?"Copied":n,children:(0,s.jsx)(qe.$n,{className:J()(r.CopyIcon),type:"button",icon:t,onClick:l})})}const p="    ";function m(e){let t="";return e&&Object.keys(e).forEach(function(n){t+=n+":"+e[n]+";"}),t}function S(e){function t(r){return'class="'+r+'"'}function n(r){return'style="'+m(e["."+r])+'"'}return e?n:t}function b(e){return e===null?"null":Array.isArray(e)?"array":typeof e=="string"&&/^https?:/.test(e)?"link":typeof e=="object"&&typeof e.toISOString=="function"?"date":typeof e}function T(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}function M(e,t){let n="";const r=S(t);let i=function(l,d,h,f){if(!l.length)return d+" "+h;let I=d+`
`;return n+=p,l.forEach(function(j,E){I+=n+f(j)+(E<l.length-1?",":"")+`
`}),n=n.slice(0,-p.length),I+n+h};function o(l){if(l===void 0)return"";switch(b(l)){case"boolean":return"<span "+r("json-markup-bool")+">"+l+"</span>";case"number":return"<span "+r("json-markup-number")+">"+l+"</span>";case"date":return'<span class="json-markup-string">"'+T(l.toISOString())+'"</span>';case"null":return"<span "+r("json-markup-null")+">null</span>";case"string":return"<span "+r("json-markup-string")+'>"'+T(l.replace(/\n/g,`
`+n))+'"</span>';case"link":return"<span "+r("json-markup-string")+'>"<a href="'+encodeURI(l)+'">'+T(l)+'</a>"</span>';case"array":return i(l,"[","]",o);case"object":const d=Object.keys(l).filter(function(h){return l[h]!==void 0});return i(d,"{","}",function(h){return"<span "+r("json-markup-key")+'>"'+T(h)+'":</span> '+o(l[h])})}return""}return"<div "+r("json-markup")+">"+o(e)+"</div>"}const L="copyIcon",O=e=>({KeyValueTable:(0,a.css)({label:"KeyValueTable",background:(0,g.R)(e,"#fff"),border:`1px solid ${(0,g.R)(e,"#ddd")}`,marginBottom:"0.5rem",maxHeight:"450px",overflow:"auto"}),table:(0,a.css)({width:"100%"}),body:(0,a.css)({label:"body",verticalAlign:"baseline"}),row:(0,a.css)({label:"row","& > td":{padding:"0.5rem 0.5rem",height:"30px"},"&:nth-child(2n) > td":{background:(0,g.R)(e,"#f5f5f5")},[`&:not(:hover) .${L}`]:{visibility:"hidden"}}),keyColumn:(0,a.css)({label:"keyColumn",color:(0,g.R)(e,"#888"),whiteSpace:"pre",width:"125px",verticalAlign:"top"}),copyColumn:(0,a.css)({label:"copyColumn",textAlign:"right"}),linkIcon:(0,a.css)({label:"linkIcon",verticalAlign:"middle",fontWeight:"bold"}),jsonTable:(0,a.css)({display:"inline-block"})}),$=/^(\[|\{)/;function se(e){if(typeof e=="string"&&$.test(e))try{return JSON.parse(e)}catch{}return e}const de=({href:e,title:t="",children:n})=>(0,s.jsxs)("a",{href:e,title:t,target:"_blank",rel:"noopener noreferrer",children:[n," ",(0,s.jsx)(Se.I,{name:"external-link-alt"})]});function me(e){const{data:t,linksGetter:n}=e,r=(0,D.of)(O);return(0,s.jsx)("div",{className:J()(r.KeyValueTable),"data-testid":"KeyValueTable",children:(0,s.jsx)("table",{className:r.table,children:(0,s.jsx)("tbody",{className:r.body,children:t.map((i,o)=>{const l={__html:M(se(i.value))},d=(0,s.jsx)("div",{className:r.jsonTable,dangerouslySetInnerHTML:l}),h=n?n(t,o):null;let f;return h&&h.length?f=(0,s.jsx)("div",{children:(0,s.jsx)(de,{href:h[0].url,title:h[0].text,children:d})}):f=d,(0,s.jsxs)("tr",{className:r.row,children:[(0,s.jsx)("td",{className:r.keyColumn,"data-testid":"KeyValueTable--keyColumn",children:i.key}),(0,s.jsx)("td",{children:f}),(0,s.jsx)("td",{className:r.copyColumn,children:(0,s.jsx)(bs,{className:L,copyText:JSON.stringify(i,null,2),tooltipTitle:"Copy JSON"})})]},`${i.key}-${o}`)})})})})}var xe=c(11908),Me=c(88090),et=c(53027),at=c(21891),Ge=c(76080),Oe=c(50926),Ss=c(341),gt=c(32160);const Is=e=>t=>({LabeledList:(0,a.css)({label:"LabeledList",listStyle:"none",margin:0,padding:0,...e?{marginRight:"-8px",display:"flex",flexWrap:"wrap",justifyContent:"flex-end"}:{}}),LabeledListItem:(0,a.css)({label:"LabeledListItem",display:"inline-block",...e?{borderRight:`1px solid ${(0,g.R)(t,"#ddd")}`,padding:"0 8px"}:{}}),LabeledListLabel:(0,a.css)({label:"LabeledListLabel",color:t.isLight?"#999":"#666",marginRight:"0.25rem"}),LabeledListValue:(0,a.css)({label:"LabeledListValue",marginRight:e?void 0:"0.55rem"})});function Gt(e){const{className:t,divider:n=!1,items:r}=e,i=(0,D.of)(Is(n));return(0,s.jsx)("ul",{className:J()(i.LabeledList,t),children:r.map(({key:o,label:l,value:d})=>(0,s.jsxs)("li",{className:i.LabeledListItem,children:[(0,s.jsx)("span",{className:i.LabeledListLabel,children:l}),(0,s.jsx)("strong",{className:i.LabeledListValue,children:d})]},`${o}`))})}var ue=c(14145),pt=c(73944);function Zt(e){const{reference:t,children:n,createFocusSpanLink:r}=e,i=r(t.traceID,t.spanID);return(0,s.jsx)("a",{href:i.href,target:i.target,rel:"noopener noreferrer",onClick:i.onClick?o=>{o.preventDefault(),i.onClick(o)}:void 0,children:n})}const Qt=e=>({AccordianReferenceItem:(0,a.css)({borderBottom:`1px solid ${(0,g.R)(e,"#d8d8d8")}`}),AccordianKeyValues:(0,a.css)({marginLeft:"10px"}),AccordianReferences:(0,a.css)({label:"AccordianReferences",border:`1px solid ${(0,g.R)(e,"#d8d8d8")}`,position:"relative",marginBottom:"0.25rem"}),AccordianReferencesHeader:(0,a.css)({label:"AccordianReferencesHeader",background:(0,g.R)(e,"#e4e4e4"),color:"inherit",display:"block",padding:"0.25rem 0.5rem","&:hover":{background:(0,g.R)(e,"#dadada")}}),AccordianReferencesContent:(0,a.css)({label:"AccordianReferencesContent",background:(0,g.R)(e,"#f0f0f0"),borderTop:`1px solid ${(0,g.R)(e,"#d8d8d8")}`,padding:"0.5rem 0.5rem 0.25rem 0.5rem"}),AccordianReferencesFooter:(0,a.css)({label:"AccordianReferencesFooter",color:(0,g.R)(e,"#999")}),AccordianKeyValuesItem:(0,a.css)({marginBottom:e.spacing(.5)}),ReferencesList:(0,a.css)({background:"#fff",border:"1px solid #ddd",marginBottom:"0.7em",maxHeight:"450px",overflow:"auto"}),list:(0,a.css)({width:"100%",listStyle:"none",padding:0,margin:0,background:"#fff"}),itemContent:(0,a.css)({padding:"0.25rem 0.5rem",display:"flex",width:"100%",justifyContent:"space-between"}),item:(0,a.css)({"&:nth-child(2n)":{background:"#f5f5f5"}}),debugInfo:(0,a.css)({letterSpacing:"0.25px",margin:"0.5em 0 0",flexWrap:"wrap",display:"flex",justifyContent:"flex-end"}),debugLabel:(0,a.css)({margin:"0 5px 0 5px","&::before":{color:"#bbb",content:"attr(data-label)"}}),serviceName:(0,a.css)({marginRight:"8px"}),title:(0,a.css)({display:"flex",alignItems:"center",gap:"4px"})});function Ts(e){const{data:t,createFocusSpanLink:n,openedItems:r,onItemToggle:i,interactive:o}=e,l=(0,D.of)(Qt);return(0,s.jsx)("div",{className:l.AccordianReferencesContent,children:t.map((d,h)=>(0,s.jsxs)("div",{className:h<t.length-1?l.AccordianReferenceItem:void 0,children:[(0,s.jsx)("div",{className:l.item,children:(0,s.jsx)(Zt,{reference:d,createFocusSpanLink:n,children:(0,s.jsxs)("span",{className:l.itemContent,children:[d.span?(0,s.jsxs)("span",{children:[(0,s.jsx)("span",{className:(0,a.cx)("span-svc-name",l.serviceName),children:d.span.process.serviceName}),(0,s.jsx)("small",{className:"endpoint-name",children:d.span.operationName})]}):(0,s.jsxs)("span",{className:(0,a.cx)("span-svc-name",l.title),children:["View Linked Span ",(0,s.jsx)(Se.I,{name:"external-link-alt"})]}),(0,s.jsxs)("small",{className:l.debugInfo,children:[(0,s.jsx)("span",{className:l.debugLabel,"data-label":"TraceID:",children:d.traceID}),(0,s.jsx)("span",{className:l.debugLabel,"data-label":"SpanID:",children:d.spanID})]})]})})},`${d.spanID}`),!!d.tags?.length&&(0,s.jsx)("div",{className:l.AccordianKeyValues,children:(0,s.jsx)(bt,{className:h<t.length-1?l.AccordianKeyValuesItem:null,data:d.tags||[],highContrast:!0,interactive:o,isOpen:r?r.has(d):!1,label:"attributes",linksGetter:null,onToggle:o&&i?()=>i(d):null})})]},h))})}const ws=({data:e,interactive:t=!0,isOpen:n,onToggle:r,onItemToggle:i,openedItems:o,createFocusSpanLink:l})=>{const d=!Array.isArray(e)||!e.length;let h=null,f="span",I=null;t&&(h=n?(0,s.jsx)(Se.I,{name:"angle-down",className:ft}):(0,s.jsx)(Se.I,{name:"angle-right",className:ft}),f="a",I={"aria-checked":n,onClick:d?null:r,role:"switch"});const j=(0,D.of)(Qt);return(0,s.jsxs)("div",{className:j.AccordianReferences,children:[(0,s.jsxs)(f,{className:j.AccordianReferencesHeader,...I,children:[h,(0,s.jsx)("strong",{children:(0,s.jsx)("span",{children:"References"})})," ","(",e.length,")"]}),n&&(0,s.jsx)(Ts,{data:e,openedItems:o,createFocusSpanLink:l,onItemToggle:i,interactive:t})]})},Ds=u.memo(ws),Xt=()=>({TextList:(0,a.css)({maxHeight:"450px",overflow:"auto"}),List:(0,a.css)({width:"100%",listStyle:"none",padding:0,margin:0}),item:(0,a.css)({padding:"0.25rem 0.5rem",verticalAlign:"top","&:nth-child(2n)":{background:"#f5f5f5"}})});function Cs(e){const{data:t}=e,n=(0,D.of)(Xt);return(0,s.jsx)("div",{className:J()(n.TextList),"data-testid":"TextList",children:(0,s.jsx)("ul",{className:n.List,children:t.map((r,i)=>(0,s.jsx)("li",{className:n.item,children:r},`${i}`))})})}const Ft=e=>({header:(0,a.css)({cursor:"pointer",overflow:"hidden",padding:"0.25em 0.1em",textOverflow:"ellipsis",whiteSpace:"nowrap","&:hover":{background:(0,g.R)(e,"#e8e8e8")}})});function Rs({data:e}){return(0,s.jsx)(Cs,{data:e})}function Bt({className:e=null,data:t,headerClassName:n,highContrast:r=!1,interactive:i=!0,isOpen:o,label:l,onToggle:d=null,TextComponent:h=Rs}){const f=!Array.isArray(t)||!t.length,I=(0,D.of)(Pt),j=J()(ft,{[I.emptyIcon]:f});let E=null,N=null;i&&(E=o?(0,s.jsx)(Se.I,{name:"angle-down",className:j}):(0,s.jsx)(Se.I,{name:"angle-right",className:j}),N={"aria-checked":o,onClick:f?null:d,role:"switch"});const z=(0,D.of)(Ft);return(0,s.jsxs)("div",{className:e||"",children:[(0,s.jsxs)("div",{className:J()(z.header,n),...N,"data-testid":"AccordianText--header",children:[E,(0,s.jsx)("strong",{children:l})," (",t.length,")"]}),o&&(0,s.jsx)(h,{data:t})]})}var ks=c(49185),Es=c(75505),Yt=c(3202),Ls=c(16753),Ns=c(55085),js=c(65502),Ms=c(39736),Jt=c(10059);function Os(e){const{span:t,traceToProfilesOptions:n,timeZone:r,traceFlameGraphs:i,setTraceFlameGraphs:o,setRedrawListView:l,traceDuration:d,traceName:h}=e,[f,{height:I}]=(0,ks.A)(),j=(0,D.of)(_s),E=t.tags.filter(U=>U.key===gt.QW),N=E.length>0?E[0].value:void 0,z=(0,u.useCallback)(()=>{const U=Math.floor(t.startTime/1e3)-3e4,K=(t.startTime+t.duration)/1e3+3e4,Q=(0,Yt.KQ)(K),V=(0,Yt.KQ)(U);return{from:V,to:Q,raw:{from:V,to:Q}}},[t.duration,t.startTime]),B=async(U,K)=>{const Q=await(0,Jt.tR)().get(K);if(Q instanceof js.iy){const ne=(await(0,Es.s)(Q.query(U))).data.find(he=>he.name==="response");if(ne&&ne.length>1)return ne}},Y=(0,u.useCallback)(async(U,K,Q)=>{let V="{}";if(K.customQuery&&K.query){const Ie={...(0,gt.gt)(d,h,Q.traceID),...(0,gt.hv)(Q),...(0,gt.Cr)(Q,K)};V=(0,Ms.w)().replace(K.query,Ie)}else{const Ie=K.tags&&K.tags.length>0?K.tags:gt.i0;V=`{${(0,gt._o)(Q,Ie)}}`}const ne={requestId:"span-flamegraph-requestId",interval:"2s",intervalMs:2e3,range:z(),scopedVars:{},app:Ls.Jk.Unknown,timezone:r,startTime:Q.startTime,targets:[{labelSelector:V,groupBy:[],profileTypeId:K.profileTypeId??"",queryType:"profile",spanSelector:[N],refId:"span-flamegraph-refId",datasource:{type:U.type,uid:U.uid}}]},he=await B(ne,U.uid);he&&he.length>0&&o({...i,[N]:he})},[z,N,o,r,d,i,h]);return(0,u.useEffect)(()=>{if(!Object.keys(i).includes(N)){let U;n&&n?.datasourceUid&&(U=(0,Jt.tR)().getInstanceSettings(n.datasourceUid)),n&&U&&Y(U,n,t)}},[o,t,i,n,z,r,Y,N]),(0,u.useEffect)(()=>{l({})},[I,l]),i[N]?(0,s.jsxs)("div",{className:j.flameGraph,ref:f,children:[(0,s.jsx)("div",{className:j.flameGraphTitle,children:"Flame graph"}),(0,s.jsx)(Ns.A,{data:i[N],getTheme:()=>_.$.theme2,showFlameGraphOnly:!0,disableCollapsing:!0})]}):(0,s.jsx)(s.Fragment,{})}const _s=()=>({flameGraph:(0,a.css)({label:"flameGraphInSpan",margin:"5px"}),flameGraphTitle:(0,a.css)({label:"flameGraphTitleInSpan",marginBottom:"5px",fontWeight:"bold"})}),As=e=>({header:(0,a.css)({display:"flex",alignItems:"flex-start",justifyContent:"space-between",gap:"0 1rem",marginBottom:"0.25rem"}),listWrapper:(0,a.css)({overflow:"hidden"}),list:(0,a.css)({textAlign:"right"}),operationName:(0,a.css)({margin:0,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",flexBasis:"50%",flexGrow:0,flexShrink:0}),debugInfo:(0,a.css)({label:"debugInfo",display:"block",letterSpacing:"0.25px",margin:"0.5em 0 -0.75em",textAlign:"right"}),debugLabel:(0,a.css)({label:"debugLabel","&::before":{color:(0,g.R)(e,"#bbb"),content:"attr(data-label)"}}),debugValue:(0,a.css)({label:"debugValue",backgroundColor:"inherit",border:"none",color:(0,g.R)(e,"#888"),cursor:"pointer","&:hover":{color:(0,g.R)(e,"#333")}}),AccordianWarnings:(0,a.css)({label:"AccordianWarnings",background:(0,g.R)(e,"#fafafa"),border:`1px solid ${(0,g.R)(e,"#e4e4e4")}`,marginBottom:"0.25rem"}),AccordianWarningsHeader:(0,a.css)({label:"AccordianWarningsHeader",background:(0,g.R)(e,"#fff7e6"),padding:"0.25rem 0.5rem","&:hover":{background:(0,g.R)(e,"#ffe7ba")}}),AccordianWarningsHeaderOpen:(0,a.css)({label:"AccordianWarningsHeaderOpen",borderBottom:`1px solid ${(0,g.R)(e,"#e8e8e8")}`}),AccordianWarningsLabel:(0,a.css)({label:"AccordianWarningsLabel",color:(0,g.R)(e,"#d36c08")}),AccordianKeyValuesItem:(0,a.css)({marginBottom:e.spacing(.5)}),Textarea:(0,a.css)({wordBreak:"break-all",whiteSpace:"pre"}),LinkIcon:(0,a.css)({fontSize:"1.5em"}),linkList:(0,a.css)({display:"flex",flexWrap:"wrap",gap:"10px"})}),ft=(0,a.css)({margin:"-0.2rem 0.25rem 0 0"});function Fs(e){const{detailState:t,linksGetter:n,logItemToggle:r,logsToggle:i,processToggle:o,span:l,tagsToggle:d,traceStartTime:h,traceDuration:f,traceName:I,warningsToggle:j,stackTracesToggle:E,referencesToggle:N,referenceItemToggle:z,createSpanLink:B,createFocusSpanLink:Y,datasourceType:U,traceFlameGraphs:K,setTraceFlameGraphs:Q,traceToProfilesOptions:V,setRedrawListView:ne}=e,{isTagsOpen:he,isProcessOpen:Ie,logs:pe,isWarningsOpen:Ee,references:Pe,isStackTracesOpen:tt}=t,{operationName:ae,process:Ve,duration:st,relativeStartTime:St,startTime:lt,traceID:It,spanID:Ne,logs:Qe,tags:ce,warnings:ct,references:Xe,stackTraces:mt}=l,{timeZone:He}=e;let Ye=[{key:"svc",label:"Service:",value:Ve.serviceName},{key:"duration",label:"Duration:",value:(0,we.a3)(st)},{key:"start",label:"Start Time:",value:(0,we.a3)(St)+Bs(lt,He)},...l.childSpanCount>0?[{key:"child_count",label:"Child Count:",value:l.childSpanCount}]:[]];const ie=(0,D.of)(As);l.kind&&Ye.push({key:ue.Nd,label:"Kind:",value:l.kind}),l.statusCode!==void 0&&Ye.push({key:ue.XQ,label:"Status:",value:xe.s[l.statusCode].toLowerCase()}),l.statusMessage&&Ye.push({key:ue.x9,label:"Status Message:",value:l.statusMessage}),l.instrumentationLibraryName&&Ye.push({key:ue.mT,label:"Library Name:",value:l.instrumentationLibraryName}),l.instrumentationLibraryVersion&&Ye.push({key:ue.Zh,label:"Library Version:",value:l.instrumentationLibraryVersion}),l.traceState&&Ye.push({key:ue.gz,label:"Trace State:",value:l.traceState});const Tt=(le,vt,Rt,kt)=>(0,s.jsx)(at.R,{link:{...le,title:Rt,target:"_blank",origin:le.field,onClick:wt=>{(0,x.rR)("grafana_traces_trace_view_span_link_clicked",{datasourceType:U,grafana_version:_.$.buildInfo.version,type:vt,location:"spanDetails"}),le.onClick?le.onClick?.(wt):et.Ny.push(le.href)}},buttonProps:{icon:kt}});let Mt=null,Cn=null,Rn=null;if(B){const le=B(l),vt=le?.filter(wt=>wt.type===pt.N.Logs);le&&vt&&vt.length>0&&(Mt=Tt(vt[0],pt.N.Logs,"Logs for this span","gf-logs"));const Rt=le?.filter(wt=>wt.type===pt.N.Profiles&&wt.title===Ss.cd);le&&Rt&&Rt.length>0&&(Cn=Tt(Rt[0],pt.N.Profiles,"Profiles for this span","link"));const kt=le?.filter(wt=>wt.type===pt.N.Session);le&&kt&&kt.length>0&&(Rn=Tt(kt[0],pt.N.Session,"Session for this span","frontend-observability"))}const en=Y(It,Ne);return(0,s.jsxs)("div",{"data-testid":"span-detail-component",children:[(0,s.jsxs)("div",{className:ie.header,children:[(0,s.jsx)("h2",{className:ie.operationName,title:ae,children:ae}),(0,s.jsx)("div",{className:ie.listWrapper,children:(0,s.jsx)(Gt,{className:ie.list,divider:!0,items:Ye})})]}),(0,s.jsxs)("div",{className:ie.linkList,children:[Mt,Cn,Rn]}),(0,s.jsx)(Ge.c,{spacing:1}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(bt,{data:ce,label:"Span Attributes",linksGetter:n,isOpen:he,onToggle:()=>d(Ne)}),Ve.tags&&(0,s.jsx)(bt,{className:ie.AccordianKeyValuesItem,data:Ve.tags,label:"Resource Attributes",linksGetter:n,isOpen:Ie,onToggle:()=>o(Ne)})]}),Qe&&Qe.length>0&&(0,s.jsx)(Dt,{linksGetter:n,logs:Qe,isOpen:pe.isOpen,openedItems:pe.openedItems,onToggle:()=>i(Ne),onItemToggle:le=>r(Ne,le),timestamp:h}),ct&&ct.length>0&&(0,s.jsx)(Bt,{className:ie.AccordianWarnings,headerClassName:ie.AccordianWarningsHeader,label:(0,s.jsx)("span",{className:ie.AccordianWarningsLabel,children:"Warnings"}),data:ct,isOpen:Ee,onToggle:()=>j(Ne)}),mt?.length?(0,s.jsx)(Bt,{label:"Stack trace",data:mt,isOpen:tt,TextComponent:le=>{let vt;return le.data?.length>1?vt=le.data.map((Rt,kt)=>`StackTrace ${kt+1}:
${Rt}`).join(`
`):vt=le.data?.[0],(0,s.jsx)(Oe.f,{className:ie.Textarea,style:{cursor:"unset"},readOnly:!0,cols:10,rows:10,value:vt})},onToggle:()=>E(Ne)}):null,Xe&&Xe.length>0&&(Xe.length>1||Xe[0].refType!=="CHILD_OF")&&(0,s.jsx)(Ds,{data:Xe,isOpen:Pe.isOpen,openedItems:Pe.openedItems,onToggle:()=>N(Ne),onItemToggle:le=>z(Ne,le),createFocusSpanLink:Y}),l.tags.some(le=>le.key===gt.QW)&&(0,s.jsx)(Os,{span:l,timeZone:He,traceFlameGraphs:K,setTraceFlameGraphs:Q,traceToProfilesOptions:V,setRedrawListView:ne,traceDuration:f,traceName:I}),(0,s.jsxs)("small",{className:ie.debugInfo,children:[(0,s.jsx)("a",{...en,onClick:le=>{en.onClick&&le.button===0&&(!le.currentTarget.target||le.currentTarget.target==="_self")&&!(le.metaKey||le.altKey||le.ctrlKey||le.shiftKey)&&(le.preventDefault(),en.onClick(le))},children:(0,s.jsx)(Se.I,{name:"link",className:J()(ft,ie.LinkIcon)})}),(0,s.jsx)("span",{className:ie.debugLabel,"data-label":"SpanID:"})," ",Ne]})]})]})}const Bs=(e,t)=>{const n=(0,Me.LE)(e/1e3,{timeZone:t,defaultWithMS:!0}),r=n.split(" ");return` (${r[1]?r[1]:n})`},Pt=e=>({container:(0,a.css)({textOverflow:"ellipsis"}),header:(0,a.css)({label:"header",cursor:"pointer",overflow:"hidden",padding:"0.25em 0.1em",textOverflow:"ellipsis",whiteSpace:"nowrap","&:hover":{background:(0,g.R)(e,"#e8e8e8")}}),headerEmpty:(0,a.css)({label:"headerEmpty",background:"none",cursor:"initial"}),headerHighContrast:(0,a.css)({label:"headerHighContrast","&:hover":{background:(0,g.R)(e,"#ddd")}}),emptyIcon:(0,a.css)({label:"emptyIcon",color:(0,g.R)(e,"#aaa")}),summary:(0,a.css)({label:"summary",display:"inline",listStyle:"none",padding:0}),summaryItem:(0,a.css)({label:"summaryItem",display:"inline",paddingRight:"0.5rem",borderRight:`1px solid ${(0,g.R)(e,"#ddd")}`,"&:last-child":{paddingRight:0,borderRight:"none"}}),summaryLabel:(0,a.css)({label:"summaryLabel",color:(0,g.R)(e,"#777")}),summaryDelim:(0,a.css)({label:"summaryDelim",color:(0,g.R)(e,"#bbb"),padding:"0 0.2em"})});function Ps({data:e=null}){const t=(0,D.of)(Pt);return!Array.isArray(e)||!e.length?null:(0,s.jsx)("ul",{className:t.summary,children:e.map((n,r)=>(0,s.jsxs)("li",{className:t.summaryItem,children:[(0,s.jsx)("span",{className:t.summaryLabel,children:n.key}),(0,s.jsx)("span",{className:t.summaryDelim,children:"="}),String(n.value)]},`${n.key}-${r}`))})}function bt({className:e=null,data:t,logName:n,highContrast:r=!1,interactive:i=!0,isOpen:o,label:l,linksGetter:d,onToggle:h=null}){const f=(!Array.isArray(t)||!t.length)&&!n,I=(0,D.of)(Pt),j=J()(ft,{[I.emptyIcon]:f});let E=null,N=null;const z=n?[{key:"event name",value:n},...t]:t;i&&(E=o?(0,s.jsx)(Se.I,{name:"angle-down",className:j}):(0,s.jsx)(Se.I,{name:"angle-right",className:j}),N={"aria-checked":o,onClick:f?null:h,role:"switch"});const B=t.length>0&&!o;return(0,s.jsxs)("div",{className:J()(e,I.container),children:[(0,s.jsxs)("div",{className:J()(I.header,{[I.headerEmpty]:f,[I.headerHighContrast]:r&&!f}),...N,"data-testid":"AccordianKeyValues--header",children:[E,(0,s.jsxs)("strong",{"data-test":xs,children:[l,B&&":"]}),B&&(0,s.jsx)("span",{className:(0,a.css)({marginLeft:"0.7em"}),children:(0,s.jsx)(Ps,{data:t})})]}),o&&(0,s.jsx)(me,{data:z,linksGetter:d})]})}const Vs=e=>({AccordianLogs:(0,a.css)({label:"AccordianLogs",border:`1px solid ${(0,g.R)(e,"#d8d8d8")}`,position:"relative",marginBottom:"0.25rem"}),AccordianLogsHeader:(0,a.css)({label:"AccordianLogsHeader",background:(0,g.R)(e,"#e4e4e4"),color:"inherit",display:"block",padding:"0.25rem 0.5rem","&:hover":{background:(0,g.R)(e,"#dadada")}}),AccordianLogsContent:(0,a.css)({label:"AccordianLogsContent",background:(0,g.R)(e,"#f0f0f0"),borderTop:`1px solid ${(0,g.R)(e,"#d8d8d8")}`,padding:"0.5rem 0.5rem 0.25rem 0.5rem"}),AccordianLogsFooter:(0,a.css)({label:"AccordianLogsFooter",color:(0,g.R)(e,"#999")}),AccordianKeyValuesItem:(0,a.css)({marginBottom:e.spacing(.5)}),parenthesis:(0,a.css)({color:`${(0,g.R)(e,"#777")}`})});function Dt({interactive:e=!0,isOpen:t,linksGetter:n,logs:r,openedItems:i,onItemToggle:o,onToggle:l,timestamp:d}){let h=null,f="span",I=null;e&&(h=t?(0,s.jsx)(Se.I,{name:"angle-down",className:ft}):(0,s.jsx)(Se.I,{name:"angle-right",className:"u-align-icon"}),f="a",I={"aria-checked":t,onClick:l,role:"switch"});const j=(0,D.of)(Vs);return(0,s.jsxs)("div",{className:j.AccordianLogs,children:[(0,s.jsxs)(f,{className:j.AccordianLogsHeader,...I,children:[h," ",(0,s.jsx)("strong",{children:"Events"})," (",r.length,")"]}),t&&(0,s.jsxs)("div",{className:j.AccordianLogsContent,children:[(0,Le.sortBy)(r,"timestamp").map((E,N)=>{const z=(0,we.a3)(E.timestamp-d),B=E.name&&E.name.length>20,Y=E.name&&B?E.name.slice(0,20)+"...":E.name,U=Y?(0,s.jsxs)("span",{children:[z," ",(0,s.jsxs)("span",{children:["(",Y,")"]})]}):z;return(0,s.jsx)(bt,{className:N<r.length-1?j.AccordianKeyValuesItem:null,data:E.fields||[],logName:B?E.name:void 0,highContrast:!0,interactive:e,isOpen:i?i.has(E):!1,label:U,linksGetter:n,onToggle:e&&o?()=>o(E):null},`${E.timestamp}-${N}`)}),(0,s.jsx)("small",{className:j.AccordianLogsFooter,children:"Event timestamps are relative to the start time of the full trace."})]})]})}const qt=e=>({wrapper:(0,a.css)({label:"wrapper",bottom:0,left:0,position:"absolute",right:0,top:0,overflow:"hidden",zIndex:0}),bar:(0,a.css)({label:"bar",borderRadius:e.shape.radius.default,minWidth:"2px",position:"absolute",height:"36%",top:"32%"}),rpc:(0,a.css)({label:"rpc",position:"absolute",top:"35%",bottom:"35%",zIndex:1}),label:(0,a.css)({label:"label",color:"#aaa",fontSize:"12px",fontFamily:"'Helvetica Neue', Helvetica, Arial, sans - serif",lineHeight:"1em",whiteSpace:"nowrap",padding:"0 0.5em",position:"absolute"}),logMarker:(0,a.css)({label:"logMarker",backgroundColor:(0,g.R)(e,"#2c3235"),cursor:"pointer",height:"60%",minWidth:"1px",position:"absolute",top:"20%","&:hover":{backgroundColor:(0,g.R)(e,"#464c54")},"&::before, &::after":{content:"''",position:"absolute",top:0,bottom:0,right:0,border:"1px solid transparent"},"&::after":{left:0}}),criticalPath:(0,a.css)({position:"absolute",top:"45%",height:"11%",zIndex:2,overflow:"hidden",background:(0,g.R)(e,"#f1f1f1"),borderLeft:`1px solid ${(0,g.R)(e,"#2c3235")}`,borderRight:`1px solid ${(0,g.R)(e,"#2c3235")}`})});function Lt(e){return`${(e*100).toFixed(1)}%`}function Vt(e){return`${e*100}%`}function sn({criticalPath:e,viewEnd:t,viewStart:n,getViewedBounds:r,color:i,shortLabel:o,longLabel:l,onClick:d,rpc:h,traceStartTime:f,span:I,className:j,labelClassName:E}){const[N,z]=(0,u.useState)(o),B=()=>z(o),Y=()=>z(l),U=(0,Le.groupBy)(I.logs,Q=>{const V=r(Q.timestamp,Q.timestamp).start;return Lt(Math.round(V*500)/500)}),K=(0,D.of)(qt);return(0,s.jsxs)("div",{className:J()(K.wrapper,j),onBlur:B,onClick:d,onFocus:Y,onMouseOut:B,onMouseOver:Y,"aria-hidden":!0,"data-testid":Ut.Tp.components.TraceViewer.spanBar,children:[(0,s.jsx)("div",{"aria-label":N,className:J()(K.bar),style:{background:i,left:Lt(n),width:Lt(t-n)},children:(0,s.jsx)("div",{className:J()(K.label,E),"data-testid":"SpanBar--label",children:N})}),(0,s.jsx)("div",{children:Object.keys(U).map(Q=>(0,s.jsx)(vs,{content:(0,s.jsx)(Dt,{interactive:!1,isOpen:!0,logs:U[Q],timestamp:f}),children:(0,s.jsx)("div",{"data-testid":"SpanBar--logMarker",className:J()(K.logMarker),style:{left:Q}})},Q))}),h&&(0,s.jsx)("div",{className:J()(K.rpc),style:{background:h.color,left:Lt(h.viewStart),width:Lt(h.viewEnd-h.viewStart)}}),e?.map((Q,V)=>{const ne=r(Q.section_start,Q.section_end),he=ne.start,Ie=ne.end,pe=`${Q.spanId}-${V}`;return(0,s.jsx)(rt.m,{placement:"top",content:(0,s.jsxs)("div",{children:["A segment on the ",(0,s.jsx)("em",{children:"critical path"})," of the overall trace / request / workflow."]}),children:(0,s.jsx)("div",{"data-testid":"SpanBar--criticalPath",className:K.criticalPath,style:{left:Vt(he),width:Vt(Ie-he)}})},pe)})]})}const Ht=u.memo(sn);var Hs=c(36529),$s=c(41784);const es=(e,t,n,r)=>(e.sort(function(i,o){return(i.title||"link").toLowerCase().localeCompare((o.title||"link").toLowerCase())}),e.map((i,o)=>(0,s.jsx)(Hs.D,{label:i.title||"Link",onClick:i.onClick?l=>{(0,x.rR)("grafana_traces_trace_view_span_link_clicked",{datasourceType:r,grafana_version:_.$.buildInfo.version,type:i.type,location:"menu"}),l?.preventDefault(),i.onClick(l),n()}:void 0,url:i.href,target:i.target,className:t.menuItem},o))),ts=({links:e,datasourceType:t,color:n})=>{const r=(0,D.of)(()=>Ws(n)),[i,o]=(0,u.useState)(!1),[l,d]=(0,u.useState)({x:0,y:0}),h=()=>o(!1);return(0,s.jsxs)("div",{"data-testid":"SpanLinksMenu",className:r.wrapper,children:[(0,s.jsx)("button",{onClick:f=>{o(!0),d({x:f.pageX,y:f.pageY})},className:r.button,children:(0,s.jsx)(Se.I,{name:"link",className:r.icon})}),i?(0,s.jsx)($s.t,{onClose:()=>o(!1),renderMenuItems:()=>es(e,r,h,t),focusOnOpen:!1,x:l.x,y:l.y}):null]})},Ws=e=>({wrapper:(0,a.css)({border:"none",background:`${e}10`,borderBottom:`1px solid ${e}CF`,paddingRight:"4px"}),button:(0,a.css)({background:"transparent",border:"none",padding:0}),icon:(0,a.css)({background:"transparent",border:"none",padding:0}),menuItem:(0,a.css)({maxWidth:"60ch",overflow:"hidden"})});function ss(e){return(0,Le.get)((0,Le.find)(e.references,({span:t,refType:n})=>t&&t.spanID&&(n==="CHILD_OF"||n==="FOLLOWS_FROM")),"span")}function zs(e){const t=[];if(!e)return t;let n=ss(e);for(;n;)t.push(n.spanID),n=ss(n);return t}const kn=(0,w.N)(e=>({SpanTreeOffset:(0,a.css)({label:"SpanTreeOffset",color:(0,g.R)(e,"#000"),position:"relative"}),SpanTreeOffsetParent:(0,a.css)({label:"SpanTreeOffsetParent","&:hover":{cursor:"pointer"}}),indentGuide:(0,a.css)({label:"indentGuide",paddingRight:"1rem",height:"100%",display:"inline-flex",[e.transitions.handleMotion("no-preference")]:{transition:"padding 300ms ease-out"},"&::before":{content:'""',paddingLeft:"1px",backgroundColor:(0,g.R)(e,"lightgrey")}}),indentGuideActive:(0,a.css)({label:"indentGuideActive","&::before":{backgroundColor:(0,g.R)(e,"#777")}}),indentGuideThin:(0,a.css)({paddingRight:"0.3rem"}),iconWrapper:(0,a.css)({label:"iconWrapper",position:"absolute",right:0})}));class En extends u.PureComponent{constructor(t){super(t),this.handleMouseLeave=(n,r)=>{(!(n.relatedTarget instanceof HTMLSpanElement)||(0,Le.get)(n,"relatedTarget.dataset.ancestorId")!==r)&&this.props.removeHoverIndentGuideId(r)},this.handleMouseEnter=(n,r)=>{(!(n.relatedTarget instanceof HTMLSpanElement)||(0,Le.get)(n,"relatedTarget.dataset.ancestorId")!==r)&&this.props.addHoverIndentGuideId(r)},this.ancestorIds=zs(t.span),this.ancestorIds.push("root"),this.ancestorIds.reverse()}static{this.displayName="UnthemedSpanTreeOffset"}static{this.defaultProps={childrenVisible:!1,showChildrenIcon:!0}}render(){const{childrenVisible:t,onClick:n,showChildrenIcon:r,span:i,theme:o,visibleSpanIds:l}=this.props,{hasChildren:d,spanID:h}=i,f=d?{onClick:n,role:"switch","aria-checked":t}:null,I=r&&d&&(t?(0,s.jsx)(Se.I,{name:"angle-down","data-testid":"icon-arrow-down",size:"sm"}):(0,s.jsx)(Se.I,{name:"angle-right","data-testid":"icon-arrow-right",size:"sm"})),j=kn(o);return(0,s.jsxs)("span",{className:J()(j.SpanTreeOffset,{[j.SpanTreeOffsetParent]:d}),...f,children:[this.ancestorIds.map((E,N)=>(0,s.jsx)("span",{className:J()(j.indentGuide,{[j.indentGuideActive]:this.props.hoverIndentGuideIds.has(E),[j.indentGuideThin]:N!==this.ancestorIds.length-1&&E!=="root"&&!l.includes(E)}),"data-ancestor-id":E,"data-testid":"SpanTreeOffset--indentGuide",onMouseEnter:z=>this.handleMouseEnter(z,E),onMouseLeave:z=>this.handleMouseLeave(z,E)},E)),I&&(0,s.jsx)("span",{className:j.iconWrapper,onMouseEnter:E=>this.handleMouseEnter(E,h),onMouseLeave:E=>this.handleMouseLeave(E,h),"data-testid":"icon-wrapper",children:I})]})}}const nn=(0,D.cV)(En),ns="spanBar",rs="spanBarLabel",Nt="nameWrapper",rn="nameWrapperMatchingFilter",Ct="jaegerView",an="nameColumn",Ln=(0,w.N)((e,t)=>{const n={label:"flash",flash:(0,a.keyframes)`
    from {
      background-color: ${(0,g.R)(e,"#68b9ff")};
    }
    to {
      background-color: 'default';
    }
  `},r=t?"":(0,g.R)(e,"#fffce4");return{nameWrapper:(0,a.css)({label:"nameWrapper",lineHeight:"27px",overflow:"hidden",display:"flex"}),nameWrapperMatchingFilter:(0,a.css)({label:"nameWrapperMatchingFilter",backgroundColor:r}),nameColumn:(0,a.css)({label:"nameColumn",position:"relative",whiteSpace:"nowrap",zIndex:1,"&:hover":{zIndex:1}}),endpointName:(0,a.css)({label:"endpointName",color:(0,g.R)(e,"#484848"),fontSize:"0.9em"}),view:(0,a.css)({label:"view",position:"relative"}),viewExpanded:(0,a.css)({label:"viewExpanded",background:(0,g.R)(e,"#f8f8f8"),outline:`1px solid ${(0,g.R)(e,"#ddd")}`}),viewExpandedAndMatchingFilter:(0,a.css)({label:"viewExpandedAndMatchingFilter",background:(0,g.R)(e,"#fff3d7"),outline:`1px solid ${(0,g.R)(e,"#ddd")}`}),row:(0,a.css)({label:"row",fontSize:"0.9em",[`&:hover .${ns}`]:{opacity:1},[`&:hover .${rs}`]:{color:(0,g.R)(e,"#000")},[`&:hover .${Nt}`]:{background:`linear-gradient(
          90deg,
          ${(0,g.R)(e,"#fafafa")},
          ${(0,g.R)(e,"#f8f8f8")} 75%,
          ${(0,g.R)(e,"#eee")}
        )`},[`&:hover .${Ct}`]:{backgroundColor:(0,g.R)(e,"#f5f5f5"),outline:`1px solid ${(0,g.R)(e,"#ddd")}`}}),rowClippingLeft:(0,a.css)({label:"rowClippingLeft",[`& .${an}::before`]:{content:'" "',height:"100%",position:"absolute",width:"6px",backgroundImage:`linear-gradient(
          to right,
          ${(0,g.R)(e,"rgba(25, 25, 25, 0.25)")},
          ${(0,g.R)(e,"rgba(32, 32, 32, 0)")}
        )`,left:"100%",zIndex:-1}}),rowClippingRight:(0,a.css)({label:"rowClippingRight",[`& .${Ct}::before`]:{content:'" "',height:"100%",position:"absolute",width:"6px",backgroundImage:`linear-gradient(
          to left,
          ${(0,g.R)(e,"rgba(25, 25, 25, 0.25)")},
          ${(0,g.R)(e,"rgba(25, 25, 25, 0.25)")}
        )`,right:"0%",zIndex:1}}),rowExpanded:(0,a.css)({label:"rowExpanded",[`& .${ns}`]:{opacity:1},[`& .${rs}`]:{color:(0,g.R)(e,"#000")},[`& .${Nt}, &:hover .${Nt}`]:{background:(0,g.R)(e,"#f0f0f0"),boxShadow:`0 1px 0 ${(0,g.R)(e,"#ddd")}`},[`& .${rn}`]:{background:(0,g.R)(e,"#fff3d7")},[`&:hover .${Ct}`]:{background:(0,g.R)(e,"#eee")}}),rowMatchingFilter:(0,a.css)({label:"rowMatchingFilter",[`&:hover .${Nt}`]:{background:`linear-gradient(
          90deg,
          ${(0,g.R)(e,"#fffbde")},
          ${(0,g.R)(e,"#fffbde")} 75%,
          ${(0,g.R)(e,"#f7f1c6")}
        )`},[`&:hover .${Ct}`]:{backgroundColor:(0,g.R)(e,"#f7f1c6"),outline:`1px solid ${(0,g.R)(e,"#ddd")}`}}),rowFocused:(0,a.css)({label:"rowFocused",backgroundColor:(0,g.R)(e,"#cbe7ff"),[e.transitions.handleMotion("no-preference","reduce")]:{animation:`${n.flash} 1s cubic-bezier(0.12, 0, 0.39, 0)`},[`& .${Nt}, .${Ct}, .${rn}`]:{backgroundColor:(0,g.R)(e,"#cbe7ff"),animation:`${n.flash} 1s cubic-bezier(0.12, 0, 0.39, 0)`},[`& .${ns}`]:{opacity:1},[`& .${rs}`]:{color:(0,g.R)(e,"#000")},"&:hover .${nameWrapperClassName}, :hover .${viewClassName}":{background:(0,g.R)(e,"#d5ebff"),boxShadow:`0 1px 0 ${(0,g.R)(e,"#ddd")}`}}),rowExpandedAndMatchingFilter:(0,a.css)({label:"rowExpandedAndMatchingFilter",[`&:hover .${Ct}`]:{background:(0,g.R)(e,"#ffeccf")}}),name:(0,a.css)({label:"name",color:(0,g.R)(e,"#000"),cursor:"pointer",flex:"1 1 auto",outline:"none",overflowY:"hidden",overflowX:"auto",paddingLeft:"4px",paddingRight:"0.25em",position:"relative","-ms-overflow-style":"none",scrollbarWidth:"none","&::-webkit-scrollbar":{display:"none"},"&:focus":{textDecoration:"none"},"&:hover > span":{color:(0,g.R)(e,"#000")},textAlign:"left",background:"transparent",border:"none",borderBottomWidth:"1px",borderBottomStyle:"solid"}),nameDetailExpanded:(0,a.css)({label:"nameDetailExpanded","&::before":{bottom:0}}),svcName:(0,a.css)({label:"svcName",fontSize:"0.9em",fontWeight:"bold",marginRight:"0.25rem"}),svcNameChildrenCollapsed:(0,a.css)({label:"svcNameChildrenCollapsed",fontWeight:"bold",fontStyle:"italic"}),errorIcon:(0,a.css)({label:"errorIcon",borderRadius:"6.5px",color:(0,g.R)(e,"#fff"),fontSize:"0.85em",marginRight:"0.25rem",padding:"1px"}),rpcColorMarker:(0,a.css)({label:"rpcColorMarker",borderRadius:"6.5px",display:"inline-block",fontSize:"0.85em",height:"1em",marginRight:"0.25rem",padding:"1px",width:"1em",verticalAlign:"middle"}),labelRight:(0,a.css)({label:"labelRight",left:"100%"}),labelLeft:(0,a.css)({label:"labelLeft",right:"100%"})}});class Nn extends u.PureComponent{constructor(){super(...arguments),this._detailToggle=()=>{this.props.onDetailToggled(this.props.span.spanID)},this._childrenToggle=()=>{this.props.onChildrenToggled(this.props.span.spanID)},this.getSpanBarLabel=(t,n,r)=>{const i=n?.type??"";if(i===_t)return"";if(i===""||i===Kt)return`(${r})`;if(i===At){const o=n?.tag?.trim()??"";if(o!==""&&t.tags){const l=t.tags?.find(h=>h.key===o);if(l)return`(${l.value})`;const d=t.process?.tags?.find(h=>h.key===o);if(d)return`(${d.value})`}}return""}}static{this.displayName="UnthemedSpanBarRow"}static{this.defaultProps={className:"",rpc:null}}render(){const{className:t,color:n,spanBarOptions:r,columnDivision:i,isChildrenExpanded:o,isDetailExpanded:l,isMatchingFilter:d,showSpanFilterMatchesOnly:h,isFocused:f,numTicks:I,rpc:j,noInstrumentedServer:E,showErrorIcon:N,getViewedBounds:z,traceStartTime:B,span:Y,hoverIndentGuideIds:U,addHoverIndentGuideId:K,removeHoverIndentGuideId:Q,clippingLeft:V,clippingRight:ne,theme:he,createSpanLink:Ie,datasourceType:pe,showServiceName:Ee,visibleSpanIds:Pe,criticalPath:tt}=this.props,{duration:ae,hasChildren:Ve,operationName:st,process:{serviceName:St}}=Y,lt=(0,we.a3)(ae),It=z(Y.startTime,Y.startTime+Y.duration),Ne=It.start,Qe=It.end,ce=Ln(he,h),ct=`${St}::${st}`;let Xe,mt;return Ne>1-Qe?(Xe=`${ct} | ${lt}`,mt=ce.labelLeft):(Xe=`${lt} | ${ct}`,mt=ce.labelRight),(0,s.jsxs)(Ae,{className:J()(ce.row,{[ce.rowExpanded]:l,[ce.rowMatchingFilter]:d,[ce.rowExpandedAndMatchingFilter]:d&&l,[ce.rowFocused]:f,[ce.rowClippingLeft]:V,[ce.rowClippingRight]:ne},t),children:[(0,s.jsx)(Ae.Cell,{className:J()(ce.nameColumn,an),width:i,children:(0,s.jsxs)("div",{className:J()(ce.nameWrapper,Nt,{[ce.nameWrapperMatchingFilter]:d,nameWrapperMatchingFilter:d}),children:[(0,s.jsx)(nn,{onClick:Ve?this._childrenToggle:void 0,childrenVisible:o,span:Y,hoverIndentGuideIds:U,addHoverIndentGuideId:K,removeHoverIndentGuideId:Q,visibleSpanIds:Pe}),(0,s.jsxs)("button",{type:"button",className:J()(ce.name,{[ce.nameDetailExpanded]:l}),"aria-checked":l,title:ct,onClick:this._detailToggle,role:"switch",style:{background:`${n}10`,borderBottomColor:`${n}CF`},tabIndex:0,children:[N&&(0,s.jsx)(Se.I,{name:"exclamation-circle",style:{backgroundColor:Y.errorIconColor?(0,g.R)(he,Y.errorIconColor):(0,g.R)(he,"#db2828")},className:ce.errorIcon}),Ee&&(0,s.jsx)("span",{className:J()(ce.svcName,{[ce.svcNameChildrenCollapsed]:Ve&&!o}),children:`${St} `}),j&&(0,s.jsxs)("span",{children:[(0,s.jsx)(Se.I,{name:"arrow-right"})," ",(0,s.jsx)("i",{className:ce.rpcColorMarker,style:{background:j.color}}),j.serviceName]}),E&&(0,s.jsxs)("span",{children:[(0,s.jsx)(Se.I,{name:"arrow-right"})," ",(0,s.jsx)("i",{className:ce.rpcColorMarker,style:{background:E.color}}),E.serviceName]}),(0,s.jsx)("span",{className:ce.endpointName,children:j?j.operationName:st}),(0,s.jsxs)("span",{className:ce.endpointName,children:[" ",this.getSpanBarLabel(Y,r,lt)]})]}),Ie&&(()=>{const He=Ie(Y),Ye=He?.length||0;return He&&Ye===1?He[0]?(0,s.jsx)("a",{href:He[0].href,target:"_blank",style:{background:`${n}10`,borderBottom:`1px solid ${n}CF`,paddingRight:"4px"},rel:"noopener noreferrer",onClick:He[0].onClick?ie=>{!(ie.ctrlKey||ie.metaKey||ie.shiftKey)&&He[0].onClick&&(ie.preventDefault(),He[0].onClick(ie))}:void 0,children:He[0].content}):null:He&&Ye>1?(0,s.jsx)(ts,{links:He,datasourceType:pe,color:n}):null})()]})}),(0,s.jsxs)(Ae.Cell,{className:J()(ce.view,Ct,{[ce.viewExpanded]:l,[ce.viewExpandedAndMatchingFilter]:d&&l}),"data-testid":"span-view",style:{cursor:"pointer"},width:1-i,onClick:this._detailToggle,children:[(0,s.jsx)($e,{numTicks:I}),(0,s.jsx)(Ht,{criticalPath:tt,rpc:j,viewStart:Ne,viewEnd:Qe,getViewedBounds:z,color:n,shortLabel:lt,longLabel:Xe,traceStartTime:B,span:Y,labelClassName:`${rs} ${mt}`,className:ns})]})]})}}const jn=(0,D.cV)(Nn),Mn=(0,w.N)(e=>({expandedAccent:(0,a.css)({cursor:"pointer",height:"100%",overflow:"hidden",position:"absolute",width:"100%","&::before":{borderLeft:"1px solid",pointerEvents:"none",width:"1000px"},"&::after":{borderRight:"1000px solid",borderColor:"inherit",cursor:"pointer",opacity:.2},"&::before, &::after":{borderColor:"inherit",content:'" "',position:"absolute",height:"100%"},"&:hover::after":{opacity:.35}}),infoWrapper:(0,a.css)({label:"infoWrapper",border:`1px solid ${(0,g.R)(e,"#d3d3d3")}`,borderTop:"3px solid",padding:"0.75rem"})}));class On extends u.PureComponent{constructor(){super(...arguments),this._detailToggle=()=>{this.props.onDetailToggled(this.props.span.spanID)},this._linksGetter=(t,n)=>{const{linksGetter:r,span:i}=this.props;return r(i,t,n)}}render(){const{color:t,columnDivision:n,detailState:r,logItemToggle:i,logsToggle:o,processToggle:l,referenceItemToggle:d,referencesToggle:h,warningsToggle:f,stackTracesToggle:I,span:j,traceToProfilesOptions:E,timeZone:N,tagsToggle:z,traceStartTime:B,traceDuration:Y,traceName:U,hoverIndentGuideIds:K,addHoverIndentGuideId:Q,removeHoverIndentGuideId:V,theme:ne,createSpanLink:he,focusedSpanId:Ie,createFocusSpanLink:pe,datasourceType:Ee,visibleSpanIds:Pe,traceFlameGraphs:tt,setTraceFlameGraphs:ae,setRedrawListView:Ve}=this.props,st=Mn(ne);return(0,s.jsxs)(Ae,{children:[(0,s.jsxs)(Ae.Cell,{width:n,style:{overflow:"hidden"},children:[(0,s.jsx)(nn,{span:j,showChildrenIcon:!1,hoverIndentGuideIds:K,addHoverIndentGuideId:Q,removeHoverIndentGuideId:V,visibleSpanIds:Pe}),(0,s.jsx)(qe.$n,{fill:"text",onClick:this._detailToggle,className:J()(st.expandedAccent,(0,qe.my)(ne)),style:{borderColor:t},"data-testid":"detail-row-expanded-accent"})]}),(0,s.jsx)(Ae.Cell,{width:1-n,children:(0,s.jsx)("div",{className:st.infoWrapper,style:{borderTopColor:t},children:(0,s.jsx)(Fs,{detailState:r,linksGetter:this._linksGetter,logItemToggle:i,logsToggle:o,processToggle:l,referenceItemToggle:d,referencesToggle:h,warningsToggle:f,stackTracesToggle:I,span:j,traceToProfilesOptions:E,timeZone:N,tagsToggle:z,traceStartTime:B,traceDuration:Y,traceName:U,createSpanLink:he,focusedSpanId:Ie,createFocusSpanLink:pe,datasourceType:Ee,traceFlameGraphs:tt,setTraceFlameGraphs:ae,setRedrawListView:Ve})})})]})}}const _n=(0,D.cV)(On),Ks=(0,w.N)(()=>({rowsWrapper:(0,a.css)({width:"100%"}),row:(0,a.css)({width:"100%"}),scrollToTopButton:(0,a.css)({display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",width:"40px",height:"40px",position:"absolute",bottom:"30px",right:"30px",zIndex:1})})),Us={bar:28,detail:161,detailWithLogs:197},An=5,as=33;function Fn(e,t,n,r,i,o,l){if(!e)return[];i&&r&&(e=e.filter(f=>r.has(f.spanID))),o&&l&&(e=e.filter(f=>l.find(I=>I.spanId===f.spanID)));let d=null;const h=[];for(let f=0;f<e.length;f++){const I=e[f],{spanID:j,depth:E}=I;let N=!1;d!=null&&(E>=d?N=!0:d=null),!N&&(t.has(j)&&(d=E+1),h.push({span:I,isDetail:!1,spanIndex:f}),n.has(j)&&h.push({span:I,isDetail:!0,spanIndex:f}))}return h}function Bn(e){const[t,n]=e;return{left:t>0,right:n<1}}function Pn(e,t,n,r,i,o,l){return e?Fn(e.spans,t,n,r,i,o,l):[]}function Vn(e){const t=new Map;return e&&e.spans.forEach(n=>{n.childSpanIds.length&&t.set(n.spanID,n.childSpanIds)}),t}const Hn=(0,xt.default)(Pn),$n=(0,xt.default)(fe,Le.isEqual),Wn=(0,xt.default)(Bn,Le.isEqual),zn=(0,xt.default)(Vn);class Kn extends u.Component{constructor(){super(...arguments),this.hasScrolledToSpan=!1,this.getViewRange=()=>this.props.currentViewRangeTime,this.getSearchedSpanIDs=()=>this.props.findMatchesIDs,this.getCollapsedChildren=()=>this.props.childrenHiddenIDs,this.mapRowIndexToSpanIndex=t=>this.getRowStates()[t].spanIndex,this.mapSpanIndexToRowIndex=t=>{const n=this.getRowStates().length;for(let r=0;r<n;r++){const{spanIndex:i}=this.getRowStates()[r];if(i===t)return r}throw new Error(`unable to find row for span index: ${t}`)},this.setListView=t=>{this.listView=t},this.getKeyFromIndex=t=>{const{isDetail:n,span:r}=this.getRowStates()[t];return`${r.traceID}--${r.spanID}--${n?"detail":"bar"}`},this.getIndexFromKey=t=>{const n=t.split("--"),r=n[0],i=n[1],o=n[2]==="detail",l=this.getRowStates().length;for(let d=0;d<l;d++){const{span:h,isDetail:f}=this.getRowStates()[d];if(h.spanID===i&&h.traceID===r&&f===o)return d}return-1},this.getRowHeight=t=>{const{span:n,isDetail:r}=this.getRowStates()[t];return r?Array.isArray(n.logs)&&n.logs.length?Us.detailWithLogs:Us.detail:Us.bar},this.renderRow=(t,n,r,i)=>{const{isDetail:o,span:l,spanIndex:d}=this.getRowStates()[r],h=Math.max((this.listView?.getTopVisibleIndex()||0)-as,0),f=(this.listView?.getBottomVisibleIndex()||0)+as,I=this.getVisibleSpanIds(h,f);return o?this.renderSpanDetailRow(l,t,n,i,I):this.renderSpanBarRow(l,d,t,n,i,I)},this.scrollToSpan=(t,n)=>{if(n==null)return;const r=this.getRowStates().findIndex(i=>i.span.spanID===n);r>=0&&this.listView?.scrollToIndex(r,t)},this.scrollToTop=()=>{const{topOfViewRef:t,datasourceType:n,trace:r}=this.props;t?.current?.scrollIntoView({behavior:"smooth"}),(0,x.rR)("grafana_traces_trace_view_scroll_to_top_clicked",{datasourceType:n,grafana_version:_.$.buildInfo.version,numServices:r.services.length,numSpans:r.spans.length})},this.getVisibleSpanIds=(0,xt.default)((t,n)=>{const r=[];for(let i=t;i<n;i++){const o=this.getRowStates()[i];o?.span&&r.push(o.span.spanID)}return r})}componentDidMount(){this.scrollToSpan(this.props.headerHeight,this.props.focusedSpanId)}shouldComponentUpdate(t){let n;for(n in t)if(t[n]!==this.props[n])return!0;return!1}componentDidUpdate(t){const{headerHeight:n,focusedSpanId:r,focusedSpanIdForSearch:i}=this.props;this.hasScrolledToSpan||(this.scrollToSpan(n,r),this.hasScrolledToSpan=!0),r!==t.focusedSpanId&&this.scrollToSpan(n,r),i!==t.focusedSpanIdForSearch&&this.scrollToSpan(n,i)}getRowStates(){const{childrenHiddenIDs:t,detailStates:n,trace:r,findMatchesIDs:i,showSpanFilterMatchesOnly:o,showCriticalPathSpansOnly:l,criticalPath:d}=this.props;return Hn(r,t,n,i,o,l,d)}getClipping(){const{currentViewRangeTime:t}=this.props;return Wn(t)}getViewedBounds(){const{currentViewRangeTime:t,trace:n}=this.props,[r,i]=t;return $n({min:n.startTime,max:n.endTime,viewStart:r,viewEnd:i})}getChildSpansMap(){return zn(this.props.trace)}getAccessors(){const t=this.listView;if(!t)throw new Error("ListView unavailable");return{getViewRange:this.getViewRange,getSearchedSpanIDs:this.getSearchedSpanIDs,getCollapsedChildren:this.getCollapsedChildren,getViewHeight:t.getViewHeight,getBottomRowIndexVisible:t.getBottomVisibleIndex,getTopRowIndexVisible:t.getTopVisibleIndex,getRowPosition:t.getRowPosition,mapRowIndexToSpanIndex:this.mapRowIndexToSpanIndex,mapSpanIndexToRowIndex:this.mapSpanIndexToRowIndex}}renderSpanBarRow(t,n,r,i,o,l){const{spanID:d,childSpanIds:h}=t,{serviceName:f}=t.process,{childrenHiddenIDs:I,childrenToggle:j,detailStates:E,detailToggle:N,findMatchesIDs:z,spanNameColumnWidth:B,trace:Y,spanBarOptions:U,hoverIndentGuideIds:K,addHoverIndentGuideId:Q,removeHoverIndentGuideId:V,createSpanLink:ne,focusedSpanId:he,focusedSpanIdForSearch:Ie,showSpanFilterMatchesOnly:pe,theme:Ee,datasourceType:Pe,criticalPath:tt}=this.props;if(!Y)return null;const ae=(0,Et.Kv)(f,Ee),Ve=I.has(d),st=E.has(d),St=z?z.has(d):!1,lt=d===he||d===Ie,It=G(t)||Ve&&q(Y.spans,n);let Ne=null;if(Ve){const ie=te(Y.spans.slice(n));if(ie){const Tt=this.getViewedBounds()(ie.startTime,ie.startTime+ie.duration);Ne={color:(0,Et.Kv)(ie.process.serviceName,Ee),operationName:ie.operationName,serviceName:ie.process.serviceName,viewEnd:Tt.end,viewStart:Tt.start}}}const Qe=t.tags.find(ie=>ie.key===hs);let ce=null;!t.hasChildren&&Qe&&oe(t)&&(ce={serviceName:Qe.value,color:(0,Et.Kv)(Qe.value,Ee)});const ct=n>0?Y.spans[n-1]:null,Xe=[d,...h],mt=ie=>{ie.forEach(Tt=>{const Mt=this.getChildSpansMap().get(Tt);Mt?.length&&(Xe.push(...Mt),mt(Mt))})};mt(h);const He=tt?.filter(ie=>Ve?Xe.includes(ie.spanId):ie.spanId===d),Ye=Ks();return(0,s.jsx)("div",{className:Ye.row,style:i,...o,children:(0,s.jsx)(jn,{clippingLeft:this.getClipping().left,clippingRight:this.getClipping().right,color:ae,spanBarOptions:U,columnDivision:B,isChildrenExpanded:!Ve,isDetailExpanded:st,isMatchingFilter:St,isFocused:lt,showSpanFilterMatchesOnly:pe,numTicks:An,onDetailToggled:N,onChildrenToggled:j,rpc:Ne,noInstrumentedServer:ce,showErrorIcon:It,getViewedBounds:this.getViewedBounds(),traceStartTime:Y.startTime,span:t,hoverIndentGuideIds:K,addHoverIndentGuideId:Q,removeHoverIndentGuideId:V,createSpanLink:ne,datasourceType:Pe,showServiceName:ct===null||ct.process.serviceName!==t.process.serviceName,visibleSpanIds:l,criticalPath:He})},r)}renderSpanDetailRow(t,n,r,i,o){const{spanID:l}=t,{serviceName:d}=t.process,{detailLogItemToggle:h,detailLogsToggle:f,detailProcessToggle:I,detailReferencesToggle:j,detailReferenceItemToggle:E,detailWarningsToggle:N,detailStackTracesToggle:z,detailStates:B,detailTagsToggle:Y,detailToggle:U,spanNameColumnWidth:K,trace:Q,traceToProfilesOptions:V,timeZone:ne,hoverIndentGuideIds:he,addHoverIndentGuideId:Ie,removeHoverIndentGuideId:pe,linksGetter:Ee,createSpanLink:Pe,focusedSpanId:tt,createFocusSpanLink:ae,theme:Ve,datasourceType:st,traceFlameGraphs:St,setTraceFlameGraphs:lt,setRedrawListView:It}=this.props,Ne=B.get(l);if(!Q||!Ne)return null;const Qe=(0,Et.Kv)(d,Ve),ce=Ks();return(0,s.jsx)("div",{className:(0,a.cx)(ce.row,"span-detail-row"),style:{...r,zIndex:1},...i,children:(0,s.jsx)(_n,{color:Qe,columnDivision:K,onDetailToggled:U,detailState:Ne,linksGetter:Ee,logItemToggle:h,logsToggle:f,processToggle:I,referenceItemToggle:E,referencesToggle:j,warningsToggle:N,stackTracesToggle:z,span:t,traceToProfilesOptions:V,timeZone:ne,tagsToggle:Y,traceStartTime:Q.startTime,traceDuration:Q.duration,traceName:Q.traceName,hoverIndentGuideIds:he,addHoverIndentGuideId:Ie,removeHoverIndentGuideId:pe,createSpanLink:Pe,focusedSpanId:tt,createFocusSpanLink:ae,datasourceType:st,visibleSpanIds:o,traceFlameGraphs:St,setTraceFlameGraphs:lt,setRedrawListView:It})},n)}render(){const t=Ks(),{scrollElement:n,redrawListView:r}=this.props;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(zt,{ref:this.setListView,dataLength:this.getRowStates().length,itemHeightGetter:this.getRowHeight,itemRenderer:this.renderRow,viewBuffer:as,viewBufferMin:as,itemsWrapperClassName:t.rowsWrapper,getKeyFromIndex:this.getKeyFromIndex,getIndexFromKey:this.getIndexFromKey,windowScroller:!1,scrollElement:n,redraw:r}),this.props.topOfViewRef&&(0,s.jsx)(Je.I,{className:t.scrollToTopButton,onClick:this.scrollToTop,title:"Scroll to top",icon:"arrow-up"})]})}}const Un=(0,D.cV)(Kn),Gn=(0,w.N)(e=>({TraceTimelineViewer:(0,a.css)({label:"TraceTimelineViewer",borderBottom:`1px solid ${(0,g.R)(e,"#bbb")}`,"& .json-markup":{lineHeight:"17px",fontSize:"13px",fontFamily:"monospace",whiteSpace:"pre-wrap"},"& .json-markup-key":{fontWeight:"bold"},"& .json-markup-bool":{color:(0,g.R)(e,"firebrick")},"& .json-markup-string":{color:(0,g.R)(e,"teal")},"& .json-markup-null":{color:(0,g.R)(e,"teal")},"& .json-markup-number":{color:(0,g.R)(e,"blue","black")}})})),Zn=5;class Qn extends u.PureComponent{constructor(t){super(t),this.collapseAll=()=>{this.props.collapseAll(this.props.trace.spans),(0,x.rR)("grafana_traces_traceID_expand_collapse_clicked",{datasourceType:this.props.datasourceType,grafana_version:_.$.buildInfo.version,type:"collapseAll"})},this.collapseOne=()=>{this.props.collapseOne(this.props.trace.spans),(0,x.rR)("grafana_traces_traceID_expand_collapse_clicked",{datasourceType:this.props.datasourceType,grafana_version:_.$.buildInfo.version,type:"collapseOne"})},this.expandAll=()=>{this.props.expandAll(),(0,x.rR)("grafana_traces_traceID_expand_collapse_clicked",{datasourceType:this.props.datasourceType,grafana_version:_.$.buildInfo.version,type:"expandAll"})},this.expandOne=()=>{this.props.expandOne(this.props.trace.spans),(0,x.rR)("grafana_traces_traceID_expand_collapse_clicked",{datasourceType:this.props.datasourceType,grafana_version:_.$.buildInfo.version,type:"expandOne"})},this.state={height:0}}componentDidMount(){ee({collapseAll:this.collapseAll,expandAll:this.expandAll,collapseOne:this.collapseOne,expandOne:this.expandOne})}render(){const{setSpanNameColumnWidth:t,updateNextViewRangeTime:n,updateViewRangeTime:r,viewRange:i,traceTimeline:o,theme:l,topOfViewRef:d,focusedSpanIdForSearch:h,...f}=this.props,{trace:I}=f,j=Gn(l);return(0,s.jsxs)("div",{className:j.TraceTimelineViewer,ref:E=>E&&this.setState({height:E.getBoundingClientRect().height}),children:[(0,s.jsx)(us,{duration:I.duration,nameColumnWidth:o.spanNameColumnWidth,numTicks:Zn,onCollapseAll:this.collapseAll,onCollapseOne:this.collapseOne,onColummWidthChange:t,onExpandAll:this.expandAll,onExpandOne:this.expandOne,viewRangeTime:i.time,updateNextViewRangeTime:n,updateViewRangeTime:r,columnResizeHandleHeight:this.state.height}),(0,s.jsx)(Un,{...f,...o,setSpanNameColumnWidth:t,currentViewRangeTime:i.time.current,topOfViewRef:d,focusedSpanIdForSearch:h,datasourceType:this.props.datasourceType})]})}}const Xn=(0,D.cV)(Qn);var Gs=c(66384);const Yn=()=>({NewWindowIconLarge:(0,a.css)({label:"NewWindowIconLarge",fontSize:"1.5em"})});function Jn({isLarge:e=!1,className:t}){const n=(0,D.of)(Yn),r=J()({[n.NewWindowIconLarge]:e},t);return(0,s.jsx)(Se.I,{className:r,name:"anchor"})}const qn=e=>(0,s.jsxs)("a",{href:e.href,title:e.title,target:"_blank",rel:"noopener noreferrer",className:e.className,children:[e.children," ",(0,s.jsx)(Jn,{})]});function er(e){const{links:t}=e;return(0,s.jsx)(qn,{href:t[0].url,title:t[0].text,className:e.className})}const tr=100,sr="<trace-without-root-span>",nr=()=>({BreakableText:(0,a.css)({label:"BreakableText",display:"inline-block",whiteSpace:"pre"})}),rr=/\W*\w+\W*/g;function ar({text:e,className:t,wordRegexp:n=rr}){const r=(0,D.of)(nr);if(!e)return null;const i=[];n.exec("");let o=n.exec(e)||[e];for(;o;)i.push((0,s.jsx)("span",{className:t||r.BreakableText,children:o[0]},`${e}-${i.length}`)),o=n.exec(e);return(0,s.jsx)(s.Fragment,{children:i})}const ir=e=>({TraceName:(0,a.css)({label:"TraceName",fontSize:e.typography.size.lg})});function or(e){const{className:t,traceName:n}=e,r=(0,D.of)(ir),i=String(n||sr),o=(0,s.jsx)(ar,{text:i});return(0,s.jsx)("span",{className:J()(r.TraceName,t),children:o})}var on=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)};function lr(e,t){function n(r,i){if(e(r,i))return!0;if(Array.isArray(r))return!(!Array.isArray(i)||r.length!==i.length||!r.every(function(I,j){return n(I,i[j])}));if(Array.isArray(i))return!1;if(typeof r=="object"){if(typeof i!="object")return!1;var o=r===null,l=i===null;if(o||l)return o===l;var d=Object.keys(r),h=Object.keys(i);if(d.length!==h.length)return!1;var f=t?n:e;return!!d.every(function(I){return on(r,I)&&on(i,I)&&f(r[I],i[I])})}return!1}return n}var cr=function(t,n){for(var r=0;r<t.length;r++)if(n(t[r]))return r;return-1};function dr(e,t){var n=[];function r(o){var l=cr(n,function(h){return t(o,h.key)});if(l>-1){var d=n[l];return l>0&&(n.splice(l,1),n.unshift(d)),d.value}}function i(o,l){r(o)||(n.unshift({key:o,value:l}),n.length>e&&n.pop())}return{get:r,put:i}}function ur(e){var t;return{get:function(r){if(t&&e(r,t.key))return t.value},put:function(r,i){t={key:r,value:i}}}}function hr(e,t){return e===1?ur(t):dr(e,t)}function gr(e,t){var n=t?lr(e,t):e;return function(r,i){if(r.length!==i.length)return!1;for(var o=0;o<r.length;o+=1)if(!n(r[o],i[o]))return!1;return!0}}function pr(){for(var e=1,t=function(h,f){return h===f},n=!1,r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];typeof i[0]=="number"&&(e=i.shift()),typeof i[0]=="function"?t=i.shift():typeof i[0]>"u"&&i.shift(),typeof i[0]=="boolean"&&(n=i[0]);var l=hr(e,gr(t,n));return function(d){return function(){for(var h=arguments.length,f=new Array(h),I=0;I<h;I++)f[I]=arguments[I];var j=l.get(f);return j===void 0&&(j=d.apply(d,f),l.put(f,j)),j}}}const fr=pr,mr=Object.defineProperty({archiveEnabled:!1,dependencies:{dagMaxNumServices:tr,menuEnabled:!0},linkPatterns:[],search:{maxLookback:{label:"2 Days",value:"2d"},maxLimit:1500},tracking:{gaID:null,trackErrors:!0}},"__mergeFields",{value:["dependencies","search","tracking"]});function vr(){return mr}function ln(e){return(0,Le.get)(vr(),e)}const cn=/#\{([^{}]*)\}/g;function xr(e){const t=new Set;return e.replace(cn,(n,r)=>(t.add(r),n)),Array.from(t)}function yr(e,t,n){return e.replace(cn,(r,i)=>{const o=n[i];return o==null?"":t(o)})}function dn(e,t){if(typeof e!="string")throw new Error("Invalid template");return{parameters:xr(e),template:yr.bind(null,e,t)}}function Zs(e){if(typeof e=="string")return t=>t===e;if(Array.isArray(e))return t=>e.indexOf(t)>-1;if(e==null)return()=>!0;throw new Error(`Invalid value: ${e}`)}const br=e=>e;function Sr(e){try{const t=dn(e.url,encodeURIComponent),n=dn(e.text,br);return{object:e,type:Zs(e.type),key:Zs(e.key),value:Zs(e.value),url:t,text:n,parameters:(0,Le.uniq)(t.parameters.concat(n.parameters))}}catch(t){return console.error(`Ignoring invalid link pattern: ${t}`,e),null}}function un(e,t){return e.template(t)}function Ir(e,t){const n=[],r=Object.keys(t).filter(i=>typeof t[i]=="string"||typeof t[i]=="number");return e?.filter(i=>i?.type("traces")).forEach(i=>{const o={};i?.parameters.every(d=>{const h=d;return r.includes(h)?(o[d]=t[h],!0):!1})&&n.push({url:un(i.url,o),text:un(i.text,o)})}),n}const Tr=(ln("linkPatterns")||[]).map(Sr).filter(e=>!!e),wr=fr(10)(e=>{const t=[];return e?Ir(Tr,e):t});function Dr(e){let t;const n=new Set(e.map(({spanID:r})=>r));for(let r=0;r<e.length;r++){if(e[r].references&&e[r].references.some(({traceID:d,spanID:h})=>d===e[r].traceID&&n.has(h)))continue;if(!t){t=e[r];continue}const o=e[r].references&&e[r].references.length||0,l=t.references&&t.references.length||0;(o<l||o===l&&e[r].startTime<t.startTime)&&(t=e[r])}return t?`${t.process.serviceName}: ${t.operationName}`:""}const hn=(0,Le.memoize)(Dr,e=>e.length?e[0].traceID:0);function Cr(e){for(let t=0;t<e.length;t++){const n=e[t].tags.filter(o=>o.key==="http.request.method"),r=e[t].tags.filter(o=>o.key==="http.response.status_code"),i=e[t].tags.filter(o=>o.key==="http.route");if(n.length>0||r.length>0||i.length>0)return{method:n,status:r,url:i}}for(let t=0;t<e.length;t++){const n=e[t].tags.filter(o=>o.key==="http.method"),r=e[t].tags.filter(o=>o.key==="http.status_code"),i=e[t].tags.filter(o=>o.key==="http.url"||o.key==="http.target"||o.key==="http.path");if(n.length>0||r.length>0||i.length>0)return{method:n,status:r,url:i}}return{}}const Rr=(0,Le.memoize)(Cr,e=>e.length?e[0].traceID:0);var kr=c(88023),Er=c(53569);const Lr=e=>({ActionButton:(0,a.css)({label:"ActionButton",overflow:"hidden",position:"relative","&:after":{content:'""',background:e.colors.primary.main,display:"block",position:"absolute",right:0,width:"100%",height:"100%",opacity:0,transition:"all 0.8s"},"&:active:after":{margin:0,opacity:.3,transition:"0s"}})});function gn(e){const{onClick:t,ariaLabel:n,label:r,icon:i}=e,o=(0,D.of)(Lr);return(0,s.jsx)(qe.$n,{className:o.ActionButton,size:"sm",variant:"secondary",fill:"outline",type:"button",icon:i,"aria-label":n,onClick:t,children:r})}const Nr=e=>({TracePageActions:(0,a.css)({label:"TracePageActions",display:"flex",alignItems:"center",justifyContent:"center",gap:"4px",marginBottom:"10px"}),feedbackContainer:(0,a.css)({color:e.colors.text.link}),feedback:(0,a.css)({margin:"6px",color:e.colors.text.link,fontSize:e.typography.bodySmall.fontSize,"&:hover":{textDecoration:"underline"}})});function jr(e){const{traceId:t,data:n,app:r}=e,i=(0,D.$j)(),o=Nr(i),[l,d]=(0,u.useState)(!1),h=()=>{navigator.clipboard.writeText(t),d(!0),setTimeout(()=>{d(!1)},5e3)},f=()=>{const I=(0,Er.ek)(n,"Trace-"+t.substring(t.length-6));(0,x.rR)("grafana_traces_download_traces_clicked",{app:r,grafana_version:kr.$W.buildInfo.version,trace_format:I,location:"trace-view"})};return(0,s.jsxs)("div",{className:o.TracePageActions,children:[(0,s.jsxs)("div",{className:o.feedbackContainer,children:[(0,s.jsx)(Se.I,{name:"comment-alt-message"}),(0,s.jsx)("a",{href:"https://forms.gle/RZDEx8ScyZNguDoC8",className:o.feedback,title:"Share your thoughts about tracing in Grafana.",target:"_blank",rel:"noreferrer noopener",children:"Give feedback"})]}),(0,s.jsx)(gn,{onClick:h,ariaLabel:"Copy Trace ID",label:l?"Copied!":"Trace ID",icon:"copy"}),(0,s.jsx)(gn,{onClick:f,ariaLabel:"Export Trace",label:"Export",icon:"save"})]})}var Ze=c(35095),Mr=c(40996),$t=c(60484),pn=c(34128);const Or=/^(-?\d+(?:\.\d+)?)(ms|[Mwdhmsy])$/,fn=(e,t)=>!(e.match(t)||!e),mn=e=>{const t=e.validationRegex||Or,[n,r]=(0,u.useState)(()=>e.value?fn(e.value,t):!1);(0,Mr.A)(()=>{r(fn(e.value,t))},500,[e.value]);const i={labelWidth:26,disabled:e.disabled??!1,invalid:n,error:e.isInvalidError};return e.label&&(i.label=e.label,i.tooltip=e.tooltip||""),(0,s.jsx)($t.I,{...i,children:(0,s.jsx)(pn.p,{type:"text",placeholder:e.placeholder||"0",width:e.width||40,onChange:o=>{e.onChange(o.currentTarget.value)},value:e.value,"aria-label":e.ariaLabel||"interval input"})})};var _r=c(43192),is=c(77222),Qs=c(19550),jt=c(44826),Ar=c(2973),vn=c(3091);class Fr extends u.PureComponent{constructor(){super(...arguments),this.clearUiFind=()=>{this.props.onChange("")}}static{this.defaultProps={value:void 0}}render(){const{value:t}=this.props,n=(0,s.jsx)(s.Fragment,{children:t&&t.length&&(0,s.jsx)(De.K,{name:"times",onClick:this.clearUiFind,tooltip:"Clear input"})});return(0,s.jsx)("div",{style:{width:"200px"},children:(0,s.jsx)(pn.p,{placeholder:"Find...",onChange:r=>this.props.onChange(r.currentTarget.value),suffix:n,value:t})})}}const xn=(0,u.memo)(function(t){const{trace:n,spanFilterMatches:r,setFocusedSpanIdForSearch:i,focusedSpanIndexForSearch:o,setFocusedSpanIndexForSearch:l,datasourceType:d,showSpanFilters:h}=t,f=Br((0,D.$j)(),h);(0,u.useEffect)(()=>{if(r&&o!==-1){const V=Array.from(r);i(V[o])}},[o,i,r]);const I=(V,ne)=>{if(V.preventDefault(),V.stopPropagation(),ne){if((0,x.rR)("grafana_traces_trace_view_find_next_prev_clicked",{datasourceType:d,grafana_version:_.$.buildInfo.version,direction:"next"}),o===-1||r&&o===r.size-1){l(0);return}l(o+1)}},j=(V,ne)=>{if(V.preventDefault(),V.stopPropagation(),ne){if((0,x.rR)("grafana_traces_trace_view_find_next_prev_clicked",{datasourceType:d,grafana_version:_.$.buildInfo.version,direction:"prev"}),r&&(o===-1||o===0)){l(r.size-1);return}l(o-1)}},E=(V,ne)=>{V.key==="Enter"&&I(V,ne)},N=(V,ne)=>{V.key==="Enter"&&j(V,ne)},z=(r&&r?.size>0)??!1,B=z?f.button:(0,a.cx)(f.button,f.buttonDisabled),Y=(0,u.useCallback)(V=>(0,s.jsx)(rt.m,{content:V,placement:"top",children:(0,s.jsx)("span",{className:f.tooltip,children:(0,s.jsx)(Se.I,{name:"info-circle",size:"md"})})}),[f.tooltip]),U=(0,u.useCallback)((V,ne)=>{let he=(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{children:`${n.spans.length} spans`}),Y((0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{children:["Services: ",ne]}),(0,s.jsxs)("div",{children:["Depth: ",V]})]}))]});if(r)if(r.size===0)he=(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{children:"0 matches"}),Y("There are 0 span matches for the filters selected. Please try removing some of the selected filters.")]});else{const Ie=r.size===1?"match":"matches",pe=o!==-1?`${o+1}/${r.size} ${Ie}`:`${r.size} ${Ie}`,Ee=[];r.forEach(Pe=>{n.processes[Pe]&&Ee.push(n.processes[Pe].serviceName)}),he=(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{children:pe}),Y((0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{children:["Services: ",new Set(Ee).size,"/",ne]}),(0,s.jsxs)("div",{children:["Depth: ",V]})]}))]})}return he},[o,Y,r,n.processes,n.spans]),K=new Set((0,Le.values)(n.processes).map(V=>V.serviceName)).size,Q=(0,Le.get)((0,Le.maxBy)(n.spans,"depth"),"depth",0)+1;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{className:f.matches,children:U(Q,K)}),(0,s.jsxs)("div",{className:z?f.buttons:(0,a.cx)(f.buttons,f.buttonsDisabled),children:[(0,s.jsx)("div",{"aria-label":"Prev result button",className:B,onClick:V=>j(V,z),onKeyDown:V=>N(V,z),role:"button",tabIndex:z?0:-1,children:"Prev"}),(0,s.jsx)("div",{"aria-label":"Next result button",className:B,onClick:V=>I(V,z),onKeyDown:V=>E(V,z),role:"button",tabIndex:z?0:-1,children:"Next"})]})]})}),Br=(e,t)=>{const n=(0,qe.hs)({theme:e,variant:"secondary",size:t?"md":"sm",iconOnly:!1,fill:"outline"});return{buttons:(0,a.css)({display:"inline-flex",gap:"4px"}),buttonsDisabled:(0,a.css)({cursor:"not-allowed"}),button:n.button,buttonDisabled:(0,a.css)(n.disabled,{pointerEvents:"none"}),matches:(0,a.css)({marginRight:e.spacing(2),textWrap:"nowrap"}),tooltip:(0,a.css)({color:"#aaa",margin:"0 0 0 5px"})}};var yn=c(29010);function Pr(e,t){if(!t)return;let n=!1;e.serviceName&&(t=$r(t,e),n=!0),e.spanName&&(t=Wr(t,e),n=!0),(e.from||e.to)&&(t=zr(t,e),n=!0);const r=Hr(t,e.tags);if(r&&(t=r,n=!0),e.query){const i=Vr(e.query,t);i&&(t=i,n=!0)}return n?new Set(t.map(i=>i.spanID)):void 0}function Vr(e,t){if(!t)return;const n=[];e.split(/\s+/).filter(Boolean).forEach(l=>{n.push(l.toLowerCase())});const r=(l,d)=>l.some(h=>d.toLowerCase().includes(h)),i=l=>l?l.some(d=>r(n,d.key)||r(n,qs(d.value))):!1,o=l=>r(n,l.operationName)||r(n,l.process.serviceName)||i(l.tags)||l.kind&&r(n,l.kind)||l.statusCode!==void 0&&r(n,xe.s[l.statusCode])||l.statusMessage&&r(n,l.statusMessage)||l.instrumentationLibraryName&&r(n,l.instrumentationLibraryName)||l.instrumentationLibraryVersion&&r(n,l.instrumentationLibraryVersion)||l.traceState&&r(n,l.traceState)||l.logs!==null&&l.logs.some(d=>d.name&&r(n,d.name)||i(d.fields))||i(l.process.tags)||n.some(d=>d===l.spanID);return t.filter(o)}const Hr=(e,t)=>{if(t=t.filter(n=>n.key&&n.key!==""||n.value),t.length>0)return e.filter(n=>t.every(r=>r.key&&r.value?!!(r.operator==="="&&Sn(r,n)||r.operator==="=~"&&bn(r,n)||r.operator==="!="&&!Sn(r,n)||r.operator==="!~"&&!bn(r,n)):r.key?n.tags.some(i=>Xs(r.key,i.key))||n.process.tags.some(i=>Xs(r.key,i.key))||n.logs&&n.logs.some(i=>i.fields.some(o=>Xs(r.key,o.key)))||n.kind&&r.key===ue.Nd||n.statusCode!==void 0&&r.key===ue.XQ||n.statusMessage&&r.key===ue.x9||n.instrumentationLibraryName&&r.key===ue.mT||n.instrumentationLibraryVersion&&r.key===ue.Zh||n.traceState&&r.key===ue.gz||r.key===ue.ID?r.operator==="="||r.operator==="=~":!(r.operator==="="||r.operator==="=~"):!1))},bn=(e,t)=>t.tags.some(n=>Js(e,n))||t.process.tags.some(n=>Js(e,n))||t.logs&&t.logs.some(n=>n.fields.some(r=>Js(e,r)))||t.kind&&e.key===ue.Nd&&e.value?.includes(t.kind)||t.statusCode!==void 0&&e.key===ue.XQ&&e.value?.includes(xe.s[t.statusCode].toLowerCase())||t.statusMessage&&e.key===ue.x9&&e.value?.includes(t.statusMessage)||t.instrumentationLibraryName&&e.key===ue.mT&&e.value?.includes(t.instrumentationLibraryName)||t.instrumentationLibraryVersion&&e.key===ue.Zh&&e.value?.includes(t.instrumentationLibraryVersion)||t.traceState&&e.key===ue.gz&&e.value?.includes(t.traceState)||e.key===ue.ID&&e.value?.includes(t.spanID),Sn=(e,t)=>t.tags.some(n=>Ys(e,n))||t.process.tags.some(n=>Ys(e,n))||t.logs&&t.logs.some(n=>n.fields.some(r=>Ys(e,r)))||t.kind&&e.key===ue.Nd&&e.value===t.kind||t.statusCode!==void 0&&e.key===ue.XQ&&e.value===xe.s[t.statusCode].toLowerCase()||t.statusMessage&&e.key===ue.x9&&e.value===t.statusMessage||t.instrumentationLibraryName&&e.key===ue.mT&&e.value===t.instrumentationLibraryName||t.instrumentationLibraryVersion&&e.key===ue.Zh&&e.value===t.instrumentationLibraryVersion||t.traceState&&e.key===ue.gz&&e.value===t.traceState||e.key===ue.ID&&e.value===t.spanID,Xs=(e,t)=>e===t.toString(),Ys=(e,t)=>e.key===t.key&&e.value===qs(t.value),Js=(e,t)=>t.key.includes(e.key||"")&&qs(t.value).includes(e.value||""),qs=e=>e?e.toString():"",$r=(e,t)=>e.filter(n=>t.serviceNameOperator==="="?n.process.serviceName===t.serviceName:n.process.serviceName!==t.serviceName),Wr=(e,t)=>e.filter(n=>t.spanNameOperator==="="?n.operationName===t.spanName:n.operationName!==t.spanName),zr=(e,t)=>{const n=os(t?.from||""),r=os(t?.to||"");let i=[];if(n&&(i=e.filter(o=>t.fromOperator===">"?o.duration>n:o.duration>=n)),r){const o=l=>t.toOperator==="<"?l.duration<r:l.duration<=r;i=i.length>0?i.filter(l=>o(l)):e.filter(l=>o(l))}return i},os=e=>{if(e.includes("ns"))return parseFloat(e.split("ns")[0])/1e3;if(e.includes("us"))return parseFloat(e.split("us")[0]);if(e.includes("\xB5s"))return parseFloat(e.split("\xB5s")[0]);if(e.includes("ms"))return parseFloat(e.split("ms")[0])*1e3;if(e.includes("s"))return parseFloat(e.split("s")[0])*1e3*1e3;if(e.includes("m"))return parseFloat(e.split("m")[0])*1e3*1e3*60;if(e.includes("h"))return parseFloat(e.split("h")[0])*1e3*1e3*60*60},Kr=(0,u.memo)(function(t){const{trace:n,search:r,spanFilterMatches:i,setShowSpanFilterMatchesOnly:o,setShowCriticalPathSpansOnly:l,focusedSpanIndexForSearch:d,setFocusedSpanIndexForSearch:h,setFocusedSpanIdForSearch:f,datasourceType:I,clear:j,showSpanFilters:E}=t,N=(0,D.of)(Ur),z=(0,u.useMemo)(()=>r.serviceName&&r.serviceName!==""||r.spanName&&r.spanName!==""||os(r.from||"")||os(r.to||"")||r.tags.length>1||r.tags.some(B=>B.key)||r.query&&r.query!==""||r.matchesOnly,[r.serviceName,r.spanName,r.from,r.to,r.tags,r.query,r.matchesOnly]);return(0,s.jsx)("div",{className:N.container,children:(0,s.jsx)("div",{className:N.controls,children:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(qe.$n,{variant:"destructive",disabled:!z,type:"button",fill:"outline","aria-label":"Clear filters button",onClick:j,children:"Clear"}),(0,s.jsxs)("div",{className:N.matchesOnly,children:[(0,s.jsx)(yn.d,{value:r.matchesOnly,onChange:B=>o(B.currentTarget.checked??!1),label:"Show matches only switch",disabled:!i?.size}),(0,s.jsx)(qe.$n,{onClick:()=>o(!r.matchesOnly),className:N.clearMatchesButton,variant:"secondary",fill:"text",disabled:!i?.size,children:"Show matches only"})]}),(0,s.jsxs)("div",{className:N.matchesOnly,children:[(0,s.jsx)(yn.d,{value:r.criticalPathOnly,onChange:B=>l(B.currentTarget.checked??!1),label:"Show critical path only switch"}),(0,s.jsx)(qe.$n,{onClick:()=>l(!r.criticalPathOnly),className:N.clearMatchesButton,variant:"secondary",fill:"text",children:"Show critical path only"})]})]}),(0,s.jsx)("div",{className:N.nextPrevResult,children:(0,s.jsx)(xn,{trace:n,spanFilterMatches:i,setFocusedSpanIdForSearch:f,focusedSpanIndexForSearch:d,setFocusedSpanIndexForSearch:h,datasourceType:I,showSpanFilters:E})})]})})})}),Ur=e=>{const t=(0,qe.hs)({theme:e,variant:"secondary",size:"md",iconOnly:!1,fill:"outline"});return{button:(0,a.css)(t.button),buttonDisabled:(0,a.css)(t.disabled,{pointerEvents:"none",cursor:"not-allowed"}),container:(0,a.css)({display:"inline"}),controls:(0,a.css)({display:"flex",justifyContent:"flex-end",margin:"5px 0 0 0"}),matchesOnly:(0,a.css)({display:"inline-flex",margin:"0 0 0 25px",verticalAlign:"middle",alignItems:"center"}),clearMatchesButton:(0,a.css)({color:e.colors.text.primary,"&:hover":{background:"inherit"}}),nextPrevResult:(0,a.css)({marginLeft:"auto",display:"flex",alignItems:"center"})}};var Gr=c(92955);const In=(0,u.memo)(e=>{const{trace:t,search:n,setSearch:r,showSpanFilters:i,setShowSpanFilters:o,setFocusedSpanIdForSearch:l,spanFilterMatches:d,datasourceType:h}=e,f={...(0,D.of)(Zr)},[I,j]=(0,u.useState)(),[E,N]=(0,u.useState)(),[z,B]=(0,u.useState)(-1),[Y,U]=(0,u.useState)(),[K,Q]=(0,u.useState)({}),V=/^\d+(?:\.\d)?\d*(?:ns|us|s|ms|s|m|h)$/,ne=(0,u.useCallback)(()=>{j(void 0),N(void 0),U(void 0),Q({}),r(Ar.Ji)},[r]);(0,u.useEffect)(()=>{ne()},[ne,t]);const he=(0,u.useCallback)(ae=>{r({...n,matchesOnly:ae})},[n,r]),Ie=(0,u.useCallback)(ae=>{r({...n,criticalPathOnly:ae})},[n,r]);if(!t)return null;const pe=ae=>{B(-1),l(""),r(ae)},Ee=()=>{I||j((0,vn.pG)(t).map(Ze.z))},Pe=()=>{E||N((0,vn.m8)(t).map(Ze.z))},tt=(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(rt.m,{content:"Filter your spans below. You can continue to apply filters until you have narrowed down your resulting spans to the select few you are most interested in.",placement:"right",children:(0,s.jsxs)("span",{className:f.collapseLabel,children:["Span Filters",(0,s.jsx)(Se.I,{size:"md",name:"info-circle"})]})}),!i&&(0,s.jsx)("div",{className:f.nextPrevResult,children:(0,s.jsx)(xn,{trace:t,spanFilterMatches:d,setFocusedSpanIdForSearch:l,focusedSpanIndexForSearch:z,setFocusedSpanIndexForSearch:B,datasourceType:h,showSpanFilters:i})})]});return(0,s.jsx)("div",{className:f.container,children:(0,s.jsxs)(_r.S,{label:tt,collapsible:!0,isOpen:i,onToggle:o,children:[(0,s.jsxs)(is.C,{className:f.flexContainer,children:[(0,s.jsx)($t.I,{label:"Service Name",labelWidth:16,children:(0,s.jsxs)(Qs.Gy,{spacing:"xs",children:[(0,s.jsx)(jt.l6,{"aria-label":"Select service name operator",onChange:ae=>pe({...n,serviceNameOperator:ae.value}),options:[(0,Ze.z)("="),(0,Ze.z)("!=")],value:n.serviceNameOperator}),(0,s.jsx)(jt.l6,{"aria-label":"Select service name",isClearable:!0,onChange:ae=>pe({...n,serviceName:ae?.value||""}),onOpenMenu:Ee,options:I||(n.serviceName?[n.serviceName].map(Ze.z):[]),placeholder:"All service names",value:n.serviceName||null,defaultValue:n.serviceName||null})]})}),(0,s.jsx)(Fr,{onChange:ae=>{pe({...n,query:ae,matchesOnly:ae!==""})},value:n.query||""})]}),(0,s.jsx)(is.C,{children:(0,s.jsx)($t.I,{label:"Span Name",labelWidth:16,children:(0,s.jsxs)(Qs.Gy,{spacing:"xs",children:[(0,s.jsx)(jt.l6,{"aria-label":"Select span name operator",onChange:ae=>pe({...n,spanNameOperator:ae.value}),options:[(0,Ze.z)("="),(0,Ze.z)("!=")],value:n.spanNameOperator}),(0,s.jsx)(jt.l6,{"aria-label":"Select span name",isClearable:!0,onChange:ae=>pe({...n,spanName:ae?.value||""}),onOpenMenu:Pe,options:E||(n.spanName?[n.spanName].map(Ze.z):[]),placeholder:"All span names",value:n.spanName||null})]})})}),(0,s.jsx)(is.C,{children:(0,s.jsx)($t.I,{label:"Duration",labelWidth:16,tooltip:"Filter by duration. Accepted units are ns, us, ms, s, m, h",children:(0,s.jsxs)(Qs.Gy,{spacing:"xs",align:"flex-start",children:[(0,s.jsx)(jt.l6,{"aria-label":"Select min span operator",onChange:ae=>pe({...n,fromOperator:ae.value}),options:[(0,Ze.z)(">"),(0,Ze.z)(">=")],value:n.fromOperator}),(0,s.jsx)("div",{className:f.intervalInput,children:(0,s.jsx)(mn,{ariaLabel:"Select min span duration",onChange:ae=>pe({...n,from:ae}),isInvalidError:"Invalid duration",placeholder:"e.g. 100ms, 1.2s",width:18,value:n.from||"",validationRegex:V})}),(0,s.jsx)(jt.l6,{"aria-label":"Select max span operator",onChange:ae=>pe({...n,toOperator:ae.value}),options:[(0,Ze.z)("<"),(0,Ze.z)("<=")],value:n.toOperator}),(0,s.jsx)(mn,{ariaLabel:"Select max span duration",onChange:ae=>pe({...n,to:ae}),isInvalidError:"Invalid duration",placeholder:"e.g. 100ms, 1.2s",width:18,value:n.to||"",validationRegex:V})]})})}),(0,s.jsx)(is.C,{className:f.tagsRow,children:(0,s.jsx)($t.I,{label:"Tags",labelWidth:16,tooltip:"Filter by tags, process tags or log fields in your spans.",children:(0,s.jsx)(Gr.T,{search:n,setSearch:pe,trace:t,tagKeys:Y,setTagKeys:U,tagValues:K,setTagValues:Q})})}),(0,s.jsx)(Kr,{trace:t,search:n,spanFilterMatches:d,setShowSpanFilterMatchesOnly:he,setShowCriticalPathSpansOnly:Ie,setFocusedSpanIdForSearch:l,focusedSpanIndexForSearch:z,setFocusedSpanIndexForSearch:B,datasourceType:h,clear:ne,showSpanFilters:i})]})})});In.displayName="SpanFilters";const Zr=e=>({container:(0,a.css)({label:"SpanFilters",margin:`0.5em 0 -${e.spacing(1)} 0`,zIndex:5,"& > div":{borderLeft:"none",borderRight:"none"}}),collapseLabel:(0,a.css)({svg:{color:"#aaa",margin:"-2px 0 0 10px"}}),flexContainer:(0,a.css)({display:"flex",justifyContent:"space-between"}),intervalInput:(0,a.css)({margin:"0 -4px 0 0"}),tagsRow:(0,a.css)({margin:"-4px 0 0 0"}),nextPrevResult:(0,a.css)({flex:1,alignItems:"center",display:"flex",justifyContent:"flex-end",marginRight:e.spacing(1)})}),Tn=(0,u.memo)(e=>{const{trace:t,data:n,app:r,timeZone:i,search:o,setSearch:l,showSpanFilters:d,setShowSpanFilters:h,setFocusedSpanIdForSearch:f,spanFilterMatches:I,datasourceType:j,setHeaderHeight:E}=e,N=(0,D.of)(Qr);(0,u.useEffect)(()=>{E(document.querySelector("."+N.header)?.scrollHeight??0)},[E,d,N.header]);const z=(0,u.useMemo)(()=>t?wr(t):[],[t]);if(!t)return null;const B=(he,Ie)=>{const pe=(0,Me.LE)(he.startTime/1e3,{timeZone:Ie,defaultWithMS:!0}),Ee=pe.match(/^(.+)(:\d\d\.\d+)$/);return Ee?(0,s.jsxs)("span",{className:N.TracePageHeaderOverviewItemValue,children:[Ee[1],(0,s.jsx)("span",{className:N.TracePageHeaderOverviewItemValueDetail,children:Ee[2]})]}):pe},Y=(0,s.jsxs)("h1",{className:J()(N.title),children:[(0,s.jsx)(or,{traceName:hn(t.spans)}),(0,s.jsx)("small",{className:N.duration,children:(0,we.a3)(t.duration)})]}),{method:U,status:K,url:Q}=Rr(t.spans);let V="green";K&&K.length>0&&(K[0].value.toString().charAt(0)==="4"?V="orange":K[0].value.toString().charAt(0)==="5"&&(V="red"));const ne=he=>(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{children:"http.url or http.target or http.path"}),(0,s.jsxs)("div",{children:["(",he,")"]})]});return(0,s.jsxs)("header",{className:N.header,children:[(0,s.jsxs)("div",{className:N.titleRow,children:[z&&z.length>0&&(0,s.jsx)(er,{links:z,className:N.TracePageHeaderBack}),Y,(0,s.jsx)(jr,{traceId:t.traceID,data:n,app:r})]}),(0,s.jsxs)("div",{className:N.subtitle,children:[(0,s.jsx)("span",{className:N.timestamp,children:B(t,i)}),(0,s.jsxs)("span",{className:N.tagMeta,children:[n.meta?.custom?.partial&&(0,s.jsx)(rt.m,{content:n.meta?.custom?.message,interactive:!0,children:(0,s.jsx)("span",{className:N.tag,children:(0,s.jsx)(Gs.E,{icon:"info-circle",text:"Partial trace",color:"orange"})})}),U&&U.length>0&&(0,s.jsx)(rt.m,{content:"http.method",interactive:!0,children:(0,s.jsx)("span",{className:N.tag,children:(0,s.jsx)(Gs.E,{text:U[0].value,color:"blue"})})}),K&&K.length>0&&(0,s.jsx)(rt.m,{content:"http.status_code",interactive:!0,children:(0,s.jsx)("span",{className:N.tag,children:(0,s.jsx)(Gs.E,{text:K[0].value,color:V})})}),Q&&Q.length>0&&(0,s.jsx)(rt.m,{content:ne(Q[0].value),interactive:!0,children:(0,s.jsx)("span",{className:N.url,children:Q[0].value})})]})]}),(0,s.jsx)(In,{trace:t,showSpanFilters:d,setShowSpanFilters:h,search:o,setSearch:l,spanFilterMatches:I,setFocusedSpanIdForSearch:f,datasourceType:j})]})});Tn.displayName="TracePageHeader";const Qr=e=>({TracePageHeaderBack:(0,a.css)({label:"TracePageHeaderBack",alignItems:"center",alignSelf:"stretch",backgroundColor:"#fafafa",borderBottom:"1px solid #ddd",borderRight:"1px solid #ddd",color:"inherit",display:"flex",fontSize:"1.4rem",padding:"0 1rem",marginBottom:"-1px","&:hover":{backgroundColor:"#f0f0f0",borderColor:"#ccc"}}),TracePageHeaderOverviewItemValueDetail:J()((0,a.css)({label:"TracePageHeaderOverviewItemValueDetail",color:"#aaa"}),"trace-item-value-detail"),TracePageHeaderOverviewItemValue:(0,a.css)({label:"TracePageHeaderOverviewItemValue","&:hover > .trace-item-value-detail":{color:"unset"}}),header:(0,a.css)({label:"TracePageHeader",backgroundColor:e.colors.background.primary,padding:"0.5em 0 0 0",position:"sticky",top:0,zIndex:5,textAlign:"left"}),titleRow:(0,a.css)({alignItems:"flex-start",display:"flex",padding:"0 8px",flexWrap:"wrap"}),title:(0,a.css)({color:"inherit",flex:1,fontSize:"1.7em",lineHeight:"1em",marginBottom:0,minWidth:"200px"}),subtitle:(0,a.css)({flex:1,lineHeight:"1em",margin:"-0.5em 0.5em 0.75em 0.5em"}),tag:(0,a.css)({margin:"0 0.5em 0 0"}),duration:(0,a.css)({color:"#aaa",margin:"0 0.75em"}),timestamp:(0,a.css)({verticalAlign:"middle"}),tagMeta:(0,a.css)({margin:"0 0.75em",verticalAlign:"text-top"}),url:(0,a.css)({margin:"-2.5px 0.3em",height:"15px",overflow:"hidden",textOverflow:"ellipsis",maxWidth:"700px",display:"inline-block"}),TracePageHeaderTraceId:(0,a.css)({label:"TracePageHeaderTraceId",whiteSpace:"nowrap",textOverflow:"ellipsis",maxWidth:"30%",display:"inline-block"})}),Xr="None",Yr="Duration",wn="Tag";function Jr({options:e,onOptionsChange:t}){const n=useStyles2(qr),r=[Xr,Yr,wn].map(toOption);return jsxs("div",{className:css({width:"100%"}),children:[jsx(InlineFieldRow,{className:n.row,children:jsx(InlineField,{label:"Label",labelWidth:26,tooltip:"Default: duration",grow:!0,children:jsx(Select,{inputId:"label",options:r,value:e.jsonData.spanBar?.type||"",onChange:i=>{updateDatasourcePluginJsonDataOption({onOptionsChange:t,options:e},"spanBar",{...e.jsonData.spanBar,type:i?.value??""})},placeholder:"Duration",isClearable:!0,"aria-label":"select-label-name",width:40})})}),e.jsonData.spanBar?.type===wn&&jsx(InlineFieldRow,{className:n.row,children:jsx(InlineField,{label:"Tag key",labelWidth:26,tooltip:"Tag key which will be used to get the tag value. A span's attributes and resources will be searched for the tag key",children:jsx(Input,{type:"text",placeholder:"Enter tag key",onChange:i=>updateDatasourcePluginJsonDataOption({onOptionsChange:t,options:e},"spanBar",{...e.jsonData.spanBar,tag:i.currentTarget.value}),value:e.jsonData.spanBar?.tag||"",width:40})})})]})}const la=({options:e,onOptionsChange:t})=>{let n=e.type;return n+=e.type==="tempo"?"/configure-tempo-data-source/#span-bar":"/#span-bar",jsx(ConfigSubSection,{title:"Span bar",description:jsx(ConfigDescriptionLink,{description:"Add additional info next to the service and operation on a span bar row in the trace view.",suffix:n,feature:"the span bar"}),children:jsx(Jr,{options:e,onOptionsChange:t})})},qr=e=>({infoText:css({label:"infoText",paddingBottom:e.spacing(2),color:e.colors.text.secondary}),row:css({label:"row",alignItems:"baseline"})});class it{constructor(t){const{isTagsOpen:n,isProcessOpen:r,isReferencesOpen:i,isWarningsOpen:o,isStackTracesOpen:l,logs:d,references:h}=t||{};this.isTagsOpen=!!n,this.isProcessOpen=!!r,this.isReferencesOpen=!!i,this.isWarningsOpen=!!o,this.isStackTracesOpen=!!l,this.logs={isOpen:!!(d&&d.isOpen),openedItems:d&&d.openedItems?new Set(d.openedItems):new Set},this.references={isOpen:!!(h&&h.isOpen),openedItems:h&&h.openedItems?new Set(h.openedItems):new Set}}toggleTags(){const t=new it(this);return t.isTagsOpen=!this.isTagsOpen,t}toggleProcess(){const t=new it(this);return t.isProcessOpen=!this.isProcessOpen,t}toggleReferences(){const t=new it(this);return t.references.isOpen=!this.references.isOpen,t}toggleReferenceItem(t){const n=new it(this);return n.references.openedItems.has(t)?n.references.openedItems.delete(t):n.references.openedItems.add(t),n}toggleWarnings(){const t=new it(this);return t.isWarningsOpen=!this.isWarningsOpen,t}toggleStackTraces(){const t=new it(this);return t.isStackTracesOpen=!this.isStackTracesOpen,t}toggleLogs(){const t=new it(this);return t.logs.isOpen=!this.logs.isOpen,t}toggleLogItem(t){const n=new it(this);return n.logs.openedItems.has(t)?n.logs.openedItems.delete(t):n.logs.openedItems.add(t),n}}var ls=c(25508);class ot{static iterFunction(t,n=0){return r=>t(r.value,r,n)}static searchFunction(t){return typeof t=="function"?t:(n,r)=>t instanceof ot?r===t:n===t}constructor(t,n=[]){this.value=t,this.children=n}get depth(){return this.children.reduce((t,n)=>Math.max(n.depth+1,t),1)}get size(){let t=0;return this.walk(()=>t++),t}addChild(t){return this.children.push(t instanceof ot?t:new ot(t)),this}find(t){if(ot.iterFunction(ot.searchFunction(t))(this))return this;for(let r=0;r<this.children.length;r++){const i=this.children[r].find(t);if(i)return i}return null}getPath(t){const n=ot.iterFunction(ot.searchFunction(t)),r=(i,o)=>{const l=o.concat([i]);if(n(i))return l;for(let d=0;d<i.children.length;d++){const h=i.children[d],f=r(h,l);if(f)return f}return null};return r(this,[])}walk(t,n=0){const r=[];let i=n;for(r.push({node:this,depth:i});r.length;){const o=r[r.length-1];r.pop();const{node:l,depth:d}=o;t(l.value,l,d),i=d+1;let h=l.children.length-1;for(;h>=0;)r.push({node:l.children[h],depth:i}),h--}}paths(t){const n=[];n.push({node:this,childIndex:0});const r=[];for(;n.length;){const{node:i,childIndex:o}=n[n.length-1];if(i.children.length>=o+1)n[n.length-1].childIndex++,n.push({node:i.children[o],childIndex:0});else{if(i.children.length===0){const l=n.map(d=>d.node.value);t(l)}n.pop()}}return r}}const ea=e=>e.spanID,ta=e=>e.references||[],sa=(0,ls.Mz)((0,ls.Mz)(({span:e})=>e,ta),({type:e})=>e,(e,t)=>e.find(n=>n.refType===t)),ca=(0,ls.Mz)(e=>sa({span:e,type:"CHILD_OF"}),e=>e?e.spanID:null),na=e=>e.spans,da=(0,ls.Mz)(na,e=>e.reduce((t,n)=>t.set(ea(n),n),new Map)),ra="__root__";function aa(e,t=null){const n=new Map(e.spans.map(l=>[l.spanID,new ot(l.spanID)])),r=t??new Map(e.spans.map(l=>[l.spanID,l])),i=new ot(ra);e.spans.forEach(l=>{const d=n.get(l.spanID);if(Array.isArray(l.references)&&l.references.length){const{refType:h,spanID:f}=l.references[0];if(h==="CHILD_OF"||h==="FOLLOWS_FROM")(n.get(f)||i).children?.push(d);else throw new Error(`Unrecognized ref type: ${h}`)}else i.children.push(d)});const o=(l,d)=>{const h=l?.value?r.get(l.value.toString()):void 0,f=d?.value?r.get(d.value.toString()):void 0;return+(h?.startTime>f?.startTime)||+(h?.startTime===f?.startTime)-1};return e.spans.forEach(l=>{const d=n.get(l.spanID);d.children.length>1&&d?.children.sort(o)}),i.children.sort(o),i}function ia(e){const t=new Map,n=e.reduce((i,o)=>(i.some(l=>l.key===o.key&&l.value===o.value)?t.set(`${o.key}:${o.value}`,`Duplicate tag "${o.key}:${o.value}"`):i.push(o),i),[]),r=Array.from(t.values());return{dedupedTags:n,warnings:r}}function Dn(e,t){const n=e?.slice()??[],r=(t||[]).map(i=>i.toLowerCase());return n.sort((i,o)=>{const l=i.key.toLowerCase(),d=o.key.toLowerCase();for(let h=0;h<r.length;h++){const f=r[h];if(l.startsWith(f)&&!d.startsWith(f))return-1;if(!l.startsWith(f)&&d.startsWith(f))return 1}return l>d?1:l<d?-1:0}),n}function oa(e){if(!e?.traceID)return null;const t=e.traceID.toLowerCase();let n=0,r=Number.MAX_SAFE_INTEGER;const i=new Map,o=new Map;e.spans=e.spans.filter(E=>!!E.startTime),e.processes=Object.entries(e.processes).reduce((E,[N,z])=>(E[N]={...z,tags:Dn(z.tags)},E),{});const l=e.spans.length;for(let E=0;E<l;E++){const N=e.spans[E],{startTime:z,duration:B,processID:Y}=N;let U=N.spanID;z<r&&(r=z),z+B>n&&(n=z+B);const K=i.get(U);K!=null?(console.warn(`Dupe spanID, ${K+1} x ${U}`,N,o.get(U)),(0,Le.isEqual)(N,o.get(U))&&console.warn("	 two spans with same ID have `isEqual(...) === true`"),i.set(U,K+1),U=`${U}_${K}`,N.spanID=U):i.set(U,1),N.process=e.processes[Y],o.set(U,N)}const d=aa(e,o),h=[],f={};d.walk((E,N,z=0)=>{if(E==="__root__"||typeof E!="string")return;const B=o.get(E);if(!B)return;const{serviceName:Y}=B.process;f[Y]=(f[Y]||0)+1,B.relativeStartTime=B.startTime-r,B.depth=z-1,B.hasChildren=N.children.length>0,B.childSpanCount=N.children.length,B.warnings=B.warnings||[],B.tags=B.tags||[],B.references=B.references||[],B.childSpanIds=N.children.slice().sort((K,Q)=>{const V=o.get(K.value),ne=o.get(Q.value);return ne.startTime+ne.duration-(V.startTime+V.duration)}).map(K=>K.value);const U=ia(B.tags);B.tags=Dn(U.dedupedTags,ln("topTagPrefixes")),B.warnings=B.warnings.concat(U.warnings),B.references.forEach((K,Q)=>{const V=o.get(K.spanID);V&&(K.span=V,Q>0&&(V.subsidiarilyReferencedBy=V.subsidiarilyReferencedBy||[],V.subsidiarilyReferencedBy.push({spanID:E,traceID:t,span:B,refType:K.refType})))}),h.push(B)});const I=hn(h);return{services:Object.keys(f).map(E=>({name:E,numberOfSpans:f[E]})),spans:h,traceID:t,traceName:I,processes:e.processes,duration:n-r,startTime:r,endTime:n}}},73944:(y,v,c)=>{"use strict";c.d(v,{N:()=>s});var s=(a=>(a.Logs="log",a.Traces="trace",a.Metrics="metric",a.Profiles="profile",a.Session="session",a.Unknown="unknown",a))(s||{})},61890:(y,v,c)=>{"use strict";c.d(v,{EUpdateTypes:()=>a,default:()=>_});var s=(w=>(w.DragEnd="DragEnd",w.DragMove="DragMove",w.DragStart="DragStart",w.MouseEnter="MouseEnter",w.MouseLeave="MouseLeave",w.MouseMove="MouseMove",w))(s||{});const a=s;var u=c(2543);const x=0;class _{constructor({getBounds:D,tag:g,resetBoundsOnResize:H=!0,...F}){this.resetBounds=()=>{this._bounds=void 0},this._handleMinorMouseEvent=C=>{const{button:k,clientX:R,type:A}=C;if(this._isDragging||k!==x)return;let ee=null,re;if(A==="mouseenter")ee=a.MouseEnter,re=this._onMouseEnter;else if(A==="mouseleave")ee=a.MouseLeave,re=this._onMouseLeave;else if(A==="mousemove")ee=a.MouseMove,re=this._onMouseMove;else throw new Error(`invalid event type: ${A}`);if(!re)return;const{value:ye,x:J}=this._getPosition(R);re({event:C,type:ee,value:ye,x:J,manager:this,tag:this.tag})},this._handleDragEvent=C=>{const{button:k,clientX:R,type:A}=C;let ee=null,re;if(A==="mousedown"){if(this._isDragging||k!==x)return;window.addEventListener("mousemove",this._handleDragEvent),window.addEventListener("mouseup",this._handleDragEvent);const we=(0,u.get)(document,"body.style");we&&(we.userSelect="none"),this._isDragging=!0,ee=a.DragStart,re=this._onDragStart}else if(A==="mousemove"){if(!this._isDragging)return;ee=a.DragMove,re=this._onDragMove}else if(A==="mouseup"){if(!this._isDragging)return;this._stopDragging(),ee=a.DragEnd,re=this._onDragEnd}else throw new Error(`invalid event type: ${A}`);if(!re)return;const{value:ye,x:J}=this._getPosition(R);re({event:C,type:ee,value:ye,x:J,manager:this,tag:this.tag})},this.handleMouseDown=this._handleDragEvent,this.handleMouseEnter=this._handleMinorMouseEvent,this.handleMouseMove=this._handleMinorMouseEvent,this.handleMouseLeave=this._handleMinorMouseEvent,this.getBounds=D,this.tag=g,this._isDragging=!1,this._bounds=void 0,this._resetBoundsOnResize=!!H,this._resetBoundsOnResize&&window.addEventListener("resize",this.resetBounds),this._onMouseEnter=F.onMouseEnter,this._onMouseLeave=F.onMouseLeave,this._onMouseMove=F.onMouseMove,this._onDragStart=F.onDragStart,this._onDragMove=F.onDragMove,this._onDragEnd=F.onDragEnd}_getBounds(){return this._bounds||(this._bounds=this.getBounds(this.tag)),this._bounds}_getPosition(D){const{clientXLeft:g,maxValue:H,minValue:F,width:C}=this._getBounds();let k=D-g,R=k/C;return F!=null&&R<F?(R=F,k=F*C):H!=null&&R>H&&(R=H,k=H*C),{value:R,x:k}}_stopDragging(){window.removeEventListener("mousemove",this._handleDragEvent),window.removeEventListener("mouseup",this._handleDragEvent);const D=(0,u.get)(document,"body.style");D&&(D.userSelect="auto"),this._isDragging=!1}isDragging(){return this._isDragging}dispose(){this._isDragging&&this._stopDragging(),this._resetBoundsOnResize&&window.removeEventListener("resize",this.resetBounds),this._bounds=void 0,this._onMouseEnter=void 0,this._onMouseLeave=void 0,this._onMouseMove=void 0,this._onDragStart=void 0,this._onDragMove=void 0,this._onDragEnd=void 0}}},60306:(y,v,c)=>{"use strict";c.d(v,{Kv:()=>g,rY:()=>H});var s=c(41811),a=c(84140),u=c(41090);function x(C){if(C.length!==7)return[0,0,0];const k=C.slice(1,3),R=C.slice(3,5),A=C.slice(5);return[parseInt(k,16),parseInt(R,16),parseInt(A,16)]}class _{constructor(k,R){const A=F(k,R);this.colorsHex=A,this.colorsRgb=A.map(x),this.cache=new Map,this.prevColorIndex=void 0}_getColorIndex(k){let R=this.cache.get(k);if(R==null){const A=this.hashCode(k?k.toLowerCase():"");if(R=Math.abs(A%this.colorsHex.length),this.prevColorIndex!==void 0){this.prevColorIndex===R&&(R=this.getNextIndex(R));const ee=this.colorsHex[this.prevColorIndex];if(a.A.readability(ee,this.colorsHex[R])<1.5){let re=R;for(let ye=0;ye<this.colorsHex.length;ye++)if(re=this.getNextIndex(re),a.A.readability(ee,this.colorsHex[re])>1.5){R=re;break}}}this.cache.set(k,R),this.prevColorIndex=R}return R}getNextIndex(k){return k+1<this.colorsHex.length?k+1:0}hashCode(k){let R=0,A,ee;for(A=0;A<k.length;A++)ee=k.charCodeAt(A),R=(R<<5)-R+ee;return R}getColorByKey(k){const R=this._getColorIndex(k);return this.colorsHex[R]}getRgbColorByKey(k){const R=this._getColorIndex(k);return this.colorsRgb[R]}clear(){this.cache.clear()}}const w=(0,s.default)((C,k)=>new _(C,k));function D(C){w([],C)}function g(C,k){return w(u.Tj,k).getColorByKey(C)}function H(C,k){return w(u.Tj,k).getRgbColorByKey(C)}function F(C,k){const R=[...C],A=R.indexOf("#E24D42");A>-1&&R.splice(A,1);const ee=C.indexOf("#BF1B00");ee>-1&&R.splice(ee,1);let re=[];for(const ye of R)a.A.readability(k.colors.background.primary,ye)>=3&&re.push(ye);return re}},14115:(y,v,c)=>{"use strict";c.d(v,{a3:()=>we});var s=c(2543),a=c.n(s),u=c(84743),x=c.n(u);const _="YYYY-MM-DD",w="HH:mm",D=1e3,g=1e3*D,H=60*g,F=60*H,C=24*F,k=Math.log10(D),R=[{unit:"d",microseconds:C,ofPrevious:24},{unit:"h",microseconds:F,ofPrevious:60},{unit:"m",microseconds:H,ofPrevious:60},{unit:"s",microseconds:g,ofPrevious:1e3},{unit:"ms",microseconds:D,ofPrevious:1e3},{unit:"\u03BCs",microseconds:1,ofPrevious:1e3}],A=(fe,ve,ze)=>toFloatPrecision(fe/ze,ve)*ze;function ee(fe){return moment(fe/D).format(_)}function re(fe){return moment(fe/D).format(w)}function ye(fe){const ve=A(fe,k,D);return`${moment.duration(ve/D).asMilliseconds()}ms`}function J(fe){const ve=A(fe,k,g);return`${moment.duration(ve/D).asSeconds()}s`}function we(fe){const[ve,ze]=(0,s.dropWhile)(R,({microseconds:Z},Re)=>Re<R.length-1&&Z>fe);if(ve.ofPrevious===1e3)return`${(0,s.round)(fe/ve.microseconds,2)}${ve.unit}`;const _e=`${Math.floor(fe/ve.microseconds)}${ve.unit}`,Ke=Math.round(fe/ze.microseconds%ve.ofPrevious),ut=`${Ke}${ze.unit}`;return Ke===0?_e:`${_e} ${ut}`}},32160:(y,v,c)=>{"use strict";c.d(v,{Cr:()=>Re,QW:()=>A,_o:()=>_e,gt:()=>ut,hv:()=>Z,i0:()=>R,lU:()=>F});var s=c(74848),a=c(46399),u=c(59577),x=c(3202),_=c(39736),w=c(79784),D=c(10059),g=c(97414),H=c(73944);function F({splitOpenFn:P,traceToLogsOptions:W,traceToMetricsOptions:G,traceToProfilesOptions:q,dataFrame:te,createFocusSpanLink:oe,trace:X}){if(!te)return;let $e=ut(X.duration,X.traceName,X.traceID);const Be=te.fields.some(ge=>!!ge.config.links?.length),Ae=re(P,te.fields[0],W,G,oe,$e);return function(De){let Fe=Ae(De);if(Be){$e={...$e,...Z(De),...Re(De,q)};const je=te.fields.filter(We=>!!We.config.links?.length);try{let We;q?.datasourceUid&&(We=(0,D.tR)().getInstanceSettings(q.datasourceUid));const be=We?.type==="grafana-pyroscope-datasource",Ce=De.tags.some(Te=>Te.key===A),ke=be&&Ce;let Ue=[];je.forEach(Te=>{const Ot=(0,g.QL)({field:Te,rowIndex:De.dataFrameRowIndex,splitOpenFn:P,range:Ke(De,void 0,void 0,ke),dataFrame:te,vars:$e});Ue=Ue.concat(Ot)});const nt=Ue.map(Te=>({title:Te.title,href:Te.href,onClick:Te.onClick,content:(0,s.jsx)(w.I,{name:"link",title:Te.title||"Link"}),field:Te.origin,type:ke?H.N.Profiles:H.N.Unknown,target:Te.target}));Fe.push.apply(Fe,nt)}catch(We){return console.error(We),Fe}}return Fe}}const C=P=>P.map(W=>({key:W,value:W.includes(".")?W.replace(".","_"):void 0})),k=C(["cluster","hostname","namespace","pod","service.name","service.namespace"]),R=C(["service.name","service.namespace"]),A="pyroscope.profile.id",ee="gf.feo11y.app.id";function re(P,W,G,q,te,oe){let X;G?.datasourceUid&&(X=(0,D.tR)().getInstanceSettings(G.datasourceUid));const $e=X?.type==="grafana-splunk-datasource";let Be;return q?.datasourceUid&&(Be=(0,D.tR)().getInstanceSettings(q.datasourceUid)),function(ge){oe={...oe,...Z(ge)};const De=[];let Fe,je="";if(X&&G){const be=G.customQuery?G.query:void 0,Ce=G.tags&&G.tags.length>0?G.tags:k;switch(X?.type){case"loki":je=_e(ge,Ce),Fe=J(ge,G,je,be);break;case"grafana-splunk-datasource":je=_e(ge,Ce,{joinBy:" "}),Fe=ve(ge,G,je,be);break;case"elasticsearch":case"grafana-opensearch-datasource":je=_e(ge,Ce,{labelValueSign:":",joinBy:" AND "}),Fe=fe(ge,G,je,be);break;case"grafana-falconlogscale-datasource":je=_e(ge,Ce,{joinBy:" OR "}),Fe=dt(ge,G,je,be);break;case"googlecloud-logging-datasource":je=_e(ge,Ce,{joinBy:" AND "}),Fe=ze(ge,G,je,be)}if(Fe){const ke={title:X.name,url:"",internal:{datasourceUid:X.uid,datasourceName:X.name,query:Fe}};if(oe={...oe,__tags:{text:"Tags",value:je}},(0,g.O1)(ke.internal.query,oe).allVariablesDefined){const Ue=(0,a.u)({link:ke,internalLink:ke.internal,scopedVars:oe,range:Ke(ge,{startMs:G.spanStartTimeShift?u.intervalToMs(G.spanStartTimeShift):0,endMs:G.spanEndTimeShift?u.intervalToMs(G.spanEndTimeShift):0},$e),field:{},onClickFn:P,replaceVariables:(0,_.w)().replace.bind((0,_.w)())});De.push({href:Ue.href,title:"Related logs",onClick:Ue.onClick,content:(0,s.jsx)(w.I,{name:"gf-logs",title:"Explore the logs for this in split view"}),field:W,type:H.N.Logs})}}}if(Be&&q?.queries)for(const be of q.queries){const Ce=be.query||`histogram_quantile(0.5, sum(rate(traces_spanmetrics_latency_bucket{service="${ge.process.serviceName}"}[5m])) by (le))`,ke={title:Be.name,url:"",internal:{datasourceUid:Be.uid,datasourceName:Be.name,query:{expr:Ce,refId:"A"}}},Ue=q.tags&&q.tags.length>0?q.tags:k;oe={...oe,__tags:{text:"Tags",value:_e(ge,Ue)}};const nt=(0,a.u)({link:ke,internalLink:ke.internal,scopedVars:oe,range:Ke(ge,{startMs:q.spanStartTimeShift?u.intervalToMs(q.spanStartTimeShift):-12e4,endMs:q.spanEndTimeShift?u.intervalToMs(q.spanEndTimeShift):12e4}),field:{},onClickFn:P,replaceVariables:(0,_.w)().replace.bind((0,_.w)())});De.push({title:be?.name,href:nt.href,onClick:nt.onClick,content:(0,s.jsx)(w.I,{name:"chart-line",title:"Explore metrics for this span"}),field:W,type:H.N.Metrics})}if(ge.references&&te)for(const be of ge.references){if(be.refType==="CHILD_OF")continue;const Ce=te(be.traceID,be.spanID),ke=ye(be);De.push({href:Ce.href,title:ke,content:(0,s.jsx)(w.I,{name:"link",title:ke}),onClick:Ce.onClick,field:Ce.origin,type:H.N.Traces})}if(ge.subsidiarilyReferencedBy&&te)for(const be of ge.subsidiarilyReferencedBy){const Ce=te(be.traceID,be.spanID),ke=ye(be);De.push({href:Ce.href,title:ke,content:(0,s.jsx)(w.I,{name:"link",title:ke}),onClick:Ce.onClick,field:Ce.origin,type:H.N.Traces})}const We=we(ge);return We&&De.push({title:"Session for this span",href:We,content:(0,s.jsx)(w.I,{name:"frontend-observability",title:"Session for this span"}),field:W,type:H.N.Session}),De}}const ye=P=>{let W=P.span?P.span.operationName:"View linked span";return P.refType==="EXTERNAL"&&(W="View linked span"),W};function J(P,W,G,q){const{filterByTraceID:te,filterBySpanID:oe}=W;if(q)return{expr:q,refId:""};if(!G)return;let X="{${__tags}}";return te&&P.traceID&&(X+=' | label_format log_line_contains_trace_id=`{{ contains "${__span.traceId}" __line__  }}` | log_line_contains_trace_id="true" OR trace_id="${__span.traceId}"'),oe&&P.spanID&&(X+=' | label_format log_line_contains_span_id=`{{ contains "${__span.spanId}" __line__  }}` | log_line_contains_span_id="true" OR span_id="${__span.spanId}"'),{expr:X,refId:""}}function we(P){const W=P.process.tags.find(q=>q.key===ee)?.value,G=P.tags.find(q=>q.key==="session_id"||q.key==="session.id")?.value;return W&&G?`/a/grafana-kowalski-app/apps/${W}/sessions/${G}`:void 0}function fe(P,W,G,q){const{filterByTraceID:te,filterBySpanID:oe}=W;if(q)return{query:q,refId:"",metrics:[{id:"1",type:"logs"}]};let X=[];return oe&&P.spanID&&X.push('"${__span.spanId}"'),te&&P.traceID&&X.push('"${__span.traceId}"'),G&&X.push("${__tags}"),{query:X.join(" AND "),refId:"",metrics:[{id:"1",type:"logs"}]}}function ve(P,W,G,q){const{filterByTraceID:te,filterBySpanID:oe}=W;if(q)return{query:q,refId:""};let X="";return G&&(X+="${__tags}"),te&&P.traceID&&(X+=' "${__span.traceId}"'),oe&&P.spanID&&(X+=' "${__span.spanId}"'),{query:X,refId:""}}function ze(P,W,G,q){const{filterByTraceID:te,filterBySpanID:oe}=W;if(q)return{query:q,refId:""};let X=[];return oe&&P.spanID&&X.push('"${__span.spanId}"'),te&&P.traceID&&X.push('"${__span.traceId}"'),G&&X.push("${__tags}"),{query:X.join(" AND "),refId:""}}function dt(P,W,G,q){const{filterByTraceID:te,filterBySpanID:oe}=W;if(q)return{lsql:q,refId:""};if(!G)return;let X="${__tags}";return te&&P.traceID&&(X+=' or "${__span.traceId}"'),oe&&P.spanID&&(X+=' or "${__span.spanId}"'),{lsql:X,refId:""}}function _e(P,W,{labelValueSign:G="=",joinBy:q=", "}={}){return[...P.process.tags,...P.tags,{key:"spanId",value:P.spanID},{key:"traceId",value:P.traceID},{key:"name",value:P.operationName},{key:"duration",value:P.duration}].map(te=>{const oe=W.find(X=>X.key===te.key);if(oe)return`${oe.value?oe.value:oe.key}${G}"${te.value}"`}).filter(te=>!!te).join(q)}function Ke(P,W={startMs:0,endMs:0},G=!1,q=!1){let te=Math.floor(P.startTime/1e3+W.startMs);const oe=(P.startTime+P.duration)/1e3;let X=Math.floor(oe+W.endMs);G&&X-te<1e3?X=te+1e3:q?(te=te-6e4,X=X+6e4):te===X&&X++;const $e=(0,x.KQ)(X),Be=(0,x.KQ)(te);return{from:Be,to:$e,raw:{from:Be,to:$e}}}function ut(P,W,G){return{__trace:{text:"Trace",value:{duration:P,name:W,traceId:G}}}}function Z(P){const W={};for(const G of P.process.tags)W[G.key]=G.value;for(const G of P.tags)W[G.key]=G.value;return{__span:{text:"Span",value:{spanId:P.spanID,traceId:P.traceID,duration:P.duration,name:P.operationName,tags:W}}}}function Re(P,W){let G={};if(W){const q=W.tags&&W.tags.length>0?W.tags:R;G={__tags:{text:"Tags",value:_e(P,q)}}}return G}},2973:(y,v,c)=>{"use strict";c.d(v,{Ji:()=>g,Qh:()=>F,SQ:()=>H,_g:()=>D,zE:()=>w});var s=c(2543),a=c.n(s),u=c(96540),x=c(24726),_=c(26935);const w=()=>(0,x.A)().slice(0,12),D={id:w(),operator:"="},g={spanNameOperator:"=",serviceNameOperator:"=",fromOperator:">",toOperator:"<",tags:[D],matchesOnly:!1,criticalPathOnly:!1};function H(C,k){const[R,A]=(0,u.useState)((0,s.merge)((0,s.cloneDeep)(g),k??{}));(0,u.useEffect)(()=>{k&&A((0,s.merge)((0,s.cloneDeep)(g),k))},[k]);const ee=(0,u.useMemo)(()=>C&&(0,_.filterSpans)(R,C),[R,C]);return{search:R,setSearch:A,spanFilterMatches:ee}}function F(C,k){if(!k)return k;const R={...k};return R.query&&(R.query=C(R.query)),R.serviceNameOperator&&(R.serviceNameOperator=C(R.serviceNameOperator)),R.serviceName&&(R.serviceName=C(R.serviceName)),R.spanNameOperator&&(R.spanNameOperator=C(R.spanNameOperator)),R.spanName&&(R.spanName=C(R.spanName)),R.from&&(R.from=C(R.from)),R.to&&(R.to=C(R.to)),R.tags&&(R.tags=R.tags.map(A=>({...A,key:C(A.key??""),value:C(A.value??"")}))),R}},3091:(y,v,c)=>{"use strict";c.d(v,{Io:()=>g,_g:()=>D,m8:()=>w,pG:()=>_});var s=c(11908),a=c(2543),u=c.n(a),x=c(14145);const _=H=>{const F=H.spans.map(C=>C.process.serviceName);return(0,a.uniq)(F).sort()},w=H=>{const F=H.spans.map(C=>C.operationName);return(0,a.uniq)(F).sort()},D=H=>{let F=[],C=[];return H.spans.forEach(k=>{k.tags.forEach(R=>{F.push(R.key)}),k.process.tags.forEach(R=>{F.push(R.key)}),k.logs!==null&&k.logs.forEach(R=>{R.fields.forEach(A=>{C.push(A.key)})}),k.kind&&F.push(x.Nd),k.statusCode!==void 0&&F.push(x.XQ),k.statusMessage&&F.push(x.x9),k.instrumentationLibraryName&&F.push(x.mT),k.instrumentationLibraryVersion&&F.push(x.Zh),k.traceState&&F.push(x.gz),F.push(x.ID)}),F=(0,a.uniq)(F).sort(),C=(0,a.uniq)(C).sort(),[...F,...C]},g=(H,F)=>{const C=[];return H.spans.forEach(k=>{const R=k.tags.find(ee=>ee.key===F)?.value;R&&C.push(R.toString());const A=k.process.tags.find(ee=>ee.key===F)?.value;switch(A&&C.push(A.toString()),k.logs!==null&&k.logs.forEach(ee=>{const re=ee.fields.find(ye=>ye.key===F)?.value;re&&C.push(re.toString())}),F){case x.Nd:k.kind&&C.push(k.kind);break;case x.XQ:k.statusCode!==void 0&&C.push(s.s[k.statusCode].toLowerCase());break;case x.x9:k.statusMessage&&C.push(k.statusMessage);break;case x.mT:k.instrumentationLibraryName&&C.push(k.instrumentationLibraryName);break;case x.Zh:k.instrumentationLibraryVersion&&C.push(k.instrumentationLibraryVersion);break;case x.gz:k.traceState&&C.push(k.traceState);break;case x.ID:C.push(k.spanID);break;default:break}}),(0,a.uniq)(C).sort()}},27072:(y,v,c)=>{"use strict";c.d(v,{L:()=>u});var s=c(94626),a=c(26935);function u(_){if(!_)return null;let w=_.fields.length===1?_.fields[0].values[0]:x(_);return w?(0,a.transformTraceData)(w):null}function x(_){const w=new s.R(_),D={};for(let g=0;g<w.length;g++){const H=w.get(g);if(!H.spanID)return null;D[H.spanID]||(D[H.spanID]={serviceName:H.serviceName,tags:H.serviceTags})}return{traceID:w.get(0).traceID,processes:D,spans:w.toArray().map((g,H)=>{const F=[];return g.parentSpanID&&F.push({refType:"CHILD_OF",spanID:g.parentSpanID,traceID:g.traceID}),g.references&&F.push(...g.references.map(C=>({refType:"FOLLOWS_FROM",...C}))),{...g,duration:g.duration*1e3,startTime:g.startTime*1e3,processID:g.spanID,flags:0,references:F,logs:g.logs?.map(C=>({...C,timestamp:C.timestamp*1e3}))||[],dataFrameRowIndex:H}})}}},4392:(y,v,c)=>{"use strict";c.d(v,{A:()=>u});var s=c(94701),a=function(x){(0,s.A)(function(){x()})};const u=a}}]);

//# sourceMappingURL=8051.a75ccc95557b8a5041d4.js.map