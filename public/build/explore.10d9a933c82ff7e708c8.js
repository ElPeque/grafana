"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[9604],{53626:(Yt,He,i)=>{i.d(He,{L5:()=>c,hr:()=>Q,jN:()=>k});var t=i(47180),u=i(11817);function c(ne){}function Q(ne){switch(ne){case t.CC.Logfmt:return{label:(0,u.t)("correlations.trans-details.logfmt-label","Logfmt"),value:t.CC.Logfmt,description:(0,u.t)("correlations.trans-details.logfmt-description","Parse provided field with logfmt to get variables"),expressionDetails:{show:!1},mapValueDetails:{show:!1}};case t.CC.Regex:return{label:(0,u.t)("correlations.trans-details.regex-label","Regular expression"),value:t.CC.Regex,description:(0,u.t)("correlations.trans-details.regex-description","Field will be parsed with regex. Use named capture groups to return multiple variables, or a single unnamed capture group to add variable to named map value. Regex is case insensitive."),expressionDetails:{show:!0,required:!0,helpText:(0,u.t)("correlations.trans-details.regex-expression","Use capture groups to extract a portion of the field.")},mapValueDetails:{show:!0,required:!1,helpText:(0,u.t)("correlations.trans-details.regex-map-values","Defines the name of the variable if the capture group is not named.")}};default:return{label:ne,value:ne,expressionDetails:{show:!1},mapValueDetails:{show:!1}}}}const k=()=>Object.values(t.CC).map(ne=>{const we=Q(ne);return{label:we.label,value:we.value,description:we.description}})},93125:(Yt,He,i)=>{i.r(He),i.d(He,{default:()=>vl});var t=i(74848),u=i(22803),c=i(96540),Q=i(32370),k=i(29675),ne=i(49816),we=i(68717),Xe=i(95382),dt=i(10011),v=i(11817),D=i(61491),_e=i(2739),Jt=function(e,s){e===void 0&&(e=!0);var n=(0,c.useCallback)(function(o){var r=typeof e=="function"?e():!0;if(r)return o.preventDefault(),s&&(o.returnValue=s),s},[e,s]);(0,c.useEffect)(function(){if(e)return(0,_e.on)(window,"beforeunload",n),function(){return(0,_e.AU)(window,"beforeunload",n)}},[e,n])};const It=Jt;var ut=i(64305),pt=i(87190),M=i(56276),A=i(48583),Z=i(6736),U=i(79784),B=i(54594),Ae=i(32027),Ne=i(25356);const gt=({onSave:e,onDiscard:s,onCancel:n,message:o})=>(0,t.jsxs)(Ne.a,{isOpen:!0,title:"Unsaved changes to correlation",onDismiss:n,icon:"exclamation-triangle",className:(0,u.css)({width:"600px"}),children:[(0,t.jsx)("h5",{children:o}),(0,t.jsxs)(Ne.a.ButtonRow,{children:[(0,t.jsx)(B.$n,{variant:"secondary",onClick:n,fill:"outline",children:"Cancel"}),(0,t.jsx)(B.$n,{variant:"destructive",onClick:s,children:"Continue without saving"}),(0,t.jsx)(B.$n,{variant:"primary",onClick:e,children:"Save correlation"})]})]});var se=i(2543),Ce=(e=>(e.SOURCE_TARGET_CHANGE="cause the query in the right pane to be re-ran and links added to that data",e.FULL_QUERY_LOSS="lose the changed query",e.FULL_CORR_LOSS="cause the correlation in progress to be lost",e.INVALID_VAR="remove the variables, and your changed query may no longer be valid",e))(Ce||{});const ro=(e,s,n,o)=>{const r=(0,se.template)("<%= actionStr %> will <%= consequenceStr %>. Would you like to save before continuing?");let a="",l="";if(e===D.CORRELATION_EDITOR_POST_CONFIRM_ACTION.CLOSE_PANE)if(a="Closing the pane",s)if(n)l="cause the correlation in progress to be lost";else if(o)l="cause the query in the right pane to be re-ran and links added to that data";else return;else if(n)l="cause the correlation in progress to be lost";else if(o)l="lose the changed query";else return;else if(e===D.CORRELATION_EDITOR_POST_CONFIRM_ACTION.CHANGE_DATASOURCE)if(a="Changing the datasource",s)if(n)l="cause the correlation in progress to be lost";else return;else if(o)l="lose the changed query";else return;else if(e===D.CORRELATION_EDITOR_POST_CONFIRM_ACTION.CLOSE_EDITOR)if(a="Closing the editor",n)l="cause the correlation in progress to be lost";else if(o)l="remove the variables, and your changed query may no longer be valid";else return;return r({actionStr:a,consequenceStr:l})};var ao=i(11550),$e=i(58450),Pe=i(3414),J=i(67078),Y=i(4149),X=i(60225);const io=({panes:e})=>{const s=(0,D.useDispatch)(),n=(0,k.of)(lo),o=(0,D.useSelector)(X.vC),r=(0,D.useSelector)(X.st),[a,l]=(0,c.useState)(void 0);It(o?.correlationDirty||!1,"Save correlation?"),It(!o?.correlationDirty&&o?.queryEditorDirty||!1,"The query editor was changed. Save correlation before continuing?"),(0,c.useEffect)(()=>{if(o?.isExiting){const{correlationDirty:h,queryEditorDirty:f}=o;let m,j;o.postConfirmAction?(m=o.postConfirmAction.isActionLeft,j=o.postConfirmAction.action):(j=D.CORRELATION_EDITOR_POST_CONFIRM_ACTION.CLOSE_EDITOR,m=!1);const y=ro(j,m,h,f);if(y!==void 0)l(y);else if(j===D.CORRELATION_EDITOR_POST_CONFIRM_ACTION.CHANGE_DATASOURCE&&o.postConfirmAction){const{exploreId:S,changeDatasourceUid:b}=o?.postConfirmAction;S&&b&&(s((0,$e.wh)({exploreId:S,datasource:b,options:{importQueries:!0}})),s((0,J.am)({isExiting:!1})))}else if(j===D.CORRELATION_EDITOR_POST_CONFIRM_ACTION.CLOSE_PANE&&o.postConfirmAction){const{exploreId:S}=o?.postConfirmAction;S!==void 0&&(s((0,J.J8)(S)),s((0,J.am)({isExiting:!1})))}else j===D.CORRELATION_EDITOR_POST_CONFIRM_ACTION.CLOSE_EDITOR&&s((0,J.am)({editorMode:!1}))}},[o,s,r]),(0,ut.A)(()=>{s((0,J.am)({editorMode:!1,isExiting:!1,correlationDirty:!1,label:void 0,description:void 0,canSave:!1})),e.forEach(h=>{s((0,Pe.nE)({exploreId:h[0],correlationEditorHelperData:void 0})),s((0,Y.Od)({exploreId:h[0]}))})});const p=()=>{s((0,J.am)({editorMode:!0,isExiting:!1,correlationDirty:!1,label:void 0,description:void 0,canSave:!1})),e.forEach(h=>{s((0,Pe.nE)({exploreId:h[0],correlationEditorHelperData:void 0})),s((0,Y.Od)({exploreId:h[0]}))})},g=h=>{l(void 0),s((0,J.J8)(h)),(0,M.rR)("grafana_explore_split_view_closed")},x=(h,f)=>{l(void 0),s((0,$e.wh)({exploreId:h,datasource:f,options:{importQueries:!0}}))},d=h=>{if(s((0,ao.v)(o?.label,o?.description,o?.transformations)),!h&&o?.postConfirmAction!==void 0){const{exploreId:f,action:m,changeDatasourceUid:j}=o?.postConfirmAction;m===D.CORRELATION_EDITOR_POST_CONFIRM_ACTION.CLOSE_PANE?(g(f),p()):m===D.CORRELATION_EDITOR_POST_CONFIRM_ACTION.CHANGE_DATASOURCE&&j!==void 0&&((0,$e.wh)({exploreId:f,datasource:j}),p())}else s((0,J.am)({editorMode:!1,correlationDirty:!1,isExiting:!1}))};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(Ae.X,{message:h=>h.pathname!=="/explore"&&o?.editorMode&&o?.correlationDirty?"You have unsaved correlation data. Continue?":!0}),a!==void 0&&(0,t.jsx)(gt,{onDiscard:()=>{if(o?.postConfirmAction!==void 0){const{exploreId:h,action:f,changeDatasourceUid:m}=o?.postConfirmAction;f===D.CORRELATION_EDITOR_POST_CONFIRM_ACTION.CLOSE_PANE?g(h):f===D.CORRELATION_EDITOR_POST_CONFIRM_ACTION.CHANGE_DATASOURCE&&m!==void 0&&x(h,m),s((0,J.am)({isExiting:!1}))}else s((0,J.am)({editorMode:!1,correlationDirty:!1,isExiting:!1}))},onCancel:()=>{s((0,J.am)({isExiting:!1})),l(void 0)},onSave:()=>{d(!1)},message:a}),(0,t.jsx)("div",{className:n.correlationEditorTop,children:(0,t.jsxs)(A.B,{gap:2,justifyContent:"flex-end",alignItems:"center",children:[(0,t.jsx)(Z.m,{content:"Correlations editor in Explore is an experimental feature.",children:(0,t.jsx)(U.I,{className:n.iconColor,name:"info-circle",size:"xl"})}),(0,t.jsx)(B.$n,{variant:"secondary",disabled:!o?.canSave,fill:"outline",className:o?.canSave?n.buttonColor:n.disabledButtonColor,onClick:()=>{d(!0)},children:"Save"}),(0,t.jsx)(B.$n,{variant:"secondary",fill:"outline",className:n.buttonColor,icon:"times",onClick:()=>{s((0,J.am)({isExiting:!0})),(0,M.rR)("grafana_explore_correlation_editor_exit_pressed")},children:"Exit correlation editor"})]})})]})},lo=e=>{const s=e.colors.getContrastText(e.colors.primary.main),n=pt.MV.lighten(e.colors.primary.main,.1),o=pt.MV.darken(e.colors.primary.main,.2),r=pt.MV.darken(s,.2);return{correlationEditorTop:(0,u.css)({backgroundColor:e.colors.primary.main,marginTop:"3px",padding:e.spacing(1)}),iconColor:(0,u.css)({color:s}),buttonColor:(0,u.css)({color:s,borderColor:s,"&:hover":{color:s,borderColor:s,backgroundColor:n}}),disabledButtonColor:(0,u.css)({color:`${r} !important`,backgroundColor:`${o} !important`})}};var Xt=i(1503),wt=i(61351),et=i(5956);const co=()=>{const[e,s]=(0,c.useState)([]),{query:n}=(0,Xt.useKBar)(),o=(0,D.useDispatch)(),r=(0,D.useSelector)(X.Qb),a=(0,D.useSelector)(X.pF),l=wt.TP.hasPermission(D.AccessControlAction.DataSourcesWrite);return(0,c.useEffect)(()=>{const p=Object.keys(r),g={name:"Explore",priority:Xt.Priority.HIGH+1},x=[];if(a)x.push({id:"explore/run-query-left",name:"Run query (left)",keywords:"query left",perform:()=>{o((0,Y.Od)({exploreId:p[0]}))},section:g}),r[1]&&(x.push({id:"explore/run-query-right",name:"Run query (right)",keywords:"query right",perform:()=>{o((0,Y.Od)({exploreId:p[1]}))},section:g}),x.push({id:"explore/split-view-close-left",name:"Close split view left",keywords:"split",perform:()=>{o((0,J.J8)(p[0]))},section:g}),x.push({id:"explore/split-view-close-right",name:"Close split view right",keywords:"split",perform:()=>{o((0,J.J8)(p[1]))},section:g}));else{const d=Object.values(r).some(h=>h?.datasourceInstance?.uid===et.uv);Q.$.featureToggles.correlations&&l&&!d&&x.push({id:"explore/correlations-editor",name:"Correlations editor",perform:()=>{o((0,J.am)({editorMode:!0})),o((0,Y.Od)({exploreId:p[0]}))},section:g}),x.push({id:"explore/run-query",name:"Run query",keywords:"query",perform:()=>{o((0,Y.Od)({exploreId:p[0]}))},section:g}),x.push({id:"explore/split-view-open",name:"Open split view",keywords:"split",perform:()=>{o((0,J.ve)())},section:g})}s(x)},[r,a,n,o,l]),(0,Xt.useRegisterActions)(n?e:[],[e,n]),null};var Ps=i(33149),uo=i(14382);function ks(e){const{children:s,onResize:n,initialHeight:o}=e,r=(0,k.$j)(),a=(0,k.of)(go),l=(0,uo.l)(r),p=o||`${r.components.horizontalDrawer.defaultHeight}px`;return(0,t.jsx)(Ps.c,{className:(0,u.cx)(a.fixed,a.container,a.drawerActive),defaultSize:{width:"100%",height:p},handleClasses:{top:l.dragHandleHorizontal},enable:{top:!0,right:!1,bottom:!1,left:!1,topRight:!1,bottomRight:!1,bottomLeft:!1,topLeft:!1},maxHeight:"100vh",onResize:n,children:s})}const po=e=>(0,u.keyframes)`
  0% {
    transform: translateY(${e.components.horizontalDrawer.defaultHeight}px);
  }

  100% {
    transform: translateY(0px);
  }
`,go=e=>({fixed:(0,u.css)({position:"absolute !important"}),container:(0,u.css)({bottom:0,background:e.colors.background.primary,borderTop:`1px solid ${e.colors.border.weak}`,boxShadow:e.shadows.z3,zIndex:e.zIndex.navbarFixed}),drawerActive:(0,u.css)({opacity:1,[e.transitions.handleMotion("no-preference")]:{animation:`0.5s ease-out ${po(e)}`}})});var Re=i(71468),ho=i(10112),Ms=i(35023),tt=i(58779),ht=i(95536),fo=i(70713),Ft=i(69199),oe=i(18163),xe=i(8392),Bs=i(44099),ze=i(98437),_t=i(99134),es=i(40612),st=i(37e3),Et=i(85913),ft=i(67548),Ot=i(10743),Hs=i(42941),mo=i(23535),xo=function(e){var s=(0,mo.A)({x:0,y:0}),n=s[0],o=s[1];return(0,c.useEffect)(function(){var r=function(){e.current&&o({x:e.current.scrollLeft,y:e.current.scrollTop})};return e.current&&(0,_e.on)(e.current,"scroll",r,{capture:!1,passive:!0}),function(){e.current&&(0,_e.AU)(e.current,"scroll",r)}},[e]),n};const yo=xo,$s=(0,c.createContext)(void 0);function vo({children:e,refreshDependencies:s}){const[n,o]=(0,c.useState)([]),r=(0,c.useRef)({}),a=(0,c.useCallback)(d=>{const h=d.id?d.id:(0,se.uniqueId)(`${d.panelId}-${d.title}-${d.icon}_`);return o(f=>{if(d.level==="root"){const m=r.current[d.panelId]||[];return m.length>0&&r.current[d.panelId].forEach(y=>{y.type==="filter"&&(y.ref=d.ref)}),r.current[d.panelId]=[],[...f,{...d,id:h,children:m}].sort(Vs)}if(d.level==="child"){let m=!1;if(Object.keys(r.current).forEach(C=>{if(r.current[C].find(T=>T.title===d.title&&d.type==="filter"&&d.panelId===T.panelId)){m=!0;return}}),m)return[...f];const j=f.findIndex(C=>C.panelId===d.panelId&&C.level==="root");if(j===-1)return Object.keys(r.current).find(I=>I===d.panelId)?r.current[d.panelId].push({...d,id:h}):r.current[d.panelId]=[{...d,id:h}],[...f];const y=[...f],S={...y[j]},b=S.children?.find(C=>C.title===d.title&&d.type==="filter"&&d.panelId===C.panelId);if(b&&b.highlight!==d.highlight)return S.children?.map(C=>{C.title===b?.title&&(C.highlight=d.highlight)}),[...f];if(b)return[...f];let L=d.ref;d.type==="filter"&&(L=S.ref);let R=[{...d,id:h,ref:L},...S.children||[]];return d.childOnTop||(R=Ws(R)),y[j]={...S,children:R},y}return[...f]}),h},[]),l=(0,c.useCallback)(d=>{o(h=>h.filter(f=>f.id!==d).map(f=>(f.children&&(f.children=f.children.filter(m=>m.id!==d)),f)))},[]),p=(0,c.useCallback)(d=>{o(d)},[]),g=(0,c.useCallback)((d,h)=>{o(f=>f.map(m=>m.id===d?{...m,...h}:m))},[]),x=(0,c.useCallback)((d,h)=>{o(f=>{const m=d(f);return m?f.map(j=>(j.id===m&&(j.children=j.children?.filter(y=>y.type!==h)),j)):f})},[]);return(0,c.useEffect)(()=>{o(d=>{const h=[...d];for(const f of h){const m=Ws(f.children||[]);f.children=m}return h})},[s]),(0,t.jsx)($s.Provider,{value:{outlineItems:n,register:a,unregister:l,updateOutlineItems:p,unregisterAllChildren:x,updateItem:g},children:e})}function Vs(e,s){if(e.ref&&s.ref){const n=e.ref.compareDocumentPosition(s.ref);if(n===Node.DOCUMENT_POSITION_PRECEDING)return 1;if(n===Node.DOCUMENT_POSITION_FOLLOWING)return-1}return 0}function Ws(e){const[s,n]=e.reduce((o,r)=>(r.childOnTop?o[0].push(r):o[1].push(r),o),[[],[]]);return n.sort(Vs),[...s,...n]}function ts(){return(0,c.useContext)($s)}var bo=i(5005);function ss({contentOutlineExpanded:e,title:s,icon:n,tooltip:o,tooltipPlacement:r="bottom",className:a,indentStyle:l,collapsible:p,collapsed:g,isActive:x,extraHighlight:d,sectionId:h,toggleCollapsed:f,color:m,onRemove:j,...y}){const S=(0,k.$j)(),b=Co(S,m),L=(0,u.cx)(b.button,a),R=(0,c.useRef)(null),[C,I]=(0,c.useState)(!1);(0,c.useEffect)(()=>{R.current&&I(R.current?.scrollWidth>R.current?.clientWidth)},[s]);const T=(0,t.jsxs)("div",{className:(0,u.cx)(b.buttonContainer,l),children:[p&&(0,t.jsx)("button",{className:b.collapseButton,onClick:f,"aria-label":"Content outline item collapse button","aria-expanded":!g,"aria-controls":h,children:(0,t.jsx)(zs,{icon:g?"angle-right":"angle-down"})}),(0,t.jsxs)("button",{className:(0,u.cx)(L,{[b.active]:x,[b.extraHighlight]:d}),"aria-label":o,...y,children:[(0,t.jsx)(zs,{icon:n}),s&&(0,t.jsx)("span",{className:b.textContainer,ref:R,children:s})]}),j&&(0,t.jsx)(B.$n,{variant:"destructive",className:b.deleteButton,icon:"times",onClick:()=>j(),"data-testid":"content-outline-item-delete-button"})]});return o&&(!e||C)?(0,t.jsx)(Z.m,{content:o,placement:r,children:T}):T}function zs({icon:e}){return e?(0,bo.n6)(e)?(0,t.jsx)(U.I,{name:e,size:"lg",title:e}):e:null}const Co=(e,s)=>({buttonContainer:(0,u.css)({position:"relative",display:"flex",alignItems:"center",flexGrow:1,gap:e.spacing(.25),width:"100%",overflow:"hidden"}),button:(0,u.css)({label:"content-outline-item-button",display:"flex",alignItems:"center",height:e.spacing(e.components.height.md),gap:e.spacing(.5),color:e.colors.text.secondary,width:"100%",background:"transparent",overflow:"hidden",border:"none"}),collapseButton:(0,u.css)({display:"flex",alignItems:"center",justifyContent:"center",width:e.spacing(3),height:e.spacing(4),borderRadius:e.shape.radius.default,color:e.colors.text.secondary,background:"transparent",border:"none",overflow:"hidden","&:hover":{color:e.colors.text.primary,background:e.colors.secondary.shade}}),textContainer:(0,u.css)({whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",fontSize:e.typography.bodySmall.fontSize,marginLeft:e.spacing(.5)}),active:(0,u.css)({backgroundColor:e.colors.background.secondary,borderTopRightRadius:e.shape.radius.default,borderBottomRightRadius:e.shape.radius.default,position:"relative",height:e.spacing(e.components.height.md),"&::before":{backgroundImage:s!==void 0?"none":e.colors.gradients.brandVertical,backgroundColor:s!==void 0?s:"none",borderRadius:e.shape.radius.default,content:'" "',display:"block",height:"100%",position:"absolute",transform:"translateX(-50%)",width:e.spacing(.5),left:"2px"}}),extraHighlight:(0,u.css)({backgroundColor:e.colors.background.secondary,borderTopRightRadius:e.shape.radius.default,borderBottomRightRadius:e.shape.radius.default,position:"relative","&::before":{backgroundImage:s!==void 0?"none":e.colors.gradients.brandVertical,backgroundColor:s!==void 0?s:"none",borderRadius:e.shape.radius.default,content:'" "',display:"block",height:"100%",position:"absolute",transform:"translateX(-50%)",width:e.spacing(.5),left:"2px"}}),deleteButton:(0,u.css)({width:e.spacing(1),height:e.spacing(1),padding:e.spacing(.75,.75),marginRight:e.spacing(.5)})});function Qs(e){return e.children?.filter(s=>s.type!=="filter")||[]}function Us(e,s,n,o){const r=s===e.id,a=n===e.id,l=!o[e.id],p=Qs(e).length>0,g=Nt(e,n)&&!o[e.id];return p?l&&(r||g):r||a}const Dt={visible:"grafana.explore.contentOutline.visible",expanded:"grafana.explore.contentOutline.expanded"};function So({scroller:e,panelId:s}){const[n,o]=(0,Hs.A)(Ft.M.getBool(Dt.expanded,!0)),r=(0,k.of)(jo,n),a=(0,c.useRef)(e||null),{y:l}=yo(a),{outlineItems:p}=ts()??{outlineItems:[]},[g,x]=(0,c.useState)(p[0]?.id),[d,h]=(0,c.useState)(p[0]?.children?.[0]?.id),f=p.some(C=>C.children&&!(C.mergeSingleChild&&C.children?.length===1)&&C.children.length>0),m=p.some(C=>C.children?.some(I=>I.onRemove)),[j,y]=(0,c.useState)(()=>p.reduce((C,I)=>(C[I.id]=!!I.expanded,C),{})),S=(C,I=0)=>{let T=0,O=C;if(O){do T+=O?.offsetTop||0,O=O?.offsetParent instanceof HTMLElement?O.offsetParent:void 0;while(O&&O!==e);e?.scroll({top:T+I,behavior:"smooth"})}},b=C=>{if(C.level==="child"&&C.type==="filter"){const I=p.find(T=>T.children?.find(O=>O.id===C.id));I&&S(I.ref,I.customTopOffset)}else S(C.ref,C.customTopOffset),(0,M.rR)("explore_toolbar_contentoutline_clicked",{item:"select_section",type:C.panelId})},L=()=>{Ft.M.set(Dt.expanded,!n),o(),(0,M.rR)("explore_toolbar_contentoutline_clicked",{item:"outline",type:n?"minimize":"expand"})},R=C=>{y(I=>({...I,[C]:!I[C]})),(0,M.rR)("explore_toolbar_contentoutline_clicked",{item:"section",type:j[C]?"expand":"minimize"})};return(0,c.useEffect)(()=>{let C;for(const I of p){let T=I?.ref?.getBoundingClientRect().top;T&&T>=0&&(C=I);const O=Qs(I).find($=>{const W=$.customTopOffset||0;let G=$?.ref?.getBoundingClientRect().top;return G&&G>=W});if(O&&At(I)){h(O.id),x(I.id);break}if(C){x(C.id),h(void 0);break}}},[p,l]),(0,t.jsx)(es._,{className:r.wrapper,id:s,children:(0,t.jsx)(_t.P,{children:(0,t.jsxs)("div",{className:r.content,children:[(0,t.jsx)(ss,{icon:"arrow-from-right",tooltip:n?"Collapse outline":"Expand outline",tooltipPlacement:n?"right":"bottom",onClick:L,className:(0,u.cx)(r.toggleContentOutlineButton,{[r.justifyCenter]:!n&&!f}),"aria-expanded":n}),p.map(C=>(0,t.jsxs)(c.Fragment,{children:[(0,t.jsx)(ss,{title:n?C.title:void 0,contentOutlineExpanded:n,className:(0,u.cx)(r.buttonStyles,{[r.justifyCenter]:!n&&!m,[r.sectionHighlighter]:Nt(C,d)&&!n}),indentStyle:(0,u.cx)({[r.indentRoot]:!At(C)&&f,[r.sectionHighlighter]:Nt(C,d)&&!n&&j[C.id]}),icon:C.icon,onClick:()=>b(C),tooltip:C.title,collapsible:At(C),collapsed:!j[C.id],toggleCollapsed:()=>R(C.id),isActive:Us(C,g,d,j),sectionId:C.id,color:C.color},C.id),(0,t.jsx)("div",{id:C.id,"data-testid":`section-wrapper-${C.id}`,children:C.children&&At(C)&&j[C.id]&&C.children.map((I,T)=>(0,t.jsxs)("div",{className:r.itemWrapper,children:[n&&(0,t.jsx)("div",{className:(0,u.cx)(r.itemConnector,{[r.firstItemConnector]:T===0,[r.lastItemConnector]:T===(C.children?.length||0)-1})}),(0,t.jsx)(ss,{title:n?I.title:void 0,contentOutlineExpanded:n,icon:n?void 0:C.icon,className:(0,u.cx)(r.buttonStyles,{[r.justifyCenter]:!n&&!m,[r.sectionHighlighter]:Nt(C,d)&&!n}),indentStyle:r.indentChild,onClick:O=>{b(I),I.onClick?.(O)},tooltip:I.title,isActive:Us(I,g,d,j),extraHighlight:I.highlight,color:I.color,onRemove:I.onRemove?()=>I.onRemove?.(I.id):void 0},I.id)]},I.id))})]},C.id))]})})})}const jo=(e,s)=>({wrapper:(0,u.css)({label:"wrapper",position:"relative",display:"flex",justifyContent:"center",marginRight:e.spacing(1),height:"100%",backgroundColor:e.colors.background.primary,width:s?"160px":void 0,minWidth:s?"160px":void 0}),content:(0,u.css)({label:"content",marginLeft:e.spacing(.5),top:0}),buttonStyles:(0,u.css)({display:"flex","&:hover":{color:e.colors.text.primary,textDecoration:"underline"}}),toggleContentOutlineButton:(0,u.css)({"&:hover":{color:e.colors.text.primary},transform:s?"rotate(180deg)":"",marginRight:s?e.spacing(.5):void 0}),indentRoot:(0,u.css)({paddingLeft:e.spacing(3)}),indentChild:(0,u.css)({paddingLeft:s?e.spacing(5):e.spacing(2.75)}),itemWrapper:(0,u.css)({display:"flex",height:e.spacing(4),alignItems:"center"}),itemConnector:(0,u.css)({position:"relative",height:"100%",width:e.spacing(1.5),"&::before":{borderRight:`1px solid ${e.colors.border.medium}`,content:'""',height:"100%",left:e.spacing(4.75),position:"absolute",transform:"translateX(50%)"}}),firstItemConnector:(0,u.css)({"&::before":{top:e.spacing(1),height:`calc(100% - ${e.spacing(1)})`}}),lastItemConnector:(0,u.css)({"&::before":{height:`calc(100% - ${e.spacing(1)})`}}),justifyCenter:(0,u.css)({justifyContent:"center"}),sectionHighlighter:(0,u.css)({backgroundColor:e.colors.background.secondary})});function At(e){return!!(e.children&&e.children.length>0&&(!e.mergeSingleChild||e.children.length!==1))}function Nt(e,s){return e.children?.some(n=>n.id===s)}function Le({panelId:e,title:s,icon:n,customTopOffset:o,children:r,className:a,level:l="root",mergeSingleChild:p,type:g="scrollIntoView",onClick:x}){const{register:d,unregister:h}=ts()??{},f=(0,c.useRef)(null);return(0,c.useEffect)(()=>{if(!d||!h)return;const m=d({panelId:e,title:s,icon:n,ref:f.current,customTopOffset:o,level:l,mergeSingleChild:p,type:g});return()=>h(m)},[e,s,n,o,l,p,d,h,g,x]),(0,t.jsx)("div",{className:a,ref:f,children:r})}var Pt=i(49785),ns=i(16817),kt=i(43192),ke=i(86489),mt=i(34128),Mt=i(6210),nt=i(99764),To=i(87731),os=i(44853),Ro=i(3930),Lo=i(23257),Io=i.n(Lo),wo=i(40271),Ve=i(44826),rs=i(53626);const Gs=({label:e,tooltipText:s})=>(0,t.jsxs)(A.B,{gap:1,direction:"row",wrap:"wrap",alignItems:"flex-start",children:[(0,t.jsx)(wo.J,{children:e}),(0,t.jsx)(Z.m,{content:s,children:(0,t.jsx)(U.I,{name:"info-circle",size:"sm"})})]}),Fo=({onSave:e,onCancel:s,fieldList:n,transformationToEdit:o})=>{const[r,a]=(0,c.useState)(void 0),[l,p]=(0,c.useState)({}),[g,x]=(0,c.useState)({mapValueDetails:{show:!1},expressionDetails:{show:!1}}),[d,h]=(0,c.useState)(!1),[f,m]=(0,c.useState)(!1),{getValues:j,control:y,register:S,watch:b}=(0,Pt.mN)({defaultValues:(0,c.useMemo)(()=>{if(o){const R=n[o?.field];a(R),o?.expression&&h(!0);const C=(0,rs.hr)(o?.type);x({mapValueDetails:C.mapValueDetails,expressionDetails:C.expressionDetails});const I=(0,os.k)({type:o?.type,expression:o?.expression,mapValue:o?.mapValue},R||"",o?.field);return p({...I}),m(!0),{type:o?.type,field:o?.field,mapValue:o?.mapValue,expression:o?.expression}}else return},[n,o])}),L=(0,c.useId)();return(0,c.useEffect)(()=>{const R=b(C=>{const I=C.expression;let T=!1;if(I!==void 0){T=!0;try{new RegExp(I)}catch{T=!1}}else T=!g.expressionDetails.show;h(T);let O=[];if(C.type){const $=(0,os.k)({type:C.type,expression:T?I:"",mapValue:C.mapValue},n[C.field]||"",C.field);O=Object.keys($),p(O.length>0?{...$}:{})}O.length===0||!T?m(!1):m(!0)});return()=>R.unsubscribe()},[n,g.expressionDetails.show,b]),(0,t.jsxs)(Ne.a,{isOpen:!0,title:`${o?"Edit":"Add"} transformation`,onDismiss:s,className:(0,u.css)({width:"700px"}),children:[(0,t.jsx)("p",{children:"A transformation extracts variables out of a single field. These variables will be available along with your field variables."}),(0,t.jsx)(ke.D,{label:"Field",children:(0,t.jsx)(Pt.xI,{control:y,render:({field:{onChange:R,ref:C,...I}})=>(0,t.jsx)(Ve.l6,{...I,onChange:T=>{T.value&&(R(T.value),a(n[T.value]))},options:Object.entries(n).map(T=>({label:T[0],value:T[0]})),"aria-label":"field"}),name:"field"})}),r&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("pre",{children:(0,t.jsx)(Io(),{textToHighlight:r,searchWords:[d?j("expression")??"":""],autoEscape:!1})}),(0,t.jsx)(ke.D,{label:"Type",children:(0,t.jsx)(Pt.xI,{control:y,render:({field:{onChange:R,ref:C,...I}})=>(0,t.jsx)(Ve.l6,{...I,onChange:T=>{R(T.value);const O=(0,rs.hr)(T.value);x({mapValueDetails:O.mapValueDetails,expressionDetails:O.expressionDetails})},options:(0,rs.jN)(),"aria-label":"type"}),name:"type"})}),g.expressionDetails.show&&(0,t.jsx)(ke.D,{label:g.expressionDetails.helpText?(0,t.jsx)(Gs,{label:"Expression",tooltipText:g.expressionDetails.helpText}):"Expression",htmlFor:`${L}-expression`,required:g.expressionDetails.required,children:(0,t.jsx)(mt.p,{...S("expression"),id:`${L}-expression`})}),g.mapValueDetails.show&&(0,t.jsx)(ke.D,{label:g.mapValueDetails.helpText?(0,t.jsx)(Gs,{label:"Variable Name",tooltipText:g.mapValueDetails.helpText}):"Variable Name",htmlFor:`${L}-mapValue`,children:(0,t.jsx)(mt.p,{...S("mapValue"),id:`${L}-mapValue`})}),Object.entries(l).length>0&&(0,t.jsxs)(t.Fragment,{children:["This transformation will add the following variables:",(0,t.jsx)("pre",{children:Object.entries(l).map(R=>`\${${R[0]}} = ${R[1]?.value}
`)})]})]}),(0,t.jsxs)(Ne.a.ButtonRow,{children:[(0,t.jsx)(B.$n,{variant:"secondary",onClick:s,fill:"outline",children:"Cancel"}),(0,t.jsx)(B.$n,{variant:"primary",onClick:()=>e(j()),disabled:!f,children:o?"Edit transformation":"Add transformation to correlation"})]})]})},Eo=({exploreId:e,correlations:s})=>{const n=(0,D.useDispatch)(),o=(0,k.of)(Oo),r=(0,D.useSelector)(X.Qb),a=Object.values(r),{value:l,loading:p}=(0,ns.A)(async()=>await(0,Ro.tZ)(a[0],a[1]),[a[0]?.datasourceInstance,a[0]?.queries[0].datasource,a[1]?.datasourceInstance,a[1]?.queries[0].datasource]),{register:g,watch:x,getValues:d,setValue:h}=(0,Pt.mN)(),[f,m]=(0,c.useState)(!1),[j,y]=(0,c.useState)(!1),[S,b]=(0,c.useState)(!1),[L,R]=(0,c.useState)([]),[C,I]=(0,c.useState)(void 0),T=(0,D.useSelector)(X.vC),O=(0,c.useId)();return(0,c.useEffect)(()=>(n((0,J.am)({canSave:!0})),()=>{n((0,J.am)({canSave:!1}))}),[n]),(0,c.useEffect)(()=>{!p&&l!==void 0&&!T?.correlationDirty&&d("label")!==""&&h("label",l)},[T?.correlationDirty,l,d,p,h]),(0,c.useEffect)(()=>{const $=x(W=>{let G=T?.correlationDirty||!1,P=W.description||"";!G&&(W.label!==l||P!=="")?G=!0:G&&W.label===l&&P.trim()===""&&(G=!1),n((0,J.am)({label:W.label,description:W.description,correlationDirty:G}))});return()=>$.unsubscribe()},[T?.correlationDirty,l,n,x]),(0,c.useEffect)(()=>{const $=!T?.correlationDirty&&L.length>0?!0:T?.correlationDirty;n((0,J.am)({transformations:L,correlationDirty:$}));let W={};L.forEach(G=>{const P=(0,os.k)({type:G.type,expression:G.expression,mapValue:G.mapValue},s.vars[G.field],G.field);Object.keys(P).forEach(ae=>{W[ae]=P[ae]?.value})}),n((0,Pe.nE)({exploreId:e,correlationEditorHelperData:{resultField:s.resultField,origVars:s.origVars,vars:{...s.origVars,...W}}}))},[n,L]),(0,t.jsxs)(t.Fragment,{children:[S&&(0,t.jsx)(Fo,{onCancel:()=>{I(void 0),b(!1)},onSave:$=>{if(C!==void 0){const W=[...L];W[C]=$,R(W),I(void 0)}else R([...L,$]);b(!1)},fieldList:s.origVars,transformationToEdit:C!==void 0?L[C]:void 0}),(0,t.jsxs)(st.F,{title:"Correlation details",severity:"info",children:["The correlation link will appear by the ",(0,t.jsx)("code",{children:s.resultField})," field. You can use the following variables to set up your correlations:",(0,t.jsx)("pre",{children:Object.entries(s.vars).map($=>`\${${$[0]}} = ${$[1]}
`)}),(0,t.jsxs)(kt.S,{collapsible:!0,isOpen:f,onToggle:()=>{m(!f)},label:(0,t.jsxs)(A.B,{gap:1,direction:"row",wrap:"wrap",alignItems:"center",children:["Label / Description",!f&&!p&&(0,t.jsx)("span",{className:o.labelCollapseDetails,children:`Label: ${d("label")||l}`})]}),children:[(0,t.jsx)(ke.D,{label:"Label",htmlFor:`${O}-label`,children:(0,t.jsx)(mt.p,{...g("label"),id:`${O}-label`,onBlur:()=>{d("label")===""&&l!==void 0&&h("label",l)}})}),(0,t.jsx)(ke.D,{label:"Description",htmlFor:`${O}-description`,children:(0,t.jsx)(mt.p,{...g("description"),id:`${O}-description`})})]}),(0,t.jsxs)(kt.S,{collapsible:!0,isOpen:j,onToggle:()=>{y(!j)},label:(0,t.jsxs)(A.B,{gap:1,direction:"row",wrap:"wrap",alignItems:"center",children:["Transformations",(0,t.jsx)(Z.m,{content:"A transformation extracts one or more variables out of a single field.",children:(0,t.jsx)(U.I,{name:"info-circle",size:"sm"})})]}),children:[(0,t.jsx)(B.$n,{variant:"secondary",fill:"outline",onClick:()=>{b(!0)},className:o.transformationAction,children:"Add transformation"}),L.map(($,W)=>{const{type:G,field:P,expression:ae,mapValue:H}=$,K=[(H??"").length>0?`Variable name: ${H}`:void 0,(ae??"").length>0?(0,t.jsxs)(t.Fragment,{children:["Expression: ",(0,t.jsx)("code",{children:ae})]}):void 0].filter(le=>le);return(0,t.jsxs)(Mt.Z,{children:[(0,t.jsxs)(Mt.Z.Heading,{children:[P,": ",G]}),K.length>0&&(0,t.jsx)(Mt.Z.Meta,{className:o.transformationMeta,children:K}),(0,t.jsxs)(Mt.Z.SecondaryActions,{children:[(0,t.jsx)(nt.K,{name:"edit","aria-label":"edit transformation",onClick:()=>{I(W),b(!0)}},"edit"),(0,t.jsx)(To.e,{"aria-label":"delete transformation",onConfirm:()=>R(L.filter((le,F)=>W!==F)),closeOnConfirm:!0})]})]},`trans-${W}`)})]})]})]})},Oo=e=>({labelCollapseDetails:(0,u.css)({marginLeft:e.spacing(2),...e.typography.bodySmall,fontStyle:"italic"}),transformationAction:(0,u.css)({marginBottom:e.spacing(2)}),transformationMeta:(0,u.css)({alignItems:"baseline"})});var Do=i(47454),Ao=i(90415),Me=i(96325),No=i(43956),Po=i(49990);function ko({width:e,height:s,timeZone:n,state:o,pluginId:r,frames:a,timeRange:l,splitOpenFn:p,eventBus:g}){const x=(0,No.d4)(r),h={dataLinkPostProcessor:(0,Po.h)(p,l),eventBus:g,eventsScope:"explore"};return(0,t.jsx)(Ao.XF,{value:h,children:(0,t.jsx)(Me.NR,{title:x.name,width:e,height:s,loadingState:o,children:(f,m)=>(0,t.jsx)(Do.m,{data:{series:a,state:o,timeRange:l},pluginId:r,title:"",width:f,height:m,timeZone:n})})})}var ce=i(52120),Mo=i(83736),Bo=i(39645),as=i(90333),Bt=i(98140),Ho=i(91536),$o=i(15773),is=i(53692),Se=i(81954),ls=i(87638),qs=i(89880),ot=i(3202),Ks=i(30468),Vo=i(85935),Zs=i(46924);function Wo(e){const{onClick:s,isSynced:n}=e,o=()=>{const{isSynced:r}=e,a=r?"Unsync all views":"Sync all views to this time range";return(0,t.jsx)(t.Fragment,{children:a})};return(0,t.jsx)(Z.m,{content:o,placement:"bottom",children:(0,t.jsx)(ce.I,{icon:"link",variant:n?"active":"canvas","aria-label":n?"Synced times":"Unsynced times",onClick:s})})}class zo extends c.Component{constructor(){super(...arguments),this.onMoveTimePicker=s=>{const{range:n,onChangeTime:o,timeZone:r}=this.props,{from:a,to:l}=(0,Zs.Wb)(s,n),p={from:(0,ot.oZ)(r,a),to:(0,ot.oZ)(r,l)};o(p)},this.onMoveForward=()=>this.onMoveTimePicker(1),this.onMoveBack=()=>this.onMoveTimePicker(-1),this.onChangeTimePicker=s=>{const n=Ks.isMathString(s.raw.from)?s.raw.from:s.from,o=Ks.isMathString(s.raw.to)?s.raw.to:s.to;this.props.onChangeTime({from:n,to:o}),(0,M.rR)("grafana_explore_time_picker_time_range_changed",{timeRangeFrom:n,timeRangeTo:o})},this.onZoom=()=>{const{range:s,onChangeTime:n,timeZone:o}=this.props,{from:r,to:a}=(0,Zs.Zk)(s,2),l={from:(0,ot.oZ)(o,r),to:(0,ot.oZ)(o,a)};n(l)}}render(){const{range:s,timeZone:n,fiscalYearStartMonth:o,splitted:r,syncedTimes:a,onChangeTimeSync:l,hideText:p,onChangeTimeZone:g,onChangeFiscalYearStartMonth:x}=this.props,d=r?(0,t.jsx)(Wo,{onClick:l,isSynced:a}):void 0,h={value:s,timeZone:n,fiscalYearStartMonth:o,onMoveBackward:this.onMoveBack,onMoveForward:this.onMoveForward,onZoom:this.onZoom,hideText:p};return(0,t.jsx)(Vo.m,{isOnCanvas:!0,...h,timeSyncButton:d,isSynced:a,widthOverride:r?window.innerWidth/2:void 0,onChange:this.onChangeTimePicker,onChangeTimeZone:g,onChangeFiscalYearStartMonth:x})}}var Ys=i(86634);function Qo(e){const s=(0,c.useRef)(null),{start:n,pause:o,resume:r,isLive:a,isPaused:l,stop:p,splitted:g}=e,x=a&&!l?"active":"canvas",d=a?l?r:o:n;return(0,t.jsxs)(as.e,{children:[(0,t.jsx)(Z.m,{content:a&&!l?(0,t.jsx)(t.Fragment,{children:"Pause the live stream"}):(0,t.jsx)(t.Fragment,{children:"Start live stream your logs"}),placement:"bottom",children:(0,t.jsx)(ce.I,{iconOnly:g,variant:x,icon:!a||l?"play":"pause",onClick:d,children:a&&l?"Paused":"Live"})}),(0,t.jsx)(Ys.A,{mountOnEnter:!0,unmountOnExit:!0,timeout:100,in:a,classNames:{enter:Ht.stopButtonEnter,enterActive:Ht.stopButtonEnterActive,exit:Ht.stopButtonExit,exitActive:Ht.stopButtonExitActive},nodeRef:s,children:(0,t.jsx)(Z.m,{content:(0,t.jsx)(t.Fragment,{children:"Stop and exit the live stream"}),placement:"bottom",children:(0,t.jsx)(ce.I,{ref:s,variant:x,onClick:p,icon:"square-shape"})})})]})}const Ht={stopButtonEnter:(0,u.css)({label:"stopButtonEnter",width:0,opacity:0,overflow:"hidden"}),stopButtonEnterActive:(0,u.css)({label:"stopButtonEnterActive",opacity:1,width:"32px"}),stopButtonExit:(0,u.css)({label:"stopButtonExit",width:"32px",opacity:1,overflow:"hidden"}),stopButtonExitActive:(0,u.css)({label:"stopButtonExitActive",opacity:0,width:0})};var rt=i(12049),We=i(19224),Uo=i(76795),xt=i(60232),$t=i(65552),Qe=i(97414);const Go={key:"copy-link",label:(0,v.t)("explore.toolbar.copy-shortened-link","Copy shortened URL"),icon:"share-alt",getUrl:()=>{},shorten:!0,absTime:!1};function qo(){const e=(0,D.useSelector)(X.Qb),[s,n]=(0,c.useState)(!1),[o,r]=(0,c.useState)(Go),a=(g,x,d)=>{g?((0,$t.VP)(d||i.g.location.href),(0,M.rR)("grafana_explore_shortened_link_clicked",{isAbsoluteTime:x})):((0,ht.uJ)(d!==void 0?`${window.location.protocol}//${window.location.host}${Q.$.appSubUrl}${d}`:i.g.location.href),(0,M.rR)("grafana_explore_copy_link_clicked",{isAbsoluteTime:x}))},l=[{key:"normal",label:(0,v.t)("explore.toolbar.copy-links-normal-category","Normal URL links"),items:[{key:"copy-shortened-link",icon:"link",label:(0,v.t)("explore.toolbar.copy-shortened-link","Copy shortened URL"),getUrl:()=>{},shorten:!0,absTime:!1},{key:"copy-link",icon:"link",label:(0,v.t)("explore.toolbar.copy-link","Copy URL"),getUrl:()=>{},shorten:!1,absTime:!1}]},{key:"timesync",label:(0,v.t)("explore.toolbar.copy-links-absolute-category","Time-sync URL links (share with time range intact)"),items:[{key:"copy-short-link-abs-time",icon:"clock-nine",label:(0,v.t)("explore.toolbar.copy-shortened-link-abs-time","Copy absolute shortened URL"),shorten:!0,getUrl:()=>(0,Qe._O)(e),absTime:!0},{key:"copy-link-abs-time",icon:"clock-nine",label:(0,v.t)("explore.toolbar.copy-link-abs-time","Copy absolute URL"),shorten:!1,getUrl:()=>(0,Qe._O)(e),absTime:!0}]}],p=(0,t.jsx)(We.W,{children:l.map(g=>(0,t.jsx)(Uo.r,{label:g.label,children:g.items.map(x=>(0,t.jsx)(We.W.Item,{label:x.label,icon:x.icon,onClick:()=>{const d=x.getUrl();a(x.shorten,x.absTime,d),r(x)}},x.key))},g.key))});return(0,t.jsxs)(as.e,{children:[(0,t.jsx)(ce.I,{tooltip:o.label,icon:o.icon,variant:"canvas",narrow:!0,onClick:()=>{const g=o.getUrl();a(o.shorten,o.absTime,g)},"aria-label":(0,v.t)("explore.toolbar.copy-shortened-link","Copy shortened URL"),children:(0,t.jsx)(v.x6,{i18nKey:"explore.toolbar.copy-shortened-link-label",children:"Share"})}),(0,t.jsx)(xt.m,{overlay:p,placement:"bottom-end",onVisibleChange:n,children:(0,t.jsx)(ce.I,{narrow:!0,variant:"canvas",isOpen:s,"aria-label":(0,v.t)("explore.toolbar.copy-shortened-link-menu","Open copy link options")})})]})}var Ko=i(93253),Zo=i(29012),Yo=i(22099),Js=i(47512),Xs=i(69531);const Jo=(0,c.lazy)(()=>i.e(733).then(i.bind(i,60733)).then(({AddToDashboard:e})=>({default:e})));function Xo(e){const{exploreId:s,links:n,setSelectedExtension:o,setIsModalOpen:r,isModalOpen:a,noQueriesInPane:l}=e;if(n.length<=1)return wt.TP.hasPermission(Js.w.DashboardsCreate)||wt.TP.hasPermission(Js.w.DashboardsWrite)?(0,t.jsx)(c.Suspense,{fallback:null,children:(0,t.jsx)(Jo,{exploreId:s})}):null;const p=(0,t.jsx)(Xs.w,{extensions:n,onSelect:o});return(0,t.jsx)(t.Fragment,{children:(0,t.jsx)(xt.m,{onVisibleChange:r,placement:"bottom-start",overlay:p,children:(0,t.jsx)(ce.I,{"aria-label":"Add",disabled:!l,variant:"canvas",isOpen:a,children:(0,t.jsx)(v.x6,{i18nKey:"explore.toolbar.add-to-extensions",children:"Add"})})})})}function _o(e){const{links:s,setSelectedExtension:n,setIsModalOpen:o,isModalOpen:r,noQueriesInPane:a}=e;if(s.length===0)return;const l=(0,t.jsx)(Xs.w,{extensions:s,onSelect:n});if(s.length===1){const p=(0,se.first)(s);return(0,t.jsx)(ce.I,{variant:"canvas",icon:p.icon,onClick:()=>n(p),children:(0,t.jsx)(v.x6,{i18nKey:"explore.toolbar.add-to-queryless-extensions",children:"Go queryless"})})}return(0,t.jsx)(t.Fragment,{children:(0,t.jsx)(xt.m,{onVisibleChange:o,placement:"bottom-start",overlay:l,children:(0,t.jsx)(ce.I,{"aria-label":"Go Queryless",disabled:!a,variant:"canvas",isOpen:r,children:(0,t.jsx)(v.x6,{i18nKey:"explore.toolbar.add-to-queryless-extensions",children:"Go queryless"})})})})}const _s=["grafana-pyroscope-app","grafana-lokiexplore-app","grafana-exploretraces-app"];function en(e){const{exploreId:s,extensionsToShow:n}=e,[o,r]=(0,c.useState)(),[a,l]=(0,c.useState)(!1),p=er(e),{links:g}=(0,Zo.U)({extensionPointId:Ko.S.ExploreToolbarAction,context:p,limitPerPlugin:3}),x=(0,X.qq)(s),d=!!(0,D.useSelector)(x)?.queries?.length,h=g.filter(m=>_s.includes(m.pluginId)),f=g.filter(m=>!_s.includes(m.pluginId));return(0,t.jsxs)(t.Fragment,{children:[n==="queryless"&&(0,t.jsx)(_o,{links:h,noQueriesInPane:d,exploreId:s,setSelectedExtension:m=>{r(m),(0,M.rR)("grafana_explore_queryless_app_link_clicked",{pluginId:m.pluginId})},setIsModalOpen:l,isModalOpen:a}),n==="basic"&&(0,t.jsx)(Xo,{links:f,noQueriesInPane:d,exploreId:s,setSelectedExtension:r,setIsModalOpen:l,isModalOpen:a}),!!o&&!!o.path&&(0,t.jsx)(Yo.s,{path:o.path,title:o.title,onDismiss:()=>r(void 0)})]})}function er(e){const{exploreId:s,timeZone:n}=e,r=(0,D.useSelector)(X.vC)?.editorMode||!1,{queries:a,queryResponse:l,range:p}=(0,D.useSelector)((0,X.qq)(s)),g=(0,D.useSelector)((0,X.Jr)(s)),x=a.map(f=>f?.datasource?.uid).filter(f=>f!==void 0),d=[...new Set(x)].length,h=wt.TP.hasPermission(D.AccessControlAction.DataSourcesWrite);return(0,c.useMemo)(()=>({exploreId:s,targets:a,data:l,timeRange:p.raw,timeZone:(0,Ms.O)({timeZone:n}),shouldShowAddCorrelation:Q.$.featureToggles.correlations===!0&&h&&!r&&g&&d===1}),[s,a,l,p.raw,n,h,r,g,d])}var je=i(45526);function tr(e){const s=(0,D.useDispatch)(),n=(0,c.useCallback)(()=>{s((0,Y.qk)({exploreId:e,isPaused:!0}))},[e,s]),o=(0,c.useCallback)(()=>{s((0,Y.qk)({exploreId:e,isPaused:!1}))},[e,s]),r=(0,c.useCallback)(()=>{n(),s((0,je.hO)({exploreId:e,refreshInterval:Bt.cC.offOption.value})),s((0,Y.Od)({exploreId:e}))},[e,s,n]),a=(0,c.useCallback)(()=>{s((0,je.hO)({exploreId:e,refreshInterval:Bt.cC.liveOption.value}))},[e,s]),l=(0,c.useCallback)(()=>{s((0,Y.rR)({exploreId:e}))},[e,s]);return{pause:n,resume:o,stop:r,start:a,clear:l}}function tn(e){const s=tr(e.exploreId);return e.children(s)}const sr=(e,s)=>({rotateIcon:(0,u.css)({"> div > svg":{transform:"rotate(180deg)"}}),toolbarButton:(0,u.css)({display:"flex",justifyContent:"center",marginRight:e.spacing(.5),width:s&&e.spacing(6)})});function nr({exploreId:e,onChangeTime:s,onContentOutlineToogle:n,isContentOutlineOpen:o}){const r=(0,Se.wA)(),a=(0,Se.d4)(X.pF),l=(0,k.of)(sr,a),p=(0,Se.d4)(E=>(0,Ot.O)(E.user)),g=(0,Se.d4)(E=>(0,Ot.q)(E.user)),{refreshInterval:x,datasourceInstance:d,range:h,isLive:f,isPaused:m,syncedTimes:j}=(0,Se.d4)(E=>({...(0,se.pick)(E.explore.panes[e],"refreshInterval","datasourceInstance","range","isLive","isPaused"),syncedTimes:E.explore.syncedTimes}),Re.shallowEqual),y=(0,Se.d4)((0,Y.h1)(e)),S=(0,Se.d4)(E=>E.explore.largerExploreId===e),b=(0,Se.d4)(E=>a||E.explore.panes[e].containerWidth<1210),L=(0,Se.d4)(E=>E.explore.panes[e].containerWidth<(a?700:800)),R=(0,Se.d4)(X.K6),C=(0,Se.d4)(X.vC),I=C?.editorMode||!1,T=(0,Se.d4)((0,X.Jr)(e)),{drawerOpened:O,setDrawerOpened:$}=(0,rt.sz)(),W=(0,c.useMemo)(()=>T&&S||!T&&!S,[T,S]),G=y?(0,v.t)("explore.toolbar.refresh-picker-cancel","Cancel"):(0,v.t)("explore.toolbar.refresh-picker-run","Run query"),P=async E=>{I?C?.correlationDirty||C?.queryEditorDirty?r((0,J.am)({isExiting:!0,postConfirmAction:{exploreId:e,action:is.IW.CHANGE_DATASOURCE,changeDatasourceUid:E.uid,isActionLeft:T}})):(T&&R.forEach(ue=>{r((0,Pe.nE)({exploreId:ue[0],correlationEditorHelperData:void 0}))}),r((0,$e.wh)({exploreId:e,datasource:E.uid,options:{importQueries:!0}}))):r((0,$e.wh)({exploreId:e,datasource:E.uid,options:{importQueries:!0}}))},ae=(E=!1)=>r(E?(0,Y.hS)(e):(0,Y.Od)({exploreId:e})),H=E=>r((0,qs.Cj)(E)),K=()=>{r((0,J.ve)()),(0,M.rR)("grafana_explore_split_view_opened",{origin:"menu"})},le=()=>{I?C?.correlationDirty||C?.queryEditorDirty?r((0,J.am)({isExiting:!0,postConfirmAction:{exploreId:e,action:is.IW.CLOSE_PANE,isActionLeft:T}})):(R.forEach(E=>{r((0,Pe.nE)({exploreId:E[0],correlationEditorHelperData:void 0}))}),r((0,J.J8)(e)),(0,M.rR)("grafana_explore_split_view_closed")):(r((0,J.J8)(e)),(0,M.rR)("grafana_explore_split_view_closed"))},F=()=>{r(S?(0,J.JA)():(0,J.tP)({exploreId:e}))},N=()=>{r((0,je.iO)(e))},V=E=>r((0,qs.c1)(E)),q=E=>{r((0,je.hO)({exploreId:e,refreshInterval:E}))},_=[(0,t.jsx)(ce.I,{variant:O?"active":"canvas","aria-label":(0,v.t)("explore.secondary-actions.query-history-button-aria-label","Query history"),onClick:()=>$(!O),"data-testid":tt.XF.QueryTab.queryHistoryButton,icon:"history",children:(0,t.jsx)(v.x6,{i18nKey:"explore.secondary-actions.query-history-button",children:"Query history"})},"query-history"),(0,t.jsx)(qo,{},"share")];return(0,t.jsxs)("div",{children:[x&&(0,t.jsx)(Mo.u,{func:ae,interval:x,loading:y}),(0,t.jsx)(Ho.H,{actions:_}),(0,t.jsx)(Bo.d,{"aria-label":(0,v.t)("explore.toolbar.aria-label","Explore toolbar"),leftItems:[(0,t.jsx)(ce.I,{variant:"canvas",tooltip:"Content outline",icon:"list-ui-alt",iconOnly:a,onClick:n,"aria-expanded":o,"aria-controls":o?"content-outline-container":void 0,className:l.toolbarButton,children:"Outline"},"content-outline"),(0,t.jsx)($o.s,{mixed:!I,onChange:P,current:d?.getRef(),hideTextValue:L,width:L?8:void 0},`${e}-ds-picker`),(0,t.jsx)(en,{exploreId:e,timeZone:p,extensionsToShow:"queryless"},"toolbar-extension-point")].filter(Boolean),forceShowLeftItems:!0,children:[a?(0,t.jsxs)(as.e,{children:[(0,t.jsx)(ce.I,{variant:"canvas",tooltip:S?(0,v.t)("explore.toolbar.split-narrow","Narrow pane"):(0,v.t)("explore.toolbar.split-widen","Widen pane"),onClick:F,icon:S?"gf-movepane-left":"gf-movepane-right",iconOnly:!0,className:(0,u.cx)(W&&l.rotateIcon)}),(0,t.jsx)(ce.I,{tooltip:(0,v.t)("explore.toolbar.split-close-tooltip","Close split pane"),onClick:le,icon:"times",variant:"canvas",children:(0,t.jsx)(v.x6,{i18nKey:"explore.toolbar.split-close",children:" Close "})})]},"split-controls"):(0,t.jsx)(ce.I,{variant:"canvas",tooltip:(0,v.t)("explore.toolbar.split-tooltip","Split the pane"),onClick:K,icon:"columns",disabled:f,children:(0,t.jsx)(v.x6,{i18nKey:"explore.toolbar.split-title",children:"Split"})},"split"),(0,t.jsx)(en,{exploreId:e,timeZone:p,extensionsToShow:"basic"},"toolbar-extension-point"),!f&&(0,t.jsx)(zo,{exploreId:e,range:h,timeZone:p,fiscalYearStartMonth:g,onChangeTime:s,splitted:a,syncedTimes:j,onChangeTimeSync:N,hideText:b,onChangeTimeZone:H,onChangeFiscalYearStartMonth:V},"timeControls"),(0,t.jsx)(Bt.cC,{onIntervalChanged:q,value:x,isLoading:y,text:b?void 0:G,tooltip:b?G:void 0,intervals:ls.TP.getValidIntervals(Bt.cb),isLive:f,onRefresh:()=>ae(y),noIntervalPicker:f,primary:!0,width:(b?35:108)+"px"},"refreshPicker"),d?.meta.streaming&&(0,t.jsx)(tn,{exploreId:e,children:E=>{const ue={...E,start:()=>{(0,M.rR)("grafana_explore_logs_live_tailing_clicked",{datasourceType:d?.type}),E.start()}};return(0,t.jsx)(Qo,{splitted:a,isLive:f,isPaused:m,start:ue.start,pause:ue.pause,resume:ue.resume,stop:ue.stop})}},"liveControls")].filter(Boolean)})]})}var Ue=i(16753),or=i(55085);function Vt(e,s={}){(0,M.rR)(`grafana_flamegraph_${e}`,{app:Ue.Jk.Unknown,grafana_version:Q.$.buildInfo.version,...s})}const rr=e=>{const s=(0,k.of)(n=>ar(n));return(0,t.jsx)("div",{className:s.container,children:(0,t.jsx)(or.A,{data:e.dataFrames[0],stickyHeader:!0,getTheme:()=>Q.$.theme2,onTableSymbolClick:()=>Vt("table_item_selected"),onViewSelected:n=>Vt("view_selected",{view:n}),onTextAlignSelected:n=>Vt("text_align_selected",{align:n}),onTableSort:n=>Vt("table_sort_selected",{sort:n})})})},ar=e=>({container:(0,u.css)({background:e.colors.background.primary,display:"flow-root",padding:e.spacing(0,1,1,1),border:`1px solid ${e.components.panel.borderColor}`,borderRadius:e.shape.radius.default})});var ir=i(8174),sn=i(84140),re=i(7500),cs=i(88090),lr=i(71490),cr=i(58134),Fe=i(48224),dr=i(10940),ur=i(40816);const nn=150,pr=({resetKey:e,humanize:s,className:n})=>{const[o,r]=(0,c.useState)(0);return(0,dr.A)(()=>r(o+nn),nn),(0,c.useEffect)(()=>r(0),[e]),(0,t.jsx)(ur.g,{timeInMs:o,className:n,humanize:s})};var gr=i(19658);const hr=e=>{const s=(0,u.keyframes)({from:{backgroundColor:(0,sn.A)(e.colors.info.transparent).setAlpha(.25).toString()},to:{backgroundColor:"transparent"}});return{logsRowsLive:(0,u.css)({label:"logs-rows-live",fontFamily:e.typography.fontFamilyMonospace,fontSize:e.typography.bodySmall.fontSize,display:"flex",flexFlow:"column nowrap",height:"60vh",overflowY:"scroll",":first-child":{marginTop:"auto !important"}}),logsRowFade:(0,u.css)({label:"logs-row-fresh",color:e.colors.text.primary,backgroundColor:(0,sn.A)(e.colors.info.transparent).setAlpha(.25).toString(),[e.transitions.handleMotion("no-preference","reduce")]:{animation:`${s} 1s ease-out 1s 1 normal forwards`}}),logsRowsIndicator:(0,u.css)({fontSize:e.typography.h6.fontSize,paddingTop:e.spacing(1),display:"flex",alignItems:"center"}),button:(0,u.css)({marginRight:e.spacing(1)}),fullWidth:(0,u.css)({width:"100%"})}};class fr extends c.PureComponent{constructor(s){super(s),this.liveEndDiv=null,this.scrollContainerRef=c.createRef(),this.onScroll=n=>{const{isPaused:o,onPause:r}=this.props,{scrollTop:a,clientHeight:l,scrollHeight:p}=n.currentTarget;p-(a+l)>=5&&!o&&r()},this.rowsToRender=()=>{const{isPaused:n}=this.props;let{logRowsToRender:o=[]}=this.state;return n||(o=(0,Fe.oR)(o,re.uH.Ascending).slice(-100)),o},this.state={logRowsToRender:s.logRows}}static getDerivedStateFromProps(s,n){return s.isPaused&&s.clearedAtIndex?{logRowsToRender:(0,gr.pg)(s.clearedAtIndex,n.logRowsToRender)}:s.isPaused?null:{logRowsToRender:s.logRows}}render(){const{theme:s,timeZone:n,onPause:o,onResume:r,onClear:a,isPaused:l}=this.props,p=hr(s),{logsRow:g,logsRowLocalTime:x,logsRowMessage:d}=(0,cr.D)(s);return(0,t.jsxs)("div",{children:[(0,t.jsx)("table",{className:p.fullWidth,children:(0,t.jsxs)("tbody",{onScroll:l?void 0:this.onScroll,className:p.logsRowsLive,ref:this.scrollContainerRef,children:[this.rowsToRender().map(h=>(0,t.jsxs)("tr",{className:(0,u.cx)(g,p.logsRowFade),children:[(0,t.jsx)("td",{className:x,children:(0,cs.LE)(h.timeEpochMs,{timeZone:n})}),(0,t.jsx)("td",{className:d,children:h.hasAnsi?(0,t.jsx)(lr.$,{value:h.raw}):h.entry})]},h.uid)),(0,t.jsx)("tr",{ref:h=>{this.liveEndDiv=h,this.liveEndDiv&&this.scrollContainerRef.current?.scrollTo&&!l&&this.scrollContainerRef.current?.scrollTo(0,this.scrollContainerRef.current.scrollHeight)}})]})}),(0,t.jsxs)("div",{className:p.logsRowsIndicator,children:[(0,t.jsx)(B.$n,{icon:l?"play":"pause",variant:"secondary",onClick:l?r:o,className:p.button,children:l?"Resume":"Pause"}),(0,t.jsx)(B.$n,{icon:"trash-alt",variant:"secondary",onClick:a,className:p.button,children:"Clear logs"}),(0,t.jsx)(B.$n,{icon:"square-shape",variant:"secondary",onClick:this.props.stopLive,className:p.button,children:"Exit live mode"}),l||this.rowsToRender().length>0&&(0,t.jsxs)("span",{children:["Last line received: ",(0,t.jsx)(pr,{resetKey:this.props.logRows,humanize:!0})," ago"]})]})]})}}const mr=(0,k.cV)(fr);var on=i(84596),xr=i(59577),rn=i(35383),an=i(93407),Wt=i(60641),yr=i(77222),Ee=i(60484),Ge=i(29010),vr=i(9733),ge=i(82856),br=i(88231),ln=i(10069),Cr=i(59878),Sr=i(40297),cn=i(94730),at=i(55909),zt=i(24694),jr=i(36745),yt=i(83394);function Tr(){(0,M.rR)("explore_toolbar_contentoutline_clicked",{item:"section",type:"Logs:pinned:pinned-log-added"})}function Rr(){(0,M.rR)("explore_toolbar_contentoutline_clicked",{item:"section",type:"Logs:pinned:pinned-log-deleted"})}function Lr(){(0,M.rR)("explore_toolbar_contentoutline_clicked",{item:"section",type:"Logs:pinned:pinned-log-limit-reached"})}function Ir(){(0,M.rR)("explore_toolbar_contentoutline_clicked",{item:"section",type:"Logs:pinned:pinned-log-clicked"})}function wr(){(0,M.rR)("explore_toolbar_contentoutline_clicked",{item:"section",type:"Logs:pinned:pinned-log-deleted"})}function Fr(e){(0,M.rR)("explore_toolbar_contentoutline_clicked",{item:"section",type:`Logs:filter:${e.levelStr}`})}var dn=i(9904);function Er({feedbackUrl:e}){const s=(0,k.of)(Or);return(0,t.jsx)(A.B,{children:(0,t.jsxs)("a",{href:e,className:s.link,title:"The logs table is new, please let us know how we can improve it",target:"_blank",rel:"noreferrer noopener",children:[(0,t.jsx)(U.I,{name:"comment-alt-message"})," Give feedback"]})})}function Or(e){return{link:(0,u.css)({color:e.colors.text.secondary,fontSize:e.typography.bodySmall.fontSize,":hover":{color:e.colors.text.link}})}}var Dr=i(4213),Ar=i.n(Dr),un=i(75505),pn=i(54092),gn=i(53569),hn=i(28445),Nr=i(96877);const fn=e=>({metaContainer:(0,u.css)({flex:1,color:e.colors.text.secondary,marginBottom:e.spacing(2),minWidth:"30%",display:"flex",flexWrap:"wrap"}),metaItem:(0,u.css)({marginRight:e.spacing(2),marginTop:e.spacing(.5),display:"flex",alignItems:"center",".logs-meta-item__error":{color:e.colors.error.text}}),metaLabel:(0,u.css)({marginRight:`calc(${e.spacing(2)} / 2)`,fontSize:e.typography.bodySmall.fontSize,fontWeight:e.typography.fontWeightMedium}),metaValue:(0,u.css)({fontFamily:e.typography.fontFamilyMonospace,fontSize:e.typography.bodySmall.fontSize})}),Pr=(0,c.memo)(function(s){const n=(0,k.of)(fn),{label:o,value:r}=s;return(0,t.jsxs)("div",{"data-testid":"meta-info-text-item",className:n.metaItem,children:[o&&(0,t.jsxs)("span",{className:n.metaLabel,children:[o,":"]}),(0,t.jsx)("span",{className:n.metaValue,children:r})]})}),ds=(0,c.memo)(function(s){const n=(0,k.of)(fn),{metaItems:o}=s;return(0,t.jsx)("div",{className:n.metaContainer,"data-testid":"meta-info-text",children:o.map((r,a)=>(0,t.jsx)(Pr,{label:r.label,value:r.value},`${a}-${r.label}`))})});var mn=i(4038),Qt=i(47286),vt=i(63739),xn=i(47370),us=i(32991);function kr(e){const{timeZone:s,splitOpen:n,range:o,logsSortOrder:r,width:a,dataFrame:l,columnsWithMeta:p,logsFrame:g}=e,[x,d]=(0,c.useState)(void 0),h=g?.timeField.index,f=(0,c.useCallback)(j=>{if(!j.length)return j;const y=(0,mn.ES)(j,h,r===re.uH.Descending),[S]=(0,Qt.we)({data:[y],timeZone:s,theme:Q.$.theme2,replaceVariables:b=>b,fieldConfig:{defaults:{custom:{}},overrides:[]}});for(const b of S.fields)b.getLinks=L=>(0,Qe.QL)({field:b,rowIndex:L.valueRowIndex,splitOpenFn:n,range:o,dataFrame:y}),b.config={...b.config,custom:{inspect:!0,filterable:!0,width:$r(b),...b.config.custom},filterable:Mr(b,g?.bodyField.name??"",g?.timeField.name??"")},b.type=b.type===vt.PU.string?(0,mn.dF)(b)??vt.PU.string:b.type;return S},[r,s,n,o,g?.bodyField.name,g?.timeField.name,h]);if((0,c.useEffect)(()=>{(async()=>{if(!g?.timeField.name||!g?.bodyField.name){d(void 0);return}const y=yn(l);let S=Br(p);const b=Hr(S);if(b?y.push(b):y.push({id:"organize",options:{indexByName:{[g.bodyField.name]:0,[g.timeField.name]:1},includeByName:{[g.bodyField.name]:!0,[g.timeField.name]:!0}}}),y.length>0){const L=await(0,un.s)((0,pn.m)(y,[l])),R=f(L[0]);d(R)}else d(f(l))})()},[p,l,r,f,g?.bodyField.name,g?.timeField.name]),!x)return null;const m=j=>{const{value:y,key:S,operator:b}=j,{onClickFilterLabel:L,onClickFilterOutLabel:R}=e;!L||!R||(b===Et.mc&&L(S,y,l),b===Et.Zi&&R(S,y,l))};return(0,t.jsx)(us.X,{data:x,width:a,onCellFilterAdded:e.onClickFilterLabel&&e.onClickFilterOutLabel?m:void 0,height:e.height,footerOptions:{show:!0,reducer:["count"],countRows:!0},initialSortBy:[{displayName:g?.timeField.name||"",desc:r===re.uH.Descending}]})}const Mr=(e,s,n)=>!(!s||!n||s===e.name||n===e.name||e.config.links?.length);function yn(e){return e.fields.filter(s=>{const n=s.typeInfo?.frame==="json.RawMessage"&&s.name==="labels"&&e?.meta?.type!==xn.m.LogLines,o=s.name==="labels"&&s.type===vt.PU.other&&e?.meta?.type===xn.m.LogLines;return n||o}).flatMap(s=>[{id:"extractFields",options:{format:"json",keepTime:!1,replace:!1,source:s.name}}])}function Br(e){let s={};return Object.keys(e).filter(n=>e[n].active).forEach(n=>{const o=e[n].index;o!==void 0&&(s[n]=o)}),s}function Hr(e){let s={};for(const n in e)s[n]=!0;return Object.keys(e).length>0?{id:"organize",options:{indexByName:e,includeByName:s}}:null}function $r(e){if(e.type===vt.PU.time)return 200}const Vr=()=>({metaContainer:(0,u.css)({flex:1,display:"flex",flexWrap:"wrap"})});var Wr=(e=>(e.Text="text",e.Json="json",e.CSV="csv",e))(Wr||{});const vn=(0,c.memo)(({meta:e,dedupStrategy:s,dedupCount:n,displayedFields:o,clearDetectedFields:r,hasUnescapedContent:a,forceEscape:l,onEscapeNewlines:p,logRows:g})=>{const x=(0,k.of)(Vr),d=async m=>{switch((0,M.rR)("grafana_logs_download_logs_clicked",{app:Ue.Jk.Explore,format:m,area:"logs-meta-row"}),m){case"text":(0,gn.Zy)({meta:e,rows:g},"Explore");break;case"json":const j=(0,Fe.Dg)(g),y=new Blob([JSON.stringify(j)],{type:"application/json;charset=utf-8"}),S=`Explore-logs-${(0,cs.LE)(new Date)}.json`;Ar()(y,S);break;case"csv":const b=new Map;g.forEach(L=>{L.dataFrame?.refId&&!b.has(L.dataFrame?.refId)&&b.set(L.dataFrame?.refId,L.dataFrame)}),b.forEach(async L=>{const R=yn(L);R.push({id:"organize",options:{excludeByName:{labels:!0,labelTypes:!0}}});const C=await(0,un.s)((0,pn.m)(R,[L]));(0,gn.EM)(C[0],`Explore-logs-${L.refId}`)})}},h=[...e];s!==re.fY.none&&h.push({label:"Deduplication count",value:n,kind:oe.tG.Number}),g.some(m=>m.entry.length>Nr.S)&&h.push({label:"Info",value:"Logs with more than 100,000 characters could not be parsed and highlighted",kind:oe.tG.String}),o?.length>0&&h.push({label:"Showing only selected fields",value:(0,t.jsx)(hn.A,{labels:o})},{label:"",value:(0,t.jsx)(B.$n,{variant:"primary",fill:"outline",size:"sm",onClick:r,children:"Show original line"})}),a&&h.push({label:"Your logs might have incorrectly escaped content",value:(0,t.jsx)(Z.m,{content:"Fix incorrectly escaped newline and tab sequences in log lines. Manually review the results to confirm that the replacements are correct.",placement:"right",children:(0,t.jsx)(B.$n,{variant:"secondary",size:"sm",onClick:p,children:l?"Remove escaping":"Escape newlines"})})});const f=(0,t.jsxs)(We.W,{children:[(0,t.jsx)(We.W.Item,{label:"txt",onClick:()=>d("text")}),(0,t.jsx)(We.W.Item,{label:"json",onClick:()=>d("json")}),(0,t.jsx)(We.W.Item,{label:"csv",onClick:()=>d("csv")})]});return(0,t.jsx)(t.Fragment,{children:h&&(0,t.jsxs)("div",{className:x.metaContainer,children:[(0,t.jsx)(ds,{metaItems:h.map(m=>({label:m.label,value:"kind"in m?zr(m.value,m.kind):m.value}))}),!Q.$.exploreHideLogsDownload&&(0,t.jsx)(xt.m,{overlay:f,children:(0,t.jsx)(ce.I,{isOpen:!1,variant:"canvas",icon:"download-alt",children:"Download"})})]})})});vn.displayName="LogsMetaRow";function zr(e,s){return typeof e=="string"||typeof e=="number"?(0,t.jsx)(t.Fragment,{children:e}):s===oe.tG.LabelsMap?(0,t.jsx)(hn.h,{labels:e}):s===oe.tG.Error?(0,t.jsx)("span",{className:"logs-meta-item__error",children:e.toString()}):(console.error(`Meta type ${typeof e} ${e} not recognized.`),(0,t.jsx)(t.Fragment,{}))}var ps=i(20968),Qr=i(71149),Ur=i(90168);function Gr({pages:e,currentPageIndex:s,oldestLogsFirst:n,timeZone:o,loading:r,onClick:a}){const l=d=>`${(0,cs.LE)(d,{format:Ur.WC.interval.second,timeZone:o})}`,p=(d,h)=>{if(s===h&&r)return(0,t.jsx)(ps.y,{});const f=l(n?d.logsRange.from:d.logsRange.to),m=l(n?d.logsRange.to:d.logsRange.from);return`${f} \u2014 ${m}`},g=(0,k.$j)(),x=qr(g,r);return(0,t.jsx)(_t.P,{children:(0,t.jsx)("div",{className:x.pagesWrapper,"data-testid":"logsNavigationPages",children:(0,t.jsx)("div",{className:x.pagesContainer,children:e.map((d,h)=>(0,t.jsxs)("button",{type:"button","data-testid":`page${h+1}`,className:(0,u.cx)((0,B.my)(g),x.page),onClick:()=>{a(d,h+1)},disabled:r,children:[(0,t.jsx)("div",{className:(0,u.cx)(x.line,{selectedBg:s===h})}),(0,t.jsx)("div",{className:(0,u.cx)(x.time,{selectedText:s===h}),children:p(d,h)})]},d.queryRange.to))})})})}const qr=(e,s)=>({pagesWrapper:(0,u.css)({height:"100%",paddingLeft:e.spacing(.5),display:"flex",flexDirection:"column","&::after":{content:"''",display:"block",background:`repeating-linear-gradient(135deg, ${e.colors.background.primary}, ${e.colors.background.primary} 5px, ${e.colors.background.secondary} 5px, ${e.colors.background.secondary} 15px)`,width:"3px",height:"inherit",marginBottom:e.spacing(1)}}),pagesContainer:(0,u.css)({display:"flex",padding:0,flexDirection:"column"}),page:(0,u.css)({display:"flex",margin:e.spacing(2,0),cursor:s?"auto":"pointer",whiteSpace:"normal",".selectedBg":{background:e.colors.primary.main},".selectedText":{color:e.colors.primary.main}}),line:(0,u.css)({width:"3px",height:"100%",alignItems:"center",background:e.colors.text.secondary}),time:(0,u.css)({width:"60px",minHeight:"80px",fontSize:e.v1.typography.size.sm,paddingLeft:e.spacing(.5),display:"flex",alignItems:"center"})});function Kr({absoluteRange:e,logsSortOrder:s,timeZone:n,loading:o,onChangeTime:r,scrollToTopLogs:a,scrollToBottomLogs:l,visibleRange:p,queries:g,clearCache:x,addResultsToCache:d}){const[h,f]=(0,c.useState)([]),m=(0,c.useRef)(),j=(0,c.useRef)(),y=(0,c.useRef)(0),S=(0,c.useMemo)(()=>h.findIndex(H=>H.queryRange.to===e.to),[e.to,h]),b=s===re.uH.Ascending,L=b?S===h.length-1:S===0,R=b?S===0:S===h.length-1,C=(0,k.$j)(),I=Zr(C,b);(0,c.useEffect)(()=>{const H={logsRange:p,queryRange:e};let K=[];!(0,se.isEqual)(j.current,e)||!(0,se.isEqual)(m.current,g)?(x(),f([H]),m.current=g,y.current=e.to-e.from):f(le=>(K=le.filter(F=>!(0,se.isEqual)(H.queryRange,F.queryRange)),K=[...K,H].sort((F,N)=>O(F,N,s)),K))},[p,e,s,g,x,d]);const T=(0,c.useCallback)(({from:H,to:K})=>{d(),j.current={from:H,to:K},r({from:H,to:K})},[r,d]),O=(H,K,le)=>le===re.uH.Ascending?H.queryRange.to>K.queryRange.to?1:-1:H.queryRange.to>K.queryRange.to?-1:1,$=(0,t.jsx)(B.$n,{"data-testid":"olderLogsButton",className:I.navButton,variant:"secondary",onClick:()=>{if((0,M.rR)("grafana_explore_logs_pagination_clicked",{pageType:"olderLogsButton"}),R)T({from:p.from-y.current,to:p.from});else{const H=b?-1:1;T({from:h[S+H].queryRange.from,to:h[S+H].queryRange.to})}a()},disabled:o,children:(0,t.jsxs)("div",{className:I.navButtonContent,children:[o?(0,t.jsx)(ps.y,{}):(0,t.jsx)(U.I,{name:b?"angle-up":"angle-down",size:"lg"}),(0,t.jsx)(v.x6,{i18nKey:"logs.logs-navigation.older-logs",children:"Older logs"})]})}),W=(0,t.jsx)(B.$n,{"data-testid":"newerLogsButton",className:I.navButton,variant:"secondary",onClick:()=>{if((0,M.rR)("grafana_explore_logs_pagination_clicked",{pageType:"newerLogsButton"}),!L){const H=b?1:-1;T({from:h[S+H].queryRange.from,to:h[S+H].queryRange.to})}a()},disabled:o||L,children:(0,t.jsxs)("div",{className:I.navButtonContent,children:[o&&(0,t.jsx)(ps.y,{}),L||o?null:(0,t.jsx)(U.I,{name:b?"angle-down":"angle-up",size:"lg"}),L?(0,v.t)("logs.logs-navigation.start-of-range","Start of range"):(0,v.t)("logs.logs-navigation.newer-logs","Newer logs")]})}),G=(0,c.useCallback)((H,K)=>{(0,M.rR)("grafana_explore_logs_pagination_clicked",{pageType:"page",pageNumber:K}),T({from:H.queryRange.from,to:H.queryRange.to}),a()},[T,a]),P=(0,c.useCallback)(()=>{(0,M.rR)("grafana_explore_logs_scroll_top_clicked"),a()},[a]),ae=(0,c.useCallback)(()=>{(0,M.rR)("grafana_explore_logs_scroll_bottom_clicked"),l?.()},[l]);return(0,t.jsxs)("div",{className:I.navContainer,children:[!Q.$.featureToggles.logsInfiniteScrolling&&(0,t.jsxs)(t.Fragment,{children:[b?$:W,(0,t.jsx)(Gr,{pages:h,currentPageIndex:S,oldestLogsFirst:b,timeZone:n,loading:o,onClick:G}),b?W:$]}),l&&(0,t.jsx)(B.$n,{"data-testid":"scrollToBottom",className:I.scrollToBottomButton,variant:"secondary",onClick:ae,title:(0,v.t)("logs.logs-navigation.scroll-bottom","Scroll to bottom"),children:(0,t.jsx)(U.I,{name:"arrow-down",size:"lg"})}),(0,t.jsx)(B.$n,{"data-testid":"scrollToTop",className:I.scrollToTopButton,variant:"secondary",onClick:P,title:(0,v.t)("logs.logs-navigation.scroll-top","Scroll to top"),children:(0,t.jsx)(U.I,{name:"arrow-up",size:"lg"})})]})}const bn=(0,c.memo)(Kr),Zr=(e,s)=>{const n=`calc(100vh - 2*${e.spacing(2)} - 2*${Qr.l}px)`;return{navContainer:(0,u.css)({maxHeight:n,width:s?"58px":"auto",display:"flex",flexDirection:"column",justifyContent:Q.$.featureToggles.logsInfiniteScrolling?"flex-end":s?"flex-start":"space-between",position:"sticky",top:e.spacing(2),right:0}),navButton:(0,u.css)({width:"58px",height:"68px",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",lineHeight:1}),navButtonContent:(0,u.css)({display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",width:"100%",height:"100%",whiteSpace:"normal"}),scrollToBottomButton:(0,u.css)({width:"40px",height:"40px",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",position:"absolute",top:0}),scrollToTopButton:(0,u.css)({width:"40px",height:"40px",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",marginTop:e.spacing(1)})}};var Cn=i(33504);function Yr(e){return{searchWrap:(0,u.css)({padding:`${e.spacing(.4)} 0 ${e.spacing(.4)} ${e.spacing(.4)}`})}}function Jr(e){const s=(0,k.$j)(),n=Yr(s);return(0,t.jsx)(ke.D,{className:n.searchWrap,children:(0,t.jsx)(mt.p,{value:e.value,type:"text",placeholder:"Search fields by name",onChange:e.onChange})})}var gs=i(57095);function Xr(e){return{empty:(0,u.css)({marginBottom:e.spacing(2),marginLeft:e.spacing(1.75),fontSize:e.typography.fontSize})}}function Sn(){const e=(0,k.$j)(),s=Xr(e);return(0,t.jsx)("div",{className:s.empty,children:"No fields"})}var _r=i(81942);function ea(e){return{dragIcon:(0,u.css)({cursor:"drag",marginLeft:e.spacing(1),opacity:.4}),labelCount:(0,u.css)({marginLeft:e.spacing(.5),marginRight:e.spacing(.5),appearance:"none",background:"none",border:"none",fontSize:e.typography.pxToRem(11),opacity:.6}),contentWrap:(0,u.css)({display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%"}),checkboxLabel:(0,u.css)({"> span":{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",display:"block",maxWidth:"100%"}})}}function jn(e){const s=(0,k.$j)(),n=ea(s);if(e.labels[e.label])return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:n.contentWrap,children:[(0,t.jsx)(_r.S,{className:n.checkboxLabel,label:e.label,onChange:e.onChange,checked:e.labels[e.label]?.active??!1}),e.showCount&&(0,t.jsxs)("button",{className:n.labelCount,onClick:e.onChange,children:[e.labels[e.label]?.percentOfLinesWithLabel,"%"]})]}),e.draggable&&(0,t.jsx)(U.I,{"aria-label":"Drag and drop icon",title:"Drag and drop to reorder",name:"draggabledots",size:"lg",className:n.dragIcon})]})}function Tn(e){return{wrap:(0,u.css)({marginTop:e.spacing(1),marginBottom:e.spacing(1),display:"flex",background:e.colors.background.primary}),dragging:(0,u.css)({background:e.colors.background.secondary}),columnWrapper:(0,u.css)({marginBottom:e.spacing(1.5),paddingLeft:e.spacing(.5)})}}function ta(e){return(s,n)=>{const o=e[s],r=e[n];return o.index!=null&&r.index!=null?o.index-r.index:0}}const sa=e=>{const{reorderColumn:s,labels:n,valueFilter:o,toggleColumn:r}=e,a=(0,k.$j)(),l=Tn(a),p=Object.keys(n).filter(d=>o(d)),g=d=>{d.destination&&s(d.source.index,d.destination.index)},x=d=>{const h=n[d];if(h)return`${d} appears in ${h?.percentOfLinesWithLabel}% of log lines`};return p.length?(0,t.jsx)(gs.DragDropContext,{onDragEnd:g,children:(0,t.jsx)(gs.Droppable,{droppableId:"order-fields",direction:"vertical",children:d=>(0,t.jsxs)("div",{className:l.columnWrapper,...d.droppableProps,ref:d.innerRef,children:[p.sort(ta(n)).map((h,f)=>(0,t.jsx)(gs.Draggable,{draggableId:h,index:f,children:(m,j)=>(0,t.jsx)("div",{className:(0,u.cx)(l.wrap,j.isDragging?l.dragging:void 0),ref:m.innerRef,...m.draggableProps,...m.dragHandleProps,title:x(h),children:(0,t.jsx)(jn,{label:h,onChange:()=>r(h),labels:n,draggable:!0})})},h)),d.placeholder]})})}):(0,t.jsx)(Sn,{})},na=new Intl.Collator(void 0,{sensitivity:"base"});function oa(e){return(s,n)=>{const o=e[s],r=e[n];return o!=null&&r!=null?+(r.type==="TIME_FIELD")-+(o.type==="TIME_FIELD")||+(r.type==="BODY_FIELD")-+(o.type==="BODY_FIELD")||na.compare(s,n):0}}const ra=e=>{const{labels:s,valueFilter:n,toggleColumn:o}=e,r=(0,k.$j)(),a=Tn(r),l=Object.keys(s).filter(p=>n(p));return l.length?(0,t.jsx)("div",{className:a.columnWrapper,children:l.sort(oa(s)).map((p,g)=>(0,t.jsx)("div",{className:a.wrap,title:`${p} appears in ${s[p]?.percentOfLinesWithLabel}% of log lines`,children:(0,t.jsx)(jn,{showCount:!0,label:p,onChange:()=>o(p),labels:s})},p))}):(0,t.jsx)(Sn,{})};function aa(e){return{sidebarWrap:(0,u.css)({overflowY:"scroll",height:"calc(100% - 50px)","&::-webkit-scrollbar":{display:"none"},scrollbarWidth:"none"}),columnHeaderButton:(0,u.css)({appearance:"none",background:"none",border:"none",fontSize:e.typography.pxToRem(11)}),columnHeader:(0,u.css)({display:"flex",justifyContent:"space-between",fontSize:e.typography.h6.fontSize,background:e.colors.background.secondary,position:"sticky",top:0,left:0,paddingTop:e.spacing(.75),paddingRight:e.spacing(.75),paddingBottom:e.spacing(.75),paddingLeft:e.spacing(1.5),zIndex:3,marginBottom:e.spacing(2)})}}const ia=e=>{const s=(0,k.$j)(),n=aa(s);return(0,t.jsx)("div",{className:n.sidebarWrap,children:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:n.columnHeader,children:["Selected fields",(0,t.jsx)("button",{onClick:e.clear,className:n.columnHeaderButton,children:"Reset"})]}),(0,t.jsx)(sa,{reorderColumn:e.reorderColumn,toggleColumn:e.toggleColumn,labels:e.filteredColumnsWithMeta??e.columnsWithMeta,valueFilter:o=>e.columnsWithMeta[o]?.active??!1,id:"selected-fields"}),(0,t.jsx)("div",{className:n.columnHeader,children:"Fields"}),(0,t.jsx)(ra,{toggleColumn:e.toggleColumn,labels:e.filteredColumnsWithMeta??e.columnsWithMeta,valueFilter:o=>!e.columnsWithMeta[o]?.active})]})})};var Rn=i(84139);const la=new Rn.A({intraMode:1,intraIns:1,intraSub:1,intraTrn:1,intraDel:1});function Ln(e,s,n){const[o,r,a]=la.search(e,s,0,1e5);let l=[],p=new Set;if(o&&a){const g=(x,d)=>{d&&p.add(x)};for(let x=0;x<a.length;x++){let d=a[x];Rn.A.highlight(e[r.idx[d]],r.ranges[d],g),l.push(e[r.idx[d]])}n([l,[...p]])}else s||n([[],[]])}const _l=(0,se.debounce)(Ln,300);function ca(e){const{logsFrames:s,updatePanelState:n,panelState:o}=e,r=o?.columns,[a,l]=(0,c.useState)(void 0),[p,g]=(0,c.useState)(void 0),[x,d]=(0,c.useState)(""),h=In(),f=e?.panelState?.refId,[m,j]=(0,c.useState)(s.find(F=>F.refId===f)??s[0]),y=(0,c.useCallback)(F=>{const N=e.panelState?.columns;return N&&Object.values(N).forEach((V,q)=>{F[V]&&(F[V].active=!0,F[V].index=q)}),F},[e.panelState?.columns]),S=(0,Cn.Os)(m);(0,c.useEffect)(()=>{if(S?.timeField.name&&S?.bodyField.name&&!r){const F={0:S?.timeField.name??"",1:S?.bodyField.name??""};n({columns:Object.values(F),visualisationType:"table",labelFieldName:S?.getLabelFieldName()??void 0})}},[S,r,n]),(0,c.useEffect)(()=>{const F=s.find(N=>N.refId===f)??s[0];F&&j(F)},[s,f]),(0,c.useEffect)(()=>{if(!a||!p)return;let F={...p},N=!1;Object.keys(a).forEach(V=>{F[V]&&F[V].active!==a[V].active&&(F[V]=a[V],N=!0)}),N&&g(F)},[a,p]),(0,c.useEffect)(()=>{if(!m.length)return;const F=m?m.length:0,N=(0,Cn.Os)(m),V=N?.getLogFrameLabelsAsLabels(),q=[];N&&q.push(...N.extraFields.filter(ie=>!ie?.config?.custom?.hidden)),N?.severityField&&q.push(N?.severityField),N?.bodyField&&q.push(N?.bodyField),N?.timeField&&q.push(N?.timeField);const _=new Map;let E={};V?.length&&F&&(V.forEach(ie=>{Object.keys(ie).forEach(fe=>{if(_.has(fe)){const ye=_.get(fe);ye&&(ye?.active?_.set(fe,{percentOfLinesWithLabel:ye.percentOfLinesWithLabel+1,active:!0,index:ye.index}):_.set(fe,{percentOfLinesWithLabel:ye.percentOfLinesWithLabel+1,active:!1,index:void 0}))}else _.set(fe,{percentOfLinesWithLabel:1,active:!1,index:void 0})})}),E=Object.fromEntries(_),Object.keys(E).forEach(ie=>{E[ie].percentOfLinesWithLabel=hs(E[ie].percentOfLinesWithLabel,F)})),q.forEach(ie=>{const Ze=E[ie.name]?.active,fe=E[ie.name]?.index;Ze&&fe!==void 0?E[ie.name]={percentOfLinesWithLabel:hs(ie.values.filter(ye=>ye!=null).length,F),active:!0,index:fe}:E[ie.name]={percentOfLinesWithLabel:hs(ie.values.filter(ye=>ye!=null).length,F),active:!1,index:void 0}}),E=y(E),Object.keys(E).filter(ie=>E[ie].active).length===0&&(N?.bodyField?.name&&(E[N.bodyField.name].active=!0),N?.timeField?.name&&(E[N.timeField.name].active=!0)),N?.bodyField?.name&&N?.timeField?.name&&(E[N.bodyField.name].type="BODY_FIELD",E[N.timeField.name].type="TIME_FIELD"),l(E)},[m,y]);const[b,L]=(0,c.useState)(220),R=e.width-b;if(!a)return null;function C(F){if(a){const N=!a[F]?.active,V=Object.keys(a).filter(_=>a[_]?.active)?.length,q={columnAction:N?"add":"remove",columnCount:N?V+1:V-1,datasourceType:e.datasourceType};(0,M.rR)("grafana_explore_logs_table_column_filter_clicked",q)}}function I(F){(0,M.rR)("grafana_explore_logs_table_text_search_result_count",{resultCount:F,datasourceType:e.datasourceType??"unknown"})}const T=()=>{const F={...a};let N=0;Object.keys(F).forEach(V=>{const q=!!F[V].type;F[V].active=q,F[V].index=q?N++:void 0}),l(F)},O=(F,N)=>{if(F===N)return;const V={...a},q=Object.keys(V).filter(E=>V[E].active).map(E=>({fieldName:E,index:V[E].index??0})).sort((E,ue)=>E.index-ue.index),[_]=q.splice(F,1);q.splice(N,0,_),q.forEach((E,ue)=>{V[E.fieldName].index=ue}),l(V),$(V)};function $(F){const N=Object.keys(F).filter(E=>F[E]?.active).sort((E,ue)=>{const ie=F[E],Ze=F[ue];return ie.index!==void 0&&Ze.index!==void 0?ie.index-Ze.index:0}),V=Object.assign({},N),q={0:S?.timeField.name??"",1:S?.bodyField.name??""},_={...e.panelState,columns:Object.keys(V).length?V:q,refId:m.refId,visualisationType:"table",labelFieldName:S?.getLabelFieldName()??void 0};n(_)}const W=F=>{if(!a||!(F in a)){console.warn("failed to get column",a);return}const N=Object.keys(a).filter(_=>a[_].active).length,V=a[F].active?void 0:!0;let q;if(V?q={...a,[F]:{...a[F],active:V,index:N}}:q={...a,[F]:{...a[F],active:!1,index:void 0}},C(F),l(q),p){const _=!p[F]?.active;let E;_?E={...p,[F]:{...p[F],active:_,index:N}}:E={...p,[F]:{...p[F],active:!1,index:void 0}},g(E)}$(q)},G=F=>{const N=F[0];let V={},q=0;N.forEach(_=>{_ in a&&(V[_]=a[_],q++)}),g(V),I(q)},P=F=>{Ln(Object.keys(a),F,G)},ae=F=>{const N=F.currentTarget?.value;d(N),N?P(N):g(void 0)},H=F=>{s.find(V=>V.refId===F.value)&&j(s.find(V=>V.refId===F.value)??s[0]),e.updatePanelState({refId:F.value,labelFieldName:S?.getLabelFieldName()??void 0})},K=da(e.theme,h,b),le=(F,N,V)=>{const q=Number(V.style.width.slice(0,-2));isNaN(q)||L(q)};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{children:s.length>1&&(0,t.jsx)("div",{children:(0,t.jsx)(Ee.I,{label:"Select query",htmlFor:"explore_logs_table_frame_selector",labelWidth:22,tooltip:"Select a query to visualize in the table.",children:(0,t.jsx)(Ve.l6,{inputId:"explore_logs_table_frame_selector","aria-label":"Select query by name",value:m.refId,options:s.map(F=>({label:F.refId,value:F.refId})),onChange:H})})})}),(0,t.jsxs)("div",{className:K.wrapper,children:[(0,t.jsx)(Ps.c,{enable:{right:!0},handleClasses:{right:K.rzHandle},onResize:le,children:(0,t.jsxs)("section",{className:K.sidebar,children:[(0,t.jsx)(Jr,{value:x,onChange:ae}),(0,t.jsx)(ia,{reorderColumn:O,toggleColumn:W,filteredColumnsWithMeta:p,columnsWithMeta:a,clear:T})]})}),(0,t.jsx)(kr,{logsFrame:S,onClickFilterLabel:e.onClickFilterLabel,onClickFilterOutLabel:e.onClickFilterOutLabel,logsSortOrder:e.logsSortOrder,range:e.range,splitOpen:e.splitOpen,timeZone:e.timeZone,width:R,dataFrame:m,columnsWithMeta:a,height:h})]})]})}const hs=(e,s)=>Math.ceil(100*e/s);function da(e,s,n){return{wrapper:(0,u.css)({display:"flex"}),sidebar:(0,u.css)({height:s,fontSize:e.typography.pxToRem(11),overflowY:"hidden",width:n,paddingRight:e.spacing(3)}),rzHandle:(0,u.css)({background:e.colors.secondary.main,[e.transitions.handleMotion("no-preference","reduce")]:{transition:"0.3s background ease-in-out"},position:"relative",height:"50% !important",width:`${e.spacing(1)} !important`,top:"25% !important",right:`${e.spacing(1)} !important`,cursor:"grab",borderRadius:e.shape.radius.pill,"&:hover":{background:e.colors.secondary.shade}})}}const In=()=>Math.max(window.innerHeight-500,500),ua=100;function Ut(e){const[s,n]=(0,c.useState)(!1),[o,r]=(0,c.useState)(!1),{dismissable:a,error:l,title:p,suggestedAction:g,onSuggestedAction:x,onRemove:d,severity:h="warning"}=e,f=e.message??l?.message??l?.data?.message??"",m=typeof f=="string"&&f.length>ua,j=(0,k.$j)(),y=pa(j),S=(0,c.useCallback)(()=>{r(!0)},[]),b=a?S:d;return o?null:(0,t.jsx)("div",{className:y.supplementaryErrorContainer,children:(0,t.jsx)(st.F,{title:p,severity:h,onRemove:b,children:m?(0,t.jsx)("div",{className:y.messageWrapper,children:s?f:(0,t.jsx)(B.$n,{variant:"secondary",size:"xs",onClick:()=>{n(!0)},children:"Show details"})}):(0,t.jsxs)("div",{className:`${y.messageWrapper} ${y.suggestedActionWrapper}`,children:[f,g&&x&&(0,t.jsx)(B.$n,{variant:"primary",size:"xs",onClick:x,children:g})]})})})}const pa=e=>({supplementaryErrorContainer:(0,u.css)({width:"60%",minWidth:`${e.breakpoints.values.sm}px`,maxWidth:`${e.breakpoints.values.md}px`,margin:"0 auto"}),messageWrapper:(0,u.css)({minHeight:e.spacing(3),ul:{paddingLeft:e.spacing(2)},button:{position:"absolute",bottom:e.spacing(2),right:e.spacing(2)}}),suggestedActionWrapper:(0,u.css)({paddingBottom:e.spacing(5)})});var ga=i(75960);function ha(e){const{width:s,timeZone:n,splitOpen:o,onUpdateTimeRange:r,onHiddenSeriesChanged:a,allLogsVolumeMaximum:l,toggleLegendRef:p}=e,g=(0,k.$j)(),x=(0,k.of)(fa),d=parseInt(g.spacing(2).slice(0,-2),10),h=150,f=e.logsVolumeData,m=(0,Fe.Dm)(f?.data);let j=m?`${m.name}`:"";(0,Fe.e3)(f.data)&&(j=[j,"This datasource does not support full-range histograms. The graph below is based on the logs seen in the response."].filter(se.identity).join(". "));let y=(0,t.jsx)("span",{children:j});return f.state===xe.Gu.Streaming&&(y=(0,t.jsxs)(t.Fragment,{children:[y,(0,t.jsx)(Z.m,{content:"Streaming",children:(0,t.jsx)(U.I,{name:"circle-mono",size:"md",className:x.streaming,"data-testid":"logs-volume-streaming"})})]})),(0,t.jsxs)("div",{style:{height:h},className:x.contentContainer,children:[(0,t.jsx)(ga.k,{toggleLegendRef:p,vizLegendOverrides:{calcs:["sum"]},graphStyle:"lines",loadingState:f.state??xe.Gu.Done,data:f.data,height:h,width:s-d*2,timeRange:e.timeRange,onChangeTime:r,timeZone:n,splitOpenFn:o,tooltipDisplayMode:re.$N.Multi,onHiddenSeriesChanged:a,anchorToZero:!0,yAxisMaximum:l,eventBus:e.eventBus,annotations:e.annotations}),y&&(0,t.jsx)("div",{className:x.extraInfoContainer,children:y})]})}const fa=e=>({extraInfoContainer:(0,u.css)({display:"flex",justifyContent:"end",position:"absolute",right:"5px",top:"-10px",fontSize:e.typography.bodySmall.fontSize,color:e.colors.text.secondary}),contentContainer:(0,u.css)({display:"flex",alignItems:"center",justifyContent:"center",position:"relative"}),streaming:(0,u.css)({color:e.colors.success.text})});function ma(e){return!e||!e.error&&!e.errors?!1:(e.error?[e.error]:e.errors||[]).some(n=>(`${n.message||n.data?.message}`?.toLowerCase()).includes("timeout"))}const xa=({logsVolumeData:e,absoluteRange:s,onUpdateTimeRange:n,width:o,onLoadLogsVolume:r,onHiddenSeriesChanged:a,eventBus:l,splitOpen:p,timeZone:g,onClose:x,toggleLegendRef:d})=>{const{logVolumes:h,maximumValue:f,maximumRange:m,annotations:j}=(0,c.useMemo)(()=>{let O=-1/0;const $=e?.data.filter(K=>K.meta?.dataTopic!==re.QR.Annotations),W=e?.data.filter(K=>K.meta?.dataTopic===re.QR.Annotations)||[],G=(0,se.sortBy)($||[],"meta.custom.datasourceName"),P=(0,se.groupBy)(G,"meta.custom.datasourceName"),ae=(0,se.mapValues)(P,K=>{const le=(0,Fe.oT)(K);return O=Math.max(O,le.maximum),le.dataFrames}),H=(0,Fe.Dx)((0,se.flatten)(Object.values(ae)));return{maximumValue:O,maximumRange:H,logVolumes:ae,annotations:W}},[e]),y=(0,k.of)(ya),S=Object.keys(h).length,b=Object.values(h).some(O=>{const $=va(O,s);return!(0,Fe.e3)(O)&&$&&$<1}),L=Q.$.featureToggles.lokiShardSplitting&&e&&e.data.length>0,R=ma(e),C=(0,ot.KQ)(Math.max(s.from,m.from)),I=(0,ot.KQ)(Math.min(s.to,m.to)),T={from:C,to:I,raw:{from:C,to:I}};return e?.state===xe.Gu.Loading?(0,t.jsx)("span",{children:"Loading..."}):R&&!L?(0,t.jsx)(Ut,{title:"Unable to show log volume",message:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("p",{children:(0,t.jsx)(v.x6,{i18nKey:"explore.logs.logs-volume.much-data",children:"The query is trying to access too much data. Try one or more of the following:"})}),(0,t.jsxs)("ul",{children:[(0,t.jsx)("li",{children:(0,t.jsx)(v.x6,{i18nKey:"explore.logs.logs-volume.add-filters",children:"Add more labels to your query to narrow down your search."})}),(0,t.jsx)("li",{children:(0,t.jsx)(v.x6,{i18nKey:"explore.logs.logs-volume.decrease-timerange",children:"Decrease the time range of your query."})})]})]}),severity:"info",suggestedAction:"Retry",onSuggestedAction:r,onRemove:x}):e?.error!==void 0&&!L?(0,t.jsx)(Ut,{error:e.error,title:"Failed to load log volume for this query"}):S===0&&e?.state!==xe.Gu.Streaming?(0,t.jsx)("div",{className:y.alertContainer,children:(0,t.jsx)(st.F,{severity:"info",title:"No logs volume available",children:"No volume information available for the current queries and time range."})}):(0,t.jsxs)("div",{className:y.listContainer,children:[R&&L&&(0,t.jsx)(Ut,{title:"Showing partial data",message:"The query is trying to access too much data and some sharded requests could not be completed. Try decreasing the time range or adding more labels to your query.",severity:"info",dismissable:!0}),Object.keys(h).map((O,$)=>(0,t.jsx)(ha,{toggleLegendRef:d,timeRange:T,allLogsVolumeMaximum:f,width:o,logsVolumeData:{data:h[O],state:e?.state},onUpdateTimeRange:n,timeZone:g,splitOpen:p,onLoadLogsVolume:r,onHiddenSeriesChanged:S>1?()=>{}:a,eventBus:l,annotations:j},$)),b&&(0,t.jsx)("div",{className:y.extraInfoContainer,children:(0,t.jsx)(Ee.I,{label:"Reload log volume",transparent:!0,children:(0,t.jsx)(B.$n,{size:"xs",icon:"sync",variant:"secondary",onClick:r,id:"reload-volume"})})})]})},ya=e=>({listContainer:(0,u.css)({paddingTop:"10px"}),extraInfoContainer:(0,u.css)({display:"flex",justifyContent:"end",position:"absolute",right:"5px",top:"5px"}),oldInfoText:(0,u.css)({fontSize:e.typography.bodySmall.fontSize,color:e.colors.text.secondary}),alertContainer:(0,u.css)({width:"50%",minWidth:`${e.breakpoints.values.sm}px`,margin:"0 auto"})});function va(e,s){const n=e&&e[0]&&e[0].meta?.custom?.absoluteRange;return n?(s.from-s.to)/(n.from-n.to):void 0}var de=i(60792);const ba=[re.fY.none,re.fY.exact,re.fY.numbers,re.fY.signature],fs=()=>{const e=ge.A.get(de.r3);return e==="table"?"table":e==="logs"?"logs":Q.$.featureToggles.logsExploreTableDefaultVisualization?"table":"logs"},Gt=10,ms="Pinned log",wn="Pin to content outline",it="Logs",Ca=e=>{const{width:s,splitOpen:n,logRows:o,logsMeta:r,logsVolumeEnabled:a,logsVolumeData:l,loadLogsVolumeData:p,loading:g=!1,onClickFilterLabel:x,onClickFilterOutLabel:d,timeZone:h,scanning:f,scanRange:m,showContextToggle:j,absoluteRange:y,onChangeTime:S,getFieldLinks:b,theme:L,logsQueries:R,clearCache:C,addResultsToCache:I,exploreId:T,getRowContext:O,getLogRowContextUi:$,getRowContextQuery:W,loadMoreLogs:G,panelState:P,eventBus:ae,onPinLineCallback:H,scrollElement:K}=e,[le,F]=(0,c.useState)(ge.A.getBool(de.$Z.showLabels,!1)),[N,V]=(0,c.useState)(ge.A.getBool(de.$Z.showTime,!0)),[q,_]=(0,c.useState)(ge.A.getBool(de.$Z.wrapLogMessage,!0)),[E,ue]=(0,c.useState)(ge.A.getBool(de.$Z.prettifyLogMessage,!1)),[ie,Ze]=(0,c.useState)(re.fY.none),[fe,ye]=(0,c.useState)([]),[Be,Sl]=(0,c.useState)(ge.A.get(de.$Z.logsSortOrder)||re.uH.Descending),[jl,zn]=(0,c.useState)(!1),[De,St]=(0,c.useState)([]),[jt,Tl]=(0,c.useState)(!1),[Rl,Qn]=(0,c.useState)(!1),[Ye,Un]=(0,c.useState)(void 0),[Ll,Gn]=(0,c.useState)(wn),[Te,qn]=(0,c.useState)(P?.logs?.visualisationType??fs()),me=(0,c.useRef)(null),lt=(0,D.useDispatch)(),Kn=(0,on.A)(g),Il=ae.newScopedBus("logsvolume",{onlyLocal:!1}),{register:Tt,unregister:Ts,outlineItems:ct,updateItem:Rs,unregisterAllChildren:Ls}=ts()??{},Is=(0,c.useRef)(void 0),ws=(0,c.useRef)(void 0),Fs=(0,c.useRef)(()=>{}),Rt=(0,c.useRef)(null),Es=(0,on.A)(R),wl=In(),ee=ja(L,q,wl),Kt=o&&o.length>0,Fl=m?`Scanning ${xr.describeTimeRange(m)}`:"Scanning...",Zn=ct?.find(w=>w.panelId===it&&w.level==="root"),Os=(0,c.useMemo)(()=>Zn?.children?.filter(w=>w.title===ms).map(w=>w.id),[Zn?.children]),Lt=(0,c.useCallback)(()=>ct?.find(z=>z.panelId===it&&z.level==="root")?.children?.filter(z=>z.title===ms).length??0,[ct]),Yn=(0,c.useCallback)(()=>{const w=Object.keys(at.cZ),z=new Set(l?.data),te=l?.data.filter(be=>be.meta?.dataTopic!==re.QR.Annotations),pe=(0,se.groupBy)(te,"meta.custom.datasourceName"),ve=Object.keys(pe).length;Ls&&Ls(be=>be?.find(Zt=>Zt.panelId===it&&Zt.level==="root")?.id,"filter");const no=[];z.forEach(be=>{const{level:Je}=(0,Fe.tX)(be,l?.data??[]);no.push({levelStr:Je,logLevel:(0,Fe.XM)(Je)})});const Xl=no.sort((be,Je)=>w.indexOf(be.logLevel.toString())>w.indexOf(Je.logLevel.toString())?1:-1),oo=new Set(Xl);oo.size>1&&a&&ve===1&&oo.forEach(be=>{const Je=fe.length===0,Zt=!fe.find(Ns=>Ns===be.levelStr);Tt&&Tt({title:be.levelStr,icon:"gf-logs",panelId:it,level:"child",type:"filter",highlight:Zt&&!Je,onClick:Ns=>{Fs.current?.(be.levelStr,(0,vr.W)(Ns)),Fr(be)},ref:null,color:at.cZ[be.logLevel]})})},[l?.data,Ls,a,fe,Tt,Fs]);(0,c.useEffect)(()=>{Lt()===Gt?Gn((0,t.jsxs)("span",{style:{display:"flex",textAlign:"center"},children:["\u2757\uFE0F",(0,t.jsxs)(v.x6,{i18nKey:"explore.logs.maximum-pinned-logs",children:["Maximum of ",{PINNED_LOGS_LIMIT:Gt}," pinned logs reached. Unpin a log to add another."]})]})):Gn(wn)},[ct,Lt]),(0,c.useEffect)(()=>{g&&!Kn&&P?.logs?.id&&(delete P.logs.id,lt((0,Pe.EA)(T,"logs",{...P})))},[lt,T,g,P,Kn]),(0,c.useEffect)(()=>{const w=P?.logs?.visualisationType??fs();qn(w),ge.A.set(de.r3,w)},[P?.logs?.visualisationType]),(0,c.useEffect)(()=>{let w=[];Array.isArray(P?.logs?.displayedFields)?w=P?.logs?.displayedFields:P?.logs?.displayedFields&&typeof P?.logs?.displayedFields=="object"&&(w=Object.values(P?.logs?.displayedFields)),St(w)},[P?.logs?.displayedFields]),(0,c.useEffect)(()=>{Yn()},[l?.data,fe,Yn]),(0,ut.A)(()=>{Is&&window.clearTimeout(Is.current),ws&&window.clearTimeout(ws.current)}),(0,ut.A)(()=>{(P?.logs?.columns||P?.logs?.refId||P?.logs?.labelFieldName||P?.logs?.displayedFields)&&lt((0,Pe.EA)(T,"logs",{...P?.logs,columns:void 0,visualisationType:Te,labelFieldName:void 0,refId:void 0,displayedFields:void 0}))});const Ie=(0,c.useCallback)(w=>{const z=(0,yt.Gu)().explore.panes[T];z?.panelsState&&lt((0,Pe.EA)(T,"logs",{...z.panelsState.logs,columns:w.columns??P?.logs?.columns,visualisationType:w.visualisationType??Te,labelFieldName:w.labelFieldName,refId:w.refId??P?.logs?.refId,displayedFields:w.displayedFields??P?.logs?.displayedFields}))},[lt,T,P?.logs?.columns,P?.logs?.displayedFields,P?.logs?.refId,Te]);(0,c.useEffect)(()=>{Es&&((0,de.oY)(R,Es)||(St([]),Ie({...P?.logs,displayedFields:[]})))},[R,P?.logs,Es,Ie]);const El=(0,c.useCallback)(w=>{w?e.eventBus.publish(new rn.b_({point:{time:w.timeEpochMs}})):e.eventBus.publish(new rn.ql)},[e.eventBus]),Ol=(0,c.useCallback)(w=>{if(Q.$.featureToggles.logsInfiniteScrolling){me.current&&(Rt.current?.scrollIntoView(),me.current.scroll({behavior:"smooth",top:me.current.scrollTop+w.getBoundingClientRect().top-window.innerHeight/2}));return}K&&K.scroll({behavior:"smooth",top:K.scrollTop+w.getBoundingClientRect().top-window.innerHeight/2})},[K]),Dl=()=>{zn(!0),Is.current=window.setTimeout(()=>{const w=Be===re.uH.Descending?re.uH.Ascending:re.uH.Descending;if(ge.A.set(de.$Z.logsSortOrder,w),R){let z=!1;const te=R.map(pe=>{if(pe.datasource?.type!=="loki"||!(0,jr.kr)(pe)||(z=!0,pe.direction===zt.ti.Scan))return pe;const ve=w===re.uH.Ascending?zt.ti.Forward:zt.ti.Backward;return ve!==pe.direction&&(pe.direction=ve),pe});z&&lt((0,Y.bO)({exploreId:T,queries:te}))}Sl(w)},0),ws.current=window.setTimeout(()=>zn(!1),1e3)},Al=(0,c.useCallback)(()=>{Tl(!jt)},[jt]),Nl=(0,c.useCallback)(w=>{qn(w);const z={...P?.logs,visualisationType:w};Ie(z),(0,M.rR)("grafana_explore_logs_visualisation_changed",{newVisualizationType:w,datasourceType:e.datasourceType??"unknown",defaultVisualisationType:Q.$.featureToggles.logsExploreTableDefaultVisualization?"table":"logs"})},[P?.logs,e.datasourceType,Ie]),Pl=(0,c.useCallback)(w=>{(0,M.rR)("grafana_explore_logs_deduplication_clicked",{deduplicationType:w,datasourceType:e.datasourceType}),Ze(w)},[e.datasourceType]),kl=(0,c.useCallback)(w=>{const{target:z}=w;if(z){const te=z.checked;F(te),ge.A.set(de.$Z.showLabels,te)}},[]),Ml=(0,c.useCallback)(w=>{const{target:z}=w;if(z){const te=z.checked;V(te),ge.A.set(de.$Z.showTime,te)}},[]),Bl=(0,c.useCallback)(w=>{const{target:z}=w;if(z){const te=z.checked;_(te),ge.A.set(de.$Z.wrapLogMessage,te)}},[]),Hl=(0,c.useCallback)(w=>{const{target:z}=w;if(z){const te=z.checked;ue(te),ge.A.set(de.$Z.prettifyLogMessage,te)}},[]),$l=(0,c.useCallback)(w=>{const z=w.map(te=>(0,Fe.EK)(te));ye(z)},[]),Jn=(0,c.useCallback)(w=>{e.onSetLogsVolumeEnabled(!w),(0,M.rR)("grafana_explore_logs_histogram_toggle_clicked",{datasourceType:e.datasourceType,type:w?"close":"open"})},[e]),Vl=(0,c.useCallback)(w=>{w.preventDefault(),e.onStartScanning&&(e.onStartScanning(),(0,M.rR)("grafana_explore_logs_scanning_button_clicked",{type:"start",datasourceType:e.datasourceType}))},[e]),Wl=(0,c.useCallback)(w=>{w.preventDefault(),e.onStopScanning&&e.onStopScanning()},[e]),zl=(0,c.useCallback)(w=>{if(De.indexOf(w)===-1){const te=De.concat(w);St(te),Ie({...P?.logs,displayedFields:te})}},[De,P?.logs,Ie]),Ql=(0,c.useCallback)(w=>{if(De.indexOf(w)>-1){const te=De.filter(pe=>w!==pe);St(te),Ie({...P?.logs,displayedFields:te})}},[De,P?.logs,Ie]),Ul=(0,c.useCallback)(()=>{Ie({...P?.logs,displayedFields:[]}),St([])},[P?.logs,Ie]),Ds=(0,c.useRef)(()=>{});let Gl=(0,c.useCallback)(()=>{Qn(!1),Un(void 0),(0,M.rR)("grafana_explore_logs_log_context_closed",{datasourceType:Ye?.datasourceType,logRowUid:Ye?.uid}),Ds?.current()},[Ye?.datasourceType,Ye?.uid,Ds]);const As=(0,c.useCallback)((w,z)=>{Qn(!0),Un(w),(0,M.rR)("grafana_explore_logs_log_context_opened",{datasourceType:w.datasourceType,logRowUid:w.uid}),Ds.current=z},[]),ql=(0,c.useCallback)(async w=>{if(w.rowId===void 0)return;const z=(0,dn.m)((0,yt.Gu)().explore.panes[T]);z.panelsState={...P,logs:{id:w.uid,visualisationType:Te??fs(),displayedFields:De}},z.range=(0,$t.sU)(w,o,y);const te=(0,an.Pp)(z),pe=/.*(?=\/explore)/.exec(`${window.location.href}`)[0],ve=an.kM.renderUrl(`${pe}/explore`,{left:te});await(0,$t.VP)(ve),(0,M.rR)("grafana_explore_logs_permalink_clicked",{datasourceType:w.datasourceType??"unknown",logRowUid:w.uid,logRowLevel:w.logLevel})},[y,De,T,o,P,Te]),Xn=(0,c.useCallback)(()=>{Q.$.featureToggles.newLogsPanel?ae.publish(new cn._B({scrollTo:"top"})):Q.$.featureToggles.logsInfiniteScrolling&&me.current&&me.current.scroll({behavior:"auto",top:0}),Rt.current?.scrollIntoView()},[ae]),Kl=(0,c.useCallback)(()=>{Q.$.featureToggles.newLogsPanel?ae.publish(new cn._B({scrollTo:"bottom"})):Q.$.featureToggles.logsInfiniteScrolling&&me.current&&me.current.scroll({behavior:"auto",top:me.current.scrollHeight}),Rt.current?.scrollTo(0,Rt.current.scrollHeight)},[ae]),_n=(0,c.useCallback)((w,z=!0)=>{if(Lt()===Gt&&!z){Lr();return}const te=ct?.find(ve=>ve.panelId===it&&ve.level==="root");te&&Rs&&Rs(te.id,{expanded:!0});const pe=Os?.find(ve=>ve===w.rowId);pe&&w.rowId&&z?(Ts?.(w.rowId),Rr()):Lt()!==Gt&&!pe&&(Tt?.({id:w.rowId,icon:"gf-logs",title:ms,panelId:it,level:"child",ref:null,color:at.cZ[w.logLevel],childOnTop:!0,onClick:()=>{As(w,()=>{}),Ir()},onRemove:ve=>{Ts?.(ve),wr()}}),Tr()),H?.()},[Lt,As,H,ct,Os,Tt,Ts,Rs]),Zl=(0,c.useMemo)(()=>Ta(o),[o]),eo=(0,c.useMemo)(()=>La(o,fe),[fe,o]),{dedupedRows:to,dedupCount:Yl}=(0,c.useMemo)(()=>Ra(eo,ie),[ie,eo]),so=(0,c.useMemo)(()=>Ia(o),[o]),Jl=(0,c.useMemo)(()=>!R?.some(w=>"direction"in w&&w.direction===zt.ti.Scan),[R]);return(0,t.jsxs)(t.Fragment,{children:[O&&Ye&&(0,t.jsx)(Cr.V,{open:Rl,row:Ye,onClose:Gl,getRowContext:(w,z)=>O(w,Ye,z),getRowContextQuery:W,getLogRowContextUi:$,logsSortOrder:Be,timeZone:h}),(0,t.jsx)(Me.NR,{title:"Logs volume",collapsible:!0,collapsed:!a,onToggleCollapse:Jn,children:a&&(0,t.jsx)(xa,{toggleLegendRef:Fs,absoluteRange:y,width:s,logsVolumeData:l,onUpdateTimeRange:S,timeZone:h,splitOpen:n,onLoadLogsVolume:p,onHiddenSeriesChanged:$l,eventBus:Il,onClose:()=>Jn(!0)})}),(0,t.jsxs)(Me.NR,{titleItems:[Q.$.featureToggles.logsExploreTableVisualisation?Te==="logs"?null:(0,t.jsx)(Me.NR.TitleItem,{title:"Feedback",children:(0,t.jsx)(Er,{feedbackUrl:"https://forms.gle/5YyKdRQJ5hzq4c289"})},"A"):null],title:"Logs",actions:(0,t.jsx)(t.Fragment,{children:Q.$.featureToggles.logsExploreTableVisualisation&&(0,t.jsx)("div",{className:ee.visualisationType,children:(0,t.jsx)(Wt.z,{className:ee.visualisationTypeRadio,options:[{label:"Logs",value:"logs",description:"Show results in logs visualisation"},{label:"Table",value:"table",description:"Show results in table visualisation"}],size:"sm",value:Te,onChange:Nl})})}),loadingState:g?xe.Gu.Loading:xe.Gu.Done,children:[(0,t.jsxs)("div",{className:ee.stickyNavigation,children:[Te!=="table"&&(0,t.jsxs)("div",{className:ee.logOptions,children:[(0,t.jsxs)(yr.C,{children:[(0,t.jsx)(Ee.I,{label:"Time",className:ee.horizontalInlineLabel,transparent:!0,children:(0,t.jsx)(Ge.K,{value:N,onChange:Ml,className:ee.horizontalInlineSwitch,transparent:!0,id:`show-time_${T}`})}),(0,t.jsx)(Ee.I,{label:"Unique labels",className:ee.horizontalInlineLabel,transparent:!0,children:(0,t.jsx)(Ge.K,{value:le,onChange:kl,className:ee.horizontalInlineSwitch,transparent:!0,id:`unique-labels_${T}`})}),(0,t.jsx)(Ee.I,{label:"Wrap lines",className:ee.horizontalInlineLabel,transparent:!0,children:(0,t.jsx)(Ge.K,{value:q,onChange:Bl,className:ee.horizontalInlineSwitch,transparent:!0,id:`wrap-lines_${T}`})}),(0,t.jsx)(Ee.I,{label:"Prettify JSON",className:ee.horizontalInlineLabel,transparent:!0,children:(0,t.jsx)(Ge.K,{value:E,onChange:Hl,className:ee.horizontalInlineSwitch,transparent:!0,id:`prettify_${T}`})}),(0,t.jsx)(Ee.I,{label:"Deduplication",className:ee.horizontalInlineLabel,transparent:!0,children:(0,t.jsx)(Wt.z,{options:ba.map(w=>({label:(0,se.capitalize)(w),value:w,description:oe._C[w]})),value:ie,onChange:Pl,className:ee.radioButtons})})]}),(0,t.jsx)("div",{children:(0,t.jsx)(Ee.I,{label:"Display results",className:ee.horizontalInlineLabel,transparent:!0,disabled:jl||g,children:(0,t.jsx)(Wt.z,{options:[{label:"Newest first",value:re.uH.Descending,description:"Show results newest to oldest"},{label:"Oldest first",value:re.uH.Ascending,description:"Show results oldest to newest"}],value:Be,onChange:Dl,className:ee.radioButtons})})})]}),(0,t.jsx)("div",{ref:Rt}),(0,t.jsx)(vn,{logRows:o,meta:r||[],dedupStrategy:ie,dedupCount:Yl,hasUnescapedContent:Zl,forceEscape:jt,displayedFields:De,onEscapeNewlines:Al,clearDetectedFields:Ul})]}),(0,t.jsxs)("div",{className:(0,u.cx)(ee.logsSection,Te==="table"?ee.logsTable:void 0),children:[Te==="table"&&Kt&&(0,t.jsx)("div",{className:ee.logRows,"data-testid":"logRowsTable",children:(0,t.jsx)(ca,{logsSortOrder:Be,range:e.range,splitOpen:n,timeZone:h,width:s-80,logsFrames:e.logsFrames??[],onClickFilterLabel:x,onClickFilterOutLabel:d,panelState:P?.logs,theme:L,updatePanelState:Ie,datasourceType:e.datasourceType})}),Te==="logs"&&Kt&&!Q.$.featureToggles.newLogsPanel&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:Q.$.featureToggles.logsInfiniteScrolling?ee.scrollableLogRows:ee.logRows,"data-testid":"logRows",ref:me,children:(0,t.jsx)(br.u8,{loading:g,loadMoreLogs:Jl?G:void 0,range:e.range,timeZone:h,rows:o,scrollElement:me.current,sortOrder:Be,app:Ue.Jk.Explore,children:(0,t.jsx)(ln.k,{pinnedLogs:Os,logRows:o,deduplicatedRows:to,dedupStrategy:ie,onClickFilterLabel:x,onClickFilterOutLabel:d,showContextToggle:j,getRowContextQuery:W,showLabels:le,showTime:N,enableLogDetails:!0,forceEscape:jt,wrapLogMessage:q,prettifyLogMessage:E,timeZone:h,getFieldLinks:b,logsSortOrder:Be,displayedFields:De,onClickShowField:zl,onClickHideField:Ql,app:Ue.Jk.Explore,onLogRowHover:El,onOpenContext:As,onPermalinkClick:ql,permalinkedRowId:P?.logs?.id,scrollIntoView:Ol,isFilterLabelActive:e.isFilterLabelActive,scrollElement:me.current,onClickFilterString:e.onClickFilterString,onClickFilterOutString:e.onClickFilterOutString,onUnpinLine:_n,onPinLine:_n,pinLineButtonTooltipTitle:Ll,renderPreview:!0})})}),(0,t.jsx)(bn,{logsSortOrder:Be,visibleRange:so??y,absoluteRange:y,timeZone:h,onChangeTime:S,loading:g,queries:R??[],scrollToTopLogs:Xn,addResultsToCache:I,clearCache:C})]}),Te==="logs"&&Kt&&Q.$.featureToggles.newLogsPanel&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{"data-testid":"logRows",ref:me,className:ee.logRows,children:me.current&&(0,t.jsx)(Sr.Z,{app:Ue.Jk.Explore,containerElement:me.current,eventBus:ae,forceEscape:jt,loadMore:G,logs:to,showTime:N,sortOrder:Be,timeRange:e.range,timeZone:h,wrapLogMessage:q})}),(0,t.jsx)(bn,{logsSortOrder:Be,visibleRange:so??y,absoluteRange:y,timeZone:h,onChangeTime:S,loading:g,queries:R??[],scrollToTopLogs:Xn,scrollToBottomLogs:Kl,addResultsToCache:I,clearCache:C})]}),!g&&!Kt&&!f&&(0,t.jsx)("div",{className:ee.noDataWrapper,children:(0,t.jsxs)("div",{className:ee.noData,children:[(0,t.jsx)(v.x6,{i18nKey:"explore.logs.no-logs-found",children:"No logs found."}),(0,t.jsx)(B.$n,{size:"sm",variant:"secondary",className:ee.scanButton,onClick:Vl,children:(0,t.jsx)(v.x6,{i18nKey:"explore.logs.scan-for-older-logs",children:"Scan for older logs"})})]})}),f&&(0,t.jsx)("div",{className:ee.noDataWrapper,children:(0,t.jsxs)("div",{className:ee.noData,children:[(0,t.jsx)("span",{children:Fl}),(0,t.jsx)(B.$n,{size:"sm",variant:"secondary",className:ee.scanButton,onClick:Wl,children:(0,t.jsx)(v.x6,{i18nKey:"explore.logs.stop-scan",children:"Stop scan"})})]})})]})]})]})},Sa=(0,k.cV)(Ca),ja=(e,s,n)=>({noDataWrapper:(0,u.css)({display:"flex",justifyContent:"center",width:"100%",paddingBottom:e.spacing(2)}),noData:(0,u.css)({display:"inline-block"}),scanButton:(0,u.css)({marginLeft:e.spacing(1)}),logOptions:(0,u.css)({display:"flex",justifyContent:"space-between",alignItems:"baseline",flexWrap:"wrap",backgroundColor:e.colors.background.primary,padding:`${e.spacing(1)} ${e.spacing(2)}`,borderRadius:e.shape.radius.default,margin:`${e.spacing(0,0,1)}`,border:`1px solid ${e.colors.border.medium}`}),headerButton:(0,u.css)({margin:`${e.spacing(.5,0,0,1)}`}),horizontalInlineLabel:(0,u.css)({"& > label":{marginRight:"0"}}),horizontalInlineSwitch:(0,u.css)({padding:`0 ${e.spacing(1)} 0 0`}),radioButtons:(0,u.css)({margin:"0"}),logsSection:(0,u.css)({display:"flex",flexDirection:"row",justifyContent:"space-between",position:"relative"}),logsTable:(0,u.css)({maxHeight:`${n}px`}),scrollableLogRows:(0,u.css)({overflowY:"scroll",width:"100%",maxHeight:"75vh"}),logRows:(0,u.css)({overflowX:`${s?"unset":"scroll"}`,overflowY:"visible",width:"100%"}),visualisationType:(0,u.css)({display:"flex",flex:"1",justifyContent:"space-between"}),visualisationTypeRadio:(0,u.css)({margin:`0 0 0 ${e.spacing(1)}`}),stickyNavigation:(0,u.css)({overflow:"visible",...Q.$.featureToggles.logsInfiniteScrolling&&{marginBottom:"0px"}})}),Ta=e=>e.some(s=>s.hasUnescapedContent),Ra=(e,s)=>{const n=(0,at.M0)(e,s),o=n.reduce((r,a)=>a.duplicates?r+a.duplicates:r,0);return{dedupedRows:n,dedupCount:o}},La=(e,s)=>(0,at.ct)(e,new Set(s)),Ia=e=>{if(!e||e.length===0)return;const s=e[0].timeEpochMs,n=e[e.length-1].timeEpochMs;return n<s?{from:n,to:s}:{from:s,to:n}},xs=500,ys=100,wa=e=>({logsEnter:(0,u.css)({label:"logsEnter",position:"absolute",opacity:0,height:"auto",width:"100%"}),logsEnterActive:(0,u.css)({label:"logsEnterActive",opacity:1,[e.transitions.handleMotion("no-preference","reduce")]:{transition:`opacity ${xs}ms ease-out ${ys}ms`}}),logsExit:(0,u.css)({label:"logsExit",position:"absolute",opacity:1,height:"auto",width:"100%"}),logsExitActive:(0,u.css)({label:"logsExitActive",opacity:0,[e.transitions.handleMotion("no-preference","reduce")]:{transition:`opacity ${xs}ms ease-out ${ys}ms`}})});function Fn(e){const{visible:s,children:n}=e,o=(0,c.useRef)(null),r=(0,k.of)(wa);return(0,t.jsx)(Ys.A,{in:s,mountOnEnter:!0,unmountOnExit:!0,timeout:xs+ys,classNames:{enter:r.logsEnter,enterActive:r.logsEnterActive,exit:r.logsExit,exitActive:r.logsExitActive},nodeRef:o,children:(0,t.jsx)("div",{ref:o,children:n})})}class Fa extends c.PureComponent{constructor(){super(...arguments),this.state={dsInstances:{}},this.onChangeTime=s=>{const{exploreId:n,updateTimeRange:o}=this.props;o({exploreId:n,absoluteRange:s})},this.loadMoreLogs=s=>{const{exploreId:n,loadMoreLogs:o}=this.props;o({exploreId:n,absoluteRange:s})},this.getLogRowContext=async(s,n,o)=>{const{logsQueries:r}=this.props;if(!n.dataFrame.refId||!this.state.dsInstances[n.dataFrame.refId])return Promise.resolve([]);const a=this.state.dsInstances[n.dataFrame.refId];if(!(0,oe.Ol)(a))return Promise.resolve([]);const l=this.getQuery(r,n,a);return l?a.getLogRowContext(s,o,l):Promise.resolve([])},this.getLogRowContextQuery=async(s,n,o=!0)=>{const{logsQueries:r}=this.props;if(!s.dataFrame.refId||!this.state.dsInstances[s.dataFrame.refId])return Promise.resolve(null);const a=this.state.dsInstances[s.dataFrame.refId];if(!(0,oe.Ol)(a))return Promise.resolve(null);const l=this.getQuery(r,s,a);return l&&a.getLogRowContextQuery?a.getLogRowContextQuery(s,n,l,o):Promise.resolve(null)},this.getLogRowContextUi=(s,n)=>{const{logsQueries:o}=this.props;if(!s.dataFrame.refId||!this.state.dsInstances[s.dataFrame.refId])return(0,t.jsx)(t.Fragment,{});const r=this.state.dsInstances[s.dataFrame.refId];if(!(0,oe.Ol)(r))return(0,t.jsx)(t.Fragment,{});const a=this.getQuery(o,s,r);return a&&(0,oe.wj)(r)&&r.getLogRowContextUi?r.getLogRowContextUi(s,n,a):(0,t.jsx)(t.Fragment,{})},this.showContextToggle=s=>!s?.dataFrame.refId||!this.state.dsInstances[s.dataFrame.refId]?!1:(0,oe.Ol)(this.state.dsInstances[s.dataFrame.refId]),this.getFieldLinks=(s,n,o)=>{const{splitOpenFn:r,range:a}=this.props;return(0,Qe.QL)({field:s,rowIndex:n,splitOpenFn:r,range:a,dataFrame:o})},this.logDetailsFilterAvailable=()=>Object.values(this.state.dsInstances).some(s=>s?.modifyQuery||(0,oe._0)(s)||(0,oe.FP)(s)),this.filterValueAvailable=()=>Object.values(this.state.dsInstances).some(s=>(0,oe._0)(s)&&s?.getSupportedQueryModifications().includes("ADD_STRING_FILTER")),this.filterOutValueAvailable=()=>Object.values(this.state.dsInstances).some(s=>(0,oe._0)(s)&&s?.getSupportedQueryModifications().includes("ADD_STRING_FILTER_OUT")),this.addResultsToCache=()=>{this.props.addResultsToCache(this.props.exploreId)},this.clearCache=()=>{this.props.clearCache(this.props.exploreId)},this.loadLogsVolumeData=()=>{this.props.loadSupplementaryQueryData(this.props.exploreId,oe.cF.LogsVolume)},this.onSetLogsVolumeEnabled=s=>{this.props.setSupplementaryQueryEnabled(this.props.exploreId,s,oe.cF.LogsVolume)}}componentDidMount(){this.updateDataSourceInstances()}componentDidUpdate(s){s.logsQueries!==this.props.logsQueries&&this.updateDataSourceInstances()}updateDataSourceInstances(){const{logsQueries:s,datasourceInstance:n}=this.props;if(!s||!n)return;const o={};if(n.uid!==et.uv){s.forEach(({refId:a})=>{o[a]=n}),this.setState({dsInstances:o});return}const r=[];for(const a of s){if(!a.datasource)continue;(!o[a.refId]||o[a.refId].uid!==a.datasource.uid)&&r.push(new Promise(p=>{(0,ze.l)().get(a.datasource).then(g=>{p({ds:g,refId:a.refId})})}))}r.length&&Promise.all(r).then(a=>{a.forEach(({ds:l,refId:p})=>{o[p]=l}),this.setState({dsInstances:o})})}getQuery(s,n,o){return(s??[]).find(r=>r.refId===n.dataFrame.refId&&r.datasource!=null&&r.datasource.type===o.type)}render(){const{loading:s,loadingState:n,logRows:o,logsMeta:r,logsSeries:a,logsQueries:l,onClickFilterLabel:p,onClickFilterOutLabel:g,onStartScanning:x,onStopScanning:d,absoluteRange:h,timeZone:f,visibleRange:m,scanning:j,range:y,width:S,splitOpenFn:b,isLive:L,exploreId:R,logsVolume:C,scrollElement:I,onPinLineCallback:T}=this.props;return o?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(Fn,{visible:L,children:(0,t.jsx)(kt.S,{label:"Logs",loading:!1,isOpen:!0,children:(0,t.jsx)(tn,{exploreId:R,children:O=>(0,t.jsx)(mr,{logRows:o,timeZone:f,stopLive:O.stop,isPaused:this.props.isPaused,onPause:O.pause,onResume:O.resume,onClear:O.clear,clearedAtIndex:this.props.clearedAtIndex})})})}),(0,t.jsx)(Fn,{visible:!L,children:(0,t.jsx)(Sa,{exploreId:R,datasourceType:this.props.datasourceInstance?.type,logRows:o,logsMeta:r,logsSeries:a,logsVolumeEnabled:C.enabled,onSetLogsVolumeEnabled:this.onSetLogsVolumeEnabled,logsVolumeData:C.data,logsQueries:l,width:S,splitOpen:b,loading:s,loadingState:n,loadLogsVolumeData:this.loadLogsVolumeData,onChangeTime:this.onChangeTime,loadMoreLogs:this.loadMoreLogs,onClickFilterLabel:this.logDetailsFilterAvailable()?p:void 0,onClickFilterOutLabel:this.logDetailsFilterAvailable()?g:void 0,onStartScanning:x,onStopScanning:d,absoluteRange:h,visibleRange:m,timeZone:f,scanning:j,scanRange:y.raw,showContextToggle:this.showContextToggle,getRowContext:this.getLogRowContext,getRowContextQuery:this.getLogRowContextQuery,getLogRowContextUi:this.getLogRowContextUi,getFieldLinks:this.getFieldLinks,addResultsToCache:this.addResultsToCache,clearCache:this.clearCache,eventBus:this.props.eventBus,panelState:this.props.panelState,logsFrames:this.props.logsFrames,scrollElement:I,isFilterLabelActive:this.logDetailsFilterAvailable()?this.props.isFilterLabelActive:void 0,range:y,onPinLineCallback:T,onClickFilterString:this.filterValueAvailable()?this.props.onClickFilterString:void 0,onClickFilterOutString:this.filterOutValueAvailable()?this.props.onClickFilterOutString:void 0})})]}):null}}function Ea(e,{exploreId:s}){const o=e.explore.panes[s],{logsResult:r,scanning:a,datasourceInstance:l,isLive:p,isPaused:g,clearedAtIndex:x,range:d,absoluteRange:h,supplementaryQueries:f}=o,m=(0,Y.h1)(s)(e),j=o.panelsState,y=(0,Ot.O)(e.user),S=f[oe.cF.LogsVolume];return{loading:m,logRows:r?.rows,logsMeta:r?.meta,logsSeries:r?.series,logsQueries:r?.queries,visibleRange:r?.visibleRange,scanning:a,timeZone:y,datasourceInstance:l,isLive:p,isPaused:g,clearedAtIndex:x,range:d,absoluteRange:h,logsVolume:S,panelState:j,logsFrames:o.queryResponse.logsFrames}}const Oa={updateTimeRange:je.GH,loadMoreLogs:je.zY,addResultsToCache:Y.He,clearCache:Y.IL,loadSupplementaryQueryData:Y.Az,setSupplementaryQueryEnabled:Y.TO},Da=(0,Re.connect)(Ea,Oa)(Fa);function Aa(e){const{queryResponse:s,timeZone:n,enabled:o,setLogsSampleEnabled:r,datasourceInstance:a,queries:l,splitOpen:p}=e,g=(0,k.of)(Na),x=f=>{r(f),(0,M.rR)("grafana_explore_logs_sample_toggle_clicked",{datasourceType:a?.type??"unknown",type:f?"open":"close"})},d=()=>{if(!a||!(0,oe.Nc)(a,oe.cF.LogsSample))return null;const f=l.map(j=>a.getSupplementaryQuery({type:oe.cF.LogsSample},j)).filter(j=>!!j);if(!f.length)return null;const m=()=>{p({queries:f,datasourceUid:a.uid}),(0,M.rR)("grafana_explore_logs_sample_split_button_clicked",{datasourceType:a?.type??"unknown",queriesCount:f.length})};return(0,t.jsx)(B.$n,{size:"sm",className:g.logSamplesButton,onClick:m,children:"Open logs in split view"})};let h;if(s===void 0)h=null;else if(s.error!==void 0)h=(0,t.jsx)(Ut,{error:s.error,title:"Failed to load logs sample for this query"});else if(s.state===xe.Gu.Loading)h=(0,t.jsx)("span",{children:"Logs sample is loading..."});else if(s.data.length===0||s.data.every(f=>f.length===0))h=(0,t.jsx)("span",{children:"No logs sample data."});else{const f=(0,at.HT)(s.data);h=(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(d,{}),(0,t.jsx)("div",{className:g.logContainer,children:(0,t.jsx)(ln.k,{logRows:f.rows,dedupStrategy:re.fY.none,showLabels:ge.A.getBool(de.$Z.showLabels,!1),showTime:ge.A.getBool(de.$Z.showTime,!0),wrapLogMessage:ge.A.getBool(de.$Z.wrapLogMessage,!0),prettifyLogMessage:ge.A.getBool(de.$Z.prettifyLogMessage,!1),timeZone:n,enableLogDetails:!0,scrollElement:null})})]})}return s?.state!==xe.Gu.NotStarted?(0,t.jsx)(kt.S,{label:(0,t.jsxs)("div",{children:["Logs sample",(0,t.jsx)(Z.m,{content:"Show log lines that contributed to visualized metrics",children:(0,t.jsx)(U.I,{name:"info-circle",className:g.infoTooltip})})]}),isOpen:o,collapsible:!0,onToggle:x,children:h}):null}const Na=e=>({logSamplesButton:(0,u.css)({position:"absolute",top:e.spacing(1),right:e.spacing(1)}),logContainer:(0,u.css)({overflow:"scroll"}),infoTooltip:(0,u.css)({marginLeft:e.spacing(1)})}),Pa=()=>{const e=(0,k.of)(ka);return(0,t.jsx)(t.Fragment,{children:(0,t.jsx)(es._,{"data-testid":"explore-no-data",className:e.wrapper,children:(0,t.jsx)("span",{className:e.message,children:"No data"})})})},ka=e=>({wrapper:(0,u.css)({label:"no-data-card",padding:e.spacing(3),background:e.colors.background.primary,borderRadius:e.shape.radius.default,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",flexGrow:1}),message:(0,u.css)({fontSize:e.typography.h2.fontSize,padding:e.spacing(4),color:e.colors.text.disabled})});var Ma=i(78464);function Ba(e){return(0,u.css)({maxWidth:`${e.breakpoints.values.lg}px`,marginTop:e.spacing(2),alignSelf:"center"})}const Ha=()=>{const e=(0,k.of)(Ba),s=ls.TP.hasPermission(D.AccessControlAction.DataSourcesCreate)&&ls.TP.hasPermission(D.AccessControlAction.DataSourcesWrite),n="Explore requires at least one data source. Once you have added a data source, you can query it here.",o=(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(U.I,{name:"rocket"}),(0,t.jsx)(t.Fragment,{children:" ProTip: You can also define data sources through configuration files. "}),(0,t.jsx)("a",{href:"http://docs.grafana.org/administration/provisioning/?utm_source=explore#data-sources",target:"_blank",rel:"noreferrer",className:"text-link",children:"Learn more"})]}),r=(0,t.jsx)(B.z9,{size:"lg",href:"datasources/new",icon:"database",disabled:!s,children:"Add data source"});return(0,t.jsx)(Ma.c,{callToActionElement:r,className:e,footer:o,message:n})};var vs=i(52908),$a=i(63141),Va=i(36752);const Wa=e=>({warningText:(0,u.css)({label:"warningText",display:"flex",alignItems:"center",fontSize:e.typography.bodySmall.fontSize,color:e.colors.text.secondary})});function za(e){const{dataFrames:s,range:n,splitOpenFn:o,withTraceView:r,datasourceType:a}=e,l=(0,Qe.JQ)(n,o),p=(0,k.$j)(),g=(0,k.of)(Wa),x=(0,Qt.we)({fieldConfig:{defaults:{},overrides:[]},data:s,replaceVariables:C=>C,theme:p}),{nodes:d}=(0,Va.d)(x),[h,f]=(0,Hs.A)(!0),m=()=>{f(),(0,M.rR)("grafana_traces_node_graph_panel_clicked",{datasourceType:a,grafana_version:Q.$.buildInfo.version,isExpanded:!open})},{height:j}=(0,vs.A)(),y=(0,c.useRef)(null),[S,b]=(0,c.useState)(250);(0,c.useEffect)(()=>{if(y.current){const{top:C}=y.current.getBoundingClientRect();b(C)}},[y]);const L=j-S-32,R=r&&d[0]?.length>1e3?(0,t.jsxs)("span",{className:g.warningText,children:[" (",d[0].length," nodes, can be slow to load)"]}):null;return(0,t.jsx)(Me.NR,{title:"Node graph",titleItems:R,collapsible:!!r,collapsed:r?h:!1,onToggleCollapse:r?m:void 0,children:(0,t.jsx)("div",{ref:y,style:r?{height:500}:{minHeight:600,height:L},children:(0,t.jsx)($a.F,{dataFrames:x,getLinks:l})})})}function Qa(e,{exploreId:s}){return{range:e.explore.panes[s].range}}const Ua=(0,Re.connect)(Qa,{})(za);var bt=i(25508),Ga=i(10059),qa=i(33405);const Ka=e=>{const s=(0,X.qq)(e);return{getQueries:(0,bt.Mz)(s,n=>n.queries),getQueryResponse:(0,bt.Mz)(s,n=>n.queryResponse),getHistory:(0,bt.Mz)(s,n=>n.history),getEventBridge:(0,bt.Mz)(s,n=>n.eventBridge),getDatasourceInstanceSettings:(0,bt.Mz)(s,n=>(0,Ga.tR)().getInstanceSettings(n.datasourceInstance?.uid))}},Za=({exploreId:e})=>{const s=(0,D.useDispatch)(),{getQueries:n,getDatasourceInstanceSettings:o,getQueryResponse:r,getHistory:a,getEventBridge:l}=(0,c.useMemo)(()=>Ka(e),[e]),p=(0,D.useSelector)(n),g=(0,D.useSelector)(o),x=(0,D.useSelector)(r),d=(0,D.useSelector)(a),h=(0,D.useSelector)(l),f=(0,c.useCallback)(()=>{s((0,Y.Od)({exploreId:e}))},[s,e]),m=(0,c.useCallback)(L=>{s((0,Y.bO)({exploreId:e,queries:L}))},[s,e]),j=(0,c.useCallback)(L=>{m([...p,{...L,refId:(0,Bs.M)(p)}])},[m,p]),y=()=>{(0,M.rR)("grafana_explore_query_row_copy")},S=()=>{(0,M.rR)("grafana_explore_query_row_remove")},b=L=>{(0,M.rR)("grafana_query_row_toggle",L===void 0?{}:{queryEnabled:L})};return(0,t.jsx)(qa.L,{dsSettings:g,queries:p,onQueriesChange:m,onAddQuery:j,onRunQueries:f,onQueryCopied:y,onQueryRemoved:S,onQueryToggled:b,data:x,app:Ue.Jk.Explore,history:d,eventBus:h,queryRowWrapper:(L,R)=>(0,t.jsx)(Le,{title:R,icon:"arrow",panelId:"Queries",customTopOffset:-10,level:"child",children:L},R)})};var qt=i(39736),bs=i(88023),Ya=i(40828),Ja=i(91793),Xa=i(83605),_a=i(84657),En=i(15938);const Ct={wrapper:(0,u.css)({height:"100%",overflow:"scroll"}),switchWrapper:(0,u.css)({display:"flex",flexDirection:"row",marginBottom:0}),switchLabel:(0,u.css)({marginLeft:"15px",marginBottom:0}),switch:(0,u.css)({marginLeft:"10px"}),resultCount:(0,u.css)({marginBottom:"4px"}),header:(0,u.css)({display:"flex",justifyContent:"space-between",alignItems:"center",padding:"10px 0",fontSize:"12px",lineHeight:1.25})},ei=480,ti=2,si=e=>{const{tableResult:s}=e,n=(0,se.cloneDeep)(s),o=(0,c.useRef)(null),r=n.fields.filter(m=>m.name.includes("Value")),a=(0,En.E)(n),{width:l}=(0,vs.A)(),[p,g]=(0,c.useState)(l<=ei||r.length>ti),x=()=>{g(!p);const m={isExpanded:!p};(0,M.rR)("grafana_explore_prometheus_instant_query_ui_raw_toggle_expand",m)};(0,c.useEffect)(()=>{o.current?.resetAfterIndex(0,!0)},[p]);const d=m=>{if(m<10){let S=0;for(let b=0;b<m;b++)S+=h(b,!0);return Math.min(600,S)}return 600},h=(m,j)=>{if(!j)return 32;const b=a[m];return 1.5*32+(Object.keys(b).length-r.length)*22},f=`isExpandedView ${(0,c.useId)()}`;return(0,t.jsxs)("section",{children:[(0,t.jsxs)("header",{className:Ct.header,children:[(0,t.jsx)(ke.D,{className:Ct.switchWrapper,label:"Expand results",htmlFor:"isExpandedView",children:(0,t.jsx)("div",{className:Ct.switch,children:(0,t.jsx)(Ge.d,{onChange:x,id:f,value:p,label:"Expand results"})})}),(0,t.jsxs)("div",{className:Ct.resultCount,children:["Result series: ",a.length]})]}),(0,t.jsx)("div",{role:"table",children:(0,t.jsxs)(t.Fragment,{children:[r.length>1&&!p&&(0,t.jsx)(Xa.d,{valueLabels:r,expanded:p}),(0,t.jsx)(Ja._m,{ref:o,itemCount:a.length,className:Ct.wrapper,itemSize:m=>h(m,p),height:d(a.length),width:"100%",children:({index:m,style:j})=>{let y;return p&&(y=r.filter(S=>{const b=a[m][S.name];return b&&b!==En.M})),(0,t.jsx)("div",{role:"row",style:{...j,overflow:"hidden"},children:(0,t.jsx)(_a.Ay,{isExpandedView:p,valueLabels:y,totalNumberOfValues:r.length,listKey:a[m].__name__,listItemData:a[m]})})}})]})})]})};function ni(e,{exploreId:s}){const o=e.explore.panes[s],{tableResult:r,rawPrometheusResult:a,range:l,queryResponse:p}=o,g=a?[a]:[],x=(r?.length??0)>0&&a?r:g;return{loading:p.state,tableResult:x,range:l}}const oi=(0,Re.connect)(ni,{});class ri extends c.PureComponent{constructor(s){super(s),this.onChangeResultsStyle=n=>{this.setState({resultsStyle:n})},this.renderLabel=()=>{const n=(0,u.css)({display:"flex",justifyContent:"space-between",flex:"1"}),o=is.jH.map(r=>({value:r,label:r[0].toUpperCase()+r.slice(1).replace(/_/," ")}));return(0,t.jsx)("div",{className:n,children:(0,t.jsx)(Wt.z,{onClick:()=>{const r={state:this.state.resultsStyle===D.TABLE_RESULTS_STYLE.table?D.TABLE_RESULTS_STYLE.raw:D.TABLE_RESULTS_STYLE.table};(0,M.rR)("grafana_explore_prometheus_instant_query_ui_toggle_clicked",r)},size:"sm",options:o,value:this.state?.resultsStyle,onChange:this.onChangeResultsStyle})})},s.showRawPrometheus&&(this.state={resultsStyle:D.TABLE_RESULTS_STYLE.raw})}getTableHeight(){const{tableResult:s}=this.props;return!s||s.length===0?200:Math.max(Math.min(600,s[0].length*35)+35)}render(){const{loading:s,onCellFilterAdded:n,tableResult:o,width:r,splitOpenFn:a,range:l,ariaLabel:p,timeZone:g}=this.props,x=this.getTableHeight(),d=r-bs.$W.theme.panelPadding*2-Ya.IZ;let h=o;const f=(0,Qe.YV)(a,l);h?.length&&(h=(0,Qt.we)({data:h,timeZone:g,theme:bs.$W.theme2,replaceVariables:(0,qt.w)().replace.bind((0,qt.w)()),fieldConfig:{defaults:{},overrides:[]},dataLinkPostProcessor:f}));const m=h?.filter(b=>!!b&&b.length!==0),j=this.state.resultsStyle===D.TABLE_RESULTS_STYLE.raw?"Raw":"Table",y=this.state?.resultsStyle!==void 0?this.renderLabel():"Table",S=!this.state?.resultsStyle||this.state?.resultsStyle===D.TABLE_RESULTS_STYLE.table;return(0,t.jsxs)(Me.NR,{title:j,actions:y,loadingState:s,children:[m?.length&&(0,t.jsxs)(t.Fragment,{children:[S&&(0,t.jsx)(us.X,{ariaLabel:p,data:m[0],width:d,height:x,onCellFilterAdded:n}),this.state?.resultsStyle===D.TABLE_RESULTS_STYLE.raw&&(0,t.jsx)(si,{tableResult:m[0]})]}),!m?.length&&(0,t.jsx)(ds,{metaItems:[{value:"0 series returned"}]})]})}}const ai=oi(ri);var ii=i(22669);const li=e=>{const s=(0,c.useRef)(null),n={transition:`opacity ${e.duration}ms linear`,opacity:0},o={exited:{opacity:0,display:"none"},entering:{opacity:0},entered:{opacity:1},exiting:{opacity:0}};return(0,t.jsx)(ii.Ay,{in:e.in,timeout:e.duration,unmountOnExit:e.unmountOnExit||!1,onExited:e.onExited,nodeRef:s,children:r=>(0,t.jsx)("div",{ref:s,style:{...n,...o[r]},children:e.children})})},ci=e=>{const{queryError:s}=e,n=!!s,o=n?100:10,r=s?"Query error":"Unknown error",a=s?.message||s?.data?.message||null;return(0,t.jsx)(li,{in:n,duration:o,children:(0,t.jsx)(st.F,{severity:"error",title:r,topSpacing:2,children:a})})};function di(e){const s=(0,D.useSelector)(o=>o.explore.panes[e.exploreId].queryResponse),n=s?.state===xe.Gu.Error?s?.error:void 0;return n?.refId?null:(0,t.jsx)(ci,{queryError:n})}var he=i(14453),On=i(59485);const ui=e=>({containerMargin:(0,u.css)({display:"flex",flexWrap:"wrap",gap:e.spacing(1),marginTop:e.spacing(2)})});function pi({addQueryRowButtonDisabled:e,addQueryRowButtonHidden:s,onClickAddQueryRowButton:n,onClickQueryInspectorButton:o,onSelectQueryFromLibrary:r,queryInspectorButtonActive:a}){const l=(0,k.$j)(),p=ui(l),g=(0,D.useSelector)(X.Kl),x=(0,he.TR)(),d=g.dsToExplore.map(m=>x.find(j=>j.uid===m.datasource?.uid)?.name).filter(m=>!!m&&m!==et.uv),{queryLibraryEnabled:h,openDrawer:f}=(0,On.Y)();return(0,t.jsxs)("div",{className:p.containerMargin,children:[!s&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(ce.I,{variant:"canvas","aria-label":(0,v.t)("explore.secondary-actions.query-add-button-aria-label","Add query"),onClick:n,disabled:e,icon:"plus",children:(0,t.jsx)(v.x6,{i18nKey:"explore.secondary-actions.query-add-button",children:"Add query"})}),h&&(0,t.jsx)(ce.I,{"aria-label":(0,v.t)("explore.secondary-actions.add-from-query-library","Add query from library"),variant:"canvas",onClick:()=>f(d,r),icon:"plus",children:(0,t.jsx)(v.x6,{i18nKey:"explore.secondary-actions.add-from-query-library",children:"Add query from library"})})]}),(0,t.jsx)(ce.I,{variant:a?"active":"canvas","aria-label":(0,v.t)("explore.secondary-actions.query-inspector-button-aria-label","Query inspector"),onClick:o,icon:"info-circle",children:(0,t.jsx)(v.x6,{i18nKey:"explore.secondary-actions.query-inspector-button",children:"Query inspector"})})]})}var Dn=i(50959),gi=i(13388);const An=20;function hi(e,{exploreId:s}){const o=e.explore.panes[s],{tableResult:r,range:a}=o,l=(0,Y.h1)(s);return{loading:r&&r.length>0?!1:l,tableResult:r,range:a}}const fi=(0,Re.connect)(hi,{});class Nn extends c.PureComponent{constructor(){super(...arguments),this.state={showAll:!1},this.hasSubFrames=s=>s.fields.some(n=>n.type===vt.PU.nestedFrames)}getTableHeight(s,n){return s===0?200:Math.min(600,Math.max(s*36,n?300:0)+40+46)}getTableTitle(s,n,o){let r=n.name;return!r&&(s?.length??0)>1&&(r=n.refId||`${o}`),r?(0,v.t)("explore.table.title-with-name","Table - {{name}}",{name:r,interpolation:{escapeValue:!1}}):(0,v.t)("explore.table.title","Table")}showAll(){this.setState({showAll:!0})}render(){const{loading:s,onCellFilterAdded:n,tableResult:o,width:r,splitOpenFn:a,range:l,ariaLabel:p,timeZone:g,theme:x}=this.props,{showAll:d}=this.state;let h=(0,Dn.gy)(o)?(0,Dn.S5)(o):o;const f=(0,Qe.YV)(a,l);let m=!1;h?.length&&(h=h.map(y=>(y.fields.forEach((S,b)=>{const L=d?!1:b>=An;S.config.custom={hidden:L},m=m||L}),y)),h=(0,Qt.we)({data:h,timeZone:g,theme:bs.$W.theme2,replaceVariables:(0,qt.w)().replace.bind((0,qt.w)()),fieldConfig:{defaults:{},overrides:[]},dataLinkPostProcessor:f}));const j=h?.filter(y=>!!y&&y.length!==0);return(0,t.jsxs)(t.Fragment,{children:[j&&j.length===0&&(0,t.jsx)(Me.NR,{title:(0,v.t)("explore.table.title","Table"),width:r,height:200,children:()=>(0,t.jsx)(ds,{metaItems:[{value:(0,v.t)("explore.table.no-data","0 series returned")}]})}),j&&j.length>0&&(0,t.jsx)("div",{className:(0,u.css)({display:"flex",flexDirection:"column",gap:x.spacing(1)}),children:j.map((y,S)=>(0,t.jsx)(Me.NR,{title:this.getTableTitle(h,y,S),titleItems:[!d&&m&&(0,t.jsx)(gi.m,{toggleShowAllSeries:()=>this.showAll(),info:(0,t.jsxs)(v.x6,{i18nKey:"table.container.show-only-series",children:["Showing only ",{MAX_NUMBER_OF_COLUMNS:An}," columns"]}),tooltip:(0,v.t)("table.container.content","Showing too many columns in a single table may impact performance and make data harder to read. Consider refining your queries."),buttonLabel:(0,t.jsx)(v.x6,{i18nKey:"table.container.show-all-series",children:"Show all columns"})})],width:r,height:this.getTableHeight(y.length,this.hasSubFrames(y)),loadingState:s?xe.Gu.Loading:void 0,children:(b,L)=>(0,t.jsx)(us.X,{ariaLabel:p,data:y,width:b,height:L,onCellFilterAdded:n})},y.refId||`table-${S}`))})]})}}const nc=(0,k.cV)(Nn),mi=(0,k.cV)(fi(Nn));var xi=i(62884),yi=i(27072);function vi(e){const s=e.dataFrames[0],{dataFrames:n,splitOpenFn:o,exploreId:r,scrollElement:a}=e,l=(0,c.useMemo)(()=>(0,yi.L)(s),[s]),p=(0,D.useSelector)(g=>g.explore.panes[e.exploreId]?.datasourceInstance??void 0);return l?(0,t.jsx)(Me.NR,{padding:"none",title:"Trace",children:(0,t.jsx)(xi.V,{exploreId:r,dataFrames:n,splitOpenFn:o,scrollElement:a,traceProp:l,datasource:p})}):null}const bi=e=>({exploreMain:(0,u.css)({label:"exploreMain",position:"relative",marginTop:"21px",display:"flex",flexDirection:"column",gap:e.spacing(1)}),queryContainer:(0,u.css)({label:"queryContainer",padding:e.spacing(1)}),exploreContainer:(0,u.css)({label:"exploreContainer",display:"flex",flexDirection:"column",paddingRight:e.spacing(2),marginBottom:e.spacing(2)}),wrapper:(0,u.css)({position:"absolute",top:0,left:e.spacing(2),right:0,bottom:0,display:"flex"})});class Ci extends c.PureComponent{constructor(s){super(s),this.onChangeTime=n=>{const{updateTimeRange:o,exploreId:r}=this.props;o({exploreId:r,rawRange:n})},this.onClickExample=n=>{this.props.setQueries(this.props.exploreId,[n])},this.onCellFilterAdded=n=>{const{value:o,key:r,operator:a}=n;a===Et.mc&&this.onClickFilterLabel(r,o),a===Et.Zi&&this.onClickFilterOutLabel(r,o)},this.onContentOutlineToogle=()=>{Ft.M.set(Dt.visible,!this.state.contentOutlineVisible),this.setState(n=>((0,M.rR)("explore_toolbar_contentoutline_clicked",{item:"outline",type:n.contentOutlineVisible?"close":"open"}),{contentOutlineVisible:!n.contentOutlineVisible}))},this.isFilterLabelActive=async(n,o,r)=>{const a=this.props.queries.find(p=>p.refId===r);if(!a)return!1;const l=await(0,ze.l)().get(a.datasource);return!!((0,oe.FP)(l)&&l.queryHasFilter(a,{key:n,value:o.toString()}))},this.onClickFilterLabel=(n,o,r)=>{this.onModifyQueries({type:"ADD_FILTER",options:{key:n,value:o.toString()},frame:r},r?.refId)},this.onClickFilterOutLabel=(n,o,r)=>{this.onModifyQueries({type:"ADD_FILTER_OUT",options:{key:n,value:o.toString()},frame:r},r?.refId)},this.onClickFilterString=(n,o)=>{this.onModifyQueries({type:"ADD_STRING_FILTER",options:{value:n.toString()}},o)},this.onClickFilterOutString=(n,o)=>{this.onModifyQueries({type:"ADD_STRING_FILTER_OUT",options:{value:n.toString()}},o)},this.onClickAddQueryRowButton=()=>{const{exploreId:n,queryKeys:o}=this.props;this.props.addQueryRow(n,o.length)},this.onModifyQueries=(n,o)=>{const r=async(a,l)=>{if(o&&o!==a.refId)return a;const{datasource:p}=a;if(p==null)return a;const g=await(0,ze.l)().get(p),x=["ADD_FILTER","ADD_FILTER_OUT"];return(0,oe.FP)(g)&&x.includes(l.type)?g.toggleQueryFilter(a,{type:l.type==="ADD_FILTER"?"FILTER_FOR":"FILTER_OUT",options:l.options??{},frame:l.frame}):g.modifyQuery?g.modifyQuery(a,l):a};this.props.modifyQueries(this.props.exploreId,n,r)},this.onResize=n=>{this.props.changeSize(this.props.exploreId,n)},this.onStartScanning=()=>{this.props.scanStart(this.props.exploreId)},this.onStopScanning=()=>{this.props.scanStopAction({exploreId:this.props.exploreId})},this.onUpdateTimeRange=n=>{const{exploreId:o,updateTimeRange:r}=this.props;r({exploreId:o,absoluteRange:n})},this.onSplitOpen=n=>async o=>{if(this.props.splitOpen(o),o&&this.props.datasourceInstance){const r=(await(0,ze.l)().get(o.datasourceUid)).type,a=this.props.datasourceInstance.uid===et.uv?(0,se.get)(this.props.queries,"0.datasource.type"):this.props.datasourceInstance.type,l={origin:"panel",panelType:n,source:a,target:r,exploreId:this.props.exploreId};(0,M.rR)("grafana_explore_split_view_opened",l)}},this.onPinLineCallback=()=>{this.setState({contentOutlineVisible:!0})},this.splitOpenFnLogs=this.onSplitOpen("logs"),this.state={contentOutlineVisible:Ft.M.getBool(Dt.visible,!0)},this.graphEventBus=s.eventBus.newScopedBus("graph",{onlyLocal:!1}),this.logsEventBus=s.eventBus.newScopedBus("logs",{onlyLocal:!1})}renderEmptyState(s){return(0,t.jsx)("div",{className:(0,u.cx)(s),children:(0,t.jsx)(Ha,{})})}renderNoData(){return(0,t.jsx)(Pa,{})}renderCustom(s){const{timeZone:n,queryResponse:o,eventBus:r}=this.props,a=(0,se.groupBy)(o?.customFrames,"meta.preferredVisualisationPluginId");return Object.entries(a).map(([l,p],g)=>(0,t.jsx)(Le,{panelId:l,title:l,icon:"plug",children:(0,t.jsx)(ko,{timeZone:n,pluginId:l,frames:p,state:o.state,timeRange:o.timeRange,height:400,width:s,splitOpenFn:this.onSplitOpen(l),eventBus:r},g)},g))}renderGraphPanel(s){const{graphResult:n,timeZone:o,queryResponse:r,showFlameGraph:a}=this.props;return(0,t.jsx)(Le,{panelId:"Graph",title:"Graph",icon:"graph-bar",children:(0,t.jsx)(ir.y,{data:n,height:a?180:400,width:s,timeRange:r.timeRange,timeZone:o,onChangeTime:this.onUpdateTimeRange,annotations:r.annotations,splitOpenFn:this.onSplitOpen("graph"),loadingState:r.state,eventBus:this.graphEventBus})})}renderTablePanel(s){const{exploreId:n,timeZone:o}=this.props;return(0,t.jsx)(Le,{panelId:"Table",title:"Table",icon:"table",children:(0,t.jsx)(mi,{ariaLabel:tt.Tp.pages.Explore.General.table,width:s,exploreId:n,onCellFilterAdded:this.onCellFilterAdded,timeZone:o,splitOpenFn:this.onSplitOpen("table")})})}renderRawPrometheus(s){const{exploreId:n,datasourceInstance:o,timeZone:r}=this.props;return(0,t.jsx)(Le,{panelId:"Raw Prometheus",title:"Raw Prometheus",icon:"gf-prometheus",children:(0,t.jsx)(ai,{showRawPrometheus:!0,ariaLabel:tt.Tp.pages.Explore.General.table,width:s,exploreId:n,onCellFilterAdded:o?.modifyQuery?this.onCellFilterAdded:void 0,timeZone:r,splitOpenFn:this.onSplitOpen("table")})})}renderLogsPanel(s){const{exploreId:n,syncedTimes:o,theme:r,queryResponse:a}=this.props,l=parseInt(r.spacing(2).slice(0,-2),10),p=(0,u.css)({display:"flex",flexDirection:"column",gap:r.spacing(1)});return(0,t.jsx)(Le,{panelId:"Logs",title:"Logs",icon:"gf-logs",className:p,children:(0,t.jsx)(Da,{exploreId:n,loadingState:a.state,syncedTimes:o,width:s-l,onClickFilterLabel:this.onClickFilterLabel,onClickFilterOutLabel:this.onClickFilterOutLabel,onStartScanning:this.onStartScanning,onStopScanning:this.onStopScanning,eventBus:this.logsEventBus,splitOpenFn:this.splitOpenFnLogs,scrollElement:this.scrollElement,isFilterLabelActive:this.isFilterLabelActive,onClickFilterString:this.onClickFilterString,onClickFilterOutString:this.onClickFilterOutString,onPinLineCallback:this.onPinLineCallback})})}renderLogsSamplePanel(){const{logsSample:s,timeZone:n,setSupplementaryQueryEnabled:o,exploreId:r,datasourceInstance:a,queries:l}=this.props;return(0,t.jsx)(Le,{panelId:"Logs Sample",title:"Logs Sample",icon:"gf-logs",children:(0,t.jsx)(Aa,{queryResponse:s.data,timeZone:n,enabled:s.enabled,queries:l,datasourceInstance:a,splitOpen:this.onSplitOpen("logsSample"),setLogsSampleEnabled:p=>o(r,p,oe.cF.LogsSample)})})}renderNodeGraphPanel(){const{exploreId:s,showTrace:n,queryResponse:o,datasourceInstance:r}=this.props,a=r?r?.type:"unknown";return(0,t.jsx)(Le,{panelId:"Node Graph",title:"Node Graph",icon:"code-branch",children:(0,t.jsx)(Ua,{dataFrames:o.nodeGraphFrames,exploreId:s,withTraceView:n,datasourceType:a,splitOpenFn:this.onSplitOpen("nodeGraph")})})}renderFlameGraphPanel(){const{queryResponse:s}=this.props;return(0,t.jsx)(Le,{panelId:"Flame Graph",title:"Flame Graph",icon:"fire",children:(0,t.jsx)(rr,{dataFrames:s.flameGraphFrames})})}renderTraceViewPanel(){const{queryResponse:s,exploreId:n}=this.props,o=s.series.filter(r=>r.meta?.preferredVisualisationType==="trace");return o.length&&(0,t.jsx)(Le,{panelId:"Traces",title:"Traces",icon:"file-alt",children:(0,t.jsx)(vi,{exploreId:n,dataFrames:o,splitOpenFn:this.onSplitOpen("traceView"),scrollElement:this.scrollElement})})}render(){const{datasourceInstance:s,exploreId:n,graphResult:o,queryResponse:r,isLive:a,theme:l,showMetrics:p,showTable:g,showRawPrometheus:x,showLogs:d,showTrace:h,showCustom:f,showNodeGraph:m,showFlameGraph:j,showLogsSample:y,correlationEditorDetails:S,correlationEditorHelperData:b,showQueryInspector:L,setShowQueryInspector:R}=this.props,{contentOutlineVisible:C}=this.state,I=bi(l),T=r&&r.state!==xe.Gu.NotStarted,O=!(0,ft.gQ)().queryHistoryAvailable,$=r.state===xe.Gu.Done&&[r.logsFrames,r.graphFrames,r.nodeGraphFrames,r.flameGraphFrames,r.tableFrames,r.rawPrometheusFrames,r.traceFrames,r.customFrames].every(H=>H.length===0);let W;const G=S?.editorMode;!!(G||S?.correlationDirty)&&b!==void 0&&(W=(0,t.jsx)(Eo,{exploreId:n,correlations:b}));const ae=["prometheus","loki","tempo","grafana-pyroscope-datasource"].includes(s?.type||"");return(0,t.jsxs)(vo,{refreshDependencies:this.props.queries,children:[(0,t.jsx)(nr,{exploreId:n,onChangeTime:this.onChangeTime,onContentOutlineToogle:this.onContentOutlineToogle,isContentOutlineOpen:C}),(0,t.jsx)("div",{style:{position:"relative",height:"100%",paddingLeft:l.spacing(2)},children:(0,t.jsxs)("div",{className:I.wrapper,children:[C&&(0,t.jsx)(So,{scroller:this.scrollElement,panelId:`content-outline-container-${n}`}),(0,t.jsx)(_t.P,{"data-testid":tt.Tp.pages.Explore.General.scrollView,ref:H=>this.scrollElement=H||void 0,children:(0,t.jsx)("div",{className:I.exploreContainer,children:s?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(Le,{panelId:"Queries",title:"Queries",icon:"arrow",mergeSingleChild:!0,children:(0,t.jsxs)(es._,{className:I.queryContainer,children:[ae&&(0,t.jsx)(st.F,{severity:"info",title:(0,v.t)("explore.drilldownInfo.title","Explore Metrics, Logs, Traces and Profiles have moved!"),children:(0,t.jsxs)(A.B,{gap:1,alignItems:"flex-end",justifyContent:"space-between",children:[(0,t.jsx)("span",{children:(0,t.jsxs)(v.x6,{i18nKey:"explore.drilldownInfo.description",children:["Looking for the Grafana Explore apps? They are now called the Grafana Drilldown apps and can be found under ",(0,t.jsx)("b",{children:"Menu > Drilldown"})]})}),(0,t.jsx)(B.z9,{variant:"secondary",href:"/drilldown",children:(0,t.jsx)(v.x6,{i18nKey:"explore.drilldownInfo.action",children:"Go to Grafana Drilldown"})})]})}),W,(0,t.jsx)(Za,{exploreId:n}),(0,t.jsx)(pi,{addQueryRowButtonDisabled:a||G&&s.meta.mixed,addQueryRowButtonHidden:!1,richHistoryRowButtonHidden:O,queryInspectorButtonActive:L,onClickAddQueryRowButton:this.onClickAddQueryRowButton,onClickQueryInspectorButton:()=>R(!L),onSelectQueryFromLibrary:async H=>{const{changeDatasource:K,queries:le,setQueries:F}=this.props,N=[...le,{...H,refId:(0,Bs.M)(le)}];if(F(n,N),H.datasource?.uid){const _={uid:new Set(N.map(ue=>ue.datasource?.uid)).size>1?et.uv:H.datasource.uid};s.uid!==_.uid&&await K({exploreId:n,datasource:_})}}}),(0,t.jsx)(di,{exploreId:n})]})}),(0,t.jsx)(fo.default,{onResize:this.onResize,disableHeight:!0,children:({width:H})=>H===0?null:(0,t.jsx)("main",{className:(0,u.cx)(I.exploreMain),style:{width:H},children:(0,t.jsx)(ne.Xw,{children:T&&(0,t.jsxs)(t.Fragment,{children:[p&&o&&(0,t.jsx)(ne.Xw,{children:this.renderGraphPanel(H)}),x&&(0,t.jsx)(ne.Xw,{children:this.renderRawPrometheus(H)}),g&&(0,t.jsx)(ne.Xw,{children:this.renderTablePanel(H)}),d&&(0,t.jsx)(ne.Xw,{children:this.renderLogsPanel(H)}),m&&(0,t.jsx)(ne.Xw,{children:this.renderNodeGraphPanel()}),j&&(0,t.jsx)(ne.Xw,{children:this.renderFlameGraphPanel()}),h&&(0,t.jsx)(ne.Xw,{children:this.renderTraceViewPanel()}),y&&(0,t.jsx)(ne.Xw,{children:this.renderLogsSamplePanel()}),f&&(0,t.jsx)(ne.Xw,{children:this.renderCustom(H)}),$&&(0,t.jsx)(ne.Xw,{children:this.renderNoData()})]})})})})]}):this.renderEmptyState(I.exploreContainer)})})]})})]})}}function Si(e,{exploreId:s}){const n=e.explore,{syncedTimes:o}=n,r=n.panes[s],a=(0,Ot.O)(e.user),{datasourceInstance:l,queryKeys:p,queries:g,isLive:x,graphResult:d,tableResult:h,logsResult:f,showLogs:m,showMetrics:j,showTable:y,showTrace:S,showCustom:b,queryResponse:L,showNodeGraph:R,showFlameGraph:C,showRawPrometheus:I,supplementaryQueries:T,correlationEditorHelperData:O}=r,$=(0,Y.h1)(s)(e),W=T[oe.cF.LogsSample],G=!!(W.dataProvider!==void 0&&!f&&(d||h));return{datasourceInstance:l,queryKeys:p,queries:g,isLive:x,graphResult:d,logsResult:f??void 0,queryResponse:L,syncedTimes:o,timeZone:a,showLogs:m,showMetrics:j,showTable:y,showTrace:S,showCustom:b,showNodeGraph:R,showRawPrometheus:I,showFlameGraph:C,splitted:(0,X.pF)(e),loading:$,logsSample:W,showLogsSample:G,correlationEditorHelperData:O,correlationEditorDetails:n.correlationEditorDetails,exploreActiveDS:(0,X.Kl)(e)}}const ji={changeDatasource:$e.wh,changeSize:Pe.QZ,modifyQueries:Y.PD,scanStart:Y.GI,scanStopAction:Y.q9,setQueries:Y.Rk,updateTimeRange:je.GH,addQueryRow:Y._0,splitOpen:J.ve,setSupplementaryQueryEnabled:Y.TO},Ti=(0,Re.connect)(Si,ji),Ri=(0,k.cV)(Ti(Ci));var Pn=i(3567),Li=i(16568),Ii=i(67042),wi=i(96226),Fi=i(94681),Ei=i(64050);function Oi(e){const{onClose:s,queryResponse:n,timeZone:o,isMixed:r,exploreId:a}=e,[l,p]=(0,c.useState)({withTransforms:!1,withFieldConfig:!0}),g=n?.series||[];let x=n?.errors;!x?.length&&n?.error&&(x=[n.error]);const d=(0,k.of)(Ni);(0,c.useEffect)(()=>{(0,M.rR)("grafana_explore_query_inspector_opened")},[]);const h={label:"Stats",value:"stats",icon:"chart-line",content:(0,t.jsx)(Fi.N,{data:n,timeZone:n?.request?.timezone??re.vp})},f={label:"JSON",value:"json",icon:"brackets-curly",content:(0,t.jsx)(wi.w,{data:n,onClose:s})},m={label:"Data",value:"data",icon:"database",content:(0,t.jsx)(Li.q,{data:g,dataName:"Explore",isLoading:n.state===xe.Gu.Loading,options:l,timeZone:o,app:Ue.Jk.Explore,formattedDataDescription:"Matches the format in the panel",onOptionsChange:p})},j={label:"Query",value:"query",icon:"info-circle",content:(0,t.jsx)("div",{className:d.queryInspectorWrapper,children:(0,t.jsx)(Ei.e,{instanceId:r?(0,et.qM)(0,(0,ht.uq)(a)):(0,ht.uq)(a),data:n,onRefreshQuery:()=>e.runQueries({exploreId:a})})})},y=[h,j,f,m];if(x?.length){const S={label:"Error",value:"error",icon:"exclamation-triangle",content:(0,t.jsx)(Ii.y,{errors:x})};y.push(S)}return(0,t.jsx)(ks,{children:(0,t.jsx)(Pn.q,{tabs:y,onClose:s,closeIconTooltip:"Close query inspector"})})}function Di(e,{exploreId:s}){const o=e.explore.panes[s],{queryResponse:r}=o;return{queryResponse:r,isMixed:o.datasourceInstance?.meta.mixed||!1}}const Ai={runQueries:Y.Od},Ni=e=>({queryInspectorWrapper:(0,u.css)({paddingBottom:e.spacing(3)})}),Pi=(0,Re.connect)(Di,Ai)(Oi),ki=(0,u.css)({label:"explorePaneContainer",display:"flex",flexDirection:"column",minWidth:"600px",height:"100%"});function Mi({exploreId:e}){$i(e);const s=(0,c.useRef)(new ho.o),n=(0,c.useRef)(null),[o,r]=(0,c.useState)(!1);return(0,c.useEffect)(()=>{const a=s.current;return()=>a.removeAllListeners()},[]),(0,t.jsxs)("div",{className:ki,ref:n,"data-testid":tt.Tp.pages.Explore.General.container,children:[(0,t.jsx)(Ri,{exploreId:e,eventBus:s.current,showQueryInspector:o,setShowQueryInspector:r}),o&&(0,t.jsx)(Pi,{exploreId:e,onClose:()=>r(!1),timeZone:(0,Ms.O)()})]})}function Bi(e,s){return{pane:e.explore.panes[s.exploreId]}}const Hi=(0,Re.connect)(Bi)(Mi);function $i(e){const s=(0,c.useMemo)(()=>(0,X.qq)(e),[e]),n=(0,c.useRef)();n.current=(0,D.useSelector)(s),(0,c.useEffect)(()=>()=>{(0,ht._u)(n.current?.querySubscription)},[])}var Oe=i(1895);const Vi={queryLibrary:(0,v.t)("explore.rich-history.query-library","Query library"),queryHistory:(0,v.t)("explore.rich-history.query-history","Query history")};var Wi=i(83437),kn=i(22560),qe=i(86833),zi=i(50926),Cs=i(23737),Ss=i(17687),Ke=i(91830);const Qi={setQueries:Y.Rk,changeDatasource:$e.wh},Ui=(0,Re.connect)(void 0,Qi);function Gi({rootDatasourceUid:e,queries:s,disabled:n=!1,onClick:o,changeDatasource:r,setQueries:a}){const[l,p]=(0,c.useState)(!1),g=(0,D.useSelector)(X.pF),x=(0,D.useSelector)(X.Kl),d=(0,D.useSelector)(X.K6),h=(y,S)=>!x.dsToExplore.find(b=>b.datasource.uid===y)?.exploreIds.includes(S),f=(y,S)=>S!==void 0&&y!==void 0&&h(S,y)?{fallbackText:"Switch data source and run query",translation:(0,v.t)("explore.run-query.switch-datasource-button","Switch data source and run query")}:{fallbackText:"Run query",translation:(0,v.t)("explore.run-query.run-query-button","Run query")},m=async y=>{const S=h(e,y);S&&await r({exploreId:y,datasource:e}),a(y,s),(0,M.rR)("grafana_explore_query_history_run",{queryHistoryEnabled:Q.$.queryHistoryEnabled,differentDataSource:S})},j=()=>{const y=n||s.length===0||e===void 0;if(g){const S=(0,t.jsx)(We.W,{children:d.map((b,L)=>{const R=f(b[0],e),C=L===0?(0,v.t)("explore.run-query.left-pane","Left pane"):(0,v.t)("explore.run-query.right-pane","Right pane");return(0,t.jsx)(We.W.Item,{ariaLabel:R.fallbackText,onClick:()=>{m(b[0]),o?.()},label:`${C}: ${R.translation}`,disabled:y||b[0]===void 0},L)})});return(0,t.jsx)(xt.m,{onVisibleChange:b=>p(b),placement:"bottom-start",overlay:S,children:(0,t.jsx)(ce.I,{"aria-label":"run query options",variant:"canvas",isOpen:l,children:(0,v.t)("explore.run-query.run-query-button","Run query")})})}else{const S=x.exploreToDS[0]?.exploreId,b=f(S,e);return(0,t.jsx)(B.$n,{variant:"primary","aria-label":b.translation,onClick:()=>{m(S),o?.()},disabled:y||S===void 0,children:b.translation})}};return(0,t.jsx)(t.Fragment,{children:j()})}const qi=Ui(Gi),Ki=({query:e})=>{const[s,n]=(0,c.useState)(!1),{openAddQueryModal:o,queryLibraryEnabled:r}=(0,On.Y)(),a=(0,v.t)("explore.rich-history-card.add-to-library","Add to library");return r&&!s?(0,t.jsx)(t.Fragment,{children:(0,t.jsx)(B.$n,{variant:"secondary","aria-label":a,onClick:()=>{o(e,{onSave:()=>n(!0),context:"richHistory"})},children:a})}):void 0},Zi={changeDatasource:$e.wh,deleteHistoryItem:Oe.VM,commentHistoryItem:Oe.H9,starHistoryItem:Oe.sh,setQueries:Y.Rk},Yi=(0,Re.connect)(void 0,Zi),Ji=e=>{const s="240px",n="170px",o=e.colors.background.secondary;return{queryCard:(0,u.css)({position:"relative",display:"flex",flexDirection:"column",border:`1px solid ${e.colors.border.weak}`,margin:e.spacing(1,0),backgroundColor:o,borderRadius:e.shape.radius.default,".starred":{color:e.v1.palette.orange}}),cardRow:(0,u.css)({display:"flex",alignItems:"center",justifyContent:"space-between",padding:e.spacing(1),borderBottom:"none",":first-of-type":{borderBottom:`1px solid ${e.colors.border.weak}`,padding:e.spacing(.5,1)},img:{height:`${e.typography.fontSize}px`,maxWidth:`${e.typography.fontSize}px`,marginRight:e.spacing(1)}}),queryActionButtons:(0,u.css)({maxWidth:n,display:"flex",justifyContent:"flex-end",fontSize:e.typography.size.base,button:{marginLeft:e.spacing(1)}}),queryContainer:(0,u.css)({fontWeight:e.typography.fontWeightMedium,width:`calc(100% - ${s})`}),updateCommentContainer:(0,u.css)({width:`calc(100% + ${s})`,marginTop:e.spacing(1)}),comment:(0,u.css)({overflowWrap:"break-word",fontSize:e.typography.bodySmall.fontSize,fontWeight:e.typography.fontWeightRegular,marginTop:e.spacing(.5)}),commentButtonRow:(0,u.css)({"> *":{marginTop:e.spacing(1),marginRight:e.spacing(1)}}),textArea:(0,u.css)({width:"100%"}),runButton:(0,u.css)({maxWidth:n,display:"flex",justifyContent:"flex-end",button:{height:"auto",padding:e.spacing(.5,2),lineHeight:1.4,span:{whiteSpace:"normal !important"}}}),loader:(0,u.css)({position:"absolute",width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:e.colors.background.secondary})}};function Xi(e){const{queryHistoryItem:s,commentHistoryItem:n,starHistoryItem:o,deleteHistoryItem:r,datasourceInstances:a}=e,[l,p]=(0,c.useState)(!1),[g,x]=(0,c.useState)(s.comment),d=(0,k.of)(Ji),h=a?a.find(T=>T.uid===s.datasourceUid):void 0,f=async()=>{const T=[...s.queries.map($=>$.datasource?.type||"unknown")];(0,M.rR)("grafana_explore_query_history_copy_query",{datasources:T,mixed:!!h?.meta.mixed});const O=s.queries.map($=>{let W=a?.find(G=>G.uid===s.datasourceUid);return W?.meta.mixed&&(W=a?.find(G=>G.uid===$.datasource?.uid)),(0,he.Ax)($,W)}).join(`
`);(0,ht.uJ)(O),(0,yt.JD)((0,Cs.dx)((0,Ss.tZ)((0,v.t)("explore.rich-history-notification.query-copied","Query copied to clipboard"))))},m=async()=>{const T=(0,he.U3)(s);await(0,$t.VP)(T)},j=()=>{const T=O=>{r(O),(0,yt.JD)((0,Cs.dx)((0,Ss.tZ)((0,v.t)("explore.rich-history-notification.query-deleted","Query deleted")))),(0,M.rR)("grafana_explore_query_history_deleted",{queryHistoryEnabled:Q.$.queryHistoryEnabled})};s.starred?(0,qe.J7)().publish(new Ke.bY({title:(0,v.t)("explore.rich-history-card.delete-query-confirmation-title","Delete"),text:(0,v.t)("explore.rich-history-card.delete-starred-query-confirmation-text","Are you sure you want to permanently delete your starred query?"),yesText:(0,v.t)("explore.rich-history-card.confirm-delete","Delete"),icon:"trash-alt",onConfirm:()=>T(s.id)})):T(s.id)},y=()=>{o(s.id,!s.starred),(0,M.rR)("grafana_explore_query_history_starred",{queryHistoryEnabled:Q.$.queryHistoryEnabled,newValue:!s.starred})},S=()=>p(!l),b=()=>{n(s.id,g),p(!1),(0,M.rR)("grafana_explore_query_history_commented",{queryHistoryEnabled:Q.$.queryHistoryEnabled})},L=()=>{p(!1),x(s.comment)},R=T=>{T.key==="Enter"&&(T.shiftKey||T.ctrlKey)&&b(),T.key==="Escape"&&L()},C=(0,t.jsxs)("div",{className:d.updateCommentContainer,"aria-label":g?(0,v.t)("explore.rich-history-card.update-comment-form","Update comment form"):(0,v.t)("explore.rich-history-card.add-comment-form","Add comment form"),children:[(0,t.jsx)(zi.f,{onKeyDown:R,value:g,placeholder:g?void 0:(0,v.t)("explore.rich-history-card.optional-description","An optional description of what the query does."),onChange:T=>x(T.currentTarget.value),className:d.textArea}),(0,t.jsxs)("div",{className:d.commentButtonRow,children:[(0,t.jsx)(B.$n,{onClick:b,children:(0,t.jsx)(v.x6,{i18nKey:"explore.rich-history-card.save-comment",children:"Save comment"})}),(0,t.jsx)(B.$n,{variant:"secondary",onClick:L,children:(0,t.jsx)(v.x6,{i18nKey:"explore.rich-history-card.cancel",children:"Cancel"})})]})]}),I=(0,t.jsxs)("div",{className:d.queryActionButtons,children:[(0,t.jsx)(nt.K,{name:"comment-alt",onClick:S,tooltip:s.comment?.length>0?(0,v.t)("explore.rich-history-card.edit-comment-tooltip","Edit comment"):(0,v.t)("explore.rich-history-card.add-comment-tooltip","Add comment")}),(0,t.jsx)(nt.K,{name:"copy",onClick:f,tooltip:(0,v.t)("explore.rich-history-card.copy-query-tooltip","Copy query to clipboard")}),h&&(0,t.jsx)(nt.K,{name:"share-alt",onClick:m,tooltip:(0,t.jsx)(v.x6,{i18nKey:"explore.rich-history-card.copy-shortened-link-tooltip",children:"Copy shortened link to clipboard"})}),(0,t.jsx)(nt.K,{name:"trash-alt",title:(0,v.t)("explore.rich-history-card.delete-query-title","Delete query"),tooltip:(0,v.t)("explore.rich-history-card.delete-query-tooltip","Delete query"),onClick:j}),(0,t.jsx)(nt.K,{name:s.starred?"favorite":"star",iconType:s.starred?"mono":"default",onClick:y,tooltip:s.starred?(0,v.t)("explore.rich-history-card.unstar-query-tooltip","Unstar query"):(0,v.t)("explore.rich-history-card.star-query-tooltip","Star query")})]});return(0,t.jsxs)("div",{className:d.queryCard,children:[(0,t.jsxs)("div",{className:d.cardRow,children:[(0,t.jsx)(Mn,{dsApi:h,size:"sm"}),I]}),(0,t.jsxs)("div",{className:(0,u.cx)(d.cardRow),children:[(0,t.jsxs)("div",{className:d.queryContainer,children:[s?.queries.map((T,O)=>{const $=a?.find(W=>W.uid===T.datasource?.uid);return(0,t.jsx)(el,{query:{query:T,datasource:$},showDsInfo:h?.meta.mixed},`${T}-${O}`)}),!l&&s.comment&&(0,t.jsx)("div",{"aria-label":(0,v.t)("explore.rich-history-card.query-comment-label","Query comment"),className:d.comment,children:s.comment}),l&&C]}),!l&&(0,t.jsx)(Ki,{query:s?.queries[0]}),!l&&(0,t.jsx)("div",{className:d.runButton,children:(0,t.jsx)(qi,{queries:s.queries,rootDatasourceUid:h?.uid})})]})]})}const _i=e=>({queryRow:(0,u.css)({borderTop:`1px solid ${e.colors.border.weak}`,display:"flex",flexDirection:"row",padding:e.spacing(.5,0),gap:e.spacing(.5),":first-child":{borderTop:"none"}}),dsInfoContainer:(0,u.css)({display:"flex",alignItems:"center"}),queryText:(0,u.css)({wordBreak:"break-all"})}),el=({query:e,showDsInfo:s=!1})=>{const n=(0,k.of)(_i);return(0,t.jsxs)("div",{className:n.queryRow,children:[s&&(0,t.jsxs)("div",{className:n.dsInfoContainer,children:[(0,t.jsx)(Mn,{dsApi:e.datasource,size:"md"}),": "]}),(0,t.jsx)("span",{"aria-label":(0,v.t)("explore.rich-history-card.query-text-label","Query text"),className:n.queryText,children:(0,he.Ax)(e.query,e.datasource)})]})},tl=e=>s=>(0,u.css)({display:"flex",alignItems:"center",fontSize:s.typography[e==="sm"?"bodySmall":"body"].fontSize,fontWeight:s.typography.fontWeightMedium,whiteSpace:"nowrap"});function Mn({dsApi:e,size:s}){const n=(0,c.useCallback)(r=>tl(s)(r),[s]),o=(0,k.of)(n);return(0,t.jsxs)("div",{className:o,children:[(0,t.jsx)("img",{src:e?.meta.info.logos.small||"public/img/icn-datasource.svg",alt:e?.type||(0,v.t)("explore.rich-history-card.datasource-not-exist","Data source does not exist anymore"),"aria-label":(0,v.t)("explore.rich-history-card.datasource-icon-label","Data source icon")}),(0,t.jsx)("div",{"aria-label":(0,v.t)("explore.rich-history-card.datasource-name-label","Data source name"),children:e?.name||(0,v.t)("explore.rich-history-card.datasource-not-exist","Data source does not exist anymore")})]})}const Bn=Yi(Xi),sl=(e,s)=>({container:(0,u.css)({display:"flex"}),labelSlider:(0,u.css)({fontSize:e.typography.bodySmall.fontSize,"&:last-of-type":{marginTop:e.spacing(3)},"&:first-of-type":{fontWeight:e.typography.fontWeightMedium,marginBottom:e.spacing(2)}}),containerContent:(0,u.css)({width:"calc(100% - 134px)"}),containerSlider:(0,u.css)({width:"129px",marginRight:e.spacing(1)}),fixedSlider:(0,u.css)({position:"fixed"}),slider:(0,u.css)({bottom:"10px",height:`${s-180}px`,width:"129px",padding:e.spacing(1,0)}),selectors:(0,u.css)({display:"flex",justifyContent:"space-between",flexWrap:"wrap"}),filterInput:(0,u.css)({marginBottom:e.spacing(1)}),multiselect:(0,u.css)({width:"100%",marginBottom:e.spacing(1)}),sort:(0,u.css)({width:"170px"}),sessionName:(0,u.css)({display:"flex",alignItems:"flex-start",justifyContent:"flex-start",marginTop:e.spacing(3),h4:{margin:"0 10px 0 0"}}),heading:(0,u.css)({fontSize:e.typography.h4.fontSize,margin:e.spacing(2,.25,1,.25)}),footer:(0,u.css)({height:"60px",display:"flex",justifyContent:"center",alignItems:"center",fontWeight:e.typography.fontWeightLight,fontSize:e.typography.bodySmall.fontSize,a:{fontWeight:e.typography.fontWeightMedium,marginLeft:e.spacing(.25)}}),queries:(0,u.css)({fontSize:e.typography.bodySmall.fontSize,fontWeight:e.typography.fontWeightRegular,marginLeft:e.spacing(.5)})});function nl(e){const{queries:s,totalQueries:n,loading:o,richHistorySearchFilters:r,updateFilters:a,clearRichHistoryResults:l,loadMoreRichHistory:p,richHistorySettings:g,height:x,listOfDatasources:d,activeDatasources:h}=e,f=(0,k.of)(sl,x);(0,c.useEffect)(()=>{const R=!g.activeDatasourcesOnly&&g.lastUsedDatasourceFilters?g.lastUsedDatasourceFilters:h,C={search:"",sortOrder:he.xB.Descending,datasourceFilters:R,from:0,to:g.retentionPeriod,starred:!1};return a(C),()=>{l()}},[]);const{value:m,loading:j}=(0,ns.A)(async()=>{const C=d.map(I=>I.uid).map(async I=>{try{return(0,ze.l)().get(I)}catch{return Promise.resolve()}});return C!==void 0?(await Promise.all(C)).filter(T=>!!T):[]},[r?.datasourceFilters]);if(!r)return(0,t.jsx)("span",{children:(0,t.jsx)(v.x6,{i18nKey:"explore.rich-history-queries-tab.loading",children:"Loading..."})});const y=(0,he.x8)(s,r.sortOrder),S=$n(),b=s.length&&s.length!==n,L=[r.from||0,r.to||g.retentionPeriod];return(0,t.jsxs)("div",{className:f.container,children:[(0,t.jsx)("div",{className:f.containerSlider,children:(0,t.jsxs)("div",{className:f.fixedSlider,children:[(0,t.jsx)("div",{className:f.labelSlider,children:(0,t.jsx)(v.x6,{i18nKey:"explore.rich-history-queries-tab.filter-history",children:"Filter history"})}),(0,t.jsx)("div",{className:f.labelSlider,children:(0,he.IA)(L[0])}),(0,t.jsx)("div",{className:f.slider,children:(0,t.jsx)(Wi.F,{tooltipAlwaysVisible:!1,min:0,max:g.retentionPeriod,value:L,orientation:"vertical",formatTooltipResult:he.IA,reverse:!0,onAfterChange:R=>{a({from:R[0],to:R[1]})}})}),(0,t.jsx)("div",{className:f.labelSlider,children:(0,he.IA)(L[1])})]})}),(0,t.jsxs)("div",{className:f.containerContent,"data-testid":"query-history-queries-tab",children:[(0,t.jsxs)("div",{className:f.selectors,children:[!g.activeDatasourcesOnly&&(0,t.jsx)(Ve.KF,{className:f.multiselect,options:d.map(R=>({value:R.name,label:R.name})),value:r.datasourceFilters,placeholder:(0,v.t)("explore.rich-history-queries-tab.filter-placeholder","Filter queries for data sources(s)"),"aria-label":(0,v.t)("explore.rich-history-queries-tab.filter-aria-label","Filter queries for data sources(s)"),onChange:R=>{a({datasourceFilters:R.map(C=>C.value)})}}),(0,t.jsx)("div",{className:f.filterInput,children:(0,t.jsx)(kn.Z,{escapeRegex:!1,placeholder:(0,v.t)("explore.rich-history-queries-tab.search-placeholder","Search queries"),value:r.search,onChange:R=>a({search:R})})}),(0,t.jsx)("div",{"aria-label":(0,v.t)("explore.rich-history-queries-tab.sort-aria-label","Sort queries"),className:f.sort,children:(0,t.jsx)(Ve.l6,{value:S.filter(R=>R.value===r.sortOrder),options:S,placeholder:(0,v.t)("explore.rich-history-queries-tab.sort-placeholder","Sort queries by"),onChange:R=>a({sortOrder:R.value})})})]}),(o||j)&&(0,t.jsx)("span",{children:(0,t.jsx)(v.x6,{i18nKey:"explore.rich-history-queries-tab.loading-results",children:"Loading results..."})}),!(o||j)&&Object.keys(y).map(R=>(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:f.heading,children:[R," ",(0,t.jsx)("span",{className:f.queries,children:b?(0,t.jsx)(v.x6,{i18nKey:"explore.rich-history-queries-tab.displaying-partial-queries",defaults:"Displaying {{ count }} queries",values:{count:y[R].length}}):(0,t.jsx)(v.x6,{i18nKey:"explore.rich-history-queries-tab.displaying-queries",defaults:"{{ count }} queries",values:{count:y[R].length}})})]}),y[R].map(C=>(0,t.jsx)(Bn,{datasourceInstances:m,queryHistoryItem:C},C.id))]},R)),b?(0,t.jsx)("div",{children:(0,t.jsx)(v.x6,{i18nKey:"explore.rich-history-queries-tab.showing-queries",defaults:"Showing {{ shown }} of {{ total }} <0>Load more</0>",values:{shown:s.length,total:n},components:[(0,t.jsx)(B.$n,{onClick:p,children:"Load more"},"loadMoreButton")]})}):null,(0,t.jsx)("div",{className:f.footer,children:Q.$.queryHistoryEnabled?"":(0,v.t)("explore.rich-history-queries-tab.history-local","The history is local to your browser and is not shared with others.")})]})]})}var ol=i(3835);const rl=e=>({container:(0,u.css)({fontSize:e.typography.bodySmall.fontSize}),spaceBetween:(0,u.css)({marginBottom:e.spacing(3)}),input:(0,u.css)({maxWidth:"200px"}),bold:(0,u.css)({fontWeight:e.typography.fontWeightBold}),bottomMargin:(0,u.css)({marginBottom:e.spacing(1)})}),Hn=[{value:2,label:(0,v.t)("explore.rich-history-settings-tab.retention-period.2-days","2 days")},{value:5,label:(0,v.t)("explore.rich-history-settings-tab.retention-period.5-days","5 days")},{value:7,label:(0,v.t)("explore.rich-history-settings-tab.retention-period.1-week","1 week")},{value:14,label:(0,v.t)("explore.rich-history-settings-tab.retention-period.2-weeks","2 weeks")}];function al(e){const{retentionPeriod:s,starredTabAsFirstTab:n,activeDatasourcesOnly:o,onChangeRetentionPeriod:r,toggleStarredTabAsFirstTab:a,toggleActiveDatasourcesOnly:l,deleteRichHistory:p}=e,g=(0,k.of)(rl),x=Hn.find(h=>h.value===s),d=()=>{(0,qe.J7)().publish(new Ke.bY({title:(0,v.t)("explore.rich-history-settings-tab.delete-title","Delete"),text:(0,v.t)("explore.rich-history-settings-tab.delete-confirm-text","Are you sure you want to permanently delete your query history?"),yesText:(0,v.t)("explore.rich-history-settings-tab.delete-confirm","Delete"),icon:"trash-alt",onConfirm:()=>{p(),(0,yt.JD)((0,Cs.dx)((0,Ss.tZ)((0,v.t)("explore.rich-history-settings-tab.query-history-deleted","Query history deleted"))))}}))};return(0,t.jsxs)("div",{className:g.container,children:[(0,ft.gQ)().changeRetention?(0,t.jsx)(ke.D,{label:(0,v.t)("explore.rich-history-settings-tab.history-time-span","History time span"),description:(0,v.t)("explore.rich-history-settings-tab.history-time-span-description","Select the period of time for which Grafana will save your query history. Up to {{MAX_HISTORY_ITEMS}} entries will be stored.",{MAX_HISTORY_ITEMS:ol.$H}),children:(0,t.jsx)("div",{className:g.input,children:(0,t.jsx)(Ve.l6,{value:x,options:Hn,onChange:r})})}):(0,t.jsx)(st.F,{severity:"info",title:(0,v.t)("explore.rich-history-settings-tab.history-time-span","History time span"),children:(0,v.t)("explore.rich-history-settings-tab.alert-info","Grafana will keep entries up to {{optionLabel}}.Starred entries won't be deleted.",{optionLabel:x?.label})}),(0,t.jsx)(Ee.I,{label:(0,v.t)("explore.rich-history-settings-tab.change-default-tab","Change the default active tab from \u201CQuery history\u201D to \u201CStarred\u201D"),className:g.spaceBetween,children:(0,t.jsx)(Ge.K,{id:"explore-query-history-settings-default-active-tab",value:n,onChange:a})}),(0,ft.gQ)().onlyActiveDataSource&&(0,t.jsx)(Ee.I,{label:(0,v.t)("explore.rich-history-settings-tab.only-show-active-datasource","Only show queries for data source currently active in Explore"),className:g.spaceBetween,children:(0,t.jsx)(Ge.K,{id:"explore-query-history-settings-data-source-behavior",value:o,onChange:l})}),(0,ft.gQ)().clearHistory&&(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:g.bold,children:(0,t.jsx)(v.x6,{i18nKey:"explore.rich-history-settings-tab.clear-query-history",children:"Clear query history"})}),(0,t.jsx)("div",{className:g.bottomMargin,children:(0,t.jsx)(v.x6,{i18nKey:"explore.rich-history-settings-tab.clear-history-info",children:"Delete all of your query history, permanently."})}),(0,t.jsx)(B.$n,{variant:"destructive",onClick:d,children:(0,t.jsx)(v.x6,{i18nKey:"explore.rich-history-settings-tab.clear-query-history-button",children:"Clear query history"})})]})]})}const il=e=>({container:(0,u.css)({display:"flex"}),containerContent:(0,u.css)({width:"100%"}),selectors:(0,u.css)({display:"flex",justifyContent:"space-between",flexWrap:"wrap"}),multiselect:(0,u.css)({width:"100%",marginBottom:e.spacing(1)}),filterInput:(0,u.css)({marginBottom:e.spacing(1)}),sort:(0,u.css)({width:"170px"}),footer:(0,u.css)({height:"60px",display:"flex",justifyContent:"center",alignItems:"center",fontWeight:e.typography.fontWeightLight,fontSize:e.typography.bodySmall.fontSize,a:{fontWeight:e.typography.fontWeightMedium,marginLeft:e.spacing(.25)}})});function ll(e){const{updateFilters:s,clearRichHistoryResults:n,loadMoreRichHistory:o,richHistorySettings:r,queries:a,totalQueries:l,loading:p,richHistorySearchFilters:g}=e,x=(0,k.of)(il),d=(0,D.useSelector)(X.Kl),h=(0,he.TR)();(0,c.useEffect)(()=>{const y=r.activeDatasourcesOnly&&r.lastUsedDatasourceFilters?r.lastUsedDatasourceFilters:d.dsToExplore.map(b=>h.find(L=>L.uid===b.datasource?.uid)?.name).filter(b=>!!b),S={search:"",sortOrder:he.xB.Descending,datasourceFilters:y,from:0,to:r.retentionPeriod,starred:!0};return s(S),()=>{n()}},[]);const{value:f,loading:m}=(0,ns.A)(async()=>{const S=await(g?.datasourceFilters&&g?.datasourceFilters.length>0?g?.datasourceFilters:h.map(b=>b.uid)).map(async b=>{try{return(0,ze.l)().get(b)}catch{return Promise.resolve()}});return S!==void 0?(await Promise.all(S)).filter(L=>!!L):[]},[g?.datasourceFilters]);if(!g)return(0,t.jsxs)("span",{children:[(0,t.jsx)(v.x6,{i18nKey:"explore.rich-history-starred-tab.loading",children:"Loading..."}),";"]});const j=$n();return(0,t.jsx)("div",{className:x.container,children:(0,t.jsxs)("div",{className:x.containerContent,children:[(0,t.jsxs)("div",{className:x.selectors,children:[!r.activeDatasourcesOnly&&(0,t.jsx)(Ve.KF,{className:x.multiselect,options:h.map(y=>({value:y.name,label:y.name})),value:g.datasourceFilters,placeholder:(0,v.t)("explore.rich-history-starred-tab.filter-queries-placeholder","Filter queries for data sources(s)"),"aria-label":(0,v.t)("explore.rich-history-starred-tab.filter-queries-aria-label","Filter queries for data sources(s)"),onChange:y=>{s({datasourceFilters:y.map(S=>S.value)})}}),(0,t.jsx)("div",{className:x.filterInput,children:(0,t.jsx)(kn.Z,{escapeRegex:!1,placeholder:(0,v.t)("explore.rich-history-starred-tab.search-queries-placeholder","Search queries"),value:g.search,onChange:y=>s({search:y})})}),(0,t.jsx)("div",{"aria-label":(0,v.t)("explore.rich-history-starred-tab.sort-queries-aria-label","Sort queries"),className:x.sort,children:(0,t.jsx)(Ve.l6,{value:j.filter(y=>y.value===g.sortOrder),options:j,placeholder:(0,v.t)("explore.rich-history-starred-tab.sort-queries-placeholder","Sort queries by"),onChange:y=>s({sortOrder:y.value})})})]}),p&&m&&(0,t.jsx)("span",{children:(0,t.jsx)(v.x6,{i18nKey:"explore.rich-history-starred-tab.loading-results",children:"Loading results..."})}),!(p&&m)&&a.map(y=>(0,t.jsx)(Bn,{queryHistoryItem:y,datasourceInstances:f},y.id)),a.length&&a.length!==l?(0,t.jsx)("div",{children:(0,t.jsx)(v.x6,{i18nKey:"explore.rich-history-starred-tab.showing-queries",defaults:"Showing {{ shown }} of {{ total }} <0>Load more</0>",values:{shown:a.length,total:l},components:[(0,t.jsx)(B.$n,{onClick:o,children:"Load more"},"loadMoreButton")]})}):null,(0,t.jsx)("div",{className:x.footer,children:Q.$.queryHistoryEnabled?"":(0,v.t)("explore.rich-history-starred-tab.local-history-message","The history is local to your browser and is not shared with others.")})]})})}const $n=()=>[{label:(0,v.t)("explore.rich-history.newest-first","Newest first"),value:he.xB.Descending},{label:(0,v.t)("explore.rich-history.oldest-first","Oldest first"),value:he.xB.Ascending},{label:(0,v.t)("explore.rich-history.datasource-a-z","Data source A-Z"),value:he.xB.DatasourceAZ},{label:(0,v.t)("explore.rich-history.datasource-z-a","Data source Z-A"),value:he.xB.DatasourceZA}].filter(e=>(0,ft.gQ)().availableFilters.includes(e.value));function cl(e){const{richHistory:s,richHistoryTotal:n,height:o,deleteRichHistory:r,onClose:a,firstTab:l}=e,[p,g]=(0,c.useState)(!1),x=T=>{e.updateHistorySettings({...e.richHistorySettings,...T})},d=T=>{const O={...e.richHistorySearchFilters,...T,page:1};e.updateHistorySearchFilters(O),h()},h=(0,se.debounce)(()=>{e.loadRichHistory(),g(!0)},300),f=T=>{T.value!==void 0&&x({retentionPeriod:T.value})},m=()=>x({starredTabAsFirstTab:!e.richHistorySettings.starredTabAsFirstTab}),j=()=>x({activeDatasourcesOnly:!e.richHistorySettings.activeDatasourcesOnly});(0,c.useEffect)(()=>{g(!1)},[s]);const y=(0,D.useSelector)(X.Kl),S=(0,he.TR)(),b=y.dsToExplore.map(T=>S.find(O=>O.uid===T.datasource?.uid)?.name).filter(T=>!!T),L={label:Vi.queryHistory,value:rt.tU.RichHistory,content:(0,t.jsx)(nl,{queries:s,totalQueries:n||0,loading:p,updateFilters:d,clearRichHistoryResults:()=>e.clearRichHistoryResults(),loadMoreRichHistory:()=>e.loadMoreRichHistory(),richHistorySettings:e.richHistorySettings,richHistorySearchFilters:e.richHistorySearchFilters,height:o,activeDatasources:b,listOfDatasources:S}),icon:"history"},R={label:(0,v.t)("explore.rich-history.starred","Starred"),value:rt.tU.Starred,content:(0,t.jsx)(ll,{queries:s,totalQueries:n||0,loading:p,updateFilters:d,clearRichHistoryResults:()=>e.clearRichHistoryResults(),loadMoreRichHistory:()=>e.loadMoreRichHistory(),richHistorySettings:e.richHistorySettings,richHistorySearchFilters:e.richHistorySearchFilters}),icon:"star"},C={label:(0,v.t)("explore.rich-history.settings","Settings"),value:rt.tU.Settings,content:(0,t.jsx)(al,{retentionPeriod:e.richHistorySettings.retentionPeriod,starredTabAsFirstTab:e.richHistorySettings.starredTabAsFirstTab,activeDatasourcesOnly:e.richHistorySettings.activeDatasourcesOnly,onChangeRetentionPeriod:f,toggleStarredTabAsFirstTab:m,toggleActiveDatasourcesOnly:j,deleteRichHistory:r}),icon:"sliders-v-alt"};let I=[L,R,C];return(0,t.jsx)(Pn.q,{tabs:I,onClose:a,defaultTab:l,closeIconTooltip:(0,v.t)("explore.rich-history.close-tooltip","Close query history"),testId:tt.Tp.pages.Explore.QueryHistory.container})}function dl(e){const s=e.explore,n=s.richHistorySearchFilters,{richHistorySettings:o,richHistory:r,richHistoryTotal:a}=s;return{richHistory:r,richHistoryTotal:a,richHistorySettings:o,richHistorySearchFilters:n}}const ul={initRichHistory:Oe.PA,loadRichHistory:Oe.jX,loadMoreRichHistory:Oe.Uu,clearRichHistoryResults:Oe.wk,updateHistorySettings:Oe.fP,updateHistorySearchFilters:Oe.Bj,deleteRichHistory:Oe.s1},pl=(0,Re.connect)(dl,ul);function gl(e){const s=(0,k.$j)(),{richHistory:n,richHistoryTotal:o,deleteRichHistory:r,initRichHistory:a,loadRichHistory:l,loadMoreRichHistory:p,clearRichHistoryResults:g,richHistorySettings:x,updateHistorySettings:d,richHistorySearchFilters:h,updateHistorySearchFilters:f,onClose:m}=e;(0,c.useEffect)(()=>{a()},[a]);const{selectedTab:j}=(0,rt.sz)(),[y,S]=(0,c.useState)(!1);return(0,c.useEffect)(()=>{y||(S(!0),(0,M.rR)("grafana_explore_query_history_opened",{queryHistoryEnabled:Q.$.queryHistoryEnabled,selectedTab:j}))},[y,j]),x?(0,t.jsx)(cl,{richHistory:n,richHistoryTotal:o,firstTab:j,onClose:m,height:s.components.horizontalDrawer.defaultHeight,deleteRichHistory:r,richHistorySettings:x,richHistorySearchFilters:h,updateHistorySettings:d,updateHistorySearchFilters:f,loadRichHistory:l,loadMoreRichHistory:p,clearRichHistoryResults:g}):(0,t.jsx)("span",{children:(0,t.jsx)(v.x6,{i18nKey:"explore.rich-history-container.loading",children:"Loading..."})})}const hl=pl(gl);var Vn=i(77455),Wn=i(74171);function fl(e){const s=(0,dt.C)("explore"),{chrome:n}=(0,Xe.Il)();(0,c.useEffect)(()=>{if(!e.panes||typeof e.panes!="string")return;let o;try{o=JSON.parse(e.panes)}catch{return}typeof o!="object"||o===null||Promise.allSettled(Object.values(o).map(r=>!r||typeof r!="object"||!(0,Wn.C)("datasource",r)||!r.datasource||typeof r.datasource!="string"?Promise.reject():(0,ze.l)().get(r.datasource))).then(r=>r.filter(Wn.s).map(a=>a.value)).then(r=>{if(r.length===0){i.g.document.title=`${s.main.text} - ${Vn.M.AppTitle}`,n.update({pageNav:void 0});return}const a=r.map(l=>l.name).join(" | ");n.update({pageNav:{text:a}}),i.g.document.title=`${s.main.text} - ${a} - ${Vn.M.AppTitle}`})},[e.panes,s.main.text,n])}function ml(){const{keybindings:e}=(0,Xe.Il)(),s=(0,D.useDispatch)();(0,c.useEffect)(()=>{e.setupTimeRangeBindings(!1);const n=[];return n.push((0,qe.J7)().subscribe(Ke.Rh,()=>{s((0,je.$_)())})),n.push((0,qe.J7)().subscribe(Ke.Io,o=>{s((0,je.Iy)(o.payload.direction))})),n.push((0,qe.J7)().subscribe(Ke.U0,o=>{s((0,je.ke)(o.payload.scale))})),n.push((0,qe.J7)().subscribe(Ke.Bt,()=>{s((0,je.Xk)())})),n.push((0,qe.J7)().subscribe(Ke.VZ,()=>{s((0,je.GA)())})),()=>{n.forEach(o=>o.unsubscribe())}},[s,e])}const xl=e=>{const s=(0,D.useDispatch)(),{width:n}=(0,vs.A)(),o=(0,D.useSelector)(X.K6),r=(0,D.useSelector)(X.pF),[a,l]=(0,c.useState)(.5),p=(0,D.useSelector)(d=>d.explore),g=d=>{const h=n/2,f=(0,se.inRange)(d,h-100,h+100);s(f?(0,J.nD)({largerExploreId:void 0}):(0,J.nD)({largerExploreId:d>h?o[1][0]:o[0][0]})),l(d/n)};let x=0;return r&&(!p.evenSplitPanes&&p.maxedExploreId?x=p.maxedExploreId===o[1][0]?n-e:e:p.evenSplitPanes?x=Math.floor(n/2):a!==void 0&&(x=n*a)),{updateSplitSize:g,widthCalc:x}};function yl(){const{location:e}=(0,Xe.Il)();(0,c.useEffect)(()=>{const s=e.getSearchObject();(s.from||s.to)&&e.partial({from:void 0,to:void 0},!0)},[e])}const js=200;function vl(e){return(0,t.jsx)(bl,{...e})}function bl(e){const s=(0,k.of)(Cl),n=(0,k.$j)();yl(),(0,dn.s)(e.queryParams),fl(e.queryParams);const{chrome:o}=(0,Xe.Il)(),r=(0,dt.C)("explore"),{updateSplitSize:a,widthCalc:l}=xl(js),p=(0,D.useSelector)(X.K6),g=(0,D.useSelector)(X.pF),x=(0,D.useSelector)(X.vC),{drawerOpened:d,setDrawerOpened:h}=(0,rt.sz)(),f=Q.$.featureToggles.correlations&&(x?.editorMode||!1);return(0,c.useEffect)(()=>{o.update({sectionNav:r})},[o,r]),ml(),(0,t.jsxs)("div",{className:(0,u.cx)(s.pageScrollbarWrapper,{[s.correlationsEditorIndicator]:f}),children:[(0,t.jsx)("h1",{className:"sr-only",children:(0,t.jsx)(v.x6,{i18nKey:"nav.explore.title"})}),(0,t.jsx)(co,{}),f&&(0,t.jsx)(io,{panes:p}),(0,t.jsx)(we.g,{splitOrientation:"vertical",paneSize:l,minSize:js,maxSize:js*-1,primary:"second",splitVisible:g,parentStyle:f?{height:`calc(100% - ${n.spacing(6)}`}:{},paneStyle:{overflow:"auto",display:"flex",flexDirection:"column"},onDragFinished:m=>m&&a(m),children:p.map(([m])=>(0,t.jsx)(ne.Xw,{style:"page",children:(0,t.jsx)(Hi,{exploreId:m})},m))}),d&&(0,t.jsx)(ks,{children:(0,t.jsx)(hl,{onClose:()=>{h(!1)}})})]})}const Cl=e=>({pageScrollbarWrapper:(0,u.css)({width:"100%",flexGrow:1,minHeight:0,height:"100%",position:"relative",overflow:"hidden"}),correlationsEditorIndicator:(0,u.css)({borderLeft:`4px solid ${e.colors.primary.main}`,borderRight:`4px solid ${e.colors.primary.main}`,borderBottom:`4px solid ${e.colors.primary.main}`,overflow:"scroll"})})},50959:(Yt,He,i)=>{i.d(He,{S5:()=>pt,fq:()=>ne,gy:()=>M,l1:()=>It});var t=i(2543),u=i.n(t),c=i(38075),Q=i(99116),k=i(63739);const ne=A=>(!A.pluginVersion&&"columns"in A&&console.log("Was angular table",A),A.options),we={timeseries_to_rows:"seriesToRows",timeseries_to_columns:"seriesToColumns",timeseries_aggregations:"reduce",table:"merge"},Xe={avg:"mean",min:"min",max:"max",total:"sum",current:"lastNotNull",count:"count"},dt={cell:"color-background",row:"color-background",value:"color-text"},v=(A,Z)=>[-1/0,...A].map((U,B)=>({color:Z[B],value:(0,t.isNumber)(U)?U:parseInt(U,10)})),D=(A,Z)=>{const U=A.transformations??[];if(Object.keys(we).includes(Z.transform)){const B={reducers:[]};Z.transform==="timeseries_aggregations"&&(B.includeTimeField=!1,B.reducers=Z.columns.map(Ae=>Xe[Ae.value])),U.push({id:we[Z.transform],options:B})}return U},_e=A=>{const U={matcher:{id:/^\/.*\/$/.test(A.pattern)?c.Ct.byRegexp:c.Ct.byName,options:A.pattern},properties:[]};return A.alias&&U.properties.push({id:"displayName",value:A.alias}),A.unit&&U.properties.push({id:"unit",value:A.unit}),A.decimals&&U.properties.push({id:"decimals",value:A.decimals}),A.type==="date"&&U.properties.push({id:"unit",value:`time: ${A.dateFormat}`}),A.type==="hidden"&&U.properties.push({id:"custom.hidden",value:!0}),A.link&&U.properties.push({id:"links",value:[{title:(0,t.defaultTo)(A.linkTooltip,""),url:(0,t.defaultTo)(A.linkUrl,""),targetBlank:(0,t.defaultTo)(A.linkTargetBlank,!1)}]}),A.colorMode&&U.properties.push({id:"custom.cellOptions",value:{type:dt[A.colorMode]}}),A.align&&U.properties.push({id:"custom.align",value:A.align==="auto"?null:A.align}),A.thresholds?.length&&U.properties.push({id:"thresholds",value:{mode:Q.O.Absolute,steps:v(A.thresholds,A.colors)}}),U},Jt=A=>{let Z={custom:{}};if(A){if(Z=(0,t.omitBy)({unit:A.unit,decimals:A.decimals,displayName:A.alias,custom:{align:A.align==="auto"?null:A.align}},t.isNil),A.thresholds.length){const U={mode:Q.O.Absolute,steps:v(A.thresholds,A.colors)};Z.thresholds=U}A.colorMode&&(Z.custom.cellOptions={type:dt[A.colorMode]})}return Z},It=(A,Z,U)=>{if(Z==="table-old"&&U.angular){const B=U.angular,Ae=D(A,B),Ne=B.styles.find(Ce=>Ce.pattern==="/.*/"),gt=Jt(Ne),se=B.styles.filter(Ce=>Ce.pattern!=="/.*/").map(_e);A.transformations=Ae,A.fieldConfig={defaults:gt,overrides:se}}return{}},ut=A=>A?.filter(Z=>Z.meta?.custom?.parentRowIndex===void 0)||[A?.[0]],pt=A=>{const Z=[];return ut(A).filter(B=>!!B&&B.length!==0)?.forEach(B=>{const Ae=A?.filter(Ce=>B.refId===Ce.refId&&Ce.meta?.custom?.parentRowIndex!==void 0),Ne=(0,t.groupBy)(Ae,Ce=>Ce.meta?.custom?.parentRowIndex),gt=Object.keys(Ne).map(Ce=>Ne[Ce]),se={...B};Ae&&Ae.length>0&&se.fields.push({name:"nested",type:k.PU.nestedFrames,config:{},values:gt}),Z.push(se)}),Z},M=A=>A?.some(Z=>Z.meta?.custom?.parentRowIndex!==void 0)},10940:(Yt,He,i)=>{i.d(He,{A:()=>c});var t=i(96540),u=function(Q,k){var ne=(0,t.useRef)(function(){});(0,t.useEffect)(function(){ne.current=Q}),(0,t.useEffect)(function(){if(k!==null){var we=setInterval(function(){return ne.current()},k||0);return function(){return clearInterval(we)}}},[k])};const c=u}}]);

//# sourceMappingURL=explore.10d9a933c82ff7e708c8.js.map