"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[5857],{40419:(Re,fe,l)=>{l.d(fe,{w:()=>q});var m=l(74848),A=l(22803),X=l(96540),le=l(29675);const ve=10,q=({colorPalette:S,min:F,max:L,display:$,hoverValue:f,useStopsPercentage:V})=>{const[Y,E]=(0,X.useState)([]),[j,C]=(0,X.useState)({isShown:!1,value:0}),[b,T]=(0,X.useState)(null),z=(0,le.$j)(),N=xe(z,Y);(0,X.useEffect)(()=>{E(s({colorArray:S,stops:ve,useStopsPercentage:V}))},[S,V]);const _=k=>{const M=k.nativeEvent.offsetX,Z=k.currentTarget.offsetWidth,ce=Math.floor(M*100/Z+1),ue=Math.floor((L-F)*ce/100+F);C({isShown:!0,value:ue}),T(ce)},H=()=>{C({isShown:!1,value:0})};return(0,X.useEffect)(()=>{T(f==null?null:he((f-F)/(L-F)))},[f,F,L]),(0,m.jsxs)("div",{className:N.scaleWrapper,onMouseMove:_,onMouseLeave:H,children:[(0,m.jsx)("div",{className:N.scaleGradient,children:$&&(j.isShown||f!==void 0)&&(0,m.jsx)("div",{className:N.followerContainer,children:(0,m.jsx)("div",{className:N.follower,style:{left:`${b}%`}})})}),$&&(0,m.jsxs)("div",{className:N.followerContainer,children:[(0,m.jsxs)("div",{className:N.legendValues,children:[(0,m.jsx)("span",{className:N.disabled,children:$(F)}),(0,m.jsx)("span",{className:N.disabled,children:$(L)})]}),b!=null&&(j.isShown||f!==void 0)&&(0,m.jsx)("span",{className:N.hoverValue,style:{left:`${b}%`},children:$(f??j.value)})]})]})},s=({colorArray:S,stops:F,useStopsPercentage:L=!0})=>{const $=S.length;if(L&&$<=20){const E=1/$*100;let j=0;const C=[];for(const b of S)j>0?C.push(`${b} ${j}%`):C.push(b),j+=E,C.push(`${b} ${j}%`);return C}const f=S[$-1],V=Math.ceil($/F),Y=new Set;for(let E=0;E<$;E+=V)Y.add(S[E]);return Y.add(f),[...Y]};function he(S){return S>1?100:S<0?0:S*100}const xe=(S,F)=>({scaleWrapper:(0,A.css)({width:"100%",fontSize:"11px",opacity:1}),scaleGradient:(0,A.css)({background:`linear-gradient(90deg, ${F.join()})`,height:"9px",pointerEvents:"none",borderRadius:S.shape.radius.default}),legendValues:(0,A.css)({display:"flex",justifyContent:"space-between",pointerEvents:"none"}),hoverValue:(0,A.css)({position:"absolute",marginTop:"-14px",padding:"3px 15px",transform:"translateX(-50%)"}),followerContainer:(0,A.css)({position:"relative",pointerEvents:"none",whiteSpace:"nowrap"}),follower:(0,A.css)({position:"absolute",height:"13px",width:"13px",borderRadius:S.shape.radius.default,transform:"translateX(-50%) translateY(-50%)",border:`2px solid ${S.colors.text.primary}`,top:"5px"}),disabled:(0,A.css)({color:S.colors.text.disabled})})},38333:(Re,fe,l)=>{l.d(fe,{e:()=>L});var m=l(74848),A=l(22803),X=l(23570),le=l(59141),ve=l(6562),q=l(7500),s=l(29675),he=l(54731),xe=l(99788),S=l(83525);function F(f,V,Y,E,j){const C=f.fields,b=Y!=null?C[Y]:null,T=C.filter(M=>!M.config.custom?.hideFrom?.tooltip),z=T.find(M=>M.name==="traceID")||C[0],N=[];if(T.filter(M=>z===M).length>0&&N.push(z),N.push(...T.filter(M=>z!==M)),N.length===0)return null;const _=[],H=[],k=new Set;for(const M of N){if(j===q.$N.Single&&M!==b)continue;const Z=M.values[V],ce=M.display?M.display(Z):{text:`${Z}`,numeric:+Z};M.getLinks&&M.getLinks({calculatedValue:ce,valueRowIndex:V}).forEach(ue=>{const Ce=`${ue.title}/${ue.href}`;k.has(Ce)||(H.push(ue),k.add(Ce))}),_.push({name:(0,X.Ct)(M,f),value:Z,valueString:(0,le.cN)(ce),highlight:M===b})}return E&&E!==q.xB.None&&_.sort((M,Z)=>ve.sortValues(E)(M.value,Z.value)),{displayValues:_,links:H}}const L=({data:f,rowIndex:V,columnIndex:Y,sortOrder:E,mode:j,header:C,padding:b=0})=>{const T=(0,s.of)($,b);if(!f||V==null)return null;const z=F(f,V,Y,E,j);if(z==null)return null;const{displayValues:N,links:_}=z;return C==="Exemplar"?(0,m.jsx)(S.i,{displayValues:N,links:_,header:C}):(0,m.jsxs)("div",{className:T.wrapper,children:[C&&(0,m.jsx)("div",{className:T.header,children:(0,m.jsx)("span",{className:T.title,children:C})}),(0,m.jsx)("table",{className:T.infoWrap,children:(0,m.jsxs)("tbody",{children:[N.map((H,k)=>(0,m.jsxs)("tr",{children:[(0,m.jsx)("th",{children:H.name}),(0,m.jsx)("td",{children:(0,xe.A)(H.valueString)})]},`${k}/${V}`)),_.map((H,k)=>(0,m.jsxs)("tr",{children:[(0,m.jsx)("th",{children:"Link"}),(0,m.jsx)("td",{colSpan:2,children:(0,m.jsx)(he.Y,{href:H.href,external:H.target==="_blank",weight:"medium",inline:!1,children:H.title})})]},k))]})})]})},$=(f,V=0)=>({wrapper:(0,A.css)({padding:`${V}px`,background:f.components.tooltip.background,borderRadius:f.shape.borderRadius(2)}),header:(0,A.css)({background:f.colors.background.secondary,alignItems:"center",alignContent:"center",display:"flex",paddingBottom:f.spacing(1)}),title:(0,A.css)({fontWeight:f.typography.fontWeightMedium,overflow:"hidden",display:"inline-block",whiteSpace:"nowrap",textOverflow:"ellipsis",flexGrow:1}),infoWrap:(0,A.css)({padding:f.spacing(1),background:"transparent",border:"none",th:{fontWeight:f.typography.fontWeightMedium,padding:f.spacing(.25,2,.25,0)},tr:{borderBottom:`1px solid ${f.colors.border.weak}`,"&:last-child":{borderBottom:"none"}}}),link:(0,A.css)({color:f.colors.text.link})})},63492:(Re,fe,l)=>{l.r(fe),l.d(fe,{plugin:()=>Mt});var m=l(74848),A=l(68256),X=l(62321),le=l(63739),ve=l(49448),q=l(32370),s=l(7500),he=l(59698),xe=l(95118),S=l(40419),F=l(83283),L=l(75771),$=l(22803),f=l(96540),V=l(74958),Y=l(350),E=l(29675),j=l(90415),C=l(85832),b=l(87579),T=l(72778),z=l(12963),N=l(4188),_=l(37604),H=l(36613),k=l(47370),M=l(59141),Z=l(23570),ce=l(53823),ue=l(14411),Ce=l(33409),qe=l(69921),Ne=l(85217),_e=l(16910),et=l(38333),Fe=l(69598),tt=l(16725);function at(e,r,a,o,t,n,c){let u=e.current?.getContext("2d");if(u!=null){let d=n;for(;o[d-1]===o[n];)d--;let h=d+c,i=0,y=d;for(;y<h;){let ae=t[y];i=Math.max(i,ae),y++}let D=new Path2D,ee=new Path2D;y=d;let te=0;for(;y<h;){let ae=t[y];if(ae>0){let K=ae/i,oe=te/c,W=y===n?D:ee;const I=r*oe+1,Q=r/c-1;W.rect(I,Math.round(a*(1-K)),Q,Math.round(a*K))}y++,te++}u.clearRect(0,0,r,a),u.fillStyle="#2E3036",u.fill(ee),u.fillStyle="#5794F2",u.fill(D)}}const je=(e,r)=>{const a=e.heatmapColors?.palette,o=e.heatmapColors?.values[r];let t;return o!=null&&(t=a[o]),{cellColor:t,colorPalette:a}},Oe={year:1e3*60*60*24*365,month:1e3*60*60*24*30,week:1e3*60*60*24*7,day:1e3*60*60*24,h:1e3*60*60,m:1e3*60,s:1e3,ms:1},lt=new Set(["ms","s","m","h"]),nt=e=>{let r=1,a="ms";for(a in Oe)if(e>=Oe[a]){r=Math.floor(e/Oe[a]);break}const t=r!==1&&!lt.has(a)?a+"s":a;return`${r} ${t}`},Ae=(e,r,a)=>{let o;switch(r){case"x":o=a?e?.fields.find(({name:t})=>t==="x"||t==="xMin"||t==="xMax"):e?.fields[0];break;case"y":o=a?e?.fields.find(({name:t})=>t==="y"||t==="yMin"||t==="yMax"):e?.fields[1];break;case"count":o=a?e?.fields.find(({name:t})=>t==="count"):e?.fields[2];break}return o},be=(e,r)=>{let a=e.heatmap.fields,o=a.find(u=>u.name==="xMax"),t=a.find(u=>u.name==="yMin"),n=a.find(u=>u.name==="yMax"),c=o.config.interval;return{xBucketMin:o.values[r]-c,xBucketMax:o.values[r],yBucketMin:t.values[r],yBucketMax:n.values[r]}},st=e=>e.seriesIdx===2?(0,m.jsx)(et.e,{data:e.dataRef.current.exemplars,rowIndex:e.dataIdxs[2],header:"Exemplar",padding:8}):(0,m.jsx)(it,{...e}),He=264,ot=64,it=({dataIdxs:e,dataRef:r,showHistogram:a,isPinned:o,showColorScale:t=!1,mode:n,annotate:c,maxHeight:u,maxWidth:g,replaceVariables:d})=>{const h=e[1],i=r.current,[y]=(0,f.useState)(()=>i.heatmap?.meta?.type===k.m.HeatmapCells&&!(0,L.Nb)(i.heatmap)),D=Ae(i.heatmap,"x",y),ee=Ae(i.heatmap,"y",y),te=Ae(i.heatmap,"count",y),ae=x=>D?.display?(0,M.cN)(D.display(x)):D?.type===le.PU.time?(0,_e.UA)().getCurrent()?.formatDate(x,"YYYY-MM-DD HH:mm:ss"):`${x}`,K=D.values,oe=ee.values,W=te.values,I=(0,L.eE)(i.heatmap),Q=ee?.display?x=>(0,M.cN)(ee.display(x)):x=>`${x}`;let v=D?.config.interval,G,w,J,ie,de,U=[];const ne=x=>x%(i.yBucketCount??1);let R=ne(h);const me=Math.floor(h/(i.yBucketCount??1)),Be=(x=h)=>{if(I.yOrdinalDisplay){const B=i.yLayout===s.D7.le?R-1:R,P=i.yLayout===s.D7.le?R:R+1;G=B<0?I.yMinDisplay:`${I.yOrdinalDisplay[B]}`,w=`${I.yOrdinalDisplay[P]}`,(!I.yOrdinalLabel||Number.isNaN(+I.yOrdinalLabel[0]))&&(de=i.yLayout===s.D7.le?w:G)}else{const B=oe?.[R];if(i.yLayout===s.D7.le)if(w=`${B}`,i.yLog){let O=(i.yLog===2?Math.log2:Math.log10)(B)-1/i.yLogSplit;G=`${i.yLog**O}`}else G=`${B-i.yBucketSize}`;else if(G=`${B}`,i.yLog){let O=(i.yLog===2?Math.log2:Math.log10)(B)+1/i.yLogSplit;w=`${i.yLog**O}`}else w=`${B+i.yBucketSize}`}i.xLayout===s.D7.le?(ie=K[x],J=ie-i.xBucketSize):(J=K[x],ie=J+i.xBucketSize)};y?{xBucketMin:J,xBucketMax:ie,yBucketMin:G,yBucketMax:w}=be(i,h):Be();const{cellColor:pe,colorPalette:ge}=je(i,h),Pe=(x,B)=>{let P=[];for(let O=x;O<=B;O++){if(!W?.[O])continue;const re=je(i,O).cellColor;se=we(O),y?{xBucketMin:J,xBucketMax:ie,yBucketMin:G,yBucketMax:w}=be(i,O):(R=ne(O),Be(O));const{label:Ct,value:Nt}=Ve()[0];P.push({label:Ct,value:Nt,color:re??"#FFF",isActive:h===O})}return P},Ve=()=>{const x=n===s.$N.Multi&&!o;if(de)return x?[{label:`Name ${de}`,value:i.display(se)}]:[{label:"Name",value:de}];switch(i.yLayout){case s.D7.unknown:return x?[{label:Q(G),value:i.display(se)}]:[{label:"",value:Q(G)}]}return x?[{label:`Bucket ${Q(G)}-${Q(w)}`,value:i.display(se)}]:[{label:"Bucket",value:`${Q(G)}-${Q(w)}`}]},we=x=>W?.[x];let se=we(h);if(n===s.$N.Single||o){const x=v?[{label:"Duration",value:nt(v)}]:[];U=[{label:(0,Z.Ct)(te,i.heatmap),value:i.display(se),color:pe??"#FFF",colorPlacement:Ne.lJ.trailing,colorIndicator:Ne.fX.value},...Ve(),...x]}if(n===s.$N.Multi&&!o){let x=D.values[h],B=h,P=h;for(;D.values[B-1]===x;)B--;for(;D.values[P+1]===x;)P++;Pe(B,P).forEach(re=>{U.push({label:re.label,value:re.value,color:re.color??"#FFF",colorIndicator:Ne.fX.value,colorPlacement:Ne.lJ.trailing,isActive:re.isActive})})}let Ge;if(o){let x=[],B=[];const P=i.series?.fields[R+1];if(P!=null){const O=!P.config.custom?.hideFrom?.tooltip,re=(P.config.links?.length??0)>0;O&&re&&(x=(0,Fe.u6)(P,me)),B=(0,Fe.OG)(i.series,P,d,me)}Ge=(0,m.jsx)(ue.S,{dataLinks:x,annotate:c,actions:B})}let Ue=(0,f.useRef)(null);const Ye=(0,E.$j)(),St=parseInt(Ye.spacing(1),10);let ze=Math.min(He,g?g-St*2:He),Je=ot,Xe=Math.round(ze*H.A.pxRatio),Ze=Math.round(Je*H.A.pxRatio);(0,f.useEffect)(()=>{a&&K!=null&&W!=null&&n===s.$N.Single&&at(Ue,Xe,Ze,K,W,h,i.yBucketCount)},[h]);const Bt={label:"",value:ae(ie)};let Ie=[];return n===s.$N.Single&&(a&&!y&&Ie.push((0,m.jsx)("canvas",{width:Xe,height:Ze,ref:Ue,style:{width:ze+"px",height:Je+"px"}})),ge&&t&&Ie.push((0,m.jsx)(S.w,{colorPalette:ge,min:i.heatmapColors?.minValue,max:i.heatmapColors?.maxValue,display:i.display,hoverValue:se}))),(0,m.jsxs)(qe.i,{children:[(0,m.jsx)(Ce.A,{item:Bt,isPinned:o}),(0,m.jsx)(ce.o,{items:U,isPinned:o,scrollable:(0,tt.T5)({mode:n,maxHeight:u}),maxHeight:u,children:Ie?.map((x,B)=>(0,m.jsx)("div",{style:{padding:`${Ye.spacing(1)} 0`},children:x},B))}),Ge]})};var Ke=l(47286),rt=l(77230),ct=l(16869),ye=l(1391),Me=l(49349);function $e({frames:e,annotations:r,options:a,palette:o,theme:t,replaceVariables:n=u=>u,timeRange:c}){if(!e?.length)return{};(0,Z.Fm)(e);const u=r?.find(d=>d.name==="exemplar");if(u?.fields.forEach(d=>{d.getLinks=(0,Ke._M)(u,d,d.state?.scopedVars??{},n)}),a.calculate){let d=ut(a.calculation);return d.xBuckets.value=n(d.xBuckets.value??""),d.yBuckets.value=n(d.yBuckets.value??""),ke((0,L.VQ)(e,{...d,timeRange:c}),u,{...a,calculation:d},o,t)}let g;for(const d of e)switch(d.meta?.type){case k.m.HeatmapCells:return(0,L.Nb)(d)?ke(d,u,a,o,t):dt(d,u,a,o,t);case k.m.HeatmapRows:g=d}if(g==null)if(e.length>1)e.every(h=>!Number.isNaN((0,ye.L)(h.fields[1].state?.displayName)))&&e.sort(ye.Bm),g=(0,rt.Fd)({frames:e,keepDisplayNames:!0});else{let d=e[0],h=d.fields.filter(y=>y.type===le.PU.number);h.every(y=>!Number.isNaN((0,ye.L)(y.state?.displayName)))?(h.sort((y,D)=>(0,ye.L)(y.state?.displayName)-(0,ye.L)(D.state?.displayName)),g={...d,fields:[d.fields.find(y=>y.type===le.PU.time),...h]}):g=d}return g.fields.forEach(d=>{(d.config.links?.length??0)!==0&&(d.getLinks=(0,Ke._M)(g,d,d.state?.scopedVars??{},n))}),{...ke((0,L.yJ)({unit:a.yAxis?.unit,decimals:a.yAxis?.decimals,...a.rowsFrame,frame:g}),u,a,o,t),series:g}}const ut=e=>({xBuckets:{...e?.xBuckets,mode:e?.xBuckets?.mode??s.J1.Size},yBuckets:{...e?.yBuckets,mode:e?.yBuckets?.mode??s.J1.Size,scale:{...e?.yBuckets?.scale,type:e?.yBuckets?.scale?.type??s.L4.Linear}}}),dt=(e,r,a,o,t)=>{if(e.meta?.type!==k.m.HeatmapCells||(0,L.Nb)(e))return{warning:"Expected sparse heatmap format",heatmap:e};De(e.fields[1],a.yAxis,t);const n=e.fields[3],c=De(n,a.cellValues,t);let[u,g]=(0,Me.g$)(n.values,a.color.min,a.color.max,a.filterValues?.le,a.filterValues?.ge);return{heatmap:e,heatmapColors:{palette:o,values:(0,Me.O4)(n.values,o,u,g),minValue:u,maxValue:g},exemplars:r,display:d=>(0,M.cN)(c(d))}},ke=(e,r,a,o,t)=>{if(e.meta?.type!==k.m.HeatmapCells)return{warning:"Expected heatmap scanlines format",heatmap:e};if(e.fields.length<2||e.length<2)return{heatmap:e};const n=(0,L.eE)(e);let c,u,g;for(const v of e.fields)switch(v.name){case"y":u=v.name;case"yMin":case"yMax":{u||(u=v.name),n.yOrdinalDisplay==null&&De(v,a.yAxis,t);break}case"x":case"xMin":case"xMax":c=v.name;break;default:v.type===le.PU.number&&!g&&(g=v)}if(!u)return{warning:"Missing Y field",heatmap:e};if(!u)return{warning:"Missing X field",heatmap:e};if(!g)return{warning:"Missing value field",heatmap:e};const d=De(g,a.cellValues,t),h=e.fields[0].values,i=e.fields[1].values,y=h.length;let D=y-i.lastIndexOf(i[0]),ee=y/D,te=i[1]-i[0],ae=h[D]-h[0],[K,oe]=(0,Me.g$)(g.values,a.color.min,a.color.max,a.filterValues?.le,a.filterValues?.ge),W=a.calculation?.xBuckets,I=a.calculation?.yBuckets;return{heatmap:e,heatmapColors:{palette:o,values:(0,Me.O4)(g.values,o,K,oe),minValue:K,maxValue:oe},exemplars:r?.length?r:void 0,xBucketSize:ae,yBucketSize:te,xBucketCount:ee,yBucketCount:D,yLog:I?.scale?.log??0,xLog:W?.scale?.log??0,xLogSplit:W?.scale?.log?+(W?.value??"1"):1,yLogSplit:I?.scale?.log?+(I?.value??"1"):1,xLayout:c==="xMax"?s.D7.le:c==="xMin"?s.D7.ge:s.D7.unknown,yLayout:u==="yMax"?s.D7.le:u==="yMin"?s.D7.ge:s.D7.unknown,display:v=>(0,M.cN)(d(v))}};function De(e,r,a){if(r?.unit?.length||r?.decimals!=null){const{unit:o,decimals:t}=r;e.display=void 0,e.config={...e.config},o?.length&&(e.config.unit=o),t!=null&&(e.config.decimals=t)}return e.display||(e.display=(0,ct.J)({field:e,theme:a})),e.display}var We=l(55995),mt=l(37634),Te=l(84140),p=l(66865);const Se=[{name:"BrBG",invert:"always"},{name:"PiYG",invert:"always"},{name:"PRGn",invert:"always"},{name:"PuOr",invert:"always"},{name:"RdBu",invert:"always"},{name:"RdGy",invert:"always"},{name:"RdYlBu",invert:"always"},{name:"RdYlGn",invert:"always"},{name:"Spectral",invert:"always"},{name:"Blues",invert:"dark"},{name:"Greens",invert:"dark"},{name:"Greys",invert:"dark"},{name:"Oranges",invert:"dark"},{name:"Purples",invert:"dark"},{name:"Reds",invert:"dark"},{name:"Turbo",invert:"light"},{name:"Cividis",invert:"light"},{name:"Viridis",invert:"light"},{name:"Magma",invert:"light"},{name:"Inferno",invert:"light"},{name:"Plasma",invert:"light"},{name:"Warm",invert:"light"},{name:"Cool",invert:"light"},{name:"Cubehelix",invert:"light",name2:"CubehelixDefault"},{name:"BuGn",invert:"dark"},{name:"BuPu",invert:"dark"},{name:"GnBu",invert:"dark"},{name:"OrRd",invert:"dark"},{name:"PuBuGn",invert:"dark"},{name:"PuBu",invert:"dark"},{name:"PuRd",invert:"dark"},{name:"RdPu",invert:"dark"},{name:"YlGnBu",invert:"dark"},{name:"YlGn",invert:"dark"},{name:"YlOrBr",invert:"dark"},{name:"YlOrRd",invert:"dark"},{name:"Rainbow",invert:"always"},{name:"Sinebow",invert:"always"}],pt=Se.find(e=>e.name==="Spectral");function Le(e,r){const a={...p.KQ.color,...e},o=[],t=(a.steps??128)-1;if(e.mode===p.P7.Opacity){const n=(0,Te.A)(r.visualization.getColorByName(e.fill)).toPercentageRgb(),c=a.scale===p.uM.Exponential?We.scalePow().exponent(a.exponent).domain([0,1]).range([0,1]):We.scaleLinear().domain([0,1]).range([0,1]);for(let u=0;u<=t;u++)n.a=c(u/t),o.push((0,Te.A)(n).toString("hex8"))}else{const n=Se.find(g=>g.name===a.scheme)??pt;let c="interpolate"+(n.name2??n.name);const u=mt[c];for(let g=0;g<=t;g++){let d=u(g/t),h=d.indexOf("rgb")===0?"#"+[...d.matchAll(/\d+/g)].map(i=>(+i[0]).toString(16).padStart(2,"0")).join(""):d;o.push(h)}(n.invert==="always"||n.invert==="dark"&&r.isDark||n.invert==="light"&&r.isLight)&&o.reverse(),e.reverse&&o.reverse()}return o}const ft=({data:e,id:r,timeRange:a,timeZone:o,width:t,height:n,options:c,fieldConfig:u,eventBus:g,onChangeTimeRange:d,replaceVariables:h})=>{const i=(0,E.$j)(),y=(0,E.of)(ht),{sync:D,eventsScope:ee,canAddAnnotations:te,onSelectRange:ae}=(0,j.d2)(),K=D?.()??V.y.Off,[oe,W]=(0,f.useState)(null);let I=(0,f.useRef)(a);I.current=a;const Q=(0,f.useMemo)(()=>Le(c.color,i),[c.color,i]),v=(0,f.useMemo)(()=>{try{return $e({frames:e.series,annotations:e.annotations,options:c,palette:Q,theme:i,replaceVariables:h,timeRange:a})}catch(U){return{warning:`${U}`}}},[e.series,e.annotations,c,Q,i,h,a]),G=(0,f.useMemo)(()=>{let U=[],ne=[];const R=(0,L.eE)(v.heatmap);return v.exemplars?.length&&(U=v.exemplars?.fields[0].values,R.yMatchWithLabel&&R.yOrdinalDisplay!=null?ne=(v.exemplars?.fields.find(pe=>pe.name===R.yMatchWithLabel).values).map(pe=>R.yOrdinalLabel?.indexOf(pe)):ne=v.exemplars?.fields[1].values),[null,v.heatmap?.fields.map(me=>me.values),[U,ne]]},[v.heatmap,v.exemplars]),w=(0,f.useRef)(v);w.current=v;const J=(0,f.useMemo)(()=>{const U=w.current?.heatmap?.fields[1].config?.custom?.scaleDistribution;return(0,Me.Mv)({dataRef:w,theme:i,timeZone:o,getTimeRange:()=>I.current,cellGap:c.cellGap,hideLE:c.filterValues?.le,hideGE:c.filterValues?.ge,exemplarColor:c.exemplars?.color??"rgba(255,0,255,0.7)",yAxisConfig:c.yAxis,ySizeDivisor:U?.type===s.L4.Log?+(c.calculation?.yBuckets?.value||1):1,selectionMode:c.selectionMode})},[c,o,e.structureRev,K]),ie=()=>!v.heatmap||!c.legend.show?null:(0,m.jsx)(C.KU.Legend,{placement:"bottom",maxHeight:"20%",children:(0,m.jsx)("div",{className:y.colorScaleWrapper,children:(0,m.jsx)(S.w,{hoverValue:void 0,colorPalette:Q,min:w.current.heatmapColors?.minValue,max:w.current.heatmapColors?.maxValue,display:v.display})})});if(v.warning||!v.heatmap)return(0,m.jsx)(Y.a,{panelId:r,fieldConfig:u,data:e,needsNumberField:!0,message:v.warning});const de=!!(te&&te());return(0,m.jsx)(m.Fragment,{children:(0,m.jsx)(C.KU,{width:t,height:n,legend:ie(),children:(U,ne)=>(0,m.jsxs)(b.Z,{config:J,data:G,width:U,height:ne,children:[K!==V.y.Off&&(0,m.jsx)(T.K,{config:J,eventBus:g,frame:v.series??v.heatmap}),c.tooltip.mode!==s.$N.None&&(0,m.jsx)(z.xl,{config:J,hoverMode:c.tooltip.mode===s.$N.Single?z.b3.xOne:z.b3.xAll,queryZoom:d,onSelectRange:ae,syncMode:K,syncScope:ee,render:(R,me,Be,pe,ge,Pe,Ve)=>{if(de&&Pe!=null){W(Pe),ge();return}const we=()=>{let se=R.posToVal(R.cursor.left,"x");W({from:se,to:se}),ge()};return(0,m.jsx)(st,{mode:Ve?s.$N.Multi:c.tooltip.mode,dataIdxs:me,seriesIdx:Be,dataRef:w,isPinned:pe,dismiss:ge,showHistogram:c.tooltip.yHistogram,showColorScale:c.tooltip.showColorScale,panelData:e,annotate:de?we:void 0,maxHeight:c.tooltip.maxHeight,maxWidth:c.tooltip.maxWidth,replaceVariables:h})},maxWidth:c.tooltip.maxWidth}),(0,m.jsx)(N.W,{annotations:e.annotations??[],config:J,timeZone:o,newRange:oe,setNewRange:W,canvasRegionRendering:!1}),(0,m.jsx)(_.U,{config:J,onChangeTimeRange:d})]},J.uid)})})},ht=()=>({colorScaleWrapper:(0,$.css)({marginLeft:"25px",padding:"10px 0",maxWidth:"300px"})}),gt=e=>{if(Object.keys(e.options??{}).length===0)return Qe(e,"heatmap",{angular:e},e.fieldConfig);let r=e.options?.tooltip?.show;return r!==void 0&&(r===!0?e.options.tooltip.mode=s.$N.Single:r===!1&&(e.options.tooltip.mode=s.$N.None),delete e.options.tooltip?.show),e.options},Qe=(e,r,a,o)=>{if(r==="heatmap"&&a.angular){const{fieldConfig:t,options:n}=vt({...a.angular,fieldConfig:o});return e.fieldConfig=t,n}if(r==="heatmap-new"){const{bucketFrame:t,...n}=e.options;return t?{...n,rowsFrame:t}:e.options}return{}};function vt(e){const r={defaults:{},overrides:[]},a=e.dataFormat!=="tsbuckets",o={...p.KQ.calculation},t={logBase:1,...e.yAxis};a&&(e.xBucketSize?o.xBuckets={mode:s.J1.Size,value:`${e.xBucketSize}`}:e.xBucketNumber&&(o.xBuckets={mode:s.J1.Count,value:`${e.xBucketNumber}`}),e.yBucketSize?o.yBuckets={mode:s.J1.Size,value:`${e.yBucketSize}`}:e.xBucketNumber&&(o.yBuckets={mode:s.J1.Count,value:`${e.yBucketNumber}`}),t.logBase>1&&(o.yBuckets={mode:s.J1.Count,value:+t.splitFactor>0?`${t.splitFactor}`:void 0,scale:{type:s.L4.Log,log:t.logBase}}));const n=Ee(e.cards?.cardPadding,2),c={calculate:a,calculation:o,color:{...p.KQ.color,steps:128},cellGap:n||1,cellRadius:Ee(e.cards?.cardRound),yAxis:{axisPlacement:t.show===!1?s.vM.Hidden:s.vM.Left,reverse:!!e.reverseYBuckets,axisWidth:Ee(t.width),min:t.min,max:t.max,unit:t.format,decimals:t.decimals},cellValues:{decimals:Ee(e.tooltipDecimals)},rowsFrame:{layout:xt(e.yBucketBound)},legend:{show:!!e.legend?.show},showValue:s.yL.Never,tooltip:{mode:e.tooltip?.show?s.$N.Single:s.$N.None,yHistogram:!!e.tooltip?.showHistogram},exemplars:{...p.KQ.exemplars}};e.hideZeroBuckets&&(c.filterValues={...p.KQ.filterValues});const u=e.color??{};switch(u?.mode){case"spectrum":{c.color.mode=p.P7.Scheme;const g=u.colorScheme;let d=Se.find(h=>h.name===g);d||(d=Se.find(h=>g.indexOf(h.name)>=0)),c.color.scheme=d?d.name:p.KQ.color.scheme;break}case"opacity":{c.color.mode=p.P7.Opacity,c.color.scale=u.scale;break}}return c.color.fill=u.cardColor,c.color.min=u.min,c.color.max=u.max,typeof u.min=="number"&&typeof u.max=="number"&&u.min>u.max&&(c.color.min=u.max,c.color.max=u.min,c.color.reverse=!0),{fieldConfig:r,options:c}}function xt(e){switch(e){case"upper":return s.D7.ge;case"lower":return s.D7.le;case"middle":return s.D7.unknown}return s.D7.auto}function Ee(e,r){if(e==null||e==="")return r;const a=+e;return isNaN(a)?r:a}class yt{getSuggestionsForData(r){const{dataSummary:a}=r;if(!r.data?.series||!a.hasData||a.timeFieldCount<1||a.numberFieldCount<2||a.numberFieldCount>10)return;const o=Le(p.KQ.color,q.$.theme2),t=$e({frames:r.data.series,options:p.KQ,palette:o,theme:q.$.theme2});!t||t.warning||r.getListAppender({name:"",pluginId:"heatmap",options:{},fieldConfig:{defaults:{custom:{}},overrides:[]}})}}const Mt=new A.m(ft).useFieldConfig({disableStandardOptions:Object.values(X.uo).filter(e=>e!==X.uo.Links),standardOptions:{[X.uo.Links]:{settings:{showOneClick:!0}}},useCustomConfig:e=>{e.addCustomEditor({id:"scaleDistribution",path:"scaleDistribution",name:"Y axis scale",category:["Heatmap"],editor:he.W1,override:he.W1,defaultValue:{type:s.L4.Linear},shouldApply:r=>r.type===le.PU.number,process:ve.hS,hideFromDefaults:!0}),(0,xe.e)(e)}}).setPanelChangeHandler(Qe).setMigrationHandler(gt).setPanelOptions((e,r)=>{const a=r.options??p.KQ;let o=!1;if(r.data.length>0)try{const n=Le(a.color,q.$.theme2),c=$e({frames:r.data,options:a,palette:n,theme:q.$.theme2});o=(0,L.eE)(c.heatmap).yOrdinalDisplay!=null}catch{}let t=["Heatmap"];e.addRadio({path:"calculate",name:"Calculate from data",defaultValue:p.KQ.calculate,category:t,settings:{options:[{label:"Yes",value:!0},{label:"No",value:!1}]}}),a.calculate&&(0,F.J)("calculation.",e,a.calculation,t),t=["Y Axis"],e.addRadio({path:"yAxis.axisPlacement",name:"Placement",defaultValue:p.KQ.yAxis.axisPlacement??s.vM.Left,category:t,settings:{options:[{label:"Left",value:s.vM.Left},{label:"Right",value:s.vM.Right},{label:"Hidden",value:s.vM.Hidden}]}}).addUnitPicker({category:t,path:"yAxis.unit",name:"Unit",defaultValue:void 0,settings:{isClearable:!0}}).addNumberInput({category:t,path:"yAxis.decimals",name:"Decimals",settings:{placeholder:"Auto"}}),o||e.addNumberInput({path:"yAxis.min",name:"Min value",settings:{placeholder:"Auto"},category:t}).addTextInput({path:"yAxis.max",name:"Max value",settings:{placeholder:"Auto"},category:t}),e.addNumberInput({path:"yAxis.axisWidth",name:"Axis width",defaultValue:p.KQ.yAxis.axisWidth,settings:{placeholder:"Auto",min:5},category:t}).addTextInput({path:"yAxis.axisLabel",name:"Axis label",defaultValue:p.KQ.yAxis.axisLabel,settings:{placeholder:"Auto"},category:t}),a.calculate||e.addRadio({path:"rowsFrame.layout",name:"Tick alignment",defaultValue:p.KQ.rowsFrame?.layout??s.D7.auto,category:t,settings:{options:[{label:"Auto",value:s.D7.auto},{label:"Top (LE)",value:s.D7.le},{label:"Middle",value:s.D7.unknown},{label:"Bottom (GE)",value:s.D7.ge}]}}),e.addBooleanSwitch({path:"yAxis.reverse",name:"Reverse",defaultValue:p.KQ.yAxis.reverse===!0,category:t}),t=["Colors"],e.addRadio({path:"color.mode",name:"Mode",defaultValue:p.KQ.color.mode,category:t,settings:{options:[{label:"Scheme",value:p.P7.Scheme},{label:"Opacity",value:p.P7.Opacity}]}}),e.addColorPicker({path:"color.fill",name:"Color",defaultValue:p.KQ.color.fill,category:t,showIf:n=>n.color.mode===p.P7.Opacity}),e.addRadio({path:"color.scale",name:"Scale",defaultValue:p.KQ.color.scale,category:t,settings:{options:[{label:"Exponential",value:p.uM.Exponential},{label:"Linear",value:p.uM.Linear}]},showIf:n=>n.color.mode===p.P7.Opacity}),e.addSliderInput({path:"color.exponent",name:"Exponent",defaultValue:p.KQ.color.exponent,category:t,settings:{min:.1,max:2,step:.1},showIf:n=>n.color.mode===p.P7.Opacity&&n.color.scale===p.uM.Exponential}),e.addSelect({path:"color.scheme",name:"Scheme",description:"",defaultValue:p.KQ.color.scheme,category:t,settings:{options:Se.map(n=>({value:n.name,label:n.name}))},showIf:n=>n.color.mode!==p.P7.Opacity}),e.addSliderInput({path:"color.steps",name:"Steps",defaultValue:p.KQ.color.steps,category:t,settings:{min:2,max:128,step:1}}).addBooleanSwitch({path:"color.reverse",name:"Reverse",defaultValue:p.KQ.color.reverse,category:t}).addCustomEditor({id:"__scale__",path:"__scale__",name:"",category:t,editor:()=>{const n=Le(a.color,q.$.theme2);return(0,m.jsx)("div",{children:(0,m.jsx)(S.w,{colorPalette:n,min:1,max:100})})}}),e.addNumberInput({path:"color.min",name:"Start color scale from value",defaultValue:p.KQ.color.min,settings:{placeholder:"Auto (min)"},category:t}).addNumberInput({path:"color.max",name:"End color scale at value",defaultValue:p.KQ.color.max,settings:{placeholder:"Auto (max)"},category:t}),t=["Cell display"],a.calculate||e.addTextInput({path:"rowsFrame.value",name:"Value name",defaultValue:p.KQ.rowsFrame?.value,settings:{placeholder:"Value"},category:t}),e.addUnitPicker({category:t,path:"cellValues.unit",name:"Unit",defaultValue:void 0,settings:{isClearable:!0}}).addNumberInput({category:t,path:"cellValues.decimals",name:"Decimals",settings:{placeholder:"Auto"}}),e.addSliderInput({name:"Cell gap",path:"cellGap",defaultValue:p.KQ.cellGap,category:t,settings:{min:0,max:25}}).addNumberInput({path:"filterValues.le",name:"Hide cells with values <=",defaultValue:p.KQ.filterValues?.le,settings:{placeholder:"None"},category:t}).addNumberInput({path:"filterValues.ge",name:"Hide cells with values >=",defaultValue:p.KQ.filterValues?.ge,settings:{placeholder:"None"},category:t}),t=["Tooltip"],e.addRadio({path:"tooltip.mode",name:"Tooltip mode",category:t,defaultValue:s.$N.Single,settings:{options:[{value:s.$N.Single,label:"Single"},{value:s.$N.Multi,label:"All"},{value:s.$N.None,label:"Hidden"}]}}),e.addBooleanSwitch({path:"tooltip.yHistogram",name:"Show histogram (Y axis)",defaultValue:p.KQ.tooltip.yHistogram,category:t,showIf:n=>n.tooltip.mode===s.$N.Single}),e.addBooleanSwitch({path:"tooltip.showColorScale",name:"Show color scale",defaultValue:p.KQ.tooltip.showColorScale,category:t,showIf:n=>n.tooltip.mode===s.$N.Single}),e.addNumberInput({path:"tooltip.maxWidth",name:"Max width",category:t,settings:{integer:!0},showIf:n=>n.tooltip.mode!==s.$N.None}),e.addNumberInput({path:"tooltip.maxHeight",name:"Max height",category:t,defaultValue:void 0,settings:{integer:!0},showIf:n=>n.tooltip?.mode===s.$N.Multi}),t=["Legend"],e.addBooleanSwitch({path:"legend.show",name:"Show legend",defaultValue:p.KQ.legend.show,category:t}),t=["Exemplars"],e.addColorPicker({path:"exemplars.color",name:"Color",defaultValue:p.KQ.exemplars.color,category:t})}).setSuggestionsSupplier(new yt).setDataSupport({annotations:!0})}}]);

//# sourceMappingURL=heatmapPanel.d9a07f78142e9e88784b.js.map