"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[8259],{71839:(S,y,t)=>{t.d(y,{o:()=>a});var v=t(74848),h=t(96540),O=t(40462),f=t(38075),x=t(63739),C=t(47286),A=t(85832),L=t(87579),u=t(7257),i=t(6248);function d(o,e,s=[]){for(const n of s)if(typeof n=="function"){if(!n(o,e))return!1}else if(e[n]!==o[n])return!1;return!0}const g={x:O.sJ.get(f.Ct.firstTimeField).get({}),y:O.sJ.get(f.Ct.byTypes).get(new Set([x.PU.number,x.PU.enum]))};class a extends h.Component{constructor(e){super(e),this.getTimeRange=()=>this.props.timeRange;let s=this.prepState(e);s.alignedData=s.config.prepData([s.alignedFrame]),this.state=s,this.plotInstance=h.createRef()}prepState(e,s=!0){let n=null;const{frames:l,fields:r=g,preparePlotFrame:D,replaceVariables:R,dataLinkPostProcessor:M}=e,W=D??i.m,I=l.some(_=>_.fields.some(U=>(U.config.links?.length??0)>0)),c=W(l,{...r,y:I?()=>!0:r.y},e.timeRange);if((0,u.uY)("GraphNG",!1,"data aligned",c),c){let _=c;if(I){const B=Array.isArray(this.props.timeZone)?this.props.timeZone[0]:this.props.timeZone;let E=l.map((P,p)=>({...P,fields:c.fields.filter((m,T)=>T===0||m.state?.origin?.frameIndex===p),length:c.length}));E.forEach((P,p)=>{P.fields.forEach(m=>{m.getLinks=(0,C._M)(P,m,{...m.state?.scopedVars,__dataContext:{value:{data:E,field:m,frame:P,frameIndex:p}}},R,B,M)})}),_={...c,fields:c.fields.filter((P,p)=>p===0||r.y(P,c,[c]))}}if(e.omitHideFromViz){const B=_.fields.filter(E=>E.config.custom?.hideFrom?.viz!==!0);_={..._,fields:B,length:B.length}}let U=this.state?.config;s&&(U=e.prepConfig(_,this.props.frames,this.getTimeRange),(0,u.uY)("GraphNG",!1,"config prepared",U)),n={alignedFrame:_,config:U},(0,u.uY)("GraphNG",!1,"data prepared",n.alignedData)}return n}componentDidUpdate(e){const{frames:s,structureRev:n,timeZone:l,cursorSync:r,propsToDiff:D}=this.props,R=!d(e,this.props,D);if(s!==e.frames||R||l!==e.timeZone||r!==e.cursorSync){let M=this.prepState(this.props,!1);M&&((this.state.config===void 0||l!==e.timeZone||r!==e.cursorSync||n!==e.structureRev||!n||R)&&(M.config=this.props.prepConfig(M.alignedFrame,this.props.frames,this.getTimeRange),(0,u.uY)("GraphNG",!1,"config recreated",M.config)),M.alignedData=M.config.prepData([M.alignedFrame]),this.setState(M))}}render(){const{width:e,height:s,children:n,renderLegend:l}=this.props,{config:r,alignedFrame:D,alignedData:R}=this.state;return r?(0,v.jsx)(A.KU,{width:e,height:s,legend:l(r),children:(M,W)=>(0,v.jsx)(L.Z,{config:r,data:R,width:M,height:W,plotRef:I=>this.plotInstance.current=I,children:n?n(r,D):null})}):null}}},6248:(S,y,t)=>{t.d(y,{m:()=>u});var v=t(63739),h=t(77230),O=t(66380);function f(i,d,g){let a,o;for(let e=0;e<d.length;e++)if(d[e]==null)o==null&&a!=null&&(o=e);else{if(o!=null&&a!=null){if(i[e]-a<g)for(;o<e;)d[o++]=void 0;o=null}a=i[e]}return d}var x=t(7500);function C(i){return i.type===v.PU.number&&i.config.custom?.drawStyle===x.GR.Bars&&!i.config.custom?.hideFrom?.viz}function A(i,d){return i.fields.find(g=>d!=null?g.name===d:g.type===v.PU.time)}function L(i,d){const g=A(i,d);let a=g?.values;for(let o=0;o<i.fields.length;o++){let e=i.fields[o];if(e===g||C(e))continue;let s=e.config.custom?.spanNulls;typeof s=="number"&&s!==-1&&a&&(e.values=f(a,e.values,s))}return i}function u(i,d,g){let a;t:for(let n of i)for(let l of n.fields)if(d.x(l,n,i)){a=l;break t}i=i.map(n=>a?.state?.nullThresholdApplied?n:(0,O.M)({frame:n,refFieldName:a.name,refFieldPseudoMin:g?.from.valueOf(),refFieldPseudoMax:g?.to.valueOf()}));let o=i.reduce((n,l)=>n+l.fields.reduce((r,D)=>r+(C(D)?1:0),0),0),e=1/0;o>1&&i.forEach(n=>{if(!n.fields.some(C))return;const l=a.values;for(let r=0;r<l.length;r++)r>0&&(e=Math.min(e,l[r]-l[r-1]))});let s=(0,h.Fd)({frames:i,joinBy:d.x,keep:d.y,keepOriginIndices:!0,keepDisplayNames:!0,nullMode:n=>{if(C(n))return h.WO;let l=n.config.custom?.spanNulls;return l===!0?h.RC:l===-1?h.WO:h.JI}});return s?(s=L(s,a.name),e!==1/0&&(s.fields.forEach((n,l)=>{let r=n.values;if(l===0){let D=r[r.length-1];r.push(D+e,D+2*e)}else C(n)?r.push(null,null):r.push(void 0,void 0)}),s.length+=2),s):null}},42515:(S,y,t)=>{t.d(y,{I:()=>d});var v=t(74848),h=t(96540),O=t(62931),f=t(63739),x=t(7500),C=t(85832),A=t(43987),L=t(71839),u=t(90825);const i=["rowHeight","colWidth","showValue","mergeValues","alignValue","tooltip","paginationRev"];class d extends h.Component{constructor(){super(...arguments),this.getValueColor=(a,o,e)=>{const s=this.props.frames[a]?.fields[o];if(s?.display){const n=s.display(e);if(n.color)return n.color}return O.F},this.prepConfig=(a,o,e)=>(0,u.iE)({frame:a,getTimeRange:e,allFrames:this.props.frames,...this.props,timeZones:Array.isArray(this.props.timeZone)?this.props.timeZone:[this.props.timeZone],rowHeight:a.fields.length>2?this.props.rowHeight:1,getValueColor:this.getValueColor,hoverMulti:this.props.tooltip?.mode===x.$N.Multi}),this.renderLegend=a=>{const{legend:o,legendItems:e}=this.props;return!a||!e||!o||o.showLegend===!1?null:(0,v.jsx)(C.KU.Legend,{placement:o.placement,children:(0,v.jsx)(A.t,{placement:o.placement,items:e,displayMode:o.displayMode,readonly:!0})})}}render(){return(0,v.jsx)(L.o,{...this.props,fields:{x:a=>a.type===f.PU.time,y:a=>a.type===f.PU.number||a.type===f.PU.boolean||a.type===f.PU.string||a.type===f.PU.enum},prepConfig:this.prepConfig,propsToDiff:i,renderLegend:this.renderLegend,omitHideFromViz:!0})}}},4266:(S,y,t)=>{t.d(y,{K:()=>g});var v=t(74848),h=t(63739),O=t(7500),f=t(53823),x=t(14411),C=t(33409),A=t(69921),L=t(37813),u=t(90825),i=t(69598),d=t(16725);const g=({series:a,dataIdxs:o,seriesIdx:e,mode:s=O.$N.Single,sortOrder:n=O.xB.None,isPinned:l,annotate:r,timeRange:D,withDuration:R,maxHeight:M,replaceVariables:W,dataLinks:I})=>{const c=a.fields[0],_=e!=null?o[e]:o.find(p=>p!=null),U=c.display(c.values[_]).text;s=l?O.$N.Single:s;const B=(0,L.cp)(a.fields,c,o,e,s,n);if(R&&s===O.$N.Single){const p=a.fields[e],m=(0,u.GY)(p,_);let T;m&&(T=c.values[m]);const K=c.values[_];let F;if(T)F=T&&(0,u.c5)(T-K);else{const j=D.to.valueOf();F=(0,u.c5)(j-K)}B.push({label:"Duration",value:F})}let E;if(e!=null){const p=a.fields[e],m=I.some(T=>T.oneClick===!0);if(l||m){const T=o[e],K=(0,i.OG)(a,p,W,T);E=(0,v.jsx)(x.S,{dataLinks:I,actions:K,annotate:r})}}const P={label:c.type===h.PU.time?"":c.state?.displayName??c.name,value:U};return(0,v.jsxs)(A.i,{children:[(0,v.jsx)(C.A,{item:P,isPinned:l}),(0,v.jsx)(f.o,{items:B,isPinned:l,scrollable:(0,d.T5)({mode:s,maxHeight:M}),maxHeight:M}),E]})}},51587:(S,y,t)=>{t.d(y,{K:()=>h,Q:()=>O});var v=t(7500);const h={alignValue:"left",mergeValues:!0,perPage:20,rowHeight:.9,showValue:v.yL.Auto},O={fillOpacity:70,lineWidth:0}},25450:(S,y,t)=>{t.d(y,{W:()=>i,i:()=>L});var v=t(74848),h=t(22803),O=t(96540),f=t(49185),x=t(16110),C=t(90825),A=t(51587);const L={container:(0,h.css)({display:"flex",flexDirection:"column"})},u={paginationContainer:(0,h.css)({display:"flex",justifyContent:"center",width:"100%"}),paginationElement:(0,h.css)({marginTop:"8px"})};function i(d,g){const[a,o]=(0,O.useState)(1),[e,{height:s,width:n}]=(0,f.A)(),l=(0,O.useMemo)(()=>!g||d==null?d:(0,C.uB)(d),[d,g]);if(!g||l==null)return{paginatedFrames:l,paginationRev:"disabled",paginationElement:void 0,paginationHeight:0};g||=A.K.perPage;const r=Math.ceil(l.length/g),D=Math.min(a,r),R=(D-1)*g,M=l.slice(R,R+g),W=`${D}/${g}`,I=n<550,c=(0,v.jsx)("div",{className:u.paginationContainer,ref:e,children:(0,v.jsx)(x.d,{className:u.paginationElement,currentPage:D,numberOfPages:r,showSmallVersion:I,onNavigate:o})});return{paginatedFrames:M,paginationRev:W,paginationElement:c,paginationHeight:s}}},22549:(S,y,t)=>{t.r(y),t.d(y,{plugin:()=>B});var v=t(68256),h=t(62321),O=t(62931),f=t(7500),x=t(95118),C=t(59698),A=t(13678),L=t(30040),u=t(74848),i=t(96540),d=t(74958),g=t(29675),a=t(90415),o=t(72778),e=t(12963),s=t(42515),n=t(90825),l=t(4266),r=t(25450),D=t(4188),R=t(37604),M=t(16725);const W=({data:E,timeRange:P,timeZone:p,options:m,width:T,height:K,replaceVariables:F,onChangeTimeRange:j})=>{const V=(0,g.$j)(),[q,Z]=(0,i.useState)(null),{sync:tt,eventsScope:et,canAddAnnotations:J,dataLinkPostProcessor:nt,eventBus:at}=(0,a.d2)(),$=tt?.()??d.y.Off,Q=!!(J&&J()),{frames:st,warn:X}=(0,i.useMemo)(()=>(0,n.Qe)(E.series,!1,P,V),[E.series,P,V]),{paginatedFrames:N,paginationRev:it,paginationElement:ot,paginationHeight:lt}=(0,r.W)(st,m.perPage),rt=(0,i.useMemo)(()=>(0,n.Or)(N,m.legend,V),[N,m.legend,V]),ut=(0,i.useMemo)(()=>(0,M.Fg)(m.timezone,p),[m.timezone,p]);return!N||X?(0,u.jsx)("div",{className:"panel-empty",children:(0,u.jsx)("p",{children:X??"No data found in response"})}):N[0].length>T/2?(0,u.jsx)("div",{className:"panel-empty",children:(0,u.jsxs)("p",{children:["Too many points to visualize properly. ",(0,u.jsx)("br",{}),"Update the query to return fewer points. ",(0,u.jsx)("br",{}),"(",N[0].length," points received)"]})}):(0,u.jsxs)("div",{className:r.i.container,children:[(0,u.jsx)(s.I,{theme:V,frames:N,structureRev:E.structureRev,paginationRev:it,timeRange:P,timeZone:ut,width:T,height:K-lt,legendItems:rt,...m,mode:n.pm.Samples,replaceVariables:F,dataLinkPostProcessor:nt,cursorSync:$,children:(H,z)=>(0,u.jsxs)(u.Fragment,{children:[$!==d.y.Off&&(0,u.jsx)(o.K,{config:H,eventBus:at,frame:z}),m.tooltip.mode!==f.$N.None&&(0,u.jsx)(e.xl,{config:H,hoverMode:m.tooltip.mode===f.$N.Multi?e.b3.xAll:e.b3.xOne,queryZoom:j,syncMode:$,syncScope:et,getDataLinks:(G,Y)=>z.fields[G].getLinks?.({valueRowIndex:Y})??[],render:(G,Y,dt,ft,w,b,gt,mt)=>{if(Q&&b!=null){Z(b),w();return}const ct=()=>{let k=G.posToVal(G.cursor.left,"x");Z({from:k,to:k}),w()};return(0,u.jsx)(l.K,{series:z,dataIdxs:Y,seriesIdx:dt,mode:gt?f.$N.Multi:m.tooltip.mode,sortOrder:m.tooltip.sort,isPinned:ft,timeRange:P,annotate:Q?ct:void 0,withDuration:!1,maxHeight:m.tooltip.maxHeight,replaceVariables:F,dataLinks:mt})},maxWidth:m.tooltip.maxWidth}),z.fields[0].config.custom?.axisPlacement!==f.vM.Hidden&&(0,u.jsx)(D.W,{annotations:E.annotations??[],config:H,timeZone:p,newRange:q,setNewRange:Z,canvasRegionRendering:!1}),(0,u.jsx)(R.U,{config:H,onChangeTimeRange:j})]})}),ot]})},I={colWidth:.9,perPage:20,rowHeight:.9,showValue:f.yL.Auto},c={fillOpacity:70,lineWidth:1};var _=t(18550);class U{getSuggestionsForData(P){const{dataSummary:p}=P;if(!p.hasData||!p.hasTimeField||!p.hasStringField&&!p.hasNumberField||p.numberFieldCount>=30||p.rowCountMax>100||p.preferredVisualisationType==="logs")return;P.getListAppender({name:"",pluginId:"status-history",options:{},fieldConfig:{defaults:{color:{mode:O.Y.ContinuousGrYlRd},custom:{}},overrides:[]},cardOptions:{previewModifier:T=>{T.options.colWidth=.7}}}).append({name:_.m.StatusHistory})}}const B=new v.m(W).useFieldConfig({standardOptions:{[h.uo.Color]:{settings:{byValueSupport:!0},defaultValue:{mode:O.Y.Thresholds}},[h.uo.Links]:{settings:{showOneClick:!0}},[h.uo.Actions]:{hideFromDefaults:!1}},useCustomConfig:E=>{E.addSliderInput({path:"lineWidth",name:"Line width",defaultValue:c.lineWidth,settings:{min:0,max:10,step:1}}).addSliderInput({path:"fillOpacity",name:"Fill opacity",defaultValue:c.fillOpacity,settings:{min:0,max:100,step:1}}),x.e(E),C.Wq(E,P=>P===f.vM.Auto||P===f.vM.Hidden),C.T4(E)}}).setPanelOptions(E=>{E.addRadio({path:"showValue",name:"Show values",settings:{options:[{value:f.yL.Auto,label:"Auto"},{value:f.yL.Always,label:"Always"},{value:f.yL.Never,label:"Never"}]},defaultValue:f.yL.Auto}).addSliderInput({path:"rowHeight",name:"Row height",defaultValue:.9,settings:{min:0,max:1,step:.01}}).addSliderInput({path:"colWidth",name:"Column width",defaultValue:.9,settings:{min:0,max:1,step:.01}}).addNumberInput({path:"perPage",name:"Page size (enable pagination)",settings:{min:1,step:1,integer:!0}}),A.H(E,!1),L.D(E)}).setSuggestionsSupplier(new U).setDataSupport({annotations:!0})}}]);

//# sourceMappingURL=statusHistoryPanel.c2d0cc2572f8e86e508e.js.map