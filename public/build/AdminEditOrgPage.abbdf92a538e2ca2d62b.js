"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[9119],{60156:(Z,P,e)=>{e.d(P,{y:()=>f});var s=e(74848),r=e(96540),D=e(41053),x=e(87638),g=e(61491),T=e(71623),l=e(26185);const f=({basicRole:y,roles:m,userId:d,orgId:o,onBasicRoleChange:h,roleOptions:U,disabled:p,basicRoleDisabled:u,basicRoleDisabledMessage:I,apply:E=!1,onApplyRoles:C,pendingRoles:M,maxWidth:K,width:W,isLoading:B})=>{const[{loading:Y,value:w=m||[]},v]=(0,D.A)(async()=>{try{if(m)return m;if(E&&M?.length)return M;if(x.TP.hasPermission(g.AccessControlAction.ActionUserRolesList)&&d>0)return await(0,l.Xh)(d,o)}catch{console.error("Error loading options")}return[]},[o,d,M,m]);(0,r.useEffect)(()=>{o&&v()},[v,o]);const i=async O=>{E?C&&C(O,d,o):(await(0,l.eA)(O,d,o),await v())},a=x.TP.hasPermission(g.AccessControlAction.ActionUserRolesAdd)&&x.TP.hasPermission(g.AccessControlAction.ActionUserRolesRemove);return(0,s.jsx)(T.n,{appliedRoles:w,basicRole:y,onRolesChange:i,onBasicRoleChange:h,roleOptions:U,isLoading:Y||B,disabled:p,basicRoleDisabled:u,basicRoleDisabledMessage:I,showBasicRole:!0,apply:E,canUpdateRoles:a,maxWidth:K,width:W})}},97531:(Z,P,e)=>{e.d(P,{I:()=>o});var s=e(74848),r=e(49785),D=e(35095),x=e(54731),g=e(58528),T=e(86489),l=e(60641),f=e(11817),y=e(61491);const m=Object.keys(y.OrgRole).map(D.z),d=(0,s.jsxs)(f.x6,{i18nKey:"role-picker.title.description",children:["Assign roles to users to ensure granular control over access to Grafana\u2018s features and resources. Find out more in our"," ",(0,s.jsx)(x.Y,{external:!0,href:"https://grafana.com/docs/grafana/latest/administration/roles-and-permissions/#organization-roles",children:"documentation"}),"."]}),o=({onClose:h})=>{const U=(0,r.xW)(),{control:p,getValues:u,setValue:I}=U,[E,C]=u(["name","roles"]);return(0,s.jsx)(g._,{title:E,subtitle:d,onClose:h,children:(0,s.jsx)(T.D,{label:(0,f.t)("role-picker-drawer.basic-roles.label","Basic Roles"),children:(0,s.jsx)(r.xI,{name:"role",control:p,render:({field:{onChange:M,ref:K,...W}})=>(0,s.jsx)(l.z,{...W,options:m,onChange:B=>{I("roleCollection",[B,...C]),M(B)}})})})})}},9333:(Z,P,e)=>{e.r(P),e.d(P,{default:()=>v});var s=e(74848),r=e(96540),D=e(49785),x=e(54148),g=e(41053),T=e(37e3),l=e(99178),f=e(86489),y=e(34128),m=e(54594),d=e(54122),o=e(87638),h=e(11817),U=e(61491),p=e(87116),u=e(28082),I=e(15084);const E=30,C=async i=>await(0,u.AI)().get(`/api/orgs/${i}`),M=async(i,a)=>o.TP.hasPermission(U.AccessControlAction.OrgUsersRead)?(0,u.AI)().get(`/api/orgs/${i}/users/search`,(0,I.F)({perpage:E,page:a})):{orgUsers:[]},K=async(i,a)=>{const O=a.map(A=>A.userId),S=await(0,u.AI)().post("/api/access-control/users/roles/search?includeMapped=true",{userIds:O,orgId:i});a.forEach(A=>{A.roles=S?S[A.userId]||[]:[]})},W=(i,a)=>(0,u.AI)().patch(`/api/orgs/${a}/users/${i.userId}`,i),B=(i,a)=>(0,u.AI)().delete(`/api/orgs/${a}/users/${i.userId}`),Y=(i,a)=>(0,u.AI)().put(`/api/orgs/${a}`,{name:i}),v=()=>{const{id:i=""}=(0,x.g)(),a=parseInt(i,10),O=o.TP.hasPermission(U.AccessControlAction.OrgsWrite),S=o.TP.hasPermission(U.AccessControlAction.OrgUsersRead),[A,q]=(0,r.useState)([]),[N,j]=(0,r.useState)(1),[c,z]=(0,r.useState)(1),[R,F]=(0,g.A)(()=>C(a),[]),{handleSubmit:G,register:b,formState:{errors:V}}=(0,D.mN)(),[,L]=(0,g.A)(async t=>{const n=await M(a,t);o.TP.licensedAccessControlEnabled()&&await K(a,n.orgUsers);const J=n?.perPage!==0?Math.ceil(n.totalCount/n.perPage):0;return z(J),q(n.orgUsers),n.orgUsers},[]);(0,r.useEffect)(()=>{F(),L(N)},[F,L,N]);const $=async({orgName:t})=>{await Y(t,a)},X=()=>(0,s.jsx)(T.F,{severity:"info",title:"Access denied",children:(0,s.jsx)(h.x6,{i18nKey:"admin.edit-org.access-denied",children:"You do not have permission to see users in this organization. To update this organization, contact your server administrator."})}),H=t=>{j(t)},k=async t=>{await B(t,a),L(N)},_=async(t,n)=>{await W({...n,role:t},a),L(N)},ee={text:R?.value?.name??"",icon:"shield",subTitle:"Manage settings and user roles for an organization."};return(0,s.jsx)(d.Y,{navId:"global-orgs",pageNav:ee,subTitle:"Manage settings for this specific org.",children:(0,s.jsx)(d.Y.Contents,{children:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(l.s,{children:(0,s.jsx)(h.x6,{i18nKey:"admin.edit-org.heading",children:"Edit Organization"})}),R.value&&(0,s.jsxs)("form",{onSubmit:G($),style:{maxWidth:"600px"},children:[(0,s.jsx)(f.D,{label:"Name",invalid:!!V.orgName,error:"Name is required",disabled:!O,children:(0,s.jsx)(y.p,{...b("orgName",{required:!0}),id:"org-name-input",defaultValue:R.value.name})}),(0,s.jsx)(m.$n,{type:"submit",disabled:!O,children:(0,s.jsx)(h.x6,{i18nKey:"admin.edit-org.update-button",children:"Update"})})]}),(0,s.jsxs)("div",{style:{marginTop:"20px"},children:[(0,s.jsx)(l.s,{children:(0,s.jsx)(h.x6,{i18nKey:"admin.edit-org.users-heading",children:"Organization users"})}),!S&&X(),S&&!!A.length&&(0,s.jsx)(p.b,{users:A,orgId:a,onRoleChange:_,onRemoveUser:k,changePage:H,page:N,totalPages:c})]})]})})})}},68031:(Z,P,e)=>{e.d(P,{r:()=>T});var s=e(74848),r=e(83827),D=e(44826);const g=Object.values(r.X).filter(l=>l!==r.X.None).map(l=>({label:l,value:l}));function T({value:l,onChange:f,"aria-label":y,inputId:m,autoFocus:d,...o}){return(0,s.jsx)(D.l6,{inputId:m,value:l,options:g,onChange:h=>f(h.value??r.X.None),placeholder:"Choose role...","aria-label":y,autoFocus:d,...o})}},87116:(Z,P,e)=>{e.d(P,{b:()=>N});var s=e(74848),r=e(96540),D=e(58779),x=e(32370),g=e(40232),T=e(45565),l=e(90231),f=e(6736),y=e(79784),m=e(73903),d=e(54594),o=e(48583),h=e(14123),U=e(16110),p=e(65164),u=e(60156),I=e(26185),E=e(22803),C=e(49785),M=e(29675),K=e(66384),W=e(97531);const B=({disabled:j,user:c})=>{const[z,R]=(0,r.useState)(!1),{badge:F,badgeDisabled:G}=(0,M.of)(Y),b=j?G:F,V=(0,C.mN)({defaultValues:{name:c.name,role:c.role,roles:c.roles}}),{watch:L}=V,$=()=>{j||R(!0)};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(o.B,{gap:1,children:[(0,s.jsx)(K.E,{className:b,color:"blue",onClick:$,text:L("role")}),c.roles&&c.roles.length>0&&(0,s.jsx)(K.E,{className:b,color:"blue",onClick:$,text:`+${c.roles.length}`})]}),z&&(0,s.jsx)(C.Op,{...V,children:(0,s.jsx)(W.I,{onClose:()=>R(!1)})})]})};function Y(j){return{badge:(0,E.css)({cursor:"pointer"}),badgeDisabled:(0,E.css)({cursor:"not-allowed"})}}var w=e(29272),v=e(87638),i=e(11817),a=e(61491),O=e(68031);const S=`This user's role is not editable because it is synchronized from your auth provider.
Refer to the Grafana authentication docs for details.`,A=j=>{const c=j?.isExternallySynced;return!v.TP.hasPermissionInMetadata(a.AccessControlAction.OrgUsersWrite,j)||c},q=D.Tp.pages.UserListPage.UsersListPage,N=({users:j,orgId:c,onRoleChange:z,onUserRolesChange:R,onRemoveUser:F,fetchData:G,changePage:b,page:V,totalPages:L,rolesLoading:$})=>{const[X,H]=(0,r.useState)(null),[k,_]=(0,r.useState)([]);(0,r.useEffect)(()=>{async function t(){try{if(v.TP.hasPermission(a.AccessControlAction.ActionRolesList)){let n=await(0,I.RL)(c);_(n)}}catch{console.error("Error loading options")}}v.TP.licensedAccessControlEnabled()&&t()},[c]);const ee=(0,r.useMemo)(()=>[{id:"avatarUrl",header:"",cell:({cell:{value:t}})=>t&&(0,s.jsx)(g.e,{src:t,alt:"User avatar"})},{id:"login",header:"Login",cell:({cell:{value:t}})=>(0,s.jsx)("div",{children:t}),sortType:"string"},{id:"email",header:"Email",cell:({cell:{value:t}})=>t,sortType:"string"},{id:"name",header:"Name",cell:({cell:{value:t}})=>t,sortType:"string"},{id:"lastSeenAtAge",header:"Last active",cell:({cell:{value:t}})=>(0,s.jsx)(s.Fragment,{children:t&&(0,s.jsx)(s.Fragment,{children:t==="10 years"?(0,s.jsx)(T.E,{color:"disabled",children:(0,s.jsx)(i.x6,{i18nKey:"admin.org-uers.last-seen-never",children:"Never"})}):t})}),sortType:(t,n)=>new Date(t.original.lastSeenAt).getTime()-new Date(n.original.lastSeenAt).getTime()},{id:"role",header:"Role",cell:({cell:{value:t},row:{original:n}})=>{const J=A(n),se=async(Q,te,ae)=>{await(0,I.eA)(Q,te,ae),R&&R()};return x.$.featureToggles.rolePickerDrawer?(0,s.jsx)(B,{disabled:J,user:n}):v.TP.licensedAccessControlEnabled()?(0,s.jsx)(u.y,{userId:n.userId,roles:n.roles,apply:!0,onApplyRoles:se,isLoading:$,orgId:c,roleOptions:k,basicRole:t,onBasicRoleChange:Q=>z(Q,n),basicRoleDisabled:J,basicRoleDisabledMessage:S,width:40}):(0,s.jsx)(O.r,{"aria-label":"Role",value:t,disabled:J,onChange:Q=>z(Q,n)})}},{id:"info",header:"",cell:({row:{original:t}})=>A(t)&&(0,s.jsx)(l.a,{display:"flex",alignItems:"center",marginLeft:1,children:(0,s.jsx)(f.m,{interactive:!0,content:(0,s.jsx)("div",{children:(0,s.jsxs)(i.x6,{i18nKey:"admin.org-users.not-editable",children:["This user's role is not editable because it is synchronized from your auth provider. Refer to the\xA0",(0,s.jsx)("a",{href:"https://grafana.com/docs/grafana/latest/administration/user-management/manage-org-users/#change-a-users-organization-permissions",rel:"noreferrer",target:"_blank",children:"Grafana authentication docs"}),"\xA0for details."]})}),children:(0,s.jsx)(y.I,{name:"question-circle"})})})},{id:"authLabels",header:"Origin",cell:({cell:{value:t}})=>(0,s.jsx)(s.Fragment,{children:Array.isArray(t)&&t.length>0&&(0,s.jsx)(w.E,{label:t[0],removeIcon:!1,count:0})})},{id:"isDisabled",header:"",cell:({cell:{value:t}})=>(0,s.jsx)(s.Fragment,{children:t&&(0,s.jsx)(m.v,{colorIndex:9,name:"Disabled"})})},{id:"delete",header:"",cell:({row:{original:t}})=>v.TP.hasPermissionInMetadata(a.AccessControlAction.OrgUsersRemove,t)&&(0,s.jsx)(d.$n,{size:"sm",variant:"destructive",onClick:()=>{H(t)},icon:"times","aria-label":`Delete user ${t.name}`})}],[$,c,k,R,z]);return(0,s.jsxs)(o.B,{direction:"column",gap:2,"data-testid":q.container,children:[(0,s.jsx)(h.j,{columns:ee,data:j,getRowId:t=>String(t.userId),fetchData:G}),(0,s.jsx)(o.B,{justifyContent:"flex-end",children:(0,s.jsx)(U.d,{onNavigate:b,currentPage:V,numberOfPages:L,hideWhenSinglePage:!0})}),!!X&&(0,s.jsx)(p.u,{body:`Are you sure you want to delete user ${X?.login}?`,confirmText:"Delete",title:"Delete",onDismiss:()=>{H(null)},isOpen:!0,onConfirm:()=>{X&&(F(X),H(null))}})]})}}}]);

//# sourceMappingURL=AdminEditOrgPage.abbdf92a538e2ca2d62b.js.map