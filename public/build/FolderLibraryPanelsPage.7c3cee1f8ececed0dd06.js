"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[5804],{6221:(x,m,a)=>{a.r(m),a.d(m,{BrowseFolderLibraryPanelsPage:()=>s,default:()=>C});var e=a(74848),P=a(96540),r=a(54148),o=a(54122),g=a(12452),O=a(64199),n=a(43518),M=a(20741),l=a(15664);function s(){const{uid:v=""}=(0,r.g)(),{data:i}=(0,l.kH)(v),[t,d]=(0,P.useState)(void 0),[u]=(0,l.iB)(),D=(0,P.useMemo)(()=>{if(!i)return;const c=(0,O.R4)(i),_=(0,O.pq)(i.uid),E=c.children?.find(f=>f.id===_);return E&&(E.active=!0),c},[i]),h=v?async c=>{if(i){const _=await u({...i,title:c});if("error"in _)throw _.error}}:void 0;return(0,e.jsx)(o.Y,{navId:"dashboards/browse",pageNav:D,onEditTitle:h,actions:(0,e.jsx)(e.Fragment,{children:i&&(0,e.jsx)(g.m,{folder:i})}),children:(0,e.jsxs)(o.Y.Contents,{children:[(0,e.jsx)(n.j,{onClick:d,currentFolderUID:v,showSecondaryActions:!0,showSort:!0,showPanelFilter:!0}),t?(0,e.jsx)(M.F,{onDismiss:()=>d(void 0),libraryPanel:t}):null]})})}const C=s},65139:(x,m,a)=>{a.d(m,{T:()=>v});var e=a(74848),P=a(96540),r=a(56276),o=a(32370),g=a(65164),O=a(45565),n=a(9968),M=a(37e3),l=a(11817),s=a(15664),C=a(97204);const v=({onConfirm:i,onDismiss:t,selectedItems:d,...u})=>{const{data:D}=(0,s.G2)(d),h=!!(D&&(D.alertRule||D.libraryPanel)),[c,_]=(0,P.useState)(!1),E=async()=>{(0,r.rR)("grafana_manage_dashboards_delete_clicked",{item_counts:{dashboard:Object.keys(d.dashboard).length,folder:Object.keys(d.folder).length},source:"browse_dashboards",restore_enabled:!!o.$.featureToggles.dashboardRestore}),_(!0);try{await i(),_(!1),t()}catch{_(!1)}};return(0,e.jsx)(g.u,{body:(0,e.jsxs)(e.Fragment,{children:[o.$.featureToggles.dashboardRestore&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(O.E,{element:"p",children:(0,e.jsx)(l.x6,{i18nKey:"browse-dashboards.action.delete-modal-restore-dashboards-text",children:"This action will delete the selected folders immediately but the selected dashboards will be marked for deletion in 30 days. Your organization administrator can restore the dashboards anytime before the 30 days expire. Folders cannot be restored."})}),(0,e.jsx)(n.$,{v:2})]}),(0,e.jsx)(O.E,{element:"p",children:(0,e.jsx)(l.x6,{i18nKey:"browse-dashboards.action.delete-modal-text",children:"This action will delete the following content:"})}),(0,e.jsx)(C.x,{selectedItems:d}),(0,e.jsx)(n.$,{v:2})]}),description:(0,e.jsx)(e.Fragment,{children:h?(0,e.jsx)(M.F,{severity:"warning",title:(0,l.t)("browse-dashboards.action.delete-modal-invalid-title","Cannot delete folder"),children:(0,e.jsx)(l.x6,{i18nKey:"browse-dashboards.action.delete-modal-invalid-text",children:"One or more folders contain library panels or alert rules. Delete these first in order to proceed."})}):null}),confirmationText:(0,l.t)("browse-dashboards.action.confirmation-text","Delete"),confirmText:c?(0,l.t)("browse-dashboards.action.deleting","Deleting..."):(0,l.t)("browse-dashboards.action.delete-button","Delete"),onDismiss:t,onConfirm:E,title:(0,l.t)("browse-dashboards.action.delete-modal-title","Delete"),...u,disabled:h})}},98009:(x,m,a)=>{a.d(m,{J:()=>v});var e=a(74848),P=a(96540),r=a(25356),o=a(37e3),g=a(45565),O=a(9968),n=a(86489),M=a(54594),l=a(62851),s=a(11817),C=a(97204);const v=({onConfirm:i,onDismiss:t,selectedItems:d,...u})=>{const[D,h]=(0,P.useState)(),[c,_]=(0,P.useState)(!1),E=Object.keys(d.folder).filter(L=>d.folder[L]),f=async()=>{if(D!==void 0){_(!0);try{await i(D),_(!1),t()}catch{_(!1)}}};return(0,e.jsxs)(r.a,{title:(0,s.t)("browse-dashboards.action.move-modal-title","Move"),onDismiss:t,...u,children:[E.length>0&&(0,e.jsx)(o.F,{severity:"info",title:(0,s.t)("browse-dashboards.action.move-modal-alert","Moving this item may change its permissions.")}),(0,e.jsx)(g.E,{element:"p",children:(0,e.jsx)(s.x6,{i18nKey:"browse-dashboards.action.move-modal-text",children:"This action will move the following content:"})}),(0,e.jsx)(C.x,{selectedItems:d}),(0,e.jsx)(O.$,{v:3}),(0,e.jsx)(n.D,{label:(0,s.t)("browse-dashboards.action.move-modal-field-label","Folder name"),children:(0,e.jsx)(l.d,{value:D,excludeUIDs:E,onChange:h})}),(0,e.jsxs)(r.a.ButtonRow,{children:[(0,e.jsx)(M.$n,{onClick:t,variant:"secondary",fill:"outline",children:(0,e.jsx)(s.x6,{i18nKey:"browse-dashboards.action.cancel-button",children:"Cancel"})}),(0,e.jsx)(M.$n,{disabled:D===void 0||c,onClick:f,variant:"primary",children:c?(0,s.t)("browse-dashboards.action.moving","Moving..."):(0,s.t)("browse-dashboards.action.move-button","Move")})]})]})}},12452:(x,m,a)=>{a.d(m,{m:()=>_});var e=a(74848),P=a(96540),r=a(32370),o=a(56276),g=a(53027),O=a(19224),n=a(36529),M=a(60232),l=a(54594),s=a(79784),C=a(58528),v=a(12590),i=a(87638),t=a(11817),d=a(91830),u=a(15664),D=a(30962),h=a(65139),c=a(98009);function _({folder:E}){const[f,L]=(0,P.useState)(!1),[B,A]=(0,P.useState)(!1),[I]=(0,u.aF)(),[W]=(0,u.Ko)(),{canEditFolders:U,canDeleteFolders:K,canViewPermissions:R,canSetPermissions:j}=(0,D.N)(E),T=r.$.featureToggles.nestedFolders&&U,y=async b=>{await I({folder:E,destinationUID:b}),(0,o.rR)("grafana_manage_dashboards_item_moved",{item_counts:{folder:1,dashboard:0},source:"folder_actions"})},p=async()=>{await W(E),(0,o.rR)("grafana_manage_dashboards_item_deleted",{item_counts:{folder:1,dashboard:0},source:"folder_actions"});const{parents:b}=E,z=b&&b.length?b[b.length-1].url:"/dashboards";g.Ny.push(z)},F=()=>{i.lE.publish(new d.S8({component:c.J,props:{selectedItems:{folder:{[E.uid]:!0},dashboard:{},panel:{},$all:!1},onConfirm:y}}))},S=()=>{i.lE.publish(new d.S8({component:h.T,props:{selectedItems:{folder:{[E.uid]:!0},dashboard:{},panel:{},$all:!1},onConfirm:p}}))},$=(0,t.t)("browse-dashboards.folder-actions-button.manage-permissions","Manage permissions"),w=(0,t.t)("browse-dashboards.folder-actions-button.move","Move"),V=(0,t.t)("browse-dashboards.folder-actions-button.delete","Delete"),N=(0,e.jsxs)(O.W,{children:[R&&(0,e.jsx)(n.D,{onClick:()=>A(!0),label:$}),T&&(0,e.jsx)(n.D,{onClick:F,label:w}),K&&(0,e.jsx)(n.D,{destructive:!0,onClick:S,label:V})]});return!R&&!T&&!K?null:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(M.m,{overlay:N,onVisibleChange:L,children:(0,e.jsxs)(l.$n,{variant:"secondary",children:[(0,e.jsx)(t.x6,{i18nKey:"browse-dashboards.folder-actions-button.folder-actions",children:"Folder actions"}),(0,e.jsx)(s.I,{name:f?"angle-up":"angle-down"})]})}),B&&(0,e.jsx)(C._,{title:(0,t.t)("browse-dashboards.action.manage-permissions-button","Manage permissions"),subtitle:E.title,onClose:()=>A(!1),size:"md",children:(0,e.jsx)(v.x,{resource:"folders",resourceId:E.uid,canSetPermissions:j})})]})}},30962:(x,m,a)=>{a.d(m,{N:()=>O});var e=a(32370),P=a(87638),r=a(61491);function o(n,M){return M?P.TP.hasPermissionInMetadata(n,M):P.TP.hasPermission(n)}function g(n){return n&&n.uid!=="general"&&!e.$.featureToggles.nestedFolders?!1:e.$.featureToggles.accessActionSets?o(r.AccessControlAction.FoldersCreate,n):!n||n.uid==="general"?o(r.AccessControlAction.FoldersCreate):o(r.AccessControlAction.FoldersCreate)&&o(r.AccessControlAction.FoldersWrite,n)}function O(n){const M=o(r.AccessControlAction.DashboardsCreate,n),l=g(n),s=o(r.AccessControlAction.FoldersDelete,n),C=o(r.AccessControlAction.DashboardsWrite,n),v=o(r.AccessControlAction.FoldersWrite,n),i=o(r.AccessControlAction.FoldersPermissionsWrite,n),t=o(r.AccessControlAction.FoldersPermissionsRead,n);return{canCreateDashboards:M,canCreateFolders:l,canDeleteFolders:s,canEditDashboards:C,canEditFolders:v,canSetPermissions:i,canViewPermissions:t}}},20741:(x,m,a)=>{a.d(m,{F:()=>v});var e=a(74848),P=a(76459),r=a.n(P),o=a(96540),g=a(93407),O=a(53027),n=a(25356),M=a(44826),l=a(54594),s=a(11817),C=a(81569);function v({libraryPanel:t,onDismiss:d}){const[u,D]=(0,o.useState)(!1),[h,c]=(0,o.useState)(0),[_,E]=(0,o.useState)(void 0);(0,o.useEffect)(()=>{(async()=>{const I=await(0,C.GN)(t.uid);c(I.length)})()},[t.uid]);const f=(0,o.useCallback)(A=>i(t.uid,A,D),[t.uid]),L=(0,o.useMemo)(()=>r()(f,300,{leading:!0}),[f]),B=A=>{A.preventDefault(),O.Ny.push(g.kM.renderUrl(`/d/${_?.value?.uid}`,{}))};return(0,e.jsxs)(n.a,{title:(0,s.t)("library-panels.modal.title","View panel in dashboard"),onDismiss:d,onClickBackdrop:d,isOpen:!0,children:[(0,e.jsxs)("div",{children:[h===0?(0,e.jsx)("span",{children:(0,e.jsx)(s.x6,{i18nKey:"library-panels.modal.panel-not-linked",children:"Panel is not linked to a dashboard. Add the panel to a dashboard and retry."})}):null,h>0?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("p",{children:(0,e.jsxs)(s.x6,{i18nKey:"library-panels.modal.body",count:h,children:["This panel is being used in ",{count:h}," dashboard. Please choose which dashboard to view the panel in:"]})}),(0,e.jsx)(M.DW,{isClearable:!0,isLoading:u,defaultOptions:!0,loadOptions:L,onChange:E,placeholder:(0,s.t)("library-panels.modal.select-placeholder","Start typing to search for dashboard"),noOptionsMessage:(0,s.t)("library-panels.modal.select-no-options-message","No dashboards found")})]}):null]}),(0,e.jsxs)(n.a.ButtonRow,{children:[(0,e.jsx)(l.$n,{variant:"secondary",onClick:d,fill:"outline",children:(0,e.jsx)(s.x6,{i18nKey:"library-panels.modal.button-cancel",children:"Cancel"})}),(0,e.jsx)(l.$n,{onClick:B,disabled:!_,children:_?(0,s.t)("library-panels.modal.button-view-panel1","View panel in {{label}}...",{label:_?.label}):(0,s.t)("library-panels.modal.button-view-panel2","View panel in dashboard...")})]})]})}async function i(t,d,u){u(!0);const h=(await(0,C.xV)(t)).filter(c=>c.title.toLowerCase().includes(d.toLowerCase())).map(c=>({label:c.title,value:c}));return u(!1),h}}}]);

//# sourceMappingURL=FolderLibraryPanelsPage.7c3cee1f8ececed0dd06.js.map