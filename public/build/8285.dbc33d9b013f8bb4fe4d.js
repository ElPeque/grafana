"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[8285],{57323:($,D,n)=>{n.d(D,{_:()=>L});var t=n(74848),a=n(2543),f=n.n(a),I=n(747);const L=({actions:l,children:i})=>{const r=(0,a.filter)(l,y),d=(0,a.filter)(l,v);return r.length?(0,t.jsx)(m,{actions:r,children:i}):d.length?(0,t.jsx)(R,{actions:d,children:i}):null},m=({actions:l,children:i})=>{const r=(0,I.iI)();return N(r,l)?(0,t.jsx)(t.Fragment,{children:i}):null},R=({actions:l,children:i})=>{const r=(0,I.e2)();return N(r,l)?(0,t.jsx)(t.Fragment,{children:i}):null};function N(l,i){return(0,a.chain)(l).pick(i).values().value().some(([r,d])=>d===!0)}function y(l){return Object.values(I.QI).includes(l)}function v(l){return Object.values(I.RY).includes(l)}},73370:($,D,n)=>{n.d(D,{s:()=>v});var t=n(74848),a=n(22803),f=n(2543),I=n.n(f),L=n(29675),m=n(48583),R=n(27671),N=n(55936),y=n(2178);const v=({matchers:r,formatter:d="default"})=>{const M=(0,L.of)(i),P=5,C=(0,f.take)(r,P),S=(0,f.takeRight)(r,r.length-P),W=S.length>0;return(0,t.jsx)("span",{"data-testid":"label-matchers",children:(0,t.jsxs)(m.B,{direction:"row",gap:1,alignItems:"center",wrap:"wrap",children:[C.map(b=>(0,t.jsx)(l,{matcher:b,formatter:d},(0,f.uniqueId)())),W&&(0,t.jsx)(y.B,{arrow:!0,placement:"top",content:(0,t.jsx)(t.Fragment,{children:S.map(b=>(0,t.jsx)(l,{matcher:b},(0,f.uniqueId)()))}),children:(0,t.jsx)("span",{children:(0,t.jsx)("div",{className:M.metadata,children:`and ${S.length} more`})})})]})})},l=({matcher:r,formatter:d="default"})=>{const M=(0,L.of)(i);return(0,t.jsx)("div",{className:M.matcher(r[0]).wrapper,children:(0,t.jsx)(m.B,{direction:"row",gap:0,alignItems:"baseline",children:N.t8[d](r)})})},i=r=>({matcher:d=>{const{color:M,borderColor:P}=(0,R.MC)(d);return{wrapper:(0,a.css)({color:"#fff",background:M,padding:`${r.spacing(.33)} ${r.spacing(.66)}`,fontSize:r.typography.bodySmall.fontSize,border:`solid 1px ${P}`,borderRadius:r.shape.borderRadius(2),whiteSpace:"pre"})}},metadata:(0,a.css)({color:r.colors.text.secondary,fontSize:r.typography.bodySmall.fontSize,fontWeight:r.typography.bodySmall.fontWeight})})},58285:($,D,n)=>{n.r(D),n.d(D,{default:()=>mt});var t=n(74848),a=n(22803),f=n(29675),I=n(37e3),L=n(81876),m=n(49816),R=n(11817),N=n(85651);function y(s){const o=(0,f.of)(v,s);return(0,t.jsx)("div",{className:o.root,children:s.children})}const v=(s,o)=>({root:(0,a.css)({display:"flex",flexDirection:o.direction??"row",flexWrap:o.wrap??!0?"wrap":void 0,alignItems:o.alignItems,gap:s.spacing(o.gap??2),flexGrow:o.flexGrow})});var l=n(2543),i=n(55127),r=n.n(i),d=n(96540),M=n(42941),P=n(54594),C=n(27671),S=n(95015),W=n(1814),b=n(79653),Y=n(76778),J=n(7484),K=n(73370);function z(s){return s.path?.length===0}function Q(s){const o=new Map;function g(c,x=[]){o.set(c.id,{...c,path:x}),c.routes?.forEach(e=>g(e,[...x,c.id]))}return g(s,[]),o}function F(s){return s.object_matchers?.length===0}function X({route:s,matcherFormatter:o}){const g=(0,f.of)(Z);return z(s)?(0,t.jsx)("div",{className:g.defaultPolicy,children:"Default policy"}):F(s)?(0,t.jsx)("div",{className:g.textMuted,children:"No matchers"}):(0,t.jsx)(K.s,{matchers:s.object_matchers??[],formatter:o})}const Z=s=>({defaultPolicy:(0,a.css)({padding:s.spacing(.5),background:s.colors.background.secondary,width:"fit-content"}),textMuted:(0,a.css)({color:s.colors.text.secondary})});var q=n(25356),U=n(48583),_=n(79784),tt=n(747),st=n(13005),nt=n(57323);function at({route:s,routesByIdMap:o,matcherFormatter:g}){const c=(0,f.of)(G),x=s.path?.slice(1)??[],e=[...(0,l.compact)(x.map(u=>o.get(u))),s];return(0,t.jsxs)("div",{className:c.policyPathWrapper,children:[(0,t.jsx)("div",{className:c.defaultPolicy,children:"Default policy"}),e.map((u,j)=>(0,t.jsx)("div",{children:(0,t.jsx)("div",{className:c.policyInPath(j,j===e.length-1),children:F(u)?(0,t.jsx)("div",{className:c.textMuted,children:"No matchers"}):(0,t.jsx)(K.s,{matchers:u.object_matchers??[],formatter:g})})},u.id))]})}function ot({onClose:s,route:o,receiver:g,routesByIdMap:c,alertManagerSourceName:x}){const e=(0,f.of)(G),u=z(o);return(0,t.jsx)(st.b9,{accessType:"notification",alertmanagerSourceName:x,children:(0,t.jsx)(q.a,{className:e.detailsModal,isOpen:!0,title:"Routing details",onDismiss:s,onClickBackdrop:s,children:(0,t.jsxs)(U.B,{gap:0,direction:"column",children:[(0,t.jsx)("div",{className:(0,a.cx)(e.textMuted,e.marginBottom(2)),children:"Your alert instances are routed as follows."}),(0,t.jsx)("div",{children:"Notification policy path"}),u&&(0,t.jsx)("div",{className:e.textMuted,children:"Default policy"}),(0,t.jsx)("div",{className:e.separator(1)}),!u&&(0,t.jsx)(t.Fragment,{children:(0,t.jsx)(at,{route:o,routesByIdMap:c,matcherFormatter:(0,W.VE)(x)})}),(0,t.jsx)("div",{className:e.separator(4)}),(0,t.jsxs)("div",{className:e.contactPoint,children:[(0,t.jsxs)(U.B,{gap:1,direction:"row",alignItems:"center",children:["Contact point:",(0,t.jsx)("span",{className:e.textMuted,children:g.name})]}),(0,t.jsx)(nt._,{actions:[tt.QI.UpdateContactPoint],children:(0,t.jsx)(U.B,{gap:1,direction:"row",alignItems:"center",children:(0,t.jsxs)("a",{href:(0,N.bI)(g.name,x),className:e.link,target:"_blank",rel:"noreferrer",children:["See details ",(0,t.jsx)(_.I,{name:"external-link-alt"})]})})})]}),(0,t.jsx)("div",{className:e.button,children:(0,t.jsx)(P.$n,{variant:"primary",type:"button",onClick:s,children:"Close"})})]})})})}const G=s=>({textMuted:(0,a.css)({color:s.colors.text.secondary}),link:(0,a.css)({display:"block",color:s.colors.text.link}),button:(0,a.css)({justifyContent:"flex-end",display:"flex"}),detailsModal:(0,a.css)({maxWidth:"560px"}),defaultPolicy:(0,a.css)({padding:s.spacing(.5),background:s.colors.background.secondary,width:"fit-content"}),contactPoint:(0,a.css)({display:"flex",flexDirection:"row",gap:s.spacing(1),alignItems:"center",justifyContent:"space-between",marginBottom:s.spacing(1)}),policyPathWrapper:(0,a.css)({display:"flex",flexDirection:"column",marginTop:s.spacing(1)}),separator:o=>(0,a.css)({marginTop:s.spacing(o)}),marginBottom:o=>(0,a.css)({marginBottom:s.spacing(s.spacing(o))}),policyInPath:(o=0,g=!1)=>(0,a.css)({marginLeft:`${30+o*30}px`,padding:s.spacing(1),marginTop:s.spacing(1),border:`solid 1px ${g?s.colors.info.border:s.colors.border.weak}`,background:s.colors.background.secondary,width:"fit-content",position:"relative","&:before":{content:'""',position:"absolute",height:"calc(100% - 10px)",width:s.spacing(1),borderLeft:`solid 1px ${s.colors.border.weak}`,borderBottom:`solid 1px ${s.colors.border.weak}`,marginTop:s.spacing(-2),marginLeft:"-17px"}})});function et({route:s,receiver:o,routesByIdMap:g,instancesCount:c,alertManagerSourceName:x,expandRoute:e,onExpandRouteClick:u}){const j=(0,f.of)(H),[B,A]=(0,d.useState)(!1),p=()=>{A(!0)};return(0,t.jsxs)("div",{className:j.routeHeader,children:[(0,t.jsx)(b.e,{isCollapsed:!e,onToggle:w=>u(!w),"aria-label":"Expand policy route"}),(0,t.jsxs)(y,{flexGrow:1,gap:1,children:[(0,t.jsx)("div",{onClick:()=>u(!e),className:j.expandable,children:(0,t.jsxs)(y,{gap:1,direction:"row",alignItems:"center",children:["Notification policy",(0,t.jsx)(X,{route:s,matcherFormatter:(0,W.VE)(x)})]})}),(0,t.jsx)(J.h,{}),(0,t.jsxs)(y,{gap:2,direction:"row",alignItems:"center",children:[(0,t.jsxs)(Y.P,{icon:"layers-alt","data-testid":"matching-instances",children:[c??"-"," ",r()("instance",c)]}),(0,t.jsxs)(y,{gap:1,direction:"row",alignItems:"center",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:j.textMuted,children:"@ Delivered to"})," ",o.name]}),(0,t.jsx)("div",{className:j.verticalBar}),(0,t.jsx)(P.$n,{type:"button",onClick:p,variant:"secondary",fill:"outline",size:"sm",children:"See details"})]})]})]}),B&&(0,t.jsx)(ot,{onClose:()=>A(!1),route:s,receiver:o,routesByIdMap:g,alertManagerSourceName:x})]})}function rt({route:s,instanceMatches:o,receiver:g,routesByIdMap:c,alertManagerSourceName:x}){const e=(0,f.of)(H),[u,j]=(0,M.A)(!1),B=9;return(0,t.jsxs)("div",{"data-testid":"matching-policy-route",children:[(0,t.jsx)(et,{route:s,receiver:g,routesByIdMap:c,instancesCount:o.length,alertManagerSourceName:x,expandRoute:u,onExpandRouteClick:j}),u&&(0,t.jsx)(y,{gap:1,direction:"column",children:(0,t.jsx)("div",{className:e.routeInstances,"data-testid":"route-matching-instance",children:o.map(A=>{const p=Array.from(A.labelsMatch),w=p.map(([h,T])=>({label:`${h[0]}=${h[1]}`,match:T.match,colorIndex:T.match?(0,C.JF)(h[0]):B})),E=w.filter(h=>h.match),O=w.filter(h=>!h.match);return(0,t.jsx)("div",{className:e.tagListCard,children:p.length>0?(0,t.jsxs)(t.Fragment,{children:[E.length>0?(0,t.jsx)(S.L,{tags:E.map(h=>h.label),className:e.labelList,getColorIndex:(h,T)=>E[T].colorIndex}):(0,t.jsx)("div",{className:(0,a.cx)(e.textMuted,e.textItalic),children:"No matching labels"}),(0,t.jsx)("div",{className:e.labelSeparator}),(0,t.jsx)(S.L,{tags:O.map(h=>h.label),className:e.labelList,getColorIndex:(h,T)=>O[T].colorIndex})]}):(0,t.jsx)("div",{className:e.textMuted,children:"No labels"})},(0,l.uniqueId)())})})})]})}const H=s=>({textMuted:(0,a.css)({color:s.colors.text.secondary}),textItalic:(0,a.css)({fontStyle:"italic"}),expandable:(0,a.css)({cursor:"pointer"}),routeHeader:(0,a.css)({display:"flex",flexDirection:"row",gap:s.spacing(1),alignItems:"center",borderBottom:`1px solid ${s.colors.border.weak}`,padding:s.spacing(.5,.5,.5,0),"&:hover":{backgroundColor:s.components.table.rowHoverBackground}}),labelList:(0,a.css)({flex:"0 1 auto",justifyContent:"flex-start"}),labelSeparator:(0,a.css)({width:"1px",backgroundColor:s.colors.border.weak}),tagListCard:(0,a.css)({display:"flex",flexDirection:"row",gap:s.spacing(2),position:"relative",background:s.colors.background.secondary,padding:s.spacing(1),borderRadius:s.shape.borderRadius(2),border:`solid 1px ${s.colors.border.weak}`}),routeInstances:(0,a.css)({padding:s.spacing(1,0,1,4),position:"relative",display:"flex",flexDirection:"column",gap:s.spacing(1),"&:before":{content:'""',position:"absolute",left:s.spacing(2),height:`calc(100% - ${s.spacing(2)})`,width:s.spacing(4),borderLeft:`solid 1px ${s.colors.border.weak}`}}),verticalBar:(0,a.css)({width:"1px",height:"20px",backgroundColor:s.colors.secondary.main,marginLeft:s.spacing(1),marginRight:s.spacing(1)})});var it=n(16817),ct=n(35626),lt=n(27889),dt=n(86369),gt=n(12444),ut=n(88214),V=n(86655);const ft=(s,o)=>{const{data:g,isLoading:c,error:x}=(0,lt.yV)({alertmanager:s}),{contactPoints:e,isLoading:u,error:j}=(0,ct.dK)({alertmanager:s,fetchPolicies:!1,fetchStatuses:!1}),{matchInstancesToRoute:B}=(0,dt.L)(),[A]=g??[],p=(0,d.useMemo)(()=>{if(A)return(0,V.rJ)((0,gt.QM)(A))},[A]),w=p?Q((0,V._I)(p)):new Map,E=(0,d.useMemo)(()=>e?e.reduce((ht,k)=>ht.set(k.name,k),new Map):new Map,[e]),{value:O=new Map,loading:h,error:T}=(0,it.A)(async()=>{if(p)return await B(p,o,{unquoteMatchers:s!==ut.hY})},[p,o]);return{routesByIdMap:w,receiversByName:E,matchingMap:O,loading:c||u||h,error:x??j??T}};function xt({alertManagerSource:s,potentialInstances:o,onlyOneAM:g}){const c=(0,f.of)(pt),{routesByIdMap:x,receiversByName:e,matchingMap:u,loading:j,error:B}=ft(s.name,o);if(B){const p=(0,R.t)("alerting.notification-preview.error","Could not load routing preview for {{alertmanager}}",{alertmanager:s.name});return(0,t.jsx)(I.F,{title:p,severity:"error",children:(0,N.JZ)(B)})}return j?(0,t.jsx)(L._,{text:"Loading routing preview..."}):u.size>0?(0,t.jsxs)("div",{className:c.alertManagerRow,children:[!g&&(0,t.jsxs)(y,{direction:"row",alignItems:"center",children:[(0,t.jsx)("div",{className:c.firstAlertManagerLine}),(0,t.jsxs)("div",{className:c.alertManagerName,children:[(0,t.jsx)(R.x6,{i18nKey:"alerting.notification-preview.alertmanager",children:"Alertmanager:"}),(0,t.jsx)("img",{src:s.imgUrl,alt:"",className:c.img}),s.name]}),(0,t.jsx)("div",{className:c.secondAlertManagerLine})]}),(0,t.jsx)(y,{gap:1,direction:"column",children:Array.from(u.entries()).map(([p,w])=>{const E=x.get(p),O=E?.receiver&&e.get(E.receiver);if(!E)return null;if(!O)throw new Error("Receiver not found");return(0,t.jsx)(rt,{instanceMatches:w,route:E,receiver:O,routesByIdMap:x,alertManagerSourceName:s.name},p)})})]}):null}const mt=(0,m.Xc)(xt),pt=s=>({alertManagerRow:(0,a.css)({display:"flex",flexDirection:"column",gap:s.spacing(1),width:"100%"}),firstAlertManagerLine:(0,a.css)({height:"1px",width:s.spacing(4),backgroundColor:s.colors.secondary.main}),alertManagerName:(0,a.css)({width:"fit-content"}),secondAlertManagerLine:(0,a.css)({height:"1px",width:"100%",flex:1,backgroundColor:s.colors.secondary.main}),img:(0,a.css)({marginLeft:s.spacing(2),width:s.spacing(3),height:s.spacing(3),marginRight:s.spacing(1)})})},86369:($,D,n)=>{n.d(D,{L:()=>y});var t=n(14590),a=n(96540),f=n(83893),I=n(89956);const L=()=>new I.c(new URL(n.p+n.u(3430),n.b));let m;function R(){let v;if(m===void 0)try{v=L(),m=t.LV(v)}catch(i){i instanceof Error&&(0,f.vV)(i)}return{disposeWorker:()=>{v&&m&&(m[t.A2](),v.terminate(),m=void 0,v=void 0)}}}function N(v){if(!m)throw new Error("Route Matcher has not been initialized")}function y(){(0,a.useEffect)(()=>{const{disposeWorker:i}=R();return i},[]);const v=(0,a.useCallback)(async(i,r,d)=>{N(m);const M=performance.now(),P=await m.getRouteGroupsMap(i,r,d),C=performance.now()-M;return(0,f.fH)(`Route Groups Matched in  ${C} ms`,{matchingTime:C.toString(),alertGroupsCount:r.length.toString(),topLevelRoutesCount:i.routes?.length.toString()??"0"}),P},[]),l=(0,a.useCallback)(async(i,r,d)=>{N(m);const M=performance.now(),P=await m.matchInstancesToRoute(i,r,d),C=performance.now()-M;return(0,f.fH)(`Instances Matched in  ${C} ms`,{matchingTime:C.toString(),instancesToMatchCount:r.length.toString(),topLevelRoutesCount:i.routes?.length.toString()??"0"}),P},[]);return{getRouteGroupsMap:v,matchInstancesToRoute:l}}}}]);

//# sourceMappingURL=8285.dbc33d9b013f8bb4fe4d.js.map