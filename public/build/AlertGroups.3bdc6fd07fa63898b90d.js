"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[8427],{25605:(Q,P,s)=>{s.r(P),s.d(P,{default:()=>at});var t=s(74848),a=s(96540),T=s(81876),d=s(37e3),G=s(90231),b=s(45565),O=s(65539),D=s(61491),N=s(80187),M=s(9365),u=s(32174),y=s(21294),f=s(22803),A=s(29675),R=s(54594),S=s(85651),F=s(40271),z=s(6736),U=s(79784),J=s(60641);const H=({onStateFilterChange:l,stateFilter:x})=>{const C=Object.entries(N.Or).sort(([o],[n])=>o<n?-1:1).map(([o,n])=>({label:o,value:n}));return(0,t.jsxs)("div",{children:[(0,t.jsxs)(F.J,{children:[(0,t.jsx)("span",{children:"Notification state\xA0"}),(0,t.jsx)(z.m,{content:(0,t.jsx)("div",{children:(0,t.jsxs)("ul",{children:[(0,t.jsx)("li",{children:"Active: The alert notification has been handled. The alert is still firing and continues to be managed."}),(0,t.jsx)("li",{children:"Suppressed: The alert has been silenced."}),(0,t.jsx)("li",{children:"Unprocessed: The alert is received but its notification has not been processed yet."})]})}),children:(0,t.jsx)(U.I,{name:"info-circle",size:"sm"})})]}),(0,t.jsx)(J.z,{options:C,value:x,onChange:l})]})};var K=s(2543),Y=s(44826),V=s(70584);const X=({groups:l,groupBy:x,onGroupingChange:C})=>{const o=(0,K.uniq)(l.flatMap(n=>n.alerts).flatMap(({labels:n})=>Object.keys(n))).filter(n=>!(0,V.F2)(n)).map(n=>({label:n,value:n}));return(0,t.jsxs)("div",{"data-testid":"group-by-container",children:[(0,t.jsxs)(F.J,{children:[(0,t.jsx)("span",{children:"Custom group by\xA0"}),(0,t.jsx)(z.m,{content:(0,t.jsx)("div",{children:"Group notifications using a different combination of labels. This option can help validate the grouping settings of your notification policies."}),children:(0,t.jsx)(U.I,{name:"info-circle",size:"sm"})})]}),(0,t.jsx)(Y.KF,{"aria-label":"group by label keys",value:x,placeholder:"Group by",prefix:(0,t.jsx)(U.I,{name:"tag-alt"}),onChange:n=>{C(n.map(({value:j})=>j))},options:o,width:34})]})};var Z=s(39498);const w=({groups:l})=>{const[x,C]=(0,a.useState)(Math.floor(Math.random()*100)),[o,n]=(0,O.s)(),{groupBy:j=[],queryString:i,alertState:c}=(0,S.Ht)(o),p=`matcher-${x}`,E=(0,A.of)(k),I=()=>{n({groupBy:null,queryString:null,alertState:null,contactPoint:null}),setTimeout(()=>C(x+1),100)},W=!!(j.length>0||i||c);return(0,t.jsx)("div",{className:E.wrapper,children:(0,t.jsxs)("div",{className:E.filterSection,children:[(0,t.jsx)(Z.X,{defaultQueryString:i,onFilterChange:v=>n({queryString:v||null})},p),(0,t.jsx)(X,{groups:l,groupBy:j,onGroupingChange:v=>n({groupBy:v.length?v.join(","):null})}),(0,t.jsx)(H,{stateFilter:c,onStateFilterChange:v=>n({alertState:v||null})}),W&&(0,t.jsx)(R.$n,{className:E.clearButton,variant:"secondary",icon:"times",onClick:I,children:"Clear filters"})]})})},k=l=>({wrapper:(0,f.css)({borderBottom:`1px solid ${l.colors.border.medium}`,marginBottom:l.spacing(3)}),filterSection:(0,f.css)({display:"flex",flexDirection:"row",marginBottom:l.spacing(3),gap:l.spacing(1)}),clearButton:(0,f.css)({marginLeft:l.spacing(1),marginTop:"19px"})});var q=s(1814),_=s(55936);const tt=l=>{const[x]=(0,O.s)(),{queryString:C,alertState:o}=(0,S.Ht)(x);return(0,a.useMemo)(()=>{const n=C?(0,_.Zc)(C):[];return l.reduce((j,i)=>{const c=i.alerts.filter(({labels:p,status:E})=>{const I=(0,q.Av)(p,n),W=o?E.state===o:!0;return I&&W});return c.length>0&&(Object.keys(i.labels).length===0?j.unshift({...i,alerts:c}):j.push({...i,alerts:c})),j},[])},[C,l,o])},e=(l,x)=>(0,a.useMemo)(()=>x.length===0?l.filter(n=>Object.keys(n.labels).length===0).length>1?l.reduce((n,j)=>{if(Object.keys(j.labels).length===0){const i=n.find(({labels:c})=>Object.keys(c));i?i.alerts=(0,K.uniqBy)([...i.alerts,...j.alerts],"labels"):n.push({alerts:j.alerts,labels:{},receiver:{name:"NONE"}})}else n.push(j);return n},[]):l:(0,K.uniqBy)(l.flatMap(({alerts:o})=>o),o=>o.fingerprint).reduce((o,n)=>{if(x.every(i=>Object.keys(n.labels).includes(i)))n.receivers.map(c=>({alerts:[n],labels:x.reduce((p,E)=>(p={...p,[E]:n.labels[E]},p),{}),receiver:c})).forEach(c=>{const p=o.find(E=>Object.keys(c.labels).every(I=>E.labels[I]===c.labels[I])&&E.receiver.name===c.receiver.name);p?p.alerts.push(n):o.push(c)});else{const i=o.find(c=>Object.keys(c.labels).length===0);i?i.alerts.push(n):o.push({alerts:[n],labels:{},receiver:{name:"NONE"}})}return o},[]),[l,x]);var g=s(9912),m=s(13005),B=s(48542),h=s(83466),r=s(88214),L=s(4013),st=s(37104);const et=()=>{const{selectedAlertmanager:l}=(0,m.VI)(),x=(0,D.useDispatch)(),[C]=(0,O.s)(),{groupBy:o=[]}=(0,S.Ht)(C),{currentData:n}=M.m.endpoints.getGrafanaAlertingConfigurationStatus.useQuery(),j=(0,g.$)(v=>v.amAlertGroups),{loading:i,error:c,result:p=[]}=j[l||""]??L.jA,E=e(p,o),I=tt(E),W=l===r.hY&&n?.alertmanagersChoice===N.nA.External;return(0,a.useEffect)(()=>{function v(){l&&x((0,B.D3)(l))}v();const $=setInterval(v,h.U3);return()=>{clearInterval($)}},[x,l]),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(w,{groups:p}),i&&(0,t.jsx)(T._,{text:"Loading notifications"}),c&&!i&&(0,t.jsx)(d.F,{title:"Error loading notifications",severity:"error",children:c.message||"Unknown error"}),W&&(0,t.jsx)(d.F,{title:"Grafana alerts are not delivered to Grafana Alertmanager",children:"Grafana is configured to send alerts to external alertmanagers only. No alerts are expected to be available here for the selected Alertmanager."}),p&&I.map((v,$)=>(0,t.jsxs)(a.Fragment,{children:[($===1&&Object.keys(I[0].labels).length===0||$===0&&Object.keys(v.labels).length>0)&&(0,t.jsx)(G.a,{paddingY:2,children:(0,t.jsxs)(b.E,{element:"h2",variant:"body",children:["Grouped by: ",Object.keys(v.labels).join(", ")]})}),(0,t.jsx)(y._,{alertManagerSourceName:l||"",group:v})]},`${JSON.stringify(v.labels)}-group-${$}`)),p&&!I.length&&(0,t.jsx)("p",{children:"No results."})]})};function nt(){return(0,t.jsx)(u.y,{navId:"groups",accessType:"instance",children:(0,t.jsx)(et,{})})}const at=(0,st.S)(nt)},57323:(Q,P,s)=>{s.d(P,{_:()=>G});var t=s(74848),a=s(2543),T=s.n(a),d=s(747);const G=({actions:u,children:y})=>{const f=(0,a.filter)(u,N),A=(0,a.filter)(u,M);return f.length?(0,t.jsx)(b,{actions:f,children:y}):A.length?(0,t.jsx)(O,{actions:A,children:y}):null},b=({actions:u,children:y})=>{const f=(0,d.iI)();return D(f,u)?(0,t.jsx)(t.Fragment,{children:y}):null},O=({actions:u,children:y})=>{const f=(0,d.e2)();return D(f,u)?(0,t.jsx)(t.Fragment,{children:y}):null};function D(u,y){return(0,a.chain)(u).pick(y).values().value().some(([f,A])=>A===!0)}function N(u){return Object.values(d.QI).includes(u)}function M(u){return Object.values(d.RY).includes(u)}},79653:(Q,P,s)=>{s.d(P,{e:()=>T});var t=s(74848),a=s(54594);const T=({isCollapsed:d,onToggle:G,idControlled:b,className:O,text:D,size:N="xl",...M})=>(0,t.jsx)(a.$n,{type:"button",fill:"text",variant:"secondary","aria-expanded":!d,"aria-controls":b,className:O,icon:d?"angle-right":"angle-down",onClick:()=>G(!d),...M,children:D})},76778:(Q,P,s)=>{s.d(P,{P:()=>O});var t=s(74848),a=s(22803),T=s(29675),d=s(45565),G=s(48583),b=s(79784);const O=({children:N,icon:M,color:u="secondary",direction:y="row",...f})=>{const A=(0,T.of)(D),R=typeof f.onClick=="function",S=y==="row",F=S?"center":"flex-start",z=S?.5:0;return(0,t.jsx)("div",{className:(0,a.cx)({[A.interactive]:R}),...f,children:(0,t.jsx)(d.E,{variant:"bodySmall",color:u,children:(0,t.jsxs)(G.B,{direction:y,alignItems:F,gap:z,wrap:"wrap",children:[M&&(0,t.jsx)(b.I,{size:"xs",name:M}),N]})})})},D=()=>({interactive:(0,a.css)({cursor:"pointer"})})},21294:(Q,P,s)=>{s.d(P,{_:()=>_});var t=s(74848),a=s(22803),T=s(96540),d=s(29675),G=s(48583),b=s(54731),O=s(85651),D=s(3429),N=s(79653),M=s(76778),u=s(66102),y=s(9172),f=s(35912),A=s(54594),R=s(61351),S=s(80187),F=s(61491),z=s(747),U=s(88214),J=s(9985),H=s(57323);const K=({alert:e,alertManagerSourceName:g})=>{const m=(0,d.of)(Y),B=(0,U.z2)(g),h=B?R.TP.hasPermission(F.AccessControlAction.AlertingRuleRead):!0;return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:m.actionsRow,children:[e.status.state===S.Or.Suppressed&&(0,t.jsx)(H._,{actions:[z.QI.CreateSilence,z.QI.UpdateSilence],children:(0,t.jsx)(A.z9,{href:`${(0,O.nL)("/alerting/silences",g)}&silenceIds=${e.status.silencedBy.join(",")}`,className:m.button,icon:"bell",size:"sm",children:"Manage silences"})}),e.status.state===S.Or.Active&&(0,t.jsx)(H._,{actions:[z.QI.CreateSilence],children:(0,t.jsx)(A.z9,{href:(0,O.BK)(g,e.labels),className:m.button,icon:"bell-slash",size:"sm",children:"Silence"})}),h&&e.generatorURL&&(0,t.jsx)(A.z9,{className:m.button,href:e.generatorURL,icon:"chart-line",size:"sm",children:B?"See alert rule":"See source"})]}),Object.entries(e.annotations).map(([r,L])=>(0,t.jsx)(J.s,{annotationKey:r,value:L},r)),(0,t.jsxs)("div",{className:m.receivers,children:["Receivers:"," ",e.receivers.map(({name:r})=>r).filter(r=>!!r).join(", ")]})]})},Y=e=>({button:(0,a.css)({"& + &":{marginLeft:e.spacing(1)}}),actionsRow:(0,a.css)({padding:`${e.spacing(2,0)} !important`,borderBottom:`1px solid ${e.colors.border.medium}`}),receivers:(0,a.css)({padding:e.spacing(1,0)})}),V=({alerts:e,alertManagerSourceName:g})=>{const m=(0,d.of)(X),B=(0,T.useMemo)(()=>[{id:"state",label:"Notification state",renderCell:({data:r})=>(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(f.y,{state:r.status.state}),(0,t.jsxs)("span",{className:m.duration,children:["for"," ",(0,u.dU)({start:new Date(r.startsAt),end:new Date(r.endsAt)})]})]}),size:"220px"},{id:"labels",label:"Instance labels",renderCell:({data:{labels:r}})=>(0,t.jsx)(D.m,{labels:r,size:"sm"}),size:1}],[m]),h=(0,T.useMemo)(()=>e.map(r=>({id:r.fingerprint,data:r})),[e]);return(0,t.jsx)("div",{className:m.tableWrapper,"data-testid":"alert-group-table",children:(0,t.jsx)(y.B,{cols:B,items:h,isExpandable:!0,renderExpandedContent:({data:r})=>(0,t.jsx)(K,{alert:r,alertManagerSourceName:g})})})},X=e=>({tableWrapper:(0,a.css)({marginTop:e.spacing(3),[e.breakpoints.up("md")]:{marginLeft:e.spacing(4.5)}}),duration:(0,a.css)({marginLeft:e.spacing(1),fontSize:e.typography.bodySmall.fontSize})});var Z=s(55127),w=s.n(Z);const k=e=>({[S.Or.Active]:(0,a.css)({color:e.colors.error.text}),[S.Or.Suppressed]:(0,a.css)({color:e.colors.primary.text}),[S.Or.Unprocessed]:(0,a.css)({color:e.colors.secondary.text})}),q=({group:e})=>{const g=(0,d.of)(k),m=e.alerts.length,B=e.alerts.reduce((h,r)=>(h[r.status.state]?h[r.status.state]+=1:h[r.status.state]=1,h),{});return(0,t.jsxs)("div",{children:[`${m} ${w()("alert",m)}: `,Object.entries(B).map(([h,r],L)=>(0,t.jsxs)("span",{className:g[h],children:[L>0&&", ",`${r} ${h}`]},`${JSON.stringify(e.labels)}-notifications-${L}`))]})},_=({alertManagerSourceName:e,group:g})=>{const[m,B]=(0,T.useState)(!0),h=(0,d.of)(tt),r=g.receiver.name!=="NONE",L=g.receiver.name;return(0,t.jsxs)("div",{className:h.wrapper,children:[(0,t.jsxs)("div",{className:h.header,children:[(0,t.jsxs)("div",{className:h.group,"data-testid":"alert-group",children:[(0,t.jsx)(N.e,{size:"sm",isCollapsed:m,onToggle:()=>B(!m),"data-testid":"alert-group-collapse-toggle"}),Object.keys(g.labels).length?(0,t.jsxs)(G.B,{direction:"row",alignItems:"center",children:[(0,t.jsx)(D.m,{labels:g.labels,size:"sm"}),r&&(0,t.jsxs)(M.P,{icon:"at",children:["Delivered to"," ",(0,t.jsx)(b.Y,{href:(0,O.bI)(L,e),variant:"bodySmall",color:"primary",inline:!1,children:g.receiver.name})]})]}):(0,t.jsx)("span",{children:"No grouping"})]}),(0,t.jsx)(q,{group:g})]}),!m&&(0,t.jsx)(V,{alertManagerSourceName:e,alerts:g.alerts})]})},tt=e=>({wrapper:(0,a.css)({"& + &":{marginTop:e.spacing(2)}}),header:(0,a.css)({display:"flex",flexDirection:"row",flexWrap:"wrap",alignItems:"center",justifyContent:"space-between",padding:e.spacing(1),backgroundColor:e.colors.background.secondary,width:"100%"}),group:(0,a.css)({display:"flex",flexDirection:"row",alignItems:"center"})})}}]);

//# sourceMappingURL=AlertGroups.3bdc6fd07fa63898b90d.js.map