"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[7099],{69921:(ft,J,o)=>{o.d(J,{i:()=>b});var e=o(74848),r=o(22803),m=o(29675);const b=({children:U,className:Q})=>{const v=(0,m.of)(F);return(0,e.jsx)("div",{className:(0,r.cx)(v.wrapper,Q),children:U})},F=U=>({wrapper:(0,r.css)({display:"flex",flexDirection:"column",fontSize:U.typography.bodySmall.fontSize})})},47761:(ft,J,o)=>{o.d(J,{l:()=>F});var e=o(74848),r=o(22803),m=o(96540),b=o(49785);function F({defaultValues:U,onSubmit:Q,validateOnMount:v=!1,validateFieldsOnMount:Y,children:O,validateOn:tt="onSubmit",maxWidth:T=600,...C}){const{handleSubmit:Z,trigger:$,formState:n,...f}=(0,b.mN)({mode:tt,defaultValues:U});return(0,m.useEffect)(()=>{v&&$(Y)},[$,Y,v]),(0,e.jsx)("form",{className:(0,r.css)({maxWidth:T!=="none"?T+"px":T,width:"100%"}),onSubmit:Z(Q),...C,children:O({errors:n.errors,formState:n,trigger:$,...f})})}},4188:(ft,J,o)=>{o.d(J,{W:()=>Dt});var e=o(74848),r=o(22803),m=o(96540),b=o(40961),F=o(84140),U=o(36613),Q=o(75906),v=o(7500),Y=o(87190),O=o(41090),tt=o(75606),T=o(29675),C=o(46885),Z=o(83505),$=o(58779),n=o(49785),f=o(29647),g=o(41053),S=o(88090),d=o(90168),E=o(90415),c=o(48583),D=o(86489),B=o(50926),u=o(54594),ut=o(47761),at=o(96601),mt=o(65596);const gt=({annoVals:t,annoIdx:s,dismiss:h,timeZone:P,...R})=>{const p=(0,T.of)(lt),{onAnnotationCreate:j,onAnnotationUpdate:et}=(0,E.d2)(),L=(0,m.useRef)(null);(0,f.A)(L,h);const[z,K]=(0,g.A)(async a=>{const x=await j(a);return h(),x}),[ot,V]=(0,g.A)(async a=>{const x=await et(a);return h(),x}),I=a=>(0,S.LE)(a,{format:d.WC.fullDate,timeZone:P}),H=t.id?.[s]!=null,st=t.isRegion?.[s],it=H?V:K,q=H?ot:z,l=st?`${I(t.time[s])} - ${I(t.timeEnd[s])}`:I(t.time[s]),A=({tags:a,description:x})=>{it({id:t.id?.[s]??void 0,tags:a,description:x,from:Math.round(t.time[s]),to:Math.round(t.timeEnd?.[s]??t.time[s])})};return(0,e.jsxs)("div",{ref:L,className:p.editor,...R,children:[(0,e.jsx)("div",{className:p.header,children:(0,e.jsxs)(c.B,{justifyContent:"space-between",alignItems:"center",children:[(0,e.jsx)("div",{children:H?"Edit annotation":"Add annotation"}),(0,e.jsx)("div",{children:l})]})}),(0,e.jsx)(ut.l,{onSubmit:A,defaultValues:{description:t.text?.[s],tags:t.tags?.[s]||[]},children:({register:a,errors:x,control:y})=>(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("div",{className:p.content,children:[(0,e.jsx)(D.D,{label:"Description",invalid:!!x.description,error:x?.description?.message,children:(0,e.jsx)(B.f,{className:p.textarea,...a("description",{required:"Annotation description is required"})})}),(0,e.jsx)(D.D,{label:"Tags",children:(0,e.jsx)(n.xI,{control:y,name:"tags",render:({field:{ref:M,onChange:X,...i}})=>(0,e.jsx)(at.$,{allowCustomValue:!0,placeholder:"Add tags",onChange:X,tagOptions:mt.vy,tags:i.value})})})]}),(0,e.jsx)("div",{className:p.footer,children:(0,e.jsxs)(c.B,{justifyContent:"flex-end",children:[(0,e.jsx)(u.$n,{size:"sm",variant:"secondary",onClick:h,fill:"outline",children:"Cancel"}),(0,e.jsx)(u.$n,{size:"sm",type:"submit",disabled:q?.loading,children:q?.loading?"Saving":"Save"})]})})]})})]})},lt=t=>({editor:(0,r.css)({background:t.colors.background.elevated,border:`1px solid ${t.colors.border.weak}`,borderRadius:t.shape.radius.default,boxShadow:t.shadows.z3,userSelect:"text",width:"460px"}),content:(0,r.css)({padding:t.spacing(1)}),header:(0,r.css)({borderBottom:`1px solid ${t.colors.border.weak}`,padding:t.spacing(.5,1),fontWeight:t.typography.fontWeightBold,fontSize:t.typography.fontSize,color:t.colors.text.primary}),footer:(0,r.css)({borderTop:`1px solid ${t.colors.border.weak}`,padding:t.spacing(1,1)}),textarea:(0,r.css)({color:t.colors.text.secondary,fontSize:t.typography.bodySmall.fontSize})});var W=o(84099),nt=o(19550),rt=o(99764),w=o(73903),xt=o(71481);const yt=()=>!1,At=({annoVals:t,annoIdx:s,timeZone:h,onEdit:P})=>{const R=t.id?.[s],p=(0,T.of)(Mt),{canEditAnnotations:j=yt,canDeleteAnnotations:et=yt,onAnnotationDelete:L}=(0,E.d2)(),z=t.dashboardUID?.[s],K=R!==0&&j(z),ot=R!==0&&et(z)&&L!=null,V=l=>(0,S.LE)(l,{format:d.WC.fullDate,timeZone:h});let I=V(t.time[s]),H=t.text?.[s]??"";t.isRegion?.[s]&&(I+=" - "+V(t.timeEnd[s]));let st;t.login?.[s]&&t.avatarUrl?.[s]&&(st=(0,e.jsx)("img",{className:p.avatar,alt:"Annotation avatar",src:t.avatarUrl[s]}));let it=null,q="";if(t.alertId?.[s]!==void 0&&t.newState?.[s]){const l=xt.A.getStateDisplayModel(t.newState[s]);it=(0,e.jsx)("div",{className:p.alertState,children:(0,e.jsx)("i",{className:l.stateClass,children:l.text})}),q=t.data?.[s]?xt.A.getAlertAnnotationText(t.data[s]):""}else t.title?.[s]&&(H=t.title[s]+(H?`<br />${H}`:""));return(0,e.jsxs)("div",{className:p.wrapper,children:[(0,e.jsx)("div",{className:p.header,children:(0,e.jsxs)(nt.Gy,{justify:"space-between",align:"center",spacing:"md",children:[(0,e.jsxs)("div",{className:p.meta,children:[(0,e.jsxs)("span",{children:[st,it]}),I]}),(K||ot)&&(0,e.jsxs)("div",{className:p.editControls,children:[K&&(0,e.jsx)(rt.K,{name:"pen",size:"sm",onClick:P,tooltip:"Edit"}),ot&&(0,e.jsx)(rt.K,{name:"trash-alt",size:"sm",onClick:()=>L(R),tooltip:"Delete"})]})]})}),(0,e.jsxs)("div",{className:p.body,children:[H&&(0,e.jsx)("div",{className:p.text,dangerouslySetInnerHTML:{__html:W.sQ.sanitize(H)}}),q,(0,e.jsx)("div",{children:(0,e.jsx)(nt.Gy,{spacing:"xs",wrap:!0,children:t.tags?.[s]?.map((l,A)=>(0,e.jsx)(w.v,{name:l},`${l}-${A}`))})})]})]})},Mt=t=>({wrapper:(0,r.css)({zIndex:t.zIndex.tooltip,whiteSpace:"initial",borderRadius:t.shape.radius.default,background:t.colors.background.elevated,border:`1px solid ${t.colors.border.weak}`,boxShadow:t.shadows.z3,userSelect:"text"}),header:(0,r.css)({padding:t.spacing(.5,1),borderBottom:`1px solid ${t.colors.border.weak}`,fontWeight:t.typography.fontWeightBold,fontSize:t.typography.fontSize,color:t.colors.text.primary,display:"flex"}),meta:(0,r.css)({display:"flex",justifyContent:"space-between",color:t.colors.text.primary,fontWeight:400}),editControls:(0,r.css)({display:"flex",alignItems:"center","> :last-child":{marginLeft:0}}),body:(0,r.css)({padding:t.spacing(1),fontSize:t.typography.bodySmall.fontSize,color:t.colors.text.secondary,fontWeight:400,a:{color:t.colors.text.link,"&:hover":{textDecoration:"underline"}}}),text:(0,r.css)({paddingBottom:t.spacing(1)}),avatar:(0,r.css)({borderRadius:t.shape.radius.circle,width:16,height:16,marginRight:t.spacing(1)}),alertState:(0,r.css)({paddingRight:t.spacing(1),fontWeight:t.typography.fontWeightMedium})}),pt=0,dt=1,vt=2,Tt=({annoVals:t,annoIdx:s,className:h,style:P,exitWipEdit:R,timeZone:p,portalRoot:j})=>{const et=(0,T.of)(St),[L,z]=(0,m.useState)(R!=null?dt:pt),{refs:K,floatingStyles:ot}=(0,Z.we)({open:!0,placement:"bottom",middleware:[(0,C.UU)({fallbackAxisSideDirection:"end",crossAxis:!1,boundary:document.body}),(0,C.BN)()],whileElementsMounted:C.ll,strategy:"fixed"}),V=L===vt?(0,e.jsx)(At,{annoIdx:s,annoVals:t,timeZone:p,onEdit:()=>z(dt)}):L===dt?(0,e.jsx)(gt,{annoIdx:s,annoVals:t,timeZone:p,dismiss:()=>{R?.(),z(pt)}}):null;return(0,e.jsx)("div",{ref:K.setReference,className:h,style:P,onMouseEnter:()=>L!==dt&&z(vt),onMouseLeave:()=>L!==dt&&z(pt),"data-testid":$.Tp.pages.Dashboard.Annotations.marker,children:V&&(0,b.createPortal)((0,e.jsx)("div",{ref:K.setFloating,className:et.annoBox,style:ot,"data-testid":"annotation-marker",children:V}),j)})},St=t=>({annoBox:(0,r.css)({top:0,left:0,zIndex:t.zIndex.tooltip,borderRadius:t.shape.radius.default,position:"absolute",background:t.colors.background.primary,border:`1px solid ${t.colors.border.weak}`,boxShadow:t.shadows.z2,userSelect:"text",minWidth:"300px"})}),Et=(t,s,h,P,R)=>{t.beginPath(),t.moveTo(P,s),t.lineTo(P,h),t.strokeStyle=R,t.stroke()},ht=(0,F.A)(O.Mk).toHex8String();function Pt(t){let s={};return t.fields.forEach(h=>{s[h.name]=h.values}),s}const Dt=({annotations:t,timeZone:s,config:h,newRange:P,setNewRange:R,canvasRegionRendering:p=!0})=>{const[j,et]=(0,m.useState)(),[L]=(0,m.useState)(()=>(0,tt.gF)()),z=(0,T.of)(jt),K=(0,T.$j)().visualization.getColorByName,[ot,V]=(0,m.useReducer)(l=>l+1,0),I=(0,m.useMemo)(()=>{let l=t.filter(A=>A.name!=="exemplar"&&A.length>0&&A.fields.some(a=>a.name==="time"));if(P){let A=P.to>P.from;const a=(0,Q.I)([{time:P.from,timeEnd:A?P.to:null,isRegion:A,color:ht}]);a.meta={dataTopic:v.QR.Annotations,custom:{isWip:!0}},l.push(a)}return l},[t,P]),H=(0,m.useCallback)(()=>{R(null)},[R]),st=(0,m.useRef)(I);st.current=I;const it=(0,m.useRef)(P);it.current=P;const q=(0,m.useRef)();if((0,m.useLayoutEffect)(()=>{h.addHook("ready",l=>{let A=l.root.querySelector(".u-axis");q.current=A,et(l)}),h.addHook("draw",l=>{let A=st.current;const a=l.ctx;a.save(),a.beginPath(),a.rect(l.bbox.left,l.bbox.top,l.bbox.width,l.bbox.height),a.clip(),A.forEach(x=>{let y=Pt(x);if(x.name==="xymark"){let M=h.scales[0].props.scaleKey,X=h.scales[1].props.scaleKey;for(let i=0;i<x.length;i++){let G=K(y.color[i]||ht),N=l.valToPos(y.xMin[i],M,!0),k=l.valToPos(y.xMax[i],M,!0),_=l.valToPos(y.yMax[i],X,!0),ct=l.valToPos(y.yMin[i],X,!0);a.fillStyle=Y.MV.alpha(G,y.fillOpacity[i]),a.fillRect(N,_,k-N,ct-_),a.lineWidth=Math.round(y.lineWidth[i]*U.A.pxRatio),y.lineStyle[i]==="dash"?a.setLineDash([5,5]):a.setLineDash([]),a.strokeStyle=G,a.strokeRect(N,_,k-N,ct-_)}}else{let M=l.bbox.top,X=M+l.bbox.height;a.lineWidth=2,a.setLineDash([5,5]);for(let i=0;i<y.time.length;i++){let G=K(y.color[i]||ht),N=l.valToPos(y.time[i],"x",!0);if(Et(a,M,X,N,G),y.isRegion[i]){let k=l.valToPos(y.timeEnd[i],"x",!0);Et(a,M,X,k,G),p&&(a.fillStyle=Y.MV.alpha(G,.1),a.fillRect(N,M,k-N,l.bbox.height))}}}}),a.restore()})},[h,p,K]),(0,m.useEffect)(()=>{j&&(j.redraw(),setTimeout(()=>{V()},0))},[I,j]),j){let l=I.flatMap((A,a)=>{let x=Pt(A),y=[];for(let M=0;M<x.time.length;M++){let X=K(x.color[M]||O.Mk),i=Math.round(j.valToPos(x.time[M],"x"))||0,G=null,N="",k=!0;if(x.isRegion[M]){let _=Math.round(j.valToPos(x.timeEnd[M],"x"))||0;if(k=i<j.rect.width&&_>0,k){let ct=Math.max(0,i),Ct=Math.min(j.rect.width,_);G={left:ct,background:X,width:Ct-ct},N=z.annoRegion}}else k=i>=0&&i<=j.rect.width,k&&(G={left:i,borderBottomColor:X},N=z.annoMarker);if(k){let _=A.meta?.custom?.isWip;y.push((0,e.jsx)(Tt,{annoIdx:M,annoVals:x,className:N,style:G,timeZone:s,exitWipEdit:_?H:null,portalRoot:L},`${a}:${M}`))}}return y});return(0,b.createPortal)(l,q.current)}return null},jt=()=>({annoMarker:(0,r.css)({position:"absolute",width:0,height:0,borderLeft:"5px solid transparent",borderRight:"5px solid transparent",borderBottomWidth:"5px",borderBottomStyle:"solid",transform:"translateX(-50%)",cursor:"pointer",zIndex:1}),annoRegion:(0,r.css)({position:"absolute",height:"5px",cursor:"pointer",zIndex:1})})},37604:(ft,J,o)=>{o.d(J,{U:()=>b});var e=o(74848),r=o(96540),m=o(54594);const b=({config:F,onChangeTimeRange:U})=>{const Q=(0,r.useRef)(),[v,Y]=(0,r.useState)([]),[O,tt]=(0,r.useState)();if((0,r.useLayoutEffect)(()=>{F.addHook("init",g=>{Q.current=g}),F.addHook("setScale",g=>{Y(g.data?.[0]??[]),tt(g.scales.x??void 0)})},[F]),v.length<2||!U||!O||!O.time||!O.min||!O.max)return null;let T=0,C=v.length-1;for(;T<=C&&v[T]==null;)T++;for(;C>=0&&v[C]==null;)C--;const Z=v[T],$=v[C],n=O.min,f=O.max;return Z==null||$==null||Z<=f&&$>=n?null:(0,e.jsx)("div",{style:{position:"absolute",top:"50%",transform:"translateY(-50%)",width:"100%",textAlign:"center"},children:(0,e.jsxs)("div",{children:[(0,e.jsx)("div",{children:"Data outside time range"}),(0,e.jsx)(m.$n,{onClick:g=>U({from:Z,to:$}),variant:"secondary","data-testid":"time-series-zoom-to-data",children:"Zoom to data"})]})})};b.displayName="OutsideRangePlugin"},16725:(ft,J,o)=>{o.d(J,{B_:()=>tt,Fg:()=>Z,O2:()=>C,T5:()=>$});var e=o(63739),r=o(23570),m=o(59141),b=o(16869),F=o(17177),U=o(66380),Q=o(54430),v=o(7500),Y=o(24415);function O(n){let f=new Map;return n.map(S=>({...S,fields:S.fields.map(d=>{if(d.type===e.PU.enum){let E=(0,Y.M)(d.config,d.type),c=f.get(E);c||(c=[],f.set(E,c));let D=d.values.toArray().slice(),B=d.config.type.enum.text;if(c.length>0)for(let u=0;u<D.length;u++)D[u]+=c.length;return c.push(...B),d.config.type.enum.text=c,{...d,values:D}}return d})}))}function tt(n,f,g,S){if(!n?.length)return null;(0,r.Fm)(n);let d=S!=null;S!=null&&S>0&&(n=[{...n[0],fields:[n[0].fields[S],...n[0].fields.filter((B,u)=>u!==S)]}]);for(let B of n)for(let u of B.fields)u.type===e.PU.time&&typeof u.values[0]!="number"&&(u.values=(0,F.s7)(u,{destinationType:e.PU.time}).values);let E=0;t:for(let B of n)for(let u of B.fields)if(u.type===e.PU.enum&&++E>1){n=O(n);break t}let c;const D=[];for(let B of n){const u=[];let ut=!1,at=!1,mt=d?B:(0,U.M)({frame:B,refFieldPseudoMin:g?.from.valueOf(),refFieldPseudoMax:g?.to.valueOf()});const gt=(0,Q.C)(mt).fields;for(let lt=0;lt<(gt?.length||0);lt++){const W=gt[lt];switch(W.type){case e.PU.time:ut=!0,u.push(W);break;case e.PU.number:at=d?lt>0:!0,c={...W,values:W.values.map(w=>Number.isFinite(w)||w==null?w:null)},u.push(c);break;case e.PU.enum:at=!0;case e.PU.string:c={...W,values:W.values},u.push(c);break;case e.PU.boolean:at=!0;const nt=W.config?.custom??{},rt={...W.config,max:1,min:0,custom:nt};nt.lineInterpolation!==v.dx.StepBefore&&(nt.lineInterpolation=v.dx.StepAfter),c={...W,config:rt,type:e.PU.number,values:W.values.map(w=>w==null?w:w?1:0)},(0,m.j9)(rt.unit)||(rt.unit="bool",c.display=(0,b.J)({field:c,theme:f})),u.push(c);break}}(d||ut)&&at&&D.push({...B,length:mt.length,fields:u})}return D.length?(C(D,f,0),T(D,f),D):null}const T=(n,f)=>{const{palette:g}=f.visualization;for(const S of n)for(const d of S.fields)if(d.type===e.PU.enum){const E=g[d.state?.seriesIndex%g.length],c=f.visualization.getColorByName(E),D=d.config.type.enum;D.color=Array(D.text.length).fill(c),d.display=(0,b.J)({field:d,theme:f})}},C=(n,f,g)=>{let S=0;n.forEach(d=>{d.fields.forEach((E,c)=>{c!==g&&(E.type===e.PU.number||E.type===e.PU.boolean||E.type===e.PU.enum)&&(E.state={...E.state,seriesIndex:S++},E.display=(0,b.J)({field:E,theme:f}))})})};function Z(n,f){return!n||!n.length?[f]:n.map(g=>g?.length?g:f)}const $=n=>n.mode===v.$N.Multi&&n.maxHeight!=null}}]);

//# sourceMappingURL=7099.607c5885cde7dc643e52.js.map