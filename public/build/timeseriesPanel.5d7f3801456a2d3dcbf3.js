"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[563],{72910:(Ze,w,s)=>{s.r(w),s.d(w,{plugin:()=>je});var ie=s(68256),E=s(30040),se=s(13678),g=s(74848),A=s(96540),oe=s(47370),V=s(74958),ne=s(350),t=s(7500),le=s(90415),ae=s(40923),re=s(72778),F=s(12963),de=s(29519),fe=s(88023),ce=s(70561),me=s(4188),U=s(2203),ue=s(37604),he=s(87719),M=s(62931),ge=s(66564),Y=s(16910),x=s(18550);class pe{getSuggestionsForData(o){const{dataSummary:i}=o;if(!i.hasTimeField||!i.hasNumberField||i.rowCountTotal<2)return;const d=o.getListAppender({name:x.m.LineChart,pluginId:"timeseries",options:{legend:{calcs:[],displayMode:t.lm.Hidden,placement:"right",showLegend:!1}},fieldConfig:{defaults:{custom:{}},overrides:[]},cardOptions:{previewModifier:n=>{n.fieldConfig?.defaults.custom?.drawStyle!==t.GR.Bars&&(n.fieldConfig.defaults.custom.lineWidth=Math.max(n.fieldConfig.defaults.custom.lineWidth??1,2))}}}),f=100;if(d.append({name:x.m.LineChart}),i.rowCountMax<200&&d.append({name:x.m.LineChartSmooth,fieldConfig:{defaults:{custom:{lineInterpolation:t.dx.Smooth}},overrides:[]}}),i.numberFieldCount===1){d.append({name:x.m.AreaChart,fieldConfig:{defaults:{custom:{fillOpacity:25}},overrides:[]}}),d.append({name:x.m.LineChartGradientColorScheme,fieldConfig:{defaults:{color:{mode:M.Y.ContinuousGrYlRd},custom:{gradientMode:t.on.Scheme,lineInterpolation:t.dx.Smooth,lineWidth:3,fillOpacity:20}},overrides:[]}}),i.rowCountMax<f&&(d.append({name:x.m.BarChart,fieldConfig:{defaults:{custom:{drawStyle:t.GR.Bars,fillOpacity:100,lineWidth:1,gradientMode:t.on.Hue}},overrides:[]}}),d.append({name:x.m.BarChartGradientColorScheme,fieldConfig:{defaults:{color:{mode:M.Y.ContinuousGrYlRd},custom:{drawStyle:t.GR.Bars,fillOpacity:90,lineWidth:1,gradientMode:t.on.Scheme}},overrides:[]}}));return}d.append({name:x.m.AreaChartStacked,fieldConfig:{defaults:{custom:{fillOpacity:25,stacking:{mode:t.gs.Normal,group:"A"}}},overrides:[]}}),d.append({name:x.m.AreaChartStackedPercent,fieldConfig:{defaults:{custom:{fillOpacity:25,stacking:{mode:t.gs.Percent,group:"A"}}},overrides:[]}}),i.rowCountTotal/i.numberFieldCount<f&&(d.append({name:x.m.BarChartStacked,fieldConfig:{defaults:{custom:{drawStyle:t.GR.Bars,fillOpacity:100,lineWidth:1,gradientMode:t.on.Hue,stacking:{mode:t.gs.Normal,group:"A"}}},overrides:[]}}),d.append({name:x.m.BarChartStackedPercent,fieldConfig:{defaults:{custom:{drawStyle:t.GR.Bars,fillOpacity:100,lineWidth:1,gradientMode:t.on.Hue,stacking:{mode:t.gs.Percent,group:"A"}}},overrides:[]}}))}}function ve(e){const o=(0,Y.UA)().getCurrent()?.getPanelById(e);if(o){const i=o.transformations?[...o.transformations]:[];return i.push({id:ge.F.prepareTimeSeries,options:{format:"wide"}}),{name:"Transform to wide time series format",pluginId:"timeseries",transformations:i}}}var Z=s(16725);const ye=({data:e,timeRange:o,timeZone:i,width:d,height:f,options:n,fieldConfig:u,onChangeTimeRange:l,replaceVariables:h,id:S})=>{const{sync:L,eventsScope:m,canAddAnnotations:a,onThresholdsChange:r,canEditThresholds:p,showThresholds:T,dataLinkPostProcessor:c,eventBus:v}=(0,le.d2)(),O=n.orientation===t.wV.Vertical,N=(0,A.useMemo)(()=>(0,Z.B_)(e.series,fe.$W.theme2,o),[e.series,o]),He=(0,A.useMemo)(()=>(0,Z.Fg)(n.timezone,i),[n.timezone,i]),z=(0,A.useMemo)(()=>{if(N?.length&&N.every(C=>C.meta?.type===oe.m.TimeSeriesLong)){const C=ve(S);return{message:"Long data must be converted to wide",suggestions:C?[C]:void 0}}},[N,S]),q=!!(a&&a()),[be,k]=(0,A.useState)(null),j=L?.()??V.y.Off;return!N||z?(0,g.jsx)(ne.a,{panelId:S,message:z?.message,fieldConfig:u,data:e,needsTimeField:!0,needsNumberField:!0,suggestions:z?.suggestions}):(0,g.jsx)(de.Z,{frames:N,structureRev:e.structureRev,timeRange:o,timeZone:He,width:d,height:f,legend:n.legend,options:n,replaceVariables:h,dataLinkPostProcessor:c,cursorSync:j,children:(C,H)=>(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(ae.Z,{config:C}),j!==V.y.Off&&(0,g.jsx)(re.K,{config:C,eventBus:v,frame:H}),n.tooltip.mode!==t.$N.None&&(0,g.jsx)(F.xl,{config:C,hoverMode:n.tooltip.mode===t.$N.Single?F.b3.xOne:F.b3.xAll,queryZoom:l,clientZoom:!0,syncMode:j,syncScope:m,getDataLinks:(R,b)=>H.fields[R].getLinks?.({valueRowIndex:b})??[],render:(R,b,we,Ee=!1,_,ee,Ve,Ue)=>{if(q&&ee!=null){k(ee),_();return}const Ye=()=>{let te=R.posToVal(R.cursor.left,"x");k({from:te,to:te}),_()};return(0,g.jsx)(ce.k,{series:H,dataIdxs:b,seriesIdx:we,mode:Ve?t.$N.Multi:n.tooltip.mode,sortOrder:n.tooltip.sort,hideZeros:n.tooltip.hideZeros,isPinned:Ee,annotate:q?Ye:void 0,maxHeight:n.tooltip.maxHeight,replaceVariables:h,dataLinks:Ue})},maxWidth:n.tooltip.maxWidth}),!O&&(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(me.W,{annotations:e.annotations??[],config:C,timeZone:i,newRange:be,setNewRange:k}),(0,g.jsx)(ue.U,{config:C,onChangeTimeRange:l}),e.annotations&&(0,g.jsx)(U.z,{visibleSeries:(0,U.e)(C,N),config:C,exemplars:e.annotations,timeZone:i}),(p&&r||T)&&(0,g.jsx)(he.p,{config:C,fieldConfig:u,onThresholdsChange:p?r:void 0})]})]})})};var K=s(22803),G=s(58064),Ce=s(29675),xe=s(14749),J=s(99764);const Se=({value:e,onChange:o})=>{const i=(0,Ce.of)(Te);(!e||e.length<1)&&(e=[""]);const d=()=>{o([...e,G.g$.default])},f=u=>{const l=e.slice();l.splice(u,1),o(l)},n=(u,l)=>{const h=e.slice();h[u]=l??G.g$.default,h.length===0||h.length===1&&h[0]===""?o(void 0):o(h)};return(0,g.jsx)("ul",{className:i.list,children:e.map((u,l)=>(0,g.jsxs)("li",{className:i.listItem,children:[(0,g.jsx)(xe.U,{onChange:h=>n(l,h),includeInternal:!0,value:u??G.g$.default}),l===e.length-1?(0,g.jsx)(J.K,{name:"plus",onClick:d,tooltip:"Add timezone"}):(0,g.jsx)(J.K,{name:"times",onClick:()=>f(l),tooltip:"Remove timezone"})]},`${l}.${u}`))})},Te=e=>({list:(0,K.css)({listStyle:"none",display:"flex",flexDirection:"column",gap:e.spacing(.5)}),listItem:(0,K.css)({display:"flex",gap:e.spacing(1)})});var B=s(38928),y=s(2543),P=s(38075),Le=s(62321),Oe=s(8392),W=s(91357),Ne=s(99116),Pe=s(63739),Ae=s(80757),Me=s(62652),Be=s(11997),Re=s(18745),Fe=s(92980);let D=null;const Ge=(e,o,i,d)=>{if(o==="graph"&&i.angular){const{fieldConfig:f,options:n,annotations:u}=We({...i.angular,fieldConfig:d,panel:e});return u?.length>0&&ke(u),e.fieldConfig=f,e.alert=i.angular.alert,n}return $e(e),{}};function We(e){let o=[];const i=e.fieldConfig?.overrides??[],d=e.yaxes??[];let f=Q(d[0]);e.fieldConfig?.defaults&&(f={...e.fieldConfig?.defaults,...f});const n={fill:e.dashes?"dash":"solid",dash:[e.dashLength??10,e.spaceLength??10]};if(e.aliasColors)for(const m of Object.keys(e.aliasColors)){const a=e.aliasColors[m];a&&i.push({matcher:{id:P.Ct.byName,options:m},properties:[{id:Le.uo.Color,value:{mode:M.Y.Fixed,fixedColor:a}}]})}let u=!1;if(e.seriesOverrides?.length)for(const m of e.seriesOverrides){if(!m.alias)continue;const r={matcher:{id:/^([/~@;%#'])(.*?)\1([gimsuy]*)$/.test(m.alias)?P.Ct.byRegexp:P.Ct.byName,options:m.alias},properties:[]};let p;for(const T of Object.keys(m)){const c=m[T];switch(T){case"alias":case"$$hashKey":break;case"yaxis":if(c===2){const v=Q(d[1]);De(f,v,r.properties)}break;case"fill":r.properties.push({id:"custom.fillOpacity",value:c*10});break;case"fillBelowTo":u=!0,r.properties.push({id:"custom.fillBelowTo",value:c});break;case"fillGradient":c&&(r.properties.push({id:"custom.fillGradient",value:"opacity"}),r.properties.push({id:"custom.fillOpacity",value:c*10}));break;case"points":r.properties.push({id:"custom.showPoints",value:c?t.yL.Always:t.yL.Never});break;case"bars":c?(r.properties.push({id:"custom.drawStyle",value:t.GR.Bars}),r.properties.push({id:"custom.fillOpacity",value:100})):r.properties.push({id:"custom.drawStyle",value:t.GR.Line});break;case"lines":c?r.properties.push({id:"custom.drawStyle",value:"line"}):r.properties.push({id:"custom.lineWidth",value:0});break;case"linewidth":r.properties.push({id:"custom.lineWidth",value:c});break;case"pointradius":r.properties.push({id:"custom.pointSize",value:2+c*2});break;case"dashLength":case"spaceLength":case"dashes":switch(p||(p={fill:n.fill,dash:[...n.dash]}),T){case"dashLength":p.dash[0]=c;break;case"spaceLength":p.dash[1]=c;break;case"dashes":p.fill=c?"dash":"solid";break}break;case"stack":r.properties.push({id:"custom.stacking",value:ze(c)});break;case"color":r.properties.push({id:"color",value:{fixedColor:c,mode:M.Y.Fixed}});break;case"transform":r.properties.push({id:"custom.transform",value:c==="negative-Y"?t.NU.NegativeY:t.NU.Constant});break;default:console.log("Ignore override migration:",m.alias,T,c)}}p&&r.properties.push({id:"custom.lineStyle",value:p}),r.properties.length&&i.push(r)}const l=f.custom??{};l.drawStyle=e.bars?t.GR.Bars:e.lines?t.GR.Line:t.GR.Points,e.points?(l.showPoints=t.yL.Always,(0,y.isNumber)(e.pointradius)&&(l.pointSize=2+e.pointradius*2)):l.drawStyle!==t.GR.Points&&(l.showPoints=t.yL.Never),l.lineWidth=e.linewidth,n.fill!=="solid"&&(l.lineStyle=n),u?l.fillOpacity=35:(0,y.isNumber)(e.fill)&&(l.fillOpacity=e.fill*10),(0,y.isNumber)(e.fillGradient)&&e.fillGradient>0&&(l.gradientMode=t.on.Opacity,l.fillOpacity=e.fillGradient*10),l.spanNulls=e.nullPointMode===Oe.UW.Ignore,e.steppedLine&&(l.lineInterpolation=t.dx.StepAfter),l.drawStyle===t.GR.Bars&&(l.fillOpacity=100),e.stack&&(l.stacking={mode:e.percentage?t.gs.Percent:t.gs.Normal,group:B.S.stacking.group},e.percentage&&e.yaxis&&(delete f.min,delete f.max,f.decimals===0&&delete f.decimals)),f.custom=(0,y.omitBy)(l,y.isNil),f.nullValueMode=e.nullPointMode;const h={legend:{displayMode:t.lm.List,showLegend:!0,placement:"bottom",calcs:[]},tooltip:{mode:t.$N.Single,sort:t.xB.None}},S=e.legend;if(S){if(S.show?h.legend.displayMode=S.alignAsTable?t.lm.Table:t.lm.List:h.legend.showLegend=!1,S.rightSide&&(h.legend.placement="right"),e.legend.values){const m=(0,y.pickBy)(e.legend);h.legend.calcs=Ie(m)}e.legend.sideWidth&&(h.legend.width=e.legend.sideWidth),S.hideZero&&i.push(X(W.gy.allIsZero)),S.hideEmpty&&i.push(X(W.gy.allIsNull))}e.timeRegions?.length&&e.timeRegions.map((a,r)=>({name:`T${r}`,color:a.colorMode!=="custom"?a.colorMode:a.fillColor,line:a.line,fill:a.fill,fromDayOfWeek:a.fromDayOfWeek,toDayOfWeek:a.toDayOfWeek,from:a.from,to:a.to})).forEach((a,r)=>{const p={datasource:{type:"datasource",uid:"grafana"},enable:!0,hide:!0,filter:{exclude:!1,ids:[e.panel.id]},iconColor:a.fillColor??a.color,name:`Time region for panel ${e.panel.title}${r>0?` ${r}`:""}`,target:{queryType:Fe.nj.TimeRegions,refId:"Anno",timeRegion:{fromDayOfWeek:a.fromDayOfWeek,toDayOfWeek:a.toDayOfWeek,from:a.from,to:a.to,timezone:"utc"}}};a.fill?o.push(p):a.line&&(p.iconColor=a.lineColor??"white",o.push(p))});const L=e.tooltip;if(L&&(L.shared!==void 0&&(h.tooltip.mode=L.shared?t.$N.Multi:t.$N.Single),L.sort!==void 0&&L.shared))switch(L.sort){case 1:h.tooltip.sort=t.xB.Ascending;break;case 2:h.tooltip.sort=t.xB.Descending;break;default:h.tooltip.sort=t.xB.None}if(e.thresholds&&e.thresholds.length>0){let m=[],a=!1,r=!1;const p=e.thresholds.sort((c,v)=>c.value>v.value?1:-1);for(let c=0;c<p.length;c++){const v=p[c],O=p.length>c+1?p[c+1]:null;v.fill&&(a=!0),v.line&&(r=!0),v.op==="gt"&&m.push({value:v.value,color:I(v)}),v.op==="lt"&&(m.length===0&&m.push({value:-1/0,color:I(v)}),O&&O.op==="gt"&&O.value>v.value?m.push({value:v.value,color:"transparent"}):O&&O.op==="lt"?m.push({value:v.value,color:I(O)}):m.push({value:v.value,color:"transparent"}))}m.length>0&&m[0].value!==-1/0&&m.unshift({color:"transparent",value:-1/0});let T=a?t.Ly.Area:t.Ly.Line;r&&a&&(T=t.Ly.LineAndArea),f.custom.thresholdsStyle={mode:T},f.thresholds={mode:Ne.O.Absolute,steps:m}}return e.xaxis&&e.xaxis.show===!1&&e.xaxis.mode==="time"&&i.push({matcher:{id:P.Ct.byType,options:Pe.PU.time},properties:[{id:"custom.axisPlacement",value:t.vM.Hidden}]}),{fieldConfig:{defaults:(0,y.omitBy)(f,y.isNil),overrides:i},options:h,annotations:o}}function I(e){return e.colorMode==="critical"?"red":e.colorMode==="warning"?"orange":e.colorMode==="custom"?e.fillColor||e.lineColor:"red"}function Q(e){if(!e)return{};const o={axisPlacement:e.show?t.vM.Auto:t.vM.Hidden};if(e.label&&(o.axisLabel=e.label),e.logBase){const i=e.logBase;(i===2||i===10)&&(o.scaleDistribution={type:t.L4.Log,log:i})}return(0,y.omitBy)({unit:e.format,decimals:$(e.decimals),min:$(e.min),max:$(e.max),custom:o},y.isNil)}function De(e,o,i){for(const[n,u]of Object.entries(o))n!=="custom"&&u!==e[n]&&i.push({id:n,value:u});i.push({id:"custom.axisPlacement",value:t.vM.Right});const d=e.custom??{},f=o.custom??{};for(const[n,u]of Object.entries(f))u!==d[n]&&i.push({id:`custom.${n}`,value:u})}function $(e){if((0,y.isNumber)(e))return e;if((0,y.isString)(e)){const o=Number(e);if(!isNaN(o))return o}}function Ie(e){const o=[];for(const i in e){const d=W.AS.getIfExists(i);d&&o.push(d.id)}return o}function $e(e){e.fieldConfig?.defaults?.custom?.hideFrom?.graph!==void 0&&(e.fieldConfig.defaults.custom.hideFrom.viz=e.fieldConfig.defaults.custom.hideFrom.graph,delete e.fieldConfig.defaults.custom.hideFrom.graph),e.fieldConfig?.overrides&&(e.fieldConfig.overrides=e.fieldConfig.overrides.map(o=>(o.properties=o.properties.map(i=>(i.id==="custom.hideFrom"&&i.value.graph&&(i.value.viz=i.value.graph,delete i.value.graph),i)),o)))}function X(e){return{matcher:{id:P.Ct.byValue,options:{reducer:e,op:t.zT.GTE,value:0}},properties:[{id:"custom.hideFrom",value:{tooltip:!0,viz:!1,legend:!0}}]}}function ze(e){const o=B.S.stacking?.group;return{mode:e?t.gs.Normal:t.gs.None,group:(0,y.isString)(e)?e:o}}function ke(e){const o=window.__grafanaSceneContext;if(o instanceof Be.H$){const d=Re.b4.getDataLayers(o),f=[...d.state.annotationLayers];for(let n of e){const u=new Me.g({key:`annotations-${n.name}`,query:n,name:n.name,isEnabled:n.enable,isHidden:n.hide});f.push(u)}d.setState({annotationLayers:f});return}const i=(0,Y.UA)().getCurrent();i&&(i.annotations.list=[...i.annotations.list,...e],D==null&&(D=setTimeout(()=>{D=null,(0,Ae.jG)().refreshTimeModel()})))}const je=new ie.m(ye).setPanelChangeHandler(Ge).useFieldConfig((0,B.V)(B.S)).setPanelOptions(e=>{E.D(e,!1,!0,E.U),se.H(e),e.addCustomEditor({id:"timezone",name:"Time zone",path:"timezone",category:["Axis"],editor:Se,defaultValue:void 0})}).setSuggestionsSupplier(new pe).setDataSupport({annotations:!0,alertStates:!0})}}]);

//# sourceMappingURL=timeseriesPanel.5d7f3801456a2d3dcbf3.js.map