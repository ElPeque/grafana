"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[152],{89232:(ae,N,t)=>{t.r(N),t.d(N,{default:()=>Ct});var e=t(74848),g=t(22803),r=t(96540),P=t(54148),K=t(70713),f=t(56276),d=t(32370),y=t(29675),h=t(54594),j=t(22560),C=t(54122),x=t(88023),c=t(11817),M=t(61491),b=t(61351),L=t(64199),i=t(40286);function I(s=!1){return s?(0,c.t)("search.search-input.include-panels-placeholder","Search for dashboards, folders, and panels"):(0,c.t)("search.search-input.placeholder","Search for dashboards and folders")}function a(){return(0,c.t)("search.dashboard-actions.new-dashboard","New dashboard")}function m(){return(0,c.t)("search.dashboard-actions.new-folder","New folder")}function D(){return(0,c.t)("search.dashboard-actions.import","Import")}function $(){return(0,c.t)("search.dashboard-actions.new","New")}var p=t(15664),Y=t(48583),q=t(6736),X=t(22492),Z=t(91830),_=t(86843),ee=t(65139),te=t(98009);function U(){const s=(0,M.useDispatch)(),o=(0,_.xK)(),[u]=(0,p.uz)(),[l]=(0,p.wt)(),[,n]=(0,i.ET)(),E=(0,r.useMemo)(()=>!d.$.featureToggles.nestedFolders&&Object.values(o.folder).some(W=>W),[o]),S=n.hasSearchFilters(),O=()=>{s((0,_.cT)({isSelected:!1,folderUID:void 0})),S&&n.doSearchWithDebounce()},v=async()=>{await u({selectedItems:o}),se("delete",o),O()},B=async W=>{await l({selectedItems:o,destinationUID:W}),se("move",o),O()},V=()=>{X.A.publish(new Z.S8({component:te.J,props:{selectedItems:o,onConfirm:B}}))},F=()=>{X.A.publish(new Z.S8({component:ee.T,props:{selectedItems:o,onConfirm:v}}))},H=(0,e.jsx)(h.$n,{onClick:V,variant:"secondary",disabled:E,children:(0,e.jsx)(c.x6,{i18nKey:"browse-dashboards.action.move-button",children:"Move"})});return(0,e.jsxs)(Y.B,{gap:1,"data-testid":"manage-actions",children:[E?(0,e.jsx)(q.m,{content:(0,c.t)("browse-dashboards.action.cannot-move-folders","Folders cannot be moved"),children:H}):H,(0,e.jsx)(h.$n,{onClick:F,variant:"destructive",children:(0,e.jsx)(c.x6,{i18nKey:"browse-dashboards.action.delete-button",children:"Delete"})})]})}const Q={move:"grafana_manage_dashboards_item_moved",delete:"grafana_manage_dashboards_item_deleted"};function se(s,o){const u=Object.keys(o.dashboard).filter(n=>o.dashboard[n]),l=Object.keys(o.folder).filter(n=>o.folder[n]);(0,f.rR)(Q[s],{item_counts:{folder:l.length,dashboard:u.length},source:"tree_actions",restore_enabled:!!d.$.featureToggles.dashboardRestore})}var he=t(69889),le=t(92914);function ue(){const[s,o]=(0,i.ET)();return(0,e.jsx)(he.bj,{showStarredFilter:!0,showLayout:!0,state:s,getTagOptions:o.getTagOptions,getSortOptions:(0,le.S)().getSortOptions,sortPlaceholder:(0,le.S)().sortPlaceholder,onLayoutChange:o.onLayoutChange,onStarredFilterChange:o.onStarredFilterChange,onSortChange:o.onSortChange,onTagFilterChange:o.onTagFilterChange,onDatasourceChange:o.onDatasourceChange,onPanelTypeChange:o.onPanelTypeChange,onSetIncludePanels:o.onSetIncludePanels})}var ge=t(59830),fe=t(54731),me=t(78464),ve=t(86865),R=(s=>(s[s.Unselected=0]="Unselected",s[s.Selected=1]="Selected",s[s.Mixed=2]="Mixed",s))(R||{}),Ee=t(32885),Fe=t(91793),We=t(10022),we=t(8392),oe=t(58779),De=t(81942),Pe=t(23758);function Ne({row:{original:s},isSelected:o,onItemSelectionChange:u}){const l=s.item;if(!o)return(0,e.jsx)(Ce,{});if(l.kind==="ui")return l.uiKind==="pagination-placeholder"?(0,e.jsx)(De.S,{disabled:!0,value:!1}):(0,e.jsx)(Ce,{});if((0,Pe.I2)(l.uid))return(0,e.jsx)(Ce,{});const n=o(l);return(0,e.jsx)(De.S,{"data-testid":oe.Tp.pages.BrowseDashboards.table.checkbox(l.uid),"aria-label":(0,c.t)("browse-dashboards.dashboards-tree.select-checkbox","Select"),value:n===R.Selected,indeterminate:n===R.Mixed,onChange:E=>u?.(l,E.currentTarget.checked)})}function Ce(){const s=(0,y.of)($e);return(0,e.jsx)("span",{className:s.checkboxSpacer})}const $e=s=>({checkboxSpacer:(0,g.css)({paddingLeft:s.spacing(2)})});function ze({isSelected:s,onAllSelectionChange:o}){const u=s?.("$all")??R.Unselected;return(0,e.jsx)(De.S,{value:u===R.Selected,indeterminate:u===R.Mixed,"aria-label":(0,c.t)("browse-dashboards.dashboards-tree.select-all-header-checkbox","Select all"),onChange:l=>{u===R.Mixed?o?.(!1):o?.(l.currentTarget.checked)}})}var Ve=t(70255),Oe=t(45565),He=t(99764),Qe=t(20968),Te=t(79784),Ye=t(8270),je=t(85516),Ge=t(1167),Ie=t(40917);const xe="md",Ae="sm";function Ze({row:{original:s},onFolderClick:o,treeID:u}){const l=(0,y.of)(Je),{item:n,level:E,isOpen:S}=s,O=(0,_.V6)(),v=S&&!O[n.uid],B=(0,Ge.cu)(s.item,S);return n.kind==="ui"?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(Ie.T,{level:E,spacing:{xs:1,md:3}}),(0,e.jsx)("span",{className:l.folderButtonSpacer}),n.uiKind==="empty-folder"?(0,e.jsx)("em",{className:l.emptyText,children:(0,e.jsx)(Oe.E,{variant:"body",color:"secondary",truncate:!0,children:"No items"})}):(0,e.jsx)(Ve.A,{width:200})]}):(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(Ie.T,{level:E,spacing:{xs:1,md:3}}),n.kind==="folder"?(0,e.jsx)(He.K,{size:xe,className:l.chevron,onClick:()=>{o(n.uid,!S)},name:S?"angle-down":"angle-right","aria-label":S?(0,c.t)("browse-dashboards.dashboards-tree.collapse-folder-button","Collapse folder {{title}}",{title:n.title}):(0,c.t)("browse-dashboards.dashboards-tree.expand-folder-button","Expand folder {{title}}",{title:n.title})}):(0,e.jsx)("span",{className:l.folderButtonSpacer}),(0,e.jsxs)("div",{className:l.iconNameContainer,children:[v?(0,e.jsx)(Qe.y,{size:Ae}):(0,e.jsx)(Te.I,{size:Ae,name:B}),(0,e.jsx)(Oe.E,{variant:"body",truncate:!0,id:u&&(0,Pe.eM)(u,n),children:n.url?(0,e.jsx)(Ye.N,{onClick:()=>{(0,f.rR)("manage_dashboards_result_clicked")},href:n.url,className:l.link,children:n.title}):n.title})]})]})}const Je=s=>({chevron:(0,g.css)({marginRight:s.spacing(1),width:(0,je.cs)(xe)}),emptyText:(0,g.css)({overflow:"hidden"}),folderButtonSpacer:(0,g.css)({paddingLeft:`calc(${(0,je.cs)(xe)}px + ${s.spacing(1)})`}),iconNameContainer:(0,g.css)({alignItems:"center",display:"flex",gap:s.spacing(1),overflow:"hidden"}),link:(0,g.css)({"&:hover":{textDecoration:"underline"}})});var _e=t(95015);function Xe({row:{original:s}}){const o=(0,y.of)(ke),u=s.item;return u.kind==="ui"?u.uiKind==="pagination-placeholder"?(0,e.jsx)(_e.L.Skeleton,{}):null:u.tags?(0,e.jsx)(_e.L,{className:o.tagList,tags:u.tags}):null}function ke(s){return{tagList:(0,g.css)({justifyContent:"flex-start",flexWrap:"nowrap"})}}var qe=t(19957);const Re=36,ye=36,et=0;function tt({items:s,width:o,height:u,isSelected:l,onFolderClick:n,onAllSelectionChange:E,onItemSelectionChange:S,isItemLoaded:O,requestLoadMore:v,canSelect:B=!1}){const V=(0,r.useId)(),F=(0,r.useRef)(null),H=(0,r.useRef)(null),W=(0,y.of)(Le);(0,r.useEffect)(()=>{F.current&&F.current.resetloadMoreItemsCache(!0),H.current&&H.current.resetAfterIndex(0)},[s]);const T=(0,r.useMemo)(()=>{const A={id:"checkbox",width:0,Header:ze,Cell:Ne},w={id:"name",width:3,Header:(0,e.jsx)("span",{style:{paddingLeft:24},children:(0,e.jsx)(c.x6,{i18nKey:"browse-dashboards.dashboards-tree.name-column",children:"Name"})}),Cell:Se=>(0,e.jsx)(Ze,{...Se,onFolderClick:n})},G={id:"tags",width:2,Header:(0,c.t)("browse-dashboards.dashboards-tree.tags-column","Tags"),Cell:Xe};return[B&&A,w,G].filter(we.zz)},[n,B]),z=(0,Ee.useTable)({columns:T,data:s},qe.A),{getTableProps:J,getTableBodyProps:k,headerGroups:ne}=z,ie=(0,r.useMemo)(()=>({table:z,isSelected:l,onAllSelectionChange:E,onItemSelectionChange:S,treeID:V}),[z,l,E,S,s,V]),ce=(0,r.useCallback)(A=>O(A),[O]),be=(0,r.useCallback)((A,w)=>{const{parentUID:G}=s[A];v(G)},[v,s]),pe=(0,r.useCallback)(A=>{const w=s[A];return w.item.kind==="ui"&&w.item.uiKind==="divider"?et:ye},[s]);return(0,e.jsxs)("div",{...J(),role:"table",children:[ne.map(A=>{const{key:w,...G}=A.getHeaderGroupProps({style:{width:o}});return(0,e.jsx)("div",{...G,className:(0,g.cx)(W.row,W.headerRow),children:A.headers.map(re=>{const{key:Se,...xt}=re.getHeaderProps();return(0,e.jsx)("div",{...xt,role:"columnheader",className:W.cell,children:re.render("Header",{isSelected:l,onAllSelectionChange:E})},Se)})},w)}),(0,e.jsx)("div",{...k(),"data-testid":oe.Tp.pages.BrowseDashboards.table.body,children:(0,e.jsx)(We.A,{ref:F,itemCount:s.length,isItemLoaded:ce,loadMoreItems:be,children:({onItemsRendered:A,ref:w})=>(0,e.jsx)(Fe._m,{ref:G=>{w(G),H.current=G},height:u-Re,width:o,itemCount:s.length,itemData:ie,estimatedItemSize:ye,itemSize:pe,onItemsRendered:A,children:st})})})]})}function st({index:s,style:o,data:u}){const l=(0,y.of)(Le),{table:n,isSelected:E,onItemSelectionChange:S,treeID:O}=u,{rows:v,prepareRow:B}=n,V=v[s];B(V);const F=V.original.item,{key:H,...W}=V.getRowProps({style:o});return F.kind==="ui"&&F.uiKind==="divider"?(0,e.jsx)("div",{...W,children:(0,e.jsx)("hr",{className:l.divider})},H):(0,e.jsx)("div",{...W,className:(0,g.cx)(l.row,l.bodyRow),"aria-labelledby":(0,Pe.eM)(O,F),"data-testid":oe.Tp.pages.BrowseDashboards.table.row("title"in F?F.title:F.uid),children:V.cells.map(T=>{const{key:z,...J}=T.getCellProps();return(0,e.jsx)("div",{...J,className:l.cell,children:T.render("Cell",{isSelected:E,onItemSelectionChange:S,treeID:O})},z)})},H)}const Le=s=>({row:(0,g.css)({gap:s.spacing(1)}),divider:(0,g.css)({borderTop:`1px solid ${s.colors.border.weak}`,width:"100%",margin:0}),headerRow:(0,g.css)({backgroundColor:s.colors.background.secondary,height:Re}),bodyRow:(0,g.css)({height:ye,"&:hover":{backgroundColor:s.colors.action.hover}}),cell:(0,g.css)({padding:s.spacing(1),overflow:"hidden",display:"flex",alignItems:"center"}),link:(0,g.css)({"&:hover":{textDecoration:"underline"}})});function at({folderUID:s,width:o,height:u,canSelect:l}){const n=(0,_.eC)(s),E=(0,M.useDispatch)(),S=(0,_.q0)(s),O=(0,_.Ms)(),v=(0,_.V6)(),B=(0,r.useCallback)((T,z)=>{E((0,_.wn)({folderUID:T,isOpen:z})),z&&E((0,_.Ii)({parentUID:T,pageSize:ve.md}))},[E]),V=(0,r.useCallback)((T,z)=>{E((0,_.t$)({item:T,isSelected:z}))},[E]),F=(0,r.useCallback)(T=>{if(T==="$all"){if(O.$all)return R.Selected;for(const k of Object.values(O))if(typeof k!="boolean"){for(const ne in k)if(k[ne])return R.Mixed}return R.Unselected}return O[T.kind][T.uid]?R.Selected:Be(T,v,O)?R.Mixed:R.Unselected},[O,v]),H=(0,r.useCallback)(T=>{const z=S[T];if(!z)return!1;const J=z.item;return!(J.kind==="ui"&&J.uiKind==="pagination-placeholder")},[S]),W=(0,_.Zg)();return n==="fulfilled"&&S.length===0?(0,e.jsx)("div",{style:{width:o},children:l?(0,e.jsx)(ge.p,{variant:"call-to-action",button:(0,e.jsx)(h.z9,{href:s?`dashboard/new?folderUid=${s}`:"dashboard/new",icon:"plus",size:"lg",children:(0,e.jsx)(c.x6,{i18nKey:"browse-dashboards.empty-state.button-title",children:"Create dashboard"})}),message:s?(0,c.t)("browse-dashboards.empty-state.title-folder","This folder doesn't have any dashboards yet"):(0,c.t)("browse-dashboards.empty-state.title","You haven't created any dashboards yet"),children:s&&(0,e.jsxs)(c.x6,{i18nKey:"browse-dashboards.empty-state.pro-tip",children:["Add/move dashboards to your folder at"," ",(0,e.jsx)(fe.Y,{external:!1,href:"/dashboards",children:"Browse dashboards"})]})}):(0,e.jsx)(me.c,{callToActionElement:(0,e.jsx)("span",{children:"This folder is empty"})})}):(0,e.jsx)(tt,{canSelect:l,items:S,width:o,height:u,isSelected:F,onFolderClick:B,onAllSelectionChange:T=>E((0,_.cT)({isSelected:T,folderUID:s})),onItemSelectionChange:V,isItemLoaded:H,requestLoadMore:W})}function Be(s,o,u){const l=o[s.uid];return l?l.items.some(n=>{const E=u[n.kind][n.uid];return E||Be(n,o,u)}):!1}var ot=t(2567),nt=t(53027),rt=t(19224),Me=t(36529),lt=t(60232),dt=t(58528),it=t(17687),ct=t(49785),ht=t(86489),ut=t(34128),gt=t(3142);const Ke={folderName:""};function ft({onCancel:s,onConfirm:o}){const{handleSubmit:u,register:l,formState:{errors:n}}=(0,ct.mN)({defaultValues:Ke}),E=(0,c.t)("browse-dashboards.action.new-folder-name-required-phrase","Folder name is required."),S=async v=>{try{return await gt.P.validateNewFolderName(v),!0}catch(B){if(B instanceof Error)return B.message;throw B}},O=(0,c.t)("browse-dashboards.new-folder-form.name-label","Folder name");return(0,e.jsxs)("form",{name:"addFolder",onSubmit:u(v=>o(v.folderName)),"data-testid":oe.Tp.pages.BrowseDashboards.NewFolderForm.form,children:[(0,e.jsx)(ht.D,{label:O,invalid:!!n.folderName,error:n.folderName&&n.folderName.message,children:(0,e.jsx)(ut.p,{"data-testid":oe.Tp.pages.BrowseDashboards.NewFolderForm.nameInput,id:"folder-name-input",defaultValue:Ke.folderName,...l("folderName",{required:E,validate:async v=>await S(v)})})}),(0,e.jsxs)(Y.B,{children:[(0,e.jsx)(h.$n,{variant:"secondary",fill:"outline",onClick:s,children:(0,e.jsx)(c.x6,{i18nKey:"browse-dashboards.new-folder-form.cancel-label",children:"Cancel"})}),(0,e.jsx)(h.$n,{type:"submit",children:(0,e.jsx)(c.x6,{i18nKey:"browse-dashboards.new-folder-form.create-label",children:"Create"})})]})]})}function mt({parentFolder:s,canCreateDashboard:o,canCreateFolder:u}){const[l,n]=(0,r.useState)(!1),E=(0,P.zy)(),[S]=(0,p.Vc)(),[O,v]=(0,r.useState)(!1),B=(0,it._2)(),V=async H=>{try{const W=await S({title:H,parentUid:s?.uid}),T=s?.parents?s.parents.length+1:0;(0,f.rR)("grafana_manage_dashboards_folder_created",{is_subfolder:!!s?.uid,folder_depth:T}),W.error?B.error("Failed to create folder"):B.success("Folder created"),W.data&&nt.Ny.push(ot.I.stripBaseFromUrl(W.data.url))}finally{v(!1)}},F=(0,e.jsxs)(rt.W,{children:[o&&(0,e.jsx)(Me.D,{label:a(),onClick:()=>(0,f.rR)("grafana_menu_item_clicked",{url:de("/dashboard/new",s?.uid),from:E.pathname}),url:de("/dashboard/new",s?.uid)}),u&&(0,e.jsx)(Me.D,{onClick:()=>v(!0),label:m()}),o&&(0,e.jsx)(Me.D,{label:D(),onClick:()=>(0,f.rR)("grafana_menu_item_clicked",{url:de("/dashboard/import",s?.uid),from:E.pathname}),url:de("/dashboard/import",s?.uid)})]});return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(lt.m,{overlay:F,onVisibleChange:n,children:(0,e.jsxs)(h.$n,{children:[$(),(0,e.jsx)(Te.I,{name:l?"angle-up":"angle-down"})]})}),O&&(0,e.jsx)(dt._,{title:m(),subtitle:s?.title?`Location: ${s.title}`:void 0,onClose:()=>v(!1),size:"sm",children:(0,e.jsx)(ft,{onConfirm:V,onCancel:()=>v(!1)})})]})}function de(s,o){const u=o?s+"?folderUid="+o:s;return d.$.appSubUrl?d.$.appSubUrl+u:u}var vt=t(12452),Et=t(3822),Dt=t(30962);const Ue=(0,r.memo)(()=>{const{uid:s}=(0,P.g)(),o=(0,M.useDispatch)(),u=(0,y.of)(Pt),[l,n]=(0,i.ET)(),E=n.hasSearchFilters(),S=(0,P.zy)(),O=(0,r.useMemo)(()=>new URLSearchParams(S.search),[S.search]);(0,r.useEffect)(()=>{n.initStateFromUrl(s),o((0,_.cT)({isSelected:!1,folderUID:void 0}))},[o,s,n]),(0,r.useEffect)(()=>{n.onSetStarred(O.has("starred"))},[O,n]),(0,r.useEffect)(()=>{!E&&l.result&&n.setState({result:void 0,includePanels:void 0}),E&&l.result?.totalRows===0&&(0,f.rR)("grafana_empty_state_shown",{source:"browse_dashboards"})},[E,l.result,n]);const{data:v}=(0,p.kH)(s??p.hT),[B]=(0,p.iB)(),V=(0,r.useMemo)(()=>{if(!v)return;const A=(0,L.R4)(v),w=(0,L.Cg)(v.uid),G=A.children?.find(re=>re.id===w);return G&&(G.active=!0),A},[v]),F=(0,_.QE)(),{data:H}=(0,p.kH)(v?p.hT:"general"),W=v??H,{canEditFolders:T,canEditDashboards:z,canCreateDashboards:J,canCreateFolders:k}=(0,Dt.N)(W),ne=b.TP.hasRole("Admin")||b.TP.isGrafanaAdmin,ie=T&&s,ce=T||z,be=async A=>{if(v){const w=await B({...v,title:A});if("error"in w)throw(0,f.rR)("grafana_browse_dashboards_page_edit_folder_name",{status:"failed_with_error"}),w.error;(0,f.rR)("grafana_browse_dashboards_page_edit_folder_name",{status:"success"})}else(0,f.rR)("grafana_browse_dashboards_page_edit_folder_name",{status:"failed_no_folderDTO"})},pe=()=>{(0,f.rR)("grafana_browse_dashboards_page_button_to_recently_deleted",{origin:window.location.pathname===(0,x.zj)().appSubUrl+"/dashboards"?"Dashboards":"Folder view"})};return(0,e.jsx)(C.Y,{navId:"dashboards/browse",pageNav:V,onEditTitle:ie?be:void 0,actions:(0,e.jsxs)(e.Fragment,{children:[d.$.featureToggles.dashboardRestore&&ne&&(0,e.jsx)(h.z9,{variant:"secondary",href:(0,x.zj)().appSubUrl+"/dashboard/recently-deleted",onClick:pe,children:(0,e.jsx)(c.x6,{i18nKey:"browse-dashboards.actions.button-to-recently-deleted",children:"Recently deleted"})}),v&&(0,e.jsx)(vt.m,{folder:v}),(J||k)&&(0,e.jsx)(mt,{parentFolder:v,canCreateDashboard:J,canCreateFolder:k})]}),children:(0,e.jsxs)(C.Y.Contents,{className:u.pageContents,children:[(0,e.jsx)("div",{children:(0,e.jsx)(j.Z,{placeholder:I(l.includePanels),value:l.query,escapeRegex:!1,onChange:A=>n.onQueryChange(A)})}),F?(0,e.jsx)(U,{}):(0,e.jsx)("div",{className:u.filters,children:(0,e.jsx)(ue,{})}),(0,e.jsx)("div",{className:u.subView,children:(0,e.jsx)(K.default,{children:({width:A,height:w})=>E?(0,e.jsx)(Et.Q,{canSelect:ce,width:A,height:w,searchState:l,searchStateManager:n}):(0,e.jsx)(at,{canSelect:ce,width:A,height:w,folderUID:s})})})]})})}),Pt=s=>({pageContents:(0,g.css)({display:"flex",flexDirection:"column",gap:s.spacing(1),height:"100%"}),subView:(0,g.css)({height:"100%"}),filters:(0,g.css)({display:"none",[s.breakpoints.up("md")]:{display:"block"}})});Ue.displayName="BrowseDashboardsPage";const Ct=Ue},65139:(ae,N,t)=>{t.d(N,{T:()=>x});var e=t(74848),g=t(96540),r=t(56276),P=t(32370),K=t(65164),f=t(45565),d=t(9968),y=t(37e3),h=t(11817),j=t(15664),C=t(97204);const x=({onConfirm:c,onDismiss:M,selectedItems:b,...L})=>{const{data:i}=(0,j.G2)(b),I=!!(i&&(i.alertRule||i.libraryPanel)),[a,m]=(0,g.useState)(!1),D=async()=>{(0,r.rR)("grafana_manage_dashboards_delete_clicked",{item_counts:{dashboard:Object.keys(b.dashboard).length,folder:Object.keys(b.folder).length},source:"browse_dashboards",restore_enabled:!!P.$.featureToggles.dashboardRestore}),m(!0);try{await c(),m(!1),M()}catch{m(!1)}};return(0,e.jsx)(K.u,{body:(0,e.jsxs)(e.Fragment,{children:[P.$.featureToggles.dashboardRestore&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(f.E,{element:"p",children:(0,e.jsx)(h.x6,{i18nKey:"browse-dashboards.action.delete-modal-restore-dashboards-text",children:"This action will delete the selected folders immediately but the selected dashboards will be marked for deletion in 30 days. Your organization administrator can restore the dashboards anytime before the 30 days expire. Folders cannot be restored."})}),(0,e.jsx)(d.$,{v:2})]}),(0,e.jsx)(f.E,{element:"p",children:(0,e.jsx)(h.x6,{i18nKey:"browse-dashboards.action.delete-modal-text",children:"This action will delete the following content:"})}),(0,e.jsx)(C.x,{selectedItems:b}),(0,e.jsx)(d.$,{v:2})]}),description:(0,e.jsx)(e.Fragment,{children:I?(0,e.jsx)(y.F,{severity:"warning",title:(0,h.t)("browse-dashboards.action.delete-modal-invalid-title","Cannot delete folder"),children:(0,e.jsx)(h.x6,{i18nKey:"browse-dashboards.action.delete-modal-invalid-text",children:"One or more folders contain library panels or alert rules. Delete these first in order to proceed."})}):null}),confirmationText:(0,h.t)("browse-dashboards.action.confirmation-text","Delete"),confirmText:a?(0,h.t)("browse-dashboards.action.deleting","Deleting..."):(0,h.t)("browse-dashboards.action.delete-button","Delete"),onDismiss:M,onConfirm:D,title:(0,h.t)("browse-dashboards.action.delete-modal-title","Delete"),...L,disabled:I})}},98009:(ae,N,t)=>{t.d(N,{J:()=>x});var e=t(74848),g=t(96540),r=t(25356),P=t(37e3),K=t(45565),f=t(9968),d=t(86489),y=t(54594),h=t(62851),j=t(11817),C=t(97204);const x=({onConfirm:c,onDismiss:M,selectedItems:b,...L})=>{const[i,I]=(0,g.useState)(),[a,m]=(0,g.useState)(!1),D=Object.keys(b.folder).filter(p=>b.folder[p]),$=async()=>{if(i!==void 0){m(!0);try{await c(i),m(!1),M()}catch{m(!1)}}};return(0,e.jsxs)(r.a,{title:(0,j.t)("browse-dashboards.action.move-modal-title","Move"),onDismiss:M,...L,children:[D.length>0&&(0,e.jsx)(P.F,{severity:"info",title:(0,j.t)("browse-dashboards.action.move-modal-alert","Moving this item may change its permissions.")}),(0,e.jsx)(K.E,{element:"p",children:(0,e.jsx)(j.x6,{i18nKey:"browse-dashboards.action.move-modal-text",children:"This action will move the following content:"})}),(0,e.jsx)(C.x,{selectedItems:b}),(0,e.jsx)(f.$,{v:3}),(0,e.jsx)(d.D,{label:(0,j.t)("browse-dashboards.action.move-modal-field-label","Folder name"),children:(0,e.jsx)(h.d,{value:i,excludeUIDs:D,onChange:I})}),(0,e.jsxs)(r.a.ButtonRow,{children:[(0,e.jsx)(y.$n,{onClick:M,variant:"secondary",fill:"outline",children:(0,e.jsx)(j.x6,{i18nKey:"browse-dashboards.action.cancel-button",children:"Cancel"})}),(0,e.jsx)(y.$n,{disabled:i===void 0||a,onClick:$,variant:"primary",children:a?(0,j.t)("browse-dashboards.action.moving","Moving..."):(0,j.t)("browse-dashboards.action.move-button","Move")})]})]})}},12452:(ae,N,t)=>{t.d(N,{m:()=>m});var e=t(74848),g=t(96540),r=t(32370),P=t(56276),K=t(53027),f=t(19224),d=t(36529),y=t(60232),h=t(54594),j=t(79784),C=t(58528),x=t(12590),c=t(87638),M=t(11817),b=t(91830),L=t(15664),i=t(30962),I=t(65139),a=t(98009);function m({folder:D}){const[$,p]=(0,g.useState)(!1),[Y,q]=(0,g.useState)(!1),[X]=(0,L.aF)(),[Z]=(0,L.Ko)(),{canEditFolders:_,canDeleteFolders:ee,canViewPermissions:te,canSetPermissions:U}=(0,i.N)(D),Q=r.$.featureToggles.nestedFolders&&_,se=async R=>{await X({folder:D,destinationUID:R}),(0,P.rR)("grafana_manage_dashboards_item_moved",{item_counts:{folder:1,dashboard:0},source:"folder_actions"})},he=async()=>{await Z(D),(0,P.rR)("grafana_manage_dashboards_item_deleted",{item_counts:{folder:1,dashboard:0},source:"folder_actions"});const{parents:R}=D,Ee=R&&R.length?R[R.length-1].url:"/dashboards";K.Ny.push(Ee)},le=()=>{c.lE.publish(new b.S8({component:a.J,props:{selectedItems:{folder:{[D.uid]:!0},dashboard:{},panel:{},$all:!1},onConfirm:se}}))},ue=()=>{c.lE.publish(new b.S8({component:I.T,props:{selectedItems:{folder:{[D.uid]:!0},dashboard:{},panel:{},$all:!1},onConfirm:he}}))},ge=(0,M.t)("browse-dashboards.folder-actions-button.manage-permissions","Manage permissions"),fe=(0,M.t)("browse-dashboards.folder-actions-button.move","Move"),me=(0,M.t)("browse-dashboards.folder-actions-button.delete","Delete"),ve=(0,e.jsxs)(f.W,{children:[te&&(0,e.jsx)(d.D,{onClick:()=>q(!0),label:ge}),Q&&(0,e.jsx)(d.D,{onClick:le,label:fe}),ee&&(0,e.jsx)(d.D,{destructive:!0,onClick:ue,label:me})]});return!te&&!Q&&!ee?null:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(y.m,{overlay:ve,onVisibleChange:p,children:(0,e.jsxs)(h.$n,{variant:"secondary",children:[(0,e.jsx)(M.x6,{i18nKey:"browse-dashboards.folder-actions-button.folder-actions",children:"Folder actions"}),(0,e.jsx)(j.I,{name:$?"angle-up":"angle-down"})]})}),Y&&(0,e.jsx)(C._,{title:(0,M.t)("browse-dashboards.action.manage-permissions-button","Manage permissions"),subtitle:D.title,onClose:()=>q(!1),size:"md",children:(0,e.jsx)(x.x,{resource:"folders",resourceId:D.uid,canSetPermissions:U})})]})}},3822:(ae,N,t)=>{t.d(N,{Q:()=>M});var e=t(74848),g=t(96540),r=t(94626),P=t(4038),K=t(59830),f=t(54594),d=t(11817),y=t(51253),h=t(98022),j=t(61491),C=t(86843);const x=25,c={view:new r.R((0,P.Vc)({fields:[{name:"uid",display:!0,values:Array(x).fill(null)},{name:"kind",display:!0,values:Array(x).fill("dashboard")},{name:"name",display:!0,values:Array(x).fill("")},{name:"location",display:!0,values:Array(x).fill("")},{name:"tags",display:!0,values:Array(x).fill([])}],meta:{custom:{locationInfo:[]}}})),loadMoreItems:()=>Promise.resolve(),isItemLoaded:()=>!1,totalRows:x};function M({width:L,height:i,canSelect:I,searchState:a,searchStateManager:m,emptyState:D}){const $=(0,j.useDispatch)(),p=(0,j.useSelector)(U=>U.browseDashboards.selectedItems),Y=(0,C.QE)(),{keyboardEvents:q}=(0,y.d)(),X=a.result??c,Z=(0,g.useCallback)((U,Q)=>U?U==="*"&&Q==="*"?Y:U==="*"?!1:p[b(U)][Q]??!1:!1,[p,Y]),_=(0,g.useCallback)(()=>{$((0,C.cT)({isSelected:!1,folderUID:void 0}))},[$]),ee=(0,g.useCallback)((U,Q)=>{const se=!Z(U,Q);$((0,C.t$)({item:{kind:b(U),uid:Q},isSelected:se}))},[Z,$]);if(X.totalRows===0){const U=D??(0,e.jsx)(K.p,{button:(0,e.jsx)(f.$n,{variant:"secondary",onClick:m.onClearSearchAndFilters,children:(0,e.jsx)(d.x6,{i18nKey:"browse-dashboards.no-results.clear",children:"Clear search and filters"})}),message:(0,d.t)("browse-dashboards.no-results.text","No results found for your query"),variant:"not-found",role:"alert"});return(0,e.jsx)("div",{style:{width:L},children:U})}const te={response:X,selection:I?Z:void 0,selectionToggle:I?ee:void 0,clearSelection:_,width:L,height:i,onTagSelected:m.onAddTag,keyboardEvents:q,onDatasourceChange:a.datasource?m.onDatasourceChange:void 0,onClickItem:m.onSearchItemClicked};return(0,e.jsx)(h.P,{...te})}function b(L){switch(L){case"folder":return"folder";case"dashboard":return"dashboard";case"panel":return"panel"}throw new Error("Unsupported kind"+L)}},30962:(ae,N,t)=>{t.d(N,{N:()=>f});var e=t(32370),g=t(87638),r=t(61491);function P(d,y){return y?g.TP.hasPermissionInMetadata(d,y):g.TP.hasPermission(d)}function K(d){return d&&d.uid!=="general"&&!e.$.featureToggles.nestedFolders?!1:e.$.featureToggles.accessActionSets?P(r.AccessControlAction.FoldersCreate,d):!d||d.uid==="general"?P(r.AccessControlAction.FoldersCreate):P(r.AccessControlAction.FoldersCreate)&&P(r.AccessControlAction.FoldersWrite,d)}function f(d){const y=P(r.AccessControlAction.DashboardsCreate,d),h=K(d),j=P(r.AccessControlAction.FoldersDelete,d),C=P(r.AccessControlAction.DashboardsWrite,d),x=P(r.AccessControlAction.FoldersWrite,d),c=P(r.AccessControlAction.FoldersPermissionsWrite,d),M=P(r.AccessControlAction.FoldersPermissionsRead,d);return{canCreateDashboards:y,canCreateFolders:h,canDeleteFolders:j,canEditDashboards:C,canEditFolders:x,canSetPermissions:c,canViewPermissions:M}}},69889:(ae,N,t)=>{t.d(N,{bj:()=>b});var e=t(74848),g=t(22803),r=t(32370),P=t(29675),K=t(48583),f=t(81942),d=t(54594),y=t(60641),h=t(89963),j=t(96601),C=t(11817),x=t(70663);function c(){return[{value:x.P.Folders,icon:"folder",description:(0,C.t)("search.actions.view-as-folders","View by folders")},{value:x.P.List,icon:"list-ul",description:(0,C.t)("search.actions.view-as-list","View as list")}]}function M(i){const I=i.layout??x.P.Folders;return I===x.P.Folders&&(i.query||i.sort||i.starred||i.tag.length>0)?x.P.List:I}const b=({state:i,showStarredFilter:I,showLayout:a,sortPlaceholder:m,onLayoutChange:D,onSortChange:$,onStarredFilterChange:p=()=>{},onTagFilterChange:Y,getTagOptions:q,getSortOptions:X,onDatasourceChange:Z,onPanelTypeChange:_,onSetIncludePanels:ee})=>{const te=(0,P.of)(L),U=M(i),Q=i.tag.length||i.starred||i.query||i.datasource||i.panel_type?[x.P.Folders]:[];return(0,e.jsxs)(K.B,{justifyContent:"space-between",alignItems:"center",children:[(0,e.jsxs)(K.B,{gap:2,alignItems:"center",children:[(0,e.jsx)(j.$,{isClearable:!1,tags:i.tag,tagOptions:q,onChange:Y}),r.$.featureToggles.panelTitleSearch&&(0,e.jsx)(f.S,{"data-testid":"include-panels",disabled:U===x.P.Folders,value:i.includePanels,onChange:()=>ee(!i.includePanels),label:(0,C.t)("search.actions.include-panels","Include panels")}),I&&(0,e.jsx)("div",{className:te.checkboxWrapper,children:(0,e.jsx)(f.S,{label:(0,C.t)("search.actions.starred","Starred"),onChange:p,value:i.starred})}),i.datasource&&(0,e.jsx)(d.$n,{icon:"times",variant:"secondary",onClick:()=>Z(void 0),children:(0,e.jsxs)(C.x6,{i18nKey:"search.actions.remove-datasource-filter",children:["Datasource: ",{datasource:i.datasource}]})}),i.panel_type&&(0,e.jsxs)(d.$n,{icon:"times",variant:"secondary",onClick:()=>_(void 0),children:["Panel: ",i.panel_type]})]}),(0,e.jsxs)(K.B,{gap:2,children:[a&&(0,e.jsx)(y.z,{options:c(),disabledOptions:Q,onChange:D,value:U}),(0,e.jsx)(h.r,{onChange:se=>$(se?.value),value:i.sort,getSortOptions:X,placeholder:m||(0,C.t)("search.actions.sort-placeholder","Sort"),isClearable:!0})]})]})};b.displayName="ActionRow";const L=i=>({checkboxWrapper:(0,g.css)({label:{lineHeight:"1.2"}})})},40286:(ae,N,t)=>{t.d(N,{ET:()=>i,lC:()=>M,ue:()=>C});var e=t(2543),g=t.n(e),r=t(53027),P=t(5761),K=t(82856),f=t(93719),d=t(19614),y=t(92914),h=t(70663),j=t(10867);const C={query:"",tag:[],starred:!1,layout:h.P.Folders,sort:void 0,prevSort:void 0,eventTrackingNamespace:"dashboard_search",deleted:!1},x={sort:null,starred:null,query:null,tag:null,layout:null},c=()=>localStorage.getItem(f.YU)===h.P.List?h.P.List:h.P.Folders;class M extends P.Q{constructor(){super(...arguments),this.updateLocation=(0,e.debounce)(a=>r.Ny.partial(a,!0),300),this.doSearchWithDebounce=(0,e.debounce)(()=>this.doSearch(),300),this.lastSearchTimestamp=0,this.onCloseSearch=()=>{this.updateLocation({search:null,folder:null,...x})},this.onClearSearchAndFilters=()=>{this.setStateAndDoSearch({query:"",datasource:void 0,tag:[],panel_type:void 0,starred:void 0,sort:void 0})},this.onQueryChange=a=>{this.setStateAndDoSearch({query:a})},this.onRemoveTag=a=>{this.setStateAndDoSearch({tag:this.state.tag.filter(m=>m!==a)})},this.onTagFilterChange=a=>{this.setStateAndDoSearch({tag:a})},this.onAddTag=a=>{this.state.tag&&this.state.tag.includes(a)||this.setStateAndDoSearch({tag:[...this.state.tag,a]})},this.onDatasourceChange=a=>{this.setStateAndDoSearch({datasource:a})},this.onPanelTypeChange=a=>{this.setStateAndDoSearch({panel_type:a})},this.onStarredFilterChange=a=>{const m=a.currentTarget.checked;this.setStateAndDoSearch({starred:m})},this.onClearStarred=()=>{this.setStateAndDoSearch({starred:!1})},this.onSetStarred=a=>{a!==this.state.starred&&this.setStateAndDoSearch({starred:a})},this.onSortChange=a=>{a?localStorage.setItem(f.w7,a):localStorage.removeItem(f.w7),this.state.layout===h.P.Folders?this.setStateAndDoSearch({sort:a,layout:h.P.List}):this.setStateAndDoSearch({sort:a})},this.onLayoutChange=a=>{localStorage.setItem(f.YU,a),this.state.sort&&a===h.P.Folders?this.setStateAndDoSearch({layout:a,prevSort:this.state.sort,sort:void 0}):this.setStateAndDoSearch({layout:a,sort:this.state.prevSort})},this.onSetIncludePanels=a=>{this.setStateAndDoSearch({includePanels:a}),K.A.set(f.d7,a)},this.getTagOptions=()=>{const a=this.lastQuery??{kind:["dashboard","folder"],query:"*"};return(0,y.S)().tags(a)},this.onSearchItemClicked=a=>{(0,d.MK)(this.state.eventTrackingNamespace,{layout:this.state.layout,starred:this.state.starred,sortValue:this.state.sort,query:this.state.query,tagCount:this.state.tag?.length,includePanels:this.state.includePanels,deleted:this.state.deleted})},this.onReportSearchUsage=()=>{(0,d.Pf)(this.state.eventTrackingNamespace,{layout:this.state.layout,starred:this.state.starred,sortValue:this.state.sort,query:this.state.query,tagCount:this.state.tag?.length,includePanels:this.state.includePanels,deleted:this.state.deleted})}}initStateFromUrl(a,m=!0){const D=(0,j.N1)(r.Ny.getSearchObject());(D.query||D.datasource||D.panel_type)&&(D.layout=h.P.List);const $=c(),p=localStorage.getItem(f.w7)??void 0,Y=$===h.P.List?D.sort||p:null;this.setState({...C,...D,layout:$,sort:Y??C.sort,prevSort:p,folderUid:a,eventTrackingNamespace:a?"manage_dashboards":"dashboard_search",deleted:this.state.deleted}),m&&this.hasSearchFilters()&&this.doSearch()}setStateAndDoSearch(a){const m=a.sort||this.state.sort||localStorage.getItem(f.w7)||void 0;this.setState({sort:m,...a}),this.updateLocation({query:this.state.query.length===0?null:this.state.query,tag:this.state.tag,datasource:this.state.datasource,panel_type:this.state.panel_type,starred:this.state.starred?this.state.starred:null,sort:this.state.sort}),this.hasSearchFilters()&&this.doSearchWithDebounce()}hasSearchFilters(){return!!(this.state.query||this.state.tag.length||this.state.starred||this.state.panel_type||this.state.sort||this.state.deleted||this.state.layout===h.P.List)}getSearchQuery(){const a={query:this.state.query,tags:this.state.tag,ds_uid:this.state.datasource,panel_type:this.state.panel_type,location:this.state.folderUid,sort:this.state.sort,explain:this.state.explain,withAllowedActions:this.state.explain,starred:this.state.starred,deleted:this.state.deleted};return a.sort?.length&&!a.sort.includes("name")&&(a.kind=["dashboard","folder"]),a.query?.length||(a.query="*",a.location||(a.kind=["dashboard","folder"])),!this.state.includePanels&&!a.kind&&(a.kind=["dashboard","folder"]),a.panel_type?.length&&(a.kind=["panel"]),a}doSearch(){const a={layout:this.state.layout,starred:this.state.starred,sortValue:this.state.sort,query:this.state.query,tagCount:this.state.tag?.length,includePanels:this.state.includePanels,deleted:this.state.deleted};(0,d.J$)(this.state.eventTrackingNamespace,a),this.lastQuery=this.getSearchQuery(),this.setState({loading:!0});const m=(0,y.S)(),D=Date.now();(this.state.starred?m.starred(this.lastQuery):m.search(this.lastQuery)).then(p=>{D>this.lastSearchTimestamp&&(this.setState({result:p,loading:!1}),this.lastSearchTimestamp=D)}).catch(p=>{(0,d.KZ)(this.state.eventTrackingNamespace,{...a,error:p?.message}),this.setState({loading:!1})})}}let b;function L(){if(!b){const a=localStorage.getItem(f.YU)??C.layout;let m=K.A.getBool(f.d7,!0);m&&(m=!1),b=new M({...C,layout:a,includePanels:m})}return b}function i(){const I=L();return[I.useState(),I]}}}]);

//# sourceMappingURL=DashboardListPage.1ac5ff9a9f4434a7e6cf.js.map