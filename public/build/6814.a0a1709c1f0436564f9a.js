"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[6814],{72614:(he,Q,t)=>{t.d(Q,{u:()=>y});var e=t(74848),o=t(22803),U=t(96540),R=t(29675),E=t(45565),P=t(37e3),i=t(48583),h=t(44826),S=t(99764),W=t(74625),$=t(13005),D=t(35626);const v=500,d=u=>new Promise(n=>setTimeout(n,u)),p=1e3,y=({selectProps:u,showRefreshButton:n,selectedContactPointName:X})=>{const{selectedAlertmanager:A}=(0,$.VI)(),{contactPoints:L,isLoading:M,error:G,refetch:w}=(0,D.dK)({alertmanager:A}),[H,N]=(0,U.useState)(!1),ie=(0,R.of)(m),C=L.map(T=>({label:T.name,value:T,component:()=>(0,e.jsx)(E.E,{variant:"bodySmall",color:"secondary",children:(0,e.jsx)(W.yz,{receivers:T.grafana_managed_receiver_configs,limit:2})})})),se=(0,U.useMemo)(()=>C.find(T=>T.value?.name===X)||null,[C,X]),me=()=>{N(!0),Promise.all([w(),d(p)]).finally(()=>{N(!1)})};return G?(0,e.jsx)(P.F,{title:"Failed to fetch contact points",severity:"error"}):(0,e.jsxs)(i.B,{children:[(0,e.jsx)(h.l6,{virtualized:C.length>v,options:C,value:se,...u,isLoading:M}),n&&(0,e.jsx)(S.K,{name:"sync",onClick:me,"aria-label":"Refresh contact points",tooltip:"Refresh contact points list",className:(0,o.cx)(ie.refreshButton,{[ie.loading]:H||M})})]})},x=(0,o.keyframes)({from:{transform:"rotate(0deg)"},to:{transform:"rotate(720deg)"}}),m=u=>({refreshButton:(0,o.css)({color:u.colors.text.secondary,cursor:"pointer",borderRadius:u.shape.radius.circle,overflow:"hidden"}),loading:(0,o.css)({pointerEvents:"none",[u.transitions.handleMotion("no-preference")]:{animation:`${x} 2s infinite linear`},[u.transitions.handleMotion("reduce")]:{animation:`${x} 6s infinite linear`}})})},87896:(he,Q,t)=>{t.d(Q,{gv:()=>$});var e=t(74848),o=t(2543),U=t.n(o),R=t(32370),E=t(48583),P=t(54594),i=t(32266);const h=R.$.unifiedAlerting.minInterval??"10s",W=((D=h)=>{const d=[(0,i.M9)("10s"),(0,i.M9)("30s"),(0,i.M9)("1m"),(0,i.M9)("5m"),(0,i.M9)("10m"),(0,i.M9)("15m"),(0,i.M9)("30m"),(0,i.M9)("1h")],p=(0,i.P8)(D),y=d.filter(m=>p<=m),x=(0,o.times)(8-y.length,m=>{const u=(0,o.last)(y)??p,n=y.length===0?1:2;return u*n*(m+1)});return[...y,...x].map(i.an)})(h),$=({currentInterval:D,onSelect:v})=>(0,e.jsx)(E.B,{direction:"row",gap:.5,role:"listbox",children:W.map(d=>{const p=D===d;return(0,e.jsx)(P.$n,{role:"option","aria-selected":p,variant:p?"primary":"secondary",size:"sm",onClick:()=>v(d),children:d},d)})})},72302:(he,Q,t)=>{t.d(Q,{H$:()=>f,Ix:()=>Oe});var e=t(74848),o=t(22803),U=t(2543),R=t(96540),E=t(49785),P=t(58779),i=t(29675),h=t(48583),S=t(86489),W=t(44826),$=t(90231),D=t(45565),v=t(54594),d=t(29010),p=t(6736),y=t(79784),x=t(25356),m=t(40271),u=t(34128),n=t(11817),X=t(5240),A=t(27106),L=t(69064),M=t(82700),G=t(32266),w=t(79653),H=t(27219),N=t(40295),ie=t(87896),C=t(51876);const se=[{value:C.Q8.Alerting,label:"Alerting"},{value:C.Q8.NoData,label:"No Data"},{value:C.Q8.OK,label:"Normal"},{value:C.Q8.Error,label:"Error"},{value:C.Q8.KeepLast,label:"Keep Last State"}],me=({includeNoData:a,includeError:r,...l})=>{const s=(0,R.useMemo)(()=>a?r?se:se.filter(I=>I.value!==C.Q8.Error):se.filter(I=>I.value!==C.Q8.NoData),[a,r]);return(0,e.jsx)(W.l6,{options:s,...l})};var T=t(3538);function Me(a){const r=(0,G.P8)(a);return[0,r*1,r*2,r*3,r*4,r*5].map(G.an)}function Pe({selectedPendingPeriod:a,groupEvaluationInterval:r,onSelect:l}){const s=j=>a===j,I=Me(r);return(0,e.jsx)(h.B,{direction:"row",gap:.5,role:"listbox",children:I.map(j=>(0,e.jsx)(v.$n,{role:"option","aria-selected":s(j),variant:s(j)?"primary":"secondary",size:"sm",onClick:()=>{l(j)},children:j==="0s"?"None":j},j))})}var xe=t(16213);const Oe=10,Ce=1e3,Ne=a=>X.hK.endpoints.rulerNamespace.useQuery({namespace:a,rulerConfig:A.b},{refetchOnMountOrArgChange:!0,skip:!a}),De=(a,r)=>Object.values(a).flat().map(s=>{const I=Ge(s);return{label:s.name,value:s.name,description:s.interval??L.T6,isDisabled:r?!1:I,isProvisioned:I}}).sort(Ee),Ge=a=>a.rules.some(r=>(0,M.lT)(r)&&!!r.grafana_alert.provenance),Ee=(a,r)=>a.label?.localeCompare(r.label??"")||0,c=a=>({required:{value:!0,message:"Required."},validate:r=>{if(r==="0")return!0;try{const l=(0,G.M9)(r);if(l===0)return!0;try{const s=(0,G.M9)(a);return l>=s?!0:(0,n.t)("alerting.rule-form.evaluation-behaviour-for.validation","Pending period must be greater than or equal to the evaluation interval.")}catch{return!0}}catch(l){return l instanceof Error?l.message:(0,n.t)("alerting.rule-form.evaluation-behaviour-for.error-parsing","Failed to parse duration")}}});function f({existing:a,enableProvisionedGroups:r}){const l=(0,i.of)(B),[s,I]=(0,R.useState)(!1),{watch:j,setValue:K,getValues:Z,formState:{errors:_},control:ee}=(0,E.xW)(),[Y,F,ge,k,V]=j(["group","type","isPaused","folder","evaluateEvery"]),ve=(0,M.Mu)(F),te=(0,M.pq)(F),{currentData:ae,isLoading:fe}=Ne(k?.uid??""),q=(0,R.useMemo)(()=>ae?De(ae,r):[],[r,ae]),ue=Object.values(ae??{}).flat().find(O=>O.name===Y);(0,R.useEffect)(()=>{ue&&K("evaluateEvery",ue.interval??L.T6)},[ue,K]);const[ce,de]=(0,R.useState)(!1),je=(O,le)=>{K("group",O),K("evaluateEvery",le),de(!1)},ne=Y?{value:Y,label:Y}:void 0,Ie=te?(0,n.t)("alerting.rule-form.evaluation.pause.recording","Turn on to pause evaluation for this recording rule."):(0,n.t)("alerting.rule-form.evaluation.pause.alerting","Turn on to pause evaluation for this alert rule."),re=()=>de(!0),Re=(0,M.H2)(F)?4:3,ye=(0,M.H2)(F)&&!k?.uid?(0,n.t)("alerting.rule-form.evaluation.select-folder-before","Select a folder before setting evaluation group and interval"):(0,n.t)("alerting.rule-form.evaluation.evaluation-group-and-interval","Evaluation group and interval");return(0,e.jsxs)(xe.P,{stepNo:Re,title:"Set evaluation behavior",description:J(te),children:[(0,e.jsxs)(h.B,{direction:"column","justify-content":"flex-start","align-items":"flex-start",children:[(0,e.jsxs)(h.B,{alignItems:"center",children:[(0,e.jsx)("div",{style:{width:420},children:(0,e.jsx)(S.D,{label:ye,"data-testid":"group-picker",className:l.formInput,error:_.group?.message,invalid:!!_.group?.message,htmlFor:"group",children:(0,e.jsx)(E.xI,{render:({field:{ref:O,...le},fieldState:pe})=>(0,e.jsx)(W.l6,{disabled:!k?.uid||fe,inputId:"group",...le,onChange:oe=>{le.onChange(oe.label??"")},isLoading:fe,invalid:!!k?.uid&&!Y&&!!pe.error,cacheOptions:!0,loadingMessage:"Loading groups...",defaultValue:ne,options:q,getOptionLabel:oe=>(0,e.jsxs)("div",{children:[(0,e.jsx)("span",{children:oe.label}),oe.isProvisioned&&(0,e.jsxs)(e.Fragment,{children:[" ",(0,e.jsx)(H.rS,{})]})]}),placeholder:"Select an evaluation group..."},(0,U.uniqueId)()),name:"group",control:ee,rules:{required:{value:!0,message:"Must enter a group name"}}})})}),(0,e.jsxs)($.a,{gap:1,display:"flex",alignItems:"center",children:[(0,e.jsx)(D.E,{color:"secondary",children:"or"}),(0,e.jsx)(v.$n,{onClick:re,type:"button",icon:"plus",fill:"outline",variant:"secondary",disabled:!k?.uid,"data-testid":P.Tp.components.AlertRules.newEvaluationGroupButton,children:(0,e.jsx)(n.x6,{i18nKey:"alerting.rule-form.evaluation.new-group",children:"New evaluation group"})})]}),ce&&(0,e.jsx)(g,{onCreate:je,onClose:()=>de(!1),groupfoldersForGrafana:ae})]}),k?.title&&Y&&(0,e.jsx)("div",{className:l.evaluationContainer,children:(0,e.jsx)(h.B,{direction:"column",gap:0,children:(0,e.jsx)("div",{className:l.marginTop,children:(0,e.jsx)(h.B,{direction:"column",gap:1,children:Z("group")&&Z("evaluateEvery")&&(0,e.jsxs)(n.x6,{i18nKey:"alerting.rule-form.evaluation.group-text",values:{evaluateEvery:V},children:["All rules in the selected group are evaluated every ",{evaluateEvery:V},"."]})})})})}),ve&&(0,e.jsx)(b,{evaluateEvery:V}),a&&(0,e.jsx)(S.D,{htmlFor:"pause-alert-switch",children:(0,e.jsx)(E.xI,{render:()=>(0,e.jsxs)(h.B,{gap:1,direction:"row",alignItems:"center",children:[(0,e.jsx)(d.d,{id:"pause-alert",onChange:O=>{K("isPaused",O.currentTarget.checked)},value:!!ge}),(0,e.jsxs)("label",{htmlFor:"pause-alert",className:l.switchLabel,children:[(0,e.jsx)(n.x6,{i18nKey:"alerting.rule-form.pause.label",children:"Pause evaluation"}),(0,e.jsx)(p.m,{placement:"top",content:Ie,theme:"info",children:(0,e.jsx)(y.I,{tabIndex:0,name:"info-circle",size:"sm",className:l.infoIcon})})]})]}),name:"isPaused"})})]}),ve&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(w.e,{isCollapsed:!s,onToggle:O=>I(!O),text:"Configure no data and error handling"}),s&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(z,{}),(0,e.jsx)(S.D,{htmlFor:"no-data-state-input",label:(0,n.t)("alerting.alert.state-no-data","Alert state if no data or all values are null"),children:(0,e.jsx)(E.xI,{render:({field:{onChange:O,ref:le,...pe}})=>(0,e.jsx)(me,{...pe,inputId:"no-data-state-input",width:42,includeNoData:!0,includeError:!1,onChange:oe=>O(oe?.value)}),name:"noDataState"})}),(0,e.jsx)(S.D,{htmlFor:"exec-err-state-input",label:(0,n.t)("alerting.alert.state-error-timeout","Alert state if execution error or timeout"),children:(0,e.jsx)(E.xI,{render:({field:{onChange:O,ref:le,...pe}})=>(0,e.jsx)(me,{...pe,inputId:"exec-err-state-input",width:42,includeNoData:!1,includeError:!0,onChange:oe=>O(oe?.value)}),name:"execErrState"})})]})]})]})}function g({onClose:a,onCreate:r,groupfoldersForGrafana:l}){const s=(0,i.of)(B),{watch:I}=(0,E.xW)(),j="eval-every-input",K="new-eval-group-name",[Z,_,ee]=I(["group","folder.title","type"]),Y=ee?(0,M.pq)(ee):!1,F=(0,E.mN)({defaultValues:{group:"",evaluateEvery:L.T6},mode:"onChange",shouldFocusError:!0}),{register:ge,handleSubmit:k,formState:V,setValue:ve,getValues:te,watch:ae}=F,fe=ae("evaluateEvery"),q=(l&&l[_]?.find(ne=>ne.name===Z)?.rules)??[],ue=()=>{r(te("group"),te("evaluateEvery"))},ce=()=>{a()},de=ne=>{ve("evaluateEvery",ne,{shouldValidate:!0})},je=Y?(0,n.t)("alerting.folderAndGroup.evaluation.modal.text.recording","Create a new evaluation group to use for this recording rule."):(0,n.t)("alerting.folderAndGroup.evaluation.modal.text.alerting","Create a new evaluation group to use for this alert rule.");return(0,e.jsxs)(x.a,{className:s.modal,isOpen:!0,title:"New evaluation group",onDismiss:ce,onClickBackdrop:ce,children:[(0,e.jsx)("div",{className:s.modalTitle,children:je}),(0,e.jsx)(E.Op,{...F,children:(0,e.jsxs)("form",{onSubmit:k(()=>ue()),children:[(0,e.jsx)(S.D,{label:(0,e.jsx)(m.J,{htmlFor:K,description:"A group evaluates all its rules over the same evaluation interval.",children:(0,e.jsx)(n.x6,{i18nKey:"alerting.rule-form.evaluation.group-name",children:"Evaluation group name"})}),error:V.errors.group?.message,invalid:!!V.errors.group,children:(0,e.jsx)(u.p,{"data-testid":P.Tp.components.AlertRules.newEvaluationGroupName,className:s.formInput,autoFocus:!0,id:K,placeholder:"Enter a name",...ge("group",{required:{value:!0,message:"Required."}})})}),(0,e.jsx)(S.D,{error:V.errors.evaluateEvery?.message,label:(0,e.jsx)(m.J,{htmlFor:j,description:"How often all rules in the group are evaluated.",children:(0,e.jsx)(n.x6,{i18nKey:"alerting.rule-form.evaluation.group.interval",children:"Evaluation interval"})}),invalid:!!V.errors.evaluateEvery,children:(0,e.jsx)(u.p,{"data-testid":P.Tp.components.AlertRules.newEvaluationGroupInterval,className:s.formInput,id:j,placeholder:L.T6,...ge("evaluateEvery",(0,N.iS)(q))})}),(0,e.jsx)(ie.gv,{currentInterval:fe,onSelect:de}),(0,e.jsxs)(x.a.ButtonRow,{children:[(0,e.jsx)(v.$n,{variant:"secondary",type:"button",onClick:ce,children:(0,e.jsx)(n.x6,{i18nKey:"alerting.rule-form.evaluation.group.cancel",children:"Cancel"})}),(0,e.jsx)(v.$n,{type:"submit",disabled:!V.isValid,"data-testid":P.Tp.components.AlertRules.newEvaluationGroupCreate,children:(0,e.jsx)(n.x6,{i18nKey:"alerting.rule-form.evaluation.group.create",children:"Create"})})]})]})})]})}function b({evaluateEvery:a}){const r=(0,i.of)(B),{register:l,formState:{errors:s},setValue:I,watch:j}=(0,E.xW)(),K="eval-for-input",Z=j("evaluateFor"),_=ee=>{I("evaluateFor",ee)};return(0,e.jsxs)(h.B,{direction:"column","justify-content":"flex-start","align-items":"flex-start",children:[(0,e.jsx)(S.D,{label:(0,e.jsx)(m.J,{htmlFor:K,description:'Period during which the threshold condition must be met to trigger an alert. Selecting "None" triggers the alert immediately once the condition is met.',children:(0,e.jsx)(n.x6,{i18nKey:"alerting.rule-form.evaluation-behaviour.pending-period",children:"Pending period"})}),className:r.inlineField,error:s.evaluateFor?.message,invalid:s.evaluateFor?.message?!0:void 0,validationMessageHorizontalOverflow:!0,children:(0,e.jsx)(u.p,{id:K,width:8,...l("evaluateFor",c(a))})}),(0,e.jsx)(Pe,{selectedPendingPeriod:Z,groupEvaluationInterval:a,onSelect:_})]})}function z(){return(0,e.jsxs)(h.B,{direction:"row",gap:.5,alignItems:"center",children:[(0,e.jsx)(D.E,{variant:"bodySmall",color:"secondary",children:(0,e.jsx)(n.x6,{i18nKey:"alerting.rule-form.evaluation-behaviour.info-help.text",children:"Define the alert behavior when the evaluation fails or the query returns no data."})}),(0,e.jsx)(T.G,{contentText:"These settings can help mitigate temporary data source issues, preventing alerts from unintentionally firing due to lack of data, errors, or timeouts.",externalLink:"https://grafana.com/docs/grafana/latest/alerting/alerting-rules/create-grafana-managed-rule/#configure-no-data-and-error-handling",linkText:"Read more about this option",title:"Configure no data and error handling"})]})}function J(a){return(0,e.jsxs)(h.B,{direction:"row",gap:.5,alignItems:"center",children:[(0,e.jsx)(D.E,{variant:"bodySmall",color:"secondary",children:a?(0,e.jsx)(n.x6,{i18nKey:"alerting.alert-recording-rule-form.evaluation-behaviour.description.text",children:"Define how the recording rule is evaluated."}):(0,e.jsx)(n.x6,{i18nKey:"alerting.rule-form.evaluation-behaviour.description.text",children:"Define how the alert rule is evaluated."})}),(0,e.jsx)(T.G,{contentText:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("p",{children:(0,e.jsx)(n.x6,{i18nKey:"alerting.rule-form.evaluation-behaviour-description1",children:"Evaluation groups are containers for evaluating alert and recording rules."})}),(0,e.jsx)("p",{children:(0,e.jsx)(n.x6,{i18nKey:"alerting.rule-form.evaluation-behaviour-description2",children:"An evaluation group defines an evaluation interval - how often a rule is evaluated. Alert rules within the same evaluation group are evaluated over the same evaluation interval."})}),(0,e.jsx)("p",{children:(0,e.jsx)(n.x6,{i18nKey:"alerting.rule-form.evaluation-behaviour-description3",children:"Pending period specifies how long the threshold condition must be met before the alert starts firing. This option helps prevent alerts from being triggered by temporary issues."})})]}),externalLink:"https://grafana.com/docs/grafana/latest/alerting/fundamentals/alert-rules/rule-evaluation/",linkText:"Read about evaluation and alert states",title:"Alert rule evaluation"})]})}const B=a=>({inlineField:(0,o.css)({marginBottom:0}),evaluationContainer:(0,o.css)({color:a.colors.text.secondary,maxWidth:`${a.breakpoints.values.sm}px`,fontSize:a.typography.size.sm}),infoIcon:(0,o.css)({marginLeft:"10px"}),marginTop:(0,o.css)({marginTop:a.spacing(1)}),switchLabel:(0,o.css)({color:a.colors.text.primary,cursor:"pointer",fontSize:a.typography.bodySmall.fontSize}),formInput:(0,o.css)({flexGrow:1}),modal:(0,o.css)({width:`${a.breakpoints.values.sm}px`}),modalTitle:(0,o.css)({color:a.colors.text.secondary,marginBottom:a.spacing(2)})})},40295:(he,Q,t)=>{t.d(Q,{dh:()=>De,iS:()=>Ne});var e=t(74848),o=t(22803),U=t(2543),R=t(96540),E=t(49785),P=t(66384),i=t(29675),h=t(25356),S=t(81876),W=t(48583),$=t(86489),D=t(40271),v=t(34128),d=t(54594),p=t(37e3),y=t(17687),x=t(11817),m=t(83394),u=t(5240),n=t(44873),X=t(25779),A=t(69064),L=t(48542),M=t(19165),G=t(88214),w=t(85651),H=t(82700),N=t(32266),ie=t(50585),C=t(32370);const se=()=>(0,e.jsxs)(p.F,{severity:"warning",title:"Global evaluation interval limit exceeded",children:["A minimum evaluation interval of ",(0,e.jsx)("strong",{children:C.$.unifiedAlerting.minInterval})," has been configured in Grafana.",(0,e.jsx)("br",{}),"Please contact the administrator to configure a lower interval."]});var me=t(87896),T=t(72302);const Me=u.hK.endpoints.getRuleGroupForNamespace.useQuery,Pe=10;function xe({message:c,error:f}){return f?(0,e.jsx)(P.E,{color:"red",icon:"exclamation-circle",text:"Error",tooltip:c}):(0,e.jsx)(P.E,{color:"orange",icon:"exclamation-triangle",text:"Unknown",tooltip:c})}const Oe=c=>{try{const f=(0,N.M9)(c);return!(f<T.Ix*1e3||f%(T.Ix*1e3)!==0)}catch{return!1}},Ce=({rulesWithoutRecordingRules:c})=>{const f=(0,i.of)(Ee),{watch:g}=(0,E.xW)(),b=g("groupInterval"),z=!b,J=c.slice().map((a,r)=>({id:r,data:(0,H.jg)(a,b)})).sort((a,r)=>(0,N.P8)(a.data.forDuration??"")-(0,N.P8)(r.data.forDuration??"")),B=(0,R.useMemo)(()=>[{id:"alertName",label:"Alert",renderCell:({data:{alertName:a}})=>(0,e.jsx)(e.Fragment,{children:a}),size:"330px"},{id:"for",label:"Pending period",renderCell:({data:{forDuration:a}})=>(0,e.jsx)(e.Fragment,{children:a}),size:.5},{id:"numberEvaluations",label:"#Eval",renderCell:({data:{evaluationsToFire:a}})=>z?(0,e.jsx)(xe,{message:"#Evaluations not available."}):Oe(b)?a===0?(0,e.jsx)(xe,{message:"Invalid 'For' value: it should be greater or equal to evaluation interval.",error:!0}):(0,e.jsx)(e.Fragment,{children:a}):(0,e.jsx)(xe,{message:"Invalid evaluation interval format",error:!0}),size:.4}],[b,z]);return(0,e.jsx)("div",{className:f.tableWrapper,children:(0,e.jsx)(ie.E,{items:J,cols:B,pagination:{itemsPerPage:Pe}})})},Ne=c=>({required:{value:!0,message:"Required."},validate:f=>{try{const g=(0,N.M9)(f);if(g<T.Ix*1e3)return`Cannot be less than ${T.Ix} seconds.`;if(g%(T.Ix*1e3)!==0)return`Must be a multiple of ${T.Ix} seconds.`;if((0,L.uQ)(c,f).length===0)return!0;{const b=c.map(J=>{const{forDuration:B}=(0,H.jg)(J,f);return B?(0,N.P8)(B):null}),z=Math.min(...b.filter(J=>J!==null));return`Evaluation interval should be smaller or equal to "pending period" values for existing rules in this rule group. Choose a value smaller than or equal to "${(0,N.an)(z)}".`}}catch(g){return g instanceof Error?g.message:"Failed to parse duration"}}});function De(c){const{ruleGroupIdentifier:f,rulerConfig:g,intervalEditOnly:b,onClose:z}=c,B=f.dataSourceName===G.hY,a=b||B?"Edit evaluation group":"Edit namespace or evaluation group",r=(0,i.of)(Ee),{data:l,error:s,isLoading:I}=Me({group:f.groupName,namespace:f.namespaceName,rulerConfig:g}),j=(0,x.t)("alerting.common.loading","Loading...");return(0,e.jsxs)(h.a,{className:r.modal,isOpen:!0,title:a,onDismiss:z,onClickBackdrop:z,children:[I&&(0,e.jsx)(S._,{text:j}),s?(0,w.JZ)(s):null,l&&(0,e.jsx)(Ge,{...c,ruleGroup:l})]})}function Ge(c){const{ruleGroup:f,ruleGroupIdentifier:g,folderTitle:b,onClose:z,intervalEditOnly:J}=c,B=(0,i.of)(Ee),a=(0,y._2)(),[r,l]=(0,n.iG)(),[s,I]=(0,n.xt)(),[j,K]=(0,n.Ot)(),{loading:Z,error:_}=(0,X.Gz)(l,K,I),ee=(0,R.useMemo)(()=>({namespaceName:g.namespaceName,groupName:g.groupName,groupInterval:f?.interval??A.T6}),[f?.interval,g.groupName,g.namespaceName]),Y=g.dataSourceName,F=Y===G.hY,ge=F?"Folder":"Namespace",k=async re=>{const Re=re.namespaceName,ye=re.groupName,O=re.groupInterval,le=F?!1:Re!==g.namespaceName,pe=ye!==g.groupName;try{le?await j.execute(g,Re,ye,O):pe?await s.execute(g,ye,O):await r.execute(g,O),z(!0),await(0,m.JD)((0,L.eB)({rulesSourceName:Y}))}catch{}},V=(0,E.mN)({mode:"onBlur",defaultValues:ee,shouldFocusError:!0}),{handleSubmit:ve,register:te,watch:ae,formState:{isDirty:fe,errors:q,isValid:ue},setValue:ce,getValues:de}=V,je=()=>{a.error("There are errors in the form. Correct the errors and retry.")},ne=(0,U.compact)(f?.rules.filter(re=>!(0,H.UL)(re))),Ie=ne.length>0;return(0,e.jsx)(E.Op,{...V,children:(0,e.jsx)("form",{onSubmit:ve(k,je),children:(0,e.jsxs)(e.Fragment,{children:[!c.hideFolder&&(0,e.jsxs)(W.B,{gap:1,alignItems:"center",children:[(0,e.jsx)($.D,{className:B.formInput,label:(0,e.jsx)(D.J,{htmlFor:"namespaceName",description:!F&&"Change the current namespace name. Moving groups between namespaces is not supported",children:ge}),invalid:q.namespaceName?!0:void 0,error:q.namespaceName?.message,children:(0,e.jsx)(v.p,{id:"namespaceName",readOnly:J||F,value:b,...te("namespaceName",{required:"Namespace name is required."})})}),F&&c.folderUrl&&(0,e.jsx)(d.z9,{href:c.folderUrl,title:"Go to folder",variant:"secondary",icon:"folder-open",target:"_blank"})]}),(0,e.jsx)($.D,{label:(0,e.jsx)(D.J,{htmlFor:"groupName",description:"A group evaluates all its rules over the same evaluation interval.",children:"Evaluation group"}),invalid:!!q.groupName,error:q.groupName?.message,children:(0,e.jsx)(v.p,{autoFocus:!0,id:"groupName",readOnly:J,...te("groupName",{required:"Evaluation group name is required."})})}),(0,e.jsx)($.D,{label:(0,e.jsx)(D.J,{htmlFor:"groupInterval",description:"How often is the rule evaluated. Applies to every rule within the group.",children:(0,e.jsx)(W.B,{gap:.5,children:"Evaluation interval"})}),invalid:q.groupInterval?!0:void 0,error:q.groupInterval?.message,children:(0,e.jsxs)(W.B,{direction:"column",children:[(0,e.jsx)(v.p,{id:"groupInterval",placeholder:A.T6,...te("groupInterval",Ne(ne))}),(0,e.jsx)(me.gv,{currentInterval:de("groupInterval"),onSelect:re=>ce("groupInterval",re,{shouldValidate:!0,shouldDirty:!0})})]})}),F&&(0,M.qf)(ae("groupInterval")).exceedsLimit&&(0,e.jsx)(se,{}),!Ie&&(0,e.jsx)("div",{children:"This group does not contain alert rules."}),Ie&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{children:"List of rules that belong to this group"}),(0,e.jsx)("div",{className:B.evalRequiredLabel,children:"#Eval column represents the number of evaluations needed before alert starts firing."}),(0,e.jsx)(Ce,{rulesWithoutRecordingRules:ne})]}),_&&(0,e.jsx)(p.F,{title:"Failed to update rule group",children:(0,w.JZ)(_)}),(0,e.jsx)("div",{className:B.modalButtons,children:(0,e.jsxs)(h.a.ButtonRow,{children:[(0,e.jsx)(d.$n,{variant:"secondary",type:"button",disabled:Z,onClick:()=>z(!1),fill:"outline",children:(0,e.jsx)(x.x6,{i18nKey:"alerting.common.cancel",children:"Cancel"})}),(0,e.jsx)(d.$n,{type:"submit",disabled:!fe||!ue||Z,children:Z?"Saving...":"Save"})]})})]})},JSON.stringify(ee))})}const Ee=c=>({modal:(0,o.css)({maxWidth:"560px"}),modalButtons:(0,o.css)({top:"-24px",position:"relative"}),formInput:(0,o.css)({flex:1}),tableWrapper:(0,o.css)({marginTop:c.spacing(2),marginBottom:c.spacing(2),height:"100%"}),evalRequiredLabel:(0,o.css)({fontSize:c.typography.bodySmall.fontSize})})},44873:(he,Q,t)=>{t.d(Q,{Ot:()=>W,iG:()=>S,ts:()=>D,xt:()=>$});var e=t(11817),o=t(5240),U=t(75764),R=t(76206),E=t(88214),P=t(25779),i=t(10372);const h=()=>(0,e.t)("alerting.rule-groups.update.success","Successfully updated rule group");function S(){const[v]=(0,i.D)(),[d]=o.hK.endpoints.upsertRuleGroupForNamespace.useMutation();return(0,P.Yb)(async(p,y)=>{const{namespaceName:x}=p,m=(0,R.lF)({interval:y}),{newRuleGroupDefinition:u,rulerConfig:n}=await v(p,m);return d({rulerConfig:n,namespace:x,payload:u,notificationOptions:{successMessage:h()}}).unwrap()})}function W(){const[v]=(0,i.D)(),[d]=o.hK.endpoints.getRuleGroupForNamespace.useLazyQuery(),[p]=o.hK.endpoints.upsertRuleGroupForNamespace.useMutation(),[y]=o.hK.endpoints.deleteRuleGroupFromNamespace.useMutation(),x=(0,e.t)("alerting.rule-groups.move.success","Successfully moved rule group");return(0,P.Yb)(async(m,u,n,X)=>{if((0,E.z2)(m.dataSourceName))throw new Error("Moving a Grafana-managed rule group to another folder is currently not supported.");const A=(0,R.fO)({newNamespaceName:u,groupName:n,interval:X}),{newRuleGroupDefinition:L,rulerConfig:M}=await v(m,A),G=m.namespaceName,w=A.payload.newNamespaceName,H=m.groupName,N=A.payload.groupName;if(N&&(!!N&&H!==N)&&(await d({rulerConfig:M,namespace:w,group:N,notificationOptions:{showErrorAlert:!1}}).unwrap().catch(U.R))?.rules?.length)throw new Error("Target group already has rules, merging rule groups is currently not supported.");return await p({rulerConfig:M,namespace:w,payload:L,notificationOptions:{successMessage:x}}).unwrap(),await y({rulerConfig:M,namespace:G,group:H,notificationOptions:{showSuccessAlert:!1}}).unwrap()})}function $(){const[v]=(0,i.D)(),[d]=o.hK.endpoints.getRuleGroupForNamespace.useLazyQuery(),[p]=o.hK.endpoints.upsertRuleGroupForNamespace.useMutation(),[y]=o.hK.endpoints.deleteRuleGroupFromNamespace.useMutation();return(0,P.Yb)(async(x,m,u)=>{const n=(0,R.KL)({groupName:m,interval:u}),{newRuleGroupDefinition:X,rulerConfig:A}=await v(x,n),L=x.groupName,M=n.payload.groupName,G=x.namespaceName,w=(0,e.t)("alerting.rule-groups.rename.success","Successfully renamed rule group");if((await d({rulerConfig:A,namespace:G,group:M,notificationOptions:{showErrorAlert:!1}}).unwrap().catch(U.R))?.rules?.length)throw new Error("Target group has existing rules, merging rule groups is currently not supported.");const N=await p({rulerConfig:A,namespace:G,payload:X,notificationOptions:{successMessage:w}}).unwrap();return await y({rulerConfig:A,namespace:G,group:L,notificationOptions:{showSuccessAlert:!1}}).unwrap(),N})}function D(){const[v]=(0,i.D)(),[d]=o.hK.endpoints.upsertRuleGroupForNamespace.useMutation();return(0,P.Yb)(async(p,y)=>{const{namespaceName:x}=p,m=(0,R.bw)({swaps:y}),{newRuleGroupDefinition:u,rulerConfig:n}=await v(p,m);return d({rulerConfig:n,namespace:x,payload:u,notificationOptions:{successMessage:h()}}).unwrap()})}},45246:(he,Q,t)=>{t.d(Q,{V:()=>U});var e=t(96540),o=t(96621);function U(){return(0,e.useMemo)(()=>(0,o.Q9)(),[])}}}]);

//# sourceMappingURL=6814.a0a1709c1f0436564f9a.js.map