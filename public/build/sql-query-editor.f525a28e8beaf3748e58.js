(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[168],{30801:(st,gr,D)=>{"use strict";D.r(gr),D.d(gr,{default:()=>SA});var we={};D.r(we),D.d(we,{applyToJS:()=>Du,cleanJSX:()=>Vu,deepEqual:()=>Bi,deepFreeze:()=>Vc,escapeRegExp:()=>Pc,getFirstDefined:()=>Mc,getLogger:()=>kc,getOpCardinality:()=>Cr,isDirtyJSX:()=>ii,isImmutable:()=>ga,isImmutableList:()=>qi,isJSX:()=>Nu,isJsonCompatible:()=>Nc,isJsonLogic:()=>tt,isObject:()=>Wi,logger:()=>On,mergeArraysSmart:()=>Hi,mergeCustomizerNoArrays:()=>Ic,omit:()=>vt,opDefKeysToOmit:()=>va,shallowCopy:()=>xc,shallowEqual:()=>ai,sleep:()=>Dc,toImmutableList:()=>wr,uuid:()=>Ve,widgetDefKeysToOmit:()=>Mn});var Je={};D.r(Je),D.d(Je,{getItemInListValues:()=>oi,getListValue:()=>Qi,getTitleInListValues:()=>Uc,getValueInListValues:()=>t0,listValuesToArray:()=>zc,makeCustomListValue:()=>Mu,mapListValues:()=>$u,searchListValue:()=>n0,toListValue:()=>nn});var or={};D.r(or),D.d(or,{_fixImmutableValue:()=>qu,expandTreePath:()=>Z,expandTreeSubpath:()=>Gu,fixEmptyGroupsInTree:()=>Xi,fixPathsInTree:()=>kt,getAncestorRuleGroups:()=>zu,getFlatTree:()=>Uu,getItemByPath:()=>Sn,getLightTree:()=>Bc,getSwitchValues:()=>qc,getTotalReordableNodesCountInTree:()=>a0,getTotalRulesCountInTree:()=>Zi,hasChildren:()=>Bu,immutableToJs:()=>Du,isEmptyTree:()=>Wu,isImmutable:()=>ga,jsToImmutable:()=>ui,removeIsLockedInTree:()=>Wc,toImmutableList:()=>wr});var ee={};D.r(ee),D.d(ee,{SqlString:()=>_n,mongoEmptyValue:()=>ud,spelEscape:()=>ya,spelFixList:()=>sd,spelFormatConcat:()=>x0,spelImportConcat:()=>P0,sqlEmptyValue:()=>od,stringifyForDisplay:()=>ld,wrapWithBrackets:()=>cd});var Ye={};D.r(Ye),D.d(Ye,{_loadFromJsonLogic:()=>td,_loadFromSpel:()=>Ld,getTree:()=>i0,isImmutableTree:()=>Hc,isJsonLogic:()=>tt,isTree:()=>Jc,jsToImmutable:()=>ui,loadFromJsonLogic:()=>f0,loadFromSpel:()=>W0,loadTree:()=>Hu});var B={};D.r(B),D.d(B,{createListFromArray:()=>kd,createListWithOneElement:()=>ib,defaultConjunction:()=>Cn,defaultGroupConjunction:()=>an,defaultGroupProperties:()=>wn,defaultItemProperties:()=>Vd,defaultOperatorOptions:()=>fi,defaultRoot:()=>ab,defaultRule:()=>Nd,defaultRuleProperties:()=>Yt,emptyProperties:()=>ob,getDefaultField:()=>Id,getDefaultFieldSrc:()=>Zu,getDefaultOperator:()=>es,getDefaultSubField:()=>Dd});var H={};D.r(H),D.d(H,{_validateTree:()=>hi,checkTree:()=>zf,getNewValueForFieldOp:()=>$n,getTreeBadFields:()=>Gf,isValidTree:()=>$f,sanitizeTree:()=>Wf,translateValidation:()=>Mt,validateAndFixTree:()=>Bf,validateRange:()=>cs,validateTree:()=>Uf,validateValue:()=>Fa});var le={};D.r(le),D.d(le,{completeFuncValue:()=>Yf,getCompatibleArgsOnFuncChange:()=>Zf,setArgValue:()=>fs,setArgValueSrc:()=>Xf,setFunc:()=>Kf,setFuncDefaultArg:()=>uo});var te={};D.r(te),D.d(te,{calculateValueType:()=>rp,completeValue:()=>zn,filterValueSourcesForField:()=>Gn,formatFieldName:()=>un,getFieldPartsConfigs:()=>tp,getFieldPathLabels:()=>mi,getFirstOperator:()=>ps,getFuncPathLabels:()=>Bb,getOneChildOrDescendant:()=>bs,getOperatorsForField:()=>lo,getOperatorsForType:()=>ep,getValueLabel:()=>qb,getValueSourcesForFieldOp:()=>np,getWidgetForFieldOp:()=>nr,getWidgetsForFieldOp:()=>Hb,isEmptyGroupChildren:()=>hs,isEmptyItem:()=>gs,isEmptyRuleGroupExtPropertiesAndChildren:()=>ap,isEmptyRuleProperties:()=>ms,selectTypes:()=>so,whatRulePropertiesAreCompleted:()=>ys});var re={};D.r(re),D.d(re,{_getFromConfigCache:()=>mo,_saveToConfigCache:()=>yo,_widgetDefKeysToOmit:()=>CO,applyJsonLogic:()=>rO,cleanJSX:()=>Vu,compileConfig:()=>yp,compressConfig:()=>hp,configKeys:()=>Qt,createConfigMemo:()=>Cp,decompressConfig:()=>mp,extendConfig:()=>gt,findExtendedConfigInAllMemos:()=>_p,getCommonMemo:()=>Fp,getFieldConfig:()=>oe,getFieldId:()=>ho,getFieldParts:()=>mr,getFieldPath:()=>Xt,getFieldPathParts:()=>wO,getFieldRawConfig:()=>$t,getFieldSrc:()=>xp,getFieldWidgetConfig:()=>Hr,getFirstField:()=>Pp,getFuncArgConfig:()=>As,getFuncConfig:()=>Ar,getFuncSignature:()=>ws,getOperatorConfig:()=>Ie,isDirtyJSX:()=>ii,isFieldDescendantOfField:()=>Rp,isJSX:()=>Nu,iterateFields:()=>jp,iterateFuncs:()=>Aa,normalizeField:()=>go});var Re={};D.r(Re),D.d(Re,{_mongodbFormat:()=>Kp,_spelFormat:()=>hd,_sqlFormat:()=>rv,elasticSearchFormat:()=>sv,jsonLogicFormat:()=>jO,mongodbFormat:()=>VO,queryBuilderFormat:()=>AO,queryString:()=>Ud,spelFormat:()=>V0,sqlFormat:()=>zO});var Fe={};D.r(Fe),D.d(Fe,{fixListValuesGroupOrder:()=>fS,getListValue:()=>Qi,listValueToOption:()=>dS,mergeListValues:()=>sS,optionToListValue:()=>lS,optionsToListValues:()=>cS,simulateAsyncFetch:()=>uS});var me={};D.r(me),D.d(me,{Autocomplete:()=>Fe,ConfigUtils:()=>re,DefaultUtils:()=>B,ExportUtils:()=>ee,FuncUtils:()=>le,ListUtils:()=>Je,OtherUtils:()=>we,RuleUtils:()=>te,TreeUtils:()=>or,Validation:()=>H,checkTree:()=>zf,clone:()=>At(),compressConfig:()=>hp,decompressConfig:()=>mp,getSwitchValues:()=>qc,i18n:()=>Nb,isValidTree:()=>$f,moment:()=>ha(),sanitizeTree:()=>Wf,uuid:()=>Ve,validateAndFixTree:()=>Bf,validateTree:()=>Uf});var ur={};D.r(ur),D.d(ur,{LINEAR_REGRESSION:()=>mS,LOWER:()=>gS,NOW:()=>pS,RELATIVE_DATETIME:()=>vS,UPPER:()=>hS});var jr={};D.r(jr),D.d(jr,{addCaseGroup:()=>nF,addDefaultCaseGroup:()=>tF,addGroup:()=>aF,addRule:()=>eF,moveItem:()=>oF,removeGroup:()=>iF,removeRule:()=>rF,setTree:()=>ZS});var sr={};D.r(sr),D.d(sr,{setConjunction:()=>uF,setLock:()=>lF,setNot:()=>sF});var hr={};D.r(hr),D.d(hr,{setField:()=>cF,setFieldSrc:()=>dF,setFuncValue:()=>gF,setOperator:()=>fF,setOperatorOption:()=>hF,setValue:()=>pF,setValueSrc:()=>vF});var cn={};D.r(cn),D.d(cn,{bindActionCreators:()=>og,isUsingLegacyReactDomRender:()=>ig,liteShouldComponentUpdate:()=>wo,pureShouldComponentUpdate:()=>La,useOnPropsChanged:()=>nt});var Kn={};D.r(Kn),D.d(Kn,{FuncWidget:()=>Qs,ValueFieldWidget:()=>Jh,VanillaBooleanWidget:()=>bw,VanillaButton:()=>Iw,VanillaButtonGroup:()=>Vw,VanillaConjs:()=>xw,VanillaDateTimeWidget:()=>Cw,VanillaDateWidget:()=>Fw,VanillaFieldSelect:()=>Rw,VanillaIcon:()=>Dw,VanillaMultiSelectWidget:()=>Aw,VanillaNumberWidget:()=>Tw,VanillaProvider:()=>$w,VanillaSelectWidget:()=>Lw,VanillaSliderWidget:()=>jw,VanillaSwitch:()=>kw,VanillaTextAreaWidget:()=>Sw,VanillaTextWidget:()=>Ow,VanillaTimeWidget:()=>_w,VanillaValueSources:()=>Nw,vanillaConfirm:()=>Mw});var dn={};D.r(dn),D.d(dn,{ProximityOperator:()=>al});var M=D(74848),C=D(96540),lt=D(16817),Or=D(41778),Qn=D(9968),hm=D(9114),fn=D(64327),mm=D(73287),ct=D(58779),ym=D(84523),bm=D(75686),Om=D(40263),Xn=D(32300),It=D(30048),mt=D(56276),Ai=D(29010),Ut=D(54594),sl=D(6736),ll=D(60641),jn=D(1815),kr=D(22803),pn=D(29675),No=D(25356),ko=D(79784);function Sm({isOpen:n,onCancel:e,onDiscard:t,onCopy:r}){const a=(0,C.useRef)(null),i=(0,pn.of)(Fm);return(0,C.useEffect)(()=>{n&&a.current?.focus()},[n]),(0,M.jsxs)(No.a,{title:(0,M.jsxs)("div",{className:i.modalHeaderTitle,children:[(0,M.jsx)(ko.I,{name:"exclamation-triangle",size:"lg"}),(0,M.jsx)("span",{className:i.titleText,children:"Warning"})]}),onDismiss:e,isOpen:n,children:[(0,M.jsx)("p",{children:"Builder mode does not display changes made in code. The query builder will display the last changes you made in builder mode."}),(0,M.jsx)("p",{children:"Do you want to copy your code to the clipboard?"}),(0,M.jsxs)(No.a.ButtonRow,{children:[(0,M.jsx)(Ut.$n,{type:"button",variant:"secondary",onClick:e,fill:"outline",children:"Cancel"}),(0,M.jsx)(Ut.$n,{variant:"destructive",type:"button",onClick:t,ref:a,children:"Discard code and switch"}),(0,M.jsx)(Ut.$n,{variant:"primary",onClick:r,children:"Copy code and switch"})]})]})}const Fm=n=>({titleText:(0,kr.css)({paddingLeft:n.spacing(2)}),modalHeaderTitle:(0,kr.css)({fontSize:n.typography.size.lg,float:"left",paddingTop:n.spacing(1),margin:n.spacing(0,2)})});var yt=D(44826),Mo=D(81647);const _m=({dataset:n,db:e,dialect:t,onChange:r,inputId:a,preconfiguredDataset:i})=>{const o=!!i||t==="postgres",u=(0,lt.A)(async()=>(0,Mo.C)()&&o?(r((0,jn.zL)(i)),[(0,jn.zL)(i)]):(n&&r((0,jn.zL)(n)),(await e.datasets()).map(jn.zL)),[]);return(0,C.useEffect)(()=>{(0,Mo.C)()||(n?u.value&&u.value.find(s=>s.value===n)===void 0&&u.value.length>0&&r(u.value[0]):u.value&&u.value[0]&&r(u.value[0]))},[u.value,r,n]),(0,M.jsx)(yt.l6,{"aria-label":"Dataset selector",inputId:a,value:n,options:u.value,onChange:r,disabled:u.loading,isLoading:u.loading,menuShouldPortal:!0})};var Rn=D(35095);const Cm=({db:n,dataset:e,table:t,className:r,onChange:a,inputId:i})=>{const o=(0,lt.A)(async()=>e?(await n.tables(e)).map(Rn.z):[],[e]);return(0,M.jsx)(yt.l6,{className:r,disabled:o.loading,"aria-label":"Table selector",inputId:i,"data-testid":ct.Tp.components.SQLQueryEditor.headerTableSelector,value:t,options:o.value,onChange:a,isLoading:o.loading,menuShouldPortal:!0,placeholder:o.loading?"Loading tables":"Select table"})},wm=[{label:"Builder",value:Or.lX.Builder},{label:"Code",value:Or.lX.Code}];function Am({db:n,dialect:e,isQueryRunnable:t,onChange:r,onQueryRowChange:a,onRunQuery:i,preconfiguredDataset:o,query:u,queryRowFilter:s}){const{editorMode:l}=u,[c,d]=(0,mm.A)(),[f,p]=(0,C.useState)(!1),v=n.toRawSql,g=(0,C.useId)(),h=(0,C.useCallback)(S=>{if(S===Or.lX.Code&&(0,mt.rR)("grafana_sql_editor_mode_changed",{datasource:u.datasource?.type,selectedEditorMode:Or.lX.Code}),l===Or.lX.Code){p(!0);return}r({...u,editorMode:S})},[l,r,u]),y=S=>{const F={...u,format:S.value!==void 0?S.value:jn.gv.Table};(0,mt.rR)("grafana_sql_format_changed",{datasource:u.datasource?.type,selectedFormat:F.format}),r(F)},m=S=>{if(S.value===u.dataset)return;const F={...u,dataset:S.value,table:void 0,sql:void 0,rawSql:""};r(F)},b=S=>{if(S.value===u.table)return;const F={...u,table:S.value,sql:void 0,rawSql:""};r(F)},O=()=>!(e==="influx"||!(0,Mo.C)()&&e==="postgres");return(0,M.jsxs)(M.Fragment,{children:[(0,M.jsxs)(ym.X,{children:[(0,M.jsx)(bm.W,{label:"Format",value:u.format,placeholder:"Select format",menuShouldPortal:!0,onChange:y,options:jn.cO}),l===Or.lX.Builder&&(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)(Ai.K,{id:`sql-filter-${g}`,label:"Filter","data-testid":ct.Tp.components.SQLQueryEditor.headerFilterSwitch,transparent:!0,showLabel:!0,value:s.filter,onChange:S=>{S.target instanceof HTMLInputElement&&((0,mt.rR)("grafana_sql_filter_toggled",{datasource:u.datasource?.type,displayed:S.target.checked}),a({...s,filter:S.target.checked}))}}),(0,M.jsx)(Ai.K,{id:`sql-group-${g}`,label:"Group","data-testid":ct.Tp.components.SQLQueryEditor.headerGroupSwitch,transparent:!0,showLabel:!0,value:s.group,onChange:S=>{S.target instanceof HTMLInputElement&&((0,mt.rR)("grafana_sql_group_toggled",{datasource:u.datasource?.type,displayed:S.target.checked}),a({...s,group:S.target.checked}))}}),(0,M.jsx)(Ai.K,{id:`sql-order-${g}`,label:"Order","data-testid":ct.Tp.components.SQLQueryEditor.headerOrderSwitch,transparent:!0,showLabel:!0,value:s.order,onChange:S=>{S.target instanceof HTMLInputElement&&((0,mt.rR)("grafana_sql_order_toggled",{datasource:u.datasource?.type,displayed:S.target.checked}),a({...s,order:S.target.checked}))}}),(0,M.jsx)(Ai.K,{id:`sql-preview-${g}`,label:"Preview","data-testid":ct.Tp.components.SQLQueryEditor.headerPreviewSwitch,transparent:!0,showLabel:!0,value:s.preview,onChange:S=>{S.target instanceof HTMLInputElement&&((0,mt.rR)("grafana_sql_preview_toggled",{datasource:u.datasource?.type,displayed:S.target.checked}),a({...s,preview:S.target.checked}))}})]}),(0,M.jsx)(Om.Z,{grow:1}),t?(0,M.jsx)(Ut.$n,{icon:"play",variant:"primary",size:"sm",onClick:()=>i(),children:"Run query"}):(0,M.jsx)(sl.m,{theme:"error",content:(0,M.jsxs)(M.Fragment,{children:["Your query is invalid. Check below for details. ",(0,M.jsx)("br",{}),"However, you can still run this query."]}),placement:"top",children:(0,M.jsx)(Ut.$n,{icon:"exclamation-triangle",variant:"secondary",size:"sm",onClick:()=>i(),children:"Run query"})}),(0,M.jsx)(ll.z,{options:wm,size:"sm",value:l,onChange:h}),(0,M.jsx)(Sm,{isOpen:f,onCopy:()=>{(0,mt.rR)("grafana_sql_editor_mode_changed",{datasource:u.datasource?.type,selectedEditorMode:Or.lX.Builder,type:"copy"}),p(!1),d(u.rawSql),r({...u,rawSql:v(u),editorMode:Or.lX.Builder})},onDiscard:()=>{(0,mt.rR)("grafana_sql_editor_mode_changed",{datasource:u.datasource?.type,selectedEditorMode:Or.lX.Builder,type:"discard"}),p(!1),r({...u,rawSql:v(u),editorMode:Or.lX.Builder})},onCancel:()=>{(0,mt.rR)("grafana_sql_editor_mode_changed",{datasource:u.datasource?.type,selectedEditorMode:Or.lX.Builder,type:"cancel"}),p(!1)}})]}),l===Or.lX.Builder&&(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)(Qn.$,{v:.5}),(0,M.jsxs)(Xn.U,{children:[O()&&(0,M.jsx)(It.c,{label:"Dataset",width:25,children:(0,M.jsx)(_m,{db:n,inputId:`sql-dataset-${g}`,dataset:u.dataset,dialect:e,preconfiguredDataset:o,onChange:m})}),(0,M.jsx)(It.c,{label:"Table",width:25,children:(0,M.jsx)(Cm,{db:n,inputId:`sql-tableselect-${g}`,dataset:u.dataset||o,table:u.table,onChange:b})})]})]})]})}var cl=D(49185),Em=D(70713),Lm=D(84467);function Tm({children:n,onChange:e,query:t,width:r,height:a,editorLanguageDefinition:i}){const o=(0,C.useRef)(t);(0,C.useEffect)(()=>{o.current=t},[t]);const u=(0,C.useCallback)((s,l)=>{const c={...o.current,rawQuery:!0,rawSql:s};e(c,l)},[e]);return(0,M.jsx)(Lm.Y,{width:r,height:a,query:t.rawSql,onChange:u,language:i,children:n})}var jm=D(19550),dl=D(99764),Rm=D(41053),xm=D(75198),fl=D(59141),Pm=D(20968);function Im({db:n,query:e,onValidate:t,range:r}){const[a,i]=(0,C.useState)(),o=(0,pn.$j)(),u=(0,C.useMemo)(()=>(0,fl.j_)("bytes"),[]),s=(0,C.useMemo)(()=>({error:(0,kr.css)({color:o.colors.error.text,fontSize:o.typography.bodySmall.fontSize,fontFamily:o.typography.fontFamilyMonospace}),valid:(0,kr.css)({color:o.colors.success.text}),info:(0,kr.css)({color:o.colors.text.secondary})}),[o]),[l,c]=(0,Rm.A)(async f=>f.rawSql?.trim()===""?null:await n.validateQuery(f,r),[n]),[,]=(0,xm.A)(async()=>{const f=await c(e);return f&&i(f),null},1e3,[e,c]);if((0,C.useEffect)(()=>{a?.isError&&t(!1),a?.isValid&&t(!0)},[a,t]),!l.value&&!l.loading)return null;const d=l.value?.error?Dm(l.value.error):"";return(0,M.jsxs)(M.Fragment,{children:[l.loading&&(0,M.jsxs)("div",{className:s.info,children:[(0,M.jsx)(Pm.y,{inline:!0,size:"xs"})," Validating query..."]}),!l.loading&&l.value&&(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)(M.Fragment,{children:l.value.isValid&&l.value.statistics&&(0,M.jsxs)("div",{className:s.valid,children:[(0,M.jsx)(ko.I,{name:"check"})," This query will process"," ",(0,M.jsx)("strong",{children:(0,fl.cN)(u(l.value.statistics.TotalBytesProcessed))})," ","when run."]})}),(0,M.jsx)(M.Fragment,{children:l.value.isError&&(0,M.jsx)("div",{className:s.error,children:d})})]})]})}function Dm(n){const e=n.split(":");return e.length>2?e.slice(2).join(":"):n}function pl({showTools:n,onFormatCode:e,onExpand:t,isExpanded:r,...a}){const i=(0,pn.$j)(),[o,u]=(0,C.useState)(),s=(0,C.useMemo)(()=>({container:(0,kr.css)({border:`1px solid ${i.colors.border.medium}`,borderTop:"none",padding:i.spacing(.5,.5,.5,.5),display:"flex",flexGrow:1,justifyContent:"space-between",fontSize:i.typography.bodySmall.fontSize}),error:(0,kr.css)({color:i.colors.error.text,fontSize:i.typography.bodySmall.fontSize,fontFamily:i.typography.fontFamilyMonospace}),valid:(0,kr.css)({color:i.colors.success.text}),info:(0,kr.css)({color:i.colors.text.secondary}),hint:(0,kr.css)({color:i.colors.text.disabled,whiteSpace:"nowrap",cursor:"help"})}),[i]);let l={};return!n&&o===void 0&&(l={height:0,padding:0,visibility:"hidden"}),(0,M.jsxs)("div",{className:s.container,style:l,children:[(0,M.jsx)("div",{children:a.onValidate&&(0,M.jsx)(Im,{...a,onValidate:c=>{u(c),a.onValidate(c)}})}),n&&(0,M.jsx)("div",{children:(0,M.jsxs)(jm.Gy,{spacing:"sm",children:[e&&(0,M.jsx)(dl.K,{onClick:()=>{(0,mt.rR)("grafana_sql_query_formatted",{datasource:a.query.datasource?.type}),e()},name:"brackets-curly",size:"xs",tooltip:"Format query"}),t&&(0,M.jsx)(dl.K,{onClick:()=>{(0,mt.rR)("grafana_sql_editor_expand",{datasource:a.query.datasource?.type,expanded:!r}),t(!r)},name:r?"angle-up":"angle-down",size:"xs",tooltip:r?"Collapse editor":"Expand editor"}),(0,M.jsx)(sl.m,{content:"Hit CTRL/CMD+Return to run query",children:(0,M.jsx)(ko.I,{className:s.hint,name:"keyboard"})})]})})]})}function Vm({db:n,query:e,onChange:t,onRunQuery:r,onValidate:a,queryToValidate:i,range:o}){const u=(0,pn.$j)(),s=(0,pn.of)(Nm),[l,c]=(0,C.useState)(!1),[d,f]=(0,cl.A)(),[p,v]=(0,cl.A)(),g=(0,C.useMemo)(()=>n.getEditorLanguageDefinition(),[n]),h=(b,O)=>(0,M.jsx)(Tm,{editorLanguageDefinition:g,query:e,width:b,height:O?O-f.height:void 0,onChange:t,children:({formatQuery:S})=>(0,M.jsx)("div",{ref:d,children:(0,M.jsx)(pl,{db:n,query:i,onValidate:a,onFormatCode:S,showTools:!0,range:o,onExpand:c,isExpanded:l})})}),y=(b=!1)=>b?(0,M.jsx)(Em.default,{children:({width:O,height:S})=>h(O,S)}):(0,M.jsx)("div",{ref:p,children:h()}),m=()=>(0,M.jsx)("div",{style:{width:v.width,height:v.height,background:u.colors.background.primary,display:"flex",alignItems:"center",justifyContent:"center"},children:"Editing in expanded code editor"});return(0,M.jsxs)(M.Fragment,{children:[l?m():y(),l&&(0,M.jsx)(No.a,{title:`Query ${e.refId}`,closeOnBackdropClick:!1,closeOnEscape:!1,className:s.modal,contentClassName:s.modalContent,isOpen:l,onDismiss:()=>{(0,mt.rR)("grafana_sql_editor_expand",{datasource:e.datasource?.type,expanded:!1}),c(!1)},children:y(!0)})]})}function Nm(n){return{modal:(0,kr.css)({width:"95vw",height:"95vh"}),modalContent:(0,kr.css)({height:"100%",paddingTop:0})}}var km=D(1667),Mm=D(76313);function Ei({query:n,onQueryChange:e,db:t}){return{onSqlChange:(0,C.useCallback)(a=>{const i=t.toRawSql,o=i({sql:a,dataset:n.dataset,table:n.table,refId:n.refId}),u={...n,sql:a,rawSql:o};e(u)},[t,e,n])}}var $m=D(26774),vl=D(72500),Gm=D(20301);function zm({sql:n,columns:e,onSqlChange:t}){const r=(0,C.useCallback)(a=>{const i=a.map(u=>(0,fn.xG)(u.property?.name)),o={...n,groupBy:i};t(o)},[t,n]);return(0,M.jsx)($m.o,{items:n.groupBy,onChange:r,renderItem:Um({options:e})})}function Um({options:n}){return function(t,r,a){return(0,M.jsxs)(vl.M,{children:[(0,M.jsx)(yt.l6,{value:t.property?.name?(0,Rn.z)(t.property.name):null,"aria-label":"Group by",options:n,menuShouldPortal:!0,onChange:({value:i})=>i&&r((0,fn.xG)(i))}),(0,M.jsx)(Gm.Z,{title:"Remove group by column",icon:"times",variant:"secondary",onClick:a})]})}}function Wm({fields:n,query:e,onQueryChange:t,db:r}){const{onSqlChange:a}=Ei({query:e,onQueryChange:t,db:r});return(0,M.jsx)(zm,{columns:n,sql:e.sql,onSqlChange:a})}var Da=D(2543),Zn=D(34128);const Bm=[{description:"Sort by ascending",value:"ASC",icon:"sort-amount-up"},{description:"Sort by descending",value:"DESC",icon:"sort-amount-down"}];function qm({sql:n,onSqlChange:e,columns:t,showOffset:r}){const a=(0,C.useCallback)(s=>{const l={...n,orderByDirection:s};e(l)},[e,n]),i=(0,C.useCallback)(s=>{const l={...n,limit:Number.parseInt(s.currentTarget.value,10)};e(l)},[e,n]),o=(0,C.useCallback)(s=>{const l={...n,offset:Number.parseInt(s.currentTarget.value,10)};e(l)},[e,n]),u=(0,C.useCallback)(s=>{const l={...n,orderBy:(0,fn.Kj)(s?.value)};s===null&&(l.orderByDirection=void 0),e(l)},[e,n]);return(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)(It.c,{label:"Order by",width:25,children:(0,M.jsxs)(vl.M,{children:[(0,M.jsx)(yt.l6,{"aria-label":"Order by",options:t,value:n.orderBy?.property.name?(0,Rn.z)(n.orderBy.property.name):null,isClearable:!0,menuShouldPortal:!0,onChange:u}),(0,M.jsx)(Qn.$,{h:1.5}),(0,M.jsx)(ll.z,{options:Bm,disabled:!n?.orderBy?.property.name,value:n.orderByDirection,onChange:a})]})}),(0,M.jsx)(It.c,{label:"Limit",optional:!0,width:25,children:(0,M.jsx)(Zn.p,{type:"number",min:0,id:(0,Da.uniqueId)("limit-"),value:n.limit||"",onChange:i})}),r&&(0,M.jsx)(It.c,{label:"Offset",optional:!0,width:25,children:(0,M.jsx)(Zn.p,{type:"number",id:(0,Da.uniqueId)("offset-"),value:n.offset||"",onChange:o})})]})}function Hm({fields:n,query:e,onQueryChange:t,db:r}){const{onSqlChange:a}=Ei({query:e,onQueryChange:t,db:r});let i=[];return n&&(i=[{value:"",label:"Selected columns",options:e.sql?.columns?.map((u,s)=>{const l=u.name?`${u.name}(${u.parameters?.map(c=>c.name)})`:u.parameters?.map(c=>c.name);return{value:l,label:`${s+1} - ${l}`}}),expanded:!0},...n]),(0,M.jsx)(qm,{sql:e.sql,onSqlChange:a,columns:i})}var Jm=D(24705),Ym=D(39736),Ge=D(23029),ze=D(92901),qe=D(56822),ue=D(53954),Ue=D(85501),z=D(86848),ie=D(5544),Q=D(60436),We=D(82284),Va="delete",Ze=5,bt=1<<Ze,Qr=bt-1,xe={};function $o(){return{value:!1}}function Ot(n){n&&(n.value=!0)}function Go(){}function ea(n){return n.size===void 0&&(n.size=n.__iterate(gl)),n.size}function vn(n,e){if(typeof e!="number"){var t=e>>>0;if(""+t!==e||t===4294967295)return NaN;e=t}return e<0?ea(n)+e:e}function gl(){return!0}function Na(n,e,t){return(n===0&&!ml(n)||t!==void 0&&n<=-t)&&(e===void 0||t!==void 0&&e>=t)}function ra(n,e){return hl(n,e,0)}function ka(n,e){return hl(n,e,e)}function hl(n,e,t){return n===void 0?t:ml(n)?e===1/0?e:Math.max(0,e+n)|0:e===void 0||e===n?n:Math.min(e,n)|0}function ml(n){return n<0||n===0&&1/n===-1/0}var yl="@@__IMMUTABLE_ITERABLE__@@";function Xr(n){return!!(n&&n[yl])}var bl="@@__IMMUTABLE_KEYED__@@";function Ke(n){return!!(n&&n[bl])}var Ol="@@__IMMUTABLE_INDEXED__@@";function Ur(n){return!!(n&&n[Ol])}function Ma(n){return Ke(n)||Ur(n)}var dr=function(e){return Xr(e)?e:et(e)},St=function(n){function e(t){return Ke(t)?t:gn(t)}return n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e,e}(dr),xn=function(n){function e(t){return Ur(t)?t:wt(t)}return n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e,e}(dr),ta=function(n){function e(t){return Xr(t)&&!Ma(t)?t:ia(t)}return n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e,e}(dr);dr.Keyed=St,dr.Indexed=xn,dr.Set=ta;var Sl="@@__IMMUTABLE_SEQ__@@";function Li(n){return!!(n&&n[Sl])}var Fl="@@__IMMUTABLE_RECORD__@@";function Pn(n){return!!(n&&n[Fl])}function Ft(n){return Xr(n)||Pn(n)}var na="@@__IMMUTABLE_ORDERED__@@";function _t(n){return!!(n&&n[na])}var $a=0,Dt=1,Ct=2,zo=typeof Symbol=="function"&&Symbol.iterator,_l="@@iterator",Ti=zo||_l,Ne=function(e){this.next=e};Ne.prototype.toString=function(){return"[Iterator]"},Ne.KEYS=$a,Ne.VALUES=Dt,Ne.ENTRIES=Ct,Ne.prototype.inspect=Ne.prototype.toSource=function(){return this.toString()},Ne.prototype[Ti]=function(){return this};function er(n,e,t,r){var a=n===0?e:n===1?t:[e,t];return r?r.value=a:r={value:a,done:!1},r}function Zr(){return{value:void 0,done:!0}}function Uo(n){return Array.isArray(n)?!0:!!ji(n)}function Cl(n){return n&&typeof n.next=="function"}function Wo(n){var e=ji(n);return e&&e.call(n)}function ji(n){var e=n&&(zo&&n[zo]||n[_l]);if(typeof e=="function")return e}function Km(n){var e=ji(n);return e&&e===n.entries}function Qm(n){var e=ji(n);return e&&e===n.keys}var aa=Object.prototype.hasOwnProperty;function Bo(n){return Array.isArray(n)||typeof n=="string"?!0:n&&typeof n=="object"&&Number.isInteger(n.length)&&n.length>=0&&(n.length===0?Object.keys(n).length===1:n.hasOwnProperty(n.length-1))}var et=function(n){function e(t){return t==null?Ho():Ft(t)?t.toSeq():Zm(t)}return n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e,e.prototype.toSeq=function(){return this},e.prototype.toString=function(){return this.__toString("Seq {","}")},e.prototype.cacheResult=function(){return!this._cache&&this.__iterateUncached&&(this._cache=this.entrySeq().toArray(),this.size=this._cache.length),this},e.prototype.__iterate=function(r,a){var i=this._cache;if(i){for(var o=i.length,u=0;u!==o;){var s=i[a?o-++u:u++];if(r(s[1],s[0],this)===!1)break}return u}return this.__iterateUncached(r,a)},e.prototype.__iterator=function(r,a){var i=this._cache;if(i){var o=i.length,u=0;return new Ne(function(){if(u===o)return Zr();var s=i[a?o-++u:u++];return er(r,s[0],s[1])})}return this.__iteratorUncached(r,a)},e}(dr),gn=function(n){function e(t){return t==null?Ho().toKeyedSeq():Xr(t)?Ke(t)?t.toSeq():t.fromEntrySeq():Pn(t)?t.toSeq():Jo(t)}return n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e,e.prototype.toKeyedSeq=function(){return this},e}(et),wt=function(n){function e(t){return t==null?Ho():Xr(t)?Ke(t)?t.entrySeq():t.toIndexedSeq():Pn(t)?t.toSeq().entrySeq():Al(t)}return n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e,e.of=function(){return e(arguments)},e.prototype.toIndexedSeq=function(){return this},e.prototype.toString=function(){return this.__toString("Seq [","]")},e}(et),ia=function(n){function e(t){return(Xr(t)&&!Ma(t)?t:wt(t)).toSetSeq()}return n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e,e.of=function(){return e(arguments)},e.prototype.toSetSeq=function(){return this},e}(et);et.isSeq=Li,et.Keyed=gn,et.Set=ia,et.Indexed=wt,et.prototype[Sl]=!0;var In=function(n){function e(t){this._array=t,this.size=t.length}return n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e,e.prototype.get=function(r,a){return this.has(r)?this._array[vn(this,r)]:a},e.prototype.__iterate=function(r,a){for(var i=this._array,o=i.length,u=0;u!==o;){var s=a?o-++u:u++;if(r(i[s],s,this)===!1)break}return u},e.prototype.__iterator=function(r,a){var i=this._array,o=i.length,u=0;return new Ne(function(){if(u===o)return Zr();var s=a?o-++u:u++;return er(r,s,i[s])})},e}(wt),qo=function(n){function e(t){var r=Object.keys(t).concat(Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(t):[]);this._object=t,this._keys=r,this.size=r.length}return n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e,e.prototype.get=function(r,a){return a!==void 0&&!this.has(r)?a:this._object[r]},e.prototype.has=function(r){return aa.call(this._object,r)},e.prototype.__iterate=function(r,a){for(var i=this._object,o=this._keys,u=o.length,s=0;s!==u;){var l=o[a?u-++s:s++];if(r(i[l],l,this)===!1)break}return s},e.prototype.__iterator=function(r,a){var i=this._object,o=this._keys,u=o.length,s=0;return new Ne(function(){if(s===u)return Zr();var l=o[a?u-++s:s++];return er(r,l,i[l])})},e}(gn);qo.prototype[na]=!0;var Xm=function(n){function e(t){this._collection=t,this.size=t.length||t.size}return n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e,e.prototype.__iterateUncached=function(r,a){if(a)return this.cacheResult().__iterate(r,a);var i=this._collection,o=Wo(i),u=0;if(Cl(o))for(var s;!(s=o.next()).done&&r(s.value,u++,this)!==!1;);return u},e.prototype.__iteratorUncached=function(r,a){if(a)return this.cacheResult().__iterator(r,a);var i=this._collection,o=Wo(i);if(!Cl(o))return new Ne(Zr);var u=0;return new Ne(function(){var s=o.next();return s.done?s:er(r,u++,s.value)})},e}(wt),wl;function Ho(){return wl||(wl=new In([]))}function Jo(n){var e=Yo(n);if(e)return e.fromEntrySeq();if(typeof n=="object")return new qo(n);throw new TypeError("Expected Array or collection object of [k, v] entries, or keyed object: "+n)}function Al(n){var e=Yo(n);if(e)return e;throw new TypeError("Expected Array or collection object of values: "+n)}function Zm(n){var e=Yo(n);if(e)return Km(n)?e.fromEntrySeq():Qm(n)?e.toSetSeq():e;if(typeof n=="object")return new qo(n);throw new TypeError("Expected Array or collection object of values, or keyed object: "+n)}function Yo(n){return Bo(n)?new In(n):Uo(n)?new Xm(n):void 0}var El="@@__IMMUTABLE_MAP__@@";function Ri(n){return!!(n&&n[El])}function Ko(n){return Ri(n)&&_t(n)}function Qo(n){return!!(n&&typeof n.equals=="function"&&typeof n.hashCode=="function")}function Ir(n,e){if(n===e||n!==n&&e!==e)return!0;if(!n||!e)return!1;if(typeof n.valueOf=="function"&&typeof e.valueOf=="function"){if(n=n.valueOf(),e=e.valueOf(),n===e||n!==n&&e!==e)return!0;if(!n||!e)return!1}return!!(Qo(n)&&Qo(e)&&n.equals(e))}var Ga=typeof Math.imul=="function"&&Math.imul(4294967295,2)===-2?Math.imul:function(e,t){e|=0,t|=0;var r=e&65535,a=t&65535;return r*a+((e>>>16)*a+r*(t>>>16)<<16>>>0)|0};function xi(n){return n>>>1&1073741824|n&3221225471}var ey=Object.prototype.valueOf;function dt(n){if(n==null)return Ll(n);if(typeof n.hashCode=="function")return xi(n.hashCode(n));var e=oy(n);if(e==null)return Ll(e);switch(typeof e){case"boolean":return e?1108378657:1108378656;case"number":return ry(e);case"string":return e.length>uy?ty(e):Xo(e);case"object":case"function":return ay(e);case"symbol":return ny(e);default:if(typeof e.toString=="function")return Xo(e.toString());throw new Error("Value type "+typeof e+" cannot be hashed.")}}function Ll(n){return n===null?1108378658:1108378659}function ry(n){if(n!==n||n===1/0)return 0;var e=n|0;for(e!==n&&(e^=n*4294967295);n>4294967295;)n/=4294967295,e^=n;return xi(e)}function ty(n){var e=nu[n];return e===void 0&&(e=Xo(n),tu===sy&&(tu=0,nu={}),tu++,nu[n]=e),e}function Xo(n){for(var e=0,t=0;t<n.length;t++)e=31*e+n.charCodeAt(t)|0;return xi(e)}function ny(n){var e=xl[n];return e!==void 0||(e=Rl(),xl[n]=e),e}function ay(n){var e;if(Zo&&(e=eu.get(n),e!==void 0)||(e=n[Dn],e!==void 0)||!jl&&(e=n.propertyIsEnumerable&&n.propertyIsEnumerable[Dn],e!==void 0||(e=iy(n),e!==void 0)))return e;if(e=Rl(),Zo)eu.set(n,e);else{if(Tl!==void 0&&Tl(n)===!1)throw new Error("Non-extensible objects are not allowed as keys.");if(jl)Object.defineProperty(n,Dn,{enumerable:!1,configurable:!1,writable:!1,value:e});else if(n.propertyIsEnumerable!==void 0&&n.propertyIsEnumerable===n.constructor.prototype.propertyIsEnumerable)n.propertyIsEnumerable=function(){return this.constructor.prototype.propertyIsEnumerable.apply(this,arguments)},n.propertyIsEnumerable[Dn]=e;else if(n.nodeType!==void 0)n[Dn]=e;else throw new Error("Unable to set a non-enumerable property on object.")}return e}var Tl=Object.isExtensible,jl=function(){try{return Object.defineProperty({},"@",{}),!0}catch{return!1}}();function iy(n){if(n&&n.nodeType>0)switch(n.nodeType){case 1:return n.uniqueID;case 9:return n.documentElement&&n.documentElement.uniqueID}}function oy(n){return n.valueOf!==ey&&typeof n.valueOf=="function"?n.valueOf(n):n}function Rl(){var n=++ru;return ru&1073741824&&(ru=0),n}var Zo=typeof WeakMap=="function",eu;Zo&&(eu=new WeakMap);var xl=Object.create(null),ru=0,Dn="__immutablehash__";typeof Symbol=="function"&&(Dn=Symbol(Dn));var uy=16,sy=255,tu=0,nu={},Pi=function(n){function e(t,r){this._iter=t,this._useKeys=r,this.size=t.size}return n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e,e.prototype.get=function(r,a){return this._iter.get(r,a)},e.prototype.has=function(r){return this._iter.has(r)},e.prototype.valueSeq=function(){return this._iter.valueSeq()},e.prototype.reverse=function(){var r=this,a=au(this,!0);return this._useKeys||(a.valueSeq=function(){return r._iter.toSeq().reverse()}),a},e.prototype.map=function(r,a){var i=this,o=Nl(this,r,a);return this._useKeys||(o.valueSeq=function(){return i._iter.toSeq().map(r,a)}),o},e.prototype.__iterate=function(r,a){var i=this;return this._iter.__iterate(function(o,u){return r(o,u,i)},a)},e.prototype.__iterator=function(r,a){return this._iter.__iterator(r,a)},e}(gn);Pi.prototype[na]=!0;var Pl=function(n){function e(t){this._iter=t,this.size=t.size}return n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e,e.prototype.includes=function(r){return this._iter.includes(r)},e.prototype.__iterate=function(r,a){var i=this,o=0;return a&&ea(this),this._iter.__iterate(function(u){return r(u,a?i.size-++o:o++,i)},a)},e.prototype.__iterator=function(r,a){var i=this,o=this._iter.__iterator(Dt,a),u=0;return a&&ea(this),new Ne(function(){var s=o.next();return s.done?s:er(r,a?i.size-++u:u++,s.value,s)})},e}(wt),Il=function(n){function e(t){this._iter=t,this.size=t.size}return n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e,e.prototype.has=function(r){return this._iter.includes(r)},e.prototype.__iterate=function(r,a){var i=this;return this._iter.__iterate(function(o){return r(o,o,i)},a)},e.prototype.__iterator=function(r,a){var i=this._iter.__iterator(Dt,a);return new Ne(function(){var o=i.next();return o.done?o:er(r,o.value,o.value,o)})},e}(ia),Dl=function(n){function e(t){this._iter=t,this.size=t.size}return n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e,e.prototype.entrySeq=function(){return this._iter.toSeq()},e.prototype.__iterate=function(r,a){var i=this;return this._iter.__iterate(function(o){if(o){zl(o);var u=Xr(o);return r(u?o.get(1):o[1],u?o.get(0):o[0],i)}},a)},e.prototype.__iterator=function(r,a){var i=this._iter.__iterator(Dt,a);return new Ne(function(){for(;;){var o=i.next();if(o.done)return o;var u=o.value;if(u){zl(u);var s=Xr(u);return er(r,s?u.get(0):u[0],s?u.get(1):u[1],o)}}})},e}(gn);Pl.prototype.cacheResult=Pi.prototype.cacheResult=Il.prototype.cacheResult=Dl.prototype.cacheResult=uu;function Vl(n){var e=Wt(n);return e._iter=n,e.size=n.size,e.flip=function(){return n},e.reverse=function(){var t=n.reverse.apply(this);return t.flip=function(){return n.reverse()},t},e.has=function(t){return n.includes(t)},e.includes=function(t){return n.has(t)},e.cacheResult=uu,e.__iterateUncached=function(t,r){var a=this;return n.__iterate(function(i,o){return t(o,i,a)!==!1},r)},e.__iteratorUncached=function(t,r){if(t===Ct){var a=n.__iterator(t,r);return new Ne(function(){var i=a.next();if(!i.done){var o=i.value[0];i.value[0]=i.value[1],i.value[1]=o}return i})}return n.__iterator(t===Dt?$a:Dt,r)},e}function Nl(n,e,t){var r=Wt(n);return r.size=n.size,r.has=function(a){return n.has(a)},r.get=function(a,i){var o=n.get(a,xe);return o===xe?i:e.call(t,o,a,n)},r.__iterateUncached=function(a,i){var o=this;return n.__iterate(function(u,s,l){return a(e.call(t,u,s,l),s,o)!==!1},i)},r.__iteratorUncached=function(a,i){var o=n.__iterator(Ct,i);return new Ne(function(){var u=o.next();if(u.done)return u;var s=u.value,l=s[0];return er(a,l,e.call(t,s[1],l,n),u)})},r}function au(n,e){var t=this,r=Wt(n);return r._iter=n,r.size=n.size,r.reverse=function(){return n},n.flip&&(r.flip=function(){var a=Vl(n);return a.reverse=function(){return n.flip()},a}),r.get=function(a,i){return n.get(e?a:-1-a,i)},r.has=function(a){return n.has(e?a:-1-a)},r.includes=function(a){return n.includes(a)},r.cacheResult=uu,r.__iterate=function(a,i){var o=this,u=0;return i&&ea(n),n.__iterate(function(s,l){return a(s,e?l:i?o.size-++u:u++,o)},!i)},r.__iterator=function(a,i){var o=0;i&&ea(n);var u=n.__iterator(Ct,!i);return new Ne(function(){var s=u.next();if(s.done)return s;var l=s.value;return er(a,e?l[0]:i?t.size-++o:o++,l[1],s)})},r}function kl(n,e,t,r){var a=Wt(n);return r&&(a.has=function(i){var o=n.get(i,xe);return o!==xe&&!!e.call(t,o,i,n)},a.get=function(i,o){var u=n.get(i,xe);return u!==xe&&e.call(t,u,i,n)?u:o}),a.__iterateUncached=function(i,o){var u=this,s=0;return n.__iterate(function(l,c,d){if(e.call(t,l,c,d))return s++,i(l,r?c:s-1,u)},o),s},a.__iteratorUncached=function(i,o){var u=n.__iterator(Ct,o),s=0;return new Ne(function(){for(;;){var l=u.next();if(l.done)return l;var c=l.value,d=c[0],f=c[1];if(e.call(t,f,d,n))return er(i,r?d:s++,f,l)}})},a}function ly(n,e,t){var r=Qe().asMutable();return n.__iterate(function(a,i){r.update(e.call(t,a,i,n),0,function(o){return o+1})}),r.asImmutable()}function cy(n,e,t){var r=Ke(n),a=(_t(n)?qt():Qe()).asMutable();n.__iterate(function(o,u){a.update(e.call(t,o,u,n),function(s){return s=s||[],s.push(r?[u,o]:o),s})});var i=ou(n);return a.map(function(o){return He(n,i(o))}).asImmutable()}function dy(n,e,t){var r=Ke(n),a=[[],[]];n.__iterate(function(o,u){a[e.call(t,o,u,n)?1:0].push(r?[u,o]:o)});var i=ou(n);return a.map(function(o){return He(n,i(o))})}function iu(n,e,t,r){var a=n.size;if(Na(e,t,a))return n;if(typeof a>"u"&&(e<0||t<0))return iu(n.toSeq().cacheResult(),e,t,r);var i=ra(e,a),o=ka(t,a),u=o-i,s;u===u&&(s=u<0?0:u);var l=Wt(n);return l.size=s===0?s:n.size&&s||void 0,!r&&Li(n)&&s>=0&&(l.get=function(c,d){return c=vn(this,c),c>=0&&c<s?n.get(c+i,d):d}),l.__iterateUncached=function(c,d){var f=this;if(s===0)return 0;if(d)return this.cacheResult().__iterate(c,d);var p=0,v=!0,g=0;return n.__iterate(function(h,y){if(!(v&&(v=p++<i)))return g++,c(h,r?y:g-1,f)!==!1&&g!==s}),g},l.__iteratorUncached=function(c,d){if(s!==0&&d)return this.cacheResult().__iterator(c,d);if(s===0)return new Ne(Zr);var f=n.__iterator(c,d),p=0,v=0;return new Ne(function(){for(;p++<i;)f.next();if(++v>s)return Zr();var g=f.next();return r||c===Dt||g.done?g:c===$a?er(c,v-1,void 0,g):er(c,v-1,g.value[1],g)})},l}function fy(n,e,t){var r=Wt(n);return r.__iterateUncached=function(a,i){var o=this;if(i)return this.cacheResult().__iterate(a,i);var u=0;return n.__iterate(function(s,l,c){return e.call(t,s,l,c)&&++u&&a(s,l,o)}),u},r.__iteratorUncached=function(a,i){var o=this;if(i)return this.cacheResult().__iterator(a,i);var u=n.__iterator(Ct,i),s=!0;return new Ne(function(){if(!s)return Zr();var l=u.next();if(l.done)return l;var c=l.value,d=c[0],f=c[1];return e.call(t,f,d,o)?a===Ct?l:er(a,d,f,l):(s=!1,Zr())})},r}function Ml(n,e,t,r){var a=Wt(n);return a.__iterateUncached=function(i,o){var u=this;if(o)return this.cacheResult().__iterate(i,o);var s=!0,l=0;return n.__iterate(function(c,d,f){if(!(s&&(s=e.call(t,c,d,f))))return l++,i(c,r?d:l-1,u)}),l},a.__iteratorUncached=function(i,o){var u=this;if(o)return this.cacheResult().__iterator(i,o);var s=n.__iterator(Ct,o),l=!0,c=0;return new Ne(function(){var d,f,p;do{if(d=s.next(),d.done)return r||i===Dt?d:i===$a?er(i,c++,void 0,d):er(i,c++,d.value[1],d);var v=d.value;f=v[0],p=v[1],l&&(l=e.call(t,p,f,u))}while(l);return i===Ct?d:er(i,f,p,d)})},a}function py(n,e){var t=Ke(n),r=[n].concat(e).map(function(o){return Xr(o)?t&&(o=St(o)):o=t?Jo(o):Al(Array.isArray(o)?o:[o]),o}).filter(function(o){return o.size!==0});if(r.length===0)return n;if(r.length===1){var a=r[0];if(a===n||t&&Ke(a)||Ur(n)&&Ur(a))return a}var i=new In(r);return t?i=i.toKeyedSeq():Ur(n)||(i=i.toSetSeq()),i=i.flatten(!0),i.size=r.reduce(function(o,u){if(o!==void 0){var s=u.size;if(s!==void 0)return o+s}},0),i}function $l(n,e,t){var r=Wt(n);return r.__iterateUncached=function(a,i){if(i)return this.cacheResult().__iterate(a,i);var o=0,u=!1;function s(l,c){l.__iterate(function(d,f){return(!e||c<e)&&Xr(d)?s(d,c+1):(o++,a(d,t?f:o-1,r)===!1&&(u=!0)),!u},i)}return s(n,0),o},r.__iteratorUncached=function(a,i){if(i)return this.cacheResult().__iterator(a,i);var o=n.__iterator(a,i),u=[],s=0;return new Ne(function(){for(;o;){var l=o.next();if(l.done!==!1){o=u.pop();continue}var c=l.value;if(a===Ct&&(c=c[1]),(!e||u.length<e)&&Xr(c))u.push(o),o=c.__iterator(a,i);else return t?l:er(a,s++,c,l)}return Zr()})},r}function vy(n,e,t){var r=ou(n);return n.toSeq().map(function(a,i){return r(e.call(t,a,i,n))}).flatten(!0)}function gy(n,e){var t=Wt(n);return t.size=n.size&&n.size*2-1,t.__iterateUncached=function(r,a){var i=this,o=0;return n.__iterate(function(u){return(!o||r(e,o++,i)!==!1)&&r(u,o++,i)!==!1},a),o},t.__iteratorUncached=function(r,a){var i=n.__iterator(Dt,a),o=0,u;return new Ne(function(){return(!u||o%2)&&(u=i.next(),u.done)?u:o%2?er(r,o++,e):er(r,o++,u.value,u)})},t}function oa(n,e,t){e||(e=Ul);var r=Ke(n),a=0,i=n.toSeq().map(function(o,u){return[u,o,a++,t?t(o,u,n):o]}).valueSeq().toArray();return i.sort(function(o,u){return e(o[3],u[3])||o[2]-u[2]}).forEach(r?function(o,u){i[u].length=2}:function(o,u){i[u]=o[1]}),r?gn(i):Ur(n)?wt(i):ia(i)}function Ii(n,e,t){if(e||(e=Ul),t){var r=n.toSeq().map(function(a,i){return[a,t(a,i,n)]}).reduce(function(a,i){return Gl(e,a[1],i[1])?i:a});return r&&r[0]}return n.reduce(function(a,i){return Gl(e,a,i)?i:a})}function Gl(n,e,t){var r=n(t,e);return r===0&&t!==e&&(t==null||t!==t)||r>0}function Di(n,e,t,r){var a=Wt(n),i=new In(t).map(function(o){return o.size});return a.size=r?i.max():i.min(),a.__iterate=function(o,u){for(var s=this.__iterator(Dt,u),l,c=0;!(l=s.next()).done&&o(l.value,c++,this)!==!1;);return c},a.__iteratorUncached=function(o,u){var s=t.map(function(d){return d=dr(d),Wo(u?d.reverse():d)}),l=0,c=!1;return new Ne(function(){var d;return c||(d=s.map(function(f){return f.next()}),c=r?d.every(function(f){return f.done}):d.some(function(f){return f.done})),c?Zr():er(o,l++,e.apply(null,d.map(function(f){return f.value})))})},a}function He(n,e){return n===e?n:Li(n)?e:n.constructor(e)}function zl(n){if(n!==Object(n))throw new TypeError("Expected [K, V] tuple: "+n)}function ou(n){return Ke(n)?St:Ur(n)?xn:ta}function Wt(n){return Object.create((Ke(n)?gn:Ur(n)?wt:ia).prototype)}function uu(){return this._iter.cacheResult?(this._iter.cacheResult(),this.size=this._iter.size,this):et.prototype.cacheResult.call(this)}function Ul(n,e){return n===void 0&&e===void 0?0:n===void 0?1:e===void 0?-1:n>e?1:n<e?-1:0}function Bt(n,e){e=e||0;for(var t=Math.max(0,n.length-e),r=new Array(t),a=0;a<t;a++)r[a]=n[a+e];return r}function su(n,e){if(!n)throw new Error(e)}function pt(n){su(n!==1/0,"Cannot perform this action with an infinite size.")}function Wl(n){if(Bo(n)&&typeof n!="string")return n;if(_t(n))return n.toArray();throw new TypeError("Invalid keyPath: expected Ordered Collection or Array: "+n)}var hy=Object.prototype.toString;function lu(n){if(!n||typeof n!="object"||hy.call(n)!=="[object Object]")return!1;var e=Object.getPrototypeOf(n);if(e===null)return!0;for(var t=e,r=Object.getPrototypeOf(e);r!==null;)t=r,r=Object.getPrototypeOf(t);return t===e}function hn(n){return typeof n=="object"&&(Ft(n)||Array.isArray(n)||lu(n))}function za(n){try{return typeof n=="string"?JSON.stringify(n):String(n)}catch{return JSON.stringify(n)}}function Bl(n,e){return Ft(n)?n.has(e):hn(n)&&aa.call(n,e)}function cu(n,e,t){return Ft(n)?n.get(e,t):Bl(n,e)?typeof n.get=="function"?n.get(e):n[e]:t}function Vi(n){if(Array.isArray(n))return Bt(n);var e={};for(var t in n)aa.call(n,t)&&(e[t]=n[t]);return e}function ql(n,e){if(!hn(n))throw new TypeError("Cannot update non-data-structure value: "+n);if(Ft(n)){if(!n.remove)throw new TypeError("Cannot update immutable value without .remove() method: "+n);return n.remove(e)}if(!aa.call(n,e))return n;var t=Vi(n);return Array.isArray(t)?t.splice(e,1):delete t[e],t}function Hl(n,e,t){if(!hn(n))throw new TypeError("Cannot update non-data-structure value: "+n);if(Ft(n)){if(!n.set)throw new TypeError("Cannot update immutable value without .set() method: "+n);return n.set(e,t)}if(aa.call(n,e)&&t===n[e])return n;var r=Vi(n);return r[e]=t,r}function Vn(n,e,t,r){r||(r=t,t=void 0);var a=Jl(Ft(n),n,Wl(e),0,t,r);return a===xe?t:a}function Jl(n,e,t,r,a,i){var o=e===xe;if(r===t.length){var u=o?a:e,s=i(u);return s===u?e:s}if(!o&&!hn(e))throw new TypeError("Cannot update within non-data-structure value in path ["+t.slice(0,r).map(za)+"]: "+e);var l=t[r],c=o?xe:cu(e,l,xe),d=Jl(c===xe?n:Ft(c),c,t,r+1,a,i);return d===c?e:d===xe?ql(e,l):Hl(o?n?Vt():{}:e,l,d)}function Yl(n,e,t){return Vn(n,e,xe,function(){return t})}function du(n,e){return Yl(this,n,e)}function Kl(n,e){return Vn(n,e,function(){return xe})}function fu(n){return Kl(this,n)}function pu(n,e,t,r){return Vn(n,[e],t,r)}function vu(n,e,t){return arguments.length===1?n(this):pu(this,n,e,t)}function gu(n,e,t){return Vn(this,n,e,t)}function Ql(){for(var n=[],e=arguments.length;e--;)n[e]=arguments[e];return Zl(this,n)}function Xl(n){for(var e=[],t=arguments.length-1;t-- >0;)e[t]=arguments[t+1];if(typeof n!="function")throw new TypeError("Invalid merger function: "+n);return Zl(this,e,n)}function Zl(n,e,t){for(var r=[],a=0;a<e.length;a++){var i=St(e[a]);i.size!==0&&r.push(i)}return r.length===0?n:n.toSeq().size===0&&!n.__ownerID&&r.length===1?n.constructor(r[0]):n.withMutations(function(o){for(var u=t?function(l,c){pu(o,c,xe,function(d){return d===xe?l:t(d,l,c)})}:function(l,c){o.set(c,l)},s=0;s<r.length;s++)r[s].forEach(u)})}function my(n){for(var e=[],t=arguments.length-1;t-- >0;)e[t]=arguments[t+1];return Wa(n,e)}function yy(n,e){for(var t=[],r=arguments.length-2;r-- >0;)t[r]=arguments[r+2];return Wa(e,t,n)}function by(n){for(var e=[],t=arguments.length-1;t-- >0;)e[t]=arguments[t+1];return Ua(n,e)}function Oy(n,e){for(var t=[],r=arguments.length-2;r-- >0;)t[r]=arguments[r+2];return Ua(e,t,n)}function Ua(n,e,t){return Wa(n,e,Sy(t))}function Wa(n,e,t){if(!hn(n))throw new TypeError("Cannot merge into non-data-structure value: "+n);if(Ft(n))return typeof t=="function"&&n.mergeWith?n.mergeWith.apply(n,[t].concat(e)):n.merge?n.merge.apply(n,e):n.concat.apply(n,e);for(var r=Array.isArray(n),a=n,i=r?xn:St,o=r?function(s){a===n&&(a=Vi(a)),a.push(s)}:function(s,l){var c=aa.call(a,l),d=c&&t?t(a[l],s,l):s;(!c||d!==a[l])&&(a===n&&(a=Vi(a)),a[l]=d)},u=0;u<e.length;u++)i(e[u]).forEach(o);return a}function Sy(n){function e(t,r,a){return hn(t)&&hn(r)&&Fy(t,r)?Wa(t,[r],e):n?n(t,r,a):r}return e}function Fy(n,e){var t=et(n),r=et(e);return Ur(t)===Ur(r)&&Ke(t)===Ke(r)}function ec(){for(var n=[],e=arguments.length;e--;)n[e]=arguments[e];return Ua(this,n)}function rc(n){for(var e=[],t=arguments.length-1;t-- >0;)e[t]=arguments[t+1];return Ua(this,e,n)}function hu(n){for(var e=[],t=arguments.length-1;t-- >0;)e[t]=arguments[t+1];return Vn(this,n,Vt(),function(r){return Wa(r,e)})}function mu(n){for(var e=[],t=arguments.length-1;t-- >0;)e[t]=arguments[t+1];return Vn(this,n,Vt(),function(r){return Ua(r,e)})}function Ba(n){var e=this.asMutable();return n(e),e.wasAltered()?e.__ensureOwner(this.__ownerID):this}function qa(){return this.__ownerID?this:this.__ensureOwner(new Go)}function Ha(){return this.__ensureOwner()}function yu(){return this.__altered}var Qe=function(n){function e(t){return t==null?Vt():Ri(t)&&!_t(t)?t:Vt().withMutations(function(r){var a=n(t);pt(a.size),a.forEach(function(i,o){return r.set(o,i)})})}return n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e,e.of=function(){for(var r=[],a=arguments.length;a--;)r[a]=arguments[a];return Vt().withMutations(function(i){for(var o=0;o<r.length;o+=2){if(o+1>=r.length)throw new Error("Missing value for key: "+r[o]);i.set(r[o],r[o+1])}})},e.prototype.toString=function(){return this.__toString("Map {","}")},e.prototype.get=function(r,a){return this._root?this._root.get(0,void 0,r,a):a},e.prototype.set=function(r,a){return ac(this,r,a)},e.prototype.remove=function(r){return ac(this,r,xe)},e.prototype.deleteAll=function(r){var a=dr(r);return a.size===0?this:this.withMutations(function(i){a.forEach(function(o){return i.remove(o)})})},e.prototype.clear=function(){return this.size===0?this:this.__ownerID?(this.size=0,this._root=null,this.__hash=void 0,this.__altered=!0,this):Vt()},e.prototype.sort=function(r){return qt(oa(this,r))},e.prototype.sortBy=function(r,a){return qt(oa(this,a,r))},e.prototype.map=function(r,a){var i=this;return this.withMutations(function(o){o.forEach(function(u,s){o.set(s,r.call(a,u,s,i))})})},e.prototype.__iterator=function(r,a){return new _y(this,r,a)},e.prototype.__iterate=function(r,a){var i=this,o=0;return this._root&&this._root.iterate(function(u){return o++,r(u[1],u[0],i)},a),o},e.prototype.__ensureOwner=function(r){return r===this.__ownerID?this:r?Ou(this.size,this._root,r,this.__hash):this.size===0?Vt():(this.__ownerID=r,this.__altered=!1,this)},e}(St);Qe.isMap=Ri;var rr=Qe.prototype;rr[El]=!0,rr[Va]=rr.remove,rr.removeAll=rr.deleteAll,rr.setIn=du,rr.removeIn=rr.deleteIn=fu,rr.update=vu,rr.updateIn=gu,rr.merge=rr.concat=Ql,rr.mergeWith=Xl,rr.mergeDeep=ec,rr.mergeDeepWith=rc,rr.mergeIn=hu,rr.mergeDeepIn=mu,rr.withMutations=Ba,rr.wasAltered=yu,rr.asImmutable=Ha,rr["@@transducer/init"]=rr.asMutable=qa,rr["@@transducer/step"]=function(n,e){return n.set(e[0],e[1])},rr["@@transducer/result"]=function(n){return n.asImmutable()};var Ja=function(e,t){this.ownerID=e,this.entries=t};Ja.prototype.get=function(e,t,r,a){for(var i=this.entries,o=0,u=i.length;o<u;o++)if(Ir(r,i[o][0]))return i[o][1];return a},Ja.prototype.update=function(e,t,r,a,i,o,u){for(var s=i===xe,l=this.entries,c=0,d=l.length;c<d&&!Ir(a,l[c][0]);c++);var f=c<d;if(f?l[c][1]===i:s)return this;if(Ot(u),(s||!f)&&Ot(o),!(s&&l.length===1)){if(!f&&!s&&l.length>=Ty)return Cy(e,l,a,i);var p=e&&e===this.ownerID,v=p?l:Bt(l);return f?s?c===d-1?v.pop():v[c]=v.pop():v[c]=[a,i]:v.push([a,i]),p?(this.entries=v,this):new Ja(e,v)}};var ua=function(e,t,r){this.ownerID=e,this.bitmap=t,this.nodes=r};ua.prototype.get=function(e,t,r,a){t===void 0&&(t=dt(r));var i=1<<((e===0?t:t>>>e)&Qr),o=this.bitmap;return(o&i)===0?a:this.nodes[oc(o&i-1)].get(e+Ze,t,r,a)},ua.prototype.update=function(e,t,r,a,i,o,u){r===void 0&&(r=dt(a));var s=(t===0?r:r>>>t)&Qr,l=1<<s,c=this.bitmap,d=(c&l)!==0;if(!d&&i===xe)return this;var f=oc(c&l-1),p=this.nodes,v=d?p[f]:void 0,g=Su(v,e,t+Ze,r,a,i,o,u);if(g===v)return this;if(!d&&g&&p.length>=jy)return Ay(e,p,c,s,g);if(d&&!g&&p.length===2&&ic(p[f^1]))return p[f^1];if(d&&g&&p.length===1&&ic(g))return g;var h=e&&e===this.ownerID,y=d?g?c:c^l:c|l,m=d?g?uc(p,f,g,h):Ly(p,f,h):Ey(p,f,g,h);return h?(this.bitmap=y,this.nodes=m,this):new ua(e,y,m)};var Ya=function(e,t,r){this.ownerID=e,this.count=t,this.nodes=r};Ya.prototype.get=function(e,t,r,a){t===void 0&&(t=dt(r));var i=(e===0?t:t>>>e)&Qr,o=this.nodes[i];return o?o.get(e+Ze,t,r,a):a},Ya.prototype.update=function(e,t,r,a,i,o,u){r===void 0&&(r=dt(a));var s=(t===0?r:r>>>t)&Qr,l=i===xe,c=this.nodes,d=c[s];if(l&&!d)return this;var f=Su(d,e,t+Ze,r,a,i,o,u);if(f===d)return this;var p=this.count;if(!d)p++;else if(!f&&(p--,p<Ry))return wy(e,c,p,s);var v=e&&e===this.ownerID,g=uc(c,s,f,v);return v?(this.count=p,this.nodes=g,this):new Ya(e,p,g)};var sa=function(e,t,r){this.ownerID=e,this.keyHash=t,this.entries=r};sa.prototype.get=function(e,t,r,a){for(var i=this.entries,o=0,u=i.length;o<u;o++)if(Ir(r,i[o][0]))return i[o][1];return a},sa.prototype.update=function(e,t,r,a,i,o,u){r===void 0&&(r=dt(a));var s=i===xe;if(r!==this.keyHash)return s?this:(Ot(u),Ot(o),Fu(this,e,t,r,[a,i]));for(var l=this.entries,c=0,d=l.length;c<d&&!Ir(a,l[c][0]);c++);var f=c<d;if(f?l[c][1]===i:s)return this;if(Ot(u),(s||!f)&&Ot(o),s&&d===2)return new rn(e,this.keyHash,l[c^1]);var p=e&&e===this.ownerID,v=p?l:Bt(l);return f?s?c===d-1?v.pop():v[c]=v.pop():v[c]=[a,i]:v.push([a,i]),p?(this.entries=v,this):new sa(e,this.keyHash,v)};var rn=function(e,t,r){this.ownerID=e,this.keyHash=t,this.entry=r};rn.prototype.get=function(e,t,r,a){return Ir(r,this.entry[0])?this.entry[1]:a},rn.prototype.update=function(e,t,r,a,i,o,u){var s=i===xe,l=Ir(a,this.entry[0]);if(l?i===this.entry[1]:s)return this;if(Ot(u),s){Ot(o);return}return l?e&&e===this.ownerID?(this.entry[1]=i,this):new rn(e,this.keyHash,[a,i]):(Ot(o),Fu(this,e,t,dt(a),[a,i]))},Ja.prototype.iterate=sa.prototype.iterate=function(n,e){for(var t=this.entries,r=0,a=t.length-1;r<=a;r++)if(n(t[e?a-r:r])===!1)return!1},ua.prototype.iterate=Ya.prototype.iterate=function(n,e){for(var t=this.nodes,r=0,a=t.length-1;r<=a;r++){var i=t[e?a-r:r];if(i&&i.iterate(n,e)===!1)return!1}},rn.prototype.iterate=function(n,e){return n(this.entry)};var _y=function(n){function e(t,r,a){this._type=r,this._reverse=a,this._stack=t._root&&tc(t._root)}return n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e,e.prototype.next=function(){for(var r=this._type,a=this._stack;a;){var i=a.node,o=a.index++,u=void 0;if(i.entry){if(o===0)return bu(r,i.entry)}else if(i.entries){if(u=i.entries.length-1,o<=u)return bu(r,i.entries[this._reverse?u-o:o])}else if(u=i.nodes.length-1,o<=u){var s=i.nodes[this._reverse?u-o:o];if(s){if(s.entry)return bu(r,s.entry);a=this._stack=tc(s,a)}continue}a=this._stack=this._stack.__prev}return Zr()},e}(Ne);function bu(n,e){return er(n,e[0],e[1])}function tc(n,e){return{node:n,index:0,__prev:e}}function Ou(n,e,t,r){var a=Object.create(rr);return a.size=n,a._root=e,a.__ownerID=t,a.__hash=r,a.__altered=!1,a}var nc;function Vt(){return nc||(nc=Ou(0))}function ac(n,e,t){var r,a;if(n._root){var i=$o(),o=$o();if(r=Su(n._root,n.__ownerID,0,void 0,e,t,i,o),!o.value)return n;a=n.size+(i.value?t===xe?-1:1:0)}else{if(t===xe)return n;a=1,r=new Ja(n.__ownerID,[[e,t]])}return n.__ownerID?(n.size=a,n._root=r,n.__hash=void 0,n.__altered=!0,n):r?Ou(a,r):Vt()}function Su(n,e,t,r,a,i,o,u){return n?n.update(e,t,r,a,i,o,u):i===xe?n:(Ot(u),Ot(o),new rn(e,r,[a,i]))}function ic(n){return n.constructor===rn||n.constructor===sa}function Fu(n,e,t,r,a){if(n.keyHash===r)return new sa(e,r,[n.entry,a]);var i=(t===0?n.keyHash:n.keyHash>>>t)&Qr,o=(t===0?r:r>>>t)&Qr,u,s=i===o?[Fu(n,e,t+Ze,r,a)]:(u=new rn(e,r,a),i<o?[n,u]:[u,n]);return new ua(e,1<<i|1<<o,s)}function Cy(n,e,t,r){n||(n=new Go);for(var a=new rn(n,dt(t),[t,r]),i=0;i<e.length;i++){var o=e[i];a=a.update(n,0,void 0,o[0],o[1])}return a}function wy(n,e,t,r){for(var a=0,i=0,o=new Array(t),u=0,s=1,l=e.length;u<l;u++,s<<=1){var c=e[u];c!==void 0&&u!==r&&(a|=s,o[i++]=c)}return new ua(n,a,o)}function Ay(n,e,t,r,a){for(var i=0,o=new Array(bt),u=0;t!==0;u++,t>>>=1)o[u]=t&1?e[i++]:void 0;return o[r]=a,new Ya(n,i+1,o)}function oc(n){return n-=n>>1&1431655765,n=(n&858993459)+(n>>2&858993459),n=n+(n>>4)&252645135,n+=n>>8,n+=n>>16,n&127}function uc(n,e,t,r){var a=r?n:Bt(n);return a[e]=t,a}function Ey(n,e,t,r){var a=n.length+1;if(r&&e+1===a)return n[e]=t,n;for(var i=new Array(a),o=0,u=0;u<a;u++)u===e?(i[u]=t,o=-1):i[u]=n[u+o];return i}function Ly(n,e,t){var r=n.length-1;if(t&&e===r)return n.pop(),n;for(var a=new Array(r),i=0,o=0;o<r;o++)o===e&&(i=1),a[o]=n[o+i];return a}var Ty=bt/4,jy=bt/2,Ry=bt/4,sc="@@__IMMUTABLE_LIST__@@";function _u(n){return!!(n&&n[sc])}var Nt=function(n){function e(t){var r=Ni();if(t==null)return r;if(_u(t))return t;var a=n(t),i=a.size;return i===0?r:(pt(i),i>0&&i<bt?Qa(0,i,Ze,null,new mn(a.toArray())):r.withMutations(function(o){o.setSize(i),a.forEach(function(u,s){return o.set(s,u)})}))}return n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e,e.of=function(){return this(arguments)},e.prototype.toString=function(){return this.__toString("List [","]")},e.prototype.get=function(r,a){if(r=vn(this,r),r>=0&&r<this.size){r+=this._origin;var i=dc(this,r);return i&&i.array[r&Qr]}return a},e.prototype.set=function(r,a){return xy(this,r,a)},e.prototype.remove=function(r){return this.has(r)?r===0?this.shift():r===this.size-1?this.pop():this.splice(r,1):this},e.prototype.insert=function(r,a){return this.splice(r,0,a)},e.prototype.clear=function(){return this.size===0?this:this.__ownerID?(this.size=this._origin=this._capacity=0,this._level=Ze,this._root=this._tail=this.__hash=void 0,this.__altered=!0,this):Ni()},e.prototype.push=function(){var r=arguments,a=this.size;return this.withMutations(function(i){yn(i,0,a+r.length);for(var o=0;o<r.length;o++)i.set(a+o,r[o])})},e.prototype.pop=function(){return yn(this,0,-1)},e.prototype.unshift=function(){var r=arguments;return this.withMutations(function(a){yn(a,-r.length);for(var i=0;i<r.length;i++)a.set(i,r[i])})},e.prototype.shift=function(){return yn(this,1)},e.prototype.concat=function(){for(var r=arguments,a=[],i=0;i<arguments.length;i++){var o=r[i],u=n(typeof o!="string"&&Uo(o)?o:[o]);u.size!==0&&a.push(u)}return a.length===0?this:this.size===0&&!this.__ownerID&&a.length===1?this.constructor(a[0]):this.withMutations(function(s){a.forEach(function(l){return l.forEach(function(c){return s.push(c)})})})},e.prototype.setSize=function(r){return yn(this,0,r)},e.prototype.map=function(r,a){var i=this;return this.withMutations(function(o){for(var u=0;u<i.size;u++)o.set(u,r.call(a,o.get(u),u,i))})},e.prototype.slice=function(r,a){var i=this.size;return Na(r,a,i)?this:yn(this,ra(r,i),ka(a,i))},e.prototype.__iterator=function(r,a){var i=a?this.size:0,o=lc(this,a);return new Ne(function(){var u=o();return u===Ka?Zr():er(r,a?--i:i++,u)})},e.prototype.__iterate=function(r,a){for(var i=a?this.size:0,o=lc(this,a),u;(u=o())!==Ka&&r(u,a?--i:i++,this)!==!1;);return i},e.prototype.__ensureOwner=function(r){return r===this.__ownerID?this:r?Qa(this._origin,this._capacity,this._level,this._root,this._tail,r,this.__hash):this.size===0?Ni():(this.__ownerID=r,this.__altered=!1,this)},e}(xn);Nt.isList=_u;var _r=Nt.prototype;_r[sc]=!0,_r[Va]=_r.remove,_r.merge=_r.concat,_r.setIn=du,_r.deleteIn=_r.removeIn=fu,_r.update=vu,_r.updateIn=gu,_r.mergeIn=hu,_r.mergeDeepIn=mu,_r.withMutations=Ba,_r.wasAltered=yu,_r.asImmutable=Ha,_r["@@transducer/init"]=_r.asMutable=qa,_r["@@transducer/step"]=function(n,e){return n.push(e)},_r["@@transducer/result"]=function(n){return n.asImmutable()};var mn=function(e,t){this.array=e,this.ownerID=t};mn.prototype.removeBefore=function(e,t,r){if(r===t?1<<t:this.array.length===0)return this;var a=r>>>t&Qr;if(a>=this.array.length)return new mn([],e);var i=a===0,o;if(t>0){var u=this.array[a];if(o=u&&u.removeBefore(e,t-Ze,r),o===u&&i)return this}if(i&&!o)return this;var s=la(this,e);if(!i)for(var l=0;l<a;l++)s.array[l]=void 0;return o&&(s.array[a]=o),s},mn.prototype.removeAfter=function(e,t,r){if(r===(t?1<<t:0)||this.array.length===0)return this;var a=r-1>>>t&Qr;if(a>=this.array.length)return this;var i;if(t>0){var o=this.array[a];if(i=o&&o.removeAfter(e,t-Ze,r),i===o&&a===this.array.length-1)return this}var u=la(this,e);return u.array.splice(a+1),i&&(u.array[a]=i),u};var Ka={};function lc(n,e){var t=n._origin,r=n._capacity,a=Xa(r),i=n._tail;return o(n._root,n._level,0);function o(l,c,d){return c===0?u(l,d):s(l,c,d)}function u(l,c){var d=c===a?i&&i.array:l&&l.array,f=c>t?0:t-c,p=r-c;return p>bt&&(p=bt),function(){if(f===p)return Ka;var v=e?--p:f++;return d&&d[v]}}function s(l,c,d){var f,p=l&&l.array,v=d>t?0:t-d>>c,g=(r-d>>c)+1;return g>bt&&(g=bt),function(){for(;;){if(f){var h=f();if(h!==Ka)return h;f=null}if(v===g)return Ka;var y=e?--g:v++;f=o(p&&p[y],c-Ze,d+(y<<c))}}}}function Qa(n,e,t,r,a,i,o){var u=Object.create(_r);return u.size=e-n,u._origin=n,u._capacity=e,u._level=t,u._root=r,u._tail=a,u.__ownerID=i,u.__hash=o,u.__altered=!1,u}var cc;function Ni(){return cc||(cc=Qa(0,0,Ze))}function xy(n,e,t){if(e=vn(n,e),e!==e)return n;if(e>=n.size||e<0)return n.withMutations(function(o){e<0?yn(o,e).set(0,t):yn(o,0,e+1).set(e,t)});e+=n._origin;var r=n._tail,a=n._root,i=$o();return e>=Xa(n._capacity)?r=Cu(r,n.__ownerID,0,e,t,i):a=Cu(a,n.__ownerID,n._level,e,t,i),i.value?n.__ownerID?(n._root=a,n._tail=r,n.__hash=void 0,n.__altered=!0,n):Qa(n._origin,n._capacity,n._level,a,r):n}function Cu(n,e,t,r,a,i){var o=r>>>t&Qr,u=n&&o<n.array.length;if(!u&&a===void 0)return n;var s;if(t>0){var l=n&&n.array[o],c=Cu(l,e,t-Ze,r,a,i);return c===l?n:(s=la(n,e),s.array[o]=c,s)}return u&&n.array[o]===a?n:(i&&Ot(i),s=la(n,e),a===void 0&&o===s.array.length-1?s.array.pop():s.array[o]=a,s)}function la(n,e){return e&&n&&e===n.ownerID?n:new mn(n?n.array.slice():[],e)}function dc(n,e){if(e>=Xa(n._capacity))return n._tail;if(e<1<<n._level+Ze){for(var t=n._root,r=n._level;t&&r>0;)t=t.array[e>>>r&Qr],r-=Ze;return t}}function yn(n,e,t){e!==void 0&&(e|=0),t!==void 0&&(t|=0);var r=n.__ownerID||new Go,a=n._origin,i=n._capacity,o=a+e,u=t===void 0?i:t<0?i+t:a+t;if(o===a&&u===i)return n;if(o>=u)return n.clear();for(var s=n._level,l=n._root,c=0;o+c<0;)l=new mn(l&&l.array.length?[void 0,l]:[],r),s+=Ze,c+=1<<s;c&&(o+=c,a+=c,u+=c,i+=c);for(var d=Xa(i),f=Xa(u);f>=1<<s+Ze;)l=new mn(l&&l.array.length?[l]:[],r),s+=Ze;var p=n._tail,v=f<d?dc(n,u-1):f>d?new mn([],r):p;if(p&&f>d&&o<i&&p.array.length){l=la(l,r);for(var g=l,h=s;h>Ze;h-=Ze){var y=d>>>h&Qr;g=g.array[y]=la(g.array[y],r)}g.array[d>>>Ze&Qr]=p}if(u<i&&(v=v&&v.removeAfter(r,0,u)),o>=f)o-=f,u-=f,s=Ze,l=null,v=v&&v.removeBefore(r,0,o);else if(o>a||f<d){for(c=0;l;){var m=o>>>s&Qr;if(m!==f>>>s&Qr)break;m&&(c+=(1<<s)*m),s-=Ze,l=l.array[m]}l&&o>a&&(l=l.removeBefore(r,s,o-c)),l&&f<d&&(l=l.removeAfter(r,s,f-c)),c&&(o-=c,u-=c)}return n.__ownerID?(n.size=u-o,n._origin=o,n._capacity=u,n._level=s,n._root=l,n._tail=v,n.__hash=void 0,n.__altered=!0,n):Qa(o,u,s,l,v)}function Xa(n){return n<bt?0:n-1>>>Ze<<Ze}var qt=function(n){function e(t){return t==null?Za():Ko(t)?t:Za().withMutations(function(r){var a=St(t);pt(a.size),a.forEach(function(i,o){return r.set(o,i)})})}return n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e,e.of=function(){return this(arguments)},e.prototype.toString=function(){return this.__toString("OrderedMap {","}")},e.prototype.get=function(r,a){var i=this._map.get(r);return i!==void 0?this._list.get(i)[1]:a},e.prototype.clear=function(){return this.size===0?this:this.__ownerID?(this.size=0,this._map.clear(),this._list.clear(),this.__altered=!0,this):Za()},e.prototype.set=function(r,a){return pc(this,r,a)},e.prototype.remove=function(r){return pc(this,r,xe)},e.prototype.__iterate=function(r,a){var i=this;return this._list.__iterate(function(o){return o&&r(o[1],o[0],i)},a)},e.prototype.__iterator=function(r,a){return this._list.fromEntrySeq().__iterator(r,a)},e.prototype.__ensureOwner=function(r){if(r===this.__ownerID)return this;var a=this._map.__ensureOwner(r),i=this._list.__ensureOwner(r);return r?wu(a,i,r,this.__hash):this.size===0?Za():(this.__ownerID=r,this.__altered=!1,this._map=a,this._list=i,this)},e}(Qe);qt.isOrderedMap=Ko,qt.prototype[na]=!0,qt.prototype[Va]=qt.prototype.remove;function wu(n,e,t,r){var a=Object.create(qt.prototype);return a.size=n?n.size:0,a._map=n,a._list=e,a.__ownerID=t,a.__hash=r,a.__altered=!1,a}var fc;function Za(){return fc||(fc=wu(Vt(),Ni()))}function pc(n,e,t){var r=n._map,a=n._list,i=r.get(e),o=i!==void 0,u,s;if(t===xe){if(!o)return n;a.size>=bt&&a.size>=r.size*2?(s=a.filter(function(l,c){return l!==void 0&&i!==c}),u=s.toKeyedSeq().map(function(l){return l[0]}).flip().toMap(),n.__ownerID&&(u.__ownerID=s.__ownerID=n.__ownerID)):(u=r.remove(e),s=i===a.size-1?a.pop():a.set(i,void 0))}else if(o){if(t===a.get(i)[1])return n;u=r,s=a.set(i,[e,t])}else u=r.set(e,a.size),s=a.set(a.size,[e,t]);return n.__ownerID?(n.size=u.size,n._map=u,n._list=s,n.__hash=void 0,n.__altered=!0,n):wu(u,s)}var vc="@@__IMMUTABLE_STACK__@@";function ki(n){return!!(n&&n[vc])}var Mi=function(n){function e(t){return t==null?$i():ki(t)?t:$i().pushAll(t)}return n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e,e.of=function(){return this(arguments)},e.prototype.toString=function(){return this.__toString("Stack [","]")},e.prototype.get=function(r,a){var i=this._head;for(r=vn(this,r);i&&r--;)i=i.next;return i?i.value:a},e.prototype.peek=function(){return this._head&&this._head.value},e.prototype.push=function(){var r=arguments;if(arguments.length===0)return this;for(var a=this.size+arguments.length,i=this._head,o=arguments.length-1;o>=0;o--)i={value:r[o],next:i};return this.__ownerID?(this.size=a,this._head=i,this.__hash=void 0,this.__altered=!0,this):ei(a,i)},e.prototype.pushAll=function(r){if(r=n(r),r.size===0)return this;if(this.size===0&&ki(r))return r;pt(r.size);var a=this.size,i=this._head;return r.__iterate(function(o){a++,i={value:o,next:i}},!0),this.__ownerID?(this.size=a,this._head=i,this.__hash=void 0,this.__altered=!0,this):ei(a,i)},e.prototype.pop=function(){return this.slice(1)},e.prototype.clear=function(){return this.size===0?this:this.__ownerID?(this.size=0,this._head=void 0,this.__hash=void 0,this.__altered=!0,this):$i()},e.prototype.slice=function(r,a){if(Na(r,a,this.size))return this;var i=ra(r,this.size),o=ka(a,this.size);if(o!==this.size)return n.prototype.slice.call(this,r,a);for(var u=this.size-i,s=this._head;i--;)s=s.next;return this.__ownerID?(this.size=u,this._head=s,this.__hash=void 0,this.__altered=!0,this):ei(u,s)},e.prototype.__ensureOwner=function(r){return r===this.__ownerID?this:r?ei(this.size,this._head,r,this.__hash):this.size===0?$i():(this.__ownerID=r,this.__altered=!1,this)},e.prototype.__iterate=function(r,a){var i=this;if(a)return new In(this.toArray()).__iterate(function(s,l){return r(s,l,i)},a);for(var o=0,u=this._head;u&&r(u.value,o++,this)!==!1;)u=u.next;return o},e.prototype.__iterator=function(r,a){if(a)return new In(this.toArray()).__iterator(r,a);var i=0,o=this._head;return new Ne(function(){if(o){var u=o.value;return o=o.next,er(r,i++,u)}return Zr()})},e}(xn);Mi.isStack=ki;var rt=Mi.prototype;rt[vc]=!0,rt.shift=rt.pop,rt.unshift=rt.push,rt.unshiftAll=rt.pushAll,rt.withMutations=Ba,rt.wasAltered=yu,rt.asImmutable=Ha,rt["@@transducer/init"]=rt.asMutable=qa,rt["@@transducer/step"]=function(n,e){return n.unshift(e)},rt["@@transducer/result"]=function(n){return n.asImmutable()};function ei(n,e,t,r){var a=Object.create(rt);return a.size=n,a._head=e,a.__ownerID=t,a.__hash=r,a.__altered=!1,a}var gc;function $i(){return gc||(gc=ei(0))}var hc="@@__IMMUTABLE_SET__@@";function Gi(n){return!!(n&&n[hc])}function Au(n){return Gi(n)&&_t(n)}function Eu(n,e){if(n===e)return!0;if(!Xr(e)||n.size!==void 0&&e.size!==void 0&&n.size!==e.size||n.__hash!==void 0&&e.__hash!==void 0&&n.__hash!==e.__hash||Ke(n)!==Ke(e)||Ur(n)!==Ur(e)||_t(n)!==_t(e))return!1;if(n.size===0&&e.size===0)return!0;var t=!Ma(n);if(_t(n)){var r=n.entries();return e.every(function(s,l){var c=r.next().value;return c&&Ir(c[1],s)&&(t||Ir(c[0],l))})&&r.next().done}var a=!1;if(n.size===void 0)if(e.size===void 0)typeof n.cacheResult=="function"&&n.cacheResult();else{a=!0;var i=n;n=e,e=i}var o=!0,u=e.__iterate(function(s,l){if(t?!n.has(s):a?!Ir(s,n.get(l,xe)):!Ir(n.get(l,xe),s))return o=!1,!1});return o&&n.size===u}function Nn(n,e){var t=function(r){n.prototype[r]=e[r]};return Object.keys(e).forEach(t),Object.getOwnPropertySymbols&&Object.getOwnPropertySymbols(e).forEach(t),n}function zi(n){if(!n||typeof n!="object")return n;if(!Xr(n)){if(!hn(n))return n;n=et(n)}if(Ke(n)){var e={};return n.__iterate(function(r,a){e[a]=zi(r)}),e}var t=[];return n.__iterate(function(r){t.push(zi(r))}),t}var ri=function(n){function e(t){return t==null?ti():Gi(t)&&!_t(t)?t:ti().withMutations(function(r){var a=n(t);pt(a.size),a.forEach(function(i){return r.add(i)})})}return n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e,e.of=function(){return this(arguments)},e.fromKeys=function(r){return this(St(r).keySeq())},e.intersect=function(r){return r=dr(r).toArray(),r.length?Mr.intersect.apply(e(r.pop()),r):ti()},e.union=function(r){return r=dr(r).toArray(),r.length?Mr.union.apply(e(r.pop()),r):ti()},e.prototype.toString=function(){return this.__toString("Set {","}")},e.prototype.has=function(r){return this._map.has(r)},e.prototype.add=function(r){return Ui(this,this._map.set(r,r))},e.prototype.remove=function(r){return Ui(this,this._map.remove(r))},e.prototype.clear=function(){return Ui(this,this._map.clear())},e.prototype.map=function(r,a){var i=this,o=!1,u=Ui(this,this._map.mapEntries(function(s){var l=s[1],c=r.call(a,l,l,i);return c!==l&&(o=!0),[c,c]},a));return o?u:this},e.prototype.union=function(){for(var r=[],a=arguments.length;a--;)r[a]=arguments[a];return r=r.filter(function(i){return i.size!==0}),r.length===0?this:this.size===0&&!this.__ownerID&&r.length===1?this.constructor(r[0]):this.withMutations(function(i){for(var o=0;o<r.length;o++)typeof r[o]=="string"?i.add(r[o]):n(r[o]).forEach(function(u){return i.add(u)})})},e.prototype.intersect=function(){for(var r=[],a=arguments.length;a--;)r[a]=arguments[a];if(r.length===0)return this;r=r.map(function(o){return n(o)});var i=[];return this.forEach(function(o){r.every(function(u){return u.includes(o)})||i.push(o)}),this.withMutations(function(o){i.forEach(function(u){o.remove(u)})})},e.prototype.subtract=function(){for(var r=[],a=arguments.length;a--;)r[a]=arguments[a];if(r.length===0)return this;r=r.map(function(o){return n(o)});var i=[];return this.forEach(function(o){r.some(function(u){return u.includes(o)})&&i.push(o)}),this.withMutations(function(o){i.forEach(function(u){o.remove(u)})})},e.prototype.sort=function(r){return fa(oa(this,r))},e.prototype.sortBy=function(r,a){return fa(oa(this,a,r))},e.prototype.wasAltered=function(){return this._map.wasAltered()},e.prototype.__iterate=function(r,a){var i=this;return this._map.__iterate(function(o){return r(o,o,i)},a)},e.prototype.__iterator=function(r,a){return this._map.__iterator(r,a)},e.prototype.__ensureOwner=function(r){if(r===this.__ownerID)return this;var a=this._map.__ensureOwner(r);return r?this.__make(a,r):this.size===0?this.__empty():(this.__ownerID=r,this._map=a,this)},e}(ta);ri.isSet=Gi;var Mr=ri.prototype;Mr[hc]=!0,Mr[Va]=Mr.remove,Mr.merge=Mr.concat=Mr.union,Mr.withMutations=Ba,Mr.asImmutable=Ha,Mr["@@transducer/init"]=Mr.asMutable=qa,Mr["@@transducer/step"]=function(n,e){return n.add(e)},Mr["@@transducer/result"]=function(n){return n.asImmutable()},Mr.__empty=ti,Mr.__make=mc;function Ui(n,e){return n.__ownerID?(n.size=e.size,n._map=e,n):e===n._map?n:e.size===0?n.__empty():n.__make(e)}function mc(n,e){var t=Object.create(Mr);return t.size=n?n.size:0,t._map=n,t.__ownerID=e,t}var yc;function ti(){return yc||(yc=mc(Vt()))}var bc=function(n){function e(t,r,a){if(!(this instanceof e))return new e(t,r,a);if(su(a!==0,"Cannot step a Range by 0"),t=t||0,r===void 0&&(r=1/0),a=a===void 0?1:Math.abs(a),r<t&&(a=-a),this._start=t,this._end=r,this._step=a,this.size=Math.max(0,Math.ceil((r-t)/a-1)+1),this.size===0){if(Lu)return Lu;Lu=this}}return n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e,e.prototype.toString=function(){return this.size===0?"Range []":"Range [ "+this._start+"..."+this._end+(this._step!==1?" by "+this._step:"")+" ]"},e.prototype.get=function(r,a){return this.has(r)?this._start+vn(this,r)*this._step:a},e.prototype.includes=function(r){var a=(r-this._start)/this._step;return a>=0&&a<this.size&&a===Math.floor(a)},e.prototype.slice=function(r,a){return Na(r,a,this.size)?this:(r=ra(r,this.size),a=ka(a,this.size),a<=r?new e(0,0):new e(this.get(r,this._end),this.get(a,this._end),this._step))},e.prototype.indexOf=function(r){var a=r-this._start;if(a%this._step===0){var i=a/this._step;if(i>=0&&i<this.size)return i}return-1},e.prototype.lastIndexOf=function(r){return this.indexOf(r)},e.prototype.__iterate=function(r,a){for(var i=this.size,o=this._step,u=a?this._start+(i-1)*o:this._start,s=0;s!==i&&r(u,a?i-++s:s++,this)!==!1;)u+=a?-o:o;return s},e.prototype.__iterator=function(r,a){var i=this.size,o=this._step,u=a?this._start+(i-1)*o:this._start,s=0;return new Ne(function(){if(s===i)return Zr();var l=u;return u+=a?-o:o,er(r,a?i-++s:s++,l)})},e.prototype.equals=function(r){return r instanceof e?this._start===r._start&&this._end===r._end&&this._step===r._step:Eu(this,r)},e}(wt),Lu;function Tu(n,e,t){for(var r=Wl(e),a=0;a!==r.length;)if(n=cu(n,r[a++],xe),n===xe)return t;return n}function Oc(n,e){return Tu(this,n,e)}function Sc(n,e){return Tu(n,e,xe)!==xe}function Py(n){return Sc(this,n)}function Fc(){pt(this.size);var n={};return this.__iterate(function(e,t){n[t]=e}),n}dr.isIterable=Xr,dr.isKeyed=Ke,dr.isIndexed=Ur,dr.isAssociative=Ma,dr.isOrdered=_t,dr.Iterator=Ne,Nn(dr,{toArray:function(){pt(this.size);var e=new Array(this.size||0),t=Ke(this),r=0;return this.__iterate(function(a,i){e[r++]=t?[i,a]:a}),e},toIndexedSeq:function(){return new Pl(this)},toJS:function(){return zi(this)},toKeyedSeq:function(){return new Pi(this,!0)},toMap:function(){return Qe(this.toKeyedSeq())},toObject:Fc,toOrderedMap:function(){return qt(this.toKeyedSeq())},toOrderedSet:function(){return fa(Ke(this)?this.valueSeq():this)},toSet:function(){return ri(Ke(this)?this.valueSeq():this)},toSetSeq:function(){return new Il(this)},toSeq:function(){return Ur(this)?this.toIndexedSeq():Ke(this)?this.toKeyedSeq():this.toSetSeq()},toStack:function(){return Mi(Ke(this)?this.valueSeq():this)},toList:function(){return Nt(Ke(this)?this.valueSeq():this)},toString:function(){return"[Collection]"},__toString:function(e,t){return this.size===0?e+t:e+" "+this.toSeq().map(this.__toStringMapper).join(", ")+" "+t},concat:function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];return He(this,py(this,e))},includes:function(e){return this.some(function(t){return Ir(t,e)})},entries:function(){return this.__iterator(Ct)},every:function(e,t){pt(this.size);var r=!0;return this.__iterate(function(a,i,o){if(!e.call(t,a,i,o))return r=!1,!1}),r},filter:function(e,t){return He(this,kl(this,e,t,!0))},partition:function(e,t){return dy(this,e,t)},find:function(e,t,r){var a=this.findEntry(e,t);return a?a[1]:r},forEach:function(e,t){return pt(this.size),this.__iterate(t?e.bind(t):e)},join:function(e){pt(this.size),e=e!==void 0?""+e:",";var t="",r=!0;return this.__iterate(function(a){r?r=!1:t+=e,t+=a!=null?a.toString():""}),t},keys:function(){return this.__iterator($a)},map:function(e,t){return He(this,Nl(this,e,t))},reduce:function(e,t,r){return _c(this,e,t,r,arguments.length<2,!1)},reduceRight:function(e,t,r){return _c(this,e,t,r,arguments.length<2,!0)},reverse:function(){return He(this,au(this,!0))},slice:function(e,t){return He(this,iu(this,e,t,!0))},some:function(e,t){pt(this.size);var r=!1;return this.__iterate(function(a,i,o){if(e.call(t,a,i,o))return r=!0,!1}),r},sort:function(e){return He(this,oa(this,e))},values:function(){return this.__iterator(Dt)},butLast:function(){return this.slice(0,-1)},isEmpty:function(){return this.size!==void 0?this.size===0:!this.some(function(){return!0})},count:function(e,t){return ea(e?this.toSeq().filter(e,t):this)},countBy:function(e,t){return ly(this,e,t)},equals:function(e){return Eu(this,e)},entrySeq:function(){var e=this;if(e._cache)return new In(e._cache);var t=e.toSeq().map(Dy).toIndexedSeq();return t.fromEntrySeq=function(){return e.toSeq()},t},filterNot:function(e,t){return this.filter(ju(e),t)},findEntry:function(e,t,r){var a=r;return this.__iterate(function(i,o,u){if(e.call(t,i,o,u))return a=[o,i],!1}),a},findKey:function(e,t){var r=this.findEntry(e,t);return r&&r[0]},findLast:function(e,t,r){return this.toKeyedSeq().reverse().find(e,t,r)},findLastEntry:function(e,t,r){return this.toKeyedSeq().reverse().findEntry(e,t,r)},findLastKey:function(e,t){return this.toKeyedSeq().reverse().findKey(e,t)},first:function(e){return this.find(gl,null,e)},flatMap:function(e,t){return He(this,vy(this,e,t))},flatten:function(e){return He(this,$l(this,e,!0))},fromEntrySeq:function(){return new Dl(this)},get:function(e,t){return this.find(function(r,a){return Ir(a,e)},void 0,t)},getIn:Oc,groupBy:function(e,t){return cy(this,e,t)},has:function(e){return this.get(e,xe)!==xe},hasIn:Py,isSubset:function(e){return e=typeof e.includes=="function"?e:dr(e),this.every(function(t){return e.includes(t)})},isSuperset:function(e){return e=typeof e.isSubset=="function"?e:dr(e),e.isSubset(this)},keyOf:function(e){return this.findKey(function(t){return Ir(t,e)})},keySeq:function(){return this.toSeq().map(Iy).toIndexedSeq()},last:function(e){return this.toSeq().reverse().first(e)},lastKeyOf:function(e){return this.toKeyedSeq().reverse().keyOf(e)},max:function(e){return Ii(this,e)},maxBy:function(e,t){return Ii(this,t,e)},min:function(e){return Ii(this,e?Cc(e):Ac)},minBy:function(e,t){return Ii(this,t?Cc(t):Ac,e)},rest:function(){return this.slice(1)},skip:function(e){return e===0?this:this.slice(Math.max(0,e))},skipLast:function(e){return e===0?this:this.slice(0,-Math.max(0,e))},skipWhile:function(e,t){return He(this,Ml(this,e,t,!0))},skipUntil:function(e,t){return this.skipWhile(ju(e),t)},sortBy:function(e,t){return He(this,oa(this,t,e))},take:function(e){return this.slice(0,Math.max(0,e))},takeLast:function(e){return this.slice(-Math.max(0,e))},takeWhile:function(e,t){return He(this,fy(this,e,t))},takeUntil:function(e,t){return this.takeWhile(ju(e),t)},update:function(e){return e(this)},valueSeq:function(){return this.toIndexedSeq()},hashCode:function(){return this.__hash||(this.__hash=Vy(this))}});var Wr=dr.prototype;Wr[yl]=!0,Wr[Ti]=Wr.values,Wr.toJSON=Wr.toArray,Wr.__toStringMapper=za,Wr.inspect=Wr.toSource=function(){return this.toString()},Wr.chain=Wr.flatMap,Wr.contains=Wr.includes,Nn(St,{flip:function(){return He(this,Vl(this))},mapEntries:function(e,t){var r=this,a=0;return He(this,this.toSeq().map(function(i,o){return e.call(t,[o,i],a++,r)}).fromEntrySeq())},mapKeys:function(e,t){var r=this;return He(this,this.toSeq().flip().map(function(a,i){return e.call(t,a,i,r)}).flip())}});var ni=St.prototype;ni[bl]=!0,ni[Ti]=Wr.entries,ni.toJSON=Fc,ni.__toStringMapper=function(n,e){return za(e)+": "+za(n)},Nn(xn,{toKeyedSeq:function(){return new Pi(this,!1)},filter:function(e,t){return He(this,kl(this,e,t,!1))},findIndex:function(e,t){var r=this.findEntry(e,t);return r?r[0]:-1},indexOf:function(e){var t=this.keyOf(e);return t===void 0?-1:t},lastIndexOf:function(e){var t=this.lastKeyOf(e);return t===void 0?-1:t},reverse:function(){return He(this,au(this,!1))},slice:function(e,t){return He(this,iu(this,e,t,!1))},splice:function(e,t){var r=arguments.length;if(t=Math.max(t||0,0),r===0||r===2&&!t)return this;e=ra(e,e<0?this.count():this.size);var a=this.slice(0,e);return He(this,r===1?a:a.concat(Bt(arguments,2),this.slice(e+t)))},findLastIndex:function(e,t){var r=this.findLastEntry(e,t);return r?r[0]:-1},first:function(e){return this.get(0,e)},flatten:function(e){return He(this,$l(this,e,!1))},get:function(e,t){return e=vn(this,e),e<0||this.size===1/0||this.size!==void 0&&e>this.size?t:this.find(function(r,a){return a===e},void 0,t)},has:function(e){return e=vn(this,e),e>=0&&(this.size!==void 0?this.size===1/0||e<this.size:this.indexOf(e)!==-1)},interpose:function(e){return He(this,gy(this,e))},interleave:function(){var e=[this].concat(Bt(arguments)),t=Di(this.toSeq(),wt.of,e),r=t.flatten(!0);return t.size&&(r.size=t.size*e.length),He(this,r)},keySeq:function(){return bc(0,this.size)},last:function(e){return this.get(-1,e)},skipWhile:function(e,t){return He(this,Ml(this,e,t,!1))},zip:function(){var e=[this].concat(Bt(arguments));return He(this,Di(this,wc,e))},zipAll:function(){var e=[this].concat(Bt(arguments));return He(this,Di(this,wc,e,!0))},zipWith:function(e){var t=Bt(arguments);return t[0]=this,He(this,Di(this,e,t))}});var ca=xn.prototype;ca[Ol]=!0,ca[na]=!0,Nn(ta,{get:function(e,t){return this.has(e)?e:t},includes:function(e){return this.has(e)},keySeq:function(){return this.valueSeq()}});var da=ta.prototype;da.has=Wr.includes,da.contains=da.includes,da.keys=da.values,Nn(gn,ni),Nn(wt,ca),Nn(ia,da);function _c(n,e,t,r,a,i){return pt(n.size),n.__iterate(function(o,u,s){a?(a=!1,t=o):t=e.call(r,t,o,u,s)},i),t}function Iy(n,e){return e}function Dy(n,e){return[e,n]}function ju(n){return function(){return!n.apply(this,arguments)}}function Cc(n){return function(){return-n.apply(this,arguments)}}function wc(){return Bt(arguments)}function Ac(n,e){return n<e?1:n>e?-1:0}function Vy(n){if(n.size===1/0)return 0;var e=_t(n),t=Ke(n),r=e?1:0,a=n.__iterate(t?e?function(i,o){r=31*r+Ec(dt(i),dt(o))|0}:function(i,o){r=r+Ec(dt(i),dt(o))|0}:e?function(i){r=31*r+dt(i)|0}:function(i){r=r+dt(i)|0});return Ny(a,r)}function Ny(n,e){return e=Ga(e,3432918353),e=Ga(e<<15|e>>>-15,461845907),e=Ga(e<<13|e>>>-13,5),e=(e+3864292196|0)^n,e=Ga(e^e>>>16,2246822507),e=Ga(e^e>>>13,3266489909),e=xi(e^e>>>16),e}function Ec(n,e){return n^e+2654435769+(n<<6)+(n>>2)|0}var fa=function(n){function e(t){return t==null?Ru():Au(t)?t:Ru().withMutations(function(r){var a=ta(t);pt(a.size),a.forEach(function(i){return r.add(i)})})}return n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e,e.of=function(){return this(arguments)},e.fromKeys=function(r){return this(St(r).keySeq())},e.prototype.toString=function(){return this.__toString("OrderedSet {","}")},e}(ri);fa.isOrderedSet=Au;var kn=fa.prototype;kn[na]=!0,kn.zip=ca.zip,kn.zipWith=ca.zipWith,kn.zipAll=ca.zipAll,kn.__empty=Ru,kn.__make=Lc;function Lc(n,e){var t=Object.create(kn);return t.size=n?n.size:0,t._map=n,t.__ownerID=e,t}var Tc;function Ru(){return Tc||(Tc=Lc(Za()))}var ky={LeftThenRight:-1,RightThenLeft:1};function My(n){if(Pn(n))throw new Error("Can not call `Record` with an immutable Record as default values. Use a plain javascript object instead.");if(Ft(n))throw new Error("Can not call `Record` with an immutable Collection as default values. Use a plain javascript object instead.");if(n===null||typeof n!="object")throw new Error("Can not call `Record` with a non-object as default values. Use a plain javascript object instead.")}var Rr=function(e,t){var r;My(e);var a=function(u){var s=this;if(u instanceof a)return u;if(!(this instanceof a))return new a(u);if(!r){r=!0;var l=Object.keys(e),c=i._indices={};i._name=t,i._keys=l,i._defaultValues=e;for(var d=0;d<l.length;d++){var f=l[d];c[f]=d,i[f]?typeof console=="object"&&console.warn&&console.warn("Cannot define "+Pu(this)+' with property "'+f+'" since that property name is part of the Record API.'):$y(i,f)}}return this.__ownerID=void 0,this._values=Nt().withMutations(function(p){p.setSize(s._keys.length),St(u).forEach(function(v,g){p.set(s._indices[g],v===s._defaultValues[g]?void 0:v)})}),this},i=a.prototype=Object.create(Xe);return i.constructor=a,t&&(a.displayName=t),a};Rr.prototype.toString=function(){for(var e=Pu(this)+" { ",t=this._keys,r,a=0,i=t.length;a!==i;a++)r=t[a],e+=(a?", ":"")+r+": "+za(this.get(r));return e+" }"},Rr.prototype.equals=function(e){return this===e||Pn(e)&&pa(this).equals(pa(e))},Rr.prototype.hashCode=function(){return pa(this).hashCode()},Rr.prototype.has=function(e){return this._indices.hasOwnProperty(e)},Rr.prototype.get=function(e,t){if(!this.has(e))return t;var r=this._indices[e],a=this._values.get(r);return a===void 0?this._defaultValues[e]:a},Rr.prototype.set=function(e,t){if(this.has(e)){var r=this._values.set(this._indices[e],t===this._defaultValues[e]?void 0:t);if(r!==this._values&&!this.__ownerID)return xu(this,r)}return this},Rr.prototype.remove=function(e){return this.set(e)},Rr.prototype.clear=function(){var e=this._values.clear().setSize(this._keys.length);return this.__ownerID?this:xu(this,e)},Rr.prototype.wasAltered=function(){return this._values.wasAltered()},Rr.prototype.toSeq=function(){return pa(this)},Rr.prototype.toJS=function(){return zi(this)},Rr.prototype.entries=function(){return this.__iterator(Ct)},Rr.prototype.__iterator=function(e,t){return pa(this).__iterator(e,t)},Rr.prototype.__iterate=function(e,t){return pa(this).__iterate(e,t)},Rr.prototype.__ensureOwner=function(e){if(e===this.__ownerID)return this;var t=this._values.__ensureOwner(e);return e?xu(this,t,e):(this.__ownerID=e,this._values=t,this)},Rr.isRecord=Pn,Rr.getDescriptiveName=Pu;var Xe=Rr.prototype;Xe[Fl]=!0,Xe[Va]=Xe.remove,Xe.deleteIn=Xe.removeIn=fu,Xe.getIn=Oc,Xe.hasIn=Wr.hasIn,Xe.merge=Ql,Xe.mergeWith=Xl,Xe.mergeIn=hu,Xe.mergeDeep=ec,Xe.mergeDeepWith=rc,Xe.mergeDeepIn=mu,Xe.setIn=du,Xe.update=vu,Xe.updateIn=gu,Xe.withMutations=Ba,Xe.asMutable=qa,Xe.asImmutable=Ha,Xe[Ti]=Xe.entries,Xe.toJSON=Xe.toObject=Wr.toObject,Xe.inspect=Xe.toSource=function(){return this.toString()};function xu(n,e,t){var r=Object.create(Object.getPrototypeOf(n));return r._values=e,r.__ownerID=t,r}function Pu(n){return n.constructor.displayName||n.constructor.name||"Record"}function pa(n){return Jo(n._keys.map(function(e){return[e,n.get(e)]}))}function $y(n,e){try{Object.defineProperty(n,e,{get:function(){return this.get(e)},set:function(t){su(this.__ownerID,"Cannot set on an immutable record."),this.set(e,t)}})}catch{}}var Gy=function(n){function e(t,r){if(!(this instanceof e))return new e(t,r);if(this._value=t,this.size=r===void 0?1/0:Math.max(0,r),this.size===0){if(Iu)return Iu;Iu=this}}return n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e,e.prototype.toString=function(){return this.size===0?"Repeat []":"Repeat [ "+this._value+" "+this.size+" times ]"},e.prototype.get=function(r,a){return this.has(r)?this._value:a},e.prototype.includes=function(r){return Ir(this._value,r)},e.prototype.slice=function(r,a){var i=this.size;return Na(r,a,i)?this:new e(this._value,ka(a,i)-ra(r,i))},e.prototype.reverse=function(){return this},e.prototype.indexOf=function(r){return Ir(this._value,r)?0:-1},e.prototype.lastIndexOf=function(r){return Ir(this._value,r)?this.size:-1},e.prototype.__iterate=function(r,a){for(var i=this.size,o=0;o!==i&&r(this._value,a?i-++o:o++,this)!==!1;);return o},e.prototype.__iterator=function(r,a){var i=this,o=this.size,u=0;return new Ne(function(){return u===o?Zr():er(r,a?o-++u:u++,i._value)})},e.prototype.equals=function(r){return r instanceof e?Ir(this._value,r._value):Eu(this,r)},e}(wt),Iu;function bn(n,e){return jc([],e||zy,n,"",e&&e.length>2?[]:void 0,{"":n})}function jc(n,e,t,r,a,i){if(typeof t!="string"&&!Ft(t)&&(Bo(t)||Uo(t)||lu(t))){if(~n.indexOf(t))throw new TypeError("Cannot convert circular structure to Immutable");n.push(t),a&&r!==""&&a.push(r);var o=e.call(i,r,et(t).map(function(u,s){return jc(n,e,u,s,a,t)}),a&&a.slice());return n.pop(),a&&a.pop(),o}return t}function zy(n,e){return Ur(e)?e.toList():Ke(e)?e.toMap():e.toSet()}var Uy="4.3.7",Wy={version:Uy,Collection:dr,Iterable:dr,Seq:et,Map:Qe,OrderedMap:qt,List:Nt,Stack:Mi,Set:ri,OrderedSet:fa,PairSorting:ky,Record:Rr,Range:bc,Repeat:Gy,is:Ir,fromJS:bn,hash:dt,isImmutable:Ft,isCollection:Xr,isKeyed:Ke,isIndexed:Ur,isAssociative:Ma,isOrdered:_t,isValueObject:Qo,isPlainObject:lu,isSeq:Li,isList:_u,isMap:Ri,isOrderedMap:Ko,isStack:ki,isSet:Gi,isOrderedSet:Au,isRecord:Pn,get:cu,getIn:Tu,has:Bl,hasIn:Sc,merge:my,mergeDeep:by,mergeWith:yy,mergeDeepWith:Oy,remove:ql,removeIn:Kl,set:Hl,setIn:Yl,update:pu,updateIn:Vn},LA=null;const pe=Wy;var By=0;const Ve=function(){var n=(new Date().getTime().toString(16)+"FF").substr(0,11),e="ssssssss-xxxx-4xxx-yxxx-x".replace(/[xys]/g,function(t){var r=t==="s"?Math.floor(Math.random()*16):By++&15,a=t==="x"?r:r&3|8;return a.toString(16)});return e+n};function Rc(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),t.push.apply(t,r)}return t}function qy(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Rc(Object(t),!0).forEach(function(r){(0,z.A)(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Rc(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}var Mn=["formatValue","mongoFormatValue","sqlFormatValue","jsonLogic","elasticSearchFormatValue","spelFormatValue","spelImportFuncs","spelImportValue"],va=["formatOp","mongoFormatOp","sqlFormatOp","jsonLogic","spelFormatOp"],Wi=function(e){return(0,We.A)(e)==="object"&&e!==null&&Object.prototype.toString.call(e)==="[object Object]"},xc=function(e){if((0,We.A)(e)==="object"&&e!==null){if(Array.isArray(e))return(0,Q.A)(e);if(Wi(e))return qy({},e)}return e},vt=function(e,t){return Object.fromEntries(Object.entries(e).filter(function(r){var a=(0,ie.A)(r,1),i=a[0];return!t.includes(i)}))},Cr=function(e){var t;return(t=e?.cardinality)!==null&&t!==void 0?t:1},Bi=function(e,t){return e===t?!0:Qe.isMap(e)?e.equals(t):JSON.stringify(e)==JSON.stringify(t)},ai=function(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return e===t?!0:Array.isArray(e)?Hy(e,t,r):Qe.isMap(e)?e.equals(t):(0,We.A)(e)=="object"?Jy(e,t,r):e===t};function Hy(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;if(n===e)return!0;if(!n||!e)return!1;var r=n.length;if(e.length!==r)return!1;for(var a=0;a<r;a++){var i=t?ai(n[a],e[a],t):n[a]===e[a];if(!i)return!1}return!0}function Jy(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;if(n===e)return!0;if(!n||!e)return!1;var r=Object.keys(n),a=Object.keys(e),i=r.length;if(a.length!==i)return!1;for(var o=0;o<i;o++){var u=r[o],s=t?ai(n[u],e[u],t):n[u]===e[u];if(!s)return!1}return!0}var ga=function(e){return(0,We.A)(e)==="object"&&e!==null&&typeof e.toJS=="function"},qi=function(e){return ga(e)&&pe.isList(e)};function wr(n){return qi(n)?n:new pe.List(n)}function Du(n){return ga(n)?n.toJS():n}var Pc=function(e){return e.replace(/[.*+?^${}()|[\]\\/]/g,"\\$&")},Ic=function(e,t,r,a,i,o){if(Array.isArray(e))return t},Vu=function n(e){var t=["$$typeof","_owner","_store","ref","key"],r=function(u){return typeof u=="string"?u:typeof u=="function"?u.name:u};if(e instanceof Array)return e.map(function(o,u){return n(o)});if((0,We.A)(e)==="object"&&e!==null&&ii(e)){var a,i=vt(e,t);return i.type&&(i.type=r(i.type)),i!=null&&(a=i.props)!==null&&a!==void 0&&a.children&&(i.props.children=n(i.props.children)),i}return e},ii=function(e){return(0,We.A)(e)==="object"&&e!==null&&!Array.isArray(e)&&Object.keys(e).includes("type")&&Object.keys(e).includes("props")&&Object.keys(e).includes("key")&&Object.keys(e).includes("ref")&&Object.keys(e).includes("$$typeof")},Nu=function(e){return(0,We.A)(e)==="object"&&e!==null&&!Array.isArray(e)&&typeof e.type=="string"&&Object.keys(e).includes("props")},tt=function(e){var t=(0,We.A)(e)==="object"&&e!==null&&!Array.isArray(e)&&Object.keys(e).length===1;return t};function Dc(n){return new Promise(function(e){setTimeout(e,n)})}function Hi(n,e){return n||(n=[]),e||(e=[]),e.map(function(t){return[t,n.indexOf(t)]}).map(function(t,r,a){var i=(0,ie.A)(t,2),o=i[0],u=i[1];if(u==-1){var s=a.slice(r+1),l=a.slice(0,r),c=l.reverse().find(function(f){var p=(0,ie.A)(f,2),v=p[0],g=p[1];return g!=-1}),d=s.find(function(f){var p=(0,ie.A)(f,2),v=p[0],g=p[1];return g!=-1});return d?[o,"before",d[0]]:c?[o,"after",c[0]]:[o,"append",null]}else return null}).filter(function(t){return t!==null}).reduce(function(t,r){var a=(0,ie.A)(r,3),i=a[0],o=a[1],u=a[2],s=t.indexOf(u);return t.indexOf(i)==-1&&(s>-1?t.splice(s+(o=="after"?1:0),0,i):t.splice(o=="append"?1/0:0,0,i)),t},n.slice())}var Vc=function n(e){(0,We.A)(e)==="object"&&e!==null&&!ii(e)&&(Object.keys(e).forEach(function(t){t!=="__cache"&&n(e[t])}),Object.freeze(e))},Nc=function n(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[];if(Wi(e)){if(e.var)return r[e.var]=t,!0;if(!Wi(t))return!1;for(var i in e){var o=e[i],u=t[i];if(!n(o,u,r,[].concat((0,Q.A)(a),[i])))return!1}return!0}else if(Array.isArray(e)){if(!Array.isArray(t))return!1;for(var s=0;s<e.length;s++){var l=e[s],c=t[s];if(!n(l,c,r,[].concat((0,Q.A)(a),[s])))return!1}return!0}else return e===t},Yy=function(){return typeof process<"u"&&process.env&&!1},kc=function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,t=e??Yy();return t?console:{error:function(){},log:function(){},warn:function(){},debug:function(){},info:function(){}}},Mc=function(){for(var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],t,r=0;r<e.length;r++){var a=e[r];if(a!==void 0){t=a;break}}return t},On=kc(),Ky=D(54756),tn=D.n(Ky),Qy=D(44383),Ht=D.n(Qy),Xy=D(68090),Ji=D.n(Xy),Zy=D(90179),Yi=D.n(Zy);function e0(n,e){var t=typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(!t){if(Array.isArray(n)||(t=r0(n))||e&&n&&typeof n.length=="number"){t&&(n=t);var r=0,a=function(){};return{s:a,n:function(){return r>=n.length?{done:!0}:{done:!1,value:n[r++]}},e:function(l){throw l},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,o=!1,u;return{s:function(){t=t.call(n)},n:function(){var l=t.next();return i=l.done,l},e:function(l){o=!0,u=l},f:function(){try{!i&&t.return!=null&&t.return()}finally{if(o)throw u}}}}function r0(n,e){if(n){if(typeof n=="string")return $c(n,e);var t=Object.prototype.toString.call(n).slice(8,-1);if(t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set")return Array.from(n);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return $c(n,e)}}function $c(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=new Array(e);t<e;t++)r[t]=n[t];return r}function Gc(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),t.push.apply(t,r)}return t}function Ki(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Gc(Object(t),!0).forEach(function(r){(0,z.A)(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Gc(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}var ku=function(e){return(0,We.A)(e)=="object"&&e!==null&&!Array.isArray(e)},nn=function(e,t){if(!(e==null||e==""))return ku(e)?Ki(Ki({},e),{},{title:e.title||e.value}):{value:e,title:t!==void 0?t:""+e}},Mu=function(e){var t=nn(e);return ku(t)?Ki(Ki({},nn(e)),{},{isCustom:!0}):t},zc=function(e){if(Array.isArray(e))return e.map(function(i){return nn(i)});if(!ku(e))return e;var t=[];for(var r in e){var a=e[r];t.push(nn(r,a))}return t},oi=function(e,t){if(Array.isArray(e)){var r=e.map(function(a){return nn(a)});return r.find(function(a){return""+a.value==""+t})}else return e[t]!==void 0?nn(t,e[t]):void 0},Uc=function(e,t){if(e==null)return t;var r=oi(e,t);return r!==void 0?r.title:t},t0=function(e,t){if(e==null)return t;var r=oi(e,t);return r!==void 0?r.value:t},$u=function(e,t){var r=[];if(Array.isArray(e)){var a=e0(e),i;try{for(a.s();!(i=a.n()).done;){var o=i.value,u=t(nn(o));u!=null&&r.push(u)}}catch(c){a.e(c)}finally{a.f()}}else for(var s in e){var l=t(nn(s,e[s]));l!=null&&r.push(l)}return r},n0=function(e,t){return $u(t,function(r){return"".concat(r.value).indexOf(e)!=-1||r.title.indexOf(e)!=-1?r:null}).filter(function(r){return r!==null}).shift()},Qi=function(e,t){return $u(t,function(r){return""+r.value==""+e?r:null}).filter(function(r){return r!==null}).shift()},Z=function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),a=1;a<t;a++)r[a-1]=arguments[a];return e.interpose("children1").withMutations(function(i){return i.skip(1),i.push.apply(i,r),i})},Gu=function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),a=1;a<t;a++)r[a-1]=arguments[a];return e.interpose("children1").withMutations(function(i){return i.push.apply(i,r),i})},Sn=function(e,t){var r=new pe.OrderedMap((0,z.A)({},e.get("id"),e)),a=e;return t.forEach(function(i){var o,u;a=(o=r)===null||o===void 0?void 0:o.get(i),r=(u=a)===null||u===void 0?void 0:u.get("children1")}),a},zu=function(e,t){var r=t.map(function(a,i){return t.take(i+1)}).reverse().toJS().map(function(a){return{item:Sn(e,a),path:a}}).filter(function(a){var i=a.item;return i?.get("type")==="rule_group"});return r.length?r.map(function(a){var i=a.item,o=a.path;return{path:o,field:i.get("properties").get("field")}}):[]},Wc=function(e){var t=e;function r(a,i){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,u=i.push(a.get("id")),s=a.getIn(["properties","isLocked"]);o&&s&&(t=t.deleteIn(Z(u,"properties","isLocked")));var l=a.get("children1");l&&l.map(function(c,d){r(c,u,s||o)})}return r(e,new pe.List),t},kt=function(e){var t=e;function r(a,i,o,u){if(a){var s=a.get("path"),l=a.get("id"),c=l||u||Ve(),d=i.push(c);(!s||!s.equals(d))&&(t=t.setIn(Z(d,"path"),d)),l||(t=t.setIn(Z(d,"id"),c));var f=a.get("children1");f&&(f.constructor.name==="Map"&&(t=t.setIn(Z(d,"children1"),new pe.OrderedMap(f))),f.map(function(p,v){r(p,d,o+1,v)}))}}return r(e,new pe.List,0),t},Xi=function(e){var t=e;function r(a,i,o,u){if(!a)return!1;var s=a.get("id")||u,l=i.push(s),c=a.get("children1");if(c){var d=c.map(function(f,p){return r(f,l,o+1,p)}).reduce(function(f,p){return f&&p},!0);if((c.size==0||d)&&o>0)return t=t.deleteIn(Z(l)),!0}return!1}return r(e,new pe.List,0),t},Uu=function(e,t){var r=[],a={},i=[],o=0,u=0,s=0,l=0,c={};function d(h,y,m,b,O,S,F,_,T){var E,A,j,R=h===e,L=h.get("type"),N=h.get("collapsed"),I=h.get("id"),P=h.get("children1"),x=h.getIn(["properties","isLocked"]),k=P?P.map(function(yr,Gr){return Gr}).valueSeq().toArray():null,V=L==="rule_group",G=L==="rule",$=L==="group",W=L==="case_group",q=!O&&(!P||V),J=k?.length>0,K=y.length?y[y.length-1]:null,U=(0,Q.A)(y).reverse().find(function(yr){return a[yr].type=="rule_group"}),X=h.getIn(["properties","field"]),Y=X&&t&&oe(t,X),ae=Y?Y?.canRegroup!==!1:void 0,ge=Y?.maxNesting,se=a==null||(E=a[U])===null||E===void 0?void 0:E.canRegroup,ce=a==null||(A=a[U])===null||A===void 0?void 0:A.maxNesting,de=a==null||(j=a[U])===null||j===void 0?void 0:j.lev,ne=W?I:_;W&&(i.push(I),u=0,s=0,l=0,c={});var ve=ne?i.indexOf(ne):null,ye=r.length,Ce=o,fe;R||(fe={},fe.caseNo=ve,fe.globalNoByType=W?ve:c[L]||0,fe.indexPath=[].concat((0,Q.A)(y.slice(1).map(function(yr){return a[yr].childNo})),[T]),G?fe.globalLeafNo=u:$&&(fe.globalGroupNo=l));var ar=O||V?F:F+1;r.push(I),a[I]={node:h,index:ye,id:I,type:L,parent:K,children:k,childNo:T,caseId:ne,caseNo:ve,closestRuleGroupId:U,closestRuleGroupLev:de,closestRuleGroupMaxNesting:ce,closestRuleGroupCanRegroup:se,maxNesting:ge,canRegroup:ae,path:y.concat(I),lev:S,atomicLev:F,nextAtomicLev:ar,isLeaf:!P,isAtomicRule:q,isLocked:x||b,top:m?null:Ce,isDefaultCase:W?!P:void 0,atomicRulesCountInCase:W?0:void 0,position:fe,collapsed:N,_top:ye,parentType:K?a[K].type:null,leaf:!P};var Le=0,Me=0;m||(o+=1,Le+=1,J&&!N&&!V&&(Me+=1),!R&&!W&&($&&l++,q&&s++,G&&u++,c[L]=(c[L]||0)+1)),_&&q&&a[_].atomicRulesCountInCase++;var Ae=0,Tr=0;if(J){var Dr=0;P.map(function(yr,Gr){if(yr){d(yr,y.concat(I),m||N,b||x,O||V,S+1,ar,ne,Dr);var pr=a[Gr];Ae=Math.max(Ae,pr.depth||0),Tr+=pr.height,Dr++}})}Le+=Tr,Me+=Ae;var xr=r.length,$r=xr-ye,je=m?null:Ce+Le;Object.assign(a[I],{depth:P?Me:void 0,_height:$r,height:Le,bottom:je})}d(e,[],!1,!1,!1,0,0,null,null);for(var f=0;f<r.length;f++){var p=f>0?r[f-1]:null,v=f<r.length-1?r[f+1]:null,g=a[r[f]];g.prev=p,g.next=v}return{flat:r,items:a,cases:i}},a0=function(e){if(!e)return-1;var t=0;function r(a,i,o){var u,s,l;typeof a.get=="function"?(u=a.get("id"),s=a.get("children1"),l=a.get("type")):(u=a.id,s=a.children1,l=a.type),t++,l=="rule_group"&&o>0||s&&s.map(function(c,d){c&&r(c,i.concat(u),o+1)})}return r(e,[],0),t-1},Zi=function(e){if(!e)return-1;var t=0;function r(a,i,o){var u,s,l;typeof a.get=="function"?(u=a.get("id"),s=a.get("children1"),l=a.get("type")):(u=a.id,s=a.children1,l=a.type),l=="rule"||l=="rule_group"&&o>0?t++:s&&s.map(function(c,d){c&&r(c,i.concat(u),o+1)})}return r(e,[],0),t},Bc=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,a=e;function i(o,u){t&&o.path&&delete o.path,t&&!r&&u&&delete o.id;var s=o.properties;s&&s.operatorOptions==null&&delete s.operatorOptions;var l=o.children1;if(l){for(var c in l)l[c]&&i(l[c],c);r&&(o.children1=Object.values(l))}}return i(e,null),a},qc=function(e){var t=[],r=e.get("children1");return r&&r.map(function(a){var i=a.getIn(["properties","value"]),o;i&&i.size==1?(o=i.get(0),Array.isArray(o)&&o.length==0&&(o=null)):o=null,t=[].concat((0,Q.A)(t),[o])}),t},Wu=function(e){return!e.get("children1")||e.get("children1").size==0},Bu=function(e,t){return e.getIn(Z(t,"children1")).size>0},qu=function(e){if(e!=null&&e.toJS){var t,r=e==null||(t=e.toJS)===null||t===void 0?void 0:t.call(e);return r!=null&&r.func?e.toOrderedMap():r}else return e},i0=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;if(e){var a=e;return a=a.toJS(),a=Bc(a,t,r),a}},Hu=function(e){if(Hc(e))return e;if(Jc(e))return kt(ui(e));if(typeof e=="string"&&e.startsWith('["~#iM"'))throw new Error("You are trying to load query in obsolete serialization format (Immutable string) which is not supported in versions starting from 2.1.17");if(typeof e=="string")return kt(ui(JSON.parse(e)));throw new Error("Can't load tree!")},Hc=function(e){return Qe.isMap(e)},Jc=function(e){return(0,We.A)(e)=="object"&&(e.type=="group"||e.type=="switch_group")};function ui(n){var e=bn(n,function(t,r,a){var i=a&&a.length>3&&a[a.length-1]==="value"&&a[a.length-3]==="args",o=a&&a.length>3&&a[a.length-1]==="value"&&a[a.length-2]==="properties",u;if(t=="properties"){u=r.toOrderedMap();for(var s=0;s<2;s++){var l,c,d;((l=u.get("value"))===null||l===void 0||(c=(d=l).get)===null||c===void 0?void 0:c.call(d,s))===null&&(u=u.setIn(["value",s],void 0))}}else i?u=qu(r):(a?o:t=="value")&&pe.Iterable.isIndexed(r)?u=r.map(qu).toList():t=="asyncListValues"?u=r.toJS():t=="children1"&&pe.Iterable.isIndexed(r)?u=new pe.OrderedMap(r.map(function(f){return[f?.get("id")||Ve(),f]})):u=pe.Iterable.isIndexed(r)?r.toList():r.toOrderedMap();return u});return e}var Yc=D(87695),o0=D(95093),ha=D.n(o0);function Kc(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),t.push.apply(t,r)}return t}function Fn(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Kc(Object(t),!0).forEach(function(r){(0,z.A)(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Kc(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function Qc(n,e){var t=typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(!t){if(Array.isArray(n)||(t=u0(n))||e&&n&&typeof n.length=="number"){t&&(n=t);var r=0,a=function(){};return{s:a,n:function(){return r>=n.length?{done:!0}:{done:!1,value:n[r++]}},e:function(l){throw l},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,o=!1,u;return{s:function(){t=t.call(n)},n:function(){var l=t.next();return i=l.done,l},e:function(l){o=!0,u=l},f:function(){try{!i&&t.return!=null&&t.return()}finally{if(o)throw u}}}}function u0(n,e){if(n){if(typeof n=="string")return Xc(n,e);var t=Object.prototype.toString.call(n).slice(8,-1);if(t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set")return Array.from(n);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Xc(n,e)}}function Xc(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=new Array(e);t<e;t++)r[t]=n[t];return r}var s0=function(e){return Array.from(new Set(e))},Zc="jlField",ed="jlArgs",l0=["==","!="],c0=["<","<=",">",">="],d0=["multiselect_equals","multiselect_not_equals","multiselect_contains","multiselect_not_contains"],rd=function(e){return{errors:[],settings:e?.settings}},f0=function(e,t){return td(e,t,!1)},td=function(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,a=rd();a.settings={allowUnknownFields:!1,returnErrors:r};var i=gt(t,void 0,!1),o=p0(i),u=e?ma(e,o,i,["rule","group","switch"],a):void 0,s=u?Hu(u):void 0;return r?[s,a.errors]:(a.errors.length&&console.warn("Errors while importing from JsonLogic:",a.errors),s)},p0=function(e){var t={},r={};for(var a in e.operators){var i=e.operators[a];if(typeof i.jsonLogic=="string"){var o=i.jsonLogic+"/"+Cr(i);t[o]||(t[o]=[]),t[o].push(a)}else if(typeof i.jsonLogic2=="string"){var u=i.jsonLogic2+"/"+Cr(i);t[u]||(t[u]=[]),t[u].push(a),r[a]||(r[a]={}),r[a]={template:i.jsonLogic(Zc,a,ed),jsonLogic2:i.jsonLogic2,_jsonLogicIsExclamationOp:!!i._jsonLogicIsExclamationOp}}}var s={};for(var l in e.conjunctions){var c=e.conjunctions[l],d=c.jsonLogicConj||l.toLowerCase();s[d]=l}var f={},p=Qc(Aa(e)),v;try{for(p.s();!(v=p.n()).done;){var g=(0,ie.A)(v.value,2),h=g[0],y=g[1],m=void 0;y.jsonLogicIsMethod?m="#"+y.jsonLogic:typeof y.jsonLogic=="string"&&(m=y.jsonLogic),m&&(f[m]||(f[m]=[]),f[m].push(h))}}catch(F){p.e(F)}finally{p.f()}var b=e.settings.jsonLogic,O=b.groupVarKey,S=b.altVarKey;return{operators:t,conjunctions:s,funcs:f,varKeys:["var",O,S],combinationOperators:r}},Ju=function(e,t,r){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null,i;if(t!=null&&t.combinationOperators)for(var o=0,u=Object.entries(t.combinationOperators);o<u.length;o++){var s=(0,ie.A)(u[o],2),l=s[0],c=s[1];if(a==null||a.includes(l)){var d=v0(c.template,e);d.match&&(i?r.errors.push("Operator matched against 2 templates: ".concat(i.newOp," and ").concat(l)):i=d,i.newOp=c.jsonLogic2)}}return i},v0=function n(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{match:!0,jlField:null,jlArgs:[]};if(e==null||t==null)return r.match=!1,r;var a=Object.keys(e),i=Object.keys(t);if(a.length!==i.length)return r.match=!1,r;for(var o=0;o<a.length;o++){var u=a[o],s=e[u];if(u!==i[o])return r.match=!1,r;if(s===Zc&&tt(t[u]))r.jlField=t[u];else if(s===ed)r.jlArgs.push(t[u]);else if((0,We.A)(s)==="object"&&s!==null||Array.isArray(s))r=n(s,t[u],r);else if(s!==t[u])return r.match=!1,r}return r},ma=function n(e,t,r,a,i){var o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!1,u=arguments.length>6?arguments[6]:void 0,s=arguments.length>7?arguments[7]:void 0,l=arguments.length>8&&arguments[8]!==void 0?arguments[8]:null,c=arguments.length>9&&arguments[9]!==void 0?arguments[9]:!1,d,f;tt(e)&&(d=Object.keys(e)[0],f=e[d],Array.isArray(f)||(f=[f]));var p,v=i.errors.length,g=r.settings.jsonLogic.lockedOp,h=d=="!"&&f.length==1&&f[0]&&tt(f[0])&&t.varKeys.includes(Object.keys(f[0])[0]),y=Ju(e,t,i);y&&(f=[],f[0]=y.jlField,y.jlArgs.forEach(function(_){return f.push(_)}),d=y.newOp);var m=d=="!"&&!h,b=g&&d==g,O=a.includes("switch"),S=O;b?p=n(f[0],t,r,a,i,o,u,s,l,!0):m?p=n(f[0],t,r,a,i,!o,u,s,l):a.includes("val")?p=nd(d,f,t,r,o,i,l)||ad(d,f,t,r,o,u,i,l)||g0(e,u,s,r,i):(a.includes("switch")&&(p=_0(d,f,t,r,o,i,l)),p==null&&a.includes("group")&&(p=id(d,f,t,r,o,i,l,!1)),p==null&&a.includes("rule")&&(p=F0(d,f,t,r,o,i,l)),p&&S&&!["group","switch_group"].includes(p.type)&&(p=si(p,r)));var F=i.errors.length;return d!="!"&&p===void 0&&F==v&&i.errors.push("Can't parse logic ".concat(JSON.stringify(e))),b&&(p.properties.isLocked=!0),p},g0=function(e,t,r,a,i){var o;if(e===void 0&&(e=t?.defaultValue),e!==void 0){r=r||t?.mainWidget;var u=a.widgets[r],s=t?.type;if(s&&!u){i.errors.push("No widget for type ".concat(s));return}if(tt(e)){i.errors.push("Unexpected logic in value: ".concat(JSON.stringify(e)));return}if(s==="time"&&typeof e=="number"){var l=Math.floor(e/60/60)%24,c=Math.floor(e/60)%60,d=e%60,f=u.valueFormat;if(f){var p=new Date(e);p.setMilliseconds(0),p.setHours(l),p.setMinutes(c),p.setSeconds(d),e=ha()(p).format(f)}else e="".concat(l,":").concat(c,":").concat(d)}if(["date","datetime"].includes(s)&&e&&!(e instanceof Date))try{var v=new Date(e);v instanceof Date&&v.toISOString()===e&&(e=v)}catch{i.errors.push("Can't convert value ".concat(e," as Date")),e=void 0}if(e instanceof Date&&t){var g=u.valueFormat;g&&(e=ha()(e).format(g))}var h;if(e&&t!==null&&t!==void 0&&(o=t.fieldSettings)!==null&&o!==void 0&&o.asyncFetch){var y=Array.isArray(e)?e:[e];h=y}if(u!=null&&u.jsonLogicImport)try{e=u.jsonLogicImport.call(a.ctx,e)}catch(b){var m;i.errors.push("Can't import value ".concat(e," using import func of widget ").concat(r,": ").concat((m=b?.message)!==null&&m!==void 0?m:b)),e=void 0}return{valueSrc:"value",value:e,valueType:u?.type,asyncListValues:h}}},nd=function(e,t,r,a,i,o){var u=arguments.length>6&&arguments[6]!==void 0?arguments[6]:null;if(r.varKeys.includes(e)&&typeof t[0]=="string"){var s,l=go(a,t[0],u),c=oe(a,l);if(!c&&!((s=o.settings)!==null&&s!==void 0&&s.allowUnknownFields)){o.errors.push("No config for field ".concat(l));return}return{valueSrc:"field",value:l,valueType:c?.type}}},h0=function(e,t,r,a,i){var o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:null,u=arguments.length>6&&arguments[6]!==void 0?arguments[6]:null,s=arguments.length>7?arguments[7]:void 0,l=arguments.length>8&&arguments[8]!==void 0?arguments[8]:null,c=Object.keys(t)[0],d=Object.values(t)[0],f=function(P,x){return m0(P,x,a,i,o,s,l)||y0(P,x,a,i,o,u,s,l)},p=s.errors.length,v,g,h,y,m=f(c,d);if(m&&(v=m.field,g=m.fieldSrc),e&&(y=!0,h=r[0],r=[]),c=="reduce"&&Array.isArray(d)&&d.length==3){var b=d,O=(0,ie.A)(b,3),S=O[0],F=O[1],_=O[2];if(tt(S)&&_==0&&tt(F)&&Array.isArray(F["+"])&&F["+"][0]==1&&tt(F["+"][1])&&F["+"][1].var=="accumulator")if(c=Object.keys(S)[0],d=Object.values(S)[0],c=="filter"){var T=d,E=(0,ie.A)(T,2),A=E[0],j=E[1];if(tt(A)){c=Object.keys(A)[0],d=Object.values(A)[0];var R=f(c,d);R&&(v=R.field,g=R.fieldSrc,h=j,y=!0)}}else{var L=f(c,d);L&&(v=L.field,g=L.fieldSrc,y=!0)}}var N=s.errors.length;if(!v&&N==p&&s.errors.push("Unknown LHS ".concat(JSON.stringify(t))),!!v)return{field:v,fieldSrc:g,having:h,isGroup:y,args:r}},m0=function(e,t,r,a,i,o){var u=arguments.length>6&&arguments[6]!==void 0?arguments[6]:null;Array.isArray(t)||(t=[t]);var s=nd(e,t,r,a,i,o,u);if(s)return{fieldSrc:"field",field:s.value}},y0=function(e,t,r,a,i){var o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:null,u=arguments.length>6?arguments[6]:void 0,s=arguments.length>7&&arguments[7]!==void 0?arguments[7]:null,l=ad(e,t,r,a,i,o,u,s);if(l)return{fieldSrc:"func",field:l.value}},ad=function(e,t,r,a,i){var o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:null,u=arguments.length>6?arguments[6]:void 0,s=arguments.length>7&&arguments[7]!==void 0?arguments[7]:null;if(e){var l,c,d,f=e=="method";if(f){var p,v,g=(0,Yc.A)(t);p=g[0],l=g[1],v=g.slice(2),c=[p].concat((0,Q.A)(v))}else l=e,c=t;var h=(f?"#":"")+l,y=o?.type||o?.returnType,m=(r.funcs[h]||[]).filter(function(x){return o?Ar(a,x).returnType==y:!0});if(m.length)d=m[0];else{var b=(0,z.A)({},e,t),O=Qc(Aa(a)),S;try{for(O.s();!(S=O.n()).done;){var F=(0,ie.A)(S.value,2),_=F[0],T=F[1];if(T.jsonLogicImport&&(!y||T.returnType==y)){var E=void 0;try{E=T.jsonLogicImport(b)}catch{}E&&(d=_,c=E)}}}catch(x){O.e(x)}finally{O.f()}}if(d&&d){var A=Ar(a,d),j=Object.keys(A.args||{}),R=c.reduce(function(x,k,V){var G=j[V],$=A.args[G],W;return $&&(W=ma(k,r,a,["val"],u,!1,$,null,s)),W!==void 0?Fn(Fn({},x),{},(0,z.A)({},G,W)):x},{});for(var L in A.args){var N=A.args[L],I=R[L];if(I===void 0){if(I=N?.defaultValue,I!==void 0){var P;I={value:I,valueSrc:(P=I)!==null&&P!==void 0&&P.func?"func":"value",valueType:N.type}}if(I===void 0){if(!(N!=null&&N.isOptional)){u.errors.push("No value for arg ".concat(L," of func ").concat(d));return}}else R[L]=I}}return{valueSrc:"func",value:{func:d,args:R},valueType:A.returnType}}}},id=function(e,t,r,a,i,o){var u=arguments.length>6&&arguments[6]!==void 0?arguments[6]:null,s=arguments.length>7&&arguments[7]!==void 0?arguments[7]:!1,l=r.conjunctions[e],c=a.settings.fieldSeparator;if(l){var d="group",f=t.map(function(b){return ma(b,r,a,["rule","group"],o,!1,null,null,u)}).filter(function(b){return b!==void 0}).reduce(function(b,O){return Fn(Fn({},b),{},(0,z.A)({},O.id,O))},{}),p=Object.values(f).map(function(b){var O,S;return(b==null||(O=b.properties)===null||O===void 0?void 0:O.fieldSrc)=="field"&&(b==null||(S=b.properties)===null||S===void 0?void 0:S.field)}).filter(function(b){var O;return b==null||(O=b.includes)===null||O===void 0?void 0:O.call(b,c)}),v=Object.fromEntries(s0(p).map(function(b){var O=b.split(c),S=Object.fromEntries(O.slice(0,-1).map(function(F,_,T){return[].concat((0,Q.A)(T.slice(0,_)),[F])}).map(function(F){return[F.join(c),oe(a,F)]}).filter(function(F){var _=(0,ie.A)(F,2),T=_[0],E=_[1];return E?.type=="!group"}));return[b,Object.keys(S)]})),g={conjunction:l,not:i},h=Ve(),y={},m={};return Object.entries(f).map(function(b){var O=(0,ie.A)(b,2),S=O[0],F=O[1];if(F?.type=="group"||F?.type=="rule_group")y[S]=F;else{var _,T=F==null||(_=F.properties)===null||_===void 0?void 0:_.field,E=v[T]||[],A=E[E.length-1];if(!A)F&&(y[S]=F);else{var j=y,R=mr(u,a),L=mr(A,a),N=ai(R,L.slice(0,R.length));N||(R=[]);var I=A.split(c).slice(R.length).map(function(P,x,k){return[].concat((0,Q.A)(R),(0,Q.A)(k.slice(0,x)),[P]).join(c)}).map(function(P){return{f:P,fc:oe(a,P)||{}}}).filter(function(P){var x=P.fc;return x.type!="!struct"});I.map(function(P,x){var k=P.f,V=P.fc,G=m[k];G||(G=Ve(),m[k]=G,j[G]={type:"rule_group",id:G,children1:{},properties:{conjunction:l,not:!1,field:k,fieldSrc:"field",mode:V.mode}}),j=j[G].children1}),j[S]=F}}}),{type:d,id:h,children1:y,properties:g}}},b0=function(e,t,r,a){var i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:void 0,o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!1;if(e)return{type:"rule_group",id:Ve(),children1:(0,z.A)({},e.id,e),properties:{conjunction:i||an(a,r),not:o,field:t}}},si=function(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return{type:"group",id:Ve(),children1:(0,z.A)({},e.id,e),properties:{conjunction:an(t),not:r}}},O0=function(e,t,r,a,i,o,u){var s=rd(u),l=S0(e,t,r,a,i,o,s);if(!l){u.errors.push(s.errors.join("; ")||"Unknown op ".concat(e,"/").concat(t));return}return l},S0=function(e,t,r,a,i,o,u){var s,l=d0.map(function(A){var j;return(j=o.operators[A])===null||j===void 0?void 0:j.jsonLogic2}).includes(e),c=o.settings.groupOperators.includes(e)&&!l,d=c?0:t-1;c?d=0:l0.includes(e)&&d==1&&r[1]===null&&(t=1,d=0,r=[r[0]]);var f=e+"/"+d,p=i.operators[f];if(p){var v,g=[];if(c0.includes(e)&&t==3)v=r[1],g=[r[0],r[2]];else{var h=r,y=(0,Yc.A)(h);v=y[0],g=y.slice(1)}if(!tt(v)){u.errors.push("Incorrect operands for ".concat(e,": ").concat(JSON.stringify(r)));return}var m=h0(c,v,g,i,o,null,null,u,a);if(m){var b=m.field,O=m.fieldSrc,S=m.having,F=m.isGroup,_=m.args,T=oe(o,b);if(!T&&!((s=u.settings)!==null&&s!==void 0&&s.allowUnknownFields)){u.errors.push("No config for LHS ".concat(b));return}var E=p[0];if(p.length>1&&T&&T.operators){if(p=p.filter(function(A){return T.operators.includes(A)}),p.length==0){u.errors.push("No corresponding ops for LHS ".concat(b));return}E=p[0]}return{field:b,fieldSrc:O,fieldConfig:T,opKey:E,args:_,having:S}}}},F0=function n(e,t,r,a,i,o){var u,s=arguments.length>6&&arguments[6]!==void 0?arguments[6]:null,l=arguments.length>7&&arguments[7]!==void 0?arguments[7]:!1;if(e){var c=Object.values(a.conjunctions).map(function(U){var X=U.jsonLogicConj;return X}),d=t.length,f=O0(e,d,t,s,r,a,o);if(f){var p=f.field,v=f.fieldSrc,g=f.fieldConfig,h=f.opKey,y=f.args,m=f.having,b=oe(a,s),O=a.operators[h],S=a.operators[(u=O)===null||u===void 0?void 0:u.reversedOp],F=!1,_=!!S,T=g.type=="!group",E=b?.type=="!group",A=_&&(!!a.settings.reverseOperatorsForNot||F||T&&!m||!T&&E&&!l),j=i&&A||F,R,L,N=!1,I=!!a.settings.reverseOperatorsForNot;if(g?.type=="!group"&&m){R=Object.keys(m)[0],L=m[R],Array.isArray(L)||(L=[L]);for(var P=Ju(m,r,o);R=="!"&&!P;){var x=R=="!"&&L.length==1&&L[0]&&tt(L[0])&&r.varKeys.includes(Object.keys(L[0])[0]);if(x)break;N=!N,m=m["!"],R=Object.keys(m)[0],L=m[R],I&&c.includes(R)&&L.length==1&&(m=m[R][0],R=Object.keys(m)[0],L=m[R]);var k=Ju(m,r,o);P=k||P}Array.isArray(L)||(L=[L]),P&&(L=[],L[0]=P.jlField,P.jlArgs.forEach(function(U){return L.push(U)}),R=P.newOp)}j&&(i=!i,h=O.reversedOp,O=a.operators[h]);var V=nr(a,p,h,null),G=y.map(function(U){return ma(U,r,a,["val"],o,!1,g,V,s)});if(!G.filter(function(U){return U===void 0}).length){var $,W=g?.type;if((W==="!group"||W==="!struct")&&(W=null),g?.type=="!group"&&m){if(r.conjunctions[R]!==void 0)$=id(R,L,r,a,N,o,p,!0);else if($=n(R,L,r,a,N,o,p,!0),$){var q;$.type==="rule_group"&&((q=$.properties)===null||q===void 0?void 0:q.field)!==p&&($=b0($,p,g,a)),Object.assign($.properties,{conjunction:an(a,g)})}if(!$)return;$.type="rule_group",Object.assign($.properties,{field:p,mode:g.mode,operator:h}),g.mode=="array"&&Object.assign($.properties,{value:G.map(function(U){return U.value}),valueSrc:G.map(function(U){return U.valueSrc}),valueType:G.map(function(U){return U.valueType})}),i&&($=si($,a,i))}else if(g?.type=="!group"&&!m)$={type:"rule_group",id:Ve(),children1:{},properties:{conjunction:an(a,g),not:!1,mode:g.mode,field:p,operator:h}},g.mode==="array"&&Object.assign($.properties,{value:G.map(function(U){return U.value}),valueSrc:G.map(function(U){return U.valueSrc}),valueType:G.map(function(U){return U.valueType})}),i&&($=si($,a,i));else{var J=G.map(function(U){return U.asyncListValues}).filter(function(U){return U!=null}),K=J.length?J[0]:void 0;$={type:"rule",id:Ve(),properties:Fn({field:p,fieldSrc:v,operator:h,value:G.map(function(U){return U.value}),valueSrc:G.map(function(U){return U.valueSrc}),valueType:G.map(function(U){return U.valueType})},K?{asyncListValues:K}:{})},(i||l)&&($=si($,a,i))}return $}}}},_0=function(e,t,r,a,i,o){var u=arguments.length>6&&arguments[6]!==void 0?arguments[6]:null;if(e?.toLowerCase()==="if"){var s=C0(t),l=s.map(function(f){var p=(0,ie.A)(f,2),v=p[0],g=p[1];return[v?ma(v,r,a,["rule","group"],o,!1,null,null,u):null,A0(a,o,r,g)]}),c=l.map(function(f){var p=(0,ie.A)(f,2),v=p[0],g=p[1];return w0(v,g,a,o)}),d={type:"switch_group",id:Ve(),children1:c,properties:{}};return d}},C0=function(e){var t=[];function r(a){var i=(0,ie.A)(a,3),o=i[0],u=i[1],s=i[2];t.push([o,u]);var l=tt(s)?Object.keys(s)[0]:null;l?.toLowerCase()==="if"?r(s[l]):t.push([void 0,s])}return r(e),t},w0=function(e,t,r,a){var i;return e?(i=Fn({},e),i.type?(i.type!="group"&&(i=si(i,r)),i.type="case_group"):(a.errors.push("Unexpected case: ".concat(JSON.stringify(i))),i=void 0)):i={id:Ve(),type:"case_group",properties:{}},i&&(i.properties=Fn(Fn({},i.properties),t)),i},A0=function(e,t,r,a){var i=oe(e,"!case_value");if(!i){t.errors.push("Missing caseValueField in settings");return}var o=i.mainWidget,u=e.widgets[o];if(!u){t.errors.push("No widget ".concat(o," for case value"));return}var s=ma(a,r,e,["val","case_val"],t,!1,i,o);if(s!=null){var l=s.value,c=s.valueSrc,d=s.valueType,f={value:[l],valueSrc:[c??"value"],valueType:[d??u?.type],field:"!case_value"};return f}},E0=D(21450),L0=D(61526),T0=D.n(L0),_n=T0();_n.trim=function(n){return n.charAt(0)=="'"?n.substring(1,n.length-1):n},_n.escapeLike=function(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,r=_n.escape(n);return r=_n.trim(r),r=r.replace(/[%_]/g,"\\$&"),r=(e?"%":"")+r+(t?"%":""),r="'"+r+"'",r};var od=function(e){var t="''",r=e?.type;return r=="date"?t="'0000-00-00'":r=="datetime"?t="'0000-00-00 00:00'":r=="time"?t="'00:00'":r=="number"&&(t="0"),t},ud=function(e){var t="",r=e?.type;return r=="number"&&(t=0),t},j0=function(e){return"'"+e.replace(/'/g,"''")+"'"},R0=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,r,a,i=["int","float"];e.map(function(s){if(s!=null){if(typeof s=="string")a="String";else if(typeof s=="number")a=Number.isInteger(s)?"int":"float";else throw new Error("spelEscape: Can't use value ".concat(s," in array"));if(!r)r=a;else if(r!=a)if(i.includes(r)&&i.includes(a))r="float";else throw new Error("spelEscape: Can't use different types in array: found ".concat(r," and ").concat(a))}}),r||(r="String");var o;r=="float"?o=e.map(function(s){return ya(s,!0)}):o=e.map(function(s){return ya(s)});var u;return t?u="new ".concat(r,"[]{").concat(o.join(", "),"}"):u="{".concat(o.join(", "),"}"),u},sd=function(e){return"".concat(e,".?[true]")},ya=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;if(e==null)return"null";switch((0,We.A)(e)){case"boolean":return e?"true":"false";case"number":return!Number.isFinite(e)||isNaN(e)?void 0:e+(!Number.isInteger(e)||t?"f":"");case"object":if(Array.isArray(e))return R0(e,r);throw new Error("spelEscape: Object is not supported");default:return j0(e)}},x0=function(e){return e&&Array.isArray(e)&&e.length?e.map(function(t){if(t.type=="const")return ya(t.value);if(t.type=="property")return""+t.value;if(t.type=="variable")return"#"+t.value}).filter(function(t){return t!=null}).join(" + "):"null"},P0=function(e){if(e==null)return[void 0,[]];var t=[],r=e.valueType=="case_value"?e.value:e,a=Array.isArray(r)?r:[r],i=a.map(function(o){if(o.valueSrc==="value")return o.value===null?void 0:{type:"const",value:o.value};if(o.valueSrc==="field")return{type:o.isVariable?"variable":"property",value:o.value};t.push("Unsupported valueSrc ".concat(o.valueSrc," in concatenation"))}).filter(function(o){return o!=null});return[i,t]},ld=function(e){return e==null?"NULL":e.toString()},cd=function(e){return e==null||e?.[0]==="("&&e?.[e?.length-1]===")"?e:"("+e+")"};function dd(n,e){var t=typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(!t){if(Array.isArray(n)||(t=I0(n))||e&&n&&typeof n.length=="number"){t&&(n=t);var r=0,a=function(){};return{s:a,n:function(){return r>=n.length?{done:!0}:{done:!1,value:n[r++]}},e:function(l){throw l},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,o=!1,u;return{s:function(){t=t.call(n)},n:function(){var l=t.next();return i=l.done,l},e:function(l){o=!0,u=l},f:function(){try{!i&&t.return!=null&&t.return()}finally{if(o)throw u}}}}function I0(n,e){if(n){if(typeof n=="string")return fd(n,e);var t=Object.prototype.toString.call(n).slice(8,-1);if(t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set")return Array.from(n);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return fd(n,e)}}function fd(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=new Array(e);t<e;t++)r[t]=n[t];return r}function pd(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),t.push.apply(t,r)}return t}function vd(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?pd(Object(t),!0).forEach(function(r){(0,z.A)(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):pd(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}var gd="${0}.compareTo(${1})",D0={datetime:!0,time:!0,date:!0},V0=function(e,t){return hd(e,t,!1)},hd=function(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,a={errors:[]},i=gt(t,void 0,!1),o=md(e,i,a,null);return r?[o,a.errors]:(a.errors.length&&console.warn("Errors while exporting to SpEL:",a.errors),o)},md=function(e,t,r){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(e){var i=e.get("type");if(i==="group"||i==="rule_group")return bd(e,t,r,a);if(i==="rule")return M0(e,t,r,a);if(i=="switch_group")return N0(e,t,r,a);if(i=="case_group")return yd(e,t,r,a)}},yd=function(e,t,r){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null,i=e.get("type");if(i!="case_group"){r.errors.push("Unexpected child of type ".concat(i," inside switch"));return}var o=e.get("properties")||new Qe,u=Yu(t,o,r,null,a,"!case_value"),s=(0,ie.A)(u,3),l=s[0],c=s[1],d=s[2],f=bd(e,t,r,a);return[f,l]},N0=function(e,t,r){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null,i=e.get("properties")||new Qe,o=e.get("children1");if(o){var u=o.map(function(h){return yd(h,t,r,null)}).filter(function(h){return typeof h<"u"}).valueSeq().toArray();if(u.length){if(u.length==1&&!u[0][0])return u[0][1];for(var s=[],l=0;l<u.length;l++)l!=u.length-1&&!u[l][0]?r.errors.push("No condition for case ".concat(l)):(s.push(u[l]),l==u.length-1&&u[l][0]&&s.push([void 0,null]));for(var c="",d="",f=0;f<s.length;f++){var p=(0,ie.A)(s[f],2),v=p[0],g=p[1];g==null&&(g="null"),v==null&&(v="true"),f!=s.length-1?(c+="(".concat(v," ? ").concat(g," : "),d+=")"):c+="".concat(g)}return c+d}}},bd=function(e,t,r){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null,i=e.get("type"),o=e.get("properties")||new Qe,u=o.get("mode"),s=e.get("children1")||new Nt,l=o.get("field"),c=o.get("conjunction");c||(c=Cn(t));var d=t.conjunctions[c],f=o.get("not"),p=i==="rule_group",v=p&&u!="struct",g=v?l:a,h=oe(t,g)||{},y=h.isSpelArray,m=t.settings.fieldSeparator,b=o.get("operator");!b&&(!u||u=="some")&&(b="some");var O=Sd(t,b,l),S=O!=b,F=b&&Ie(t,O,l)||null,_=p&&(!O||F.cardinality==0),T=Yu(t,o,r,O,a,null),E=(0,ie.A)(T,3),A=E[0],j=E[1],R=E[2],L=s.map(function(q){return md(q,t,r,g)}).filter(function(q){return typeof q<"u"});if(v&&!_){if(A==null)return}else if(!L.size)return;var N=p,I=L.size?d.spelFormatConj.call(t.ctx,L,c,f,N):null,P;if(v){var x=Qu(r,t,l,a),k=m||".",V=k+(y?"length":"size()"),G="".concat(x).concat(V),$=I?"".concat(x,".?[").concat(I,"]").concat(V):G,W=_?G:A;P=Od(r,t,o,$,W,O,j,R,S)}else P=I;return P},k0=function(e,t,r){var a=t.spelOp;if(a){var i=a.includes("${0}"),o=D0[r],u=a,s,l=Cr(t);return o?s=function(d,f,p,v,g,h,y,m){var b=gd.replace(/\${(\w+)}/g,function(O,S){return S==0?d:l>1?p[S-1]:p});return"".concat(b," ").concat(u," 0")}:i?s=function(d,f,p,v,g,h,y,m){return a.replace(/\${(\w+)}/g,function(b,O){return O==0?d:l>1?p[O-1]:p})}:l==0?s=function(d,f,p,v,g,h,y,m){return"".concat(d," ").concat(u)}:l==1&&(s=function(d,f,p,v,g,h,y,m){return"".concat(d," ").concat(u," ").concat(p)}),s}},Od=function(e,t,r,a,i,o,u,s){var l=arguments.length>8&&arguments[8]!==void 0?arguments[8]:!1,c=r.get("field"),d=Ie(t,o,c)||{},f=oe(t,c)||{},p=r.get("operatorOptions"),v=d.spelFormatOp||k0(o,d,s);if(!v){e.errors.push("Operator ".concat(o," is not supported"));return}var g=[a,o,i,u,s,vt(d,va),p,f],h;return h=v.call.apply(v,[t.ctx].concat(g)),l&&(h=t.settings.spelFormatReverse.call(t.ctx,h)),h===void 0&&e.errors.push("Operator ".concat(o," is not supported for value source ").concat(u)),h},Sd=function(e,t,r){if(t){var a=Ie(e,t,r)||{},i=a.reversedOp,o=Ie(e,i,r)||{},u=!1,s=a.spelOp||a.spelFormatOp,l=o.spelOp||o.spelFormatOp;if(!(!s&&!l)){if(!s&&l){u=!0;var c=[i,t];t=c[0],i=c[1];var d=[o,a];a=d[0],o=d[1]}return t}}},M0=function(e,t,r){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null,i=e.get("properties")||new Qe,o=i.get("field"),u=i.get("fieldSrc"),s=i.get("operator");if(!(o==null||s==null)){var l=Sd(t,s,o);if(!l){r.errors.push("Operator ".concat(s," is not supported"));return}var c=l!=s,d=Yu(t,i,r,l,a,null),f=(0,ie.A)(d,3),p=f[0],v=f[1],g=f[2];if(p!==void 0){var h=$0(r,t,o,u,a);if(h!==void 0){var y=Od(r,t,i,h,p,l,v,g,c);return y}}}},$0=function(e,t,r,a){var i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:null;return a==="func"?Fd(e,t,r,i):Qu(e,t,r,i)},Yu=function(e,t,r,a,i){var o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:null,u=t.get("field"),s=t.get("valueSrc"),l=t.get("valueType");(o=="!case_value"||l&&l.get(0)=="case_value")&&(u="!case_value");var c=oe(e,u)||{},d=Ie(e,a,u)||{},f=Cr(d),p=t.get("value"),v=t.get("asyncListValues"),g=[],h=[],y;if(p!=null){var m=p.map(function(O,S){var F=s?s.get(S):null,_=l?l.get(S):null,T=zn(O,F,e),E=nr(e,u,a,F),A=Hr(e,u,a,E,F,{forExport:!0}),j=Ku(r,e,T,F,_,A,c,a,d,i,v);return j!==void 0&&(g.push(F),h.push(_)),j}),b=m.filter(function(O){return O===void 0}).size>0;m.size<f||b||(y=f>1?m.toArray():f==1?m.first():null)}return[y,g.length>1?g:g[0],h.length>1?h:h[0]]},Ku=function(e,t,r,a,i,o,u,s,l){var c=arguments.length>9&&arguments[9]!==void 0?arguments[9]:null,d=arguments.length>10?arguments[10]:void 0;if(r!==void 0){var f;if(a==="field")f=Qu(e,t,r,c);else if(a==="func")f=Fd(e,t,r,c);else if(typeof o?.spelFormatValue=="function"){var p=o.spelFormatValue,v=[r,vd(vd({},Ht()(u,["fieldSettings","listValues"])),{},{asyncListValues:d}),vt(o,Mn)];if(s&&(v.push(s),v.push(l)),a=="field"){var g=oe(t,r)||{};v.push(g)}f=p.call.apply(p,[t.ctx].concat(v))}else f=ya(r);return f}},Qu=function(e,t,r){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(r){var i=t.settings.fieldSeparator,o=oe(t,r)||{},u=mr(r,t),s=tp(r,t,a),l=t.settings.formatSpelField,c=un(r,t,e,a),d=s.map(function(p){var v=(0,ie.A)(p,3),g=v[0],h=v[1],y=v[2],m;y&&(y.type=="!struct"||y.type=="!group"&&y.mode=="struct"?m=h.isSpelMap?"map":"class":y.type=="!group"?m=h.isSpelItemMap?"[map]":"[class]":m="class");var b=h?.isSpelVariable;return{key:g,parent:m,isSpelVariable:b,fieldSeparator:i}}),f=l.call(t.ctx,c,a,u,d,o,t);return f}},Fd=function(e,t,r){var a,i,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null,u=(a=r.get)===null||a===void 0?void 0:a.call(r,"func"),s=(i=r.get)===null||i===void 0?void 0:i.call(r,"args"),l=Ar(t,u);if(!l){e.errors.push("Func ".concat(u," is not defined in config"));return}var c={},d=[],f=[];for(var p in l.args){var v,g,h=l.args[p],y=oe(t,h),m=h.defaultValue,b=h.isOptional,O=m!=null&&m.func?"func":"value",S=s?s.get(p):void 0,F=S?S.get("value"):void 0,_=S?S.get("valueSrc"):void 0;_!=="func"&&(v=F)!==null&&v!==void 0&&v.toJS&&(F=F.toJS());var T=S?S.get("asyncListValues"):void 0,E=(g=h.spelEscapeForFormat)!==null&&g!==void 0?g:!0,A=null,j=nr(t,h,A,_),R=Hr(t,h,A,j,_,{forExport:!0}),L=Ku(e,t,F,_,h.type,R,y,null,null,o,T);if(F!=null&&L===void 0){_!="func"&&e.errors.push("Can't format value of arg ".concat(p," for func ").concat(u));return}var N=void 0;if(L===void 0&&!b&&m!=null){var I=nr(t,h,A,O),P=Hr(t,h,A,I,O,{forExport:!0});if(N=Ku(e,t,m,O,h.type,P,y,null,null,o,T),N===void 0){O!="func"&&e.errors.push("Can't format default value of arg ".concat(p," for func ").concat(u));return}}var x=L??N;if(x!==void 0){var k;if(d.length){var V=dd(d),G;try{for(V.s();!(G=V.n()).done;){var $=G.value;c[$]=void 0}}catch(ae){V.e(ae)}finally{V.f()}d=[]}c[p]=E?x:(k=F)!==null&&k!==void 0?k:m}else b||f.push(p),d.push(p)}if(!f.length){var W;if(typeof l.spelFormatFunc=="function"){var q=l.spelFormatFunc,J=[c];W=q.call.apply(q,[t.ctx].concat(J))}else if(l.spelFunc){W=l.spelFunc.replace(/\${(\w+)}/g,function(ae,ge){var se;return(se=c[ge])!==null&&se!==void 0?se:ae});var K=Object.keys(l.args||{}).reverse().filter(function(ae){return!!l.args[ae].isOptional}),U=dd(K),X;try{for(U.s();!(X=U.n()).done;){var Y=X.value;if(c[Y]!=null)break;W=W.replace(new RegExp("(, )?\\${"+Y+"}","g"),"")}}catch(ae){U.e(ae)}finally{U.f()}W=W.replace(/\${(\w+)}/g,"null")}else e.errors.push("Func ".concat(u," is not supported"));return W}};function Jt(n,e){var t=typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(!t){if(Array.isArray(n)||(t=G0(n))||e&&n&&typeof n.length=="number"){t&&(n=t);var r=0,a=function(){};return{s:a,n:function(){return r>=n.length?{done:!0}:{done:!1,value:n[r++]}},e:function(l){throw l},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,o=!1,u;return{s:function(){t=t.call(n)},n:function(){var l=t.next();return i=l.done,l},e:function(l){o=!0,u=l},f:function(){try{!i&&t.return!=null&&t.return()}finally{if(o)throw u}}}}function G0(n,e){if(n){if(typeof n=="string")return _d(n,e);var t=Object.prototype.toString.call(n).slice(8,-1);if(t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set")return Array.from(n);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return _d(n,e)}}function _d(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=new Array(e);t<e;t++)r[t]=n[t];return r}function Cd(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),t.push.apply(t,r)}return t}function lr(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Cd(Object(t),!0).forEach(function(r){(0,z.A)(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Cd(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}var wd={number:"number",string:"text",boolean:"boolean",null:"null"},Ad={String:"text"},z0="multiselect",U0=function(e){return["length"].includes(e)},Ed=function(e){return(0,We.A)(e)=="object"&&e!==null&&!Array.isArray(e)},W0=function(e,t){return Ld(e,t,!0)},Ld=function(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,a={errors:[]},i=gt(t,void 0,!1),o=H0(i),u,s,l=void 0;try{var c=E0.SpelExpressionEvaluator.compile(e);u=c._compiledExpression}catch(f){a.errors.push(f)}u&&(s=B0(u,a),On.debug("convertedObj:",s,a),l=li(s,o,i,a),l&&l.type!="group"&&l.type!="switch_group"&&(l=di(l,i,s.not)),On.debug("jsTree:",l));var d=l?Hu(l):void 0;return r?[d,a.errors]:(a.errors.length&&console.warn("Errors while importing from SpEL:",a.errors),d)},B0=function n(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null,a=e.getType(),i=e.getChildren().map(function(L){return n(L,t,e)});if((a=="op-or"||a=="op-and")&&(i=i.reduce(function(L,N){var I=N.type==a&&!N.not,P=I?N.children:[N];return[].concat((0,Q.A)(L),(0,Q.A)(P))},[])),a=="op-not")return i.length!=1&&t.errors.push("Operator NOT should have 1 child, but got ".concat(i.length,"}")),lr(lr({},i[0]),{},{not:!i[0].not});if(a=="compound"){i=i.filter(function(L){var N=L.type=="selection"&&L.children.length==1&&L.children[0].type=="boolean"&&L.children[0].val==!0;return!N});var o=i.find(function(L){return L.type=="selection"});o&&o.children.length!=1&&t.errors.push("Selection should have 1 child, but got ".concat(o.children.length));var u=o?o.children[0]:null,s=i[i.length-1],l=s.type=="method"&&s.val.methodName=="size"||s.type=="!func"&&s.methodName=="size",c=s.type=="property"&&s.val=="length",d=i.filter(function(L){return L!==o&&L!==s}),f={type:"compound",children:d},p=(l||c)&&Td(d)!=null;if(p)return{type:"!aggr",filter:u,source:f};if(i=i.filter(function(L){var N=L.type=="variable"&&L.val=="this",I=L.type=="variable"&&L.val=="root";return!(N||I)}),i=i.map(function(L){return L.type=="indexer"&&L.children.length==1?{type:"indexer",val:L.children[0].val,itype:L.children[0].type}:L}),s.type=="!func"){var v={},g=v;do{var h,y;Object.assign(g,s),i=i.filter(function(L){return L!==s}),s=i[i.length-1],((y=s)===null||y===void 0?void 0:y.type)=="!func"?(g.obj={},g=g.obj):i.length>1?g.obj={type:"compound",children:i}:g.obj=s}while(((h=s)===null||h===void 0?void 0:h.type)=="!func");return v}}var m;try{e.getRaw?m=e.getRaw():e.getValue.length==0&&(m=e.getValue())}catch(L){On.error("[spel2js] Error in getValue()",L)}if(a=="ternary"&&(m=q0(i)),(0,We.A)(m)==="object"&&m!==null&&(m.methodName||m.functionName)&&(m.args=m.args.map(function(L){return n(L,t,e)})),a=="list"&&(m=m.map(function(L){return n(L,t,e)}),!r&&m.length==1))return m[0];if(a=="constructorref"){var b=i.find(function(L){return L.type=="qualifiedidentifier"}),O=b?.val;if(!O){t.errors.push("Can't find qualifiedidentifier in constructorref children: ".concat(JSON.stringify(i)));return}var S=i.filter(function(L){return L.type!="qualifiedidentifier"});return{type:"!new",cls:O,args:S}}if(a=="typeref"){var F=i.find(function(L){return L.type=="qualifiedidentifier"}),_=F?.val;if(!_){t.errors.push("Can't find qualifiedidentifier in typeref children: ".concat(JSON.stringify(i)));return}var T=i.filter(function(L){return L.type!="qualifiedidentifier"});return{type:"!type",cls:_}}if(a=="function"||a=="method"){var E=m,A=E.functionName,j=E.methodName,R=E.args;return{type:"!func",methodName:A||j,isVar:a=="function",args:R}}return{type:a,children:i,val:m}},q0=function(e){var t=[];function r(a){var i=(0,ie.A)(a,3),o=i[0],u=i[1],s=i[2];t.push([o,u]),s?.type=="ternary"?r(s.children):t.push([void 0,s])}return r(e),t},H0=function(e){var t={},r=function(I){var P=e.operators[I];if(P.spelOps)P.spelOps.forEach(function(k){var V=k;t[V]||(t[V]=[]),t[V].push(I)});else if(P.spelOp){var x=P.spelOp;t[x]||(t[x]=[]),t[x].push(I)}else On.log("[spel] No spelOp for operator ".concat(I))};for(var a in e.operators)r(a);var i={};for(var o in e.conjunctions){var u=e.conjunctions[o],s=u.spelConj||o.toLowerCase();i[s]=o}var l={},c=Jt(Aa(e)),d;try{var f=function(){var I=(0,ie.A)(d.value,2),P=I[0],x=I[1],k=[],V=x.spelFunc;if(typeof V=="string"){var G=Object.keys(x.args||{}).reverse().filter(function(U){return!!x.args[U].isOptional||x.args[U].defaultValue!=null}),$=V.replace(/\${(\w+)}/g,function(U,X){return"?"}),W=G.reduce(function(U,X){return[].concat((0,Q.A)(U),[[X].concat((0,Q.A)(U[U.length-1]||[]))])},[]).map(function(U){return V.replace(/(?:, )?\${(\w+)}/g,function(X,Y){return U.includes(Y)?"":X}).replace(/\${(\w+)}/g,function(X,Y){return"?"})});k=[$].concat((0,Q.A)(W))}var q=Jt(k),J;try{for(q.s();!(J=q.n()).done;){var K=J.value;l[K]||(l[K]=[]),l[K].push(P)}}catch(U){q.e(U)}finally{q.f()}};for(c.s();!(d=c.n()).done;)f()}catch(N){c.e(N)}finally{c.f()}var p={};for(var v in e.widgets){var g=e.widgets[v],h=g.spelImportFuncs,y=g.type;if(h){var m=Jt(h),b;try{for(m.s();!(b=m.n()).done;){var O=b.value;if(typeof O=="string"){var S=O.replace(/\${(\w+)}/g,function(N,I){return"?"}),F=(0,Q.A)(O.matchAll(/\${(\w+)}/g)).map(function(N){var I=(0,ie.A)(N,2),P=I[0],x=I[1];return x});p[S]||(p[S]=[]),p[S].push({w:v,argsOrder:F})}}}catch(N){m.e(N)}finally{m.f()}}}var _={};for(var T in e.operators){var E=e.operators[T],A=E.spelOp;if(A!=null&&A.includes("${0}")){var j=A.replace(/\${(\w+)}/g,function(N,I){return"?"}),R=(0,Q.A)(A.matchAll(/\${(\w+)}/g)).map(function(N){var I=(0,ie.A)(N,2),P=I[0],x=I[1];return x});_[j]||(_[j]=[]),_[j].push({op:T,argsOrder:R})}}var L=gd.replace(/\${(\w+)}/g,function(N,I){return"?"});return _[L]=[{op:"!compare",argsOrder:["0","1"]}],{operators:t,conjunctions:i,funcs:l,valueFuncs:p,opFuncs:_}},li=function n(e,t,r,a){var i,o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:null;if(e){e._groupField=(i=e._groupField)!==null&&i!==void 0?i:o?._groupField;var u,s=!0;if(e.type.indexOf("op-")===0||e.type==="matches")u=J0(e,t,r,a,o);else if(e.type=="!aggr"){var l,c=n(e.source,t,r,a,e);e._groupField=c?.value;var d=n(e.filter,t,r,a,e);((l=d)===null||l===void 0?void 0:l.type)=="rule"&&(d=di(d,r,e.filter.not)),u={groupFilter:d,groupFieldValue:c},o||(u=void 0,a.errors.push("Unexpected !aggr in root"),s=!1)}else if(e.type=="ternary"){var f={};e.val.forEach(function(v){var g=(0,ie.A)(v,2),h=g[0],y=g[1],m=Rd(h,y,t,r,a,e);m&&(f[m.id]=m)}),u={type:"switch_group",id:Ve(),children1:f,properties:{}}}if(!u&&s&&(u=ci(e,t,r,a,o)),u&&!u.type&&!o){var p=jd(e,t,r,a);p?u=p:(u=void 0,a.errors.push("Can't convert rule of type ".concat(e.type,", it looks like var/literal")))}return u}},J0=function n(e,t,r,a){var i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:null,o,u=e.type.startsWith("op-")?e.type.slice(3):e.type,s=(u=="minus"||u=="plus")&&e.children.length==1;if(s){var l=e.negative;return u=="minus"&&(l=!l),e.children[0].negative=l,li(e.children[0],t,r,a,i)}var c=u=="and"&&e.children.length==2&&e.children[0].type=="op-ge"&&e.children[1].type=="op-le",d=u=="or"&&e.children.length==2&&e.children[0].type=="op-lt"&&e.children[1].type=="op-gt",f=c||d;if(f){var p=(0,ie.A)(e.children[0].children,2),v=p[0],g=p[1],h=(0,ie.A)(e.children[1].children,2),y=h[0],m=h[1],b=rb(v,y,e,t,r,a,i);if(b){var O=g.val,S=m.val,F={type:"op-between",children:[v,g,m],not:d};return F._groupField=i?._groupField,n(F,t,r,a,i)}}var _=t.operators[u];u=="eq"&&e.children[1].type=="null"?_=["is_null"]:u=="ne"&&e.children[1].type=="null"?_=["is_not_null"]:u=="le"&&e.children[1].type=="string"&&e.children[1].val==""?_=["is_empty"]:u=="gt"&&e.children[1].type=="string"&&e.children[1].val==""?_=["is_not_empty"]:u=="between"&&(_=["between"]);var T=function(){var ve,ye=e.children.map(function(Ce){return li(Ce,t,r,a,e)});return ye.length>=2&&((ve=ye)===null||ve===void 0||(ve=ve[0])===null||ve===void 0?void 0:ve.type)=="!compare"&&(ye=ye[0].children),ye};if(u=="and"||u=="or"){var E={},A=T();A.forEach(function(ne){if(ne){var ve=Ve();ne.id=ve,ne.type!=null?E[ve]=ne:a.errors.push("Bad item in AND/OR: ".concat(JSON.stringify(ne)))}}),o={type:"group",id:Ve(),children1:E,properties:{conjunction:t.conjunctions[u],not:e.not}}}else if(_){var j,R,L,N=T(),I=N[0],P=N.slice(1),x=I==null||(j=I.groupFieldValue)===null||j===void 0?void 0:j.value,k=(R=P)===null||R===void 0?void 0:R[0],V=_[0];if(_.length>1){var G,$,W=((G=N[0])===null||G===void 0?void 0:G.valueType)||(($=N[1])===null||$===void 0?void 0:$.valueType),q=I?.value,J=_.map(function(ne){return{op:ne,widget:nr(r,q,ne)}});if(On.warn("[spel] Spel operator ".concat(u," can be mapped to ").concat(_,"."),"widgets:",J,"vals:",N,"valueType=",W),u=="eq"||u=="ne"){var K=J.find(function(ne){var ve=ne.op,ye=ne.widget;return ye&&ye!="field"});K&&(V=K.op)}}I!=null&&I.groupFieldValue&&(k&&k.groupFieldValue&&k.groupFieldValue.valueSrc=="field"&&k.groupFieldValue.value==x?(V="all",P=[]):V=="equal"&&k.valueSrc=="value"&&k.valueType=="number"&&k.value==0?(V="none",P=[]):V=="greater"&&k.valueSrc=="value"&&k.valueType=="number"&&k.value==0&&(V="some",P=[]));var U=r.operators[V],X=r.operators[(L=U)===null||L===void 0?void 0:L.reversedOp],Y=e.not&&["between"].includes(V),ae=!!X,ge=ae&&(!!r.settings.reverseOperatorsForNot||Y),se=e.not&&ge||Y;se&&(V=U.reversedOp,U=r.operators[V],e.not=!e.not);var ce=!!e.not;if(e.not=!1,I)if(I.groupFieldValue)I.groupFieldValue.valueSrc!="field"&&a.errors.push("Expected group field ".concat(JSON.stringify(I))),o=eb(I,V,P,r,a);else{I.valueSrc!="field"&&I.valueSrc!="func"&&a.errors.push("Expected field/func at LHS, but got ".concat(JSON.stringify(I)));var de=I.value;o=Xu(r,a,de,V,P,e)}ce&&(o.type!=="group"?o=di(o,r,!0):o.properties.not=!o.properties.not)}else i||(o=jd(e,t,r,a));return o},Td=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,a=!1,i=e.map(function(o){if(o.type=="variable"||o.type=="property"||o.type=="indexer"&&o.itype=="string")return o.val;var u,s;a=!0,r&&(t==null||(u=t.errors)===null||u===void 0||(s=u.push)===null||s===void 0||s.call(u,"Unexpected item in field path compound: ".concat(JSON.stringify(o))))});return a?void 0:i},ci=function n(e,t,r,a){var i,o,u=arguments.length>4&&arguments[4]!==void 0?arguments[4]:null;if(e!=null){var s=r.settings.fieldSeparator;if(e._groupField=(i=e._groupField)!==null&&i!==void 0?i:u?._groupField,e.type=="variable"||e.type=="property"){var l=go(r,e.val,e._groupField),c=oe(r,l),d=e.type=="variable";return{valueSrc:"field",valueType:c?.type,isVariable:d,value:l}}else if(e.type=="compound"){var f=Td(e.children,a);if(f){var p,v=go(r,f.join(s),e._groupField),g=oe(r,v),h=((p=e.children)===null||p===void 0||(p=p[0])===null||p===void 0?void 0:p.type)=="variable";return{valueSrc:"field",valueType:g?.type,isVariable:h,value:v}}}else if(wd[e.type]){var y=e.val,m=wd[e.type];return e.negative&&(y=-y),{valueSrc:"value",valueType:m,value:y}}else if(e.type=="!new"&&Ad[e.cls.at(-1)]){var b=e.args.map(function(R){return n(R,t,r,a,e)}),O=b?.[0],S=Ad[e.cls.at(-1)];return lr(lr({},O),{},{valueType:S})}else if(e.type=="list"){var F,_=e.val.map(function(R){return n(R,t,r,a,e)}),T=_.length?(F=_[0])===null||F===void 0?void 0:F.valueType:null,E=_.map(function(R){return R?.value}),A=z0;return{valueSrc:"value",valueType:A,value:E}}else if(e.type==="op-plus"&&u?.type==="ternary"&&((o=r.settings.caseValueField)===null||o===void 0?void 0:o.type)==="case_value")return xd(e,t,r,a);var j=Q0(e,t,r,a,u);if(j!==void 0)return j;a.errors.push("Can't convert arg of type ".concat(e.type))}},Y0=function(e){var t=[{s:"",params:[],objs:[]}];return K0(e,t),t.map(function(r){var a=r.s,i=r.params;return{s:a,params:i}}).reverse().filter(function(r){var a=r.s;return a!==""&&a!=="?"})},K0=function n(e,t){var r=[],a="",i=e.type,o=e.methodName,u=e.val,s=e.obj,l=e.args,c=e.isVar,d=e.cls,f=e.children,p=f?.[f.length-1],v=t[t.length-1];if(i==="!func"){for(var g=s;g;){var h,y=n(lr(lr({},g),{},{obj:null}),[{}]),m=(0,ie.A)(y,2),b=m[0],O=m[1];if(b!=="?"){var S={s:v.s,params:(0,Q.A)(v.params),objs:(0,Q.A)(v.objs)};v.objs.unshift("?"),v.params.unshift(g),t.push(S),v=t[t.length-1]}v.objs.unshift(b),(h=v.params).unshift.apply(h,(0,Q.A)(O)),g=g.type==="!func"?g.obj:null}var F=Jt(t),_;try{for(F.s();!(_=F.n()).done;){var T,E=_.value;r=[].concat((0,Q.A)(E?.params||[]),(0,Q.A)(l||[])),a="",E!=null&&(T=E.objs)!==null&&T!==void 0&&T.length&&(a+=E.objs.join(".")+"."),a+=(c?"#":"")+o,a+="("+(l||[]).map(function(A){return"?"}).join(", ")+")",E.s=a,E.params=r}}catch(A){F.e(A)}finally{F.f()}}else i==="!new"?(r=l||[],a="new ".concat(d.join("."),"(").concat(r.map(function(A){return"?"}).join(", "),")")):i==="!type"?a="T(".concat(d.join("."),")"):i==="compound"&&p.type==="property"&&U0(p.val)?a=f.map(function(A){var j;if(A===p)return A.val;var R=n(lr(lr({},A),{},{obj:null}),[{}]),L=(0,ie.A)(R,2),N=L[0],I=L[1];return(j=r).push.apply(j,(0,Q.A)(I)),N}).join("."):(r=[e],a="?");return v&&(v.s=a,v.params=r),[a,r]},Q0=function(e,t,r,a){var i,o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:null,u=function(P){return li(P,t,r,a,e)},s=Y0(e),l=s==null||(i=s[0])===null||i===void 0?void 0:i.s;s.length&&On.debug("Signatures for ",e,":",l,s);var c=X0(e,t,r,a,o,s,u);if(c!==void 0)return c;var d=Z0(e,t,r,a,o,s,u);if(d!==void 0)return d;var f,p,v,g=Jt(s),h;try{var y=function(){var P=h.value,x=P.s,k=P.params,V=t.funcs[x];if(V){f=V[0],p=Ar(r,f);var G=p,$=G.spelFunc,W=k.map(u),q=(0,Q.A)($.matchAll(/\${(\w+)}/g)).map(function(J){var K=(0,ie.A)(J,2),U=K[0],X=K[1];return X});return v=Object.fromEntries(q.map(function(J,K){return[J,W[K]]})),1}};for(g.s();!(h=g.n()).done&&!y(););}catch(I){g.e(I)}finally{g.f()}if(!f){var m=Jt(Aa(r)),b;try{for(m.s();!(b=m.n()).done;){var O=(0,ie.A)(b.value,2),S=O[0],F=O[1];if(F.spelImport){var _=void 0;try{_=F.spelImport(e)}catch{}if(_){f=S,p=Ar(r,f),v={};for(var T in _)v[T]=u(_[T])}}}}catch(I){m.e(I)}finally{m.f()}}if(f){var E={};for(var A in p.args){var j=p.args[A],R=v[A];if(R===void 0)if(R=j?.defaultValue,R===void 0){if(!(j!=null&&j.isOptional)){a.errors.push("No value for arg ".concat(A," of func ").concat(f));return}}else{var L;R={value:R,valueSrc:(L=R)!==null&&L!==void 0&&L.func?"func":"value",valueType:j.type}}R&&(E[A]=R)}return{valueSrc:"func",value:{func:f,args:E},valueType:p.returnType}}var N=e.methodName;N&&a.errors.push("Signature ".concat(l," - failed to convert"))},X0=function(e,t,r,a,i,o,u){var s,l,c,d=[];for(var f in r.widgets){var p=r.widgets[f],v=p.spelImportFuncs;if(v)for(var g=0;g<v.length;g++){var h=v[g];if(Ed(h)){var y={};if(Nc(h,e,y)){for(var m in y)y[m]=u(y[m]);d.push({s:"widgets.".concat(f,".spelImportFuncs[").concat(g,"]"),w:f,argsObj:y})}}}}var b=Jt(o),O;try{for(b.s();!(O=b.n()).done;){var S=O.value,F=S.s,_=S.params,T=t.valueFuncs[F]||[],E=Jt(T),A;try{var j=function(){var U=A.value,X=U.w,Y=U.argsOrder,ae=_.map(u),ge=Object.fromEntries(Y.map(function(se,ce){return[se,ae[ce]]}));d.push({s:F,w:X,argsObj:ge})};for(E.s();!(A=E.n()).done;)j()}catch(K){E.e(K)}finally{E.f()}}}catch(K){b.e(K)}finally{b.f()}for(var R=0,L=d;R<L.length;R++){var N=L[R],I=N.s,P=N.w,x=N.argsObj,k=r.widgets[P],V=k.spelImportValue,G=k.type;c=P,l=I,s=[];for(var $ in x)["value"].includes(x[$].valueSrc)||s.push("".concat($," has unsupported value src ").concat(x[$].valueSrc));var W=x.v.value;if(V&&!s.length){var q=V.call(r.ctx,x.v,k,x),J=(0,ie.A)(q,2);W=J[0],s=J[1],s&&!Array.isArray(s)&&(s=[s])}if(!s.length)return{valueSrc:"value",valueType:G,value:W}}c&&s.length&&a.errors.push("Signature ".concat(l," - looks like convertable to ").concat(c,", but: ").concat(s.join("; ")))},Z0=function(e,t,r,a,i,o,u){var s,l,c,d=Jt(o),f;try{for(d.s();!(f=d.n()).done;){var p=f.value,v=p.s,g=p.params,h=t.opFuncs[v]||[],y=Jt(h),m;try{var b=function(){var F,_=m.value,T=_.op,E=_.argsOrder,A=g.map(u);if(l=T,T==="!compare"){if(i.type.startsWith("op-")&&i.children.length==2&&i.children[1].type=="number"&&i.children[1].val===0)return{v:{type:"!compare",children:A}};s.push("Result of compareTo() should be compared to 0")}c=v,s=[];var j=r.operators[l],R=j.spelOp,L=j.valueTypes,N=Object.fromEntries(E.map(function(k,V){return[k,A[V]]})),I=N[0],P=Object.keys(N).filter(function(k){return parseInt(k)>0}).map(function(k){return N[k]}),x=(F=A.filter(function(k){return!!k}).find(function(k){var V=k.valueSrc;return V==="value"}))===null||F===void 0?void 0:F.valueType;if(L&&x&&!L.includes(x)&&s.push("Op supports types ".concat(L,", but got ").concat(x)),!s.length)return{v:Xu(r,a,I,l,P,e)}},O;for(y.s();!(m=y.n()).done;)if(O=b(),O)return O.v}catch(S){y.e(S)}finally{y.f()}}}catch(S){d.e(S)}finally{d.f()}l&&s.length&&a.errors.push("Signature ".concat(c," - looks like convertable to ").concat(l,", but: ").concat(s.join("; ")))},Xu=function(e,t,r,a,i,o){var u,s;if(!i.filter(function(j){return j===void 0}).length){var l=(u=r)!==null&&u!==void 0&&u.func?"func":"field";Ed(r)&&r.valueSrc&&(l=r.valueSrc,r=r.value);var c=oe(e,r);if(!c){t.errors.push("No config for field ".concat(r));return}var d=oe(e,o?._groupField),f=c.type=="!group",p=f&&c.mode=="array",v=d?.type=="!group",g=e.operators[a],h=e.operators[(s=g)===null||s===void 0?void 0:s.reversedOp],y=o?.not&&["between"].includes(a),m=!!h,b=m&&(!!e.settings.reverseOperatorsForNot||y||!f&&v),O=o?.not&&b||y;O&&(a=g.reversedOp,g=e.operators[a],o.not=!o.not);var S=!!(o!=null&&o.not),F=nr(e,r,a),_=e.widgets[F||c.mainWidget],T=i.map(function(j){return j.asyncListValues}).filter(function(j){return j!=null}),E=T.length?T[0]:void 0,A={type:"rule",id:Ve(),properties:lr({field:r,fieldSrc:l,operator:a,value:i.map(function(j){return j.value}),valueSrc:i.map(function(j){return j.valueSrc}),valueType:i.map(function(j){return j.valueSrc=="value"&&(_?.type||c?.type)||j.valueType})},E?{asyncListValues:E}:{})};return S&&(A=di(A,e,o.not)),A}},eb=function(e,t,r,a,i){var o=e.groupFilter,u=e.groupFieldValue;if(u.valueSrc!="field")throw"Bad groupFieldValue: ".concat(JSON.stringify(u));var s=u.value,l=Xu(a,i,s,t,r);if(l){var c=oe(a,s),d=c?.mode,f;return o?.type==="group"?f=lr(lr({},o||{}),{},{type:"rule_group",properties:lr(lr(lr({},l.properties),o?.properties||{}),{},{mode:d})}):o?f=lr(lr({},l||{}),{},{type:"rule_group",children1:[o],properties:lr(lr({},l.properties),{},{mode:d})}):f=lr(lr({},l||{}),{},{type:"rule_group",properties:lr(lr({},l.properties),{},{mode:d})}),f.id||(f.id=Ve()),f}},rb=function(e,t,r,a,i,o){if(e.type==t.type)if(e.type=="!aggr"){var u=[e.source,t.source].map(function(g){return ci(g,a,i,o,r)}),s=(0,ie.A)(u,2),l=s[0],c=s[1];return l.value==c.value}else{var d=[e,t].map(function(g){return ci(g,a,i,o,r)}),f=(0,ie.A)(d,2),p=f[0],v=f[1];return p.value==v.value}return!1},jd=function(e,t,r,a){var i={},o=null,u=Rd(o,e,t,r,a);u&&(i[u.id]=u);var s={type:"switch_group",id:Ve(),children1:i,properties:{}};return s},Rd=function(e,t,r,a,i){var o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:null,u=tb(a,i,r,t,o),s;return e?(s=li(e,r,a,i,o),s&&s.type?(s.type!="group"&&(s=di(s,a)),s.type="case_group"):(i.errors.push("Unexpected case: ".concat(JSON.stringify(s))),s=void 0)):s={id:Ve(),type:"case_group",properties:{}},s&&(s.properties=lr(lr({},s.properties),u)),s},xd=function(e,t,r,a){var i=[];function o(u){u.map(function(s){if(s.type==="op-plus")o(s.children);else{var l=ci(s,t,r,a,e);l?i.push(l):a.errors.push("Can't convert ".concat(s.type," in concatenation"))}})}return o(e.children),{valueSrc:"value",valueType:"case_value",value:i}},tb=function(e,t,r,a){var i,o,u=arguments.length>4&&arguments[4]!==void 0?arguments[4]:null,s={},l,c,d,f=oe(e,"!case_value");if(a?.type==="op-plus"&&((i=e.settings.caseValueField)===null||i===void 0?void 0:i.type)==="case_value")c="case_value",l=xd(a,r,e,t);else if(c=f?.mainWidget,d=e.widgets[c],l=ci(a,r,e,t,u),l&&l.valueSrc==="value"){var p;l.valueType=((p=d)===null||p===void 0?void 0:p.type)||f?.type||l.valueType}var v=e.widgets[c];if(c==="case_value"){var g=v?.spelImportValue;if(g){var h=g.call(e.ctx,l),y=(0,ie.A)(h,2),m=y[0],b=y[1];if(b.map(function(S){return t.errors.push(S)}),m!=null){var O;s={value:[m],valueSrc:["value"],valueType:[(O=v?.type)!==null&&O!==void 0?O:"case_value"],field:"!case_value"}}}}else l!=null&&((o=l)===null||o===void 0?void 0:o.value)!=null&&(s={value:[l.value],valueSrc:[l.valueSrc],valueType:[l.valueType],field:"!case_value"});return s},di=function(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return{type:"group",id:Ve(),children1:(0,z.A)({},e.id,e),properties:{conjunction:an(t),not:r||!1}}};function Pd(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),t.push.apply(t,r)}return t}function nb(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Pd(Object(t),!0).forEach(function(r){(0,z.A)(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Pd(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}var Id=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null,a=e.settings.defaultField,i=(r?Dd(e,r):a)||t&&Pp(e,r)||null;return i!=null&&typeof i!="string"&&!ga(i)&&(i=ui(i)),i},Dd=function(e){var t,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(!r)return null;var a=(e==null||(t=e.settings)===null||t===void 0?void 0:t.fieldSeparator)||".",i=oe(e,r),o=i?.defaultField;return o&&(o=[].concat((0,Q.A)(mr(r)),[o]).join(a)),o},Zu=function(e){var t,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return r&&((t=e.settings.fieldSources)===null||t===void 0?void 0:t[0])||"field"},es=function(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,a=oe(e,t),i=a?.operators||[],o=e.settings.defaultOperator;o&&!i.includes(o)&&(o=null);var u=a?.defaultOperator,s=a?.ownDefaultOperator,l=r?ps(e,t):null,c=s||o||u||l;return c},fi=function(e,t,r){var a=t?Ie(e,t,r):null;return a&&a.options?new pe.Map(a.options&&a.options.defaults||{}):null},Yt=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null,a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1,o=null,u=null,s=null,l=e.settings.showErrorMessage;if(r){var c,d,f;s=r==null||(c=r.properties)===null||c===void 0?void 0:c.fieldSrc,o=r==null||(d=r.properties)===null||d===void 0?void 0:d.field,u=r==null||(f=r.properties)===null||f===void 0?void 0:f.operator}else a?(o=Id(e,i,t),o?s=ga(o)?"func":"field":s=Zu(e),u=es(e,o,!0)):s=Zu(e);var p=new pe.Map({fieldSrc:s,field:o,operator:u,value:new pe.List,valueSrc:new pe.List,operatorOptions:fi(e,u,o)});if(l&&(p=p.set("valueError",new pe.List)),o&&u){var v=!1,g=$n(e,e,p,o,u,"operator",v),h=g.newValue,y=g.newValueSrc,m=g.newValueType,b=g.newValueError,O=g.newFieldError;p=p.set("value",h).set("valueSrc",y).set("valueType",m),l&&(p=p.set("valueError",b).set("fieldError",O))}var S=oe(e,o);if(S?.type==="!group"){var F=an(e,S);p=p.set("conjunction",F)}return p},an=function(e){var t,r,a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;a=oe(e,a);var i=((t=a)===null||t===void 0?void 0:t.conjunctions)||Object.keys(e.conjunctions);return i.length==1?i[0]:((r=a)===null||r===void 0?void 0:r.defaultConjunction)||e.settings.defaultConjunction||e.settings.defaultGroupConjunction||i[0]},Cn=function(e){return an(e)},wn=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;return new pe.Map({conjunction:an(e,t),not:!1})},Vd=function(e,t){return t?.type=="group"?wn(e):Yt(e,null,t)},Nd=function(e,t){return(0,z.A)({},e,new pe.Map({type:"rule",id:e,properties:Yt(t)}))},ab=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return new pe.Map({type:"group",id:Ve(),children1:new pe.OrderedMap(t?nb({},Nd(Ve(),e)):{}),properties:wn(e)})},ib=function(e){return qi(e)?e:kd([e])},kd=function(e){return qi(e)?e:new pe.List(e)},ob=function(){return new pe.Map};function Md(n,e){var t=typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(!t){if(Array.isArray(n)||(t=ub(n))||e&&n&&typeof n.length=="number"){t&&(n=t);var r=0,a=function(){};return{s:a,n:function(){return r>=n.length?{done:!0}:{done:!1,value:n[r++]}},e:function(l){throw l},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,o=!1,u;return{s:function(){t=t.call(n)},n:function(){var l=t.next();return i=l.done,l},e:function(l){o=!0,u=l},f:function(){try{!i&&t.return!=null&&t.return()}finally{if(o)throw u}}}}function ub(n,e){if(n){if(typeof n=="string")return $d(n,e);var t=Object.prototype.toString.call(n).slice(8,-1);if(t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set")return Array.from(n);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return $d(n,e)}}function $d(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=new Array(e);t<e;t++)r[t]=n[t];return r}function Gd(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),t.push.apply(t,r)}return t}function zd(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Gd(Object(t),!0).forEach(function(r){(0,z.A)(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Gd(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}var Ud=function(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,i={errors:[],settings:{isForDisplay:r,isDebugMode:a}},o=gt(t,void 0,!1),u=Wd(e,o,i,null);return i.errors.length&&console.warn("Errors while exporting to string:",i.errors),u},Wd=function(e,t,r){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(e){var i=e.get("type"),o=e.get("children1");if(i==="group"||i==="rule_group")return sb(e,t,r,a);if(i==="rule")return Bd(e,t,r,a)}},sb=function(e,t,r){var a,i,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null,u=r.settings,s=u.isForDisplay,l=u.isDebugMode,c=e.get("type"),d=e.get("properties")||new Qe,f=d.get("mode"),p=e.get("children1")||new Nt,v=c==="rule_group",g=v&&f=="array"?d.get("field"):null,h=c==="rule_group"?d.get("operator"):null,y=h?(a=(i=t.operators[h])===null||i===void 0?void 0:i.cardinality)!==null&&a!==void 0?a:1:void 0,m=v&&f==="array"&&y>=1,b=d.get("not"),O=p.map(function(L){return Wd(L,t,r,g)}).filter(function(L){return typeof L<"u"});if(!(!m&&!O.size&&!l)){var S=d.get("conjunction");S||(S=Cn(t));var F=t.conjunctions[S],_=O.size?F.formatConj.call(t.ctx,O,S,b,s):null,T;if(g){var E=Bd(e,t,r,o,!0);if(E){var A,j=E.pop(),R=[_].concat((0,Q.A)(E));T=(A=t.settings.formatAggr).call.apply(A,[t.ctx].concat((0,Q.A)(R))),j&&(T=t.settings.formatReverse.call(t.ctx,T,null,null,null,null,s))}}else T=_;return l&&T==null&&(T="?"),T}},lb=function(e,t,r,a,i){var o=r.settings,u=o.isForDisplay,s=o.isDebugMode,l=t.get("field"),c=t.get("valueSrc"),d=t.get("valueType"),f=oe(e,l)||{},p=a||t.get("operator"),v=Ie(e,p,l)||{},g=Cr(v),h=t.get("value"),y=t.get("asyncListValues"),m=[],b=[],O,S;if(h!=null){S=h.map(function(T,E){var A=c?c.get(E):null,j=d?d.get(E):null,R=s?T:zn(T,A,e),L=nr(e,l,p,A),N=Hr(e,l,p,L,A,{forExport:!0}),I=rs(e,r,R,A,j,N,f,p,v,i,y);return I!==void 0&&(m.push(A),b.push(j)),I});var F=S.filter(function(T){return T===void 0}).size>0,_=!F&&S.size===g;_&&(O=g==1?S.first():S)}return s&&!O&&(O=g>1?new Nt(Array.from({length:g}).map(function(T,E){var A,j;return(A=(j=S)===null||j===void 0?void 0:j.get(E))!==null&&A!==void 0?A:"?"})):"?"),[O,m.length>1?m:m[0],b.length>1?b:b[0]]},cb=function(e,t,r){var a=r.settings.isDebugMode,i=t?.labelForFormat||e,o=Cr(t),u;return o==0?u=function(l,c,d,f,p,v,g,h){return"".concat(l," ").concat(i)}:o==1?u=function(l,c,d,f,p,v,g,h){return a&&c==="?"&&d==="?"?l&&l!=="?"?"".concat(l," ?"):"?":"".concat(l," ").concat(i," ").concat(d)}:o==2&&(u=function(l,c,d,f,p,v,g,h){var y,m,b=d==null||(y=d.first)===null||y===void 0?void 0:y.call(d),O=d==null||(m=d.get)===null||m===void 0?void 0:m.call(d,1);return"".concat(l," ").concat(i," ").concat(b," AND ").concat(O)}),u},Bd=function(e,t,r){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1,o=r.settings,u=o.isForDisplay,s=o.isDebugMode,l=e.get("properties")||new Qe,c=l.get("field"),d=l.get("fieldSrc"),f=l.get("operator"),p=l.get("operatorOptions");if(!((c==null||f==null)&&!s)){var v=oe(t,c)||{},g=Ie(t,f,c)||{},h=g.reversedOp,y=Ie(t,h,c)||{},m=!1,b=g.formatOp;if(!b&&h&&(b=y.formatOp,b)){m=!0;var O=[h,f];f=O[0],h=O[1];var S=[y,g];g=S[0],y=S[1]}if(s&&!f&&(f="?"),b||(b=cb(f,g,r)),!!b){var F=d==="func"?Hd(t,r,c,a):qd(t,r,c,a);if(F!=null){var _=lb(t,l,r,f,a),T=(0,ie.A)(_,3),E=T[0],A=T[1],j=T[2];if(E!==void 0){var R=[F,f,E,A,j,vt(g,va),p,u,v,m];if(i)return R;var L,N=(L=b).call.apply(L,[t.ctx].concat(R));return m&&(N=t.settings.formatReverse.call(t.ctx,N,f,h,g,y,u)),N}}}}},rs=function(e,t,r,a,i,o,u,s,l){var c=arguments.length>9&&arguments[9]!==void 0?arguments[9]:null,d=arguments.length>10?arguments[10]:void 0,f=t.settings,p=f.isForDisplay,v=f.isDebugMode;if(r===void 0)return v?o?.jsType==="array"?[]:"?":void 0;var g;if(a=="field")g=qd(e,t,r,c);else if(a=="func")g=Hd(e,t,r,c);else if(typeof o?.formatValue=="function"){var h=o.formatValue,y=[r,zd(zd({},Ht()(u,["fieldSettings","listValues"])),{},{asyncListValues:d}),vt(o,Mn),p];if(s&&(y.push(s),y.push(l)),a=="field"){var m=oe(e,r)||{};y.push(m)}g=h.call.apply(h,[e.ctx].concat(y))}else g=r;return g},qd=function(e,t,r){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0,o=t.settings,u=o.isForDisplay,s=o.isDebugMode,l=e.settings,c=l.fieldSeparator,d=l.fieldSeparatorDisplay,f=null;if(r){var p=oe(e,r)||{},v=mr(r,e),g=mi(r,e,i?a:null),h=g?g.join(d):null,y=p.label2||h,m=e.settings.formatField,b=un(r,e,t,i?a:null,{useTableName:!0});f=m(b,v,y,p,e,u)}else s&&(f="?");return f},Hd=function(e,t,r){var a,i,o,u=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null,s=t.settings,l=s.isForDisplay,c=s.isDebugMode,d=r==null||(a=r.get)===null||a===void 0?void 0:a.call(r,"func");if(!d)return c?"?()":void 0;var f=(i=r.get)===null||i===void 0?void 0:i.call(r,"args"),p=Ar(e,d);if(!p&&!c){t.errors.push("Func ".concat(d," is not defined in config"));return}var v=mr(d,e),g=v[v.length-1],h=l&&p?.label||g,y={},m=[],b=[],O={},S=p?Object.keys(p.args||{}):(f==null||(o=f.keySeq)===null||o===void 0?void 0:o.call(f).toArray())||[],F=Md(S),_;try{for(F.s();!(_=F.n()).done;){var T,E=_.value,A=p?.args[E],j=oe(e,A),R=A||{},L=R.defaultValue,N=R.isOptional,I=L!=null&&L.func?"func":"value",P=l&&A?.label||E,x=f?f.get(E):void 0,k=x?x.get("value"):void 0,V=x?x.get("valueSrc"):void 0;V!=="func"&&(T=k)!==null&&T!==void 0&&T.toJS&&(k=k.toJS());var G=x?x.get("asyncListValues"):void 0,$=rs(e,t,k,V,A?.type,j,A,null,null,u,G);k!=null&&$===void 0&&V!="func"&&t.errors.push("Can't format value of arg ".concat(E," for func ").concat(d));var W=void 0;if($===void 0&&!N&&L!=null&&(W=rs(e,t,L,I,A?.type,j,A,null,null,u,G),W===void 0)){I!="func"&&t.errors.push("Can't format default value of arg ".concat(E," for func ").concat(d));return}var q=$??W;if(q!==void 0){if(m.length){var J=Md(E),K;try{for(J.s();!(K=J.n()).done;){var U=(0,ie.A)(K.value,2),X=U[0],Y=U[1];y[X]=void 0}}catch(de){J.e(de)}finally{J.f()}m=[]}y[E]=q,O[P]=q}else N||b.push(E),m.push([E,P])}}catch(de){F.e(de)}finally{F.f()}if(!(b.length&&!c)){var ae=null;if(typeof p?.formatFunc=="function"){var ge=p.formatFunc,se=[y,l];ae=ge.call.apply(ge,[e.ctx].concat(se))}else{var ce=Object.entries(l?O:y).map(function(de){var ne=(0,ie.A)(de,2),ve=ne[0],ye=ne[1];return l?"".concat(ve,": ").concat(ye):"".concat(ye)}).join(", ");ae="".concat(h,"(").concat(ce,")")}return ae}},Jd="EMPTY_GROUP",Yd="EMPTY_RULE_GROUP",Kd="EMPTY_QUERY",Qd="EMPTY_CASE",Xd="NO_CONFIG_FOR_FIELD",Zd="NO_CONFIG_FOR_OPERATOR",db="FIXED_OPERATOR",ef="NO_CONFIG_FOR_FUNCTION",rf="INVALID_VALUE",tf="INVALID_FUNC_ARG_VALUE",nf="UNSUPPORTED_FIELD_TYPE",af="UNSUPPORTED_OPERATOR_FOR_FIELD",of="INVALID_VALUE_SRC",ts="INCOMPLETE_RULE",uf="INCOMPLETE_LHS",sf="INCOMPLETE_RHS",ns="BAD_MULTISELECT_VALUES",lf="BAD_SELECT_VALUE",cf="INCORRECT_VALUE_TYPE",df="INCORRECT_VALUE_JS_TYPE",ff="VALUE_LENGTH_CONSTRAINT_FAIL",as="VALUE_MIN_CONSTRAINT_FAIL",is="VALUE_MAX_CONSTRAINT_FAIL",pf="NO_CONFIG_FOR_FIELD_VALUE",vf="CANT_COMPARE_FIELD_WITH_ITSELF",gf="CANT_COMPARE_FIELD_WITH_FIELD",hf="INCORRECT_FIELD_TYPE",mf="UNSUPPORTED_FUNCTION_FOR_FIELD",yf="REQUIRED_FUNCTION_ARG",bf="INCORRECT_FUNCTION_RETURN_TYPE",Of="INVALID_RANGE",on="ITEM_POSITION",Sf="ITEM_POSITION_ROOT",Ff="ITEM_POSITION_WITH_INDEX_PATH",_f="ITEM_POSITION_IN_CASE",os="range";const _e=n=>typeof n=="string",pi=()=>{let n,e;const t=new Promise((r,a)=>{n=r,e=a});return t.resolve=n,t.reject=e,t},Cf=n=>n==null?"":""+n,fb=(n,e,t)=>{n.forEach(r=>{e[r]&&(t[r]=e[r])})},pb=/###/g,wf=n=>n&&n.indexOf("###")>-1?n.replace(pb,"."):n,Af=n=>!n||_e(n),vi=(n,e,t)=>{const r=_e(e)?e.split("."):e;let a=0;for(;a<r.length-1;){if(Af(n))return{};const i=wf(r[a]);!n[i]&&t&&(n[i]=new t),Object.prototype.hasOwnProperty.call(n,i)?n=n[i]:n={},++a}return Af(n)?{}:{obj:n,k:wf(r[a])}},Ef=(n,e,t)=>{const{obj:r,k:a}=vi(n,e,Object);if(r!==void 0||e.length===1){r[a]=t;return}let i=e[e.length-1],o=e.slice(0,e.length-1),u=vi(n,o,Object);for(;u.obj===void 0&&o.length;)i=`${o[o.length-1]}.${i}`,o=o.slice(0,o.length-1),u=vi(n,o,Object),u&&u.obj&&typeof u.obj[`${u.k}.${i}`]<"u"&&(u.obj=void 0);u.obj[`${u.k}.${i}`]=t},vb=(n,e,t,r)=>{const{obj:a,k:i}=vi(n,e,Object);a[i]=a[i]||[],a[i].push(t)},eo=(n,e)=>{const{obj:t,k:r}=vi(n,e);if(t)return t[r]},gb=(n,e,t)=>{const r=eo(n,t);return r!==void 0?r:eo(e,t)},Lf=(n,e,t)=>{for(const r in e)r!=="__proto__"&&r!=="constructor"&&(r in n?_e(n[r])||n[r]instanceof String||_e(e[r])||e[r]instanceof String?t&&(n[r]=e[r]):Lf(n[r],e[r],t):n[r]=e[r]);return n},ba=n=>n.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");var hb={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};const mb=n=>_e(n)?n.replace(/[&<>"'\/]/g,e=>hb[e]):n;class yb{constructor(e){this.capacity=e,this.regExpMap=new Map,this.regExpQueue=[]}getRegExp(e){const t=this.regExpMap.get(e);if(t!==void 0)return t;const r=new RegExp(e);return this.regExpQueue.length===this.capacity&&this.regExpMap.delete(this.regExpQueue.shift()),this.regExpMap.set(e,r),this.regExpQueue.push(e),r}}const bb=[" ",",","?","!",";"],Ob=new yb(20),Sb=(n,e,t)=>{e=e||"",t=t||"";const r=bb.filter(o=>e.indexOf(o)<0&&t.indexOf(o)<0);if(r.length===0)return!0;const a=Ob.getRegExp(`(${r.map(o=>o==="?"?"\\?":o).join("|")})`);let i=!a.test(n);if(!i){const o=n.indexOf(t);o>0&&!a.test(n.substring(0,o))&&(i=!0)}return i},us=function(n,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:".";if(!n)return;if(n[e])return n[e];const r=e.split(t);let a=n;for(let i=0;i<r.length;){if(!a||typeof a!="object")return;let o,u="";for(let s=i;s<r.length;++s)if(s!==i&&(u+=t),u+=r[s],o=a[u],o!==void 0){if(["string","number","boolean"].indexOf(typeof o)>-1&&s<r.length-1)continue;i+=s-i+1;break}a=o}return a},ro=n=>n&&n.replace("_","-"),Fb={type:"logger",log(n){this.output("log",n)},warn(n){this.output("warn",n)},error(n){this.output("error",n)},output(n,e){console&&console[n]&&console[n].apply(console,e)}};class to{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.init(e,t)}init(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.prefix=t.prefix||"i18next:",this.logger=e||Fb,this.options=t,this.debug=t.debug}log(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.forward(t,"log","",!0)}warn(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.forward(t,"warn","",!0)}error(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.forward(t,"error","")}deprecate(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.forward(t,"warn","WARNING DEPRECATED: ",!0)}forward(e,t,r,a){return a&&!this.debug?null:(_e(e[0])&&(e[0]=`${r}${this.prefix} ${e[0]}`),this.logger[t](e))}create(e){return new to(this.logger,{prefix:`${this.prefix}:${e}:`,...this.options})}clone(e){return e=e||this.options,e.prefix=e.prefix||this.prefix,new to(this.logger,e)}}var Kt=new to;class no{constructor(){this.observers={}}on(e,t){return e.split(" ").forEach(r=>{this.observers[r]||(this.observers[r]=new Map);const a=this.observers[r].get(t)||0;this.observers[r].set(t,a+1)}),this}off(e,t){if(this.observers[e]){if(!t){delete this.observers[e];return}this.observers[e].delete(t)}}emit(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),a=1;a<t;a++)r[a-1]=arguments[a];this.observers[e]&&Array.from(this.observers[e].entries()).forEach(o=>{let[u,s]=o;for(let l=0;l<s;l++)u(...r)}),this.observers["*"]&&Array.from(this.observers["*"].entries()).forEach(o=>{let[u,s]=o;for(let l=0;l<s;l++)u.apply(u,[e,...r])})}}class Tf extends no{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{ns:["translation"],defaultNS:"translation"};super(),this.data=e||{},this.options=t,this.options.keySeparator===void 0&&(this.options.keySeparator="."),this.options.ignoreJSONStructure===void 0&&(this.options.ignoreJSONStructure=!0)}addNamespaces(e){this.options.ns.indexOf(e)<0&&this.options.ns.push(e)}removeNamespaces(e){const t=this.options.ns.indexOf(e);t>-1&&this.options.ns.splice(t,1)}getResource(e,t,r){let a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const i=a.keySeparator!==void 0?a.keySeparator:this.options.keySeparator,o=a.ignoreJSONStructure!==void 0?a.ignoreJSONStructure:this.options.ignoreJSONStructure;let u;e.indexOf(".")>-1?u=e.split("."):(u=[e,t],r&&(Array.isArray(r)?u.push(...r):_e(r)&&i?u.push(...r.split(i)):u.push(r)));const s=eo(this.data,u);return!s&&!t&&!r&&e.indexOf(".")>-1&&(e=u[0],t=u[1],r=u.slice(2).join(".")),s||!o||!_e(r)?s:us(this.data&&this.data[e]&&this.data[e][t],r,i)}addResource(e,t,r,a){let i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{silent:!1};const o=i.keySeparator!==void 0?i.keySeparator:this.options.keySeparator;let u=[e,t];r&&(u=u.concat(o?r.split(o):r)),e.indexOf(".")>-1&&(u=e.split("."),a=t,t=u[1]),this.addNamespaces(t),Ef(this.data,u,a),i.silent||this.emit("added",e,t,r,a)}addResources(e,t,r){let a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{silent:!1};for(const i in r)(_e(r[i])||Array.isArray(r[i]))&&this.addResource(e,t,i,r[i],{silent:!0});a.silent||this.emit("added",e,t,r)}addResourceBundle(e,t,r,a,i){let o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:{silent:!1,skipCopy:!1},u=[e,t];e.indexOf(".")>-1&&(u=e.split("."),a=r,r=t,t=u[1]),this.addNamespaces(t);let s=eo(this.data,u)||{};o.skipCopy||(r=JSON.parse(JSON.stringify(r))),a?Lf(s,r,i):s={...s,...r},Ef(this.data,u,s),o.silent||this.emit("added",e,t,r)}removeResourceBundle(e,t){this.hasResourceBundle(e,t)&&delete this.data[e][t],this.removeNamespaces(t),this.emit("removed",e,t)}hasResourceBundle(e,t){return this.getResource(e,t)!==void 0}getResourceBundle(e,t){return t||(t=this.options.defaultNS),this.options.compatibilityAPI==="v1"?{...this.getResource(e,t)}:this.getResource(e,t)}getDataByLanguage(e){return this.data[e]}hasLanguageSomeTranslations(e){const t=this.getDataByLanguage(e);return!!(t&&Object.keys(t)||[]).find(a=>t[a]&&Object.keys(t[a]).length>0)}toJSON(){return this.data}}var jf={processors:{},addPostProcessor(n){this.processors[n.name]=n},handle(n,e,t,r,a){return n.forEach(i=>{this.processors[i]&&(e=this.processors[i].process(e,t,r,a))}),e}};const Rf={};class ao extends no{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),fb(["resourceStore","languageUtils","pluralResolver","interpolator","backendConnector","i18nFormat","utils"],e,this),this.options=t,this.options.keySeparator===void 0&&(this.options.keySeparator="."),this.logger=Kt.create("translator")}changeLanguage(e){e&&(this.language=e)}exists(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{interpolation:{}};if(e==null)return!1;const r=this.resolve(e,t);return r&&r.res!==void 0}extractFromKey(e,t){let r=t.nsSeparator!==void 0?t.nsSeparator:this.options.nsSeparator;r===void 0&&(r=":");const a=t.keySeparator!==void 0?t.keySeparator:this.options.keySeparator;let i=t.ns||this.options.defaultNS||[];const o=r&&e.indexOf(r)>-1,u=!this.options.userDefinedKeySeparator&&!t.keySeparator&&!this.options.userDefinedNsSeparator&&!t.nsSeparator&&!Sb(e,r,a);if(o&&!u){const s=e.match(this.interpolator.nestingRegexp);if(s&&s.length>0)return{key:e,namespaces:_e(i)?[i]:i};const l=e.split(r);(r!==a||r===a&&this.options.ns.indexOf(l[0])>-1)&&(i=l.shift()),e=l.join(a)}return{key:e,namespaces:_e(i)?[i]:i}}translate(e,t,r){if(typeof t!="object"&&this.options.overloadTranslationOptionHandler&&(t=this.options.overloadTranslationOptionHandler(arguments)),typeof t=="object"&&(t={...t}),t||(t={}),e==null)return"";Array.isArray(e)||(e=[String(e)]);const a=t.returnDetails!==void 0?t.returnDetails:this.options.returnDetails,i=t.keySeparator!==void 0?t.keySeparator:this.options.keySeparator,{key:o,namespaces:u}=this.extractFromKey(e[e.length-1],t),s=u[u.length-1],l=t.lng||this.language,c=t.appendNamespaceToCIMode||this.options.appendNamespaceToCIMode;if(l&&l.toLowerCase()==="cimode"){if(c){const O=t.nsSeparator||this.options.nsSeparator;return a?{res:`${s}${O}${o}`,usedKey:o,exactUsedKey:o,usedLng:l,usedNS:s,usedParams:this.getUsedParamsDetails(t)}:`${s}${O}${o}`}return a?{res:o,usedKey:o,exactUsedKey:o,usedLng:l,usedNS:s,usedParams:this.getUsedParamsDetails(t)}:o}const d=this.resolve(e,t);let f=d&&d.res;const p=d&&d.usedKey||o,v=d&&d.exactUsedKey||o,g=Object.prototype.toString.apply(f),h=["[object Number]","[object Function]","[object RegExp]"],y=t.joinArrays!==void 0?t.joinArrays:this.options.joinArrays,m=!this.i18nFormat||this.i18nFormat.handleAsObject,b=!_e(f)&&typeof f!="boolean"&&typeof f!="number";if(m&&f&&b&&h.indexOf(g)<0&&!(_e(y)&&Array.isArray(f))){if(!t.returnObjects&&!this.options.returnObjects){this.options.returnedObjectHandler||this.logger.warn("accessing an object - but returnObjects options is not enabled!");const O=this.options.returnedObjectHandler?this.options.returnedObjectHandler(p,f,{...t,ns:u}):`key '${o} (${this.language})' returned an object instead of string.`;return a?(d.res=O,d.usedParams=this.getUsedParamsDetails(t),d):O}if(i){const O=Array.isArray(f),S=O?[]:{},F=O?v:p;for(const _ in f)if(Object.prototype.hasOwnProperty.call(f,_)){const T=`${F}${i}${_}`;S[_]=this.translate(T,{...t,joinArrays:!1,ns:u}),S[_]===T&&(S[_]=f[_])}f=S}}else if(m&&_e(y)&&Array.isArray(f))f=f.join(y),f&&(f=this.extendTranslation(f,e,t,r));else{let O=!1,S=!1;const F=t.count!==void 0&&!_e(t.count),_=ao.hasDefaultValue(t),T=F?this.pluralResolver.getSuffix(l,t.count,t):"",E=t.ordinal&&F?this.pluralResolver.getSuffix(l,t.count,{ordinal:!1}):"",A=F&&!t.ordinal&&t.count===0&&this.pluralResolver.shouldUseIntlApi(),j=A&&t[`defaultValue${this.options.pluralSeparator}zero`]||t[`defaultValue${T}`]||t[`defaultValue${E}`]||t.defaultValue;!this.isValidLookup(f)&&_&&(O=!0,f=j),this.isValidLookup(f)||(S=!0,f=o);const L=(t.missingKeyNoValueFallbackToKey||this.options.missingKeyNoValueFallbackToKey)&&S?void 0:f,N=_&&j!==f&&this.options.updateMissing;if(S||O||N){if(this.logger.log(N?"updateKey":"missingKey",l,s,o,N?j:f),i){const k=this.resolve(o,{...t,keySeparator:!1});k&&k.res&&this.logger.warn("Seems the loaded translations were in flat JSON format instead of nested. Either set keySeparator: false on init or make sure your translations are published in nested format.")}let I=[];const P=this.languageUtils.getFallbackCodes(this.options.fallbackLng,t.lng||this.language);if(this.options.saveMissingTo==="fallback"&&P&&P[0])for(let k=0;k<P.length;k++)I.push(P[k]);else this.options.saveMissingTo==="all"?I=this.languageUtils.toResolveHierarchy(t.lng||this.language):I.push(t.lng||this.language);const x=(k,V,G)=>{const $=_&&G!==f?G:L;this.options.missingKeyHandler?this.options.missingKeyHandler(k,s,V,$,N,t):this.backendConnector&&this.backendConnector.saveMissing&&this.backendConnector.saveMissing(k,s,V,$,N,t),this.emit("missingKey",k,s,V,f)};this.options.saveMissing&&(this.options.saveMissingPlurals&&F?I.forEach(k=>{const V=this.pluralResolver.getSuffixes(k,t);A&&t[`defaultValue${this.options.pluralSeparator}zero`]&&V.indexOf(`${this.options.pluralSeparator}zero`)<0&&V.push(`${this.options.pluralSeparator}zero`),V.forEach(G=>{x([k],o+G,t[`defaultValue${G}`]||j)})}):x(I,o,j))}f=this.extendTranslation(f,e,t,d,r),S&&f===o&&this.options.appendNamespaceToMissingKey&&(f=`${s}:${o}`),(S||O)&&this.options.parseMissingKeyHandler&&(this.options.compatibilityAPI!=="v1"?f=this.options.parseMissingKeyHandler(this.options.appendNamespaceToMissingKey?`${s}:${o}`:o,O?f:void 0):f=this.options.parseMissingKeyHandler(f))}return a?(d.res=f,d.usedParams=this.getUsedParamsDetails(t),d):f}extendTranslation(e,t,r,a,i){var o=this;if(this.i18nFormat&&this.i18nFormat.parse)e=this.i18nFormat.parse(e,{...this.options.interpolation.defaultVariables,...r},r.lng||this.language||a.usedLng,a.usedNS,a.usedKey,{resolved:a});else if(!r.skipInterpolation){r.interpolation&&this.interpolator.init({...r,interpolation:{...this.options.interpolation,...r.interpolation}});const l=_e(e)&&(r&&r.interpolation&&r.interpolation.skipOnVariables!==void 0?r.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables);let c;if(l){const f=e.match(this.interpolator.nestingRegexp);c=f&&f.length}let d=r.replace&&!_e(r.replace)?r.replace:r;if(this.options.interpolation.defaultVariables&&(d={...this.options.interpolation.defaultVariables,...d}),e=this.interpolator.interpolate(e,d,r.lng||this.language||a.usedLng,r),l){const f=e.match(this.interpolator.nestingRegexp),p=f&&f.length;c<p&&(r.nest=!1)}!r.lng&&this.options.compatibilityAPI!=="v1"&&a&&a.res&&(r.lng=this.language||a.usedLng),r.nest!==!1&&(e=this.interpolator.nest(e,function(){for(var f=arguments.length,p=new Array(f),v=0;v<f;v++)p[v]=arguments[v];return i&&i[0]===p[0]&&!r.context?(o.logger.warn(`It seems you are nesting recursively key: ${p[0]} in key: ${t[0]}`),null):o.translate(...p,t)},r)),r.interpolation&&this.interpolator.reset()}const u=r.postProcess||this.options.postProcess,s=_e(u)?[u]:u;return e!=null&&s&&s.length&&r.applyPostProcessor!==!1&&(e=jf.handle(s,e,t,this.options&&this.options.postProcessPassResolved?{i18nResolved:{...a,usedParams:this.getUsedParamsDetails(r)},...r}:r,this)),e}resolve(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r,a,i,o,u;return _e(e)&&(e=[e]),e.forEach(s=>{if(this.isValidLookup(r))return;const l=this.extractFromKey(s,t),c=l.key;a=c;let d=l.namespaces;this.options.fallbackNS&&(d=d.concat(this.options.fallbackNS));const f=t.count!==void 0&&!_e(t.count),p=f&&!t.ordinal&&t.count===0&&this.pluralResolver.shouldUseIntlApi(),v=t.context!==void 0&&(_e(t.context)||typeof t.context=="number")&&t.context!=="",g=t.lngs?t.lngs:this.languageUtils.toResolveHierarchy(t.lng||this.language,t.fallbackLng);d.forEach(h=>{this.isValidLookup(r)||(u=h,!Rf[`${g[0]}-${h}`]&&this.utils&&this.utils.hasLoadedNamespace&&!this.utils.hasLoadedNamespace(u)&&(Rf[`${g[0]}-${h}`]=!0,this.logger.warn(`key "${a}" for languages "${g.join(", ")}" won't get resolved as namespace "${u}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")),g.forEach(y=>{if(this.isValidLookup(r))return;o=y;const m=[c];if(this.i18nFormat&&this.i18nFormat.addLookupKeys)this.i18nFormat.addLookupKeys(m,c,y,h,t);else{let O;f&&(O=this.pluralResolver.getSuffix(y,t.count,t));const S=`${this.options.pluralSeparator}zero`,F=`${this.options.pluralSeparator}ordinal${this.options.pluralSeparator}`;if(f&&(m.push(c+O),t.ordinal&&O.indexOf(F)===0&&m.push(c+O.replace(F,this.options.pluralSeparator)),p&&m.push(c+S)),v){const _=`${c}${this.options.contextSeparator}${t.context}`;m.push(_),f&&(m.push(_+O),t.ordinal&&O.indexOf(F)===0&&m.push(_+O.replace(F,this.options.pluralSeparator)),p&&m.push(_+S))}}let b;for(;b=m.pop();)this.isValidLookup(r)||(i=b,r=this.getResource(y,h,b,t))}))})}),{res:r,usedKey:a,exactUsedKey:i,usedLng:o,usedNS:u}}isValidLookup(e){return e!==void 0&&!(!this.options.returnNull&&e===null)&&!(!this.options.returnEmptyString&&e==="")}getResource(e,t,r){let a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return this.i18nFormat&&this.i18nFormat.getResource?this.i18nFormat.getResource(e,t,r,a):this.resourceStore.getResource(e,t,r,a)}getUsedParamsDetails(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=["defaultValue","ordinal","context","replace","lng","lngs","fallbackLng","ns","keySeparator","nsSeparator","returnObjects","returnDetails","joinArrays","postProcess","interpolation"],r=e.replace&&!_e(e.replace);let a=r?e.replace:e;if(r&&typeof e.count<"u"&&(a.count=e.count),this.options.interpolation.defaultVariables&&(a={...this.options.interpolation.defaultVariables,...a}),!r){a={...a};for(const i of t)delete a[i]}return a}static hasDefaultValue(e){const t="defaultValue";for(const r in e)if(Object.prototype.hasOwnProperty.call(e,r)&&t===r.substring(0,t.length)&&e[r]!==void 0)return!0;return!1}}const ss=n=>n.charAt(0).toUpperCase()+n.slice(1);class xf{constructor(e){this.options=e,this.supportedLngs=this.options.supportedLngs||!1,this.logger=Kt.create("languageUtils")}getScriptPartFromCode(e){if(e=ro(e),!e||e.indexOf("-")<0)return null;const t=e.split("-");return t.length===2||(t.pop(),t[t.length-1].toLowerCase()==="x")?null:this.formatLanguageCode(t.join("-"))}getLanguagePartFromCode(e){if(e=ro(e),!e||e.indexOf("-")<0)return e;const t=e.split("-");return this.formatLanguageCode(t[0])}formatLanguageCode(e){if(_e(e)&&e.indexOf("-")>-1){if(typeof Intl<"u"&&typeof Intl.getCanonicalLocales<"u")try{let a=Intl.getCanonicalLocales(e)[0];if(a&&this.options.lowerCaseLng&&(a=a.toLowerCase()),a)return a}catch{}const t=["hans","hant","latn","cyrl","cans","mong","arab"];let r=e.split("-");return this.options.lowerCaseLng?r=r.map(a=>a.toLowerCase()):r.length===2?(r[0]=r[0].toLowerCase(),r[1]=r[1].toUpperCase(),t.indexOf(r[1].toLowerCase())>-1&&(r[1]=ss(r[1].toLowerCase()))):r.length===3&&(r[0]=r[0].toLowerCase(),r[1].length===2&&(r[1]=r[1].toUpperCase()),r[0]!=="sgn"&&r[2].length===2&&(r[2]=r[2].toUpperCase()),t.indexOf(r[1].toLowerCase())>-1&&(r[1]=ss(r[1].toLowerCase())),t.indexOf(r[2].toLowerCase())>-1&&(r[2]=ss(r[2].toLowerCase()))),r.join("-")}return this.options.cleanCode||this.options.lowerCaseLng?e.toLowerCase():e}isSupportedCode(e){return(this.options.load==="languageOnly"||this.options.nonExplicitSupportedLngs)&&(e=this.getLanguagePartFromCode(e)),!this.supportedLngs||!this.supportedLngs.length||this.supportedLngs.indexOf(e)>-1}getBestMatchFromCodes(e){if(!e)return null;let t;return e.forEach(r=>{if(t)return;const a=this.formatLanguageCode(r);(!this.options.supportedLngs||this.isSupportedCode(a))&&(t=a)}),!t&&this.options.supportedLngs&&e.forEach(r=>{if(t)return;const a=this.getLanguagePartFromCode(r);if(this.isSupportedCode(a))return t=a;t=this.options.supportedLngs.find(i=>{if(i===a)return i;if(!(i.indexOf("-")<0&&a.indexOf("-")<0)&&(i.indexOf("-")>0&&a.indexOf("-")<0&&i.substring(0,i.indexOf("-"))===a||i.indexOf(a)===0&&a.length>1))return i})}),t||(t=this.getFallbackCodes(this.options.fallbackLng)[0]),t}getFallbackCodes(e,t){if(!e)return[];if(typeof e=="function"&&(e=e(t)),_e(e)&&(e=[e]),Array.isArray(e))return e;if(!t)return e.default||[];let r=e[t];return r||(r=e[this.getScriptPartFromCode(t)]),r||(r=e[this.formatLanguageCode(t)]),r||(r=e[this.getLanguagePartFromCode(t)]),r||(r=e.default),r||[]}toResolveHierarchy(e,t){const r=this.getFallbackCodes(t||this.options.fallbackLng||[],e),a=[],i=o=>{o&&(this.isSupportedCode(o)?a.push(o):this.logger.warn(`rejecting language code not found in supportedLngs: ${o}`))};return _e(e)&&(e.indexOf("-")>-1||e.indexOf("_")>-1)?(this.options.load!=="languageOnly"&&i(this.formatLanguageCode(e)),this.options.load!=="languageOnly"&&this.options.load!=="currentOnly"&&i(this.getScriptPartFromCode(e)),this.options.load!=="currentOnly"&&i(this.getLanguagePartFromCode(e))):_e(e)&&i(this.formatLanguageCode(e)),r.forEach(o=>{a.indexOf(o)<0&&i(this.formatLanguageCode(o))}),a}}let _b=[{lngs:["ach","ak","am","arn","br","fil","gun","ln","mfe","mg","mi","oc","pt","pt-BR","tg","tl","ti","tr","uz","wa"],nr:[1,2],fc:1},{lngs:["af","an","ast","az","bg","bn","ca","da","de","dev","el","en","eo","es","et","eu","fi","fo","fur","fy","gl","gu","ha","hi","hu","hy","ia","it","kk","kn","ku","lb","mai","ml","mn","mr","nah","nap","nb","ne","nl","nn","no","nso","pa","pap","pms","ps","pt-PT","rm","sco","se","si","so","son","sq","sv","sw","ta","te","tk","ur","yo"],nr:[1,2],fc:2},{lngs:["ay","bo","cgg","fa","ht","id","ja","jbo","ka","km","ko","ky","lo","ms","sah","su","th","tt","ug","vi","wo","zh"],nr:[1],fc:3},{lngs:["be","bs","cnr","dz","hr","ru","sr","uk"],nr:[1,2,5],fc:4},{lngs:["ar"],nr:[0,1,2,3,11,100],fc:5},{lngs:["cs","sk"],nr:[1,2,5],fc:6},{lngs:["csb","pl"],nr:[1,2,5],fc:7},{lngs:["cy"],nr:[1,2,3,8],fc:8},{lngs:["fr"],nr:[1,2],fc:9},{lngs:["ga"],nr:[1,2,3,7,11],fc:10},{lngs:["gd"],nr:[1,2,3,20],fc:11},{lngs:["is"],nr:[1,2],fc:12},{lngs:["jv"],nr:[0,1],fc:13},{lngs:["kw"],nr:[1,2,3,4],fc:14},{lngs:["lt"],nr:[1,2,10],fc:15},{lngs:["lv"],nr:[1,2,0],fc:16},{lngs:["mk"],nr:[1,2],fc:17},{lngs:["mnk"],nr:[0,1,2],fc:18},{lngs:["mt"],nr:[1,2,11,20],fc:19},{lngs:["or"],nr:[2,1],fc:2},{lngs:["ro"],nr:[1,2,20],fc:20},{lngs:["sl"],nr:[5,1,2,3],fc:21},{lngs:["he","iw"],nr:[1,2,20,21],fc:22}],Cb={1:n=>+(n>1),2:n=>+(n!=1),3:n=>0,4:n=>n%10==1&&n%100!=11?0:n%10>=2&&n%10<=4&&(n%100<10||n%100>=20)?1:2,5:n=>n==0?0:n==1?1:n==2?2:n%100>=3&&n%100<=10?3:n%100>=11?4:5,6:n=>n==1?0:n>=2&&n<=4?1:2,7:n=>n==1?0:n%10>=2&&n%10<=4&&(n%100<10||n%100>=20)?1:2,8:n=>n==1?0:n==2?1:n!=8&&n!=11?2:3,9:n=>+(n>=2),10:n=>n==1?0:n==2?1:n<7?2:n<11?3:4,11:n=>n==1||n==11?0:n==2||n==12?1:n>2&&n<20?2:3,12:n=>+(n%10!=1||n%100==11),13:n=>+(n!==0),14:n=>n==1?0:n==2?1:n==3?2:3,15:n=>n%10==1&&n%100!=11?0:n%10>=2&&(n%100<10||n%100>=20)?1:2,16:n=>n%10==1&&n%100!=11?0:n!==0?1:2,17:n=>n==1||n%10==1&&n%100!=11?0:1,18:n=>n==0?0:n==1?1:2,19:n=>n==1?0:n==0||n%100>1&&n%100<11?1:n%100>10&&n%100<20?2:3,20:n=>n==1?0:n==0||n%100>0&&n%100<20?1:2,21:n=>n%100==1?1:n%100==2?2:n%100==3||n%100==4?3:0,22:n=>n==1?0:n==2?1:(n<0||n>10)&&n%10==0?2:3};const wb=["v1","v2","v3"],Ab=["v4"],Pf={zero:0,one:1,two:2,few:3,many:4,other:5},Eb=()=>{const n={};return _b.forEach(e=>{e.lngs.forEach(t=>{n[t]={numbers:e.nr,plurals:Cb[e.fc]}})}),n};class Lb{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.languageUtils=e,this.options=t,this.logger=Kt.create("pluralResolver"),(!this.options.compatibilityJSON||Ab.includes(this.options.compatibilityJSON))&&(typeof Intl>"u"||!Intl.PluralRules)&&(this.options.compatibilityJSON="v3",this.logger.error("Your environment seems not to be Intl API compatible, use an Intl.PluralRules polyfill. Will fallback to the compatibilityJSON v3 format handling.")),this.rules=Eb(),this.pluralRulesCache={}}addRule(e,t){this.rules[e]=t}clearCache(){this.pluralRulesCache={}}getRule(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(this.shouldUseIntlApi()){const r=ro(e==="dev"?"en":e),a=t.ordinal?"ordinal":"cardinal",i=JSON.stringify({cleanedCode:r,type:a});if(i in this.pluralRulesCache)return this.pluralRulesCache[i];let o;try{o=new Intl.PluralRules(r,{type:a})}catch{if(!e.match(/-|_/))return;const s=this.languageUtils.getLanguagePartFromCode(e);o=this.getRule(s,t)}return this.pluralRulesCache[i]=o,o}return this.rules[e]||this.rules[this.languageUtils.getLanguagePartFromCode(e)]}needsPlural(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=this.getRule(e,t);return this.shouldUseIntlApi()?r&&r.resolvedOptions().pluralCategories.length>1:r&&r.numbers.length>1}getPluralFormsOfKey(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.getSuffixes(e,r).map(a=>`${t}${a}`)}getSuffixes(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=this.getRule(e,t);return r?this.shouldUseIntlApi()?r.resolvedOptions().pluralCategories.sort((a,i)=>Pf[a]-Pf[i]).map(a=>`${this.options.prepend}${t.ordinal?`ordinal${this.options.prepend}`:""}${a}`):r.numbers.map(a=>this.getSuffix(e,a,t)):[]}getSuffix(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const a=this.getRule(e,r);return a?this.shouldUseIntlApi()?`${this.options.prepend}${r.ordinal?`ordinal${this.options.prepend}`:""}${a.select(t)}`:this.getSuffixRetroCompatible(a,t):(this.logger.warn(`no plural rule found for: ${e}`),"")}getSuffixRetroCompatible(e,t){const r=e.noAbs?e.plurals(t):e.plurals(Math.abs(t));let a=e.numbers[r];this.options.simplifyPluralSuffix&&e.numbers.length===2&&e.numbers[0]===1&&(a===2?a="plural":a===1&&(a=""));const i=()=>this.options.prepend&&a.toString()?this.options.prepend+a.toString():a.toString();return this.options.compatibilityJSON==="v1"?a===1?"":typeof a=="number"?`_plural_${a.toString()}`:i():this.options.compatibilityJSON==="v2"||this.options.simplifyPluralSuffix&&e.numbers.length===2&&e.numbers[0]===1?i():this.options.prepend&&r.toString()?this.options.prepend+r.toString():r.toString()}shouldUseIntlApi(){return!wb.includes(this.options.compatibilityJSON)}}const If=function(n,e,t){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:".",a=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0,i=gb(n,e,t);return!i&&a&&_e(t)&&(i=us(n,t,r),i===void 0&&(i=us(e,t,r))),i},ls=n=>n.replace(/\$/g,"$$$$");class Tb{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.logger=Kt.create("interpolator"),this.options=e,this.format=e.interpolation&&e.interpolation.format||(t=>t),this.init(e)}init(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};e.interpolation||(e.interpolation={escapeValue:!0});const{escape:t,escapeValue:r,useRawValueToEscape:a,prefix:i,prefixEscaped:o,suffix:u,suffixEscaped:s,formatSeparator:l,unescapeSuffix:c,unescapePrefix:d,nestingPrefix:f,nestingPrefixEscaped:p,nestingSuffix:v,nestingSuffixEscaped:g,nestingOptionsSeparator:h,maxReplaces:y,alwaysFormat:m}=e.interpolation;this.escape=t!==void 0?t:mb,this.escapeValue=r!==void 0?r:!0,this.useRawValueToEscape=a!==void 0?a:!1,this.prefix=i?ba(i):o||"{{",this.suffix=u?ba(u):s||"}}",this.formatSeparator=l||",",this.unescapePrefix=c?"":d||"-",this.unescapeSuffix=this.unescapePrefix?"":c||"",this.nestingPrefix=f?ba(f):p||ba("$t("),this.nestingSuffix=v?ba(v):g||ba(")"),this.nestingOptionsSeparator=h||",",this.maxReplaces=y||1e3,this.alwaysFormat=m!==void 0?m:!1,this.resetRegExp()}reset(){this.options&&this.init(this.options)}resetRegExp(){const e=(t,r)=>t&&t.source===r?(t.lastIndex=0,t):new RegExp(r,"g");this.regexp=e(this.regexp,`${this.prefix}(.+?)${this.suffix}`),this.regexpUnescape=e(this.regexpUnescape,`${this.prefix}${this.unescapePrefix}(.+?)${this.unescapeSuffix}${this.suffix}`),this.nestingRegexp=e(this.nestingRegexp,`${this.nestingPrefix}(.+?)${this.nestingSuffix}`)}interpolate(e,t,r,a){let i,o,u;const s=this.options&&this.options.interpolation&&this.options.interpolation.defaultVariables||{},l=p=>{if(p.indexOf(this.formatSeparator)<0){const y=If(t,s,p,this.options.keySeparator,this.options.ignoreJSONStructure);return this.alwaysFormat?this.format(y,void 0,r,{...a,...t,interpolationkey:p}):y}const v=p.split(this.formatSeparator),g=v.shift().trim(),h=v.join(this.formatSeparator).trim();return this.format(If(t,s,g,this.options.keySeparator,this.options.ignoreJSONStructure),h,r,{...a,...t,interpolationkey:g})};this.resetRegExp();const c=a&&a.missingInterpolationHandler||this.options.missingInterpolationHandler,d=a&&a.interpolation&&a.interpolation.skipOnVariables!==void 0?a.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables;return[{regex:this.regexpUnescape,safeValue:p=>ls(p)},{regex:this.regexp,safeValue:p=>this.escapeValue?ls(this.escape(p)):ls(p)}].forEach(p=>{for(u=0;i=p.regex.exec(e);){const v=i[1].trim();if(o=l(v),o===void 0)if(typeof c=="function"){const h=c(e,i,a);o=_e(h)?h:""}else if(a&&Object.prototype.hasOwnProperty.call(a,v))o="";else if(d){o=i[0];continue}else this.logger.warn(`missed to pass in variable ${v} for interpolating ${e}`),o="";else!_e(o)&&!this.useRawValueToEscape&&(o=Cf(o));const g=p.safeValue(o);if(e=e.replace(i[0],g),d?(p.regex.lastIndex+=o.length,p.regex.lastIndex-=i[0].length):p.regex.lastIndex=0,u++,u>=this.maxReplaces)break}}),e}nest(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},a,i,o;const u=(s,l)=>{const c=this.nestingOptionsSeparator;if(s.indexOf(c)<0)return s;const d=s.split(new RegExp(`${c}[ ]*{`));let f=`{${d[1]}`;s=d[0],f=this.interpolate(f,o);const p=f.match(/'/g),v=f.match(/"/g);(p&&p.length%2===0&&!v||v.length%2!==0)&&(f=f.replace(/'/g,'"'));try{o=JSON.parse(f),l&&(o={...l,...o})}catch(g){return this.logger.warn(`failed parsing options string in nesting for key ${s}`,g),`${s}${c}${f}`}return o.defaultValue&&o.defaultValue.indexOf(this.prefix)>-1&&delete o.defaultValue,s};for(;a=this.nestingRegexp.exec(e);){let s=[];o={...r},o=o.replace&&!_e(o.replace)?o.replace:o,o.applyPostProcessor=!1,delete o.defaultValue;let l=!1;if(a[0].indexOf(this.formatSeparator)!==-1&&!/{.*}/.test(a[1])){const c=a[1].split(this.formatSeparator).map(d=>d.trim());a[1]=c.shift(),s=c,l=!0}if(i=t(u.call(this,a[1].trim(),o),o),i&&a[0]===e&&!_e(i))return i;_e(i)||(i=Cf(i)),i||(this.logger.warn(`missed to resolve ${a[1]} for nesting ${e}`),i=""),l&&(i=s.reduce((c,d)=>this.format(c,d,r.lng,{...r,interpolationkey:a[1].trim()}),i.trim())),e=e.replace(a[0],i),this.regexp.lastIndex=0}return e}}const jb=n=>{let e=n.toLowerCase().trim();const t={};if(n.indexOf("(")>-1){const r=n.split("(");e=r[0].toLowerCase().trim();const a=r[1].substring(0,r[1].length-1);e==="currency"&&a.indexOf(":")<0?t.currency||(t.currency=a.trim()):e==="relativetime"&&a.indexOf(":")<0?t.range||(t.range=a.trim()):a.split(";").forEach(o=>{if(o){const[u,...s]=o.split(":"),l=s.join(":").trim().replace(/^'+|'+$/g,""),c=u.trim();t[c]||(t[c]=l),l==="false"&&(t[c]=!1),l==="true"&&(t[c]=!0),isNaN(l)||(t[c]=parseInt(l,10))}})}return{formatName:e,formatOptions:t}},Oa=n=>{const e={};return(t,r,a)=>{let i=a;a&&a.interpolationkey&&a.formatParams&&a.formatParams[a.interpolationkey]&&a[a.interpolationkey]&&(i={...i,[a.interpolationkey]:void 0});const o=r+JSON.stringify(i);let u=e[o];return u||(u=n(ro(r),a),e[o]=u),u(t)}};class Rb{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.logger=Kt.create("formatter"),this.options=e,this.formats={number:Oa((t,r)=>{const a=new Intl.NumberFormat(t,{...r});return i=>a.format(i)}),currency:Oa((t,r)=>{const a=new Intl.NumberFormat(t,{...r,style:"currency"});return i=>a.format(i)}),datetime:Oa((t,r)=>{const a=new Intl.DateTimeFormat(t,{...r});return i=>a.format(i)}),relativetime:Oa((t,r)=>{const a=new Intl.RelativeTimeFormat(t,{...r});return i=>a.format(i,r.range||"day")}),list:Oa((t,r)=>{const a=new Intl.ListFormat(t,{...r});return i=>a.format(i)})},this.init(e)}init(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{interpolation:{}};this.formatSeparator=t.interpolation.formatSeparator||","}add(e,t){this.formats[e.toLowerCase().trim()]=t}addCached(e,t){this.formats[e.toLowerCase().trim()]=Oa(t)}format(e,t,r){let a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const i=t.split(this.formatSeparator);if(i.length>1&&i[0].indexOf("(")>1&&i[0].indexOf(")")<0&&i.find(u=>u.indexOf(")")>-1)){const u=i.findIndex(s=>s.indexOf(")")>-1);i[0]=[i[0],...i.splice(1,u)].join(this.formatSeparator)}return i.reduce((u,s)=>{const{formatName:l,formatOptions:c}=jb(s);if(this.formats[l]){let d=u;try{const f=a&&a.formatParams&&a.formatParams[a.interpolationkey]||{},p=f.locale||f.lng||a.locale||a.lng||r;d=this.formats[l](u,p,{...c,...a,...f})}catch(f){this.logger.warn(f)}return d}else this.logger.warn(`there was no format function for ${l}`);return u},e)}}const xb=(n,e)=>{n.pending[e]!==void 0&&(delete n.pending[e],n.pendingCount--)};class Pb extends no{constructor(e,t,r){let a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};super(),this.backend=e,this.store=t,this.services=r,this.languageUtils=r.languageUtils,this.options=a,this.logger=Kt.create("backendConnector"),this.waitingReads=[],this.maxParallelReads=a.maxParallelReads||10,this.readingCalls=0,this.maxRetries=a.maxRetries>=0?a.maxRetries:5,this.retryTimeout=a.retryTimeout>=1?a.retryTimeout:350,this.state={},this.queue=[],this.backend&&this.backend.init&&this.backend.init(r,a.backend,a)}queueLoad(e,t,r,a){const i={},o={},u={},s={};return e.forEach(l=>{let c=!0;t.forEach(d=>{const f=`${l}|${d}`;!r.reload&&this.store.hasResourceBundle(l,d)?this.state[f]=2:this.state[f]<0||(this.state[f]===1?o[f]===void 0&&(o[f]=!0):(this.state[f]=1,c=!1,o[f]===void 0&&(o[f]=!0),i[f]===void 0&&(i[f]=!0),s[d]===void 0&&(s[d]=!0)))}),c||(u[l]=!0)}),(Object.keys(i).length||Object.keys(o).length)&&this.queue.push({pending:o,pendingCount:Object.keys(o).length,loaded:{},errors:[],callback:a}),{toLoad:Object.keys(i),pending:Object.keys(o),toLoadLanguages:Object.keys(u),toLoadNamespaces:Object.keys(s)}}loaded(e,t,r){const a=e.split("|"),i=a[0],o=a[1];t&&this.emit("failedLoading",i,o,t),!t&&r&&this.store.addResourceBundle(i,o,r,void 0,void 0,{skipCopy:!0}),this.state[e]=t?-1:2,t&&r&&(this.state[e]=0);const u={};this.queue.forEach(s=>{vb(s.loaded,[i],o),xb(s,e),t&&s.errors.push(t),s.pendingCount===0&&!s.done&&(Object.keys(s.loaded).forEach(l=>{u[l]||(u[l]={});const c=s.loaded[l];c.length&&c.forEach(d=>{u[l][d]===void 0&&(u[l][d]=!0)})}),s.done=!0,s.errors.length?s.callback(s.errors):s.callback())}),this.emit("loaded",u),this.queue=this.queue.filter(s=>!s.done)}read(e,t,r){let a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:this.retryTimeout,o=arguments.length>5?arguments[5]:void 0;if(!e.length)return o(null,{});if(this.readingCalls>=this.maxParallelReads){this.waitingReads.push({lng:e,ns:t,fcName:r,tried:a,wait:i,callback:o});return}this.readingCalls++;const u=(l,c)=>{if(this.readingCalls--,this.waitingReads.length>0){const d=this.waitingReads.shift();this.read(d.lng,d.ns,d.fcName,d.tried,d.wait,d.callback)}if(l&&c&&a<this.maxRetries){setTimeout(()=>{this.read.call(this,e,t,r,a+1,i*2,o)},i);return}o(l,c)},s=this.backend[r].bind(this.backend);if(s.length===2){try{const l=s(e,t);l&&typeof l.then=="function"?l.then(c=>u(null,c)).catch(u):u(null,l)}catch(l){u(l)}return}return s(e,t,u)}prepareLoading(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},a=arguments.length>3?arguments[3]:void 0;if(!this.backend)return this.logger.warn("No backend was added via i18next.use. Will not load resources."),a&&a();_e(e)&&(e=this.languageUtils.toResolveHierarchy(e)),_e(t)&&(t=[t]);const i=this.queueLoad(e,t,r,a);if(!i.toLoad.length)return i.pending.length||a(),null;i.toLoad.forEach(o=>{this.loadOne(o)})}load(e,t,r){this.prepareLoading(e,t,{},r)}reload(e,t,r){this.prepareLoading(e,t,{reload:!0},r)}loadOne(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";const r=e.split("|"),a=r[0],i=r[1];this.read(a,i,"read",void 0,void 0,(o,u)=>{o&&this.logger.warn(`${t}loading namespace ${i} for language ${a} failed`,o),!o&&u&&this.logger.log(`${t}loaded namespace ${i} for language ${a}`,u),this.loaded(e,o,u)})}saveMissing(e,t,r,a,i){let o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:{},u=arguments.length>6&&arguments[6]!==void 0?arguments[6]:()=>{};if(this.services.utils&&this.services.utils.hasLoadedNamespace&&!this.services.utils.hasLoadedNamespace(t)){this.logger.warn(`did not save key "${r}" as the namespace "${t}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!");return}if(!(r==null||r==="")){if(this.backend&&this.backend.create){const s={...o,isUpdate:i},l=this.backend.create.bind(this.backend);if(l.length<6)try{let c;l.length===5?c=l(e,t,r,a,s):c=l(e,t,r,a),c&&typeof c.then=="function"?c.then(d=>u(null,d)).catch(u):u(null,c)}catch(c){u(c)}else l(e,t,r,a,u,s)}!e||!e[0]||this.store.addResource(e[0],t,r,a)}}}const Df=()=>({debug:!1,initImmediate:!0,ns:["translation"],defaultNS:["translation"],fallbackLng:["dev"],fallbackNS:!1,supportedLngs:!1,nonExplicitSupportedLngs:!1,load:"all",preload:!1,simplifyPluralSuffix:!0,keySeparator:".",nsSeparator:":",pluralSeparator:"_",contextSeparator:"_",partialBundledLanguages:!1,saveMissing:!1,updateMissing:!1,saveMissingTo:"fallback",saveMissingPlurals:!0,missingKeyHandler:!1,missingInterpolationHandler:!1,postProcess:!1,postProcessPassResolved:!1,returnNull:!1,returnEmptyString:!0,returnObjects:!1,joinArrays:!1,returnedObjectHandler:!1,parseMissingKeyHandler:!1,appendNamespaceToMissingKey:!1,appendNamespaceToCIMode:!1,overloadTranslationOptionHandler:n=>{let e={};if(typeof n[1]=="object"&&(e=n[1]),_e(n[1])&&(e.defaultValue=n[1]),_e(n[2])&&(e.tDescription=n[2]),typeof n[2]=="object"||typeof n[3]=="object"){const t=n[3]||n[2];Object.keys(t).forEach(r=>{e[r]=t[r]})}return e},interpolation:{escapeValue:!0,format:n=>n,prefix:"{{",suffix:"}}",formatSeparator:",",unescapePrefix:"-",nestingPrefix:"$t(",nestingSuffix:")",nestingOptionsSeparator:",",maxReplaces:1e3,skipOnVariables:!0}}),Vf=n=>(_e(n.ns)&&(n.ns=[n.ns]),_e(n.fallbackLng)&&(n.fallbackLng=[n.fallbackLng]),_e(n.fallbackNS)&&(n.fallbackNS=[n.fallbackNS]),n.supportedLngs&&n.supportedLngs.indexOf("cimode")<0&&(n.supportedLngs=n.supportedLngs.concat(["cimode"])),n),io=()=>{},Ib=n=>{Object.getOwnPropertyNames(Object.getPrototypeOf(n)).forEach(t=>{typeof n[t]=="function"&&(n[t]=n[t].bind(n))})};class gi extends no{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;if(super(),this.options=Vf(e),this.services={},this.logger=Kt,this.modules={external:[]},Ib(this),t&&!this.isInitialized&&!e.isClone){if(!this.options.initImmediate)return this.init(e,t),this;setTimeout(()=>{this.init(e,t)},0)}}init(){var e=this;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1?arguments[1]:void 0;this.isInitializing=!0,typeof t=="function"&&(r=t,t={}),!t.defaultNS&&t.defaultNS!==!1&&t.ns&&(_e(t.ns)?t.defaultNS=t.ns:t.ns.indexOf("translation")<0&&(t.defaultNS=t.ns[0]));const a=Df();this.options={...a,...this.options,...Vf(t)},this.options.compatibilityAPI!=="v1"&&(this.options.interpolation={...a.interpolation,...this.options.interpolation}),t.keySeparator!==void 0&&(this.options.userDefinedKeySeparator=t.keySeparator),t.nsSeparator!==void 0&&(this.options.userDefinedNsSeparator=t.nsSeparator);const i=c=>c?typeof c=="function"?new c:c:null;if(!this.options.isClone){this.modules.logger?Kt.init(i(this.modules.logger),this.options):Kt.init(null,this.options);let c;this.modules.formatter?c=this.modules.formatter:typeof Intl<"u"&&(c=Rb);const d=new xf(this.options);this.store=new Tf(this.options.resources,this.options);const f=this.services;f.logger=Kt,f.resourceStore=this.store,f.languageUtils=d,f.pluralResolver=new Lb(d,{prepend:this.options.pluralSeparator,compatibilityJSON:this.options.compatibilityJSON,simplifyPluralSuffix:this.options.simplifyPluralSuffix}),c&&(!this.options.interpolation.format||this.options.interpolation.format===a.interpolation.format)&&(f.formatter=i(c),f.formatter.init(f,this.options),this.options.interpolation.format=f.formatter.format.bind(f.formatter)),f.interpolator=new Tb(this.options),f.utils={hasLoadedNamespace:this.hasLoadedNamespace.bind(this)},f.backendConnector=new Pb(i(this.modules.backend),f.resourceStore,f,this.options),f.backendConnector.on("*",function(p){for(var v=arguments.length,g=new Array(v>1?v-1:0),h=1;h<v;h++)g[h-1]=arguments[h];e.emit(p,...g)}),this.modules.languageDetector&&(f.languageDetector=i(this.modules.languageDetector),f.languageDetector.init&&f.languageDetector.init(f,this.options.detection,this.options)),this.modules.i18nFormat&&(f.i18nFormat=i(this.modules.i18nFormat),f.i18nFormat.init&&f.i18nFormat.init(this)),this.translator=new ao(this.services,this.options),this.translator.on("*",function(p){for(var v=arguments.length,g=new Array(v>1?v-1:0),h=1;h<v;h++)g[h-1]=arguments[h];e.emit(p,...g)}),this.modules.external.forEach(p=>{p.init&&p.init(this)})}if(this.format=this.options.interpolation.format,r||(r=io),this.options.fallbackLng&&!this.services.languageDetector&&!this.options.lng){const c=this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);c.length>0&&c[0]!=="dev"&&(this.options.lng=c[0])}!this.services.languageDetector&&!this.options.lng&&this.logger.warn("init: no languageDetector is used and no lng is defined"),["getResource","hasResourceBundle","getResourceBundle","getDataByLanguage"].forEach(c=>{this[c]=function(){return e.store[c](...arguments)}}),["addResource","addResources","addResourceBundle","removeResourceBundle"].forEach(c=>{this[c]=function(){return e.store[c](...arguments),e}});const s=pi(),l=()=>{const c=(d,f)=>{this.isInitializing=!1,this.isInitialized&&!this.initializedStoreOnce&&this.logger.warn("init: i18next is already initialized. You should call init just once!"),this.isInitialized=!0,this.options.isClone||this.logger.log("initialized",this.options),this.emit("initialized",this.options),s.resolve(f),r(d,f)};if(this.languages&&this.options.compatibilityAPI!=="v1"&&!this.isInitialized)return c(null,this.t.bind(this));this.changeLanguage(this.options.lng,c)};return this.options.resources||!this.options.initImmediate?l():setTimeout(l,0),s}loadResources(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:io;const a=_e(e)?e:this.language;if(typeof e=="function"&&(r=e),!this.options.resources||this.options.partialBundledLanguages){if(a&&a.toLowerCase()==="cimode"&&(!this.options.preload||this.options.preload.length===0))return r();const i=[],o=u=>{if(!u||u==="cimode")return;this.services.languageUtils.toResolveHierarchy(u).forEach(l=>{l!=="cimode"&&i.indexOf(l)<0&&i.push(l)})};a?o(a):this.services.languageUtils.getFallbackCodes(this.options.fallbackLng).forEach(s=>o(s)),this.options.preload&&this.options.preload.forEach(u=>o(u)),this.services.backendConnector.load(i,this.options.ns,u=>{!u&&!this.resolvedLanguage&&this.language&&this.setResolvedLanguage(this.language),r(u)})}else r(null)}reloadResources(e,t,r){const a=pi();return typeof e=="function"&&(r=e,e=void 0),typeof t=="function"&&(r=t,t=void 0),e||(e=this.languages),t||(t=this.options.ns),r||(r=io),this.services.backendConnector.reload(e,t,i=>{a.resolve(),r(i)}),a}use(e){if(!e)throw new Error("You are passing an undefined module! Please check the object you are passing to i18next.use()");if(!e.type)throw new Error("You are passing a wrong module! Please check the object you are passing to i18next.use()");return e.type==="backend"&&(this.modules.backend=e),(e.type==="logger"||e.log&&e.warn&&e.error)&&(this.modules.logger=e),e.type==="languageDetector"&&(this.modules.languageDetector=e),e.type==="i18nFormat"&&(this.modules.i18nFormat=e),e.type==="postProcessor"&&jf.addPostProcessor(e),e.type==="formatter"&&(this.modules.formatter=e),e.type==="3rdParty"&&this.modules.external.push(e),this}setResolvedLanguage(e){if(!(!e||!this.languages)&&!(["cimode","dev"].indexOf(e)>-1))for(let t=0;t<this.languages.length;t++){const r=this.languages[t];if(!(["cimode","dev"].indexOf(r)>-1)&&this.store.hasLanguageSomeTranslations(r)){this.resolvedLanguage=r;break}}}changeLanguage(e,t){var r=this;this.isLanguageChangingTo=e;const a=pi();this.emit("languageChanging",e);const i=s=>{this.language=s,this.languages=this.services.languageUtils.toResolveHierarchy(s),this.resolvedLanguage=void 0,this.setResolvedLanguage(s)},o=(s,l)=>{l?(i(l),this.translator.changeLanguage(l),this.isLanguageChangingTo=void 0,this.emit("languageChanged",l),this.logger.log("languageChanged",l)):this.isLanguageChangingTo=void 0,a.resolve(function(){return r.t(...arguments)}),t&&t(s,function(){return r.t(...arguments)})},u=s=>{!e&&!s&&this.services.languageDetector&&(s=[]);const l=_e(s)?s:this.services.languageUtils.getBestMatchFromCodes(s);l&&(this.language||i(l),this.translator.language||this.translator.changeLanguage(l),this.services.languageDetector&&this.services.languageDetector.cacheUserLanguage&&this.services.languageDetector.cacheUserLanguage(l)),this.loadResources(l,c=>{o(c,l)})};return!e&&this.services.languageDetector&&!this.services.languageDetector.async?u(this.services.languageDetector.detect()):!e&&this.services.languageDetector&&this.services.languageDetector.async?this.services.languageDetector.detect.length===0?this.services.languageDetector.detect().then(u):this.services.languageDetector.detect(u):u(e),a}getFixedT(e,t,r){var a=this;const i=function(o,u){let s;if(typeof u!="object"){for(var l=arguments.length,c=new Array(l>2?l-2:0),d=2;d<l;d++)c[d-2]=arguments[d];s=a.options.overloadTranslationOptionHandler([o,u].concat(c))}else s={...u};s.lng=s.lng||i.lng,s.lngs=s.lngs||i.lngs,s.ns=s.ns||i.ns,s.keyPrefix!==""&&(s.keyPrefix=s.keyPrefix||r||i.keyPrefix);const f=a.options.keySeparator||".";let p;return s.keyPrefix&&Array.isArray(o)?p=o.map(v=>`${s.keyPrefix}${f}${v}`):p=s.keyPrefix?`${s.keyPrefix}${f}${o}`:o,a.t(p,s)};return _e(e)?i.lng=e:i.lngs=e,i.ns=t,i.keyPrefix=r,i}t(){return this.translator&&this.translator.translate(...arguments)}exists(){return this.translator&&this.translator.exists(...arguments)}setDefaultNamespace(e){this.options.defaultNS=e}hasLoadedNamespace(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!this.isInitialized)return this.logger.warn("hasLoadedNamespace: i18next was not initialized",this.languages),!1;if(!this.languages||!this.languages.length)return this.logger.warn("hasLoadedNamespace: i18n.languages were undefined or empty",this.languages),!1;const r=t.lng||this.resolvedLanguage||this.languages[0],a=this.options?this.options.fallbackLng:!1,i=this.languages[this.languages.length-1];if(r.toLowerCase()==="cimode")return!0;const o=(u,s)=>{const l=this.services.backendConnector.state[`${u}|${s}`];return l===-1||l===0||l===2};if(t.precheck){const u=t.precheck(this,o);if(u!==void 0)return u}return!!(this.hasResourceBundle(r,e)||!this.services.backendConnector.backend||this.options.resources&&!this.options.partialBundledLanguages||o(r,e)&&(!a||o(i,e)))}loadNamespaces(e,t){const r=pi();return this.options.ns?(_e(e)&&(e=[e]),e.forEach(a=>{this.options.ns.indexOf(a)<0&&this.options.ns.push(a)}),this.loadResources(a=>{r.resolve(),t&&t(a)}),r):(t&&t(),Promise.resolve())}loadLanguages(e,t){const r=pi();_e(e)&&(e=[e]);const a=this.options.preload||[],i=e.filter(o=>a.indexOf(o)<0&&this.services.languageUtils.isSupportedCode(o));return i.length?(this.options.preload=a.concat(i),this.loadResources(o=>{r.resolve(),t&&t(o)}),r):(t&&t(),Promise.resolve())}dir(e){if(e||(e=this.resolvedLanguage||(this.languages&&this.languages.length>0?this.languages[0]:this.language)),!e)return"rtl";const t=["ar","shu","sqr","ssh","xaa","yhd","yud","aao","abh","abv","acm","acq","acw","acx","acy","adf","ads","aeb","aec","afb","ajp","apc","apd","arb","arq","ars","ary","arz","auz","avl","ayh","ayl","ayn","ayp","bbz","pga","he","iw","ps","pbt","pbu","pst","prp","prd","ug","ur","ydd","yds","yih","ji","yi","hbo","men","xmn","fa","jpr","peo","pes","prs","dv","sam","ckb"],r=this.services&&this.services.languageUtils||new xf(Df());return t.indexOf(r.getLanguagePartFromCode(e))>-1||e.toLowerCase().indexOf("-arab")>1?"rtl":"ltr"}static createInstance(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return new gi(e,t)}cloneInstance(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:io;const r=e.forkResourceStore;r&&delete e.forkResourceStore;const a={...this.options,...e,isClone:!0},i=new gi(a);return(e.debug!==void 0||e.prefix!==void 0)&&(i.logger=i.logger.clone(e)),["store","services","language"].forEach(u=>{i[u]=this[u]}),i.services={...this.services},i.services.utils={hasLoadedNamespace:i.hasLoadedNamespace.bind(i)},r&&(i.store=new Tf(this.store.data,a),i.services.resourceStore=i.store),i.translator=new ao(i.services,a),i.translator.on("*",function(u){for(var s=arguments.length,l=new Array(s>1?s-1:0),c=1;c<s;c++)l[c-1]=arguments[c];i.emit(u,...l)}),i.init(a,t),i.translator.options=a,i.translator.backendConnector.services.utils={hasLoadedNamespace:i.hasLoadedNamespace.bind(i)},i}toJSON(){return{options:this.options,store:this.store,language:this.language,languages:this.languages,resolvedLanguage:this.resolvedLanguage}}}const Br=gi.createInstance();Br.createInstance=gi.createInstance;const TA=Br.createInstance,jA=Br.dir,RA=Br.init,xA=Br.loadResources,PA=Br.reloadResources,IA=Br.use,DA=Br.changeLanguage,VA=Br.getFixedT,NA=Br.t,kA=Br.exists,MA=Br.setDefaultNamespace,$A=Br.hasLoadedNamespace,GA=Br.loadNamespaces,zA=Br.loadLanguages;var Sa,Db=(Sa={},(0,z.A)((0,z.A)((0,z.A)((0,z.A)((0,z.A)((0,z.A)((0,z.A)((0,z.A)((0,z.A)((0,z.A)(Sa,Jd,"Empty group"),Yd,"No conditions for group field {{field}}"),Kd,"Empty query"),Qd,"Empty case"),Xd,"No config for field {{field}}"),db,"Fixed operator {{from}} to {{to}} for field {{field}}"),Zd,"No config for operator {{operator}}"),ef,"No config for function {{funcKey}}"),rf,"Invalid value"),tf,"Invalid value of arg {{argName}} for func {{funcName}}: {{argValidationError}}"),(0,z.A)((0,z.A)((0,z.A)((0,z.A)((0,z.A)((0,z.A)((0,z.A)((0,z.A)((0,z.A)((0,z.A)(Sa,nf,"Type of field {{field}} is not supported"),af,"Operator {{operator}} is not supported for field {{field}}"),ts,"Incomplete rule"),uf,"Incomplete LHS"),sf,"Incomplete RHS"),of,"Invalid value src {{valueSrcs, list}}"),ns+"_one","Value {{badValues, list}} is not in the list of allowed values"),ns+"_other","Values {{badValues, list}} are not in the list of allowed values"),lf,"Value {{value}} is not in the list of allowed values"),cf,"Value should have type {{wType}}, but got value of type {{valueType}}"),(0,z.A)((0,z.A)((0,z.A)((0,z.A)((0,z.A)((0,z.A)((0,z.A)((0,z.A)((0,z.A)((0,z.A)(Sa,df,"Value should have JS type {{jsType}}, but got value of type {{valueTypeof}}"),ff,"Value {{value}} should have max length {{fieldSettings.maxLength}} but got {{length}}"),as,"Value {{value}} should be greater than or equal to {{fieldSettings.min}}"),as+"_"+os,"Value {{value}} should be from {{fieldSettings.min}} to {{fieldSettings.max}}"),is,"Value {{value}} should be less than or equal to {{fieldSettings.max}}"),is+"_"+os,"Value {{value}} should be from {{fieldSettings.min}} to {{fieldSettings.max}}"),pf,"No config for field {{field}}"),vf,"Can't compare field {{field}} with itself"),gf,"Can't compare field {{leftField}} with {{rightField}}"),hf,"Field {{field}} is of type {{type}}, but expected {{expected}}"),(0,z.A)((0,z.A)((0,z.A)((0,z.A)((0,z.A)((0,z.A)((0,z.A)((0,z.A)((0,z.A)((0,z.A)(Sa,mf,"Unsupported function {{funcKey}} for field {{field}}"),yf,"Value of arg {{argName}} for func {{funcName}} is required"),bf,"Function {{funcKey}} should return value of type {{returnType}}, but got {{valueType}}"),Of,"Invalid range"),Sf,"Root"),on+"__rule","Leaf #{{globalLeafNo}}"),on+"__group","Group #{{globalGroupNo}}"),on+"__rule_group","Rule-group #{{globalNoByType}}"),on+"__case_group","Case #{{globalNoByType}}"),on+"__rule__deleted","Deleted leaf #{{globalLeafNo}}"),(0,z.A)((0,z.A)((0,z.A)((0,z.A)((0,z.A)(Sa,on+"__group__deleted","Deleted group #{{globalGroupNo}}"),on+"__rule_group__deleted","Deleted rule-group #{{globalNoByType}}"),on+"__case_group__deleted","Deleted case #{{globalNoByType}}"),_f,"{{str}} in case #{{caseNo}}"),Ff,"{{str}} (index path: {{indexPath, list}})")),Nf="raqbvalidation",Vb="".concat(Nf,":"),oo=Br.createInstance();oo.init({fallbackLng:"en"}),oo.addResources("en",Nf,Db);var Mt=function n(e,t){return e!=null&&e.str?e.str:e!=null&&e.key?n(e.key,e.args):t===null?e:oo.t(e.includes(":")?e:Vb+e,t)};const Nb=oo;function kf(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),t.push.apply(t,r)}return t}function tr(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?kf(Object(t),!0).forEach(function(r){(0,z.A)(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):kf(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}var Mf=function(e){return(0,We.A)(e)==="object"&&e!==null&&Array.isArray(e)?"array":(0,We.A)(e)},kb=function(e,t){return Mf(e)===t||t==="number"&&!isNaN(e)},$f=function(e,t){return Gf(e,t).length===0},Gf=function(e,t){var r=t.settings.showErrorMessage,a=[];function i(o,u,s){var l,c,d=o.get("id"),f=o.get("children1"),p=o.getIn(["properties","valueError"]),v=o.getIn(["properties","fieldError"]),g=o.getIn(["properties","field"]),h=(l=g==null||(c=g.get)===null||c===void 0?void 0:c.call(g,"func"))!==null&&l!==void 0?l:g,y=p?.size>0&&p.filter(function(b){return b!=null}).size>0,m=y||!!v;m&&r&&a.push(h),f&&f.map(function(b,O){b&&i(b,u.concat(d),s+1)})}return e&&i(e,[],0),Array.from(new Set(a))},zf=function(e,t){var r=gt(t,void 0,!0),a={removeEmptyGroups:t.settings.removeEmptyGroupsOnLoad,removeIncompleteRules:t.settings.removeIncompleteRulesOnLoad,removeEmptyRules:t.settings.removeEmptyRulesOnLoad,forceFix:!1},i=hi(e,null,r,r,a),o=i.fixedTree,u=i.allErrors,s=i.isSanitized;return s&&u.length&&console.warn("Tree check errors: ",u),o},Uf=function(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},a=gt(t,void 0,!0),i=tr(tr({},r),{},{removeEmptyGroups:!1,removeEmptyRules:!1,removeIncompleteRules:!1,forceFix:!1}),o=hi(e,null,a,a,i),u=o.allErrors;return u},Wf=function(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},a=gt(t,void 0,!0),i=tr({removeEmptyGroups:!0,removeEmptyRules:!0,removeIncompleteRules:!0,forceFix:!1},r),o=hi(e,null,a,a,i),u=o.fixedTree,s=o.fixedErrors,l=o.nonFixedErrors,c=o.allErrors;return{fixedTree:u,fixedErrors:s,nonFixedErrors:l,allErrors:c}},Bf=function(e,t,r,a,i,o,u){i===void 0&&(i=r.settings.removeEmptyGroupsOnLoad),o===void 0&&(o=r.settings.removeEmptyRulesOnLoad),u===void 0&&(u=r.settings.removeIncompleteRulesOnLoad);var s={removeEmptyGroups:i,removeEmptyRules:o,removeIncompleteRules:u,forceFix:!1},l=hi(e,t,r,a,s),c=l.fixedTree,d=l.allErrors,f=l.fixedErrors,p=l.nonFixedErrors,v=l.isSanitized;return v&&f.length&&console.warn("Fixed tree errors: ",f),c=kt(c),c},hi=function(e,t,r,a,i){if(!e)return{fixedTree:e,allErrors:[],fixedErrors:[],nonFixedErrors:[],isSanitized:!1};var o=i||{},u=o.removeEmptyGroups,s=o.removeEmptyRules,l=o.removeIncompleteRules,c=o.forceFix,d=o.translateErrors,f=d===void 0?!0:d,p=o.includeStringifiedItems,v=p===void 0?!0:p,g=o.stringifyFixedItems,h=g===void 0?!1:g,y=o.stringifyItemsUserFriendly,m=y===void 0?!0:y,b=o.includeItemsPositions,O=b===void 0?!0:b,S={config:r,oldConfig:a,removeEmptyGroups:u,removeEmptyRules:s,removeIncompleteRules:l,forceFix:c},F={errors:{}},_=Hf(e,[],null,F,S),T=F.sanitized,E=[],A,j;O&&(A=Uu(_,r).items);for(var R in F.errors){var L=F.errors[R],N=L.path,I=L.errors;f&&(I=I.map(function(fe){return tr(tr({},fe),{},{str:Mt(fe)})}));var P={path:N,errors:I};if(v){var x=Sn(h?_:e,N),k=N.length===1;if(!k&&x.get("type")!=="group"){var V=!0,G=m,$=Ud(x,r,G,V);P.itemStr=$}}if(O){var W=A[R],q=!W;if(q&&(j||(j=Uu(e,r).items),W=j[R]),W){var J=tr(tr({},W.position),{},{index:W.index,type:W.type,isDeleted:q});P.itemPosition=J;var K=W.index?on+"__"+W.type+(q?"__deleted":""):Sf,U=tr({},J);if(m){for(var X,Y=0,ae=["caseNo","globalLeafNo","globalGroupNo","globalNoByType"];Y<ae.length;Y++){var ge=ae[Y];U[ge]!=null&&(U[ge]=U[ge]+1)}U.indexPath=(X=J.indexPath)===null||X===void 0?void 0:X.map(function(fe){return fe+1})}P.itemPositionStr=Mt(K,U),W.index&&(W.caseId&&W.type!=="case_group"&&(P.itemPositionStr=Mt(_f,tr(tr({},U),{},{str:P.itemPositionStr}))),W.type!=="case_group"&&(P.itemPositionStr=Mt(Ff,tr(tr({},U),{},{str:P.itemPositionStr}))))}}E.push(P)}for(var se=[],ce=[],de=0,ne=E;de<ne.length;de++){var ve=ne[de],ye=ve.errors.filter(function(fe){return!!fe.fixed}),Ce=ve.errors.filter(function(fe){return!fe.fixed&&fe.key!=="EMPTY_QUERY"});ye.length&&se.push(tr(tr({},ve),{},{errors:ye})),Ce.length&&ce.push(tr(tr({},ve),{},{errors:Ce}))}return{fixedTree:_,allErrors:E,fixedErrors:se,nonFixedErrors:ce,isSanitized:T}};function An(n,e,t,r){var a=e.get("id");n.errors[a]||(n.errors[a]={path:[].concat((0,Q.A)(t),[a]),errors:[]}),n.errors[a].errors.push(r)}function qf(n,e){var t=e.get("id");n.errors[t]&&n.errors[t].errors.map(function(r){r.fixed=!0})}function Hf(n,e,t,r,a){var i=n?.get("type");return i==="group"||i==="rule_group"||i=="case_group"||i=="switch_group"?Mb(n,e,t,r,a):i==="rule"?Jf(n,e,t,r,a):n}function Mb(n,e,t,r,a){var i,o,u,s,l,c,d=a.removeEmptyGroups,f=a.removeIncompleteRules,p=a.forceFix,v=a.config,g=v.settings.showErrorMessage,h=!g||p,y=n.get("id"),m=n.get("children1"),b=!e.length,O=m,S=n.get("type"),F=n.get("properties"),_=F?.get("field"),T=F?.get("mode"),E=F==null||(i=F.get)===null||i===void 0?void 0:i.call(F,"operator"),A=S==="rule_group"&&T==="array",j=S==="case_group",R=j&&m==null,L=E?(o=(u=v.operators[E])===null||u===void 0?void 0:u.cardinality)!==null&&o!==void 0?o:1:void 0,N=j?!R:A?L==0:d,I=A||j;!y&&t&&(y=t,n=n.set("id",y),r.sanitized=!0),I&&(n=Jf(n,e,t,r,a));var P={errors:{}};m=(s=m)===null||s===void 0?void 0:s.map(function($,W){return Hf($,e.concat(y),W,P,a)});var x=(l=m)===null||l===void 0?void 0:l.filter(function($){return $!=null});d&&(m=x);var k=P.sanitized||O?.size!=((c=m)===null||c===void 0?void 0:c.size),V=!(x!=null&&x.size),G=d&&!b;return A&&_&&(G=f),V&&N&&(An(r,n,e,{key:b?Kd:j?Qd:A?Yd:Jd,args:{field:_},fixed:G}),G&&(qf(r,n),n=void 0)),k&&(r.sanitized=!0),k&&n&&(n=n.set("children1",m)),r.errors=tr(tr({},r.errors),P?.errors||{}),n}function Jf(n,e,t,r,a){var i=a.removeIncompleteRules,o=a.removeEmptyRules,u=a.forceFix,s=a.config,l=a.oldConfig,c=s.settings.showErrorMessage,d=!c||u,f=n,p=n.get("id"),v=n.get("type"),g=v==="case_group",h=n.get("properties");if(!h)if(g)h=new pe.Map;else{var y={key:ts,args:{},fixed:i||o};An(r,n,e,y);return}var m=h.get("field")||null;g&&(m="!case_value");var b=h.get("fieldSrc")||null,O=h.get("operator")||null,S=h.get("operatorOptions"),F=h.get("valueSrc"),_=h.get("value"),T=h.get("valueError"),E=h.get("fieldError"),A=function(){var ne,ve;return{field:((ne=m)===null||ne===void 0||(ve=ne.toJS)===null||ve===void 0?void 0:ve.call(ne))||m,fieldSrc:b,operator:O,operatorOptions:S?S.toJS():{},valueSrc:F?F.toJS():null,value:_?_.toJS():null,valueError:T?T.toJS():null,fieldError:E||null}},j=A();!p&&t&&(p=t,n=n.set("id",p),r.sanitized=!0);var R=m?oe(s,m):null;m&&!R&&(An(r,n,e,{key:Xd,args:{field:m},side:"lhs",fixed:i||o}),m=null),m==null&&!g&&(h=["operator","operatorOptions","valueSrc","value","valueError","fieldError","field"].reduce(function(de,ne){return de.delete(ne)},h),O=null),!b&&m&&!g&&(b=xp(m),h=h.set("fieldSrc",b)),(O==="range_between"||O==="range_not_between")&&(O=O==="range_between"?"between":"not_between",h=h.set("operator",O));var L=O?Ie(s,O,m):null;O&&!L&&(An(r,n,e,{key:Zd,args:{operator:O},side:"op",fixed:i||o}),O=null);var N=m?lo(s,m):[];m&&!g&&(N!=null&&N.length?O&&N.indexOf(O)==-1&&(O==="is_empty"||O==="is_not_empty"?(O=O==="is_empty"?"is_null":"is_not_null",h=h.set("operator",O)):(An(r,n,e,{key:af,args:{operator:O,field:m},side:"lhs",fixed:i||o}),O=null)):(An(r,n,e,{key:nf,args:{field:m},side:"lhs",fixed:i||o}),O=null)),O==null&&!g&&(h=["operatorOptions","valueSrc","value","valueError"].reduce(function(de,ne){return de.delete(ne)},h)),S=h.get("operatorOptions"),!O||S&&!L.options?(S=null,h=h.delete("operatorOptions")):O&&!S&&L.options&&(S=fi(s,O,m),h=h.set("operatorOptions",S)),F=h.get("valueSrc"),_=h.get("value");var I=!0,P=$n(s,l,h,m,O,null,d,I),x=P.newValue,k=P.newValueSrc,V=P.newValueError,G=P.validationErrors,$=P.newFieldError,W=P.fixedField;_=x,F=k,T=V,E=$,m=W,h=h.set("field",m),h=h.set("value",_),h=h.set("valueSrc",F),c?h=h.set("valueError",T).set("fieldError",E):h=h.delete("valueError").delete("fieldError");var q=A(),J=!Bi(j,q),K=ys(h.toObject(),s),U=g?K.parts.value:K.score>=3;if(J&&(r.sanitized=!0,n=n.set("properties",h)),G?.map(function(de){return An(r,n,e,de)}),!U&&!g){var X=K.score?i:o,Y={key:ts,args:{}};if(!K.parts.field)Y.key=uf,Y.side="lhs";else if(!K.parts.value){var ae,ge,se,ce;Y.key=sf,Y.side="rhs",(ae=q.valueSrc)!==null&&ae!==void 0&&ae[0]&&((ge=q.valueSrc)===null||ge===void 0?void 0:ge[0])!=((se=j.valueSrc)===null||se===void 0?void 0:se[0])&&((ce=q.value)===null||ce===void 0?void 0:ce[0])!=null&&(Y.key=of,Y.args={valueSrcs:q.valueSrc})}Y.fixed=X,An(r,n,e,Y),X&&(qf(r,n),n=void 0)}return n}var Fa=function(e,t,r,a,i,o,u,s){var l=arguments.length>8&&arguments[8]!==void 0?arguments[8]:!1,c=arguments.length>9&&arguments[9]!==void 0?arguments[9]:!1,d=arguments.length>10&&arguments[10]!==void 0?arguments[10]:!1,f=[],p=i;if(i!=null){var v,g,h,y;if(u==="field"){var m=zb(t,r,i,u,o,s,e,a,l,c),b=(0,ie.A)(m,2);p=b[0],f=b[1]}else if(u==="func"){var O=Ub(t,r,i,u,o,s,e,a,l,c,d),S=(0,ie.A)(O,2);p=S[0],f=S[1]}else if(u==="value"||!u){var F=Gb(r,i,u,o,s,e,a,l,c),_=(0,ie.A)(F,2);p=_[0],f=_[1]}var T=!((v=f)!==null&&v!==void 0&&v.find(function(J){return!J.fixed})),E=!!r&&!["field","func"].includes(u)&&(!((g=f)!==null&&g!==void 0&&g.length)||T);if(E){var A=nr(e,r,a,u),j=a?Ie(e,a,r):null,R=Hr(e,r,a,A,u,{forExport:!0}),L=u==="field"?oe(e,i):null,N=R,I=R.validateValue;if(typeof I=="function"){var P=[p,N,a,j];u==="field"&&P.push(L);var x=I.call.apply(I,[e.ctx].concat(P));if((0,We.A)(x)==="object"&&x!==null&&!Array.isArray(x)){var k,V;(k=x.error)!==null&&k!==void 0&&k.key?V=tr({},x.error):V={key:x.error,args:null},x.fixedValue!==void 0&&l&&(V.fixed=!0,V.fixedFrom=p,V.fixedTo=x.fixedValue,p=x.fixedValue),f.push(V)}else typeof x=="boolean"?x==!1&&f.push({key:rf,args:{}}):typeof x=="string"&&f.push({key:x,args:null})}}if(T=!((h=f)!==null&&h!==void 0&&h.find(function(J){return!J.fixed})),(y=f)!==null&&y!==void 0&&y.length&&!T&&l){var G=oe(e,r),$=G?.fieldSettings,W=$?.defaultValue;if(W!==void 0){var q=f[f.length-1];q.fixed=!0,q.fixedFrom=p,q.fixedTo=W,p=W,f.map(function(J){J.fixed=!0})}}}return[p,f]},$b=function(e,t,r,a,i){var o=pe.List.isList(e)?e.toJS():e instanceof Array?(0,Q.A)(e):void 0,u=e,s=[];if(o){var l=o.reduce(function(h,y){var m=(0,ie.A)(h,2),b=m[0],O=m[1],S=oi(t,y);return S==null?[b,[].concat((0,Q.A)(O),[y])]:[[].concat((0,Q.A)(b),[S.value]),O]},[[],[]]),c=(0,ie.A)(l,2),d=c[0],f=c[1],p=f.length>0;if(r=r||i===!0,u=r&&p?d:e,f.length){var v=r&&p;s.push({key:ns,args:{badValues:f,count:f.length},fixed:v,fixedFrom:v?o:void 0,fixedTo:v?u:void 0})}return[u,s]}else{var g=oi(t,e);return g==null?(u=r?null:e,s.push({key:lf,args:{value:e},fixed:r,fixedFrom:r?e:void 0,fixedTo:r?u:void 0})):u=g.value,[u,s]}},Gb=function(e,t,r,a,i,o){var u=arguments.length>6&&arguments[6]!==void 0?arguments[6]:null,s=arguments.length>7&&arguments[7]!==void 0?arguments[7]:!1,l=arguments.length>8&&arguments[8]!==void 0?arguments[8]:!1,c=[],d=t;if(e){var f=oe(o,e),p=nr(o,e,u,r),v=o.widgets[p],g=v?.type,h=v?.jsType,y=f?.fieldSettings,m=y?.treeValues||y?.listValues,b=!!(y!=null&&y.asyncFetch),O=m||b;if(a&&g&&a!=g)return c.push({key:cf,args:{wType:g,valueType:a}}),[t,c];if(h&&!kb(t,h)&&!O)return c.push({key:df,args:{jsType:h,valueTypeof:Mf(t)}}),[t,c];if(y){var S=i||m;if(S&&!y.allowCustomValues&&p!=="case_value"){var F=$b(t,S,s,l,o.settings.removeInvalidMultiSelectValuesOnLoad),_=(0,ie.A)(F,2);d=_[0],c=_[1]}y.maxLength>0&&t!=null&&String(t).length>y.maxLength&&(d=s?String(t).substring(0,y.maxLength):t,c.push({key:ff,args:{value:t,length:String(t).length,fieldSettings:y},fixed:s,fixedFrom:s?t:void 0,fixedTo:s?d:void 0}));var T=y.min!=null&&y.max!=null?os:void 0;y.min!=null&&t<y.min&&(d=s?y.min:t,c.push({key:as,args:{value:t,fieldSettings:y,context:T},fixed:s,fixedFrom:s?t:void 0,fixedTo:s?d:void 0})),y.max!=null&&t>y.max&&(d=s?y.max:t,c.push({key:is,args:{value:t,fieldSettings:y,context:T},fixed:s,fixedFrom:s?t:void 0,fixedTo:s?d:void 0}))}}return[d,c]},zb=function(e,t,r,a,i,o,u){var s=arguments.length>7&&arguments[7]!==void 0?arguments[7]:null,l=arguments.length>8&&arguments[8]!==void 0?arguments[8]:!1,c=arguments.length>9&&arguments[9]!==void 0?arguments[9]:!1,d=[],f=u.settings,p=f.fieldSeparator,v=f.canCompareFieldWithField,g=(0,We.A)(t)=="object"&&t?._isFuncArg,h=Array.isArray(e)?e.join(p):e,y=oe(u,e),m=Array.isArray(r)?r.join(p):r,b=oe(u,r);if(!b)return d.push({key:pf,args:{field:m}}),[r,d];if(e&&m===h&&!g)return d.push({key:vf,args:{field:h}}),[r,d];if(i&&i!=b.type)return d.push({key:hf,args:{field:m,type:b.type,expected:i}}),[r,d];if(e&&!g&&v){var O=v(h,y,m,b,s);if(!O)return d.push({key:gf,args:{leftField:h,rightField:m}}),[r,d]}return[r]},Ub=function(e,t,r,a,i,o,u){var s,l,c=arguments.length>7&&arguments[7]!==void 0?arguments[7]:null,d=arguments.length>8&&arguments[8]!==void 0?arguments[8]:!1,f=arguments.length>9&&arguments[9]!==void 0?arguments[9]:!1,p=arguments.length>10&&arguments[10]!==void 0?arguments[10]:!1,v=r,g=[];if(!r)return[r];var h=(s=r.get)===null||s===void 0?void 0:s.call(r,"func");if(!h)return[r];var y=oe(u,t);if(y!=null&&y.funcs&&!y.funcs.includes(h))return g.push({key:mf,args:{funcKey:h,field:t}}),[r,g];var m=Ar(u,h);if(!m)return g.push({key:ef,args:{funcKey:h}}),[r,g];var b=(l=m.label)!==null&&l!==void 0?l:h;if(i&&m.returnType!=i)return g.push({key:bf,args:{funcKey:h,funcName:b,returnType:m.returnType,valueType:i}}),[r,g];d=d||p;for(var O in m.args){var S,F=m.args[O],_=v.get("args"),T=_?_.get(O):void 0,E=oe(u,F),A=(S=E?.label)!==null&&S!==void 0?S:O,j=T?T.get("value"):void 0,R=T?T.get("valueSrc"):void 0;if(j!==void 0){var L=Fa(u,e,E,c,j,F.type,R,o,d,f,p),N=(0,ie.A)(L,2),I=N[0],P=N[1],x=!(P!=null&&P.length),k=d&&I!==j,V=d&&!x&&!k&&(f||p);if(k&&(v=v.setIn(["args",O,"value"],I)),V&&(v=v.deleteIn(["args",O]),v=uo(u,v,m,O)),!x){var G,$,W=(G=($=P.find(function(Y){return!Y.fixed&&!Y.ignore}))!==null&&$!==void 0?$:P.find(function(Y){return!Y.fixed}))!==null&&G!==void 0?G:P[0],q=k||V,J=P.filter(function(Y){return!Y.ignore}).length===0;if(W){var K=Mt(W);g.push({key:tf,args:{funcKey:h,funcName:b,argKey:O,argName:A,argValidationError:K,argErrors:P},ignore:J,fixed:q,fixedFrom:q?j:void 0,fixedTo:q?k?I:F.defaultValue:void 0})}}}else if(!F.isOptional&&(f||p)){var U=d&&F.defaultValue!==void 0&&(f||p),X=f;X&&g.push({key:yf,args:{funcKey:h,funcName:b,argKey:O,argName:A},fixed:U,fixedTo:U?F.defaultValue:void 0,ignore:!U}),U&&(v=v.deleteIn(["args",O]),v=uo(u,v,m,O))}}return[v,g]},cs=function(e,t,r,a,i){var o=Ie(e,r,t),u=r?Cr(o):null,s=i.toJS?i.toJS():i,l=a.toJS?a.toJS():a,c=s.filter(function(y){return y=="value"||y==null}).length==u,d;if(o!=null&&o.validateValues&&c){var f=s[0],p=nr(e,t,r,f),v=Hr(e,t,r,p,f),g=v!=null&&v.toJS?l.map(function(y){var m=v.toJS.call(e.ctx,y,v);return m instanceof Date&&(m=m.getTime()),m}):l,h=o.validateValues(g);typeof h=="boolean"&&h==!1&&(d={key:Of,args:{jsValues:g,values:l}})}return d},$n=function(e){var t,r,a,i,o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,u=arguments.length>2?arguments[2]:void 0,s=arguments.length>3?arguments[3]:void 0,l=arguments.length>4?arguments[4]:void 0,c=arguments.length>5&&arguments[5]!==void 0?arguments[5]:null,d=arguments.length>6&&arguments[6]!==void 0?arguments[6]:!1,f=arguments.length>7&&arguments[7]!==void 0?arguments[7]:!1,p=arguments.length>8&&arguments[8]!==void 0?arguments[8]:!1;o||(o=e);var v=e.settings,g=v.keepInputOnChangeFieldSrc,h=v.convertableWidgets,y=v.clearValueOnChangeField,m=v.clearValueOnChangeOp,b=s=="!case_value",O=u.get("field");!O&&b&&(O=s);var S=u.get("fieldType"),F=u.get("fieldSrc"),_=u.get("operator"),T=u.get("value"),E=u.get("valueSrc",new pe.List),A=u.get("valueType",new pe.List),j=u.get("valueError",new pe.List),R=u.get("asyncListValues"),L=b,N=Ie(o,_),I=Ie(e,l,s),P=b?1:_?Cr(N):null,x=b?1:l?Cr(I):null,k=oe(o,O),V=oe(e,s),G=!O&&S&&g,$=k?.type||S,W=V?.type||!s&&G&&$,q=k?.listValuesType,J=V?.listValuesType,K=((t=O)===null||t===void 0||(r=t.get)===null||r===void 0?void 0:r.call(t,"func"))||O,U=((a=s)===null||a===void 0||(i=a.get)===null||i===void 0?void 0:i.call(a,"func"))||s,X=U!=K,Y=[],ae=(O||G)&&(_&&l||L)&&T!=null;(!($&&W&&$==W)||c==="field"&&X&&y||c==="operator"&&m)&&(ae=!1),X&&so.includes(W)&&(J&&J===q||(ae=!1)),!L&&(!(T!=null&&T.size)&&x||T!=null&&T.size&&!x)&&(ae=!1);var ge;if(F==="func"&&s){var se=Fa(e,null,null,l,s,W,F,R,d,f,p),ce=(0,ie.A)(se,2),de=ce[0],ne=ce[1],ve=!(ne!=null&&ne.length),ye=de!==s,Ce=!ve&&ye&&!ne.find(function(Kr){return!Kr.fixed}),fe=d&&!ve&&!Ce&&!!c&&s!==O,ar=!1;if(ar?s=null:fe?s=O:ye&&(s=de),!ve){var Le=!ve&&!Ce&&!ar&&!fe,Me=ne.find(function(Kr){return!Kr.fixed&&!Kr.ignore});Le&&Me&&(ge=Mt(Me)),ne.map(function(Kr){return Y.push(tr(tr({side:"lhs"},Kr),{},{fixed:Kr.fixed||fe||ar}))})}}for(var Ae=0;Ae<x;Ae++){var Tr=E.get(Ae)||null,Dr=nr(o,O,_,Tr),xr=nr(e,s,l,Tr),$r=Tr==="value"?Dr:nr(o,O,_,"value"),je=Tr==="value"?xr:nr(e,s,l,"value"),yr=je==$r||(h[$r]||[]).includes(je)||!$r&&G;yr||(ae=!1)}_!=l&&[_,l].includes("proximity")&&(ae=!1);var Gr=E.first(),pr=Hr(e,s,l,null,Gr),zr=np(e,s,l,null);!s&&G&&(zr=Object.keys(e.settings.valueSourcesInfo));var Pe=zr[0],Vr;x===1&&pr&&pr.type!==void 0?Vr=pr.type:x===1&&V&&V.type!==void 0&&(Vr=V.type==="!group"?"number":V.type);var Pr=ae&&c==="operator"&&P===1&&x===2,Sr=[],Jr=[],Ln=[],Yr=Array.from({length:x},function(){return null});if(ae)for(var Fr=function(ir){var $e=T.get(ir),ht=A.get(ir)||null,ln=E.get(ir)||null;Pr&&ir===1&&($e=Sr[0]!==void 0?Sr[0]:T.get(0),Sr[ir]=$e,ht=A.get(0)||null,ln=E.get(0)||null);var _A=ln?zr.find(function(Pt){return Pt==ln})!==void 0:!0,CA=Fa(e,s,s,l,$e,ht,ln,R,d,f,p),fm=(0,ie.A)(CA,2),pm=fm[0],ut=fm[1],wi=!(ut!=null&&ut.length),Vo=pm!==$e,wA=!wi&&Vo&&!(ut!=null&&ut.find(function(Pt){return!Pt.fixed})),AA=!(ut!=null&&ut.find(function(Pt){return!Pt.fixed&&!Pt.ignore})),vm=!_A||d&&!wi&&!wA&&(!AA||X);wi||ut?.map(function(Pt){return Y.push(tr(tr({side:"rhs",delta:ir},Pt),{},{fixed:Pt.fixed||vm}))}),vm&&(Sr[ir]=null,ir===0&&delete Sr[1]);var EA=!wi&&!Vo,gm=ut?.find(function(Pt){return!Pt.fixed&&!Pt.ignore});EA&&gm&&(Yr[ir]=Mt(gm)),Vo&&(Sr[ir]=pm),Pr&&ir===0&&!wi&&!Vo&&(Pr=!1),Pr&&ir===0&&["func","field"].includes(ln)&&(Pr=!1)},he=0;he<x;he++)Fr(he);if(!ae){for(var be=0;be<x;be++)if(x===1){var Ee,De=Mc([V?.defaultValue,V==null||(Ee=V.fieldSettings)===null||Ee===void 0?void 0:Ee.defaultValue,pr?.defaultValue]);Sr[be]=De,De!=null&&De.func&&(Jr[be]="func")}}for(var Be=0;Be<x;Be++){var vr=ae&&E.get(Be)||null,cr=ae&&A.get(Be)||null;if(ae&&Pr&&Be===1){var ft,br;vr=(ft=Jr[Be])!==null&&ft!==void 0?ft:E.get(0),cr=(br=Ln[Be])!==null&&br!==void 0?br:A.get(0),Jr[Be]=vr,Ln[Be]=cr}var Tn=zr.includes(vr);Tn||(Jr[Be]=Pe),cr||(Ln[Be]=Vr)}var Nr=T;(Sr.length>0||!ae||x<P)&&(Nr=new pe.List(Array.from({length:x},function(Kr,ir){return Sr[ir]!==void 0?Sr[ir]:ae?T.get(ir):void 0})));var Gt=E;(Jr.length>0||!ae||x<P)&&(Gt=new pe.List(Array.from({length:x},function(Kr,ir){var $e;return($e=Jr[ir])!==null&&$e!==void 0?$e:ae&&E.get(ir)||null})));var sn=A;(Ln.length>0||!ae||x<P)&&(sn=new pe.List(Array.from({length:x},function(Kr,ir){var $e;return($e=Ln[ir])!==null&&$e!==void 0?$e:ae&&A.get(ir)||null})));var jt=cs(e,s,l,Nr,Gt);if(jt){var zt=Mt(jt),Rt=d&&x>=2,xt=Nr;Rt&&(Sr[1]=Nr.get(0),Nr=Nr.set(1,Sr[1]),Yr[1]=Yr[0]);var Ci=!Rt;Ci&&Yr.push(zt),Y.push(tr(tr({side:"rhs",delta:-1},jt),{},{fixed:Rt,fixedFrom:Rt?[xt.get(0),xt.get(1)]:void 0,fixedTo:Rt?[Nr.get(0),Nr.get(1)]:void 0}))}var ot=j,Do=j?.size!==Yr.length||Yr.filter(function(Kr,ir){return Kr!=j.get(ir)}).length>0;return Do&&(ot=new pe.List(Yr)),{canReuseValue:ae,newValue:Nr,newValueSrc:Gt,newValueType:sn,operatorCardinality:x,fixedField:s,newValueError:ot,newFieldError:ge,validationErrors:Y}},ds=function(e){return(0,We.A)(e)=="object"&&e!==null&&!Array.isArray(e)},Yf=function(e,t){if(e){var r=e.get("func"),a=r&&Ar(t,r);if(a){var i=e,o=!1;for(var u in a.args){var s=a.args[u],l=s.valueSources,c=s.isOptional,d=s.defaultValue,f=Gn(t,l,s),p=i.get("args"),v=f.length==1?f[0]:void 0,g=p?p.get(u):void 0,h=g?g.get("value"):void 0,y=(g?g.get("valueSrc"):void 0)||v;if(h!==void 0){var m=zn(h,y,t);if(m===void 0||(m!==h&&(i=i.setIn(["args",u,"value"],m)),o))return}else if(d!==void 0&&!ds(d))i=i.setIn(["args",u,"value"],Qf(s)),i=i.setIn(["args",u,"valueSrc"],"value");else if(c)o=!0;else return}return i}}},Kf=function(e,t,r,a){var i=r.settings.fieldSeparator;e=e||new pe.Map,Array.isArray(t)&&(t=t.join(i));var o=e.get("func"),u=e.get("args");e=e.set("func",t);var s=t&&Ar(r,t),l=t&&ws(r,t),c=o&&ws(r,o),d=Zf(c,l,u,r,a);if(d.length){var f=Object.keys(l.args),p=f.filter(function(v){return!d.includes(v)});e=p.reduce(function(v,g){return v.deleteIn(["args",g])},e)}else e=e.set("args",new pe.Map);return e=Wb(r,e,s),e},Wb=function(e,t,r){if(r)for(var a in r.args)t=uo(e,t,r,a);return t},uo=function(e,t,r,a){var i=r.args[a],o=i.valueSources,u=i.defaultValue,s=Gn(e,o,i),l=s.length?s[0]:void 0,c=u?ds(u)&&u.func?"func":"value":void 0,d=c||l,f=t.getIn(["args",a]);return f||(u!==void 0&&(t=t.setIn(["args",a,"value"],Qf(i))),d&&(t=t.setIn(["args",a,"valueSrc"],d))),t},Qf=function(e){var t=e.defaultValue;return ds(t)&&!pe.Map.isMap(t)&&t.func?pe.fromJS(t,function(r,a){return pe.Iterable.isIndexed(a)?a.toList():a.toOrderedMap()}):t},fs=function(e,t,r,a,i){if(e&&e.get("func")){e=e.setIn(["args",t,"value"],r);var o=e.getIn(["args",t,"valueSrc"]),u=a.valueSources,s=Gn(i,u,a),l=s.length==1?s[0]:void 0;!l&&s.includes("value")&&(l="value"),!o&&l&&(e=e.setIn(["args",t,"valueSrc"],l))}return e},Xf=function(e,t,r,a,i){return e&&e.get("func")&&(e=e.setIn(["args",t],new pe.Map({valueSrc:r}))),e},Zf=function(e,t,r,a){var i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;if(e?.returnType!=t?.returnType)return[];var o=!1,u=Object.keys(t.args),s=u.filter(function(l,c){var d=t.args[l],f=e.args[l],p=Object.keys(e.args).indexOf(l);if(!f&&(d.defaultValue!==void 0||d.isOptional))return!0;if(o&&c!==p||f?.type!=d.type||so.includes(d.type)&&(!f.listValuesType||f.listValuesType!==d.listValuesType))return!1;if(r){var v,g=r.get(l),h=g?.get("value"),y=g?.get("valueSrc");if(y&&d.valueSources&&!d.valueSources.includes(y))return!1;var m=null,b=null,O=d,S=null,F=!0,_=Fa(a,m,O,b,h,O.type,y,S,i,F),T=(0,ie.A)(_,2),E=T[0],A=T[1];if(A!=null&&(v=A.filter(function(j){return!j.fixed}))!==null&&v!==void 0&&v.length)return!1}return!0});return s},so=["select","multiselect","treeselect","treemultiselect"],ep=function(e,t){var r;return((r=e.types[t])===null||r===void 0?void 0:r.operators)||null},lo=function(e,t){var r=oe(e,t),a=r?r.operators:[];return a},ps=function(e,t){var r,a=lo(e,t);return(r=a?.[0])!==null&&r!==void 0?r:null},rp=function(e,t,r){var a=null;if(e){if(t==="field"){var i=oe(r,e);i&&(a=i.type)}else if(t==="func"){var o=e.get("func");if(o){var u=Ar(r,o);u&&(a=u.returnType||u.type)}}}return a},Bb=function(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;return mi(e,t,r,"funcs","subfields")},mi=function(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null,a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"fields",i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:"subfields";if(!e)return null;var o=t.settings.fieldSeparator,u=mr(e,t),s=mr(r,t),l=u.slice(s.length).map(function(c,d,f){return f.slice(0,d+1)}).map(function(c){return[].concat((0,Q.A)(s),(0,Q.A)(c)).join(o)}).map(function(c){var d=$t(t,c,a,i);return d&&d.label||Ji()(c.split(o))}).filter(function(c){return c!=null});return l},tp=function(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;if(!e)return null;var a=r&&$t(t,r)||null,i=t.settings.fieldSeparator,o=mr(e,t),u=Rp(e,r,t),s=u?mr(r,t):[];return o.slice(s.length).map(function(l,c,d){return d.slice(0,c+1)}).map(function(l){return{part:[].concat((0,Q.A)(s),(0,Q.A)(l)).join(i),key:l[l.length-1]}}).map(function(l){var c=l.part,d=l.key,f=$t(t,c);return{key:d,cnf:f}}).map(function(l,c,d){var f=l.key,p=l.cnf,v=c>0?d[c-1].cnf:a;return[f,p,v]})},qb=function(e,t,r,a){var i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:null,o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!1,u=Hr(e,t,r,null,i)||{},s=Ie(e,r,t)||{},l=o?1:s.cardinality,c=null;if(l>1){var d=u.valueLabels||s.valueLabels;d&&(c=d[a]),c&&(0,We.A)(c)!=="object"&&(c={label:c,placeholder:c}),c||(c={label:e.settings.valueLabel+" "+(a+1),placeholder:e.settings.valuePlaceholder+" "+(a+1)})}else{var f=u.valueLabel,p=u.valuePlaceholder;c={label:f||e.settings.valueLabel,placeholder:p||e.settings.valuePlaceholder}}return c};function vs(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null,a=[],i=[];if(!e)return{widgets:a,valueSrcs:i};var o=ho(e),u=o?"".concat(o,"__").concat(t,"__").concat(r):null,s=mo(n,"_getWidgetsAndSrcsForFieldOp",u);if(s)return s;var l=(0,We.A)(e)==="object"&&(!!e.func&&!!e.arg||e._isFuncArg),c=oe(n,e),d=t?n.operators[t]:null;if(c!=null&&c.widgets){var f=function(){var y=c.widgets[p];if(!n.widgets[p])return 1;var m=n.widgets[p].valueSrc||"value",b=!0;if(p==="field"&&(b=b&&Gn(n,["field"],c).length>0),p==="func"&&(b=b&&Gn(n,["func"],c).length>0),r==="value"&&!y.operators&&!l&&e!=="!case_value"&&(b=!1),y.operators&&t&&(b=b&&y.operators.indexOf(t)!=-1),r&&r!=m&&r!=="const"&&(b=!1),d&&d.cardinality==0&&m!=="value"&&(b=!1),b){var O,S;a.push(p);var F=((O=c.valueSources)===null||O===void 0?void 0:O.indexOf(m))!=-1;(d==null||(S=d.valueSources)===null||S===void 0?void 0:S.indexOf(m))==-1&&(F=!1),F&&!i.find(function(_){return _==m})&&i.push(m)}};for(var p in c.widgets)f()}var v=function(y){var m=0;return c.preferWidgets?c.preferWidgets.includes(y)&&(m+=10-c.preferWidgets.indexOf(y)):y==c.mainWidget&&(m+=100),y==="field"&&(m-=1),y==="func"&&(m-=2),m};a.sort(function(h,y){return v(y)-v(h)});var g={widgets:a,valueSrcs:i};return yo(n,"_getWidgetsAndSrcsForFieldOp",u,g),g}var Hb=function(e,t,r){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null,i=vs(e,t,r,a),o=i.widgets;return o},Gn=function(e,t,r){var a;if(!r)return t;var i=(a=r.type)!==null&&a!==void 0?a:r.returnType;return i==="!group"&&(i="number"),t||(t=Object.keys(e.settings.valueSourcesInfo)),t.filter(function(o){var u=!0;if(o==="field"&&e.__fieldsCntByType){var s=r._isFuncArg?0:1;u=u&&e.__fieldsCntByType[i]>s}return o==="func"&&(r.funcs&&(u=u&&r.funcs.length>0),e.__funcsCntByType&&(u=u&&e.__funcsCntByType[i]>0)),u})},np=function(e,t,r){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null,i=vs(e,t,r,null),o=i.valueSrcs,u=Gn(e,o,a);return u},nr=function(e,t,r){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null,i=vs(e,t,r,a),o=i.widgets,u=null;return o.length&&(u=o[0]),u},un=function(e,t,r){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};if(e){var o=oe(t,e)||{},u=t.settings.fieldSeparator,s=mr(e,t),l=Array.isArray(e)?e.join(u):e;if(i!=null&&i.useTableName&&o.tableName){var c=(0,Q.A)(s);c[0]=o.tableName,l=c.join(u)}if(o.fieldName&&(l=o.fieldName),a){var d=oe(t,a)||{},f=a;l.indexOf(f+u)==0?l=l.slice((f+u).length):o.fieldName||r.errors.push("Can't cut group ".concat(f," from field ").concat(l))}return l}},gs=function(e,t){var r=e.get("type"),a=e.getIn(["properties","mode"]);return r=="rule_group"&&a=="array"?Jb(e,t):r=="group"||r=="rule_group"?Yb(e,t):Kb(e,t)},Jb=function(e,t){var r=e.get("children1"),a=e.get("properties");return ap(a.toObject(),r,t)},ap=function(e,t,r){var a,i,o=e.operator,u=(a=(i=r.operators[o])===null||i===void 0?void 0:i.cardinality)!==null&&a!==void 0?a:1,s=u==0,l={group:!ms(e,r),children:!hs(t,r)},c=l.group&&(s?l.children:!0);return!c},Yb=function(e,t){var r=e.get("children1");return hs(r,t)},hs=function(e,t){var r=e?.size>0&&e.filter(function(a){return!gs(a,t)}).size>0;return!r},Kb=function(e,t){var r=e.get("properties");return ms(r?.toObject()||{},t)},ms=function(e,t){var r=!0,a=3,i=ys(e,t,r),o=i.score>=a;return!o},ys=function(e,t){var r,a,i,o=e.field,u=e.fieldSrc,s=e.fieldType,l=e.operator,c=e.value,d=e.valueSrc,f=e.valueType,p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,v=(r=(a=t.operators[l])===null||a===void 0?void 0:a.cardinality)!==null&&r!==void 0?r:1,g=d!=null&&d.get?d.toJS():d,h={parts:{},score:0};if(h.parts.field=p?o!=null:co(o,u,t),h.parts.operator=!!l,h.parts.value=(c==null||(i=c.filter(function(m,b){return co(m,g?.[b],t,p)}))===null||i===void 0?void 0:i.size)>=(p?Math.min(v,1):v),h.score=Object.keys(h.parts).filter(function(m){return!!h.parts[m]}).length,p&&h.score<3){var y=!0;!h.parts.value&&u==="func"&&co(o,u,t,!1,y)&&h.score++,h.parts.field||c?.map(function(m,b){g?.[b]==="func"&&co(m,g?.[b],t,!1,y)&&h.score++})}return h},co=function n(e,t,r){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0;if(!a&&t=="func"&&e){var o,u=(o=e.get)===null||o===void 0?void 0:o.call(e,"func"),s=Ar(r,u);if(s){var l=e.get("args");for(var c in s.args){var d=s.args[c],f=l?l.get(c):void 0,p=f?f.get("value"):void 0,v=f?f.get("valueSrc"):void 0;if(p==null&&d?.defaultValue===void 0&&!(d!=null&&d.isOptional)||p!=null&&!n(p,v,r,i?a:!0))return!1}return!0}}return e!=null},zn=function(e,t,r){return t=="func"?Yf(e,r):e},bs=function n(e){var t=e.get("children1");if(t?.size==1){var r=t.first(),a=r.get("type");return a==="group"?n(r):r}return null},Qb=D(55364),Xb=D.n(Qb),Zb=D(1779),At=D.n(Zb),eO=D(18678),Os=D.n(eO);function ip(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),t.push.apply(t,r)}return t}function op(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?ip(Object(t),!0).forEach(function(r){(0,z.A)(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):ip(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function rO(n,e){return Os().apply(n,e)}function tO(n,e){return Os().add_operation(n,e)}var up={CALL:function(e,t){for(var r=arguments.length,a=new Array(r>2?r-2:0),i=2;i<r;i++)a[i-2]=arguments[i];return e.call.apply(e,[t].concat(a))},JSX:function(e,t){return{type:e,props:t}},mergeObjects:function(e,t){return op(op({},e),t)},fromEntries:function(e){return Object.fromEntries(e)},strlen:function(e){return e?.length||0},regexTest:function(e,t,r){return e?.match(new RegExp(t,r))!=null},now:function(){return new Date},date_add:function(e,t,r){return ha()(e).add(t,r).toDate()},toLowerCase:function(e){return e.toLowerCase()},toUpperCase:function(e){return e.toUpperCase()}};function nO(){for(var n in up)tO(n,up[n])}function aO(n,e){var t=typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(!t){if(Array.isArray(n)||(t=iO(n))||e&&n&&typeof n.length=="number"){t&&(n=t);var r=0,a=function(){};return{s:a,n:function(){return r>=n.length?{done:!0}:{done:!1,value:n[r++]}},e:function(l){throw l},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,o=!1,u;return{s:function(){t=t.call(n)},n:function(){var l=t.next();return i=l.done,l},e:function(l){o=!0,u=l},f:function(){try{!i&&t.return!=null&&t.return()}finally{if(o)throw u}}}}function iO(n,e){if(n){if(typeof n=="string")return sp(n,e);var t=Object.prototype.toString.call(n).slice(8,-1);if(t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set")return Array.from(n);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return sp(n,e)}}function sp(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=new Array(e);t<e;t++)r[t]=n[t];return r}function lp(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),t.push.apply(t,r)}return t}function qr(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?lp(Object(t),!0).forEach(function(r){(0,z.A)(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):lp(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}nO();function cp(n,e,t){var r;try{r=Os().apply(n,e)}catch(a){throw a.message="".concat(t.join(".")," :: ").concat(a.message),a}return r}function dp(n,e,t,r){var a;try{a=e.call.apply(e,[n].concat((0,Q.A)(t)))}catch(i){throw i.message="".concat(r.join(".")," :: ").concat(i.message),i}return a}var Qt=["conjunctions","fields","types","operators","widgets","settings","funcs","ctx"],yi={asyncFetch:{type:"f",args:["search","offset"]},labelYes:{type:"r"},labelNo:{type:"r"},marks:{type:"r",isArr:!0},validateValue:{type:"f",args:["val","fieldSettings","op","opDef","rightFieldDef"]}},Ss=qr(qr({},yi),{},{factory:{type:"rf"},formatValue:{type:"f",args:["val","fieldDef","wgtDef","isForDisplay","op","opDef","rightFieldDef"]},sqlFormatValue:{type:"f",args:["val","fieldDef","wgtDef","op","opDef","rightFieldDef"]},spelFormatValue:{type:"f",args:["val","fieldDef","wgtDef","op","opDef","rightFieldDef"]},spelImportValue:{type:"f",args:["val","wgtDef","args"]},mongoFormatValue:{type:"f",args:["val","fieldDef","wgtDef","op","opDef"]},elasticSearchFormatValue:{type:"f",args:["queryType","val","op","field","config"]},jsonLogic:{type:"f",args:["val","fieldDef","wgtDef","op","opDef"]},jsonLogicImport:{type:"f",args:["val"]},validateValue:{type:"f",args:["val","fieldSettings","op","opDef","rightFieldDef"]},toJS:{type:"f",args:["val"]}}),fp={options:{factory:{type:"rf"}},formatOp:{type:"f",args:["field","op","vals","valueSrc","valueType","opDef","operatorOptions","isForDisplay","fieldDef"]},mongoFormatOp:{type:"f",args:["field","op","vals","useExpr","valueSrc","valueType","opDef","operatorOptions","fieldDef"]},sqlFormatOp:{type:"f",args:["field","op","vals","valueSrc","valueType","opDef","operatorOptions","fieldDef"]},spelFormatOp:{type:"f",args:["field","op","vals","valueSrc","valueType","opDef","operatorOptions","fieldDef"]},jsonLogic:{type:"f",ignore:"string",args:["field","op","vals","opDef","operatorOptions","fieldDef"]},elasticSearchQueryType:{type:"f",ignore:"string",args:["valueType"]},textSeparators:{type:"r",isArr:!0}},oO={formatConj:{type:"f",args:["children","conj","not","isForDisplay"]},sqlFormatConj:{type:"f",args:["children","conj","not"]},spelFormatConj:{type:"f",args:["children","conj","not","omitBrackets"]}},pp={widgetProps:Ss,opProps:fp},uO={renderBrackets:{type:"r",isArr:!0},renderSeps:{type:"r",isArr:!0},jsonLogic:{type:"f",ignore:"string",args:["formattedArgs"]},jsonLogicImport:{type:"f",args:["val"]},spelImport:{type:"f",args:["spel"]},formatFunc:{type:"f",args:["formattedArgs","isForDisplay"]},sqlFormatFunc:{type:"f",args:["formattedArgs"]},mongoFormatFunc:{type:"f",args:["formattedArgs"]},spelFormatFunc:{type:"f",args:["formattedArgs"]}},vp=qr(qr({},yi),{},{fieldSettings:yi}),gp=qr(qr({},yi),{},{fieldSettings:yi,widgets:{x:pp},mainWidgetProps:Ss}),sO={locale:{mui:{type:"f",args:[],invokeWith:[],ignore:"jl"}},caseValueField:gp,canCompareFieldWithField:{type:"f",args:["leftField","leftFieldConfig","rightField","rightFieldConfig","op"]},formatReverse:{type:"f",args:["q","op","reversedOp","operatorDefinition","revOperatorDefinition","isForDisplay"]},sqlFormatReverse:{type:"f",args:["q"]},spelFormatReverse:{type:"f",args:["q"]},formatField:{type:"f",args:["field","parts","label2","fieldDefinition","config","isForDisplay"]},formatSpelField:{type:"f",args:["field","parentField","parts","partsExt","fieldDefinition","config"]},formatAggr:{type:"f",args:["whereStr","aggrField","operator","value","valueSrc","valueType","opDef","operatorOptions","isForDisplay","aggrFieldDef"]},normalizeListValues:{type:"f",args:["listValues","type","fieldSettings"]},renderConfirm:{type:"f",args:["props"]},useConfirm:{type:"f",args:[]},renderField:{type:"rf"},renderOperator:{type:"rf"},renderFunc:{type:"rf"},renderConjs:{type:"rf"},renderButton:{type:"rf"},renderIcon:{type:"rf"},renderButtonGroup:{type:"rf"},renderValueSources:{type:"rf"},renderFieldSources:{type:"rf"},renderProvider:{type:"rf"},renderSwitch:{type:"rf"},renderSwitchPrefix:{type:"r"},renderItem:{type:"rf"},renderBeforeWidget:{type:"rf"},renderAfterWidget:{type:"rf"},renderBeforeActions:{type:"rf"},renderAfterActions:{type:"rf"},renderBeforeCaseValue:{type:"rf"},renderAfterCaseValue:{type:"rf"},renderRuleError:{type:"rf"}},lO={fields:{x:gp},widgets:{x:Ss},conjunctions:{x:oO},operators:{x:fp},types:{x:{widgets:{x:pp}}},funcs:{x:qr(qr(qr({},vp),uO),{},{args:{x:qr({},vp)}})},settings:sO},_a=function(e){return(0,We.A)(e)=="object"&&e!==null&&!Array.isArray(e)},hp=function(e,t){if(e.__fieldNames)throw new Error("Don't apply `compressConfig()` to extended config");var r=Ht()(e,Qt);delete r.ctx;for(var a=function l(c,d,f,p){if(_a(c)){if(ii(c)&&(c=Vu(c)),f[0]==="funcs"&&!d){var v=f[f.length-1];d=$t({funcs:p.BasicFuncs},v,"funcs","subfields")||void 0,d&&(c.$$key=v)}if(d!==void 0&&_a(d))for(var g in d)Object.prototype.hasOwnProperty.call(d,g)&&(!Object.keys(c).includes(g)||c[g]===void 0&&d[g]!==void 0?c[g]="$$deleted":(c[g]=l(c[g],d[g],[].concat((0,Q.A)(f),[g]),p),c[g]===void 0&&delete c[g]));for(var h in c)if(Object.prototype.hasOwnProperty.call(c,h)){if(!d||!Object.keys(d).includes(h)){var y;c[h]=l(c[h],(y=d)===null||y===void 0?void 0:y[h],[].concat((0,Q.A)(f),[h]),p)}c[h]===void 0&&delete c[h]}Object.keys(c).length===0&&(c=void 0)}else Array.isArray(c)&&c.forEach(function(m,b){c[b]=l(c[b],void 0,[].concat((0,Q.A)(f),[b]),p)});if(!(d!==void 0&&ai(c,d,!0))){if(typeof c=="function")throw new Error("compressConfig: function at ".concat(f.join(".")," should be converted to JsonLogic"));return c}},i=0,o=Qt;i<o.length;i++){var u=o[i];if(u!=="ctx")if(u==="fields")r[u]=At()(r[u]),a(r[u],{},[u]);else if(u==="funcs"){r[u]=At()(r[u]||{});for(var s in r[u])a(r[u][s],null,[u,s],{BasicFuncs:ur})}else r[u]=At()(r[u]),a(r[u],t[u],[u])}return r},mp=function(e,t,r){if(!e.settings.useConfigCompress)throw new Error("Please enable `useConfigCompress` in config settings to use decompressConfig()");for(var a={},i=function c(d,f,p){if(_a(f)){_a(d)||(d={});for(var v in f)Object.prototype.hasOwnProperty.call(f,v)&&(f[v]==="$$deleted"?delete d[v]:d[v]=c(d[v],f[v],[].concat((0,Q.A)(p),[v])))}else Array.isArray(f)?d=At()(f):d=f;return d},o=function c(d,f,p){var v=!1;if(_a(d)&&Object.prototype.hasOwnProperty.call(d,"$$key")&&d.$$key){var g=$t({funcs:p.BasicFuncs},d.$$key,"funcs","subfields");if(g)delete d.$$key,d=i(At()(g),d,f),v=!0;else throw new Error("decompressConfig: basic function not found by key ".concat(d.$$key," at ").concat(f.join(".")))}if(!v){if(_a(d))for(var h in d)Object.prototype.hasOwnProperty.call(d,h)&&(d[h]=c(d[h],[].concat((0,Q.A)(f),[h]),p));else if(Array.isArray(d)){var y=aO(d),m;try{for(y.s();!(m=y.n()).done;){var b=m.value;d[b]=c(d[b],[].concat((0,Q.A)(f),[b]),p)}}catch(O){y.e(O)}finally{y.f()}}}return d},u=0,s=Qt;u<s.length;u++){var l=s[u];l==="ctx"?a[l]=Xb()({},t.ctx||{},r||{}):l==="funcs"?(a[l]=At()(e[l]||{}),o(a[l],[l],{BasicFuncs:ur})):l==="fields"?a[l]=At()(e[l]||{}):(a[l]=At()(t[l]||{}),i(a[l],e[l]||{},[l]))}return a},yp=function(e){if(e.__compliled)return e;e=At()(e);var t={ctx:e.ctx},r=[];return fo(e,e,t,lO,r),Object.defineProperty(e,"__compliled",{enumerable:!1,writable:!1,value:!0}),e};function fo(n,e,t,r,a){var i=arguments.length>5&&arguments[5]!==void 0?arguments[5]:[];if(e){var o=!i.length;for(var u in r){var s=r[u],l=u==="x"?i:[].concat((0,Q.A)(i),[u]);if(s.type==="r"){var c=e,d=c[u];if(s.isArr)for(var f in d){var p=Ca(d[f],t,[].concat((0,Q.A)(l),[f]));p!==d[f]&&(a.push("Compiled ".concat(l.join("."),"[").concat(f,"]")),d[f]=p)}else{var v=Ca(d,t,l,void 0);v!==d&&(a.push("Compiled R ".concat(l.join("."))),c[u]=v)}}else if(s.type==="rf"){var g=e,h=g[u],y=cO(h,t,l,s.ignore);y!==h&&(a.push("Compiled JL-RF ".concat(l.join("."))),g[u]=y)}else if(s.type==="f"){var m=e,b=m[u],O=dO(b,t,l,s.args,s.ignore);if(s.invokeWith&&O&&typeof O=="function"){var S;O=(S=O).call.apply(S,[null].concat((0,Q.A)(s.invokeWith)))}O!==b&&(a.push("Compiled JL-F ".concat(l.join("."))),m[u]=O)}else if(u==="x")for(var F in e){l=[].concat((0,Q.A)(i),[F]);var _=e[F];fo(n,_,t,s,a,l),_.subfields&&fo(n,_.subfields,t,r,a,l)}else{var T=e[u];fo(n,T,t,s,a,l)}}}}function cO(n,e,t){var r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:void 0;return tt(n)?function(a,i){i=i||e?.ctx;var o={props:a,ctx:i},u=cp(n,o,t);typeof u=="string"&&(u={type:u,props:a});var s=Ca(u,{ctx:i},t);return s}:typeof n=="string"?function(a,i){i=i||e?.ctx;var o=n.split(".").reduce(function(l,c){return l?.[c]},i);if(o)return dp(this,o,[a,i],t);var u={type:n,props:a},s=Ca(u,{ctx:i},t);return s}:n}function dO(n,e,t,r){var a=arguments.length>4&&arguments[4]!==void 0?arguments[4]:void 0;return tt(n)&&a!=="jl"?function(){for(var i=arguments.length,o=new Array(i),u=0;u<i;u++)o[u]=arguments[u];var s=this||e?.ctx,l=(r||[]).reduce(function(d,f,p){return qr(qr({},d),{},(0,z.A)({},f,o[p]))},{args:o,ctx:s}),c=cp(n,l,t);return c}.bind(e?.ctx):typeof n=="string"&&a!=="string"?function(){var i=this||e?.ctx,o=n.split(".").reduce(function(c,d){return c?.[d]},i);if(o){for(var u=arguments.length,s=new Array(u),l=0;l<u;l++)s[l]=arguments[l];return dp(this,o,s,t)}else throw new Error("".concat(t.join(".")," :: Function ").concat(n," is not found in ctx"))}.bind(e?.ctx):n}function fO(n,e){var t;return(e==null||(t=e.components)===null||t===void 0?void 0:t[n])||e.W[n]||e.O[n]}function Ca(n,e,t){var r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:void 0;if(Nu(n)){var a,i=n.type,o=n.props;if(typeof i!="string")throw new Error("renderReactElement for ".concat(t.join("."),": type should be string"));var u=fO(i,e.ctx)||i.toLowerCase(),s;r!==void 0&&(o=qr(qr({},o),{},{key:r})),(a=o)!==null&&a!==void 0&&a.children&&(s=Ca(o.children,e,t),o=qr(qr({},o),{},{children:s}));var l=e.ctx.RCE(u,o);return l}else if(n instanceof Array)return n.map(function(c,d){return Ca(c,e,t,""+d)});return n}var pO=D(6924),vO=D.n(pO),bp={reverseOperatorsForNot:!1,canShortMongoQuery:!0,formatField:function(e,t,r,a,i,o){return o?r:e},caseValueField:{type:"case_value"},fieldSources:["field"],keepInputOnChangeFieldSrc:!0,fieldItemKeysForSearch:["label","path","altLabel","grouplabel"],listKeysForSearch:["title","value"],valueSourcesInfo:{value:{}},fieldSeparator:".",fieldSeparatorDisplay:".",canReorder:!0,canRegroup:!0,canDeleteLocked:!1,canLeaveEmptyGroup:!0,shouldCreateEmptyGroup:!1,exportPreserveGroups:!1,removeEmptyGroupsOnLoad:!0,removeEmptyRulesOnLoad:!0,removeIncompleteRulesOnLoad:!1,removeInvalidMultiSelectValuesOnLoad:!0,showErrorMessage:!1,setOpOnChangeField:["keep","default"],groupOperators:["some","all","none"],defaultConjunction:"AND",defaultGroupConjunction:"AND",locale:{moment:"en"},valueLabel:"Value",valuePlaceholder:"Value",fieldLabel:"Field",operatorLabel:"Operator",funcLabel:"Function",fieldPlaceholder:"Select field",funcPlaceholder:"Select function",operatorPlaceholder:"Select operator",lockLabel:"Lock",lockedLabel:"Locked",deleteLabel:"Delete",addGroupLabel:"Add group",addCaseLabel:"Add condition",addDefaultCaseLabel:"Add default condition",defaultCaseLabel:"Default:",addRuleLabel:"Add rule",addSubRuleLabel:"Add sub rule",addSubGroupLabel:"Add sub group",delGroupLabel:"Delete",notLabel:"Not",fieldSourcesPopupTitle:"Select source",valueSourcesPopupTitle:"Select value source",removeRuleConfirmOptions:null,removeGroupConfirmOptions:null};function Fs(n,e){var t=typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(!t){if(Array.isArray(n)||(t=gO(n))||e&&n&&typeof n.length=="number"){t&&(n=t);var r=0,a=function(){};return{s:a,n:function(){return r>=n.length?{done:!0}:{done:!1,value:n[r++]}},e:function(l){throw l},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,o=!1,u;return{s:function(){t=t.call(n)},n:function(){var l=t.next();return i=l.done,l},e:function(l){o=!0,u=l},f:function(){try{!i&&t.return!=null&&t.return()}finally{if(o)throw u}}}}function gO(n,e){if(n){if(typeof n=="string")return Op(n,e);var t=Object.prototype.toString.call(n).slice(8,-1);if(t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set")return Array.from(n);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Op(n,e)}}function Op(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=new Array(e);t<e;t++)r[t]=n[t];return r}var hO=0,Sp=0,wa,po={},Fp=function(){return wa||(wa=Cp({reactIndex:void 0,maxSize:3,canCompile:void 0})),wa},_p=function(e,t){var r;for(var a in po){var i=po[a].findExtendedConfig(e,t);if(i){r=i;break}}return r},Cp=function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{reactIndex:void 0,maxSize:2,canCompile:!0},t=new Map,r=e.maxSize||2,a=++hO,i,o=!0,u=function(h){return Ht()(h,Qt)},s=function(h){var y=gt(h,++Sp,e.canCompile);return c(h,y),y},l=function(){return t.size},c=function(h,y){t.size+1>r&&t.delete(t.keys().next().value),t.set(h,y)},d=function(h){var y=Fs(t.keys()),m;try{var b=function(){var F=m.value,_=t.get(F),T=Qt.map(function(E){return _[E]===h[E]}).filter(function(E){return!E}).length===0;if(T)return{v:F}},O;for(y.s();!(m=y.n()).done;)if(O=b(),O)return O.v}catch(S){y.e(S)}finally{y.f()}return h},f=function(h,y){var m=Fs(t.keys()),b;try{var O=function(){var j=b.value,R=Qt.filter(function(N){return j[N]===h[N]}),L=R.length===Qt.length&&(y?j.__compliled:!0);if(L)return{v:t.get(j)}},S;for(m.s();!(b=m.n()).done;)if(S=O(),S)return S.v}catch(A){m.e(A)}finally{m.f()}var F=Fs(t.values()),_;try{var T=function(){var j=_.value,R=Qt.filter(function(N){return j[N]===h[N]}),L=R.length===Qt.length&&(y?j.__compliled:!0);if(L)return{v:j}},E;for(F.s();!(_=F.n()).done;)if(E=T(),E)return E.v}catch(A){F.e(A)}finally{F.f()}return null},p=function(h){return f(h)||s(h)},v=function(){o=!1,t.clear(),delete po[a],wa===i&&(wa=void 0)};return i={getExtendedConfig:function(h){return p(u(h))},findExtendedConfig:f,getBasicConfig:d,clearConfigMemo:v,configId:Sp,storeConfigPair:c,getSize:l,configStore:t,memoId:a,meta:e},e.reactIndex===void 0&&(wa=i),po[a]=i,i};function _s(n,e){var t=typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(!t){if(Array.isArray(n)||(t=mO(n))||e&&n&&typeof n.length=="number"){t&&(n=t);var r=0,a=function(){};return{s:a,n:function(){return r>=n.length?{done:!0}:{done:!1,value:n[r++]}},e:function(l){throw l},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,o=!1,u;return{s:function(){t=t.call(n)},n:function(){var l=t.next();return i=l.done,l},e:function(l){o=!0,u=l},f:function(){try{!i&&t.return!=null&&t.return()}finally{if(o)throw u}}}}function mO(n,e){if(n){if(typeof n=="string")return wp(n,e);var t=Object.prototype.toString.call(n).slice(8,-1);if(t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set")return Array.from(n);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return wp(n,e)}}function wp(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=new Array(e);t<e;t++)r[t]=n[t];return r}function Ap(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),t.push.apply(t,r)}return t}function Et(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Ap(Object(t),!0).forEach(function(r){(0,z.A)(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Ap(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}var gt=function(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;if(r=r&&e.settings.useConfigCompress,e.__configId)return e;var a=_p(e,r);if(a)return a;var i=e;r?e.__compliled?e=At()(e):e=yp(e):e=At()(e),e.settings=vO()({},bp,e.settings,Ic),e.__fieldsCntByType={},e.__funcsCntByType={},e.__fieldNames={},yO(e.types,e),Ep(e.fields,e),Lp(e.funcs,e);var o=e.settings.caseValueField;o&&vo(o,e,[],!1,!0);var u=e.settings.locale.moment;u&&ha().locale(u),Object.defineProperty(e,"__configId",{enumerable:!1,writable:!1,value:t||Ve()}),e.__cache={},Vc(e);var s=Fp();return s.storeConfigPair(i,e),e};function yO(n,e){for(var t in n){var r=n[t];bO(t,r,e)}}function bO(n,e,t){var r=null,a=null;e.mainWidget=e.mainWidget||Object.keys(e.widgets).filter(function(p){return p!="field"&&p!="func"})[0];var i=e.excludeOperators||[];for(var o in e.widgets){var u=e.widgets[o],s=u.defaultOperator;if(u.operators){var l=u.operators.filter(function(p){return!i.includes(p)});r=Hi(r,l)}s&&!i.includes(s)&&(!a||o===e.mainWidget)&&(a=s),o==e.mainWidget&&(u.widgetProps=Et(Et({},e.mainWidgetProps||{}),u.widgetProps||{})),e.widgets[o]=u}e.valueSources||(e.valueSources=Object.keys(t.settings.valueSourcesInfo));var c=_s(e.valueSources),d;try{for(c.s();!(d=c.n()).done;){var f=d.value;f!="value"&&!e.widgets[f]&&(e.widgets[f]={})}}catch(p){c.e(p)}finally{c.f()}!e.operators&&r&&(e.operators=Array.from(new Set(r))),!e.defaultOperator&&a&&(e.defaultOperator=a)}function Ep(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[];for(var r in n){var a=[].concat((0,Q.A)(t),[r]);vo(n[r],e,a),n[r].subfields&&Ep(n[r].subfields,e,a)}}function Lp(n,e){var t,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[];if(n){var a=(e==null||(t=e.settings)===null||t===void 0?void 0:t.fieldSeparator)||".";for(var i in n){var o=[].concat((0,Q.A)(r),[i]),u=o.join(a),s=n[i];if(s.returnType&&(s.type=s.returnType,e.__funcsCntByType[s.returnType]||(e.__funcsCntByType[s.returnType]=0),e.__funcsCntByType[s.returnType]++),vo(s,e,o,!1),s.args){for(var l in s.args)vo(s.args[l],e,[].concat((0,Q.A)(o),[l]),!0);var c=Object.keys(s.args),d=!0,f=_s(c.reverse()),p;try{for(f.s();!(p=f.n()).done;){var v=p.value,g=s.args[v];!d&&g.isOptional&&(On.info("Arg ".concat(v," for func ").concat(u," can't be optional")),delete g.isOptional),g.isOptional||(d=!1)}}catch(h){f.e(h)}finally{f.f()}}s.subfields&&Lp(s.subfields,e,[].concat((0,Q.A)(r),[i]))}}}function OO(n,e,t){for(var r,a,i=["listValues","treeValues","allowCustomValues","validateValue"],o=0,u=i;o<u.length;o++){var s=u[o];n[s]&&(n.fieldSettings||(n.fieldSettings={}),n.fieldSettings[s]=n[s],delete n[s])}(r=n.fieldSettings)!==null&&r!==void 0&&r.listValues&&e.settings.normalizeListValues&&(n.fieldSettings.listValues=e.settings.normalizeListValues.call(e.ctx,n.fieldSettings.listValues,t,n.fieldSettings)),(a=n.fieldSettings)!==null&&a!==void 0&&a.treeValues&&e.settings.normalizeListValues&&(n.fieldSettings.treeValues=e.settings.normalizeListValues.call(e.ctx,n.fieldSettings.treeValues,t,n.fieldSettings))}function vo(n,e){var t,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[],a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1,o=e.settings,u=o.showLabels,s=o.fieldSeparator;s=(t=s)!==null&&t!==void 0?t:".";var l=r[r.length-1],c=a?r.slice(0,r.length-1).join(s):r.join(s),d=!!n.returnType,f=n.type||n.returnType,p=e.types[f],v=n.excludeOperators||[],g=(n.operators||p?.operators||[]).filter(function(E){return!v.includes(E)}),h=n.defaultOperator||p?.defaultOperator;v.includes(h)&&(h=void 0);var y=!!h&&h==n.defaultOperator;if(y&&(n.ownDefaultOperator=n.defaultOperator),!p){n.disabled=!0;return}!a&&!d&&!i&&(e.__fieldsCntByType[f]||(e.__fieldsCntByType[f]=0),e.__fieldsCntByType[f]++),a&&(n._isFuncArg=!0,n._argKey=l,n._funcKey=c),d&&(n._isFunc=!0,n._funcKey=c),i&&(n._isCaseValue=!0),OO(n,e,f);var m=["widgets","operators","defaultOperator"];Object.keys(p).filter(function(E){return!m.includes(E)}).map(function(E){n[E]||(n[E]=xc(p[E]))});var b=p.excludeOperators||[];n.operators&&(b=b.filter(function(E){return!n.operators.includes(E)})),n.widgets||(n.widgets={});var O=function(){var A=Et({},n.widgets[S]||{}),j=p.widgets[S]||{};if(!a){var R=A.defaultOperator,L=[].concat((0,Q.A)(v),(0,Q.A)(b)),N=n.preferWidgets&&(S==="field"||n.preferWidgets.includes(S))||L.length>0;if(A.operators){var I=A.operators.filter(function(X){return!L.includes(X)});A.operators=I,g=Hi(g,I)}else if(N&&j.operators){var P=j.operators.filter(function(X){return!L.includes(X)});A.operators=P,g=Hi(g,P)}R&&!L.includes(R)&&(!h||!y&&S===n.mainWidget)&&(h=R)}S===n.mainWidget?A.widgetProps=Et(Et(Et({},j.widgetProps||{}),n.mainWidgetProps||{}),A.widgetProps||{}):A.widgetProps=Et(Et({},j.widgetProps||{}),A.widgetProps||{});var x=Array.from(new Set([].concat((0,Q.A)(Object.keys(j.opProps||{})),(0,Q.A)(Object.keys(A.opProps||{})))));if(x.length){var k={},V=_s(x),G;try{for(V.s();!(G=V.n()).done;){var $,W,q=G.value;k[q]=Et(Et({},(($=j.opProps)===null||$===void 0?void 0:$[q])||{}),((W=A.opProps)===null||W===void 0?void 0:W[q])||{})}}catch(X){V.e(X)}finally{V.f()}A.opProps=k}var J=A,K=J.valueLabel,U=J.valuePlaceholder;a&&(K||(A.valueLabel=n.label||l),!U&&!u&&(A.valuePlaceholder=n.label||l)),A=Et(Et({},j),A),n.widgets[S]=A};for(var S in p.widgets)O();if(a||(n.operators||(n.operators=Array.from(new Set(g))),n.defaultOperator||(n.defaultOperator=h)),!a&&!d&&!i){var F=SO(e,r),_=F.fieldName,T=F.inGroup;_&&(n.fieldName=_,e.__fieldNames[_]||(e.__fieldNames[_]=[]),e.__fieldNames[_].push({fullPath:r,inGroup:T}))}}function SO(n,e){if(!e)return{};var t=n.settings.fieldSeparator,r=(0,Q.A)(e).reduce(function(u,s,l,c){var d=u.computedPath,f=u.computed,p=u.inGroup,v=[].concat((0,Q.A)(c.slice(0,l)),[s]),g=$t(n,v);return g?.type==="!group"&&l<c.length-1?(p=v.join(t),d=[]):g!=null&&g.fieldName?(f=!0,d=[g.fieldName]):d=[].concat((0,Q.A)(d),[s]),{computedPath:d,computed:f,inGroup:p}},{computedPath:[],computed:!1,inGroup:void 0}),a=r.computedPath,i=r.computed,o=r.inGroup;return i?{fieldName:a.join(t),inGroup:o}:{}}function Tp(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),t.push.apply(t,r)}return t}function Un(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Tp(Object(t),!0).forEach(function(r){(0,z.A)(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Tp(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}var FO=tn().mark(Aa),_O=tn().mark(jp),CO=Mn;function Aa(n){return tn().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.delegateYield(Cs(n,n.funcs||{},[]),"t0",1);case 1:case"end":return t.stop()}},FO)}function jp(n){return tn().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.delegateYield(Cs(n,n.fields||{},[]),"t0",1);case 1:case"end":return t.stop()}},_O)}function Cs(n,e,t){var r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"subfields";return tn().mark(function a(i){var o,u,s;return tn().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:o=(n==null||(i=n.settings)===null||i===void 0?void 0:i.fieldSeparator)||".",c.t0=tn().keys(e);case 2:if((c.t1=c.t0()).done){c.next=13;break}if(u=c.t1.value,s=e[u],!s[r]){c.next=9;break}return c.delegateYield(Cs(n,s[r],[].concat((0,Q.A)(t),[u]),r),"t2",7);case 7:c.next=11;break;case 9:return c.next=11,[[].concat((0,Q.A)(t),[u]).join(o),s];case 11:c.next=2;break;case 13:case"end":return c.stop()}},a)})()}var $t=function(e,t){var r,a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"fields",i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"subfields";if(!t)return null;if(t==="!case_value"){var o;return e==null||(o=e.settings)===null||o===void 0?void 0:o.caseValueField}var u=(e==null||(r=e.settings)===null||r===void 0?void 0:r.fieldSeparator)||".",s=mr(t,e),l=e[a];if(!l)return null;for(var c=l,d=null,f=[],p=0;p<s.length;p++){var v=s[p];f.push(v);var g=f.join(u);d=c[g],p<s.length-1&&(d&&d[i]?(c=d[i],f=[]):d=null)}return d},go=function(e,t){var r,a,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null,o=e.settings.fieldSeparator,u=[i].concat((0,Q.A)(t.split(o))).filter(function(c){return c!=null}),s=t,l=(r=e.__fieldNames[s])===null||r===void 0||(a=r.find)===null||a===void 0||(a=a.call(r,function(c){var d=c.inGroup;return d?i?.startsWith(d):!0}))===null||a===void 0?void 0:a.fullPath;return(l||u).join(o)},ws=function(e,t){if(!t)return null;var r=$t(e,t,"funcs","subfields");if(!r)return null;var a=r.returnType,i=r.args,o=Object.fromEntries(Object.entries(i||{}).map(function(s){var l=(0,ie.A)(s,2),c=l[0],d=l[1],f=Ht()(d,["type","valueSources","defaultValue","fieldSettings","isOptional","_funcKey","_argKey","_isFuncArg"]);return[c,f]})),u={returnType:a,args:o};return u},Ar=function(e,t){if(!t)return null;var r=$t(e,t,"funcs","subfields");return r||null},As=function(e,t,r){var a=Ar(e,t);if(!a)return null;var i=a.args&&a.args[r]||null;return i||null},Rp=function(e,t){var r,a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;if(!t)return!1;var i=(a==null||(r=a.settings)===null||r===void 0?void 0:r.fieldSeparator)||".",o=Xt(e,a),u=Xt(t,a);return o.startsWith(u+i)},Xt=function(e){var t,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(typeof e=="string")return e;var a=(r==null||(t=r.settings)===null||t===void 0?void 0:t.fieldSeparator)||".";return mr(e,r).join(a)},mr=function(e){var t,r,a,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(!e)return[];if(Array.isArray(e))return e;var o=(i==null||(t=i.settings)===null||t===void 0?void 0:t.fieldSeparator)||".";if(e!=null&&e.func)return Array.isArray(e.func)?e.func:e.func.split(o);if(e!=null&&(r=e.get)!==null&&r!==void 0&&r.call(e,"func")){var u;return e==null||(u=e.get)===null||u===void 0?void 0:u.call(e,"func").split(o)}return(e==null||(a=e.split)===null||a===void 0?void 0:a.call(e,o))||[]},wO=function(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;if(!e)return null;var a=t.settings.fieldSeparator,i=mr(e,t);return r?i:i.map(function(o,u,s){return s.slice(0,u+1)}).map(function(o){return o.join(a)})},ho=function(e){var t;if(typeof e=="string"||Array.isArray(e))return"field:".concat(Xt(e));if((0,We.A)(e)==="object"&&e){if(e._funcKey&&e._argKey)return"arg:".concat(Xt(e._funcKey),"__").concat(e._argKey);if(e._funcKey)return"func:".concat(Xt(e._funcKey));if(e.func&&e.arg)return"arg:".concat(Xt(e.func),"__").concat(e.arg);if(e.func)return"func:".concat(Xt(e.func));if(e.type)return null}return e!=null&&(t=e.get)!==null&&t!==void 0&&t.call(e,"func")?e!=null&&e.get("arg")?"arg:".concat(Xt(e.get("func")),"__").concat(e.get("arg")):"func:".concat(Xt(e.get("func"))):null},mo=function(e,t,r){var a;return(a=e.__cache)===null||a===void 0||(a=a[t])===null||a===void 0?void 0:a[r]},yo=function(e,t,r,a){!e.__cache||!r||(e.__cache[t]||(e.__cache[t]={}),e.__cache[t][r]=a)},xp=function(e){var t;if(!e)return null;if((0,We.A)(e)==="object"){if(!e.func&&e.type)return"field";if(e.func)return e.func&&e.arg?null:"func"}return e!=null&&(t=e.get)!==null&&t!==void 0&&t.call(e,"func")?e!=null&&e.get("arg")?null:"func":"field"},oe=function(e,t){var r;if(!t)return null;if((0,We.A)(t)=="object"){if(!t.func&&t.type)return t;if(t.func)return t.func&&t.arg?As(e,t.func,t.arg):Ar(e,t.func)}if(t!=null&&(r=t.get)!==null&&r!==void 0&&r.call(t,"func"))return t!=null&&t.get("arg")?As(e,t.get("func"),t.get("arg")):Ar(e,t.get("func"));var a=$t(e,t);return a||null},Ie=function(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;if(!t)return null;var a=e.operators[t];if(r){var i,o,u=ho(r),s=u?"".concat(u,"__").concat(t):null,l=mo(e,"getOperatorConfig",s);if(l)return l;var c=oe(e,r),d=nr(e,r,t,null),f=e.widgets[d]||{},p=(c&&c.widgets?c.widgets[d]:{})||{},v=((i=f.opProps)===null||i===void 0?void 0:i[t])||{},g=((o=p.opProps)===null||o===void 0?void 0:o[t])||{},h=Un(Un(Un({},a),v),g);return yo(e,"getOperatorConfig",s,h),h}else return a},Hr=function(e,t){var r,a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null,o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:null,u=arguments.length>5&&arguments[5]!==void 0?arguments[5]:{};if(!t)return null;var s=oe(e,t),l=ho(t);i||(i=nr(e,t,a,o));var c=l?"".concat(l,"__").concat(a,"__").concat(i,"__").concat(o):null,d=mo(e,"getFieldWidgetConfig",c);if(d)return d;var f=e.widgets[i]||{},p=(s==null||(r=s.widgets)===null||r===void 0?void 0:r[i])||{},v=p.widgetProps||{},g=o==="value"||!o?s?.fieldSettings:{},h=Un(Un(Un(Un({},f),p),v),g);return yo(e,"getFieldWidgetConfig",c,h),u.forExport&&(h=vt(h,"factory")),h},Pp=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,r=e.settings.fieldSeparator,a=mr(t,e),i=t?$t(e,t):e,o=i,u=null,s=[];do{var l,c=o===e?e.fields:(l=o)===null||l===void 0?void 0:l.subfields;if(!c||!Object.keys(c).length){o=u=null;break}u=Object.keys(c)[0],s.push(u),o=c[u]}while(o.type=="!struct"||o.type=="!group");return(a||[]).concat(s).join(r)};function Ip(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),t.push.apply(t,r)}return t}function Dp(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Ip(Object(t),!0).forEach(function(r){(0,z.A)(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Ip(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}var AO=function(e,t){var r={usedFields:[]},a=Vp(e,t,r);if(a)return Dp(Dp({},a),r)},Vp=function(e,t,r){if(e){var a=e.get("type"),i=e.get("children1");if((a==="group"||a==="rule_group")&&i&&i.size)return EO(e,t,r);if(a==="rule")return LO(e,t,r)}},EO=function(e,t,r){var a=e.get("properties")||new Qe,i=e.get("children1"),o=e.get("id"),u=i.map(function(d){return Vp(d,t,r)}).filter(function(d){return typeof d<"u"});if(u.size){var s=a.get("conjunction");s||(s=Cn(t));var l=a.get("not"),c={id:o,rules:u.toList(),condition:s.toUpperCase(),not:l};return c}},LO=function(e,t,r){var a,i=e.get("properties")||new Qe,o=e.get("id"),u=i.get("operator"),s=i.get("operatorOptions"),l=i.get("field"),c=i.get("value"),d=i.get("valueSrc"),f=i.get("valueType"),p=c.filter(function(A){return A===void 0}).size>0;if(!(l==null||u==null||p)){var v=oe(t,l)||{},g=Ie(t,u,l)||{},h=v.type||"undefined",y=Cr(g),m=t.types[v.type]||{},b=un(l,t,r);if(!(c.size<y)){r.usedFields.indexOf(l)==-1&&r.usedFields.push(l),c=c.toArray(),d=d.toArray(),f=((a=f)===null||a===void 0?void 0:a.toArray())||[];for(var O=[],S=0;S<c.length;S++){var F={type:f[S],value:c[S]};if(O.push(F),d[S]=="field"){var _=c[S];r.usedFields.indexOf(_)==-1&&r.usedFields.push(_)}}var T=s?s.toJS():null;T&&!Object.keys(T).length&&(T=null);var E={id:o,fieldName:b,type:h,input:m.mainWidget,operator:u};return T&&(E.operatorOptions=T),E.values=O,E}}};function Np(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),t.push.apply(t,r)}return t}function kp(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Np(Object(t),!0).forEach(function(r){(0,z.A)(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Np(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function Mp(n,e){var t=typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(!t){if(Array.isArray(n)||(t=TO(n))||e&&n&&typeof n.length=="number"){t&&(n=t);var r=0,a=function(){};return{s:a,n:function(){return r>=n.length?{done:!0}:{done:!1,value:n[r++]}},e:function(l){throw l},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,o=!1,u;return{s:function(){t=t.call(n)},n:function(){var l=t.next();return i=l.done,l},e:function(l){o=!0,u=l},f:function(){try{!i&&t.return!=null&&t.return()}finally{if(o)throw u}}}}function TO(n,e){if(n){if(typeof n=="string")return $p(n,e);var t=Object.prototype.toString.call(n).slice(8,-1);if(t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set")return Array.from(n);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return $p(n,e)}}function $p(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=new Array(e);t<e;t++)r[t]=n[t];return r}var jO=function(e,t){var r={usedFields:[],errors:[]},a=gt(t,void 0,!1),i=Gp(e,a,r,!1,!0),o=r.errors,u=r.usedFields,s=a.settings.fieldSeparator,l={},c=Mp(u),d;try{for(c.s();!(d=c.n()).done;)for(var f=d.value,p=mr(f,t),v=oe(a,f)||{},g=l,h=0;h<p.length;h++){var y=p[h],m=oe(a,p.slice(0,h+1))||{};h!=p.length-1?m.type=="!group"&&m.mode!="struct"?(g[y]||(g[y]=[{}]),g=g[y][0]):(g[y]||(g[y]={}),g=g[y]):g[y]||(g[y]=null)}}catch(b){c.e(b)}finally{c.f()}return{errors:o,logic:i,data:l}},Gp=function(e,t,r){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1,o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:null;if(e){var u=e.get("type"),s=e.get("properties")||new Qe,l=s.get("isLocked"),c=t.settings.jsonLogic.lockedOp,d;return u==="group"||u==="rule_group"?d=zp(e,t,r,a,i,o):u==="rule"?d=RO(e,t,r,a,o):u=="switch_group"?d=xO(e,t,r,a):u=="case_group"&&(d=Up(e,t,r,a,o)),l&&d&&c&&(d=(0,z.A)({},c,d)),d}},zp=function(e,t,r){var a,i,o,u,s,l,c=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,d=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1,f=arguments.length>5&&arguments[5]!==void 0?arguments[5]:null,p=e.get("type"),v=e.get("properties")||new Qe,g=v.get("mode"),h=e.get("children1")||new Nt,y=v.get("field"),m=oe(t,y),b=v.get("conjunction");b||(b=Cn(t));var O=t.conjunctions[b],S=O?.jsonLogicConj||b.toLowerCase(),F=!!v.get("not"),_=p==="rule_group"&&!d,T=_&&g!="struct",E=T?y:f,A=v.get("operator"),j=A&&Ie(t,A,y)||null,R=Es(t,v,r,A,f),L=_&&(!A||((a=j)===null||a===void 0?void 0:a.cardinality)==0),N=_&&h?.size>0,I=_&&!(h!=null&&h.size),P=F,x=!1;N?(x=F,P=c):c&&(P=!P);var k=!1,V=(i=j)===null||i===void 0?void 0:i.reversedOp,G=Ie(t,V,y),$=!((o=j)!==null&&o!==void 0&&o.jsonLogic)&&!!((u=G)!==null&&u!==void 0&&u.jsonLogic),W=!!((s=G)!==null&&s!==void 0&&s.jsonLogic),q=(l=bs(e))===null||l===void 0?void 0:l.get("type"),J=!!t.settings.reverseOperatorsForNot&&(!_&&P&&q==="rule"||x&&h?.size===1);J&&(N?x=!x:P=!P,k=!0);var K=P&&_&&W&&(!!t.settings.reverseOperatorsForNot||$);if(K){P=!P;var U=[V,A];A=U[0],V=U[1];var X=[G,j];j=X[0],G=X[1]}var Y=h.map(function(ye){return Gp(ye,t,r,k,!1,E)}).filter(function(ye){return typeof ye<"u"}),ae=!!t.settings.exportPreserveGroups;if(T&&!L){if(R==null)return}else if(!Y.size&&!ae)return;var ge=d||ae||Y.size!=1;!ge&&F&&!k&&(ge=h.some(function(ye){var Ce,fe,ar,Le,Me=(Ce=ye.get("properties"))===null||Ce===void 0?void 0:Ce.get("operator"),Ae=(fe=t.operators)===null||fe===void 0||(fe=fe[Me])===null||fe===void 0?void 0:fe.reversedOp;return(ar=(Le=t.operators)===null||Le===void 0||(Le=Le[Ae])===null||Le===void 0?void 0:Le._jsonLogicIsExclamationOp)!==null&&ar!==void 0?ar:!1}));var se={};if(ge?se[S]=Y.toList().toJS():se=Y.first(),x&&(se={"!":se}),T){var ce=Ts(r,t,y,f);if(L){var de=A||"some";se=(0,z.A)({},de,[ce,se])}else{var ne=Y.size?{filter:[ce,se]}:ce,ve={reduce:[ne,{"+":[1,{var:"accumulator"}]},0]};se=Bp(t,v,ve,R,A,null,m)}}return P&&(se={"!":se}),se},RO=function(e,t,r){var a,i,o,u,s,l,c=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,d=arguments.length>4&&arguments[4]!==void 0?arguments[4]:null,f=e.get("properties")||new Qe,p=f.get("field"),v=f.get("fieldSrc"),g=f.get("operator"),h=f.get("operatorOptions");if(h=h?h.toJS():null,h&&!Object.keys(h).length&&(h=null),!(p==null||g==null)){var y=oe(t,p),m=Ie(t,g,p),b=(a=m)===null||a===void 0?void 0:a.reversedOp,O=Ie(t,b,p);if(!((i=m)!==null&&i!==void 0&&i.jsonLogic)&&!((o=O)!==null&&o!==void 0&&o.jsonLogic)){r.errors.push("Operator ".concat(g," is not supported"));return}var S=c,F=!((u=m)!==null&&u!==void 0&&u.jsonLogic)&&!!((s=O)!==null&&s!==void 0&&s.jsonLogic),_=!!((l=O)!==null&&l!==void 0&&l.jsonLogic),T=_&&(!!t.settings.reverseOperatorsForNot||F),E=S&&T||F;if(E){S=!S;var A=[b,g];g=A[0],b=A[1];var j=[O,m];m=j[0],O=j[1]}var R=Es(t,f,r,g,d);if(R!==void 0){var L=v==="func"?Wp(r,t,p,d):Ts(r,t,p,d);if(L!==void 0)return Bp(t,f,L,R,g,h,y,S)}}},xO=function(e,t,r){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,i=e.get("children1");if(i){for(var o=i.map(function(F){return Up(F,t,r,a,null)}).filter(function(F){return typeof F<"u"}).valueSeq().toArray(),u=[],s=0;s<o.length;s++)s!==o.length-1&&!o[s][0]?r.errors.push("No condition for case ".concat(s)):(u.push(o[s]),s===o.length-1&&o[s][0]&&u.push([void 0,null]));if(u.length){if(u.length===1){var l=(0,ie.A)(u[0],2),c=l[0],d=l[1];return d==null&&(d=null),d}for(var f={if:[]},p=f.if,v=(0,ie.A)(u[u.length-1],2),g=v[0],h=v[1],y=0;y<u.length-1;y++){var m=y===u.length-2,b=(0,ie.A)(u[y],2),O=b[0],S=b[1];S==null&&(S=null),O==null&&(O=!0),p.push(O),p.push(S),m?p.push(h):(p.push({if:[]}),p=p[p.length-1].if)}return f}}},Up=function(e,t,r){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:null,o=e.get("type");if(o!="case_group"){r.errors.push("Unexpected child of type ".concat(o," inside switch"));return}var u=e.get("properties")||new Qe,s=zp(e,t,r,a,i),l=Es(t,u,r,null,i,"!case_value");return[s,l]},Es=function(e,t,r,a,i){var o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:null,u=t.get("field"),s=t.get("valueSrc"),l=t.get("valueType");(o=="!case_value"||l&&l.get(0)=="case_value")&&(u="!case_value");var c=oe(e,u),d=Ie(e,a,u),f=Cr(d),p=t.get("value"),v=t.get("asyncListValues");if(p!=null){var g=[],h=[],y=r.usedFields,m=p.map(function(O,S){var F=s?s.get(S):null,_=l?l.get(S):null,T=zn(O,F,e),E=nr(e,u,a,F),A=Hr(e,u,a,E,F,{forExport:!0}),j=Ls(r,e,T,F,_,A,c,a,d,i,v);return j!==void 0&&(g.push(F),h.push(_)),j}),b=m.filter(function(O){return O===void 0}).size>0;if(m.size<f||b){r.usedFields=y;return}return f>1?m.toArray():f==1?m.first():null}},Ls=function(e,t,r,a,i,o,u,s,l){var c=arguments.length>9&&arguments[9]!==void 0?arguments[9]:null,d=arguments.length>10?arguments[10]:void 0;if(r!==void 0){var f;if(a=="field")f=Ts(e,t,r,c);else if(a=="func")f=Wp(e,t,r,c);else if(typeof o?.jsonLogic=="function"){var p=o.jsonLogic,v=[r,kp(kp({},u?Ht()(u,["fieldSettings","listValues"]):{}),{},{asyncListValues:d}),vt(o,Mn)];s&&(v.push(s),v.push(l)),f=p.call.apply(p,[t.ctx].concat(v))}else f=r;return f}},Wp=function(e,t,r){var a,i,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null,u=(a=r.get)===null||a===void 0?void 0:a.call(r,"func"),s=(i=r.get)===null||i===void 0?void 0:i.call(r,"args"),l=Ar(t,u),c=mr(u,t),d=c[c.length-1];if(!l){e.errors.push("Func ".concat(u," is not defined in config"));return}if(!(l!=null&&l.jsonLogic)){e.errors.push("Func ".concat(u," is not supported"));return}var f={},p=[],v=[];for(var g in l.args){var h,y=l.args[g],m=oe(t,y),b=y.defaultValue,O=y.isOptional,S=b!=null&&b.func?"func":"value",F=s?s.get(g):void 0,_=F?F.get("value"):void 0,T=F?F.get("valueSrc"):void 0;T!=="func"&&(h=_)!==null&&h!==void 0&&h.toJS&&(_=_.toJS());var E=null,A=nr(t,y,E,T),j=Hr(t,y,E,A,T,{forExport:!0}),R=Ls(e,t,_,T,y.type,j,m,null,null,o);if(_!=null&&R===void 0){T!="func"&&e.errors.push("Can't format value of arg ".concat(g," for func ").concat(u));return}var L=void 0;if(R===void 0&&!O&&b!=null){var N=nr(t,y,E,S),I=Hr(t,y,E,N,S,{forExport:!0});if(L=Ls(e,t,b,S,y.type,I,m,null,null,o),L===void 0){S!="func"&&e.errors.push("Can't format default value of arg ".concat(g," for func ").concat(u));return}}var P=R??L;if(P!==void 0){if(p.length){var x=Mp(p),k;try{for(x.s();!(k=x.n()).done;){var V=k.value;f[V]=void 0}}catch(Y){x.e(Y)}finally{x.f()}p=[]}f[g]=P}else O||v.push(g),p.push(g)}if(!v.length){var G=Object.values(f),$;if(typeof l.jsonLogic=="function"){var W=l.jsonLogic,q=[f];$=W.call.apply(W,[t.ctx].concat(q))}else{var J=l.jsonLogic||d,K=!!l.jsonLogicIsMethod;if(K){var U=G[0],X=G.slice(1);X.length?$={method:[U,J,X]}:$={method:[U,J]}}else $=(0,z.A)({},J,G)}return $}},Ts=function(e,t,r){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null,i=t.settings,o=i.fieldSeparator,u=i.jsonLogic,s;if(r){Array.isArray(r)&&(r=r.join(o));var l=oe(t,r)||{},c=un(r,t,e,a),d=l.jsonLogicVar||(l.type=="!group"?u.groupVarKey:"var");s=(0,z.A)({},d,c),e.usedFields.indexOf(r)==-1&&e.usedFields.push(r)}return s},PO=function(e,t,r,a){var i=e,o=Cr(t);typeof t.jsonLogic=="string"&&(i=t.jsonLogic);var u=["<","<=",">",">="],s=["==","!="],l=function(d,f,p,v,g){return o==0&&s.includes(i)?(0,z.A)({},i,[r,null]):o==0?(0,z.A)({},i,r):o==1?(0,z.A)({},i,[r,a]):o==2&&u.includes(i)?(0,z.A)({},i,[a[0],r,a[1]]):(0,z.A)({},i,[r].concat((0,Q.A)(a)))};return l},Bp=function(e,t,r,a,i){var o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:null,u=arguments.length>6&&arguments[6]!==void 0?arguments[6]:null,s=arguments.length>7&&arguments[7]!==void 0?arguments[7]:!1,l=t.get("field"),c=Ie(e,i,l)||{},d=typeof c.jsonLogic=="function"?c.jsonLogic:PO(i,c,r,a),f=[r,i,a,vt(c,va),o,u],p=d.call.apply(d,[e.ctx].concat(f));return s&&(p={"!":p}),p};function IO(n,e){var t=typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(!t){if(Array.isArray(n)||(t=DO(n))||e&&n&&typeof n.length=="number"){t&&(n=t);var r=0,a=function(){};return{s:a,n:function(){return r>=n.length?{done:!0}:{done:!1,value:n[r++]}},e:function(l){throw l},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,o=!1,u;return{s:function(){t=t.call(n)},n:function(){var l=t.next();return i=l.done,l},e:function(l){o=!0,u=l},f:function(){try{!i&&t.return!=null&&t.return()}finally{if(o)throw u}}}}function DO(n,e){if(n){if(typeof n=="string")return qp(n,e);var t=Object.prototype.toString.call(n).slice(8,-1);if(t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set")return Array.from(n);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return qp(n,e)}}function qp(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=new Array(e);t<e;t++)r[t]=n[t];return r}function Hp(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),t.push.apply(t,r)}return t}function Jp(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Hp(Object(t),!0).forEach(function(r){(0,z.A)(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Hp(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}var Yp=function(e){return(0,We.A)(e)=="object"&&e!==null&&!Array.isArray(e)},VO=function(e,t){return Kp(e,t,!1)},Kp=function(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,a={errors:[]},i=gt(t,void 0,!1),o=js([],e,i,a);return r?[o,a.errors]:(a.errors.length&&console.warn("Errors while exporting to MongoDb:",a.errors),o)},js=function(e,t,r,a){var i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1,o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!0,u=arguments.length>6&&arguments[6]!==void 0?arguments[6]:void 0,s=arguments.length>7&&arguments[7]!==void 0?arguments[7]:void 0;if(t){var l=t.get("type");if(l==="group"||l==="rule_group")return NO(e,t,r,a,i,o,u,s);if(l==="rule")return kO(e,t,r,a,i,o,u,s)}},NO=function(e,t,r,a){var i,o,u,s,l,c,d,f,p=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1,v=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!0,g=arguments.length>6&&arguments[6]!==void 0?arguments[6]:void 0,h=arguments.length>7&&arguments[7]!==void 0?arguments[7]:void 0,y=t.get("type"),m=t.get("properties")||new Qe,b=!!m.get("not"),O=t.get("children1")||new Nt,S=r.settings,F=S.canShortMongoQuery,_=S.fieldSeparator,T=_,E=e.filter(function(je){return je.get("type")=="rule_group"}).length>0,A=e.filter(function(je){return je.get("type")=="rule_group"}).map(function(je){return je.get("properties").get("field")}).slice(-1).pop(),j=E&&A,R=y==="rule_group",L=R?m.get("field"):null,N=R?m.get("operator"):null,I=N&&Ie(r,N,L)||null,P=N?(i=(o=I)===null||o===void 0?void 0:o.cardinality)!==null&&i!==void 0?i:1:void 0,x=un(L,r,a,j),k=oe(r,L)||{},V=k.mode,G=L&&V==="array"&&P>=1,$=R&&V!="struct",W=R&&O?.size>0,q=R&&!(O!=null&&O.size),J=!1,K=b,U=!1;W?(U=b,K=p):p&&(K=!K);var X=(u=I)===null||u===void 0?void 0:u.reversedOp,Y=Ie(r,X,L),ae=!((s=I)!==null&&s!==void 0&&s.mongoFormatOp)&&!!((l=Y)!==null&&l!==void 0&&l.mongoFormatOp),ge=!!((c=Y)!==null&&c!==void 0&&c.mongoFormatOp),se=(d=bs(t))===null||d===void 0?void 0:d.get("type"),ce=!!r.settings.reverseOperatorsForNot&&(!R&&K&&se==="rule"||U&&O?.size===1);ce&&(W?U=!U:K=!K,J=!0);var de=K&&R&&ge&&(!!r.settings.reverseOperatorsForNot||ae);if(de){K=!K;var ne=[X,N];N=ne[0],X=ne[1];var ve=[Y,I];I=ve[0],Y=ve[1]}var ye=m.get("conjunction");ye||(ye=Cn(r));var Ce=r.conjunctions[ye];if(Ce){var fe=Ce.reversedConj,ar=K&&((f=ye)===null||f===void 0?void 0:f.toLowerCase())==="or"&&fe&&!R&&!!r.settings.canShortMongoQuery&&!!r.settings.reverseOperatorsForNot;ar&&(ye=fe,Ce=r.conjunctions[ye],K=!K,J=!0);var Le=Ce.mongoConj,Me=O.map(function(je){return js([].concat((0,Q.A)(e),[t]),je,r,a,J,V!="array",V=="array"?function(yr){return"$$el".concat(T).concat(yr)}:void 0)}).filter(function(je){return typeof je<"u"});if(!(!G&&!Me.size)){var Ae;if(Me.size==1)Ae=Me.first();else if(Me.size>1){var Tr=Me.toList().toJS(),Dr=F&&Le=="$and";Dr&&(Ae=Tr.reduce(function(je,yr){if(je){for(var Gr in yr){if(Gr[0]=="$"){je=void 0;break}if(je[Gr]==null)je[Gr]=yr[Gr];else{var pr=je[Gr],zr=yr[Gr];Yp(pr)||(pr={$eq:pr}),Yp(zr)||(zr={$eq:zr});var Pe=Object.keys(pr)[0],Vr=Object.keys(zr)[0];if(Pe==Vr){je=void 0;break}je[Gr]=Object.assign({},pr,zr)}}return je}},{})),Ae||(Ae=(0,z.A)({},Le,Tr))}if(L)if(V=="array"){var xr={$size:{$ifNull:["$"+x,[]]}},$r=Ae?{$size:{$ifNull:[{$filter:{input:"$"+x,as:"el",cond:Ae}},[]]}}:xr;Ae=js(e,t.set("type","rule"),r,a,U,!1,function(je){return $r},xr),Ae={$expr:Ae}}else Ae=(0,z.A)({},x,{$elemMatch:Ae});return K&&(Ae={$not:Ae}),Ae}}},kO=function(e,t,r,a){var i,o,u,s,l,c,d,f=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1,p=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!0,v=arguments.length>6&&arguments[6]!==void 0?arguments[6]:void 0,g=arguments.length>7&&arguments[7]!==void 0?arguments[7]:void 0,h=t.get("properties")||new Qe,y=e.filter(function(fe){return fe.get("type")=="rule_group"}).length>0,m=e.filter(function(fe){return fe.get("type")=="rule_group"}).map(function(fe){return fe.get("properties").get("field")}).slice(-1).pop(),b=y&&m,O=h.get("operator"),S=h.get("operatorOptions"),F=h.get("field"),_=h.get("fieldSrc"),T=h.get("value"),E=h.get("valueSrc"),A=h.get("valueType"),j=h.get("asyncListValues");if(!(F==null||O==null||T===void 0)){var R=oe(r,F),L=Ie(r,O,F),N=(i=L)===null||i===void 0?void 0:i.reversedOp,I=Ie(r,N,F),P=Cr(L);if(!((o=L)!==null&&o!==void 0&&o.mongoFormatOp)&&!((u=I)!==null&&u!==void 0&&u.mongoFormatOp)){a.errors.push("Operator ".concat(O," is not supported"));return}var x=f,k=!((s=L)!==null&&s!==void 0&&s.mongoFormatOp)&&!!((l=I)!==null&&l!==void 0&&l.mongoFormatOp),V=!!((c=I)!==null&&c!==void 0&&c.mongoFormatOp),G=V&&(!!r.settings.reverseOperatorsForNot||k),$=G&&x||k,W=!1;if($){var q=[N,O];O=q[0],N=q[1];var J=[I,L];L=J[0],I=J[1],x=!x,W=!0}var K,U=!1;if(_=="func"){var X=Qp(a,r,F,b),Y=(0,ie.A)(X,2);K=Y[0],U=Y[1]}else K=un(F,r,a,b),v&&(U=!0,K=v(K));if(K!=null){var ae=[],ge=[],se;if(T!=null){var ce=T.map(function(fe,ar){var Le=E?E.get(ar):null,Me=A?A.get(ar):null,Ae=zn(fe,Le,r),Tr=nr(r,F,O,Le),Dr=Hr(r,F,O,Tr,Le,{forExport:!0}),xr=Rs(a,r,Ae,Le,Me,Dr,R,b,O,L,j),$r=(0,ie.A)(xr,2),je=$r[0],yr=$r[1];return je!==void 0&&(U=U||yr,ae.push(Le),ge.push(Me)),je}),de=ce.filter(function(fe){return fe===void 0}).size>0;if(ce.size<P||de)return;se=P>1?ce.toArray():P==1?ce.first():null}var ne=U&&p,ve=(d=L)===null||d===void 0?void 0:d.mongoFormatOp,ye=[K,O,g!==void 0&&se==null?g:se,U,ae.length>1?ae:ae[0],ge.length>1?ge:ge[0],vt(L,va),S,R],Ce=ve.call.apply(ve,[r.ctx].concat(ye));return ne&&(Ce={$expr:Ce}),x&&(Ce={$not:Ce}),Ce}}},Rs=function(e,t,r,a,i,o,u,s,l,c,d){if(r===void 0)return[void 0,!1];var f,p=!1;if(a=="field"){var v=MO(e,t,r,s),g=(0,ie.A)(v,2);f=g[0],p=g[1]}else if(a=="func"){var h=Qp(e,t,r,s),y=(0,ie.A)(h,2);f=y[0],p=y[1]}else if(typeof o?.mongoFormatValue=="function"){var m=o.mongoFormatValue,b=[r,Jp(Jp({},u?Ht()(u,["fieldSettings","listValues"]):{}),{},{asyncListValues:d}),vt(o,Mn)];l&&(b.push(l),b.push(c)),f=m.call.apply(m,[t.ctx].concat(b))}else f=r;return[f,p]},MO=function(e,t,r,a){var i=t.settings.fieldSeparator,o,u=!0;if(r){var s=oe(t,r)||{},l=mr(r,t),c=mi(r,t),d=c?c.join(i):null,f=t.settings.formatField,p=un(r,t,e,a),v=f(p,l,d,s,t,!1);o="$"+v}return[o,u]},Qp=function(e,t,r,a){var i,o,u=!0,s,l=(i=r.get)===null||i===void 0?void 0:i.call(r,"func"),c=(o=r.get)===null||o===void 0?void 0:o.call(r,"args"),d=Ar(t,l);if(!d)return e.errors.push("Func ".concat(l," is not defined in config")),[void 0,!1];var f=mr(l,t),p=f[f.length-1],v=d.mongoFunc||p,g=d.mongoArgsAsObject,h={},y=0,m=void 0,b=[],O=[];for(var S in d.args){var F;y++;var _=d.args[S],T=oe(t,_),E=_.defaultValue,A=_.isOptional,j=E!=null&&E.func?"func":"value",R=c?c.get(S):void 0,L=R?R.get("value"):void 0,N=R?R.get("valueSrc"):void 0;N!=="func"&&(F=L)!==null&&F!==void 0&&F.toJS&&(L=L.toJS());var I=R?R.get("asyncListValues"):void 0,P=null,x=nr(t,_,P,N),k=Hr(t,_,P,x,N,{forExport:!0}),V=Rs(e,t,L,N,_.type,k,T,a,null,null,I),G=(0,ie.A)(V,2),$=G[0],W=G[1];if(L!=null&&$===void 0)return N!="func"&&e.errors.push("Can't format value of arg ".concat(S," for func ").concat(l)),[void 0,!1];var q=void 0;if($===void 0&&!A&&E!=null){var J=nr(t,_,P,j),K=Hr(t,_,P,J,j,{forExport:!0}),U=void 0,X=Rs(e,t,E,j,_.type,K,T,a,null,null,I),Y=(0,ie.A)(X,2);if(q=Y[0],U=Y[1],q===void 0)return j!="func"&&e.errors.push("Can't format default value of arg ".concat(S," for func ").concat(l)),[void 0,!1]}var ae=$??q;if(ae!==void 0){if(b.length){var ge=IO(b),se;try{for(ge.s();!(se=ge.n()).done;){var ce=se.value;h[ce]=void 0}}catch(ve){ge.e(ve)}finally{ge.f()}b=[]}h[S]=ae,m=ae}else A||O.push(S),b.push(S)}if(O.length)return[void 0,!1];if(typeof d.mongoFormatFunc=="function"){var de=d.mongoFormatFunc,ne=[h];s=de.call.apply(de,[t.ctx].concat(ne))}else{if(d.mongoFormatFunc===null)return e.errors.push("Functon ".concat(v," is not supported")),[void 0,!1];g?s=(0,z.A)({},v,h):y==1&&m!==void 0?s=(0,z.A)({},v,m):s=(0,z.A)({},v,Object.values(h))}return[s,u]};function $O(n,e){var t=typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(!t){if(Array.isArray(n)||(t=GO(n))||e&&n&&typeof n.length=="number"){t&&(n=t);var r=0,a=function(){};return{s:a,n:function(){return r>=n.length?{done:!0}:{done:!1,value:n[r++]}},e:function(l){throw l},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,o=!1,u;return{s:function(){t=t.call(n)},n:function(){var l=t.next();return i=l.done,l},e:function(l){o=!0,u=l},f:function(){try{!i&&t.return!=null&&t.return()}finally{if(o)throw u}}}}function GO(n,e){if(n){if(typeof n=="string")return Xp(n,e);var t=Object.prototype.toString.call(n).slice(8,-1);if(t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set")return Array.from(n);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Xp(n,e)}}function Xp(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=new Array(e);t<e;t++)r[t]=n[t];return r}function Zp(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),t.push.apply(t,r)}return t}function ev(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Zp(Object(t),!0).forEach(function(r){(0,z.A)(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Zp(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}var zO=function(e,t){return rv(e,t,!1)},rv=function(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,a={errors:[]},i=gt(t,void 0,!1),o=tv(e,i,a);return r?[o,a.errors]:(a.errors.length&&console.warn("Errors while exporting to SQL:",a.errors),o)},tv=function(e,t,r){if(e){var a=e.get("type"),i=e.get("children1");if(a==="group"||a==="rule_group")return UO(e,t,r);if(a==="rule")return BO(e,t,r)}},UO=function(e,t,r){var a=e.get("type"),i=e.get("properties")||new Qe,o=e.get("children1")||new Nt,u=a==="rule_group",s=u?i.get("field"):null,l=oe(t,s)||{},c=l.mode;c=="array"&&r.errors.push("Aggregation is not supported for ".concat(s));var d=i.get("not"),f=!1,p=o.map(function(h){return tv(h,t,r)}).filter(function(h){return typeof h<"u"});if(!(!f&&!p.size)){var v=i.get("conjunction");v||(v=Cn(t));var g=t.conjunctions[v];return g.sqlFormatConj.call(t.ctx,p,v,d)}},WO=function(e,t){var r=t.sqlOp||e,a=Cr(t),i;return a==0?i=function(u,s,l,c,d,f,p,v){return"".concat(u," ").concat(r)}:a==1?i=function(u,s,l,c,d,f,p,v){return"".concat(u," ").concat(r," ").concat(l)}:a==2&&(i=function(u,s,l,c,d,f,p,v){var g,h,y=l==null||(g=l.first)===null||g===void 0?void 0:g.call(l),m=l==null||(h=l.get)===null||h===void 0?void 0:h.call(l,1);return"".concat(u," ").concat(r," ").concat(y," AND ").concat(m)}),i},BO=function(e,t,r){var a=e.get("properties")||new Qe,i=a.get("field"),o=a.get("fieldSrc"),u=a.get("operator"),s=a.get("operatorOptions"),l=a.get("valueSrc"),c=a.get("valueType"),d=a.get("value"),f=a.get("asyncListValues");if(!(i==null||u==null)){var p=oe(t,i)||{},v=Ie(t,u,i)||{},g=v.reversedOp,h=Ie(t,g,i)||{},y=Cr(v),m=!1,b=v.sqlOp||v.sqlFormatOp,O=h.sqlOp||h.sqlFormatOp;if(!b&&!O){r.errors.push("Operator ".concat(u," is not supported"));return}if(!b&&O){m=!0;var S=[g,u];u=S[0],g=S[1];var F=[h,v];v=F[0],h=F[1]}var _=[],T=[],E;if(d!=null){var A=d.map(function(P,x){var k=l?l.get(x):null,V=c?c.get(x):null,G=zn(P,k,t),$=nr(t,i,u,k),W=Hr(t,i,u,$,k,{forExport:!0}),q=xs(r,t,G,k,V,W,p,u,v,f);return q!==void 0&&(_.push(k),T.push(V)),q}),j=A.filter(function(P){return P===void 0}).size>0;if(j||A.size<y)return;E=y==1?A.first():A}var R=v.sqlFormatOp||WO(u,v);if(!R){r.errors.push("Operator ".concat(u," is not supported"));return}var L=o=="func"?av(r,t,i):nv(r,t,i);if(L!=null){var N=[L,u,E,_.length>1?_:_[0],T.length>1?T:T[0],vt(v,va),s,p],I;if(I=R.call.apply(R,[t.ctx].concat(N)),m&&(I=t.settings.sqlFormatReverse.call(t.ctx,I)),I===void 0){r.errors.push("Operator ".concat(u," is not supported for value source ").concat(_.join(", ")));return}return I}}},xs=function(e,t,r,a,i,o,u,s,l,c){if(r!==void 0){var d;if(a=="field")d=nv(e,t,r);else if(a=="func")d=av(e,t,r);else if(typeof o?.sqlFormatValue=="function"){var f=o.sqlFormatValue,p=[r,ev(ev({},Ht()(u,["fieldSettings","listValues"])),{},{asyncListValues:c}),vt(o,Mn)];if(s&&(p.push(s),p.push(l)),a=="field"){var v=oe(t,r)||{};p.push(v)}d=f.call.apply(f,[t.ctx].concat(p))}else Array.isArray(r)?d=r.map(function(g){return _n.escape(g)}):d=_n.escape(r);return d}},nv=function(e,t,r){if(r){var a=t.settings.fieldSeparator,i=oe(t,r)||{},o=mr(r,t),u=mi(r,t),s=u?u.join(a):null,l=t.settings.formatField,c=un(r,t,e,null,{useTableName:!0}),d=l(c,o,s,i,t);return d}},av=function(e,t,r){var a,i,o=(a=r.get)===null||a===void 0?void 0:a.call(r,"func"),u=(i=r.get)===null||i===void 0?void 0:i.call(r,"args"),s=Ar(t,o);if(!s){e.errors.push("Func ".concat(o," is not defined in config"));return}var l=mr(o,t),c=l[l.length-1],d=s.sqlFunc||c,f={},p=[],v=[];for(var g in s.args){var h,y=s.args[g],m=oe(t,y),b=y.defaultValue,O=y.isOptional,S=b!=null&&b.func?"func":"value",F=u?u.get(g):void 0,_=F?F.get("value"):void 0,T=F?F.get("valueSrc"):void 0;T!=="func"&&(h=_)!==null&&h!==void 0&&h.toJS&&(_=_.toJS());var E=F?F.get("asyncListValues"):void 0,A=xs(e,t,_,T,y.type,m,y,null,null,E);if(_!=null&&A===void 0){T!="func"&&e.errors.push("Can't format value of arg ".concat(g," for func ").concat(o));return}var j=void 0;if(A===void 0&&!O&&b!=null&&(j=xs(e,t,b,S,y.type,m,y,null,null,E),j===void 0)){S!="func"&&e.errors.push("Can't format default value of arg ".concat(g," for func ").concat(o));return}var R=A??j;if(R!==void 0){if(p.length){var L=$O(g),N;try{for(L.s();!(N=L.n()).done;){var I=N.value;f[I]=void 0}}catch(G){L.e(G)}finally{L.f()}p=[]}f[g]=R}else O||v.push(g),p.push(g)}if(!v.length){var P;if(typeof s.sqlFormatFunc=="function"){var x=s.sqlFormatFunc,k=[f];P=x.call.apply(x,[t.ctx].concat(k))}else{var V=Object.entries(f).map(function(G){var $=(0,ie.A)(G,2),W=$[0],q=$[1];return q}).join(", ");P="".concat(d,"(").concat(V,")")}return P}};function iv(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),t.push.apply(t,r)}return t}function ov(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?iv(Object(t),!0).forEach(function(r){(0,z.A)(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):iv(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function qO(n){if(n==null)return null;var e=n.split(",").map(Number);return{top_left:{lat:e[0],lon:e[1]},bottom_right:{lat:e[2],lon:e[3]}}}function HO(n,e){if(n.length>1)return{gte:"".concat(n[0]),lte:"".concat(n[1])};var t=n[0];switch(e){case"on_date":case"not_on_date":case"equal":case"select_equals":case"not_equal":return{gte:"".concat(t,"||/d"),lte:"".concat(t,"||+1d")};case"less_or_equal":return{lte:"".concat(t)};case"greater_or_equal":return{gte:"".concat(t)};case"less":return{lt:"".concat(t)};case"greater":return{gt:"".concat(t)};default:return}}function JO(n){return{value:"*"+n+"*"}}function YO(n,e){switch(n){case"AND":return e?"must_not":"must";case"OR":return e?"should_not":"should";case"NOT":return e?"must":"must_not";default:return}}function KO(n){return{value:n}}function QO(n,e){return n}function XO(n,e,t,r,a,i){var o=QO(r,a);switch(n){case"filter":return{script:a.operators[t].elasticSearchScript(r,e)};case"exists":return{field:r};case"match":return(0,z.A)({},o,e[0]);case"term":return i===eS?(0,z.A)({},r,{value:e[0]}):(0,z.A)({},r,e[0]);case"geo_bounding_box":return(0,z.A)({},r,qO(e[0]));case"range":return(0,z.A)({},r,HO(e,t));case"wildcard":return(0,z.A)({},r,JO(e[0]));case"regexp":return(0,z.A)({},r,KO(e[0]));default:return}}function uv(n,e,t,r,a,i){if(!(!n||!t||e==null)){var o=t,u=r.operators[o];if(u){var s=u,l=s.elasticSearchQueryType,c=!1;if(!l&&u.reversedOp){c=!0,o=u.reversedOp,u=r.operators[o];var d=u;l=d.elasticSearchQueryType}var f=nr(r,n,o,a),p=r.widgets[f];if(p){var v=p.elasticSearchFormatValue,g;if(typeof l=="function"?g=l(f):g=l,!!g){var h;return typeof v=="function"?h=v(g,e,o,n,r):h=XO(g,e,o,n,r,i),c?{bool:{must_not:(0,z.A)({},g,ov({},h))}}:(0,z.A)({},g,ov({},h))}}}}}function ZO(n,e,t,r,a,i){if(!(!n||!n.size)){var o=n.valueSeq().toArray(),u=YO(e,t),s=o.map(function(c){return r(c,a,i)}).filter(function(c){return c!==void 0});if(s.length){var l=s.flat(1/0);return{bool:(0,z.A)({},u,l)}}}}var eS="ES_7_SYNTAX",rS="ES_6_SYNTAX";function sv(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:rS,r=gt(e,void 0,!1);if(n){var a=n.get("type"),i=n.get("properties")||new Map;if(a==="rule"&&i.get("field")){var o,u,s,l=i.get("operator"),c=i.get("field"),d=i.get("fieldSrc"),f=(o=i.get("value"))===null||o===void 0?void 0:o.toJS(),p=(u=i.get("valueType"))===null||u===void 0?void 0:u.get(0),v=(s=i.get("valueSrc"))===null||s===void 0?void 0:s.get(0);return v==="func"||d=="func"?void 0:f&&Array.isArray(f[0])?f[0].map(function(m){return uv(c,[m],l,r,v,t)}):uv(c,f,l,r,v,t)}if(a==="group"||a==="rule_group"){var g=i.get("not"),h=i.get("conjunction");h||(h=Cn(r));var y=n.get("children1");return ZO(y,h,g,sv,r,t)}}}var Wn=D(80045);function lv(n,e,t,r,a,i,o){try{var u=n[i](o),s=u.value}catch(l){return void t(l)}u.done?e(s):Promise.resolve(s).then(r,a)}function tS(n){return function(){var e=this,t=arguments;return new Promise(function(r,a){var i=n.apply(e,t);function o(s){lv(i,r,a,o,u,"next",s)}function u(s){lv(i,r,a,o,u,"throw",s)}o(void 0)})}}var nS=["title","value","disabled","groupTitle","grouplabel","renderTitle","children","label","isCustom","isHidden"];function aS(n,e){var t=typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(!t){if(Array.isArray(n)||(t=iS(n))||e&&n&&typeof n.length=="number"){t&&(n=t);var r=0,a=function(){};return{s:a,n:function(){return r>=n.length?{done:!0}:{done:!1,value:n[r++]}},e:function(l){throw l},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,o=!1,u;return{s:function(){t=t.call(n)},n:function(){var l=t.next();return i=l.done,l},e:function(l){o=!0,u=l},f:function(){try{!i&&t.return!=null&&t.return()}finally{if(o)throw u}}}}function iS(n,e){if(n){if(typeof n=="string")return cv(n,e);var t=Object.prototype.toString.call(n).slice(8,-1);if(t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set")return Array.from(n);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return cv(n,e)}}function cv(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=new Array(e);t<e;t++)r[t]=n[t];return r}function dv(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),t.push.apply(t,r)}return t}function En(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?dv(Object(t),!0).forEach(function(r){(0,z.A)(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):dv(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}var oS=function(e,t){if(e.findLastIndex)return e.findLastIndex(t);var r=(0,Q.A)(e).reverse().findIndex(t);return r==-1?-1:e.length-1-r},uS=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1e3;return function(){var a=tS(tn().mark(function i(o,u,s){var l,c,d,f,p,v,g,h;return tn().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:if(l=s?.pageSize!=null?s.pageSize:t,c=zc(e).filter(function(b){var O=b.title,S=b.value;return o==null?!0:O.toUpperCase().indexOf(o.toUpperCase())!=-1||"".concat(S).toUpperCase().indexOf(o.toUpperCase())!=-1}),d=l?Math.ceil(c.length/l):0,f=u||0,p=l?Math.ceil(f/l):null,v=l?c.slice(f,f+l):c,g=l?f+v.length:null,h=l?g<c.length:!1,!r){m.next=11;break}return m.next=11,Dc(r);case 11:return m.abrupt("return",{values:v,hasMore:h});case 12:case"end":return m.stop()}},i)}));return function(i,o,u){return a.apply(this,arguments)}}()},sS=function(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;if(!t)return e;var i=e||[],o=t.filter(function(s){return i.find(function(l){return""+l.value==""+s.value})==null}).map(function(s){return a?En(En({},s),{},{isHidden:!0}):s}),u=r?[].concat((0,Q.A)(o),(0,Q.A)(i)):[].concat((0,Q.A)(i),(0,Q.A)(o));return u},lS=function(e,t,r){var a,i=e==null||e==""?void 0:(a=e?.value)!==null&&a!==void 0?a:e,o=Qi(i,t),u=r&&!o?Mu(i):void 0,s=o||u,l=s?[s]:void 0;return[i,l]},cS=function(e,t,r){var a=e.map(function(o,u){var s,l=o==null||o==""?void 0:(s=o?.value)!==null&&s!==void 0?s:o,c=Qi(l,t),d=r&&!c?Mu(l):void 0,f=c||d;return f}).filter(function(o){return o!=null}),i=a.map(function(o){var u;return(u=o?.value)!==null&&u!==void 0?u:o});return i.length||(i=void 0),[i,a]},dS=function(e){if(e==null)return null;var t=e.title,r=e.value,a=e.disabled,i=e.groupTitle,o=e.grouplabel,u=e.renderTitle,s=e.children,l=e.label,c=e.isCustom,d=e.isHidden,f=(0,Wn.A)(e,nS),p={value:r,title:t||l||s};return a&&(p.disabled=a),c&&(p.isCustom=c),d&&(p.isHidden=d),(i||o)&&(p.groupTitle=i||o),u&&(p.renderTitle=u),p=En(En({},p),f),p},fS=function(e){var t=[],r=[],a=aS(e),i;try{var o=function(){var s=i.value,l=oS(t,function(c){var d,f;return((d=c.groupTitle)!==null&&d!==void 0?d:"")==((f=s.groupTitle)!==null&&f!==void 0?f:"")});s.groupTitle!=null&&!r.includes(s.groupTitle)&&(r.push(s.groupTitle),r.length===1&&(t=t.map(function(c){return En(En({},c),{},{groupTitle:""})}))),s.groupTitle==null&&r.length&&(s=En(En({},s),{},{groupTitle:""})),l!=-1?t.splice(l+1,0,s):t.push(s)};for(a.s();!(i=a.n()).done;)o()}catch(u){a.e(u)}finally{a.f()}return t},pS={label:"Now",returnType:"datetime",jsonLogic:"now",jsonLogicCustomOps:{now:{}},spelFunc:"T(java.time.LocalDateTime).now()",sqlFormatFunc:function(){return"NOW()"},mongoFormatFunc:function(){return new Date},formatFunc:function(){return"NOW"}},vS={label:"Relative",returnType:"datetime",renderBrackets:["",""],renderSeps:["","",""],spelFormatFunc:function(e){var t=e.date,r=e.op,a=e.val,i=e.dim,o=i.charAt(0).toUpperCase()+i.slice(1)+"s",u=r+o;return"".concat(t,".").concat(u,"(").concat(a,")")},spelImport:function(e){var t,r,a,i,o,u=(t=e.methodName)===null||t===void 0?void 0:t.match(/^(minus|plus)(\w+)s$/);if(u&&(o=u[2].toLowerCase(),a=u[1],["minus","plus"].includes(a)&&["day","week","month","year"].includes(o)))return a={type:"string",val:a},o={type:"string",val:o},i=e.args[0],r=e.obj,{date:r,op:a,val:i,dim:o}},jsonLogic:function(e){var t=e.date,r=e.op,a=e.val,i=e.dim;return{date_add:[t,a*(r=="minus"?-1:1),i]}},jsonLogicImport:function(e){var t=e.date_add[0],r=Math.abs(e.date_add[1]),a=e.date_add[1]>=0?"plus":"minus",i=e.date_add[2];return[t,a,r,i]},jsonLogicCustomOps:{date_add:{}},sqlFormatFunc:function(e){var t=e.date,r=e.op,a=e.val,i=e.dim;return"DATE_ADD(".concat(t,", INTERVAL ").concat(parseInt(a)*(r=="minus"?-1:1)," ").concat(i.replace(/^'|'$/g,""),")")},mongoFormatFunc:null,formatFunc:function(e){var t=e.date,r=e.op,a=e.val,i=e.dim;return a?"".concat(t," ").concat(r=="minus"?"-":"+"," ").concat(a," ").concat(i):t},args:{date:{label:"Date",type:"datetime",defaultValue:{func:"NOW",args:[]},valueSources:["func","field","value"],spelEscapeForFormat:!0},op:{label:"Op",type:"select",defaultValue:"plus",valueSources:["value"],mainWidgetProps:{customProps:{showSearch:!1}},fieldSettings:{listValues:{plus:"+",minus:"-"}},spelEscapeForFormat:!1},val:{label:"Value",type:"number",fieldSettings:{min:0},defaultValue:0,valueSources:["value"],spelEscapeForFormat:!1},dim:{label:"Dimension",type:"select",defaultValue:"day",valueSources:["value"],mainWidgetProps:{customProps:{showSearch:!1}},fieldSettings:{listValues:{day:"day",week:"week",month:"month",year:"year"}},spelEscapeForFormat:!1}}},gS={label:"Lowercase",mongoFunc:"$toLower",jsonLogic:"toLowerCase",spelFunc:"${str}.toLowerCase()",jsonLogicCustomOps:{toLowerCase:{}},returnType:"text",args:{str:{label:"String",type:"text",valueSources:["value","field","func"]}}},hS={label:"Uppercase",mongoFunc:"$toUpper",jsonLogic:"toUpperCase",spelFunc:"${str}.toUpperCase()",jsonLogicCustomOps:{toUpperCase:{}},returnType:"text",args:{str:{label:"String",type:"text",valueSources:["value","field","func"]}}},mS={label:"Linear regression",returnType:"number",formatFunc:function(e,t){var r=e.coef,a=e.bias,i=e.val;return"(".concat(r," * ").concat(i," + ").concat(a,")")},sqlFormatFunc:function(e){var t=e.coef,r=e.bias,a=e.val;return"(".concat(t," * ").concat(a," + ").concat(r,")")},spelFormatFunc:function(e){var t=e.coef,r=e.bias,a=e.val;return"(".concat(t," * ").concat(a," + ").concat(r,")")},spelImport:function(e){var t,r,a,i;if(e.type==="op-plus"){var o=(0,ie.A)(e.children,2);if(i=o[0],a=o[1],i.type==="op-multiply"){var u=(0,ie.A)(i.children,2);return t=u[0],r=u[1],{coef:t,val:r,bias:a}}}},mongoFormatFunc:function(e){var t=e.coef,r=e.bias,a=e.val;return{$sum:[{$multiply:[t,a]},r]}},jsonLogic:function(e){var t=e.coef,r=e.bias,a=e.val;return{"+":[{"*":[t,a]},r]}},jsonLogicImport:function(e){var t=e["+"][0]["*"][0],r=e["+"][0]["*"][1],a=e["+"][1];return[t,r,a]},renderBrackets:["",""],renderSeps:[" * "," + "],args:{coef:{label:"Coef",type:"number",defaultValue:1,valueSources:["value"]},val:{label:"Value",type:"number",valueSources:["value","field"]},bias:{label:"Bias",type:"number",defaultValue:0,valueSources:["value"]}}},yS=function(e,t,r,a,i,o,u,s,l,c,d,f){var p=typeof a=="string"&&!a.startsWith("$")?"$"+a:a,v=t(o,f);if(v!==void 0)return r?!u&&(!e||e=="$eq")?(0,z.A)({},a,{$ne:v}):u?{$not:(0,z.A)({},e,[p,v])}:(0,z.A)({},a,{$not:(0,z.A)({},e,v)}):!u&&(!e||e=="$eq")?(0,z.A)({},a,v):u?(0,z.A)({},e,[p,v]):(0,z.A)({},a,(0,z.A)({},e,v))},bS=function(e,t,r,a,i,o,u,s,l,c,d){var f=typeof r=="string"&&!r.startsWith("$")?"$"+r:r;return t?o?{$not:{$and:[(0,z.A)({},e[0],[f,i[0]]),(0,z.A)({},e[1],[f,i[1]])]}}:(0,z.A)({},r,{$not:(0,z.A)((0,z.A)({},e[0],i[0]),e[1],i[1])}):o?{$and:[(0,z.A)({},e[0],[f,i[0]]),(0,z.A)({},e[1],[f,i[1]])]}:(0,z.A)({},r,(0,z.A)((0,z.A)({},e[0],i[0]),e[1],i[1]))},OS={utils:{SqlString:_n,moment:ha(),mongoFormatOp1:yS,mongoFormatOp2:bS,mongoEmptyValue:ud,escapeRegExp:Pc,sqlEmptyValue:od,stringifyForDisplay:ld,getTitleInListValues:Uc,spelEscape:ya,spelFixList:sd,wrapWithBrackets:cd}};const SS=OS;function FS(n,e){var t=typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(!t){if(Array.isArray(n)||(t=_S(n))||e&&n&&typeof n.length=="number"){t&&(n=t);var r=0,a=function(){};return{s:a,n:function(){return r>=n.length?{done:!0}:{done:!1,value:n[r++]}},e:function(l){throw l},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,o=!1,u;return{s:function(){t=t.call(n)},n:function(){var l=t.next();return i=l.done,l},e:function(l){o=!0,u=l},f:function(){try{!i&&t.return!=null&&t.return()}finally{if(o)throw u}}}}function _S(n,e){if(n){if(typeof n=="string")return fv(n,e);var t=Object.prototype.toString.call(n).slice(8,-1);if(t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set")return Array.from(n);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return fv(n,e)}}function fv(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=new Array(e);t<e;t++)r[t]=n[t];return r}function pv(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),t.push.apply(t,r)}return t}function ke(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?pv(Object(t),!0).forEach(function(r){(0,z.A)(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):pv(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}var CS={AND:{label:"And",mongoConj:"$and",jsonLogicConj:"and",sqlConj:"AND",spelConj:"and",spelConjs:["and","&&"],reversedConj:"OR",formatConj:function(e,t,r,a){var i=e.size>1?e.join(" "+(a?"AND":"&&")+" "):e.first();return(e.size>1||r)&&(i=this.utils.wrapWithBrackets(i)),r&&(i="NOT "+i),i},sqlFormatConj:function(e,t,r){var a=e.size>1?e.join(" AND "):e.first();return(e.size>1||r)&&(a=this.utils.wrapWithBrackets(a)),r&&(a="NOT "+a),a},spelFormatConj:function(e,t,r,a){r&&(a=!1);var i=e.size>1?e.join(" && "):e.first();return(e.size>1||r)&&!a&&(i=this.utils.wrapWithBrackets(i)),r&&(i="!"+i),i}},OR:{label:"Or",mongoConj:"$or",jsonLogicConj:"or",sqlConj:"OR",spelConj:"or",spelConjs:["or","||"],reversedConj:"AND",formatConj:function(e,t,r,a){return e.size>1?(r?"NOT ":"")+"("+e.join(" "+(a?"OR":"||")+" ")+")":(r?"NOT (":"")+e.first()+(r?")":"")},sqlFormatConj:function(e,t,r){return e.size>1?(r?"NOT ":"")+"("+e.join(" OR ")+")":(r?"NOT (":"")+e.first()+(r?")":"")},spelFormatConj:function(e,t,r,a){return r&&(a=!1),e.size>1?(r?"!":"")+(a?"":"(")+e.join(" || ")+(a?"":")"):(r?"!(":"")+e.first()+(r?")":"")}}},wS={equal:{label:"==",labelForFormat:"==",sqlOp:"=",spelOp:"==",spelOps:["==","eq"],reversedOp:"not_equal",formatOp:function(e,t,r,a,i,o,u,s,l){var c=s?"=":o.label;return i=="boolean"&&s?r=="No"?"NOT ".concat(e):"".concat(e):"".concat(e," ").concat(c," ").concat(r)},mongoFormatOp:function(){for(var e,t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return(e=this.utils).mongoFormatOp1.apply(e,["$eq",function(i){return i},!1].concat(r))},jsonLogic:"==",elasticSearchQueryType:"term"},not_equal:{isNotOp:!0,label:"!=",labelForFormat:"!=",sqlOp:"<>",spelOp:"!=",spelOps:["!=","ne"],reversedOp:"equal",formatOp:function(e,t,r,a,i,o,u,s,l){return i=="boolean"&&s?r=="No"?"".concat(e):"NOT ".concat(e):"".concat(e," ").concat(o.label," ").concat(r)},mongoFormatOp:function(){for(var e,t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return(e=this.utils).mongoFormatOp1.apply(e,["$ne",function(i){return i},!1].concat(r))},jsonLogic:"!="},less:{label:"<",labelForFormat:"<",sqlOp:"<",spelOp:"<",spelOps:["<","lt"],reversedOp:"greater_or_equal",mongoFormatOp:function(){for(var e,t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return(e=this.utils).mongoFormatOp1.apply(e,["$lt",function(i){return i},!1].concat(r))},jsonLogic:"<",elasticSearchQueryType:"range"},less_or_equal:{label:"<=",labelForFormat:"<=",sqlOp:"<=",spelOp:"<=",spelOps:["<=","le"],reversedOp:"greater",mongoFormatOp:function(){for(var e,t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return(e=this.utils).mongoFormatOp1.apply(e,["$lte",function(i){return i},!1].concat(r))},jsonLogic:"<=",elasticSearchQueryType:"range"},greater:{label:">",labelForFormat:">",sqlOp:">",spelOp:">",spelOps:[">","gt"],reversedOp:"less_or_equal",mongoFormatOp:function(){for(var e,t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return(e=this.utils).mongoFormatOp1.apply(e,["$gt",function(i){return i},!1].concat(r))},jsonLogic:">",elasticSearchQueryType:"range"},greater_or_equal:{label:">=",labelForFormat:">=",sqlOp:">=",spelOp:">=",spelOps:[">=","ge"],reversedOp:"less",mongoFormatOp:function(){for(var e,t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return(e=this.utils).mongoFormatOp1.apply(e,["$gte",function(i){return i},!1].concat(r))},jsonLogic:">=",elasticSearchQueryType:"range"},like:{label:"Contains",labelForFormat:"Contains",reversedOp:"not_like",sqlOp:"LIKE",spelOp:"${0}.contains(${1})",valueTypes:["text"],mongoFormatOp:function(){for(var e,t=this,r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=this.utils).mongoFormatOp1.apply(e,["$regex",function(o){return typeof o=="string"?t.utils.escapeRegExp(o):void 0},!1].concat(a))},jsonLogic:function(e,t,r){return{in:[r,e]}},jsonLogic2:"#in",valueSources:["value"],elasticSearchQueryType:"regexp"},not_like:{isNotOp:!0,label:"Not contains",reversedOp:"like",labelForFormat:"Not Contains",sqlOp:"NOT LIKE",mongoFormatOp:function(){for(var e,t=this,r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=this.utils).mongoFormatOp1.apply(e,["$regex",function(o){return typeof o=="string"?t.utils.escapeRegExp(o):void 0},!0].concat(a))},jsonLogic:function(e,t,r){return{"!":{in:[r,e]}}},jsonLogic2:"#!in",_jsonLogicIsExclamationOp:!0,valueSources:["value"]},starts_with:{label:"Starts with",labelForFormat:"Starts with",sqlOp:"LIKE",spelOp:"${0}.startsWith(${1})",mongoFormatOp:function(){for(var e,t=this,r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=this.utils).mongoFormatOp1.apply(e,["$regex",function(o){return typeof o=="string"?"^"+t.utils.escapeRegExp(o):void 0},!1].concat(a))},jsonLogic:void 0,valueSources:["value"]},ends_with:{label:"Ends with",labelForFormat:"Ends with",sqlOp:"LIKE",spelOp:"${0}.endsWith(${1})",mongoFormatOp:function(){for(var e,t=this,r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=this.utils).mongoFormatOp1.apply(e,["$regex",function(o){return typeof o=="string"?t.utils.escapeRegExp(o)+"$":void 0},!1].concat(a))},jsonLogic:void 0,valueSources:["value"]},between:{label:"Between",labelForFormat:"BETWEEN",sqlOp:"BETWEEN",cardinality:2,formatOp:function(e,t,r,a,i,o,u,s){var l=r.first(),c=r.get(1);return s?"".concat(e," BETWEEN ").concat(l," AND ").concat(c):"".concat(e," >= ").concat(l," && ").concat(e," <= ").concat(c)},spelFormatOp:function(e,t,r,a,i,o,u,s){var l=r[0],c=r[1];return"".concat(e," >= ").concat(l," && ").concat(e," <= ").concat(c)},mongoFormatOp:function(){for(var e,t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return(e=this.utils).mongoFormatOp2.apply(e,[["$gte","$lte"],!1].concat(r))},valueLabels:["Value from","Value to"],textSeparators:[null,"and"],reversedOp:"not_between",jsonLogic:"<=",validateValues:function(e){return e[0]!=null&&e[1]!=null?e[0]<=e[1]:null},elasticSearchQueryType:function(e){return e==="time"?"filter":"range"}},not_between:{isNotOp:!0,label:"Not between",labelForFormat:"NOT BETWEEN",sqlOp:"NOT BETWEEN",cardinality:2,formatOp:function(e,t,r,a,i,o,u,s){var l=r.first(),c=r.get(1);return s?"".concat(e," NOT BETWEEN ").concat(l," AND ").concat(c):"(".concat(e," < ").concat(l," || ").concat(e," > ").concat(c,")")},spelFormatOp:function(e,t,r,a,i,o,u,s){var l=r[0],c=r[1];return"(".concat(e," < ").concat(l," || ").concat(e," > ").concat(c,")")},mongoFormatOp:function(){for(var e,t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return(e=this.utils).mongoFormatOp2.apply(e,[["$gte","$lte"],!0].concat(r))},valueLabels:["Value from","Value to"],textSeparators:[null,"and"],reversedOp:"between",jsonLogic:function(e,t,r){return{"!":{"<=":[Array.isArray(r)?r[0]:r,e,Array.isArray(r)?r[1]:r]}}},jsonLogic2:"!<=",_jsonLogicIsExclamationOp:!0,validateValues:function(e){return e[0]!=null&&e[1]!=null?e[0]<=e[1]:null}},is_empty:{label:"Is empty",labelForFormat:"IS EMPTY",cardinality:0,reversedOp:"is_not_empty",formatOp:function(e,t,r,a,i,o,u,s){return s?"".concat(e," IS EMPTY"):"!".concat(e)},sqlFormatOp:function(e,t,r,a,i,o,u,s){var l=this.utils.sqlEmptyValue(s);return"COALESCE(".concat(e,", ").concat(l,") = ").concat(l)},spelFormatOp:function(e,t,r,a,i,o,u,s){return"".concat(e," <= ''")},mongoFormatOp:function(){for(var e,t=this,r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=this.utils).mongoFormatOp1.apply(e,["$in",function(o,u){return[t.utils.mongoEmptyValue(u),null]},!1].concat(a))},jsonLogic:"!"},is_not_empty:{isNotOp:!0,label:"Is not empty",labelForFormat:"IS NOT EMPTY",cardinality:0,reversedOp:"is_empty",formatOp:function(e,t,r,a,i,o,u,s){return s?"".concat(e," IS NOT EMPTY"):"!!".concat(e)},sqlFormatOp:function(e,t,r,a,i,o,u,s){var l=this.utils.sqlEmptyValue(s);return"COALESCE(".concat(e,", ").concat(l,") <> ").concat(l)},spelFormatOp:function(e,t,r,a,i,o,u,s){return"".concat(e," > ''")},mongoFormatOp:function(){for(var e,t=this,r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=this.utils).mongoFormatOp1.apply(e,["$nin",function(o,u){return[t.utils.mongoEmptyValue(u),null]},!1].concat(a))},jsonLogic:"!!",elasticSearchQueryType:"exists"},is_null:{label:"Is null",labelForFormat:"IS NULL",sqlOp:"IS NULL",cardinality:0,reversedOp:"is_not_null",formatOp:function(e,t,r,a,i,o,u,s){return s?"".concat(e," IS NULL"):"!".concat(e)},spelFormatOp:function(e,t,r,a,i,o,u,s){return"".concat(e," == null")},mongoFormatOp:function(){for(var e,t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return(e=this.utils).mongoFormatOp1.apply(e,["$eq",function(i){return null},!1].concat(r))},jsonLogic:"=="},is_not_null:{label:"Is not null",labelForFormat:"IS NOT NULL",sqlOp:"IS NOT NULL",cardinality:0,reversedOp:"is_null",formatOp:function(e,t,r,a,i,o,u,s){return s?"".concat(e," IS NOT NULL"):"!!".concat(e)},spelFormatOp:function(e,t,r,a,i,o,u,s){return"".concat(e," != null")},mongoFormatOp:function(){for(var e,t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return(e=this.utils).mongoFormatOp1.apply(e,["$ne",function(i){return null},!1].concat(r))},jsonLogic:"!=",elasticSearchQueryType:"exists"},select_equals:{label:"==",labelForFormat:"==",sqlOp:"=",formatOp:function(e,t,r,a,i,o,u,s){var l=s?"=":"==";return"".concat(e," ").concat(l," ").concat(r)},spelOp:"==",spelOps:["==","eq"],mongoFormatOp:function(){for(var e,t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return(e=this.utils).mongoFormatOp1.apply(e,["$eq",function(i){return i},!1].concat(r))},reversedOp:"select_not_equals",jsonLogic:"==",elasticSearchQueryType:"term"},select_not_equals:{isNotOp:!0,label:"!=",labelForFormat:"!=",sqlOp:"<>",formatOp:function(e,t,r,a,i,o,u,s){return"".concat(e," != ").concat(r)},spelOp:"!=",spelOps:["!=","ne"],mongoFormatOp:function(){for(var e,t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return(e=this.utils).mongoFormatOp1.apply(e,["$ne",function(i){return i},!1].concat(r))},reversedOp:"select_equals",jsonLogic:"!="},select_any_in:{label:"Any in",labelForFormat:"IN",sqlOp:"IN",formatOp:function(e,t,r,a,i,o,u,s){return a=="value"?"".concat(e," IN (").concat(r.join(", "),")"):"".concat(e," IN (").concat(r,")")},sqlFormatOp:function(e,t,r,a,i,o,u,s){if(a=="value")return"".concat(e," IN (").concat(r.join(", "),")")},valueTypes:["multiselect"],spelOp:"${1}.contains(${0})",mongoFormatOp:function(){for(var e,t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return(e=this.utils).mongoFormatOp1.apply(e,["$in",function(i){return i},!1].concat(r))},reversedOp:"select_not_any_in",jsonLogic:"in",elasticSearchQueryType:"term"},select_not_any_in:{isNotOp:!0,label:"Not in",labelForFormat:"NOT IN",sqlOp:"NOT IN",formatOp:function(e,t,r,a,i,o,u,s){return a=="value"?"".concat(e," NOT IN (").concat(r.join(", "),")"):"".concat(e," NOT IN (").concat(r,")")},sqlFormatOp:function(e,t,r,a,i,o,u,s){if(a=="value")return"".concat(e," NOT IN (").concat(r.join(", "),")")},mongoFormatOp:function(){for(var e,t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return(e=this.utils).mongoFormatOp1.apply(e,["$nin",function(i){return i},!1].concat(r))},reversedOp:"select_any_in",jsonLogic:function(e,t,r){return{"!":{in:[e,r]}}},jsonLogic2:"!in",_jsonLogicIsExclamationOp:!0},multiselect_contains:{label:"Contains",labelForFormat:"CONTAINS",formatOp:function(e,t,r,a,i,o,u,s){return a=="value"?"".concat(e," CONTAINS [").concat(r.join(", "),"]"):"".concat(e," CONTAINS ").concat(r)},reversedOp:"multiselect_not_contains",jsonLogic2:"some-in",jsonLogic:function(e,t,r){return{some:[e,{in:[{var:""},r]}]}},spelOp:"T(CollectionUtils).containsAny(${0}, ${1})",elasticSearchQueryType:"term",mongoFormatOp:function(){for(var e,t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return(e=this.utils).mongoFormatOp1.apply(e,["$in",function(i){return i},!1].concat(r))}},multiselect_not_contains:{isNotOp:!0,label:"Not contains",labelForFormat:"NOT CONTAINS",formatOp:function(e,t,r,a,i,o,u,s){return a=="value"?"".concat(e," NOT CONTAINS [").concat(r.join(", "),"]"):"".concat(e," NOT CONTAINS ").concat(r)},reversedOp:"multiselect_contains",jsonLogic2:"!some-in",jsonLogic:function(e,t,r){return{"!":{some:[e,{in:[{var:""},r]}]}}},_jsonLogicIsExclamationOp:!0},multiselect_equals:{label:"Equals",labelForFormat:"==",sqlOp:"=",formatOp:function(e,t,r,a,i,o,u,s){var l=s?"=":"==";return a=="value"?"".concat(e," ").concat(l," [").concat(r.join(", "),"]"):"".concat(e," ").concat(l," ").concat(r)},sqlFormatOp:function(e,t,r,a,i,o,u,s){var l=this;if(a=="value")return"".concat(e," = '").concat(r.map(function(c){return l.utils.SqlString.trim(c)}).join(","),"'")},spelOp:"${0}.equals(${1})",mongoFormatOp:function(){for(var e,t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return(e=this.utils).mongoFormatOp1.apply(e,["$eq",function(i){return i},!1].concat(r))},reversedOp:"multiselect_not_equals",jsonLogic2:"all-in",jsonLogic:function(e,t,r){return{all:[e,{in:[{var:""},r]}]}},elasticSearchQueryType:"term"},multiselect_not_equals:{isNotOp:!0,label:"Not equals",labelForFormat:"!=",sqlOp:"<>",formatOp:function(e,t,r,a,i,o,u,s){return a=="value"?"".concat(e," != [").concat(r.join(", "),"]"):"".concat(e," != ").concat(r)},sqlFormatOp:function(e,t,r,a,i,o,u,s){var l=this;if(a=="value")return"".concat(e," != '").concat(r.map(function(c){return l.utils.SqlString.trim(c)}).join(","),"'")},mongoFormatOp:function(){for(var e,t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return(e=this.utils).mongoFormatOp1.apply(e,["$ne",function(i){return i},!1].concat(r))},reversedOp:"multiselect_equals",jsonLogic2:"!all-in",jsonLogic:function(e,t,r){return{"!":{all:[e,{in:[{var:""},r]}]}}},_jsonLogicIsExclamationOp:!0},proximity:{label:"Proximity search",cardinality:2,valueLabels:[{label:"Word 1",placeholder:"Enter first word"},{label:"Word 2",placeholder:"Enter second word"}],textSeparators:[],formatOp:function(e,t,r,a,i,o,u,s){var l=r.first(),c=r.get(1),d=u?.get("proximity");return"".concat(e," ").concat(l," NEAR/").concat(d," ").concat(c)},sqlFormatOp:function(e,t,r,a,i,o,u,s){var l=r.first(),c=r.get(1),d=this.utils.SqlString.trim(l),f=this.utils.SqlString.trim(c),p=u?.get("proximity");return"CONTAINS(".concat(e,", 'NEAR((").concat(d,", ").concat(f,"), ").concat(p,")')")},mongoFormatOp:void 0,jsonLogic:void 0,options:{optionLabel:"Near",optionTextBefore:"Near",optionPlaceholder:"Select words between",minProximity:2,maxProximity:10,defaults:{proximity:2}}},some:{label:"Some",labelForFormat:"SOME",cardinality:0,jsonLogic:"some",spelFormatOp:function(e){return"".concat(e," > 0")},mongoFormatOp:function(){for(var e,t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return(e=this.utils).mongoFormatOp1.apply(e,["$gt",function(i){return 0},!1].concat(r))}},all:{label:"All",labelForFormat:"ALL",cardinality:0,jsonLogic:"all",spelFormatOp:function(e,t,r){return"".concat(e," == ").concat(r)},mongoFormatOp:function(){for(var e,t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return(e=this.utils).mongoFormatOp1.apply(e,["$eq",function(i){return i},!1].concat(r))}},none:{label:"None",labelForFormat:"NONE",cardinality:0,jsonLogic:"none",spelFormatOp:function(e){return"".concat(e," == 0")},mongoFormatOp:function(){for(var e,t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return(e=this.utils).mongoFormatOp1.apply(e,["$eq",function(i){return 0},!1].concat(r))}}},AS={text:{type:"text",jsType:"string",valueSrc:"value",valueLabel:"String",valuePlaceholder:"Enter string",formatValue:function(e,t,r,a){return a?this.utils.stringifyForDisplay(e):JSON.stringify(e)},spelFormatValue:function(e,t,r,a,i){return this.utils.spelEscape(e)},sqlFormatValue:function(e,t,r,a,i){return i.sqlOp=="LIKE"||i.sqlOp=="NOT LIKE"?this.utils.SqlString.escapeLike(e,a!="starts_with",a!="ends_with"):this.utils.SqlString.escape(e)},toJS:function(e,t){return e},mongoFormatValue:function(e,t,r){return e}},textarea:{type:"text",jsType:"string",valueSrc:"value",valueLabel:"Text",valuePlaceholder:"Enter text",formatValue:function(e,t,r,a){return a?this.utils.stringifyForDisplay(e):JSON.stringify(e)},sqlFormatValue:function(e,t,r,a,i){return i.sqlOp=="LIKE"||i.sqlOp=="NOT LIKE"?this.utils.SqlString.escapeLike(e,a!="starts_with",a!="ends_with"):this.utils.SqlString.escape(e)},spelFormatValue:function(e){return this.utils.spelEscape(e)},toJS:function(e,t){return e},mongoFormatValue:function(e,t,r){return e},fullWidth:!0},number:{type:"number",jsType:"number",valueSrc:"value",valueLabel:"Number",valuePlaceholder:"Enter number",valueLabels:[{label:"Number from",placeholder:"Enter number from"},{label:"Number to",placeholder:"Enter number to"}],formatValue:function(e,t,r,a){return a?this.utils.stringifyForDisplay(e):JSON.stringify(e)},sqlFormatValue:function(e,t,r,a,i){return this.utils.SqlString.escape(e)},spelFormatValue:function(e,t,r){var a=r.step&&!Number.isInteger(r.step);return this.utils.spelEscape(e,a)},toJS:function(e,t){return e},mongoFormatValue:function(e,t,r){return e}},slider:{type:"number",jsType:"number",valueSrc:"value",valueLabel:"Number",valuePlaceholder:"Enter number or move slider",formatValue:function(e,t,r,a){return a?this.utils.stringifyForDisplay(e):JSON.stringify(e)},sqlFormatValue:function(e,t,r,a,i){return this.utils.SqlString.escape(e)},spelFormatValue:function(e){return this.utils.spelEscape(e)},toJS:function(e,t){return e},mongoFormatValue:function(e,t,r){return e}},select:{type:"select",jsType:"string",valueSrc:"value",valueLabel:"Value",valuePlaceholder:"Select value",formatValue:function(e,t,r,a){var i=this.utils.getTitleInListValues(t.fieldSettings.listValues||t.asyncListValues,e);return a?this.utils.stringifyForDisplay(i):JSON.stringify(e)},sqlFormatValue:function(e,t,r,a,i){return this.utils.SqlString.escape(e)},spelFormatValue:function(e){return this.utils.spelEscape(e)},toJS:function(e,t){return e},mongoFormatValue:function(e,t,r){return e}},multiselect:{type:"multiselect",jsType:"array",valueSrc:"value",valueLabel:"Values",valuePlaceholder:"Select values",formatValue:function(e,t,r,a){var i=this,o=e.map(function(u){return i.utils.getTitleInListValues(t.fieldSettings.listValues||t.asyncListValues,u)});return a?o.map(this.utils.stringifyForDisplay):e.map(JSON.stringify)},sqlFormatValue:function(e,t,r,a,i){var o=this;return e.map(function(u){return o.utils.SqlString.escape(u)})},spelFormatValue:function(e,t,r,a,i){var o=i&&i.spelOp&&i.spelOp.startsWith("${1}"),u=this.utils.spelEscape(e);return o&&(u=this.utils.spelFixList(u)),u},toJS:function(e,t){return e},mongoFormatValue:function(e,t,r){return e}},date:{type:"date",jsType:"string",valueSrc:"value",dateFormat:"DD.MM.YYYY",valueFormat:"YYYY-MM-DD",valueLabel:"Date",valuePlaceholder:"Enter date",valueLabels:[{label:"Date from",placeholder:"Enter date from"},{label:"Date to",placeholder:"Enter date to"}],formatValue:function(e,t,r,a){var i=this.utils.moment(e,r.valueFormat);return a?i.format(r.dateFormat):JSON.stringify(e)},sqlFormatValue:function(e,t,r,a,i){var o=this.utils.moment(e,r.valueFormat);return this.utils.SqlString.escape(o.format("YYYY-MM-DD"))},spelFormatValue:function(e,t,r,a,i){var o=this.utils.moment(e,r.valueFormat),u=o.format("YYYY-MM-DD"),s="yyyy-MM-dd";return"T(java.time.LocalDate).parse('".concat(u,"', T(java.time.format.DateTimeFormatter).ofPattern('").concat(s,"'))")},spelImportFuncs:[{obj:{cls:["java","time","LocalDate"]},methodName:"parse",args:[{var:"v"},{obj:{cls:["java","time","format","DateTimeFormatter"]},methodName:"ofPattern",args:[{var:"fmt"}]}]}],spelImportValue:function(e,t,r){var a,i,o,u;if(!t)return[void 0,"No widget def to get value format"];if(r!=null&&(a=r.fmt)!==null&&a!==void 0&&(a=a.value)!==null&&a!==void 0&&(i=a.includes)!==null&&i!==void 0&&i.call(a," ")||(o=r.fmt)!==null&&o!==void 0&&(o=o.value)!==null&&o!==void 0&&(u=o.toLowerCase)!==null&&u!==void 0&&u.call(o).includes("hh:mm"))return[void 0,"Invalid date format ".concat(JSON.stringify(r.fmt))];var s=this.utils.moment(e.value,this.utils.moment.ISO_8601);return s.isValid()?[s.format(t?.valueFormat),[]]:[void 0,"Invalid date"]},jsonLogic:function(e,t,r){return this.utils.moment(e,r.valueFormat).toDate()},toJS:function(e,t){var r=this.utils.moment(e,t.valueFormat);return r.isValid()?r.toDate():void 0},mongoFormatValue:function(e,t,r){var a=this.utils.moment(e,r.valueFormat);return a.isValid()?a.toDate():void 0}},time:{type:"time",jsType:"string",valueSrc:"value",timeFormat:"HH:mm",valueFormat:"HH:mm:ss",use12Hours:!1,valueLabel:"Time",valuePlaceholder:"Enter time",valueLabels:[{label:"Time from",placeholder:"Enter time from"},{label:"Time to",placeholder:"Enter time to"}],formatValue:function(e,t,r,a){var i=this.utils.moment(e,r.valueFormat);return a?i.format(r.timeFormat):JSON.stringify(e)},sqlFormatValue:function(e,t,r,a,i){var o=this.utils.moment(e,r.valueFormat);return this.utils.SqlString.escape(o.format("HH:mm:ss"))},spelFormatValue:function(e,t,r,a,i){var o=this.utils.moment(e,r.valueFormat),u="HH:mm:ss",s=o.format("HH:mm:ss");return"T(java.time.LocalTime).parse('".concat(s,"')")},spelImportFuncs:["T(java.time.LocalTime).parse(${v})"],spelImportValue:function(e,t,r){var a,i,o;if(!t)return[void 0,"No widget def to get value format"];if(r!=null&&r.fmt&&(!((a=r.fmt)!==null&&a!==void 0&&(a=a.value)!==null&&a!==void 0&&(i=a.toLowerCase)!==null&&i!==void 0&&i.call(a).includes("hh:mm"))||(o=r.fmt)!==null&&o!==void 0&&(o=o.value)!==null&&o!==void 0&&o.includes(" ")))return[void 0,"Invalid time format ".concat(JSON.stringify(r.fmt))];var u=this.utils.moment(e.value,"HH:mm:ss");return u.isValid()?[u.format(t?.valueFormat),[]]:[void 0,"Invalid date"]},jsonLogic:function(e,t,r){var a=this.utils.moment(e,r.valueFormat);return a.get("hour")*60*60+a.get("minute")*60+a.get("second")},toJS:function(e,t){var r=this.utils.moment(e,t.valueFormat);return r.isValid()?r.get("hour")*60*60+r.get("minute")*60+r.get("second"):void 0},mongoFormatValue:function(e,t,r){var a=this.utils.moment(e,r.valueFormat);return a.get("hour")*60*60+a.get("minute")*60+a.get("second")},elasticSearchFormatValue:function(e,t,r,a){return{script:{script:{source:"doc[".concat(a,"][0].getHour() >== params.min && doc[").concat(a,"][0].getHour() <== params.max"),params:{min:t[0],max:t[1]}}}}}},datetime:{type:"datetime",jsType:"string",valueSrc:"value",timeFormat:"HH:mm",dateFormat:"DD.MM.YYYY",valueFormat:"YYYY-MM-DD HH:mm:ss",use12Hours:!1,valueLabel:"Datetime",valuePlaceholder:"Enter datetime",valueLabels:[{label:"Datetime from",placeholder:"Enter datetime from"},{label:"Datetime to",placeholder:"Enter datetime to"}],formatValue:function(e,t,r,a){var i=this.utils.moment(e,r.valueFormat);return a?i.format(r.dateFormat+" "+r.timeFormat):JSON.stringify(e)},sqlFormatValue:function(e,t,r,a,i){var o=this.utils.moment(e,r.valueFormat);return this.utils.SqlString.escape(o.toDate())},spelFormatValue:function(e,t,r,a,i){var o=this.utils.moment(e,r.valueFormat),u=o.format("YYYY-MM-DD HH:mm:ss"),s="yyyy-MM-dd HH:mm:ss";return"T(java.time.LocalDateTime).parse('".concat(u,"', T(java.time.format.DateTimeFormatter).ofPattern('").concat(s,"'))")},spelImportFuncs:[{obj:{cls:["java","time","LocalDateTime"]},methodName:"parse",args:[{var:"v"},{obj:{cls:["java","time","format","DateTimeFormatter"]},methodName:"ofPattern",args:[{var:"fmt"}]}]}],spelImportValue:function(e,t,r){var a,i;if(!t)return[void 0,"No widget def to get value format"];if(!(r!=null&&(a=r.fmt)!==null&&a!==void 0&&(a=a.value)!==null&&a!==void 0&&(i=a.includes)!==null&&i!==void 0&&i.call(a," ")))return[void 0,"Invalid datetime format ".concat(JSON.stringify(r.fmt))];var o=this.utils.moment(e.value,this.utils.moment.ISO_8601);return o.isValid()?[o.format(t?.valueFormat),[]]:[void 0,"Invalid date"]},jsonLogic:function(e,t,r){return this.utils.moment(e,r.valueFormat).toDate()},toJS:function(e,t){var r=this.utils.moment(e,t.valueFormat);return r.isValid()?r.toDate():void 0},mongoFormatValue:function(e,t,r){var a=this.utils.moment(e,r.valueFormat);return a.isValid()?a.toDate():void 0}},boolean:{type:"boolean",jsType:"boolean",valueSrc:"value",labelYes:"Yes",labelNo:"No",formatValue:function(e,t,r,a){return a?e?"Yes":"No":JSON.stringify(!!e)},sqlFormatValue:function(e,t,r,a,i){return this.utils.SqlString.escape(e)},spelFormatValue:function(e,t,r,a,i){return this.utils.spelEscape(e)},defaultValue:!1,toJS:function(e,t){return e},mongoFormatValue:function(e,t,r){return e}},field:{valueSrc:"field",formatValue:function(e,t,r,a,i,o,u){return a&&u.label||e},sqlFormatValue:function(e,t,r,a,i,o){return e},spelFormatValue:function(e,t,r,a,i){return e},valueLabel:"Field to compare",valuePlaceholder:"Select field to compare"},func:{valueSrc:"func",valueLabel:"Function",valuePlaceholder:"Select function"},case_value:{valueSrc:"value",type:"case_value",spelFormatValue:function(e){return this.utils.spelEscape(e===""?null:e)},spelImportValue:function(e){return[e.value,[]]},jsonLogic:function(e){return e===""?null:e}}},ES={text:{defaultOperator:"equal",mainWidget:"text",widgets:{text:{operators:["equal","not_equal","like","not_like","starts_with","ends_with","proximity","is_empty","is_not_empty","is_null","is_not_null"],widgetProps:{},opProps:{}},textarea:{operators:["equal","not_equal","like","not_like","starts_with","ends_with","is_empty","is_not_empty","is_null","is_not_null"],widgetProps:{},opProps:{}},field:{operators:["equal","not_equal","proximity"]}}},number:{defaultOperator:"equal",mainWidget:"number",widgets:{number:{operators:["equal","not_equal","less","less_or_equal","greater","greater_or_equal","between","not_between","is_null","is_not_null"]},slider:{operators:["equal","not_equal","less","less_or_equal","greater","greater_or_equal","is_null","is_not_null"]}}},date:{defaultOperator:"equal",widgets:{date:{operators:["equal","not_equal","less","less_or_equal","greater","greater_or_equal","between","not_between","is_null","is_not_null"]}}},time:{defaultOperator:"equal",widgets:{time:{operators:["equal","not_equal","less","less_or_equal","greater","greater_or_equal","between","not_between","is_null","is_not_null"]}}},datetime:{defaultOperator:"equal",widgets:{datetime:{operators:["equal","not_equal","less","less_or_equal","greater","greater_or_equal","between","not_between","is_null","is_not_null"]}}},select:{mainWidget:"select",defaultOperator:"select_equals",widgets:{select:{operators:["select_equals","select_not_equals","is_null","is_not_null"]},multiselect:{operators:["select_any_in","select_not_any_in","is_null","is_not_null"]}}},multiselect:{defaultOperator:"multiselect_equals",widgets:{multiselect:{operators:["multiselect_contains","multiselect_not_contains","multiselect_equals","multiselect_not_equals","is_null","is_not_null"]}}},boolean:{defaultOperator:"equal",widgets:{boolean:{operators:["equal","not_equal","is_null","is_not_null"],widgetProps:{}},field:{operators:["equal","not_equal"]}}},"!group":{defaultOperator:"some",mainWidget:"number",widgets:{number:{widgetProps:{min:0},operators:["some","all","none","equal","not_equal","less","less_or_equal","greater","greater_or_equal","between","not_between"],opProps:{equal:{label:"Count =="},not_equal:{label:"Count !="},less:{label:"Count <"},less_or_equal:{label:"Count <="},greater:{label:"Count >"},greater_or_equal:{label:"Count >="},between:{label:"Count between"},not_between:{label:"Count not between"}}}}},case_value:{mainWidget:"case_value",widgets:{case_value:{widgetProps:{}}}}},LS=ke(ke({},bp),{},{convertableWidgets:{number:["slider","rangeslider"],slider:["number","rangeslider"],rangeslider:["number","slider"],text:["textarea"],textarea:["text"]},formatSpelField:function(e,t,r,a,i,o){var u=this,s=a.map(function(l,c){var d=l.key,f=l.parent,p=l.fieldSeparator;return c==0?f=="[map]"?"#this[".concat(u.utils.spelEscape(d),"]"):(f=="[class]",d):f=="map"||f=="[map]"?"[".concat(u.utils.spelEscape(d),"]"):(f=="class"||f=="[class]","".concat(p).concat(d))}).join("");return i.fieldName&&(s=e),i.isSpelVariable&&(s="#"+s),s},sqlFormatReverse:function(e){if(e!=null)return"NOT"+this.utils.wrapWithBrackets(e)},spelFormatReverse:function(e){if(e!=null)return"!"+this.utils.wrapWithBrackets(e)},formatReverse:function(e,t,r,a,i,o){if(e!=null)return o?"NOT "+this.utils.wrapWithBrackets(e):"!"+this.utils.wrapWithBrackets(e)},formatAggr:function(e,t,r,a,i,o,u,s,l,c){var d=u.labelForFormat,f=u.cardinality;if(f==0){var p=e?" HAVE ".concat(e):"";return"".concat(d," OF ").concat(t).concat(p)}else if(f==null||f==1){var v=e?" WHERE ".concat(e):"";return"COUNT OF ".concat(t).concat(v," ").concat(d," ").concat(a)}else if(f==2){var g=e?" WHERE ".concat(e):"",h=a.first(),y=a.get(1);return"COUNT OF ".concat(t).concat(g," ").concat(d," ").concat(h," AND ").concat(y)}},jsonLogic:{groupVarKey:"var",altVarKey:"var",lockedOp:"locked"},canCompareFieldWithField:function(e,t,r,a){return!0},valueSourcesInfo:{value:{label:"Value"},field:{label:"Field",widget:"field"},func:{label:"Function",widget:"func"}}}),vv=function(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,a={rangeslider:RS,treeselect:xS,treemultiselect:PS,rangeable__date:jS("date","date")},i=FS(t),o;try{for(i.s();!(o=i.n()).done;){var u=o.value,s=a[u];if(s)e=s(e,r);else throw new Error("Can't ".concat(r?"add":"remove"," mixin ").concat(u))}}catch(l){i.e(l)}finally{i.f()}return e},gv=function(e,t){return vv(e,t,!0)},TS=function(e,t){return vv(e,t,!1)},jS=function(e,t){return function(r){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,i=r.types;return i=ke(ke({},i),{},(0,z.A)({},e,ke(ke({},i[e]),{},{widgets:ke({},i[e].widgets)}))),a?i[e].widgets[t]=ke({opProps:{between:{isSpecialRange:!0,textSeparators:[null,null]},not_between:{isSpecialRange:!0,textSeparators:[null,null]}}},i[e].widgets[t]):delete i[e].widgets[t],ke(ke({},r),{},{types:i})}},RS=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,r=e.widgets,a=e.types;return r=ke({},r),t?r.rangeslider=ke({type:"number",jsType:"number",valueSrc:"value",valueLabel:"Range",valuePlaceholder:"Select range",valueLabels:[{label:"Number from",placeholder:"Enter number from"},{label:"Number to",placeholder:"Enter number to"}],formatValue:function(o,u,s,l){return l?this.utils.stringifyForDisplay(o):JSON.stringify(o)},sqlFormatValue:function(o,u,s,l,c){return this.utils.SqlString.escape(o)},spelFormatValue:function(o){return this.utils.spelEscape(o)},singleWidget:"slider",toJS:function(o,u){return o}},r.rangeslider):delete r.rangeslider,a=ke(ke({},a),{},{number:ke(ke({},a.number),{},{widgets:ke({},a.number.widgets)})}),t?a.number.widgets.rangeslider=ke({opProps:{between:{isSpecialRange:!0},not_between:{isSpecialRange:!0}},operators:["between","not_between","is_null","is_not_null"]},a.number.widgets.rangeslider):delete a.number.widgets.rangeslider,ke(ke({},e),{},{widgets:r,types:a})},xS=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,r=e.widgets,a=e.types;return r=ke({},r),t?r.treeselect=ke({type:"treeselect",jsType:"string",valueSrc:"value",valueLabel:"Value",valuePlaceholder:"Select value",formatValue:function(o,u,s,l){var c=u.fieldSettings.treeValues||u.fieldSettings.listValues||u.asyncListValues,d=this.utils.getTitleInListValues(c,o);return l?this.utils.stringifyForDisplay(d):JSON.stringify(o)},sqlFormatValue:function(o,u,s,l,c){return this.utils.SqlString.escape(o)},spelFormatValue:function(o){return this.utils.spelEscape(o)},toJS:function(o,u){return o}},r.treeselect):delete r.treeselect,a=ke({},a),t?a.treeselect=ke({mainWidget:"treeselect",defaultOperator:"select_equals",widgets:{treeselect:{operators:["select_equals","select_not_equals"]},treemultiselect:{operators:["select_any_in","select_not_any_in"]}}},a.treeselect):delete a.treeselect,ke(ke({},e),{},{widgets:r,types:a})},PS=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,r=e.widgets,a=e.types;return r=ke({},r),t?r.treemultiselect=ke({type:"treemultiselect",jsType:"array",valueSrc:"value",valueLabel:"Values",valuePlaceholder:"Select values",formatValue:function(o,u,s,l){var c=this,d=u.fieldSettings.treeValues||u.fieldSettings.listValues||u.asyncListValues,f=o.map(function(p){return c.utils.getTitleInListValues(d,p)});return l?f.map(this.utils.stringifyForDisplay):o.map(JSON.stringify)},sqlFormatValue:function(o,u,s,l,c){var d=this;return o.map(function(f){return d.utils.SqlString.escape(f)})},spelFormatValue:function(o){return this.utils.spelEscape(o)},toJS:function(o,u){return o}},r.treemultiselect):delete r.treemultiselect,a=ke({},a),t?a.treemultiselect=ke({defaultOperator:"multiselect_equals",widgets:{treemultiselect:{operators:["multiselect_equals","multiselect_not_equals"]}}},a.treemultiselect):delete a.treemultiselect,ke(ke({},e),{},{widgets:r,types:a})},IS={addMixins:gv,removeMixins:TS},Ps={conjunctions:CS,operators:wS,widgets:AS,types:ES,settings:LS,ctx:SS};Ps=gv(Ps,["rangeslider","treeselect","treemultiselect"]);const fr=Ps;var hv="ADD_GROUP",Is="ADD_CASE_GROUP",mv="REMOVE_GROUP",yv="SET_CONJUNCTION",bv="SET_NOT",Ov="ADD_RULE",Sv="REMOVE_RULE",Fv="SET_FIELD",_v="SET_FIELD_SRC",Cv="SET_OPERATOR",wv="SET_VALUE",Av="SET_VALUE_SRC",Ev="SET_FUNC_VALUE",Lv="SET_OPERATOR_OPTION",Tv="SET_LOCK",Ds="SET_TREE",jv="MOVE_ITEM",Rv="after",xv="before",Vs="append",Ns="prepend",Pv="SET_DRAG_PROGRESS",Iv="SET_DRAG_START",Dv="SET_DRAG_END",DS=D(73916),bo=D.n(DS);function Vv(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),t.push.apply(t,r)}return t}function Zt(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Vv(Object(t),!0).forEach(function(r){(0,z.A)(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Vv(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function ks(n,e){var t=typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(!t){if(Array.isArray(n)||(t=VS(n))||e&&n&&typeof n.length=="number"){t&&(n=t);var r=0,a=function(){};return{s:a,n:function(){return r>=n.length?{done:!0}:{done:!1,value:n[r++]}},e:function(l){throw l},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,o=!1,u;return{s:function(){t=t.call(n)},n:function(){var l=t.next();return i=l.done,l},e:function(l){o=!0,u=l},f:function(){try{!i&&t.return!=null&&t.return()}finally{if(o)throw u}}}}function VS(n,e){if(n){if(typeof n=="string")return Nv(n,e);var t=Object.prototype.toString.call(n).slice(8,-1);if(t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set")return Array.from(n);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Nv(n,e)}}function Nv(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=new Array(e);t<e;t++)r[t]=n[t];return r}var kv=function(e,t,r,a,i,o){var u,s=arguments.length>6&&arguments[6]!==void 0?arguments[6]:null,l=arguments.length>7&&arguments[7]!==void 0?arguments[7]:{},c=e.getIn(Z(t));if(!c)return e;var d=(i==null||(u=i.get)===null||u===void 0?void 0:u.call(i,"id"))||a,f=o.settings.shouldCreateEmptyGroup,p=t.push(d),v=!f,g=!!(l!=null&&l.isDefaultCase),h=e;return e=Bn(e,t,r,d,wn(o).merge(bn(i)||{}),o,s),e!==h&&(!s&&!g&&(e=e.setIn(Z(p,"children1"),new pe.OrderedMap),v&&(e=Bn(e,p,"rule",Ve(),Yt(o,l?.parentRuleGroupField),o))),e=kt(e)),e},NS=function(e,t,r){var a=e.getIn(Z(t));if(!a)return e;e=Ms(e,t);var i=r.settings.canLeaveEmptyGroup,o=t.slice(0,-1),u=!Bu(e,o);if(u&&!i&&(e=Xi(e),Wu(e)&&!i)){var s=!1,l=!1;e=Bn(e,new pe.List,"rule",Ve(),Yt(r,void 0,void 0,s,l),r)}return e=kt(e),e},kS=function(e,t,r){var a=e.getIn(Z(t));if(!a)return e;e=Ms(e,t);var i=r.settings.canLeaveEmptyGroup,o=t.pop(),u=e.getIn(Z(o)),s=u.getIn(["properties","field"]),l=u.getIn(["properties","operator"]),c=s?oe(r,s):null,d=l?Ie(r,l,s):null,f=s&&l&&d.cardinality!=0,p=u.get("type")=="rule_group",v=!Bu(e,o),g=p?f&&c.initialEmptyWhere:i;if(v&&!g&&(p&&(e=e.deleteIn(Z(o))),e=Xi(e),Wu(e)&&!i)){var h=!1,y=!1;e=Bn(e,new pe.List,"rule",Ve(),Yt(r,void 0,void 0,h,y),r)}return e=kt(e),e},MS=function(e,t,r){var a=e.getIn(Z(t));return a&&(e=e.setIn(Z(t,"properties","not"),r)),e},$S=function(e,t,r){var a=e.getIn(Z(t));return a&&(e=Wc(e.setIn(Z(t,"properties","isLocked"),r))),e},GS=function(e,t,r){var a=e.getIn(Z(t));return a&&(e=e.setIn(Z(t,"properties","conjunction"),r)),e},Bn=function(e,t,r,a,i,o){var u,s=arguments.length>6&&arguments[6]!==void 0?arguments[6]:null;if(r==="switch_group")throw new Error("Can't add switch_group programmatically");var l=e.getIn(Z(t));if(!l)return e;var c=(i==null||(u=i.get)===null||u===void 0?void 0:u.call(i,"id"))||a,d=o.settings,f=d.maxNumberOfCases,p=d.maxNumberOfRules,v=d.maxNesting,g=e.get("type"),h=g==="switch_group",y=h?e.getIn(Z(t.take(2))):null,m=Z(t,"children1"),b=e.getIn(m),O=!!b&&b.size,S=O?b.size:null,F,_;if(r==="case_group")F=S,_=f;else if(r==="group"){var T=zu(e,t);if(T.length){var E=T[0],A=E.path,j=E.field,R=oe(o,j);F=t.size-A.length,_=R?.maxNesting}else F=t.size,_=v}else{var L=zu(e,t);if(L.length){var N=L[0],I=N.path,P=N.field,x=oe(o,P),k=Sn(e,I);_=x?.maxNumberOfRules,F=Zi(k)}else F=Zi(h?y:e),_=p}var V=_&&F?F<_:!0,G={type:r,id:c,properties:i};YS(o,G,s);var $=r==="case_group"&&O&&b.last().get("children1")==null;if(V){var W=new pe.OrderedMap((0,z.A)({},c,new pe.Map(G)));if(!O)e=e.setIn(m,W);else if($){var q=b.last(),J=new pe.OrderedMap((0,z.A)((0,z.A)({},c,new pe.Map(G)),q.get("id"),q));e=e.deleteIn(Z(m,"children1",q.get("id"))),e=e.mergeIn(m,J)}else e=e.mergeIn(m,W);e=kt(e)}return e},Ms=function(e,t){return e=e.deleteIn(Z(t)),e=kt(e),e},zS=function(e,t,r,a,i){var o=Sn(e,t),u=t.pop(),s=t.size>1?Sn(e,u):null,l=s?s.get("children1"):null,c=Sn(e,r),d=a==Vs||a==Ns?r:r.pop(),f=a==Vs||a==Ns?c:r.size>1?Sn(e,d):null,p=f?f.get("children1"):null;if(!s||!f||!o)return e;var v=s.get("id")==f.get("id"),g=d.size<u.size&&Bi(d.toArray(),u.toArray().slice(0,d.size)),h=d.size>u.size&&Bi(u.toArray(),d.toArray().slice(0,u.size)),y=null,m=null;g?y=pe.List(u.toArray().slice(d.size)):h&&(m=pe.List(d.toArray().slice(u.size)));var b=p,O=l;return h||(O=O.delete(o.get("id"))),v?b=O:g&&(b=b.updateIn(Gu(y,"children1"),function(S){return O})),a==xv||a==Rv?b=pe.OrderedMap().withMutations(function(S){var F=ks(b.entries()),_;try{for(F.s();!(_=F.n()).done;){var T=(0,ie.A)(_.value,2),E=T[0],A=T[1];E==c?.get("id")&&a==xv&&S.set(o.get("id"),o),S.set(E,A),E==c?.get("id")&&a==Rv&&S.set(o.get("id"),o)}}catch(j){F.e(j)}finally{F.f()}}):a==Vs?b=b.merge(pe.OrderedMap((0,z.A)({},o.get("id"),o))):a==Ns&&(b=pe.OrderedMap((0,z.A)({},o.get("id"),o)).merge(b)),h&&(O=O.updateIn(Gu(m,"children1"),function(S){return b}),O=O.delete(o.get("id"))),!v&&!g&&(e=e.updateIn(Z(u,"children1"),function(S){return O})),h||(e=e.updateIn(Z(d,"children1"),function(S){return b})),e=kt(e),e},US=function(e,t,r,a){var i=e.getIn(Z(t));if(!i)return e;var o=a.settings.keepInputOnChangeFieldSrc,u=i.get("properties"),s=u?.get("field"),l=u?.get("fieldType"),c=oe(a,s),d=c?.type||l;(!d||d==="!group"||d==="!struct")&&(d=null);var f=!so.includes(d),p=o&&!gs(i,a)&&f;return p?(e=e.setIn(Z(t,"properties","field"),null),e=e.deleteIn(Z(t,"properties","fieldError")),e=e.setIn(Z(t,"properties","fieldType"),d)):e=e.setIn(Z(t,"properties"),Yt(a,null,null,!1)),e=e.setIn(Z(t,"properties","fieldSrc"),r),e},WS=function(e,t,r,a,i,o,u,s,l){var c=arguments.length>9&&arguments[9]!==void 0?arguments[9]:{},d=t.getIn(Z(r));if(!d)return t;var f=a===-1,p=d.get("properties"),v=p.get("field"),g=p.get("value"),h=f?v:g.getIn([a]),y=[],m=h,b=ks(i||[]),O;try{for(b.s();!(O=b.n()).done;){var S=(0,ie.A)(O.value,2),F=S[0],_=S[1];if(y.push([F,_,m]),F!==m.get("func")){var T=y.map(function(J){var K=(0,ie.A)(J,2),U=K[0],X=K[1];return"".concat(U,"(").concat(X,")")}).join("/")||"root";throw new Error("In ".concat(f?"LHS":"RHS"," for path ").concat(T," expected func key ").concat(F," but got ").concat(parent.get("func")))}m=m.getIn(["args",_,"value"])}}catch(J){b.e(J)}finally{b.f()}if(o){var j=m.get("func"),R=Ar(e,j),L=R.args,N=L[o];s==="!valueSrc"?m=Xf(m,o,u,N,e):m=fs(m,o,u,N,e)}else{var E=u,A=!0;m=Kf(m,E,e,A),c.canDropArgs=!0}for(var I=m;y.length;){var P=y.pop(),x=(0,ie.A)(P,3),k=x[0],V=x[1],G=x[2],$=Ar(e,k),W=$.args,q=W[V];I=fs(G,V,I,q,e)}return f?Mv(t,r,I,e,l,c):$v(t,r,a,I,void 0,e,l,c)},Mv=function(e,t,r,a,i){var o,u,s,l,c=arguments.length>5&&arguments[5]!==void 0?arguments[5]:{},d=e.getIn(Z(t));if(!d)return{state:e};var f=c.isEndValue,p=c.canDropArgs;if(!r)return e=Ms(e,t),{state:e};var v=a.settings,g=v.fieldSeparator,h=v.setOpOnChangeField,y=v.showErrorMessage;Array.isArray(r)&&(r=r.join(g));var m=d.get("type"),b=d.get("properties"),O=m=="rule_group",S=b?.get("fieldSrc"),F=oe(a,r);if(!F)return console.warn("No config for LHS ".concat(r)),{state:e};var _=F.type;(_==="!group"||_==="!struct")&&(_=null);var T=b?.get("operator"),E=b?.get("operatorOptions"),A=b?.get("field"),j=F.type=="!group",R=j&&F.mode=="array",L=O!=j,N=F&&((o=F.operators)===null||o===void 0?void 0:o.indexOf(T))!==-1?T:null,I=S==="func"&&(A==null||(u=A.get)===null||u===void 0?void 0:u.call(A,"func"))===((s=r)===null||s===void 0||(l=s.get)===null||l===void 0?void 0:l.call(s,"func")),P=I&&!!N,x=null,k=S==="func"?ep(a,_):lo(a,r);if(k&&k.length==1)x=k[0];else if(P)x=N;else if(k&&k.length>1){var V=ks(h),G;try{for(V.s();!(G=V.n()).done;){var $=G.value;if($=="keep"&&!L?x=N:$=="default"?x=es(a,r,!1):$=="first"&&(x=ps(a,r)),x)break}}catch(ge){V.e(ge)}finally{V.f()}}if(!j&&!F.operators)return console.warn("Type ".concat(F.type," is not supported")),{state:e};O&&!j&&(e=e.setIn(Z(t,"type"),"rule"),e=e.deleteIn(Z(t,"children1")),e=e.setIn(Z(t,"properties"),new pe.OrderedMap)),b||(e=e.setIn(Z(t,"properties"),new pe.OrderedMap));var W=!y;if(j){e=e.setIn(Z(t,"type"),"rule_group");var q=$n(a,a,b,r,x,"field",W,f,p),J=q.canReuseValue,K=q.newValue,U=q.newValueSrc,X=q.newValueType,Y=q.operatorCardinality,ae=wn(a,F,r).merge({field:r,fieldSrc:"field",mode:F.mode});R&&(ae=ae.merge({operator:x,value:K,valueSrc:U,valueType:X})),e=e.setIn(Z(t,"children1"),new pe.OrderedMap),e=e.setIn(Z(t,"properties"),ae),F.initialEmptyWhere&&Y==1||(e=Bn(e,t,"rule",Ve(),Yt(a,r),a)),e=kt(e)}else e=e.updateIn(Z(t,"properties"),function(ge){return ge.withMutations(function(se){var ce=$n(a,a,se,r,x,"field",W,f,p),de=ce.canReuseValue,ne=ce.newValue,ve=ce.newValueSrc,ye=ce.newValueType,Ce=ce.newValueError,fe=ce.newFieldError,ar=ce.fixedField,Le=r,Me=ar!==r;Me&&(Le=ar),y&&(se=se.set("fieldError",fe),se=se.set("valueError",Ce));var Ae=de?E:fi(a,x,Le);return se=se.set("field",Le).delete("fieldType").set("fieldSrc",S).set("operator",x).set("operatorOptions",Ae).set("value",ne).set("valueSrc",ve).set("valueType",ye),de||(se=se.delete("asyncListValues")),se})});return{state:e}},BS=function(e,t,r,a){var i=e.getIn(Z(t));if(!i)return e;var o=a.settings.showErrorMessage,u=i.get("properties"),s=i.get("children1"),l=u.get("field"),c=u.get("fieldSrc"),d=oe(a,l),f=d?.type=="!group",p=Ie(a,r,l),v=p?Cr(p):null,g=!0;return e=e.updateIn(Z(t,"properties"),function(h){return h.withMutations(function(y){var m=y.get("field"),b=y.get("operatorOptions"),O=y.get("value",new pe.List),S=y.get("valueSrc",new pe.List),F=y.get("operator"),_=$n(a,a,y,m,r,"operator",g),T=_.canReuseValue,E=_.newValue,A=_.newValueSrc,j=_.newValueType,R=_.newValueError;o&&(y=y.set("valueError",R));var L=T?b:fi(a,r,m);return T||(y=y.delete("asyncListValues")),y.set("operator",r).set("operatorOptions",L).set("value",E).set("valueSrc",A).set("valueType",j)})}),f&&v==0&&s.size==0&&(e=Bn(e,t,"rule",Ve(),Yt(a,l),a)),e},$v=function(e,t,r,a,i,o,u){var s=arguments.length>7&&arguments[7]!==void 0?arguments[7]:{},l=e.getIn(Z(t));if(!l)return{state:e};var c=s.canDropArgs,d=s.isEndValue,f=o.settings,p=f.fieldSeparator,v=f.showErrorMessage,g=e.getIn(Z(t,"properties","valueSrc",r+""))||null;g==="field"&&Array.isArray(a)&&(a=a.join(p));var h=e.getIn(Z(t,"properties","field"))||null,y=e.getIn(Z(t,"properties","operator"))||null,m=Ie(o,y,h),b=y?Cr(m):null,O=i||rp(a,g,o),S=!v,F=Fa(o,h,h,y,a,O,g,u,S,d,c),_=(0,ie.A)(F,2),T=_[0],E=_[1],A=E?.find(function(G){return!G.fixed&&!G.ignore}),j=A?Mt(A):null,R=T!==a;R&&(a=T),e=Gv(e,t,o,b);var L=Array.from({length:b},function(G,$){return $==r?a:e.getIn(Z(t,"properties","value",$+""))||null}),N=Array.from({length:b},function(G,$){return e.getIn(Z(t,"properties","valueSrc",$+""))||null}),I=cs(o,h,y,L,N),P=I?Mt(I):null,x=!j&&!P,k=v?!0:x||R;if(k&&(e=e.deleteIn(Z(t,"properties","asyncListValues")),typeof a>"u"?(e=e.setIn(Z(t,"properties","value",r),void 0),e=e.setIn(Z(t,"properties","valueType",r),null)):(u&&(e=e.setIn(Z(t,"properties","asyncListValues"),u)),e=e.setIn(Z(t,"properties","value",r),a),e=e.setIn(Z(t,"properties","valueType",r),O))),v){var V=e.getIn(Z(t,"properties","valueError"));V||(e=e.setIn(Z(t,"properties","valueError"),new pe.List(new Array(b)))),e=e.setIn(Z(t,"properties","valueError",r),j),b>=2&&(e=e.setIn(Z(t,"properties","valueError",b),P))}return{state:e}},qS=function(e,t,r,a,i){var o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:{},u=e.getIn(Z(t));if(!u)return e;var s=i.settings.showErrorMessage,l=e.getIn(Z(t,"properties","field"))||null,c=e.getIn(Z(t,"properties","operator"))||null,d=Ie(i,c,l),f=c?Cr(d):null;if(e=Gv(e,t,i,f),e=e.setIn(Z(t,"properties","value",r+""),void 0),e=e.setIn(Z(t,"properties","valueType",r+""),null),e=e.deleteIn(Z(t,"properties","asyncListValues")),s&&(e=e.setIn(Z(t,"properties","valueError",r),null),d.validateValues&&(e=e.setIn(Z(t,"properties","valueError",f),null))),typeof a>"u"?e=e.setIn(Z(t,"properties","valueSrc",r+""),null):e=e.setIn(Z(t,"properties","valueSrc",r+""),a),a){var p=e.getIn(Z(t,"properties")),v=!0,g=$n(i,i,p,l,c,"valueSrc",v),h=g.canReuseValue,y=g.newValue,m=g.newValueSrc,b=g.newValueType,O=g.newValueError;!h&&m.get(r)==a&&(e=e.setIn(Z(t,"properties","value",r+""),y.get(r)),e=e.setIn(Z(t,"properties","valueType",r+""),b.get(r)))}return e},HS=function(e,t,r,a){var i=e.getIn(Z(t));return i?e.setIn(Z(t,"properties","operatorOptions",r),a):e},JS=function(e,t){var r=t.settings.canLeaveEmptyGroup;return r||(e=Xi(e)),e},Gv=function(e,t,r,a){if(!a){var i=e.getIn(Z(t,"properties","field"))||null,o=e.getIn(Z(t,"properties","operator"))||null,u=Ie(r,o,i);a=o?Cr(u):null}for(var s=0,l=["value","valueType","valueError","valueSrc"];s<l.length;s++){var c=l[s];e.getIn(Z(t,"properties",c))||(e=e.setIn(Z(t,"properties",c),new pe.List(a?Array.from({length:a}):[])))}return e},YS=function n(e,t,r){r&&Array.isArray(r)&&(t.children1=new pe.OrderedMap(r.reduce(function(a,i){var o,u=(o=i.id)!==null&&o!==void 0?o:Ve(),s=Zt(Zt({},i),{},{properties:Vd(e,i).merge(bn(i.properties)||{}),id:u});return n(e,s,s.children1),Zt(Zt({},a),{},(0,z.A)({},u,new pe.Map(s)))},{})))},KS=function(e,t){var r=e.getIn(Z(t,"properties","field"))||null;return r},zv={dragging:{id:null,x:null,y:null,w:null,h:null},mousePos:{},dragStart:{id:null}},QS=function(e,t){if(!e||!e.type)return null;var r=["config","asyncListValues"],a=[Ds,Iv,Pv,Dv],i=bo()(Yi()(e,r),Du),o=e.path&&KS(t.tree,e.path)||e.field;if(o){var u;(u=o)!==null&&u!==void 0&&u.toJS&&(o=o.toJS()),i.affectedField=o}return(a.includes(e.type)||e.type.indexOf("@@redux")==0)&&(i=null),i};const XS=function(n,e,t,r,a){var i=e,o=Zt({tree:i},zv);return function(){var u,s,l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:o,c=arguments.length>1?arguments[1]:void 0,d=(u=(s=a?.())!==null&&s!==void 0?s:c?.config)!==null&&u!==void 0?u:n,f={__lastAction:void 0},p={},v=QS(c,l);switch(c?.type){case Ds:{var g=t(d,c.tree);p.tree=g;break}case Is:{p.tree=kv(l.tree,c.path,"case_group",c.id,c.properties,d,c.children,c.meta);break}case hv:{p.tree=kv(l.tree,c.path,"group",c.id,c.properties,d,c.children,c.meta);break}case mv:{p.tree=NS(l.tree,c.path,d);break}case Ov:{p.tree=Bn(l.tree,c.path,c.ruleType,c.id,c.properties,d,c.children);break}case Sv:{p.tree=kS(l.tree,c.path,d);break}case yv:{p.tree=GS(l.tree,c.path,c.conjunction);break}case bv:{p.tree=MS(l.tree,c.path,c.not);break}case Fv:{var h=Mv(l.tree,c.path,c.field,d,c.asyncListValues,c._meta),y=h.state;p.tree=y;break}case _v:{p.tree=US(l.tree,c.path,c.srcKey,d);break}case Tv:{p.tree=$S(l.tree,c.path,c.lock);break}case Cv:{p.tree=BS(l.tree,c.path,c.operator,d);break}case wv:{var m=$v(l.tree,c.path,c.delta,c.value,c.valueType,d,c.asyncListValues,c._meta),b=m.state;p.tree=b;break}case Ev:{var O=WS(d,l.tree,c.path,c.delta,c.parentFuncs,c.argKey,c.value,c.valueType,c.asyncListValues,c._meta),S=O.state;p.tree=S;break}case Av:{p.tree=qS(l.tree,c.path,c.delta,c.srcKey,d,c._meta);break}case Lv:{p.tree=HS(l.tree,c.path,c.name,c.value);break}case jv:{p.tree=zS(l.tree,c.fromPath,c.toPath,c.placement,d);break}case Iv:{p.dragStart=c.dragStart,p.dragging=c.dragging,p.mousePos=c.mousePos;break}case Pv:{p.mousePos=c.mousePos,p.dragging=c.dragging;break}case Dv:{p.tree=JS(l.tree,d),p=Zt(Zt({},p),zv);break}default:break}return v&&(p.__lastAction=v),r&&p.tree&&l.tree&&r(l.tree),Zt(Zt(Zt({},l),f),p)}};var ZS=function(e,t){return{type:Ds,tree:t,config:e}},eF=function(e,t,r){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"rule",i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:null,o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:null;return{type:Ov,ruleType:a,children:i,path:wr(t),id:Ve(),properties:Yt(e,o).merge(bn(r)||{}),config:e,meta:{parentRuleGroupField:o}}},rF=function(e,t){return{type:Sv,path:wr(t),config:e}},tF=function(e,t,r){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;return{type:Is,path:wr(t),children:a,id:Ve(),properties:wn(e).merge(bn(r)||{}),config:e,meta:{isDefaultCase:!0}}},nF=function(e,t,r){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;return{type:Is,path:wr(t),children:a,id:Ve(),properties:wn(e).merge(bn(r)||{}),config:e}},aF=function(e,t,r){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:null;return{type:hv,path:wr(t),children:a,id:Ve(),properties:wn(e,i).merge(bn(r)||{}),config:e,meta:{parentRuleGroupField:i}}},iF=function(e,t){return{type:mv,path:wr(t),config:e}},oF=function(e,t,r,a){return{type:jv,fromPath:wr(t),toPath:wr(r),placement:a,config:e}},uF=function(e,t,r){return{type:yv,path:wr(t),conjunction:r}},sF=function(e,t,r){return{type:bv,path:wr(t),not:r}},lF=function(e,t,r){return{type:Tv,path:wr(t),lock:r}},cF=function(e,t,r,a,i){return{type:Fv,path:wr(t),field:r,config:e,asyncListValues:a,_meta:i}},dF=function(e,t,r){return{type:_v,path:wr(t),srcKey:r,config:e}},fF=function(e,t,r){return{type:Cv,path:wr(t),operator:r,config:e}},pF=function(e,t,r,a,i,o,u){return{type:wv,path:wr(t),delta:r,value:a,valueType:i,asyncListValues:o,config:e,_meta:u}},vF=function(e,t,r,a,i){return{type:Av,path:wr(t),delta:r,srcKey:a,config:e,_meta:i}},gF=function(e,t,r,a,i,o,u,s,l){return{type:Ev,path:wr(t),delta:r,parentFuncs:a,argKey:i,value:o,valueType:u,asyncListValues:s,config:e,_meta:l}},hF=function(e,t,r,a){return{type:Lv,path:wr(t),name:r,value:a,config:e}};function Uv(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),t.push.apply(t,r)}return t}function $s(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Uv(Object(t),!0).forEach(function(r){(0,z.A)(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Uv(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}var Oe=$s($s($s({},me),{},{Export:Re,Import:Ye,ConfigMixins:IS},Re),Ye),mF=D(5556),w=D.n(mF);const yF=XS,bi=C.createContext();var bF=D(14644),OF=D(19888),SF=D(69242),FF=D(40961);function _F(n){n()}let Wv=_F;const CF=n=>Wv=n,wF=()=>Wv,Bv=Symbol.for("react-redux-context"),qv=typeof globalThis<"u"?globalThis:{};function AF(){var n;if(!C.createContext)return{};const e=(n=qv[Bv])!=null?n:qv[Bv]=new Map;let t=e.get(C.createContext);return t||(t=C.createContext(null),e.set(C.createContext,t)),t}const Hv=AF(),UA=null;function WA(n=ReactReduxContext){return function(){return useContext(n)}}const BA=null;let Jv=null;const EF=n=>{Jv=n},LF=(n,e)=>n===e;function qA(n=ReactReduxContext){const e=n===ReactReduxContext?useDefaultReduxContext:createReduxContextHook(n);return function(r,a={}){const{equalityFn:i=LF,stabilityCheck:o=void 0,noopCheck:u=void 0}=typeof a=="function"?{equalityFn:a}:a,{store:s,subscription:l,getServerState:c,stabilityCheck:d,noopCheck:f}=e(),p=useRef(!0),v=useCallback({[r.name](h){return r(h)}}[r.name],[r,d,o]),g=Jv(l.addNestedSub,s.getState,c||s.getState,v,i);return useDebugValue(g),g}}const HA=null;var Te=D(58168),Yv=D(53825),TF=D(4146),Kv=D.n(TF),jF=D(44363);const RF=["initMapStateToProps","initMapDispatchToProps","initMergeProps"];function xF(n,e,t,r,{areStatesEqual:a,areOwnPropsEqual:i,areStatePropsEqual:o}){let u=!1,s,l,c,d,f;function p(m,b){return s=m,l=b,c=n(s,l),d=e(r,l),f=t(c,d,l),u=!0,f}function v(){return c=n(s,l),e.dependsOnOwnProps&&(d=e(r,l)),f=t(c,d,l),f}function g(){return n.dependsOnOwnProps&&(c=n(s,l)),e.dependsOnOwnProps&&(d=e(r,l)),f=t(c,d,l),f}function h(){const m=n(s,l),b=!o(m,c);return c=m,b&&(f=t(c,d,l)),f}function y(m,b){const O=!i(b,l),S=!a(m,s,b,l);return s=m,l=b,O&&S?v():O?g():S?h():f}return function(b,O){return u?y(b,O):p(b,O)}}function PF(n,e){let{initMapStateToProps:t,initMapDispatchToProps:r,initMergeProps:a}=e,i=(0,Yv.A)(e,RF);const o=t(n,i),u=r(n,i),s=a(n,i);return xF(o,u,s,n,i)}function IF(n,e){const t={};for(const r in n){const a=n[r];typeof a=="function"&&(t[r]=(...i)=>e(a(...i)))}return t}function Gs(n){return function(t){const r=n(t);function a(){return r}return a.dependsOnOwnProps=!1,a}}function Qv(n){return n.dependsOnOwnProps?!!n.dependsOnOwnProps:n.length!==1}function Xv(n,e){return function(r,{displayName:a}){const i=function(u,s){return i.dependsOnOwnProps?i.mapToProps(u,s):i.mapToProps(u,void 0)};return i.dependsOnOwnProps=!0,i.mapToProps=function(u,s){i.mapToProps=n,i.dependsOnOwnProps=Qv(n);let l=i(u,s);return typeof l=="function"&&(i.mapToProps=l,i.dependsOnOwnProps=Qv(l),l=i(u,s)),l},i}}function zs(n,e){return(t,r)=>{throw new Error(`Invalid value of type ${typeof n} for ${e} argument when connecting component ${r.wrappedComponentName}.`)}}function DF(n){return n&&typeof n=="object"?Gs(e=>IF(n,e)):n?typeof n=="function"?Xv(n,"mapDispatchToProps"):zs(n,"mapDispatchToProps"):Gs(e=>({dispatch:e}))}function VF(n){return n?typeof n=="function"?Xv(n,"mapStateToProps"):zs(n,"mapStateToProps"):Gs(()=>({}))}function NF(n,e,t){return(0,Te.A)({},t,n,e)}function kF(n){return function(t,{displayName:r,areMergedPropsEqual:a}){let i=!1,o;return function(s,l,c){const d=n(s,l,c);return i?a(d,o)||(o=d):(i=!0,o=d),o}}}function MF(n){return n?typeof n=="function"?kF(n):zs(n,"mergeProps"):()=>NF}function $F(){const n=wF();let e=null,t=null;return{clear(){e=null,t=null},notify(){n(()=>{let r=e;for(;r;)r.callback(),r=r.next})},get(){let r=[],a=e;for(;a;)r.push(a),a=a.next;return r},subscribe(r){let a=!0,i=t={callback:r,next:null,prev:t};return i.prev?i.prev.next=i:e=i,function(){!a||e===null||(a=!1,i.next?i.next.prev=i.prev:t=i.prev,i.prev?i.prev.next=i.next:e=i.next)}}}}const Zv={notify(){},get:()=>[]};function eg(n,e){let t,r=Zv,a=0,i=!1;function o(g){c();const h=r.subscribe(g);let y=!1;return()=>{y||(y=!0,h(),d())}}function u(){r.notify()}function s(){v.onStateChange&&v.onStateChange()}function l(){return i}function c(){a++,t||(t=e?e.addNestedSub(s):n.subscribe(s),r=$F())}function d(){a--,t&&a===0&&(t(),t=void 0,r.clear(),r=Zv)}function f(){i||(i=!0,c())}function p(){i&&(i=!1,d())}const v={addNestedSub:o,notifyNestedSubs:u,handleChangeWrapper:s,isSubscribed:l,trySubscribe:f,tryUnsubscribe:p,getListeners:()=>r};return v}const Oo=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u"?C.useLayoutEffect:C.useEffect;function rg(n,e){return n===e?n!==0||e!==0||1/n===1/e:n!==n&&e!==e}function Us(n,e){if(rg(n,e))return!0;if(typeof n!="object"||n===null||typeof e!="object"||e===null)return!1;const t=Object.keys(n),r=Object.keys(e);if(t.length!==r.length)return!1;for(let a=0;a<t.length;a++)if(!Object.prototype.hasOwnProperty.call(e,t[a])||!rg(n[t[a]],e[t[a]]))return!1;return!0}const GF=()=>{throw new Error("uSES not initialized!")},zF=["reactReduxForwardedRef"];let tg=GF;const UF=n=>{tg=n},WF=null,BF=[null,null],YA=n=>{try{return JSON.stringify(n)}catch{return String(n)}};function qF(n,e,t){Oo(()=>n(...e),t)}function HF(n,e,t,r,a,i){n.current=r,t.current=!1,a.current&&(a.current=null,i())}function JF(n,e,t,r,a,i,o,u,s,l,c){if(!n)return()=>{};let d=!1,f=null;const p=()=>{if(d||!u.current)return;const g=e.getState();let h,y;try{h=r(g,a.current)}catch(m){y=m,f=m}y||(f=null),h===i.current?o.current||l():(i.current=h,s.current=h,o.current=!0,c())};return t.onStateChange=p,t.trySubscribe(),p(),()=>{if(d=!0,t.tryUnsubscribe(),t.onStateChange=null,f)throw f}}const KA=()=>WF;function YF(n,e){return n===e}let QA=!1;function KF(n,e,t,{pure:r,areStatesEqual:a=YF,areOwnPropsEqual:i=Us,areStatePropsEqual:o=Us,areMergedPropsEqual:u=Us,forwardRef:s=!1,context:l=Hv}={}){const c=l,d=VF(n),f=DF(e),p=MF(t),v=!!n;return h=>{const y=h.displayName||h.name||"Component",m=`Connect(${y})`,b={shouldHandleStateChanges:v,displayName:m,wrappedComponentName:y,WrappedComponent:h,initMapStateToProps:d,initMapDispatchToProps:f,initMergeProps:p,areStatesEqual:a,areStatePropsEqual:o,areOwnPropsEqual:i,areMergedPropsEqual:u};function O(_){const[T,E,A]=C.useMemo(()=>{const{reactReduxForwardedRef:de}=_,ne=(0,Yv.A)(_,zF);return[_.context,de,ne]},[_]),j=C.useMemo(()=>T&&T.Consumer&&(0,jF.isContextConsumer)(C.createElement(T.Consumer,null))?T:c,[T,c]),R=C.useContext(j),L=!!_.store&&!!_.store.getState&&!!_.store.dispatch,N=!!R&&!!R.store,I=L?_.store:R.store,P=N?R.getServerState:I.getState,x=C.useMemo(()=>PF(I.dispatch,b),[I]),[k,V]=C.useMemo(()=>{if(!v)return BF;const de=eg(I,L?void 0:R.subscription),ne=de.notifyNestedSubs.bind(de);return[de,ne]},[I,L,R]),G=C.useMemo(()=>L?R:(0,Te.A)({},R,{subscription:k}),[L,R,k]),$=C.useRef(),W=C.useRef(A),q=C.useRef(),J=C.useRef(!1),K=C.useRef(!1),U=C.useRef(!1),X=C.useRef();Oo(()=>(U.current=!0,()=>{U.current=!1}),[]);const Y=C.useMemo(()=>()=>q.current&&A===W.current?q.current:x(I.getState(),A),[I,A]),ae=C.useMemo(()=>ne=>k?JF(v,I,k,x,W,$,J,U,q,V,ne):()=>{},[k]);qF(HF,[W,$,J,A,q,V]);let ge;try{ge=tg(ae,Y,P?()=>x(P(),A):Y)}catch(de){throw X.current&&(de.message+=`
The error may be correlated with this previous error:
${X.current.stack}

`),de}Oo(()=>{X.current=void 0,q.current=void 0,$.current=ge});const se=C.useMemo(()=>C.createElement(h,(0,Te.A)({},ge,{ref:E})),[E,h,ge]);return C.useMemo(()=>v?C.createElement(j.Provider,{value:G},se):se,[j,se,G])}const F=C.memo(O);if(F.WrappedComponent=h,F.displayName=O.displayName=m,s){const T=C.forwardRef(function(A,j){return C.createElement(F,(0,Te.A)({},A,{reactReduxForwardedRef:j}))});return T.displayName=m,T.WrappedComponent=h,Kv()(T,h)}return Kv()(F,h)}}const So=KF;function QF({store:n,context:e,children:t,serverState:r,stabilityCheck:a="once",noopCheck:i="once"}){const o=C.useMemo(()=>{const l=eg(n);return{store:n,subscription:l,getServerState:r?()=>r:void 0,stabilityCheck:a,noopCheck:i}},[n,r,a,i]),u=C.useMemo(()=>n.getState(),[n]);Oo(()=>{const{subscription:l}=o;return l.onStateChange=l.notifyNestedSubs,l.trySubscribe(),u!==n.getState()&&l.notifyNestedSubs(),()=>{l.tryUnsubscribe(),l.onStateChange=void 0}},[o,u]);const s=e||Hv;return C.createElement(s.Provider,{value:o},t)}const XF=QF;function XA(n=ReactReduxContext){const e=n===ReactReduxContext?useDefaultReduxContext:createReduxContextHook(n);return function(){const{store:r}=e();return r}}const ZA=null;function eE(n=ReactReduxContext){const e=n===ReactReduxContext?useDefaultStore:createStoreHook(n);return function(){return e().dispatch}}const rE=null;EF(SF.useSyncExternalStoreWithSelector),UF(OF.useSyncExternalStore),CF(FF.unstable_batchedUpdates);var tE="ADD_GROUP",nE="ADD_CASE_GROUP",aE="REMOVE_GROUP",iE="SET_CONJUNCTION",oE="SET_NOT",uE="ADD_RULE",sE="REMOVE_RULE",lE="SET_FIELD",cE="SET_FIELD_SRC",dE="SET_OPERATOR",fE="SET_VALUE",pE="SET_VALUE_SRC",vE="SET_OPERATOR_OPTION",gE="SET_LOCK",hE="SET_TREE",mE="MOVE_ITEM",Fo="after",_o="before",qn="append",Ea="prepend",ZF="SET_DRAG_PROGRESS",e_="SET_DRAG_START",r_="SET_DRAG_END",t_=function(e,t){return{type:ZF,mousePos:e,dragging:t}},n_=function(e,t,r){return{type:e_,dragStart:e,dragging:t,mousePos:r}},a_=function(){return{type:r_}},ng=jr,i_=sr,o_=hr,u_=function(e){var t;return(t=e?.cardinality)!==null&&t!==void 0?t:1},Co=function(e,t,r){if(!t||!e||e.length<=t)return e;var a=e.substr(0,t-1);return(r?a.substr(0,a.lastIndexOf(" ")):a)+"..."},Hn=function(e,t){return e===t?!0:e?.equals(t)},Jn=function(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return e===t?!0:Array.isArray(e)?s_(e,t,r):e&&typeof e.equals=="function"?e.equals(t):(0,We.A)(e)==="object"?l_(e,t,r):e===t};function s_(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;if(n===e)return!0;if(!n||!e)return!1;var r=n.length;if(e.length!==r)return!1;for(var a=0;a<r;a++){var i=t?Jn(n[a],e[a],t):n[a]===e[a];if(!i)return!1}return!0}function l_(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;if(n===e)return!0;if(!n||!e)return!1;var r=Object.keys(n),a=Object.keys(e),i=r.length;if(a.length!==i)return!1;for(var o=0;o<i;o++){var u=r[o],s=t?Jn(n[u],e[u],t):n[u]===e[u];if(!s)return!1}return!0}var c_=function(){return typeof process<"u"&&process.env&&!1},d_=function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,t=e??c_();return t?console:{error:function(){},log:function(){},warn:function(){},debug:function(){},info:function(){}}},f_=d_(),ag=Oe.Validation.validateAndFixTree,p_=function(){var e,t,r;return function(a,i){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0,u=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0;return i?(a.__configId===r&&(Hn(i,e)||Hn(i,t))||(r=a.__configId,e=i,u===!1?t=ag(i,null,a,o||a,!1,!1,!1):t=ag(i,null,a,o||a)),t):null}},v_=function(e){if(e._reactRootContainer)return"root";if(Object.getOwnPropertyNames(e).filter(function(t){return t.startsWith("__reactContainer")}).length>0)return"container"},g_=function n(e){if(e){var t=v_(e);return t!==void 0?t:n(e.parentNode)}},ig=function(e){return g_(e)==="root"},wo=function(e,t){return function(r,a){var i=e.props,o=e.state,u=r!=i||a!=o;if(u&&o==a&&i!=r){var s=[];for(var l in r){var c=r[l]!=i[l];c&&(t[l]=="ignore"?c=!1:t[l]=="shallow_deep"?c=!Jn(r[l],i[l],!0):t[l]=="shallow"?c=!Jn(r[l],i[l]):typeof t[l]=="function"&&(c=t[l](r[l],i[l],r,i))),c&&s.push(l)}s.length||(u=!1)}return u}},La=function(e){return function(t,r){return!Jn(e.props,t)||!Jn(e.state,r)}},h_=function(){var e=C.version.split(".").map(parseInt.bind(null,10));return e[0]==16&&e[1]<3||e[0]<16},nt=function(e){if(e.shouldComponentUpdate||(e.shouldComponentUpdate=La(e)),h_())e.componentWillReceiveProps=function(a){e.onPropsChanged(a)};else{var t=e.shouldComponentUpdate,r=function(i,o){var u=!Jn(e.props,i);u&&e.onPropsChanged(i);var s=t.call(e,i,o);return s};e.shouldComponentUpdate=r.bind(e)}},og=function(e,t,r){return bo()(e,function(a){return function(){for(var i=arguments.length,o=new Array(i),u=0;u<i;u++)o[u]=arguments[u];return r(a.apply(void 0,[t].concat(o)))}})};function ug(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),t.push.apply(t,r)}return t}function Ws(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?ug(Object(t),!0).forEach(function(r){(0,z.A)(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):ug(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function m_(n,e,t){return e=(0,ue.A)(e),(0,qe.A)(n,sg()?Reflect.construct(e,t||[],(0,ue.A)(n).constructor):e.apply(n,t))}function sg(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(sg=function(){return!!n})()}var lg=function(n){function e(t){var r;(0,Ge.A)(this,e),r=m_(this,e,[t]),r.shouldComponentUpdate=wo(r,{tree:function(o){return!(o===r.oldValidatedTree&&r.oldValidatedTree===r.validatedTree)}}),nt(r),r._updateActions(t),r.validatedTree=t.getMemoizedTree(t.config,t.tree,void 0,t.sanitizeTree),r.oldValidatedTree=r.validatedTree;var a=t.getBasicConfig(t.config);return t.onInit&&t.onInit(r.validatedTree,a,void 0,r.actions),r}return(0,Ue.A)(e,n),(0,ze.A)(e,[{key:"_updateActions",value:function(r){var a=r.config,i=r.dispatch;this.actions=og(Ws(Ws(Ws({},ng),i_),o_),a,i)}},{key:"onPropsChanged",value:function(r){var a=r.onChange,i=this.props.config,o=r.tree,u=this.props.tree,s=r.config;this.oldValidatedTree=this.validatedTree,this.validatedTree=o,i!==s&&(this._updateActions(r),this.validatedTree=r.getMemoizedTree(s,o,i));var l=!Hn(this.validatedTree,this.oldValidatedTree);if(l){var c=r.getBasicConfig(s);a&&a(this.validatedTree,c,r.__lastAction,this.actions)}}},{key:"render",value:function(){var r=this.props,a=r.config,i=r.renderBuilder,o=r.dispatch,u={tree:this.validatedTree,actions:this.actions,config:a,dispatch:o};return i(u)}}])}(C.Component);lg.propTypes={config:w().object.isRequired,onChange:w().func,onInit:w().func,renderBuilder:w().func,tree:w().any};var cg=So(function(n){return{tree:n.tree,__lastAction:n.__lastAction}},null,null,{context:bi})(lg);cg.displayName="ConnectedQuery";const y_=cg;function b_(n,e,t){return e=(0,ue.A)(e),(0,qe.A)(n,dg()?Reflect.construct(e,t||[],(0,ue.A)(n).constructor):e.apply(n,t))}function dg(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(dg=function(){return!!n})()}var fg=Oe.DefaultUtils.defaultRoot,O_=Oe.ConfigUtils.createConfigMemo,pg=function(n){function e(t,r){var a,i,o;(0,Ge.A)(this,e),o=b_(this,e,[t,r]),o.setLastTree=function(O){o.prevTree&&(o.prevprevTree=o.prevTree),o.prevTree=O},o.getConfig=function(){return o.config},o.shouldComponentUpdate=wo(o,{value:function(S,F){return!1}}),nt(o);var u=O_({reactIndex:(a=(i=o._reactInternals)===null||i===void 0?void 0:i.index)!==null&&a!==void 0?a:-1,maxSize:2,canCompile:!0}),s=u.getExtendedConfig,l=u.getBasicConfig,c=u.clearConfigMemo;o.getMemoizedConfig=s,o.getBasicConfig=l,o.clearConfigMemo=c,o.getMemoizedTree=p_();var d=o.getMemoizedConfig(t),f=d.settings.shouldCreateEmptyGroup,p=!f,v=fg(d,p),g=!!t.value,h=t.value||v,y=o.getMemoizedTree(d,h,void 0,g),m=yF(d,y,o.getMemoizedTree,o.setLastTree,o.getConfig),b=(0,bF.createStore)(m);return o.config=d,o.state={store:b},o.QueryWrapper=function(O){return d.settings.renderProvider(O,d.ctx)},o}return(0,Ue.A)(e,n),(0,ze.A)(e,[{key:"componentWillUnmount",value:function(){this.clearConfigMemo()}},{key:"onPropsChanged",value:function(r){var a=this.props,i=this.config,o=this.getMemoizedConfig(r),u=i!==o,s=this.state.store.getState().tree,l=!Hn(r.value,this.props.value)&&!Hn(r.value,s),c=l?r.value||fg(r):s,d=l&&!Hn(r.value,this.prevTree)&&!Hn(r.value,this.prevprevTree);if(this.sanitizeTree=d||u,u&&(a.settings.renderProvider!==r.settings.renderProvider&&(this.QueryWrapper=function(p){return o.settings.renderProvider(p,o.ctx)}),this.config=o),l||u){var f=this.getMemoizedTree(o,c,i,this.sanitizeTree);this.state.store.dispatch(ng.setTree(o,f))}}},{key:"render",value:function(){var r=this.props,a=r.renderBuilder,i=r.get_children,o=r.onChange,u=r.onInit,s=this.state.store,l=this.config,c=this.QueryWrapper;return C.createElement(c,{config:l},C.createElement(XF,{store:s,context:bi},C.createElement(y_,{config:l,getMemoizedTree:this.getMemoizedTree,getBasicConfig:this.getBasicConfig,sanitizeTree:this.sanitizeTree,onChange:o,onInit:u,renderBuilder:a||i})))}}])}(C.Component);pg.propTypes={conjunctions:w().object.isRequired,fields:w().object.isRequired,types:w().object.isRequired,operators:w().object.isRequired,widgets:w().object.isRequired,settings:w().object.isRequired,ctx:w().object.isRequired,onChange:w().func,onInit:w().func,renderBuilder:w().func,value:w().any};var S_=D(46942),Lt=D.n(S_);function F_(n,e,t){return e=(0,ue.A)(e),(0,qe.A)(n,vg()?Reflect.construct(e,t||[],(0,ue.A)(n).constructor):e.apply(n,t))}function vg(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(vg=function(){return!!n})()}var __=Oe.ConfigUtils.getFieldConfig,C_=function(e){var t;return t=function(r){function a(i){var o;return(0,Ge.A)(this,a),o=F_(this,a,[i]),o.dummyFn=function(){},o.removeSelf=function(){o.props.actions.removeRule(o.props.path)},o.setLock=function(){var u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;o.props.actions.setLock(o.props.path,u)},o.setField=function(u,s,l){o.props.actions.setField(o.props.path,u,s,l)},o.setFieldSrc=function(u){o.props.actions.setFieldSrc(o.props.path,u)},o.setOperator=function(u){o.props.actions.setOperator(o.props.path,u)},o.setOperatorOption=function(u,s){o.props.actions.setOperatorOption(o.props.path,u,s)},o.setValue=function(u,s,l,c,d){o.props.actions.setValue(o.props.path,u,s,l,c,d)},o.setValueSrc=function(u,s,l){o.props.actions.setValueSrc(o.props.path,u,s,l)},o.setFuncValue=function(u,s,l,c,d,f,p){o.props.actions.setFuncValue(o.props.path,u,s,l,c,d,f,p)},o.pureShouldComponentUpdate=La(o),o.dummyFn.isDummyFn=!0,o}return(0,Ue.A)(a,r),(0,ze.A)(a,[{key:"shouldComponentUpdate",value:function(o,u){var s=this.props,l=this.state,c=this.pureShouldComponentUpdate(o,u);if(c&&l==u&&s!=o){var d=o.dragging.id||s.dragging.id,f=d==o.id,p=[];for(var v in o){var g=o[v]!=s[v];v=="dragging"&&!f&&(g=!1),g&&p.push(v)}p.length||(c=!1)}return c}},{key:"render",value:function(){var o=this.props.dragging.id==this.props.id,u=__(this.props.config,this.props.field),s=this.props.fieldType||u?.type||null,l=this.props.config.settings.showErrorMessage,c=u&&u.type=="!struct",d=!o&&this.props.isDraggingTempo,f=this.props,p=f.valueError,v=f.fieldError,g=[v].concat((0,Q.A)(p?.toArray()||[])).filter(function(y){return!!y}).shift()||null,h=g!=null&&l;return C.createElement("div",{className:Lt()("group-or-rule-container","rule-container",h?"rule-with-error":null),"data-id":this.props.id},[o?C.createElement(e,{key:"dragging",id:this.props.id,groupId:this.props.groupId,lev:this.props.path.size-1,isDraggingMe:!0,isDraggingTempo:!0,dragging:this.props.dragging,setField:this.dummyFn,setFieldSrc:this.dummyFn,setFuncValue:this.dummyFn,setOperator:this.dummyFn,setOperatorOption:this.dummyFn,setLock:this.dummyFn,removeSelf:this.dummyFn,setValue:this.dummyFn,setValueSrc:this.dummyFn,selectedField:this.props.field||null,selectedFieldSrc:this.props.fieldSrc||"field",selectedFieldType:s,parentField:this.props.parentField||null,parentFieldPathSize:this.props.parentFieldPathSize,parentFieldCanReorder:this.props.parentFieldCanReorder,selectedOperator:this.props.operator||null,value:this.props.value||null,valueSrc:this.props.valueSrc||null,valueType:this.props.valueType||null,valueError:this.props.valueError||null,fieldError:this.props.fieldError||null,operatorOptions:this.props.operatorOptions,config:this.props.config,reordableNodesCnt:this.props.reordableNodesCnt,totalRulesCnt:this.props.totalRulesCnt,asyncListValues:this.props.asyncListValues,isLocked:this.props.isLocked,isTrueLocked:this.props.isTrueLocked,parentReordableNodesCnt:this.props.parentReordableNodesCnt}):null,C.createElement(e,{key:this.props.id,id:this.props.id,groupId:this.props.groupId,lev:this.props.path.size-1,isDraggingMe:o,isDraggingTempo:d,onDragStart:this.props.onDragStart,setLock:d?this.dummyFn:this.setLock,removeSelf:d?this.dummyFn:this.removeSelf,setField:d?this.dummyFn:this.setField,setFieldSrc:d?this.dummyFn:this.setFieldSrc,setFuncValue:d?this.dummyFn:this.setFuncValue,setOperator:d?this.dummyFn:this.setOperator,setOperatorOption:d?this.dummyFn:this.setOperatorOption,setValue:d?this.dummyFn:this.setValue,setValueSrc:d?this.dummyFn:this.setValueSrc,selectedField:this.props.field||null,selectedFieldSrc:this.props.fieldSrc||"field",selectedFieldType:s,parentField:this.props.parentField||null,parentFieldPathSize:this.props.parentFieldPathSize,parentFieldCanReorder:this.props.parentFieldCanReorder,selectedOperator:this.props.operator||null,value:this.props.value||null,valueSrc:this.props.valueSrc||null,valueType:this.props.valueType||null,valueError:this.props.valueError||null,fieldError:this.props.fieldError||null,operatorOptions:this.props.operatorOptions,config:this.props.config,reordableNodesCnt:this.props.reordableNodesCnt,totalRulesCnt:this.props.totalRulesCnt,asyncListValues:this.props.asyncListValues,isLocked:this.props.isLocked,isTrueLocked:this.props.isTrueLocked,parentReordableNodesCnt:this.props.parentReordableNodesCnt})])}}])}(C.Component),t.propTypes={id:w().string.isRequired,groupId:w().string,config:w().object.isRequired,path:w().any.isRequired,operator:w().string,field:w().any,fieldSrc:w().string,fieldType:w().string,actions:w().object.isRequired,onDragStart:w().func,value:w().any,valueSrc:w().any,asyncListValues:w().array,valueError:w().any,fieldError:w().string,operatorOptions:w().object,reordableNodesCnt:w().number,parentField:w().string,isLocked:w().bool,isTrueLocked:w().bool,dragging:w().object,isDraggingTempo:w().bool},t};const w_=function(n){var e=So(function(t){return{dragging:t.dragging}},null,null,{context:bi})(C_(n));return e.displayName="ConnectedRuleContainer",e};function A_(n,e,t){return e=(0,ue.A)(e),(0,qe.A)(n,gg()?Reflect.construct(e,t||[],(0,ue.A)(n).constructor):e.apply(n,t))}function gg(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(gg=function(){return!!n})()}var hg=Oe.clone,E_=Oe.TreeUtils.getFlatTree,Bs=!1,L_=function(e){var t,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;return t=function(a){function i(o){var u;return(0,Ge.A)(this,i),u=A_(this,i,[o]),u._getEventTarget=function(s,l){return s&&s.__mocked_window||document.body||window},u.onDragStart=function(s,l,c){var d=l.closest(".query-builder");u._isUsingLegacyReactDomRender===void 0&&(u._isUsingLegacyReactDomRender=ig(d)),document.body.classList.add("qb-dragging"),d.classList.add("qb-dragging");var f=d.closest(".query-builder-container")||d;f=u._getScrollParent(f)||document.body;var p=f.scrollTop,v=u._getDraggableNodeEl(d),g=u._getPlaceholderNodeEl(d),h=d.querySelectorAll(".group--children"),y=h.length?h[0]:null,m;y&&(m=window.getComputedStyle(y,null).getPropertyValue("padding-left"),m=parseInt(m));var b={id:s,x:l.offsetLeft,y:l.offsetTop,w:l.offsetWidth,h:l.offsetHeight,itemInfo:u.tree.items[s],paddingLeft:m},O={id:s,x:l.offsetLeft,y:l.offsetTop,scrollTop:p,clientX:c.clientX,clientY:c.clientY,itemInfo:hg(u.tree.items[s]),treeEl:d,treeElContainer:f},S={clientX:c.clientX,clientY:c.clientY},F=u._getEventTarget(c,O);u.eventTarget=F,F.addEventListener("mousemove",u.onDrag),F.addEventListener("mouseup",u.onDragEnd),u.props.setDragStart(O,b,S)},u.onDrag=function(s){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,c=Object.assign({},u.props.dragging),d=u.props.dragStart,f=c.paddingLeft,p=d.treeElContainer,v=p.scrollTop;if(c.itemInfo=u.tree.items[c.id],!!c.itemInfo){var g={clientX:s.clientX,clientY:s.clientY},h={clientX:d.clientX,clientY:d.clientY};if(s.__mock_dom){var y=d.treeEl,m=u._getDraggableNodeEl(y),b=u._getPlaceholderNodeEl(y);s.__mock_dom({treeEl:y,dragEl:m,plhEl:b})}if(!d.plX){var O=d.treeEl,S=u._getPlaceholderNodeEl(O);S&&(d.plX=S.getBoundingClientRect().left+window.scrollX,d.plY=S.getBoundingClientRect().top+window.scrollY)}var F=d.x,_=d.y,T=d.clientX,E=d.clientY,A=d.scrollTop,j={x:F+(s.clientX-T),y:_+(s.clientY-E)+(v-A)};c.x=j.x,c.y=j.y,c.paddingLeft=f,c.mousePos=g,c.startMousePos=h,u.props.setDragProgress(g,c);var R=l?u.handleDrag(c,s,r):!1;R||s.preventDefault&&s.preventDefault()}},u.onDragEnd=function(){var s=u.props.dragStart.treeEl;u.props.setDragEnd(),s.classList.remove("qb-dragging"),document.body.classList.remove("qb-dragging"),u._cacheEls={};var l=u.eventTarget||u._getEventTarget();l.removeEventListener("mousemove",u.onDrag),l.removeEventListener("mouseup",u.onDragEnd)},u.pureShouldComponentUpdate=La(u),nt(u),u.onPropsChanged(o),u}return(0,Ue.A)(i,a),(0,ze.A)(i,[{key:"onPropsChanged",value:function(u){this.tree=E_(u.tree,u.config)}},{key:"shouldComponentUpdate",value:function(u,s){var l=this.props,c=this.state,d=this.pureShouldComponentUpdate(u,s);if(d&&c==s&&l!=u){var f=[];for(var p in u){var v=u[p]!=l[p];v&&p!="dragging"&&p!="mousePos"&&f.push(p)}f.length||(d=!1)}return d}},{key:"componentDidUpdate",value:function(u,s){var l=this.props.dragging,c=this.props.dragStart;if(Bs=!1,c&&c.id&&(l.itemInfo=this.tree.items[l.id],l.itemInfo&&(l.itemInfo.index!=c.itemInfo.index||l.itemInfo.parent!=c.itemInfo.parent))){var d=c.treeEl,f=c.treeElContainer,p=this._getPlaceholderNodeEl(d,!0);if(p){var v=p.getBoundingClientRect().left+window.scrollX,g=p.getBoundingClientRect().top+window.scrollY,h=c.plX,y=c.plY,m=f.scrollTop;c.plX=v,c.plY=g,c.itemInfo=hg(l.itemInfo),c.y=p.offsetTop,c.x=p.offsetLeft,c.clientY+=g-y,c.clientX+=v-h,f!=document.body&&(c.scrollTop=m),this.onDrag(this.props.mousePos,!1)}}}},{key:"_getNodeElById",value:function(u,s){var l=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;if(s==null)return null;this._cacheEls||(this._cacheEls={});var c=this._cacheEls[s];return c&&document.contains(c)&&!l||(c=u.querySelector('.group-or-rule-container[data-id="'+s+'"]'),this._cacheEls[s]=c),c}},{key:"_getDraggableNodeEl",value:function(u){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;this._cacheEls||(this._cacheEls={});var l=this._cacheEls.draggable;if(l&&document.contains(l)&&!s)return l;var c=u.getElementsByClassName("qb-draggable");return l=c.length?c[0]:null,this._cacheEls.draggable=l,l}},{key:"_getPlaceholderNodeEl",value:function(u){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;this._cacheEls||(this._cacheEls={});var l=this._cacheEls.placeholder;if(l&&document.contains(l)&&!s)return l;var c=u.getElementsByClassName("qb-placeholder");return l=c.length?c[0]:null,this._cacheEls.placeholder=l,l}},{key:"_isScrollable",value:function(u){var s=window.getComputedStyle(u)["overflow-y"];return(s==="scroll"||s==="auto")&&u.scrollHeight>u.offsetHeight}},{key:"_getScrollParent",value:function(u){return u==null?null:u===document.body||this._isScrollable(u)?u:this._getScrollParent(u.parentNode)}},{key:"handleDrag",value:function(u,s,l){var c=this,d=!0,f=u.itemInfo,p=u.paddingLeft,v=null,g=this.props.dragStart.treeEl,h=u.id,y=this._getDraggableNodeEl(g),m=this._getPlaceholderNodeEl(g),b,O,S,F;if(y&&m){if(b=y.getBoundingClientRect(),O=m.getBoundingClientRect(),!O.width)return;var _={hrz:0,vrt:0};b.top<O.top?_.vrt=-1:b.bottom>O.bottom&&(_.vrt=1),b.left>O.left?_.hrz=1:b.left<O.left&&(_.hrz=-1),F=g.getBoundingClientRect();var T={x:F.left+(F.right-F.left)/2,y:_.vrt>=0?b.bottom:b.top},E;if(s.__mocked_hov_container)E=s.__mocked_hov_container;else{var A=document.elementFromPoint(T.x,T.y-1);if(E=A?A.closest(".group-or-rule-container"):null,!E&&A&&A.classList.contains("query-builder-container")){var j,R=A==null||(j=A.firstChild)===null||j===void 0?void 0:j.firstChild;R&&R.classList.contains("group-or-rule-container")&&(E=R)}}if(!E)f_.log("out of tree bounds!");else{var L=E.classList.contains("group-container"),N=E.getAttribute("data-id"),I=E,P=!1,x=!1;if(I){S=I.getBoundingClientRect();var k=S.bottom-S.top,V=this.tree.items[N];if(!V)throw new Error("There is an issue with rendering. If you use Next.js, please check getServerSideProps() method.");var G=null,$=null,W=null,q=null;if(_.vrt==0)W=f,$=m,$&&(G=$.getBoundingClientRect());else if(L){if(_.vrt>0){var J=E.getElementsByClassName("group--header"),K=J.length?J[0]:null;if(K){var U=K.getBoundingClientRect(),X=U.bottom-U.top,Y=b.bottom-U.top>X*3/4;Y&&V.top>u.itemInfo.top&&(W=V,G=U,$=K,x=!0)}}else if(_.vrt<0&&V.lev>=f.lev){var ae=S.bottom-b.top>=2;ae&&V.top<u.itemInfo.top&&(W=V,G=S,$=I,P=!0)}if(!x&&!P||d){var ge=_.vrt<0?S.bottom-b.top>k-5:b.bottom-S.top>k-5;ge&&(!x&&!P&&(W=V,G=S,$=I),d&&(q=V))}}else{var se=_.vrt<0?S.bottom-b.top>k/2:b.bottom-S.top>k/2;se&&(W=V,G=S,$=I)}var ce=W&&W.id==h;if(G){var de=b.left-F.left,ne=G.left-F.left,ve=ne/p,ye=Math.max(0,Math.round(de/p)),Ce=[],fe=[];if(!ce){if(L&&(P?Ce.push([qn,W,W.lev+1]):x&&Ce.push([Ea,W,W.lev+1]),d&&q)){var ar=q.lev==0,Le=q.type=="case_group"&&f.type!="case_group",Me=q.prev&&this.tree.items[q.prev].caseId,Ae=q.next&&this.tree.items[q.next].caseId;f.caseId==Me&&(Me=null),f.caseId==Ae&&(Ae=null);var Tr=Me&&this.tree.items[Me],Dr=Ae&&this.tree.items[Ae];_.vrt>0?ar?fe.push([qn,q,q.lev+1]):Le&&Dr?fe.push([Ea,Dr,Dr.lev+1]):fe.push([Fo,q,q.lev]):_.vrt<0&&(ar?fe.push([Ea,q,q.lev+1]):Le&&Tr?fe.push([qn,Tr,Tr.lev+1]):fe.push([_o,q,q.lev]))}!P&&!x&&(_.vrt<0?Ce.push([_o,W,W.lev]):_.vrt>0&&Ce.push([Fo,W,W.lev]))}var xr=function(Vr){var Pr=Vr[1],Sr=f.caseId?c.tree.items[f.caseId]:null,Jr=Pr.caseId?c.tree.items[Pr.caseId]:null;return[].concat((0,Q.A)(Vr),[Sr,Jr])};Ce=Ce.map(xr),fe=fe.map(xr),Ce=Ce.filter(function(Pe){var Vr=Pe[0],Pr=Pe[1];if((Vr==_o||Vr==Fo)&&Pr.parent==null||Pr.collapsed&&(Vr==qn||Vr==Ea))return!1;var Sr=Pr.id==f.id;if(!Sr){for(var Jr=Pr;Jr.parent;)if(Jr=c.tree.items[Jr.parent],Jr.id==f.id){Sr=!0;break}}return!Sr}).map(function(Pe){var Vr=Pe[0],Pr=Pe[1],Sr=Pe[2],Jr=Pe[3],Ln=Pe[4],Yr=null;return Vr==qn||Vr==Ea?Yr=Pr:Yr=c.tree.items[Pr.parent],Yr&&Yr.parent==null&&(Yr=null),Pe[5]=Yr,Pe});var $r=null,je=Ce.filter(function(Pe){return c.canMove(f,Pe[1],Pe[0],Pe[3],Pe[4],Pe[5],l)});d&&je.length==0&&fe.length>0&&(je=fe.filter(function(Pe){return c.canMove(f,Pe[1],Pe[0],Pe[3],Pe[4],Pe[5],l)}));var yr=je.map(function(Pe){return Pe[2]}),Gr=f.lev,pr=yr.concat(Gr),zr=null;pr.indexOf(ye)!=-1?zr=ye:ye>Math.max.apply(Math,(0,Q.A)(pr))?zr=Math.max.apply(Math,(0,Q.A)(pr)):ye<Math.min.apply(Math,(0,Q.A)(pr))&&(zr=Math.min.apply(Math,(0,Q.A)(pr))),$r=je.find(function(Pe){return Pe[2]==zr}),!ce&&!$r&&je.length&&($r=je[0]),v=$r}}}}return v?(this.move(f,v[1],v[0],v[3]),!0):!1}},{key:"canMove",value:function(u,s,l,c,d,f,p){if(!u||!s||u.id===s.id)return!1;var v=this.props.config.settings,g=v.canRegroup,h=v.canRegroupCases,y=v.maxNesting,m=v.maxNumberOfRules,b=v.canLeaveEmptyCase,O=f?f.nextAtomicLev:s.atomicLev,S=O+(u.closestRuleGroupId?0:u.depth||(u.type=="group"?1:0)),F=l==_o||l==Fo,_=l==Ea||l==qn,T=F&&s.lev==1||_&&s.lev==0,E=u.parent!=s.parent,A=_||E,j=u.type=="rule_group"||!!u.closestRuleGroupId||s.type=="rule_group"||!!s.closestRuleGroupId,R=_&&s.type=="rule_group"?s.id:s.closestRuleGroupId,L=_&&s.type=="rule_group"?s.maxNesting:s.closestRuleGroupMaxNesting,N=(_&&s.type=="rule_group"?s.canRegroup:s.closestRuleGroupCanRegroup)!=!1,I=_&&s.type=="rule_group"?s.lev:s.closestRuleGroupLev,P=(f?f.lev+1:s.lev)+(u.depth||(u.type=="group"?1:0))-(I||0),x=j&&u.closestRuleGroupId!=R,k=u.type=="case_group"&&!T||u.type!="case_group"&&s.type=="case_group"&&F||u.type!="case_group"&&s.type=="switch_group"||!h&&u.caseId!=s.caseId,V=k||x,G=s.isLocked||u.isLocked||f&&f.isLocked;if(y&&S>y||L&&P>L||A&&(!g||V||G)||j&&A&&!N)return!1;if(u.type!="case_group"&&u.caseId!=s.caseId){var $=c?c._height==2:!1,W=d?d.atomicRulesCountInCase+1:0;if(m&&W>m||$&&!b)return!1}if(u.type=="case_group"&&(u.isDefaultCase||s.isDefaultCase||s.type=="switch_group"&&l==qn))return!1;var q=!0;return p&&(q=p(u.node.toJS(),s.node.toJS(),l,f?f.node.toJS():null)),q}},{key:"move",value:function(u,s,l,c){this._isUsingLegacyReactDomRender||(Bs=!0),this.props.actions.moveItem(u.path,s.path,l)}},{key:"render",value:function(){return C.createElement(e,(0,Te.A)({},this.props,{onDragStart:this.onDragStart}))}}])}(C.Component),t.propTypes={tree:w().any.isRequired,actions:w().object.isRequired},t};const T_=function(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,t=So(function(r){return{dragging:r.dragging,dragStart:r.dragStart,mousePos:r.mousePos}},{setDragStart:n_,setDragProgress:t_,setDragEnd:a_},null,{context:bi})(L_(n,e));return t.displayName="ConnectedSortableContainer",t};var j_=["isDraggingTempo","isDraggingMe","dragging"];function R_(n,e,t){return e=(0,ue.A)(e),(0,qe.A)(n,mg()?Reflect.construct(e,t||[],(0,ue.A)(n).constructor):e.apply(n,t))}function mg(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(mg=function(){return!!n})()}const Ta=function(n){return function(e){var t;return t=function(r){function a(i){var o;return(0,Ge.A)(this,a),o=R_(this,a,[i]),o.handleDraggerMouseDown=function(u){var s=o.props.id,l=o.wrapper.current;o.props.onDragStart&&o.props.onDragStart(s,l,u)},o.wrapper=C.createRef(),o}return(0,Ue.A)(a,r),(0,ze.A)(a,[{key:"render",value:function(){var o=this.props,u=o.isDraggingTempo,s=o.isDraggingMe,l=o.dragging,c=(0,Wn.A)(o,j_),d=c.isTrueLocked,f={};s&&u&&(Bs||(f={top:l.y,left:l.x,width:l.w}));var p=Lt()(n,"group-or-rule",s&&u?"qb-draggable":null,s&&!u?"qb-placeholder":null,d?"locked":null);return C.createElement("div",{className:p,style:f,ref:this.wrapper,"data-id":this.props.id},C.createElement(e,(0,Te.A)({handleDraggerMouseDown:this.handleDraggerMouseDown,isDraggingMe:s,isDraggingTempo:u},c)))}}])}(C.PureComponent),t.propTypes={isDraggingTempo:w().bool,isDraggingMe:w().bool,onDragStart:w().func,dragging:w().object,isLocked:w().bool,isTrueLocked:w().bool},t}};var x_=D(95950),ja=D.n(x_),P_=D(71086),I_=D.n(P_);function yg(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),t.push.apply(t,r)}return t}function D_(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?yg(Object(t),!0).forEach(function(r){(0,z.A)(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):yg(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function V_(n,e,t){return e=(0,ue.A)(e),(0,qe.A)(n,bg()?Reflect.construct(e,t||[],(0,ue.A)(n).constructor):e.apply(n,t))}function bg(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(bg=function(){return!!n})()}var Og=Oe.ConfigUtils,N_=Og.getFieldConfig,k_=Og.getOperatorConfig,Sg=function(n){function e(t){var r;return(0,Ge.A)(this,e),r=V_(this,e,[t]),r.shouldComponentUpdate=wo(r,{selectedField:function(i,o){return!1}}),nt(r),r.onPropsChanged(t),r}return(0,Ue.A)(e,n),(0,ze.A)(e,[{key:"onPropsChanged",value:function(r){var a=this.props,i=["config","selectedField","selectedFieldSrc","selectedFieldType","selectedOperator"],o=!this.meta||i.map(function(u){return r[u]!==a[u]}).filter(function(u){return u}).length>0;o&&(this.meta=this.getMeta(r))}},{key:"getMeta",value:function(r){var a,i=r.config,o=r.selectedField,u=r.selectedFieldType,s=r.selectedOperator,l=N_(i,o),c=(0,Q.A)(l?.operators||((a=i.types[u])===null||a===void 0?void 0:a.operators)||[]);!o&&!c.includes(s)&&c.push(s);var d=bo()(I_()(i.operators,function(O,S){return c?.indexOf(S)!==-1}),function(O,S){return k_(i,S,o)}),f=this.buildOptions(i,d,c),p=d[s]||{},v=this.props.config.settings.operatorPlaceholder,g=s,h=g?[g]:null,y=h,m=p.label,b=p.label2||p.tooltip;return{placeholder:v,items:f,selectedKey:g,selectedKeys:h,selectedPath:y,selectedLabel:m,selectedAltLabel:b,selectedOpts:p,fieldConfig:l}}},{key:"buildOptions",value:function(r,a,i){return!a||!i?null:ja()(a).sort(function(o,u){return i.indexOf(o)-i.indexOf(u)}).map(function(o){var u=a[o],s=u.label,l=u.label2,c=u.tooltip;return{key:o,path:o,label:s,altLabel:l,tooltip:c}})}},{key:"render",value:function(){var r=this.props,a=r.config,i=r.customProps,o=r.setOperator,u=r.readonly,s=r.id,l=r.groupId,c=a.settings.renderOperator,d=D_({id:s,groupId:l,config:a,customProps:i,readonly:u,setField:o},this.meta);return d.items?c(d,a.ctx):null}}])}(C.Component);Sg.propTypes={id:w().string,groupId:w().string,config:w().object.isRequired,selectedField:w().any,selectedFieldId:w().string,selectedFieldType:w().string,selectedFieldSrc:w().string,selectedOperator:w().string,readonly:w().bool,customProps:w().object,setOperator:w().func.isRequired};var M_=["children"],Er=function(e){var t=e.children,r=(0,Wn.A)(e,M_);return C.createElement("div",r,t)},at=function(){},Fg=function(){return C.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"gray",width:"18px",height:"18px"},C.createElement("path",{d:"M0 0h24v24H0V0z",fill:"none"}),C.createElement("path",{d:"M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"}))},Ra=function(e){return function(t){var r=t.config.settings.useConfirm,a=r?r.call(t.config.ctx,t.config.ctx):null;return C.createElement(e,(0,Te.A)({},t,{confirmFn:a}))}},_g=function(e){var t=e.id,r=e.isLHS,a=e.delta,i=e.parentFuncs;return[t,r?"L":"R",r?-1:a||0,(i||[]).map(function(o){var u=(0,ie.A)(o,2),s=u[0],l=u[1];return"".concat(s,"(").concat(l,")")}).join("/")].join(":")},it=function(e,t){var r;return typeof t=="function"?(r=function(i){return t?.(i,e.ctx)},r.displayName=t.name):r=t,r};function $_(n,e,t){return e=(0,ue.A)(e),(0,qe.A)(n,Cg()?Reflect.construct(e,t||[],(0,ue.A)(n).constructor):e.apply(n,t))}function Cg(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Cg=function(){return!!n})()}var wg=function(n){function e(){return(0,Ge.A)(this,e),$_(this,e,arguments)}return(0,Ue.A)(e,n),(0,ze.A)(e,[{key:"render",value:function(){var r=this.props,a=r.config,i=r.selectedField,o=r.selectedFieldSrc,u=r.selectedFieldType,s=r.selectedOperator,l=r.setOperator,c=r.selectedFieldId,d=r.showOperator,f=r.showOperatorLabel,p=r.selectedFieldWidgetConfig,v=r.readonly,g=r.id,h=r.groupId,y=d&&C.createElement(Er,{key:"operators-for-"+c,className:"rule--operator"},a.settings.showLabels&&C.createElement("label",{className:"rule--label"},a.settings.operatorLabel),C.createElement(Sg,{key:"operator",config:a,selectedField:i,selectedFieldSrc:o,selectedFieldType:u,selectedFieldId:c,selectedOperator:s,setOperator:l,customProps:a.settings.customOperatorSelectProps,readonly:v,id:g,groupId:h})),m=f&&C.createElement(Er,{key:"operators-for-"+c,className:"rule--operator"},C.createElement("div",{className:"rule--operator-wrapper"},a.settings.showLabels?C.createElement("label",{className:"rule--label"},"\xA0"):null,C.createElement("div",{className:"rule--operator-text-wrapper"},C.createElement("span",{className:"rule--operator-text"},p.operatorInlineLabel))));return[y,m]}}])}(C.PureComponent);function Ag(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),t.push.apply(t,r)}return t}function G_(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Ag(Object(t),!0).forEach(function(r){(0,z.A)(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Ag(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function z_(n,e,t){return e=(0,ue.A)(e),(0,qe.A)(n,Eg()?Reflect.construct(e,t||[],(0,ue.A)(n).constructor):e.apply(n,t))}function Eg(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Eg=function(){return!!n})()}var Lg=Oe.RuleUtils.getFieldPathLabels,qs=Oe.ConfigUtils,Tg=qs.getFieldConfig,jg=qs.getFieldParts,Rg=qs.getFieldPathParts,xg=function(n){function e(t){var r;return(0,Ge.A)(this,e),r=z_(this,e,[t]),r.setField=function(a,i){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},u=r.props.id;if(!o.widgetId){var s=[u,"L",-1].join(":");o.widgetId=s}r.props.setField(a,i,o)},nt(r),r.onPropsChanged(t),r}return(0,Ue.A)(e,n),(0,ze.A)(e,[{key:"onPropsChanged",value:function(r){var a=this.props,i=["selectedField","selectedFieldSrc","selectedFieldType","config","parentField"],o=!this.meta||i.map(function(u){return r[u]!==a[u]}).filter(function(u){return u}).length>0;o&&(this.meta=this.getMeta(r))}},{key:"getMeta",value:function(r){var a=r.selectedField,i=r.selectedFieldType,o=r.config,u=r.parentField,s=a,l=o.settings,c=l.maxLabelsLength,d=l.fieldSeparatorDisplay,f=l.fieldPlaceholder,p=l.fieldSeparator,v=!!a,g=v?null:Co(f,c),h=v?Tg(o,s):null,y=h||{},m=Rg(s,o),b=Rg(s,o,!0),O=this.getFieldLabel(h,s,o),S=Lg(s,o),F=S?S.join(d):null;(F==O||u)&&(F=null);var _=y.label2||y.tooltip,T=jg(u,o),E=u?Tg(o,u):null,A=u?E&&E.subfields:o.fields,j=!v&&i,R=this.buildOptions(T,o,A,j,T),L=j?"Please select field":null;return s&&(0,We.A)(s)==="object"&&(s=void 0),{placeholder:g,items:R,parentField:u,selectedKey:s,selectedKeys:m,selectedPath:b,selectedLabel:O,selectedOpts:y,selectedAltLabel:_,selectedFullLabel:F,errorText:L}}},{key:"getFieldLabel",value:function(r,a,i){if(!a)return null;var o=i.settings.maxLabelsLength,u=jg(a,i),s=r?.label||Ji()(u);return s=Co(s,o),s}},{key:"buildOptions",value:function(r,a,i){var o=this,u=arguments.length>3&&arguments[3]!==void 0?arguments[3]:void 0,s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:null,l=arguments.length>5&&arguments[5]!==void 0?arguments[5]:null;if(!i)return null;var c=a.settings,d=c.fieldSeparator,f=c.fieldSeparatorDisplay,p=s!=null&&s.length?s.join(d)+d:"",v=function g(h){return Object.keys(h||{}).reduce(function(y,m){var b=h[m];return b.type==="!struct"?y+g(b.subfields):y+(b.type===u?1:0)},0)};return ja()(i).map(function(g){var h=[].concat((0,Q.A)(s??[]),[g]),y=i[g],m=o.getFieldLabel(y,h,a),b=Lg(h,a),O=b.join(f);(O==m||r!=null&&r.length)&&(O=null);var S=y.label2,F=y.tooltip,_=y.disabled;if(!y.hideForSelect)if(y.type=="!struct"){var T=o.buildOptions(r,a,y.subfields,u,h,{label:m,tooltip:F}),E=v(y.subfields)>0;return{disabled:_,key:g,path:p+g,label:m,fullLabel:O,altLabel:S,tooltip:F,items:T,matchesType:E}}else{var A=u!==void 0?y.type===u:void 0;return{disabled:_,key:g,path:p+g,label:m,fullLabel:O,altLabel:S,tooltip:F,grouplabel:l?.label,group:l,matchesType:A}}}).filter(function(g){return!!g})}},{key:"render",value:function(){var r=this.props,a=r.config,i=r.customProps,o=r.setFieldSrc,u=r.readonly,s=r.id,l=r.groupId,c=a.settings.renderField,d=G_({id:s,groupId:l,config:a,customProps:i,readonly:u,setField:this.setField,setFieldSrc:o},this.meta);return c(d,a.ctx)}}])}(C.Component);xg.propTypes={id:w().string,groupId:w().string,config:w().object.isRequired,selectedField:w().any,selectedFieldSrc:w().string,selectedFieldType:w().string,parentField:w().string,customProps:w().object,readonly:w().bool,setField:w().func.isRequired,setFieldSrc:w().func};function Pg(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),t.push.apply(t,r)}return t}function U_(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Pg(Object(t),!0).forEach(function(r){(0,z.A)(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Pg(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function W_(n,e,t){return e=(0,ue.A)(e),(0,qe.A)(n,Ig()?Reflect.construct(e,t||[],(0,ue.A)(n).constructor):e.apply(n,t))}function Ig(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Ig=function(){return!!n})()}var B_=Oe.clone,Ao=Oe.ConfigUtils,q_=Ao.getFieldConfig,Dg=Ao.getFuncConfig,H_=Ao.getFieldParts,Vg=Ao.getFieldPathParts,Ng=Oe.RuleUtils,kg=Ng.getFuncPathLabels,J_=Ng.getWidgetForFieldOp,Y_=Oe.OtherUtils.shallowEqual,Mg=function(n){function e(t){var r;return(0,Ge.A)(this,e),r=W_(this,e,[t]),nt(r),r.onPropsChanged(t),r}return(0,Ue.A)(e,n),(0,ze.A)(e,[{key:"onPropsChanged",value:function(r){var a=this.props,i=["config","field","fieldType","fieldSrc","operator","isFuncArg","isLHS","parentFuncs"],o=["config","field","fieldType","fieldSrc","value","isLHS"],u=!this.items||i.map(function(l){return l==="parentFuncs"?!Y_(r[l],a[l],!0):r[l]!==a[l]}).filter(function(l){return l}).length>0,s=!this.meta||o.map(function(l){return r[l]!==a[l]}).filter(function(l){return l}).length>0;s&&(this.meta=this.getMeta(r)),u&&(this.items=this.getItems(r,this.meta))}},{key:"getItems",value:function(r,a){var i=r.config,o=r.field,u=r.fieldType,s=r.isLHS,l=r.operator,c=r.parentFuncs,d=r.fieldDefinition,f=r.isFuncArg,p=a.lookingForFieldType,v=i.settings.canUseFuncForField,g=this.filterFuncs(i,i.funcs,o,u,s,l,v,c,f,d),h=this.buildOptions(i,g,p);return h}},{key:"getMeta",value:function(r){var a=r.config,i=r._field,o=r.fieldType,u=r.value,s=r.isLHS,l=r.isFuncArg,c=a.settings,d=c.funcPlaceholder,f=c.fieldSeparatorDisplay,p=u,v=!!u,g=v?null:d,h=v?Dg(a,p):null,y=h||{},m=Vg(p,a),b=Vg(p,a,!0),O=this.getFuncLabel(h,p,a),S=kg(p,a),F=S?S.join(f):null;F==O&&(F=null);var _=s&&!l,T=_&&!v&&o,E=T?"Please select function":null;return{placeholder:g,selectedKey:p,selectedKeys:m,selectedPath:b,selectedLabel:O,selectedOpts:y,selectedFullLabel:F,errorText:E,lookingForFieldType:T}}},{key:"filterFuncs",value:function(r,a,i,o,u,s,l,c,d,f){a=B_(a);var p=r.settings.fieldSeparator,v=q_(r,i),g=!1,h,y=v,m=J_(r,i,s,"value"),b=m&&r.widgets[m];d?(y=f,h=f?.type):g&&b?h=b.type:v?h=v.type:u||(h=o);function O(S,F){for(var _ in S){var T=S[_].subfields,E=(F||[]).concat(_),A=E.join(p),j=Dg(r,A);if(j.type=="!struct")O(T,E)==0&&delete S[_];else{var R,L=!h||j.returnType==h;(R=y)!==null&&R!==void 0&&R.funcs&&(L=L&&y.funcs.includes(A)),l&&(L=L&&l(i,v,A,j,s)),!j.allowSelfNesting&&c&&c.map(function(N){var I=(0,ie.A)(N,2),P=I[0],x=I[1];return P}).includes(A)&&(L=!1),L||delete S[_]}}return ja()(S).length}return O(a,[]),a}},{key:"buildOptions",value:function(r,a){var i=this,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0,u=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null,s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:null;if(!a)return null;var l=r.settings,c=l.fieldSeparator,d=l.fieldSeparatorDisplay,f=u!=null&&u.length?u.join(c)+c:"",p=function v(g){return Object.keys(g||{}).reduce(function(h,y){var m=g[y];return m.type==="!struct"?h+v(m.subfields):h+(m.type===o?1:0)},0)};return ja()(a).map(function(v){var g=[].concat((0,Q.A)(u??[]),[v]),h=a[v],y=i.getFuncLabel(h,g,r),m=kg(g,r),b=m.join(d);b==y&&(b=null);var O=h.tooltip;if(h.type=="!struct"){var S=i.buildOptions(r,h.subfields,o,g,{label:y,tooltip:O}),F=p(h.subfields)>0;return{key:v,path:f+v,label:y,fullLabel:b,tooltip:O,items:S,matchesType:F}}else{var _=o!==void 0?h.returnType===o:void 0;return{key:v,path:f+v,label:y,fullLabel:b,tooltip:O,grouplabel:s?.label,group:s,matchesType:_}}})}},{key:"getFuncLabel",value:function(r,a,i){if(!a)return null;var o=i.settings.maxLabelsLength,u=H_(a,i),s=r?.label||Ji()(u);return s=Co(s,o),s}},{key:"render",value:function(){var r=this.props,a=r.config,i=r.customProps,o=r.setValue,u=r.readonly,s=r.id,l=r.groupId,c=a.settings.renderFunc,d=U_({config:a,customProps:i,readonly:u,setField:o,items:this.items,id:s,groupId:l},this.meta);return c(d,a.ctx)}}])}(C.Component);Mg.propTypes={id:w().string,groupId:w().string,config:w().object.isRequired,field:w().any,fieldType:w().string,fieldSrc:w().string,operator:w().string,customProps:w().object,value:w().string,setValue:w().func.isRequired,readonly:w().bool,parentFuncs:w().array,fieldDefinition:w().object,isFuncArg:w().bool,isLHS:w().bool};var K_=D(23181),Hs=D.n(K_),Q_=["widgetFactory"],X_=["factory"];function $g(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),t.push.apply(t,r)}return t}function Js(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?$g(Object(t),!0).forEach(function(r){(0,z.A)(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):$g(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}var Gg=Oe.ListUtils.getTitleInListValues,Z_=Oe.ConfigUtils._widgetDefKeysToOmit,zg=Oe.TreeUtils,eC=zg._fixImmutableValue,rC=zg.isImmutable,Ug=(0,C.memo)(function(n){var e=n.widgetFactory,t=(0,Wn.A)(n,Q_),r=t.config,a=t.isFuncArg,i=t.fieldDefinition,o=i||{},u=o.fieldSettings,s=o.defaultValue,l=o.valueSources,c=a&&l?.length==1&&l?.[0]==="const",d=u?.treeValues||u?.listValues;return c&&s?typeof s=="boolean"?s?t.labelYes||"YES":t.labelNo||"NO":d?Array.isArray(s)?s.map(function(f){return Gg(d,f)||f}).join(", "):Gg(d,s)||s:""+s:e?e(t,r.ctx):"?"});Ug.displayName="WidgetFactoryMemo";var Wg=function(e){var t=e.delta,r=e.isFuncArg,a=e.valueSrc,i=e.value,o=e.valueError,u=e.fieldError,s=e.asyncListValues,l=e.isSpecialRange,c=e.fieldDefinition,d=e.widget,f=e.widgetDefinition,p=e.widgetValueLabel,v=e.valueLabels,g=e.textSeparators,h=e.setValue,y=e.setFuncValue,m=e.config,b=e.field,O=e.fieldSrc,S=e.fieldPath,F=e.fieldType,_=e.isLHS,T=e.operator,E=e.readonly,A=e.parentField,j=e.parentFuncs,R=e.id,L=e.groupId,N=e.widgetId,I=f.factory,P=(0,Wn.A)(f,X_),x=i?i.map(function(Y){return eC(Y)}):void 0,k=(0,C.useMemo)(function(){if(l){var Y=[x?.get(0),x?.get(1)];return Y[0]===void 0&&Y[1]===void 0&&(Y=void 0),Y}return x?.get(t)},[l,i]),V=(0,C.useMemo)(function(){return o?l?[o.get(0),o.get(1),o.get(2)]:o?.get(t):null},[l,i]),G=_?u:V,$=c||{},W=$.fieldSettings,q=p.label,J=p.placeholder,K=v?v.placeholder:null,U=rC(b)?null:b,X=Yi()(Js(Js(Js({},P),W),{},{config:m,field:U,fieldPath:S,fieldSrc:O,fieldType:F,isLHS:_,parentField:A,parentFuncs:j,fieldDefinition:c,operator:T,delta:t,isSpecialRange:l,isFuncArg:r,value:k,valueSrc:a,valueError:V,fieldError:u,errorMessage:G,label:q,placeholder:J,placeholders:K,textSeparators:g,setValue:h,setFuncValue:y,readonly:E,asyncListValues:s,id:R,groupId:L,widgetId:N,widgetFactory:I,widget:d}),[].concat((0,Q.A)(Z_),["toJS"]));return C.createElement(Ug,(0,Te.A)({widgetFactory:I},X))};Wg.displayName="WidgetFactory";const tC=Wg;function nC(n,e,t){return e=(0,ue.A)(e),(0,qe.A)(n,Bg()?Reflect.construct(e,t||[],(0,ue.A)(n).constructor):e.apply(n,t))}function Bg(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Bg=function(){return!!n})()}var Ys=Oe.ConfigUtils,aC=Ys.getFieldConfig,iC=Ys.getOperatorConfig,qg=Ys.getFieldWidgetConfig,Ks=Oe.RuleUtils,oC=Ks.getValueSourcesForFieldOp,Hg=Ks.getWidgetForFieldOp,Eo=Ks.getValueLabel,Jg=Oe.DefaultUtils.createListWithOneElement,uC=Oe.OtherUtils.shallowEqual,yE=Oe.TreeUtils.isImmutable,sC={cardinality:1},Oi=function(n){function e(t){var r;return(0,Ge.A)(this,e),r=nC(this,e,[t]),r._setValue=function(a,i,o,u,s,l){var c=arguments.length>6&&arguments[6]!==void 0?arguments[6]:{};if(c.widgetId||(c.widgetId=u),a&&Array.isArray(s)){var d=[r.props.value.get(0),r.props.value.get(1)];d[0]!=s[0]&&r.props.setValue(0,s[0],o,l,c),d[1]!=s[1]&&r.props.setValue(1,s[1],o,l,c)}else r.props.setValue(i,s,o,l,c)},r._setValueSrc=function(a,i,o){var u={widgetId:i};r.props.setValueSrc(a,o,u)},r.renderWidget=function(a,i,o){var u=o.config,s=o.isFuncArg,l=o.leftField,c=o.operator,d=o.value,f=o.valueError,p=o.fieldError,v=o.readonly,g=o.parentField,h=o.parentFuncs,y=o.id,m=o.groupId,b=o.fieldSrc,O=o.fieldType,S=o.isLHS,F=o.setFuncValue,_=u.settings,T=i.widgets,E=i.iValues,A=i.aField,j=i.valueSources,R=s?E:d,L=s?l:A,N=T[a],I=N.valueSrc,P=N.valueLabel,x=N.widgetId,k=j.length>1&&!v,V=_.showLabels?C.createElement("label",{key:"label-"+x,className:"rule--label"},P.label):null;return C.createElement("div",{key:"wrapper-"+x,className:Lt()(I==="func"?"widget--func":"widget--widget",k?"widget--has-valuesrcs":"widget--has-no-valuesrcs")},I==="func"?null:V,C.createElement(tC,(0,Te.A)({key:x,id:y,groupId:m,widgetId:x,valueSrc:I,delta:a,value:R,valueError:f,fieldError:p,isFuncArg:s,isLHS:S},Ht()(i,["isSpecialRange","fieldDefinition","asyncListValues"]),Ht()(T[a],["widget","widgetDefinition","widgetValueLabel","valueLabels","textSeparators","setValue"]),{setFuncValue:F,config:u,field:L,fieldSrc:b,fieldType:O,parentField:g,parentFuncs:h,operator:c,readonly:v})))},r.renderValueSources=function(a,i,o){var u=o.config,s=o.isFuncArg,l=o.leftField,c=o.operator,d=o.readonly,f=u.settings,p=i.valueSources,v=i.widgets,g=i.aField,h=i.valueSourcesOptions,y=s?l:g,m=v[a],b=m.valueSrc,O=m.setValueSrc,S=r.ValueSources,F=f.showLabels?C.createElement("label",{className:"rule--label"},"\xA0"):null;return p.length>1&&!d&&C.createElement("div",{key:"wrapper-valuesrc-"+a,className:"widget--valuesrc"},F,C.createElement(S,{key:"valuesrc-"+a,delta:a,valueSources:h,valueSrc:b,config:u,field:y,operator:c,setValueSrc:O,readonly:d,title:f.valueSourcesPopupTitle}))},r.renderSep=function(a,i,o){var u=o.config,s=i.widgets,l=u.settings,c=s[a].sepText,d=l.showLabels?C.createElement("label",{className:"rule--label"},"\xA0"):null;return c&&C.createElement("div",{key:"widget-separators-"+a,className:Lt()("widget--sep",a==0&&"widget--sep-first")},d,C.createElement("span",null,c))},r.renderWidgetDelta=function(a){var i=r.renderSep(a,r.meta,r.props),o=r.renderValueSources(a,r.meta,r.props),u=r.renderWidget(a,r.meta,r.props);return[i,o,u]},nt(r),r.onPropsChanged(t),r}return(0,Ue.A)(e,n),(0,ze.A)(e,[{key:"onPropsChanged",value:function(r){var a=this.props,i=!this.ValueSources||a?.config!==r?.config,o=["config","id","parentFuncs","field","fieldId","fieldSrc","fieldType","fieldFunc","fieldArg","leftField","operator","valueSrc","asyncListValues","isLHS","isFuncArg","isForRuleGroup","isCaseValue","value"],u=o.filter(function(d){return d==="parentFuncs"?!uC(r[d],a[d],!0):d==="field"?r.fieldId!==a.fieldId:r[d]!==a[d]}),s=!this.meta||u.length>0;if(s&&(this.meta=this.getMeta(r,u)),i){var l=r.config,c=l.settings.renderValueSources;this.ValueSources=it(l,c)}}},{key:"getMeta",value:function(r){var a,i,o,u,s=this,l=r.config,c=r.field,d=r.fieldSrc,f=r.fieldType,p=r.fieldFunc,v=r.fieldArg,g=r.operator,h=r.valueSrc,y=r.value,m=r.isForRuleGroup,b=r.isCaseValue,O=r.isFuncArg,S=r.leftField,F=r.asyncListValues,_=r.parentFuncs,T=r.isLHS,E=r.id,A=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],j=l.settings.valueSourcesInfo,R=O?{func:p,arg:v}:c,L=!c&&f,N=h,I=y;(O||m||b)&&(N=Jg(h),I=Jg(y));var P=aC(l,R);!P&&L&&(P=l.types[f]);var x=Hg(l,R,g);if(!x&&L){var k;x=(k=l.types[f])===null||k===void 0?void 0:k.mainWidget}var V=O?sC:iC(l,g,R);if((P==null||V==null)&&!b)return null;var G=V?.isSpecialRange,$=G&&(((a=N)===null||a===void 0?void 0:a.get(0))==="field"||((i=N)===null||i===void 0?void 0:i.get(1))==="field"),W=G&&!$,q=W?1:u_(V);if(q===0)return null;var J=(o=this.meta)===null||o===void 0?void 0:o.valueSources,K=(u=this.meta)===null||u===void 0?void 0:u.valueSourcesOptions;(!J||["field","operator","config","fieldDefinition","isForRuleGroup"].filter(function(X){return A.includes(X)}).length)&&(J=oC(l,R,g,P),m&&(J=["value"]),R||(J=Object.keys(j)),K=J.map(function(X){return[X,{label:j[X].label}]}));var U=Hs()(0,q).map(function(X){var Y,ae,ge,se,ce=(Y=s.meta)===null||Y===void 0||(Y=Y.widgets)===null||Y===void 0?void 0:Y[X],de=((ae=N)===null||ae===void 0?void 0:ae.get(X))||null,ne=Hg(l,R,g,de),ve=qg(l,R,g,ne,de);$&&(ne=ve.singleWidget,ve=qg(l,R,g,ne,de)),!ve&&L&&(ne=["func","field"].includes(de)?de:x,ve=l.widgets[ne]);var ye=(ge=ve)===null||ge===void 0?void 0:ge.type,Ce=Eo(l,R,g,X,de,W),fe=Eo(l,R,g,X,null,W),ar=V!=null&&V.textSeparators?V?.textSeparators[X]:null,Le=null,Me=null;G&&(Le=[Eo(l,R,g,0),Eo(l,R,g,1)],Le={placeholder:[Le[0].placeholder,Le[1].placeholder],label:[Le[0].label,Le[1].label]},Me=V?.textSeparators);var Ae=_g({id:E,isLHS:T,delta:X,parentFuncs:_}),Tr=Ae+":VS",Dr=ce?.setValueSrc;(!Dr||ce?.widgetId!==Ae)&&(Dr=s._setValueSrc.bind(s,X,Tr));var xr=ce?.setValue;return(!xr||ce?.widgetId!==Ae||ce?.widgetType!==ye||((se=s.meta)===null||se===void 0?void 0:se.isSpecialRange)!==G)&&(xr=s._setValue.bind(s,G,X,ye,Ae)),{valueSrc:de,valueLabel:Ce,widget:ne,sepText:ar,widgetDefinition:ve,widgetValueLabel:fe,valueLabels:Le,textSeparators:Me,setValueSrc:Dr,setValue:xr,widgetId:Ae,widgetType:ye}});return{defaultWidget:x,fieldDefinition:P,operatorDefinition:V,isSpecialRange:W,cardinality:q,valueSources:J,valueSourcesOptions:K,widgets:U,iValues:I,aField:R,asyncListValues:F}}},{key:"render",value:function(){if(!this.meta)return null;var r=this.meta,a=r.defaultWidget,i=r.cardinality;if(!a)return null;var o=a;return C.createElement(Er,{className:"rule--widget rule--widget--".concat(o.toUpperCase()),key:"widget-col-"+o},Hs()(0,i).map(this.renderWidgetDelta))}}])}(C.Component);Oi.propTypes={config:w().object.isRequired,value:w().any,valueSrc:w().any,valueError:w().any,fieldError:w().string,field:w().any,fieldSrc:w().string,fieldType:w().string,fieldId:w().string,operator:w().string,readonly:w().bool,asyncListValues:w().array,id:w().string,groupId:w().string,setValue:w().func,setValueSrc:w().func,setFuncValue:w().func,isFuncArg:w().bool,fieldFunc:w().string,fieldArg:w().string,leftField:w().any,isForRuleGroup:w().bool,parentField:w().string,parentFuncs:w().array,isLHS:w().bool,isCaseValue:w().bool};function Yg(n,e,t){return e=(0,ue.A)(e),(0,qe.A)(n,Kg()?Reflect.construct(e,t||[],(0,ue.A)(n).constructor):e.apply(n,t))}function Kg(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Kg=function(){return!!n})()}var lC=Oe.ConfigUtils.getFuncConfig,Qg=Oe.OtherUtils.shallowEqual,Qs=function(n){function e(t){var r;return(0,Ge.A)(this,e),r=Yg(this,e,[t]),r.setFunc=function(a){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=r.props,u=o.isLHS,s=o.delta,l=o.parentFuncs,c=o.id;if(!i.widgetId){var d=_g({id:c,isLHS:u,delta:s,parentFuncs:l});i.widgetId=d}r.props.setFuncValue(u?-1:s||0,l,null,a,"!func",void 0,i)},r.setArgValue=function(a,i,o,u,s){var l=r.props,c=l.config,d=l.delta,f=l.isLHS,p=l.parentFuncs;r.props.setFuncValue(f?-1:d||0,p,a,i,o,u,s)},r.setArgValueSrc=function(a,i,o){var u=r.props,s=u.config,l=u.delta,c=u.isLHS,d=u.parentFuncs;r.props.setFuncValue(c?-1:l||0,d,a,i,"!valueSrc",void 0,o)},r.renderFuncSelect=function(){var a,i,o=r.props,u=o.config,s=o.field,l=o.fieldType,c=o.fieldSrc,d=o.isLHS,f=o.operator,p=o.customProps,v=o.value,g=o.readonly,h=o.parentFuncs,y=o.id,m=o.groupId,b=o.isFuncArg,O=o.fieldDefinition,S=(a=v==null||(i=v.get)===null||i===void 0?void 0:i.call(v,"func"))!==null&&a!==void 0?a:null,F={value:S,setValue:r.setFunc,config:u,field:s,fieldType:l,fieldSrc:c,isLHS:d,operator:f,customProps:p,readonly:g,parentFuncs:h,isFuncArg:b,fieldDefinition:O,id:y,groupId:m},_=u.settings,T=_.showLabels,E=_.funcLabel,A=T?C.createElement("label",{className:"rule--label"},E):null;return C.createElement(Er,{key:"func",className:"rule--func"},A,C.createElement(Mg,F))},r.renderArgLabel=function(a,i){var o=i.valueSources,u=i.type,s=i.showPrefix,l=i.label,c=r.props.config,d=o&&o.length==1&&o[0]=="const",f=!c.settings.showLabels&&(u=="boolean"||d)&&s;return f?C.createElement(Er,{className:"rule--func--arg-label"},l||a):null},r.renderArgLabelSep=function(a,i){var o=i.valueSources,u=i.type,s=i.showPrefix,l=r.props.config,c=o&&o.length==1&&o[0]=="const",d=!l.settings.showLabels&&(u=="boolean"||c)&&s;return d?C.createElement(Er,{className:"rule--func--arg-label-sep"},":"):null},r.renderArgVal=function(a,i,o){var u=r.props,s=u.config,l=u.field,c=u.fieldType,d=u.fieldSrc,f=u.isLHS,p=u.operator,v=u.value,g=u.readonly,h=u.parentFuncs,y=u.id,m=u.groupId,b=u.fieldError,O=u.valueError,S=u.setFuncValue,F=v?v.getIn(["args",i]):null,_=F?F.get("value"):void 0,T=o.valueSources.length==1?o.valueSources[0]:void 0,E=F?F.get("valueSrc")||T||"value":T,A={config:s,fieldFunc:a,fieldArg:i,leftField:l,fieldType:c,fieldSrc:d,fieldError:b,valueError:O,isLHS:f,operator:null,value:_,valueSrc:E,setValue:r.setArgValue,setValueSrc:r.setArgValueSrc,setFuncValue:S,funcKey:a,argKey:i,argDefinition:o,readonly:g,parentFuncs:h,id:y,groupId:m};return C.createElement(Er,{className:"rule--func--arg-value"},C.createElement(Xg,A))},r.renderArgSep=function(a,i,o,u){var s=u.renderSeps;return o?C.createElement(Er,{className:"rule--func--arg-sep"},s?s[o-1]:", "):null},r.renderBracketBefore=function(a){var i=a.renderBrackets;return C.createElement(Er,{key:"before_args",className:"rule--func--bracket-before"},i?i[0]:"(")},r.renderBracketAfter=function(a){var i=a.renderBrackets;return C.createElement(Er,{key:"after_args",className:"rule--func--bracket-after"},i?i[1]:")")},r.renderFuncArgs=function(){var a=r.meta,i=a.funcDefinition,o=a.funcKey;if(!o)return null;var u=i||{},s=u.args;return s?C.createElement(C.Fragment,null,r.renderBracketBefore(i),C.createElement(Er,{key:"args-".concat(o),className:"rule--func--args rule--func--".concat(o,"--args")},Object.keys(s).map(function(l,c){return C.createElement(Er,{key:"arg-".concat(l,"-").concat(c),className:"rule--func--arg rule--func--".concat(o,"--arg--").concat(l)},r.renderArgSep(l,s[l],c,i),r.renderArgLabel(l,s[l]),r.renderArgLabelSep(l,s[l]),r.renderArgVal(o,l,s[l]))})),r.renderBracketAfter(i)):null},nt(r),r.onPropsChanged(t),r}return(0,Ue.A)(e,n),(0,ze.A)(e,[{key:"onPropsChanged",value:function(r){var a=this.props,i=["config","field","operator","value","fieldSrc","fieldType","isLHS"],o=!this.meta||i.map(function(u){return u==="parentFuncs"?!Qg(r[u],a[u],!0):r[u]!==a[u]}).filter(function(u){return u}).length>0;o&&(this.meta=this.getMeta(r))}},{key:"getMeta",value:function(r){var a,i,o=r.config,u=r.field,s=r.operator,l=r.value,c=(a=l==null||(i=l.get)===null||i===void 0?void 0:i.call(l,"func"))!==null&&a!==void 0?a:null,d=c?lC(o,c):null;return{funcDefinition:d,funcKey:c}}},{key:"render",value:function(){var r=this.props.parentFuncs,a=r?r.map(function(o){var u=(0,ie.A)(o,2),s=u[0],l=u[1];return"".concat(s,"_").concat(l)}).join("-"):"root",i=r?.length||0;return C.createElement(Er,{className:"rule--func--wrapper rule--func--wrapper--under-".concat(a," rule--func--wrapper--lev-").concat(i)},this.renderFuncSelect(),this.renderFuncArgs())}}])}(C.Component);Qs.propTypes={id:w().string,groupId:w().string,config:w().object.isRequired,field:w().any,fieldSrc:w().string,fieldType:w().string,fieldError:w().string,operator:w().string,customProps:w().object,value:w().object,setValue:w().func.isRequired,setFuncValue:w().func,readonly:w().bool,parentFuncs:w().array,fieldDefinition:w().object,isFuncArg:w().bool,isLHS:w().bool,valueError:w().string};var Xg=function(n){function e(t){var r;return(0,Ge.A)(this,e),r=Yg(this,e,[t]),r.setValue=function(a,i,o,u,s){var l=r.props,c=l.setValue,d=l.argKey;c(d,i,o,u,s)},r.setValueSrc=function(a,i,o){var u=r.props,s=u.setValueSrc,l=u.argKey;s(l,i,o)},nt(r),r.onPropsChanged(t),r}return(0,Ue.A)(e,n),(0,ze.A)(e,[{key:"onPropsChanged",value:function(r){var a=this.props,i=["parentFuncs","funcKey","argKey"],o=!this.meta||i.map(function(u){return u==="parentFuncs"?!Qg(r[u],a[u],!0):r[u]!==a[u]}).filter(function(u){return u}).length>0;o&&(this.meta=this.getMeta(r))}},{key:"getMeta",value:function(r){var a=r.parentFuncs,i=r.funcKey,o=r.argKey,u=[].concat((0,Q.A)(a||[]),[[i,o]]);return{parentFuncs:u}}},{key:"render",value:function(){var r=this.meta.parentFuncs;return C.createElement(Oi,(0,Te.A)({},this.props,{setValue:this.setValue,setValueSrc:this.setValueSrc,isFuncArg:!0,parentFuncs:r}))}}])}(C.Component);Xg.propTypes={funcKey:w().string.isRequired,argKey:w().string.isRequired,setValue:w().func.isRequired,setValueSrc:w().func.isRequired,readonly:w().bool,isLHS:w().bool,parentFuncs:w().array,id:w().string,groupId:w().string};function cC(n,e,t){return e=(0,ue.A)(e),(0,qe.A)(n,Zg()?Reflect.construct(e,t||[],(0,ue.A)(n).constructor):e.apply(n,t))}function Zg(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Zg=function(){return!!n})()}var Xs=function(n){function e(t){var r;return(0,Ge.A)(this,e),r=cC(this,e,[t]),r.renderField=function(){var a=r.props,i=a.config,o=a.classname,u=a.selectedField,s=a.selectedFieldSrc,l=a.selectedFieldType,c=a.setField,d=a.setFuncValue,f=a.parentField,p=a.readonly,v=a.id,g=a.groupId,h=a.fieldError,y=a.valueError,m=["func","field"];if(!m.includes(s))return"?";var b=s==="func"?C.createElement(Qs,{isLHS:!0,config:i,value:u,fieldSrc:s,fieldType:l,fieldError:h,valueError:y,parentField:f,setValue:c,setFuncValue:d,readonly:p,id:v,groupId:g,key:"field-func-"+v}):C.createElement(xg,{config:i,selectedField:u,selectedFieldSrc:s,selectedFieldType:l,parentField:f,setField:c,customProps:i.settings.customFieldSelectProps,readonly:p,id:v,groupId:g,key:"field-"+v}),O=s==="func"?i.settings.funcLabel:i.settings.fieldLabel,S=i.settings.showLabels&&s!=="func"&&C.createElement("label",{className:"rule--label"},O);return C.createElement("div",{key:s,className:o},S,b)},r.renderFieldSources=function(){if(!r.meta)return null;var a=r.props,i=a.config,o=a.readonly,u=a.selectedFieldSrc,s=a.setFieldSrc,l=a.id,c=r.meta.fieldSourcesOptions,d=i.settings,f=r.ValueSources,p=d.showLabels?C.createElement("label",{className:"rule--label"},"\xA0"):null;return c.length>1&&!o&&C.createElement("div",{key:"fieldsrc",className:"rule--fieldsrc"},p,C.createElement(f,{key:"fieldsrc-"+l,valueSources:c,valueSrc:u,config:i,setValueSrc:s,readonly:o,title:d.fieldSourcesPopupTitle}))},nt(r),r.onPropsChanged(t),r}return(0,Ue.A)(e,n),(0,ze.A)(e,[{key:"onPropsChanged",value:function(r){var a=this.props,i=!this.ValueSources||a?.config!==r?.config,o=["config"],u=!this.meta||o.map(function(c){return r[c]!==a[c]}).filter(function(c){return c}).length>0;if(u&&(this.meta=this.getMeta(r)),i){var s=r.config,l=s.settings.renderValueSources;this.ValueSources=function(c){return l(c,s.ctx)}}}},{key:"getMeta",value:function(r){var a=r.config,i=a.settings,o=i.valueSourcesInfo,u=i.fieldSources,s=u.map(function(l){return[l,{label:o[l].label}]});return{fieldSourcesOptions:s}}},{key:"render",value:function(){var r=this.props,a=r.classname,i=r.canSelectFieldSource,o=i&&this.renderFieldSources(),u=this.renderField();return i?C.createElement(Er,{className:"rule--field-wrapper"},o,u):u}}])}(C.Component),dC=["factory"];function fC(n,e,t){return e=(0,ue.A)(e),(0,qe.A)(n,eh()?Reflect.construct(e,t||[],(0,ue.A)(n).constructor):e.apply(n,t))}function eh(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(eh=function(){return!!n})()}var pC=Oe.ConfigUtils.getOperatorConfig,rh=function(n){function e(){return(0,Ge.A)(this,e),fC(this,e,arguments)}return(0,Ue.A)(e,n),(0,ze.A)(e,[{key:"render",value:function(){if(!this.props.selectedOperator)return null;var r=pC(this.props.config,this.props.selectedOperator,this.props.selectedField);if(typeof r.options>"u")return null;var a=r.options,i=a.factory,o=(0,Wn.A)(a,dC),u=Object.assign({},o,{config:this.props.config,field:this.props.selectedField,fieldSrc:this.props.selectedFieldSrc,operator:this.props.selectedOperator,options:this.props.operatorOptions,setOption:this.props.setOperatorOption,readonly:this.props.readonly}),s=i(u,this.props.config.ctx),l=this.props.selectedOperator;return C.createElement("div",{className:"rule--operator rule--operator--".concat(l.toUpperCase())},s)}}])}(C.PureComponent);rh.propTypes={config:w().object.isRequired,operatorOptions:w().any.isRequired,selectedField:w().any,selectedFieldSrc:w().string,selectedOperator:w().string.isRequired,readonly:w().bool,setOperatorOption:w().func.isRequired};function th(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),t.push.apply(t,r)}return t}function nh(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?th(Object(t),!0).forEach(function(r){(0,z.A)(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):th(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function vC(n,e,t){return e=(0,ue.A)(e),(0,qe.A)(n,ah()?Reflect.construct(e,t||[],(0,ue.A)(n).constructor):e.apply(n,t))}function ah(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(ah=function(){return!!n})()}var Lo=Oe.ConfigUtils,gC=Lo.getFieldConfig,hC=Lo.getOperatorConfig,mC=Lo.getFieldWidgetConfig,yC=Lo.getFieldId,bC=Oe.RuleUtils.isEmptyRuleProperties,ih=function(n){function e(t){var r;return(0,Ge.A)(this,e),r=vC(this,e,[t]),nt(r),r.removeSelf=r.removeSelf.bind(r),r.setLock=r.setLock.bind(r),r.onPropsChanged(t),r}return(0,Ue.A)(e,n),(0,ze.A)(e,[{key:"onPropsChanged",value:function(r){var a=this,i=this.props,o=!this.Icon||i?.config!==r?.config,u=["selectedField","selectedFieldSrc","selectedFieldType","selectedOperator","config","reordableNodesCnt","isLocked","parentField","parentFieldCanReorder"],s=!this.meta||u.map(function(m){return r[m]!==i[m]}).filter(function(m){return m}).length>0;if(s&&(this.meta=this.getMeta(r)),o){var l=r.config,c=l.settings,d=c.renderIcon,f=c.renderButton,p=c.renderButtonGroup,v=c.renderSwitch,g=c.renderBeforeWidget,h=c.renderAfterWidget,y=c.renderRuleError;this.Icon=it(l,d),this.Btn=it(l,f),this.BtnGrp=it(l,p),this.Switch=it(l,v),this.BeforeWidget=it(l,g),this.AfterWidget=it(l,h),this.RuleError=it(l,y)}this.doRemove=function(){a.props.removeSelf()}}},{key:"getMeta",value:function(r){var a=r.selectedField,i=r.selectedFieldType,o=r.selectedOperator,u=r.config,s=r.reordableNodesCnt,l=r.isLocked,c=r.parentField,d=r.parentFieldCanReorder,f=u.settings.keepInputOnChangeFieldSrc,p=yC(a,u),v=gC(u,a),g=v&&v.type==="!struct",h=f&&i,y=!!a||h,m=y&&o,b=hC(u,o,a),O=b&&b.options!=null,S=mC(u,a,o,null,null)||{},F=S.hideOperator,_=u.settings.canReorder&&s>1&&!l;c&&(_=_&&d);var T=y&&!F,E=y&&F&&S.operatorInlineLabel,A=m&&!g,j=m&&O;return{selectedFieldId:p,selectedFieldWidgetConfig:S,showDragIcon:_,showOperator:T,showOperatorLabel:E,showWidget:A,showOperatorOptions:j}}},{key:"setLock",value:function(r){this.props.setLock(r)}},{key:"removeSelf",value:function(){var r=this.props,a=r.confirmFn,i=r.config,o=i.settings,u=o.renderConfirm,s=o.removeRuleConfirmOptions;s&&!this.isEmptyCurrentRule()?u.call(i.ctx,nh(nh({},s),{},{onOk:this.doRemove,onCancel:null,confirmFn:a}),i.ctx):this.doRemove()}},{key:"_buildWidgetProps",value:function(r,a){var i=r.selectedField,o=r.selectedFieldSrc,u=r.selectedFieldType,s=r.selectedOperator,l=r.operatorOptions,c=r.value,d=r.valueType,f=r.valueSrc,p=r.asyncListValues,v=r.valueError,g=r.fieldError,h=r.parentField,y=a.selectedFieldId;return{field:i,fieldSrc:o,fieldType:u,fieldId:y,operator:s,operatorOptions:l,value:c,valueType:d,valueSrc:f,asyncListValues:p,valueError:v,fieldError:g,parentField:h}}},{key:"isEmptyCurrentRule",value:function(){var r=this.props.config,a=this._buildWidgetProps(this.props,this.meta);return bC(a,r)}},{key:"renderField",value:function(){var r=this.props,a=r.config,i=r.isLocked,o=r.parentField,u=r.groupId,s=r.id,l=r.selectedFieldSrc,c=r.selectedField,d=r.selectedFieldType,f=r.setField,p=r.setFuncValue,v=r.setFieldSrc,g=r.fieldError,h=a.settings.immutableFieldsMode,y=this.meta.selectedFieldId;return C.createElement(Xs,{key:"field",classname:Lt()(l=="func"?"rule--field--func":"rule--field"),config:a,canSelectFieldSource:!o,selectedField:c,selectedFieldSrc:l,selectedFieldType:d,selectedFieldId:y,fieldError:g,setField:h?at:f,setFuncValue:h?at:p,setFieldSrc:h?at:v,parentField:o,readonly:h||i,id:s,groupId:u})}},{key:"renderOperator",value:function(){var r=this.props,a=r.config,i=r.isLocked,o=this.meta,u=o.selectedFieldId,s=o.selectedFieldWidgetConfig,l=o.showOperator,c=o.showOperatorLabel,d=a.settings.immutableOpsMode;return C.createElement(wg,{key:"operator",config:a,selectedField:this.props.selectedField,selectedFieldSrc:this.props.selectedFieldSrc,selectedFieldType:this.props.selectedFieldType,selectedFieldId:u,selectedOperator:this.props.selectedOperator,setOperator:d?at:this.props.setOperator,showOperator:l,showOperatorLabel:c,selectedFieldWidgetConfig:s,readonly:d||i,id:this.props.id,groupId:this.props.groupId})}},{key:"renderWidget",value:function(){var r=this.props,a=r.config,i=r.isLocked,o=this.meta.showWidget,u=a.settings.immutableValuesMode;if(!o)return null;var s=C.createElement(Oi,(0,Te.A)({key:"values"},this._buildWidgetProps(this.props,this.meta),{config:a,setValue:u?at:this.props.setValue,setValueSrc:u?at:this.props.setValueSrc,setFuncValue:u?at:this.props.setFuncValue,readonly:u||i,id:this.props.id,groupId:this.props.groupId}));return C.createElement(Er,{key:"widget-for-"+this.props.selectedOperator,className:"rule--value"},s)}},{key:"renderOperatorOptions",value:function(){var r=this.props.config,a=this.meta.showOperatorOptions,i=r.settings,o=i.immutableOpsMode,u=i.immutableValuesMode;if(!a)return null;var s=C.createElement(rh,{key:"operatorOptions",selectedField:this.props.selectedField,selectedOperator:this.props.selectedOperator,operatorOptions:this.props.operatorOptions,setOperatorOption:o?at:this.props.setOperatorOption,config:r,readonly:u});return C.createElement(Er,{key:"op-options-for-"+this.props.selectedOperator,className:"rule--operator-options"},s)}},{key:"renderBeforeWidget",value:function(){var r=this.BeforeWidget;return r?C.createElement(Er,{key:"before-widget-for-"+this.props.selectedOperator,className:"rule--before-widget"},C.createElement(r,this.props)):null}},{key:"renderAfterWidget",value:function(){var r=this.AfterWidget;return r?C.createElement(Er,{key:"after-widget-for-"+this.props.selectedOperator,className:"rule--after-widget"},C.createElement(r,this.props)):null}},{key:"renderError",value:function(){var r=this.props,a=r.config,i=r.valueError,o=r.fieldError,u=a.settings.showErrorMessage,s=this.RuleError,l=[o].concat((0,Q.A)(i?.toArray()||[])).filter(function(c){return!!c}).shift()||null;return u&&l&&C.createElement("div",{className:"rule--error"},s?C.createElement(s,{error:l}):l)}},{key:"renderDrag",value:function(){var r=this.props.handleDraggerMouseDown,a=this.meta.showDragIcon,i=this.Icon,o=C.createElement(i,{type:"drag"});return a&&C.createElement("div",{key:"rule-drag-icon",onMouseDown:r,className:"qb-drag-handler rule--drag-handler"},o)}},{key:"renderDel",value:function(){var r=this.props,a=r.config,i=r.isLocked,o=a.settings,u=o.deleteLabel,s=o.immutableGroupsMode,l=o.canDeleteLocked,c=this.Icon,d=this.Btn;return!s&&(!i||i&&l)&&C.createElement(d,{key:"rule-del",type:"delRule",onClick:this.removeSelf,label:u,config:a,renderIcon:c})}},{key:"renderLock",value:function(){var r=this.props,a=r.config,i=r.isLocked,o=r.isTrueLocked,u=r.id,s=a.settings,l=s.lockLabel,c=s.lockedLabel,d=s.showLock,f=this.Switch;return d&&!(i&&!o)&&C.createElement(f,{key:"rule-lock",type:"lock",id:u,value:i,setValue:this.setLock,label:l,checkedLabel:c,hideLabel:!0,config:a})}},{key:"render",value:function(){var r=this.meta,a=r.showOperatorOptions,i=r.selectedFieldWidgetConfig,o=this.props,u=o.valueSrc,s=o.value,l=o.config,c=u?.first()=="value"&&!a&&s.size==1&&i.fullWidth,d=this.BtnGrp,f=[this.renderField(),this.renderOperator(),this.renderBeforeWidget(),this.renderWidget(),this.renderAfterWidget(),this.renderOperatorOptions()],p=C.createElement("div",{key:"rule-body",className:Lt()("rule--body",c&&"can--shrink--value")},f),v=this.renderError(),g=this.renderDrag(),h=this.renderLock(),y=this.renderDel();return C.createElement(C.Fragment,null,g,C.createElement("div",{key:"rule-body-wrapper",className:"rule--body--wrapper"},p,v),C.createElement("div",{key:"rule-header-wrapper",className:"rule--header"},C.createElement(d,{key:"rule-header-group",config:l},h,y)))}}])}(C.Component);ih.propTypes={id:w().string.isRequired,groupId:w().string,selectedField:w().any,selectedFieldSrc:w().string,selectedFieldType:w().string,selectedOperator:w().string,operatorOptions:w().object,config:w().object.isRequired,value:w().any,valueSrc:w().any,valueType:w().any,asyncListValues:w().array,isDraggingMe:w().bool,isDraggingTempo:w().bool,parentField:w().string,valueError:w().any,fieldError:w().string,isLocked:w().bool,isTrueLocked:w().bool,handleDraggerMouseDown:w().func,setField:w().func,setFieldSrc:w().func,setOperator:w().func,setOperatorOption:w().func,setLock:w().func,removeSelf:w().func,setValue:w().func,setValueSrc:w().func,setFuncValue:w().func,reordableNodesCnt:w().number,totalRulesCnt:w().number,parentReordableNodesCnt:w().number,parentFieldCanReorder:w().bool};const OC=w_(Ta("rule")(Ra(ih)));var SC=D(22331),FC=D.n(SC);function _C(n,e,t){return e=(0,ue.A)(e),(0,qe.A)(n,oh()?Reflect.construct(e,t||[],(0,ue.A)(n).constructor):e.apply(n,t))}function oh(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(oh=function(){return!!n})()}var CC=Oe.DefaultUtils.defaultGroupConjunction,uh=Oe.ConfigUtils.getFieldConfig,wC=function(e,t){var r;return r=function(a){function i(o){var u;return(0,Ge.A)(this,i),u=_C(this,i,[o]),u._selectedConjunction=function(s){return s=s||u.props,s.conjunction||CC(s.config,s.field)},u.setConjunction=function(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;u.props.actions.setConjunction(u.props.path,s)},u.setNot=function(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;u.props.actions.setNot(u.props.path,s)},u.setLock=function(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;u.props.actions.setLock(u.props.path,s)},u.dummyFn=function(){},u.removeSelf=function(){u.props.actions.removeGroup(u.props.path)},u.addGroup=function(){var s=t=="rule_group"?u.props.field:u.props.parentField;u.props.actions.addGroup(u.props.path,void 0,void 0,s)},u.addCaseGroup=function(){u.props.actions.addCaseGroup(u.props.path)},u.addDefaultCaseGroup=function(){u.props.actions.addDefaultCaseGroup(u.props.path)},u.addRule=function(){var s=t=="rule_group"?u.props.field:u.props.parentField;u.props.actions.addRule(u.props.path,void 0,void 0,void 0,s)},u.setField=function(s,l,c){u.props.actions.setField(u.props.path,s,l,c)},u.setOperator=function(s){u.props.actions.setOperator(u.props.path,s)},u.setValue=function(s,l,c,d,f){u.props.actions.setValue(u.props.path,s,l,c,d,f)},u.setValueSrc=function(s,l,c){u.props.actions.setValueSrc(u.props.path,s,l,c)},u.setFuncValue=function(s,l,c,d,f,p,v){u.props.actions.setFuncValue(u.props.path,s,l,c,d,f,p,v)},u.pureShouldComponentUpdate=La(u),nt(u),u.selectedConjunction=u._selectedConjunction(o),u.conjunctionOptions=u._getConjunctionOptions(o),u.dummyFn.isDummyFn=!0,u}return(0,Ue.A)(i,a),(0,ze.A)(i,[{key:"shouldComponentUpdate",value:function(u,s){var l=this.props,c=this.state,d=this.pureShouldComponentUpdate(u,s);if(d&&c==s&&l!=u){var f=u.dragging.id||l.dragging.id,p=f==u.id,v=[];for(var g in u){var h=u[g]!=l[g];g=="dragging"&&!p&&(h=!1),h&&v.push(g)}v.length||(d=!1)}return d}},{key:"onPropsChanged",value:function(u){var s=u.config,l=u.id,c=u.conjunction,d=this.props.config,f=this.props.conjunction;(d!=s||f!=c)&&(this.selectedConjunction=this._selectedConjunction(u),this.conjunctionOptions=this._getConjunctionOptions(u))}},{key:"_getConjunctionOptions",value:function(u){var s=this;return bo()(u.config.conjunctions,function(l,c){return{id:"conjunction-".concat(u.id,"-").concat(c),name:"conjunction[".concat(u.id,"]"),key:c,label:l.label,checked:c===s._selectedConjunction(u)}})}},{key:"render",value:function(){var u=this.props.config.settings.showErrorMessage,s=this.props.dragging.id==this.props.id,l=this.props.path.size,c=this.props.config.settings.maxNesting,d=l==1;if(this.props.parentField&&this.props.parentFieldPathSize){var f=uh(this.props.config,this.props.parentField);l=this.props.path.size-this.props.parentFieldPathSize+1,c=f?.maxNesting,d=!1}else if(this.props.field){var p=uh(this.props.config,this.props.field);l=1,c=p?.maxNesting,d=!1}var v=!s&&this.props.isDraggingTempo,g=this.props.fieldType||null,h=this.props.valueError,y=(0,Q.A)(h?.toArray()||[]).filter(function(S){return!!S}).shift()||null,m=y!=null&&u,b=typeof c>"u"||l<c,O=c&&l>c;return C.createElement("div",{className:Lt()("group-or-rule-container","group-container",m?"group-with-error":null),"data-id":this.props.id},[s?C.createElement(e,{key:"dragging",id:this.props.id,groupId:this.props.groupId,isDraggingMe:!0,isDraggingTempo:!0,dragging:this.props.dragging,isRoot:d,lev:this.props.path.size-1,allowFurtherNesting:b,isMaxNestingExceeded:O,conjunctionOptions:this.conjunctionOptions,not:this.props.not,selectedConjunction:this.selectedConjunction,setConjunction:this.dummyFn,setNot:this.dummyFn,setLock:this.dummyFn,removeSelf:this.dummyFn,addGroup:this.dummyFn,addCaseGroup:this.dummyFn,addDefaultCaseGroup:this.dummyFn,addRule:this.dummyFn,setField:this.dummyFn,setFuncValue:this.dummyFn,setOperator:this.dummyFn,setValue:this.dummyFn,setValueSrc:this.dummyFn,value:this.props.value||null,valueError:this.props.valueError||null,valueSrc:this.props.valueSrc||null,config:this.props.config,children1:this.props.children1,actions:this.props.actions,reordableNodesCnt:this.props.reordableNodesCnt,totalRulesCnt:this.props.totalRulesCnt,selectedField:this.props.field||null,selectedFieldSrc:this.props.fieldSrc||"field",selectedFieldType:g,parentField:this.props.parentField||null,parentFieldPathSize:this.props.parentFieldPathSize,parentFieldCanReorder:this.props.parentFieldCanReorder,selectedOperator:this.props.operator||null,isLocked:this.props.isLocked,isTrueLocked:this.props.isTrueLocked,parentReordableNodesCnt:this.props.parentReordableNodesCnt}):null,C.createElement(e,{key:this.props.id,id:this.props.id,groupId:this.props.groupId,isDraggingMe:s,isDraggingTempo:v,onDragStart:this.props.onDragStart,isRoot:d,lev:this.props.path.size-1,allowFurtherNesting:b,isMaxNestingExceeded:O,conjunctionOptions:this.conjunctionOptions,not:this.props.not,selectedConjunction:this.selectedConjunction,setConjunction:v?this.dummyFn:this.setConjunction,setNot:v?this.dummyFn:this.setNot,setLock:v?this.dummyFn:this.setLock,removeSelf:v?this.dummyFn:this.removeSelf,addGroup:v?this.dummyFn:this.addGroup,addCaseGroup:v?this.dummyFn:this.addCaseGroup,addDefaultCaseGroup:v?this.dummyFn:this.addDefaultCaseGroup,addRule:v?this.dummyFn:this.addRule,setField:v?this.dummyFn:this.setField,setFuncValue:v?this.dummyFn:this.setFuncValue,setOperator:v?this.dummyFn:this.setOperator,setValue:v?this.dummyFn:this.setValue,setValueSrc:v?this.dummyFn:this.setValueSrc,value:this.props.value||null,valueError:this.props.valueError||null,valueSrc:this.props.valueSrc||null,config:this.props.config,children1:this.props.children1,actions:this.props.actions,reordableNodesCnt:this.props.reordableNodesCnt,totalRulesCnt:this.props.totalRulesCnt,selectedField:this.props.field||null,selectedFieldSrc:this.props.fieldSrc||"field",selectedFieldType:g,parentField:this.props.parentField||null,parentFieldPathSize:this.props.parentFieldPathSize,parentFieldCanReorder:this.props.parentFieldCanReorder,selectedOperator:this.props.operator||null,isLocked:this.props.isLocked,isTrueLocked:this.props.isTrueLocked,parentReordableNodesCnt:this.props.parentReordableNodesCnt})])}}])}(C.Component),r.propTypes={config:w().object.isRequired,actions:w().object.isRequired,path:w().any.isRequired,id:w().string.isRequired,groupId:w().string,not:w().bool,conjunction:w().string,children1:w().any,onDragStart:w().func,reordableNodesCnt:w().number,field:w().any,fieldSrc:w().string,fieldType:w().string,parentField:w().string,value:w().any,valueSrc:w().any,valueError:w().any,isLocked:w().bool,isTrueLocked:w().bool,dragging:w().object,isDraggingTempo:w().bool},r};const Si=function(n,e){var t=So(function(r){return{dragging:r.dragging}},null,null,{context:bi})(wC(n,e));return t.displayName="ConnectedGroupContainer",t};function AC(n,e,t){return e=(0,ue.A)(e),(0,qe.A)(n,sh()?Reflect.construct(e,t||[],(0,ue.A)(n).constructor):e.apply(n,t))}function sh(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(sh=function(){return!!n})()}var EC={topLeft:"group--actions--tl",topCenter:"group--actions--tc",topRight:"group--actions--tr",bottomLeft:"group--actions--bl",bottomCenter:"group--actions--bc",bottomRight:"group--actions--br"},LC="topRight",lh=function(n){function e(){return(0,Ge.A)(this,e),AC(this,e,arguments)}return(0,Ue.A)(e,n),(0,ze.A)(e,[{key:"render",value:function(){var r=this.props,a=r.config,i=r.addRule,o=r.addGroup,u=r.removeSelf,s=r.setLock,l=r.isLocked,c=r.isTrueLocked,d=r.id,f=r.parentField,p=r.canAddGroup,v=r.canAddRule,g=r.canDeleteGroup,h=a.settings,y=h.immutableGroupsMode,m=h.addRuleLabel,b=h.addGroupLabel,O=h.addSubRuleLabel,S=h.addSubGroupLabel,F=h.delGroupLabel,_=h.groupActionsPosition,T=h.renderButton,E=h.renderIcon,A=h.renderSwitch,j=h.renderButtonGroup,R=h.lockLabel,L=h.lockedLabel,N=h.showLock,I=h.canDeleteLocked,P=function(U){return E(U,a.ctx)},x=function(U){return T(U,a.ctx)},k=function(U){return A(U,a.ctx)},V=function(U){return j(U,a.ctx)},G=EC[_||LC],$=N&&!(l&&!c)&&C.createElement(k,{type:"lock",id:d,value:l,setValue:s,label:R,checkedLabel:L,config:a}),W=!y&&v&&!l&&C.createElement(x,{type:f?"addSubRule":"addRule",onClick:i,label:f?O:m,readonly:l,config:a,renderIcon:P}),q=!y&&p&&!l&&C.createElement(x,{type:f?"addSubGroup":"addGroup",onClick:o,label:f?S:b,readonly:l,config:a,renderIcon:P}),J=!y&&g&&(!l||l&&I)&&C.createElement(x,{type:"delGroup",onClick:u,label:F,config:a,renderIcon:P});return C.createElement("div",{className:"group--actions ".concat(G)},C.createElement(V,{config:a},$,W,q,J))}}])}(C.PureComponent);function TC(n,e){var t=typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(!t){if(Array.isArray(n)||(t=jC(n))||e&&n&&typeof n.length=="number"){t&&(n=t);var r=0,a=function(){};return{s:a,n:function(){return r>=n.length?{done:!0}:{done:!1,value:n[r++]}},e:function(l){throw l},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,o=!1,u;return{s:function(){t=t.call(n)},n:function(){var l=t.next();return i=l.done,l},e:function(l){o=!0,u=l},f:function(){try{!i&&t.return!=null&&t.return()}finally{if(o)throw u}}}}function jC(n,e){if(n){if(typeof n=="string")return ch(n,e);var t=Object.prototype.toString.call(n).slice(8,-1);if(t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set")return Array.from(n);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return ch(n,e)}}function ch(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=new Array(e);t<e;t++)r[t]=n[t];return r}function dh(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),t.push.apply(t,r)}return t}function fh(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?dh(Object(t),!0).forEach(function(r){(0,z.A)(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):dh(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function RC(n,e,t){return e=(0,ue.A)(e),(0,qe.A)(n,ph()?Reflect.construct(e,t||[],(0,ue.A)(n).constructor):e.apply(n,t))}function ph(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(ph=function(){return!!n})()}var Zs=Oe.ConfigUtils.getFieldConfig,xC=Oe.RuleUtils.isEmptyGroupChildren,vh=Oe.TreeUtils,bE=vh.getTotalReordableNodesCountInTree,PC=vh.getTotalRulesCountInTree,IC="topRight",en=function(n){function e(t){var r;return(0,Ge.A)(this,e),r=RC(this,e,[t]),r.childrenClassName=function(){return""},r.renderBeforeActions=function(){var a=r.BeforeActions;return a==null?null:C.createElement(a,(0,Te.A)({key:"group-actions-before"},r.props))},r.renderAfterActions=function(){var a=r.AfterActions;return a==null?null:C.createElement(a,(0,Te.A)({key:"group-actions-after"},r.props))},nt(r),r.onPropsChanged(t),r.removeSelf=r.removeSelf.bind(r),r.setLock=r.setLock.bind(r),r.renderItem=r.renderItem.bind(r),r}return(0,Ue.A)(e,n),(0,ze.A)(e,[{key:"onPropsChanged",value:function(r){var a=this,i=this.props,o=!this.Icon||i?.config!==r?.config;if(o){var u=r.config,s=u.settings,l=s.renderIcon,c=s.renderConjs,d=s.renderBeforeActions,f=s.renderAfterActions;this.Icon=it(u,l),this.Conjs=it(u,c),this.BeforeActions=it(u,d),this.AfterActions=it(u,f)}this.doRemove=function(){a.props.removeSelf()}}},{key:"isGroupTopPosition",value:function(){return FC()(this.props.config.settings.groupActionsPosition||IC,"top")}},{key:"setLock",value:function(r){this.props.setLock(r)}},{key:"removeSelf",value:function(){var r=this.props,a=r.confirmFn,i=r.config,o=i.settings,u=o.renderConfirm,s=o.removeGroupConfirmOptions;s&&!this.isEmptyCurrentGroup()?u.call(i.ctx,fh(fh({},s),{},{onOk:this.doRemove,onCancel:null,confirmFn:a}),i.ctx):this.doRemove()}},{key:"isEmptyCurrentGroup",value:function(){var r=this.props,a=r.children1,i=r.config;return xC(a,i)}},{key:"showNot",value:function(){var r=this.props,a=r.config,i=r.parentField,o=a.settings.showNot;if(i){var u,s=Zs(a,i);o=o&&((u=s?.showNot)!==null&&u!==void 0?u:!0)}return o}},{key:"showConjs",value:function(){var r=this.props.config,a=r.settings.forceShowConj,i=this.conjunctionOptions(),o=Object.keys(i).length;return o>1&&!this.isOneChild()||this.showNot()||a}},{key:"isNoChildren",value:function(){var r=this.props.children1;return r?r.size==0:!0}},{key:"isOneChild",value:function(){var r=this.props.children1;return r?r.size<2:!0}},{key:"renderChildrenWrapper",value:function(){var r=this.props.children1;return r&&C.createElement("div",{key:"group-children",className:Lt()("group--children",this.showConjs()?"":"hide--conjs",this.isOneChild()?"hide--line":"",this.isOneChild()?"one--child":"",this.childrenClassName())},this.renderChildren())}},{key:"renderHeaderWrapper",value:function(){var r=this.isGroupTopPosition();return C.createElement("div",{key:"group-header",className:Lt()("group--header",this.isOneChild()?"one--child":"",this.showConjs()?"":"hide--conjs",this.isOneChild()?"hide--line":"",this.isNoChildren()?"no--children":"")},this.renderHeader(),r&&this.renderBeforeActions(),r&&this.renderActions(),r&&this.renderAfterActions())}},{key:"renderFooterWrapper",value:function(){var r=this.isGroupTopPosition();return!r&&C.createElement("div",{key:"group-footer",className:"group--footer"},this.renderBeforeActions(),this.renderActions(),this.renderAfterActions())}},{key:"renderActions",value:function(){var r=this.props,a=r.config,i=r.addRule,o=r.addGroup,u=r.isLocked,s=r.isTrueLocked,l=r.id,c=r.parentField;return C.createElement(lh,{key:"group-actions",config:a,addRule:i,addGroup:o,canAddGroup:this.canAddGroup(),canAddRule:this.canAddRule(),canDeleteGroup:this.canDeleteGroup(),removeSelf:this.removeSelf,setLock:this.setLock,isLocked:u,isTrueLocked:s,id:l,parentField:c})}},{key:"canAddGroup",value:function(){return this.props.allowFurtherNesting}},{key:"canAddRule",value:function(){var r=this.props,a=r.totalRulesCnt,i=r.isMaxNestingExceeded,o=r.parentField,u=this.props.config.settings.maxNumberOfRules;if(o){var s=Zs(this.props.config,o);u=s.maxNumberOfRules}return i?!1:u?a<u:!0}},{key:"canDeleteGroup",value:function(){return!this.props.isRoot}},{key:"renderChildren",value:function(){var r=this.props.children1;return r?r.valueSeq().toArray().map(this.renderItem):null}},{key:"renderItem",value:function(r){if(r){var a=this.props,i=a.config,o=a.actions,u=a.onDragStart,s=a.isLocked,l=a.parentField,c=a.parentFieldPathSize,d=a.parentFieldCanReorder,f=r.get("type")=="group"&&r.getIn(["properties","field"])!=null,p=f?"rule_group":r.get("type");return C.createElement(tl,(0,Te.A)({key:r.get("id"),id:r.get("id"),groupId:a.id,path:r.get("path"),type:p,properties:r.get("properties"),config:i,actions:o,children1:r.get("children1"),parentField:l,parentFieldPathSize:c,parentFieldCanReorder:d,reordableNodesCnt:this.reordableNodesCntForItem(r),totalRulesCnt:this.totalRulesCntForItem(r),parentReordableNodesCnt:this.reordableNodesCnt(),onDragStart:u,isDraggingTempo:this.props.isDraggingTempo,isParentLocked:s},this.extraPropsForItem(r)))}}},{key:"extraPropsForItem",value:function(r){return{}}},{key:"reordableNodesCnt",value:function(){return this.props.isLocked?0:this.props.reordableNodesCnt}},{key:"totalRulesCntForItem",value:function(r){return r.get("type")==="rule_group"?PC(r):this.props.totalRulesCnt}},{key:"reordableNodesCntForItem",value:function(r){return this.props.isLocked?0:this.reordableNodesCnt()}},{key:"showDragIcon",value:function(){var r=this.props,a=r.config,i=r.isRoot,o=r.isLocked,u=r.parentField,s=r.parentFieldCanReorder,l=this.reordableNodesCnt(),c=a.settings.canReorder&&!i&&l>1&&!o;return u&&(c=c&&s),c}},{key:"renderDrag",value:function(){var r=this.props.handleDraggerMouseDown,a=this.Icon,i=C.createElement(a,{type:"drag"});return this.showDragIcon()&&C.createElement("div",{key:"group-drag-icon",onMouseDown:r,className:"qb-drag-handler group--drag-handler"},i)}},{key:"conjunctionOptions",value:function(){var r=this.props,a=r.parentField,i=r.conjunctionOptions;return a?this.conjunctionOptionsForGroupField(a):i}},{key:"conjunctionOptionsForGroupField",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,a=this.props,i=a.config,o=a.conjunctionOptions,u=Zs(i,r);if(u!=null&&u.conjunctions){var s={},l=TC(u.conjunctions),c;try{for(l.s();!(c=l.n()).done;){var d=c.value,f=o[d];f&&(s[d]=f)}}catch(p){l.e(p)}finally{l.f()}return s}return o}},{key:"renderConjs",value:function(){var r=this.props,a=r.config,i=r.children1,o=r.id,u=r.selectedConjunction,s=r.setConjunction,l=r.not,c=r.setNot,d=r.isLocked,f=a.settings,p=f.immutableGroupsMode,v=f.notLabel,g=this.conjunctionOptions();if(!this.showConjs()||!i||!i.size)return null;var h={disabled:this.isOneChild(),readonly:p||d,selectedConjunction:u,setConjunction:p?at:s,conjunctionOptions:g,config:a,not:l||!1,id:o,setNot:p?at:c,notLabel:v,showNot:this.showNot(),isLocked:d},y=this.Conjs;return C.createElement(y,(0,Te.A)({key:"group-conjs"},h))}},{key:"renderHeader",value:function(){return C.createElement("div",{key:"group-conjunctions",className:"group--conjunctions"},this.renderConjs(),this.renderDrag())}},{key:"render",value:function(){return C.createElement(C.Fragment,null,this.renderHeaderWrapper(),this.renderChildrenWrapper(),this.renderFooterWrapper())}}])}(C.Component);en.propTypes={reordableNodesCnt:w().number,conjunctionOptions:w().object.isRequired,allowFurtherNesting:w().bool.isRequired,isMaxNestingExceeded:w().bool,isRoot:w().bool.isRequired,not:w().bool,selectedConjunction:w().string,config:w().object.isRequired,id:w().string.isRequired,groupId:w().string,path:w().any,children1:w().any,isDraggingMe:w().bool,isDraggingTempo:w().bool,isLocked:w().bool,isTrueLocked:w().bool,parentField:w().string,handleDraggerMouseDown:w().func,onDragStart:w().func,addRule:w().func.isRequired,addGroup:w().func.isRequired,removeSelf:w().func.isRequired,setConjunction:w().func.isRequired,setNot:w().func.isRequired,setLock:w().func.isRequired,actions:w().object.isRequired};const DC=Si(Ta("group")(Ra(en)),"group");function VC(n,e){for(;!{}.hasOwnProperty.call(n,e)&&(n=(0,ue.A)(n))!==null;);return n}function Tt(){return Tt=typeof Reflect<"u"&&Reflect.get?Reflect.get.bind():function(n,e,t){var r=VC(n,e);if(r){var a=Object.getOwnPropertyDescriptor(r,e);return a.get?a.get.call(arguments.length<3?n:t):a.value}},Tt.apply(null,arguments)}function NC(n,e,t){return e=(0,ue.A)(e),(0,qe.A)(n,gh()?Reflect.construct(e,t||[],(0,ue.A)(n).constructor):e.apply(n,t))}function gh(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(gh=function(){return!!n})()}var kC=function(n){function e(){return(0,Ge.A)(this,e),NC(this,e,arguments)}return(0,Ue.A)(e,n),(0,ze.A)(e,[{key:"render",value:function(){var r=this.props,a=r.config,i=r.addRule,o=r.canAddRule,u=r.canDeleteGroup,s=r.removeSelf,l=r.setLock,c=r.isLocked,d=r.isTrueLocked,f=r.id,p=a.settings,v=p.immutableGroupsMode,g=p.addRuleLabel,h=p.delGroupLabel,y=p.renderButton,m=p.renderIcon,b=p.renderSwitch,O=p.renderButtonGroup,S=p.lockLabel,F=p.lockedLabel,_=p.showLock,T=p.canDeleteLocked,E=function(x){return m(x,a.ctx)},A=function(x){return y(x,a.ctx)},j=function(x){return b(x,a.ctx)},R=function(x){return O(x,a.ctx)},L=_&&!(c&&!d)&&C.createElement(j,{type:"lock",id:f,value:c,setValue:l,label:S,checkedLabel:F,hideLabel:!0,config:a}),N=!v&&o&&!c&&C.createElement(A,{type:"addSubRuleSimple",onClick:i,label:g,readonly:c,config:a,renderIcon:E}),I=!v&&u&&(!c||c&&T)&&C.createElement(A,{type:"delRuleGroup",onClick:s,label:h,config:a,renderIcon:E});return C.createElement("div",{className:"group--actions"},C.createElement(R,{config:a},L,N,I))}}])}(C.PureComponent);function hh(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),t.push.apply(t,r)}return t}function mh(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?hh(Object(t),!0).forEach(function(r){(0,z.A)(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):hh(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function MC(n,e,t){return e=(0,ue.A)(e),(0,qe.A)(n,yh()?Reflect.construct(e,t||[],(0,ue.A)(n).constructor):e.apply(n,t))}function yh(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(yh=function(){return!!n})()}var $C=Oe.ConfigUtils.getFieldConfig,bh=function(n){function e(t){var r;return(0,Ge.A)(this,e),r=MC(this,e,[t]),r.childrenClassName=function(){return"rule_group--children"},r.renderHeaderWrapper=function(){return null},r.renderFooterWrapper=function(){return null},r.renderConjs=function(){return null},r.canAddGroup=function(){return!1},r.canAddRule=function(){return!0},r.canDeleteGroup=function(){return!1},r}return(0,Ue.A)(e,n),(0,ze.A)(e,[{key:"onPropsChanged",value:function(r){Tt((0,ue.A)(e.prototype),"onPropsChanged",this).call(this,r)}},{key:"reordableNodesCntForItem",value:function(r){if(this.props.isLocked)return 0;var a=this.props.children1;return a?.size||0}},{key:"renderChildrenWrapper",value:function(){return C.createElement(C.Fragment,null,this.renderDrag(),this.renderField(),this.renderActions(),Tt((0,ue.A)(e.prototype),"renderChildrenWrapper",this).call(this))}},{key:"renderField",value:function(){var r=this.props,a=r.config,i=r.selectedField,o=r.selectedFieldSrc,u=r.selectedFieldType,s=r.setField,l=r.setFuncValue,c=r.setFieldSrc,d=r.parentField,f=r.id,p=r.groupId,v=r.isLocked,g=a.settings.immutableFieldsMode;return C.createElement(Xs,{key:"field",classname:"group--field",config:a,canSelectFieldSource:!1,selectedField:i,selectedFieldSrc:o,selectedFieldType:u,setField:s,setFuncValue:l,setFieldSrc:c,parentField:d,readonly:g||v,id:f,groupId:p})}},{key:"renderActions",value:function(){var r=this.props,a=r.config,i=r.addRule,o=r.isLocked,u=r.isTrueLocked,s=r.id;return C.createElement(kC,{config:a,addRule:i,canAddRule:this.canAddRule(),canDeleteGroup:this.canDeleteGroup(),removeSelf:this.removeSelf,setLock:this.setLock,isLocked:o,isTrueLocked:u,id:s})}},{key:"extraPropsForItem",value:function(r){var a,i=this.props,o=i.selectedField,u=i.lev,s=i.config,l=$C(s,o);return{parentField:o,parentFieldPathSize:u+1,parentFieldCanReorder:(a=l?.canReorder)!==null&&a!==void 0?a:s.settings.canReorder}}}])}(en);bh.propTypes=mh(mh({},en.propTypes),{},{selectedField:w().any,selectedFieldSrc:w().string,parentField:w().string,setField:w().func,setFieldSrc:w().func,lev:w().number});const GC=Si(Ta("group rule_group")(Ra(bh)),"rule_group");function zC(n,e,t){return e=(0,ue.A)(e),(0,qe.A)(n,Oh()?Reflect.construct(e,t||[],(0,ue.A)(n).constructor):e.apply(n,t))}function Oh(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Oh=function(){return!!n})()}var UC=function(n){function e(){return(0,Ge.A)(this,e),zC(this,e,arguments)}return(0,Ue.A)(e,n),(0,ze.A)(e,[{key:"render",value:function(){var r=this.props,a=r.config,i=r.addRule,o=r.addGroup,u=r.canAddRule,s=r.canAddGroup,l=r.canDeleteGroup,c=r.removeSelf,d=r.setLock,f=r.isLocked,p=r.isTrueLocked,v=r.id,g=a.settings,h=g.immutableGroupsMode,y=g.addSubRuleLabel,m=g.addSubGroupLabel,b=g.delGroupLabel,O=g.renderButton,S=g.renderIcon,F=g.renderSwitch,_=g.renderButtonGroup,T=g.lockLabel,E=g.lockedLabel,A=g.showLock,j=g.canDeleteLocked,R=function($){return S($,a.ctx)},L=function($){return O($,a.ctx)},N=function($){return F($,a.ctx)},I=function($){return _($,a.ctx)},P=A&&!(f&&!p)&&C.createElement(N,{type:"lock",id:v,value:f,setValue:d,label:T,checkedLabel:E,config:a}),x=!h&&u&&!f&&C.createElement(L,{type:"addSubRule",onClick:i,label:y,readonly:f,config:a,renderIcon:R}),k=!h&&s&&!f&&C.createElement(L,{type:"addSubGroup",onClick:o,label:m,readonly:f,config:a,renderIcon:R}),V=!h&&l&&(!f||f&&j)&&C.createElement(L,{type:"delRuleGroup",onClick:c,label:b,config:a,renderIcon:R});return C.createElement("div",{className:"group--actions group--actions--tr"},C.createElement(I,{config:a},P,x,k,V))}}])}(C.PureComponent);function Sh(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),t.push.apply(t,r)}return t}function Fh(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Sh(Object(t),!0).forEach(function(r){(0,z.A)(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Sh(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function WC(n,e,t){return e=(0,ue.A)(e),(0,qe.A)(n,_h()?Reflect.construct(e,t||[],(0,ue.A)(n).constructor):e.apply(n,t))}function _h(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(_h=function(){return!!n})()}var Ch=Oe.ConfigUtils,el=Ch.getFieldConfig,BC=Ch.getFieldWidgetConfig,qC=Oe.RuleUtils.isEmptyRuleGroupExtPropertiesAndChildren,HC=Oe.TreeUtils.getTotalReordableNodesCountInTree,wh=function(n){function e(t){var r;return(0,Ge.A)(this,e),r=WC(this,e,[t]),r.childrenClassName=function(){return"rule_group_ext--children"},r.renderFooterWrapper=function(){return null},r.canDeleteGroup=function(){return!0},r}return(0,Ue.A)(e,n),(0,ze.A)(e,[{key:"onPropsChanged",value:function(r){Tt((0,ue.A)(e.prototype),"onPropsChanged",this).call(this,r)}},{key:"canAddGroup",value:function(){return this.props.allowFurtherNesting}},{key:"canAddRule",value:function(){var r=this.props,a=r.config,i=r.selectedField,o=el(a,i),u=o.maxNumberOfRules,s=this.props.totalRulesCnt;return u?s<u:!0}},{key:"renderHeaderWrapper",value:function(){return C.createElement("div",{key:"group-header",className:Lt()("group--header",this.isOneChild()?"one--child":"",this.isOneChild()?"hide--line":"",this.isNoChildren()?"no--children":"",this.showDragIcon()?"with--drag":"hide--drag",this.showConjs()?"with--conjs":"hide--conjs")},this.renderHeader(),this.renderGroupField(),this.renderActions())}},{key:"renderHeader",value:function(){return C.createElement("div",{className:"group--conjunctions"},this.renderConjs(),this.renderDrag())}},{key:"renderGroupField",value:function(){return C.createElement("div",{className:"group--field--count--rule"},this.renderField(),this.renderOperator(),this.renderWidget(),this.renderError())}},{key:"renderError",value:function(){var r=this.props,a=r.config,i=r.valueError,o=a.settings,u=o.renderRuleError,s=o.showErrorMessage,l=(0,Q.A)(i?.toArray()||[]).filter(function(c){return!!c}).shift()||null;return s&&l&&C.createElement("div",{className:"rule_group--error"},u?u({error:l},a.ctx):l)}},{key:"showNot",value:function(){var r,a=this.props,i=a.config,o=a.selectedField,u=el(i,o);return(r=u?.showNot)!==null&&r!==void 0?r:i.settings.showNot}},{key:"conjunctionOptions",value:function(){var r=this.props.selectedField;return this.conjunctionOptionsForGroupField(r)}},{key:"renderField",value:function(){var r=this.props,a=r.config,i=r.selectedField,o=r.selectedFieldSrc,u=r.selectedFieldType,s=r.setField,l=r.setFieldSrc,c=r.setFuncValue,d=r.parentField,f=r.id,p=r.groupId,v=r.isLocked,g=a.settings.immutableFieldsMode;return C.createElement(Xs,{key:"field",classname:"rule--field",config:a,canSelectFieldSource:!1,selectedField:i,selectedFieldSrc:o,selectedFieldType:u,setField:s,setFuncValue:c,setFieldSrc:l,parentField:d,readonly:g||v,id:f,groupId:p})}},{key:"renderOperator",value:function(){var r=this.props,a=r.config,i=r.selectedField,o=r.selectedFieldSrc,u=r.selectedOperator,s=r.setField,l=r.setOperator,c=r.isLocked,d=a.settings.immutableFieldsMode,f=BC(a,i,u)||{},p=f.hideOperator,v=i&&p&&f.operatorInlineLabel,g=i&&!p;return C.createElement(wg,{key:"operator",classname:"group--operator",config:a,selectedField:i,selectedFieldSrc:o,selectedOperator:u,setOperator:l,showOperator:g,showOperatorLabel:v,selectedFieldWidgetConfig:f,readonly:d||c,id:this.props.id,groupId:this.props.groupId})}},{key:"isEmptyCurrentGroup",value:function(){var r=this.props,a=r.children1,i=r.config,o=this._buildWidgetProps(this.props);return qC(o,a,i)}},{key:"_buildWidgetProps",value:function(r){var a=r.selectedField,i=r.selectedFieldSrc,o=r.selectedFieldType,u=r.selectedOperator,s=r.operatorOptions,l=r.value,c=r.valueType,d=r.valueSrc,f=r.asyncListValues,p=r.valueError,v=r.fieldError,g=r.parentField;return{field:a,fieldSrc:i,fieldType:o,operator:u,operatorOptions:s,value:l,valueType:c,valueSrc:["value"],valueError:p,fieldError:null,parentField:g}}},{key:"renderWidget",value:function(){var r=this.props,a=r.config,i=r.selectedField,o=r.selectedOperator,u=r.isLocked,s=a.settings.immutableValuesMode,l=i&&o,c=l;if(!c)return null;var d=C.createElement(Oi,(0,Te.A)({key:"values",isForRuleGroup:!0},this._buildWidgetProps(this.props),{config:a,setValue:s?at:this.props.setValue,setValueSrc:at,readonly:s||u,id:this.props.id,groupId:this.props.groupId}));return C.createElement(Er,{key:"widget-for-"+this.props.selectedOperator,className:"rule--value"},d)}},{key:"renderActions",value:function(){var r=this.props,a=r.config,i=r.addRule,o=r.addGroup,u=r.isLocked,s=r.isTrueLocked,l=r.id;return C.createElement(UC,{config:a,addRule:i,addGroup:o,canAddRule:this.canAddRule(),canAddGroup:this.canAddGroup(),canDeleteGroup:this.canDeleteGroup(),removeSelf:this.removeSelf,setLock:this.setLock,isLocked:u,isTrueLocked:s,id:l})}},{key:"reordableNodesCntForItem",value:function(r){if(this.props.isLocked)return 0;var a=this.props,i=a.children1,o=a.id;return HC({id:o,type:"rule_group",children1:i})}},{key:"extraPropsForItem",value:function(r){var a,i=this.props,o=i.selectedField,u=i.lev,s=i.config,l=el(s,o);return{parentField:o,parentFieldPathSize:u+1,parentFieldCanReorder:(a=l?.canReorder)!==null&&a!==void 0?a:s.settings.canReorder}}}])}(en);wh.propTypes=Fh(Fh({},en.propTypes),{},{selectedField:w().any,selectedFieldSrc:w().string,selectedOperator:w().string,value:w().any,parentField:w().string,setField:w().func,setFieldSrc:w().func,setOperator:w().func,setValue:w().func,valueError:w().any,lev:w().number});const JC=Si(Ta("group rule_group_ext")(Ra(wh)),"rule_group");function YC(n,e,t){return e=(0,ue.A)(e),(0,qe.A)(n,Ah()?Reflect.construct(e,t||[],(0,ue.A)(n).constructor):e.apply(n,t))}function Ah(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Ah=function(){return!!n})()}var KC={topLeft:"group--actions--tl",topCenter:"group--actions--tc",topRight:"group--actions--tr",bottomLeft:"group--actions--bl",bottomCenter:"group--actions--bc",bottomRight:"group--actions--br"},QC="topRight",XC=function(n){function e(){return(0,Ge.A)(this,e),YC(this,e,arguments)}return(0,Ue.A)(e,n),(0,ze.A)(e,[{key:"render",value:function(){var r=this.props,a=r.config,i=r.addCaseGroup,o=r.addDefaultCaseGroup,u=r.setLock,s=r.isLocked,l=r.isTrueLocked,c=r.id,d=r.canAddGroup,f=r.canAddDefault,p=a.settings,v=p.immutableGroupsMode,g=p.addCaseLabel,h=p.addDefaultCaseLabel,y=p.groupActionsPosition,m=p.renderButton,b=p.renderIcon,O=p.renderSwitch,S=p.renderButtonGroup,F=p.lockLabel,_=p.lockedLabel,T=p.showLock,E=function(k){return b(k,a.ctx)},A=function(k){return m(k,a.ctx)},j=function(k){return O(k,a.ctx)},R=function(k){return S(k,a.ctx)},L=KC[y||QC],N=T&&!(s&&!l)&&C.createElement(j,{type:"lock",id:c,value:s,setValue:u,label:F,checkedLabel:_,config:a}),I=!v&&d&&!s&&C.createElement(A,{type:"addCaseGroup",onClick:i,label:g,readonly:s,config:a,renderIcon:E}),P=!v&&f&&!s&&C.createElement(A,{type:"addDefaultCaseGroup",onClick:o,label:h,readonly:s,config:a,renderIcon:E});return C.createElement("div",{className:"group--actions ".concat(L)},C.createElement(R,{config:a},N,I,P))}}])}(C.PureComponent);function Eh(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),t.push.apply(t,r)}return t}function ZC(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Eh(Object(t),!0).forEach(function(r){(0,z.A)(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Eh(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function ew(n,e,t){return e=(0,ue.A)(e),(0,qe.A)(n,Lh()?Reflect.construct(e,t||[],(0,ue.A)(n).constructor):e.apply(n,t))}function Lh(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Lh=function(){return!!n})()}var Th=Oe.TreeUtils,rw=Th.getTotalReordableNodesCountInTree,tw=Th.getTotalRulesCountInTree,jh=function(n){function e(t){var r;return(0,Ge.A)(this,e),r=ew(this,e,[t]),r.childrenClassName=function(){return"switch_group--children"},r.renderFooterWrapper=function(){return null},r.hasDefaultCase=function(){var a;return((a=r.props.children1)===null||a===void 0?void 0:a.size)&&r.props.children1.filter(function(i){return i.get("children1")==null}).size>0},r}return(0,Ue.A)(e,n),(0,ze.A)(e,[{key:"onPropsChanged",value:function(r){Tt((0,ue.A)(e.prototype),"onPropsChanged",this).call(this,r)}},{key:"canAddGroup",value:function(){var r,a=this.props.config.settings.maxNumberOfCases,i=((r=this.props.children1)===null||r===void 0?void 0:r.size)||0;return a?i<a:!0}},{key:"canAddRule",value:function(){return!1}},{key:"reordableNodesCnt",value:function(){var r,a=((r=this.props.children1)===null||r===void 0?void 0:r.size)||0,i=a;return this.hasDefaultCase()&&i--,i}},{key:"totalRulesCntForItem",value:function(r){return tw(r)}},{key:"reordableNodesCntForItem",value:function(r){var a;if(this.props.isLocked)return 0;var i=this.props.config.settings,o=i.canLeaveEmptyCase,u=i.canRegroupCases,s=((a=this.props.children1)===null||a===void 0?void 0:a.size)||0,l=s;this.hasDefaultCase()&&l--;var c=rw(r),d=c;return d==1&&u&&o&&l>1&&(d=111),d}},{key:"showConjs",value:function(){return!0}},{key:"renderHeaderWrapper",value:function(){return C.createElement("div",{key:"group-header",className:Lt()("group--header",this.isOneChild()?"one--child":"",this.isOneChild()?"hide--line":"",this.isNoChildren()?"no--children":"",this.showDragIcon()?"with--drag":"hide--drag",this.showConjs()?"with--conjs":"hide--conjs")},this.renderHeader(),this.renderActions())}},{key:"renderHeader",value:function(){return C.createElement("div",{className:"group--conjunctions"},this.renderConjs(),this.renderDrag())}},{key:"renderConjs",value:function(){var r=this.props.config,a=r.settings.renderSwitchPrefix;return a||null}},{key:"showNot",value:function(){return!1}},{key:"renderActions",value:function(){var r=this.props,a=r.config,i=r.addCaseGroup,o=r.addDefaultCaseGroup,u=r.isLocked,s=r.isTrueLocked,l=r.id;return C.createElement(XC,{config:a,addCaseGroup:i,addDefaultCaseGroup:o,canAddDefault:!this.hasDefaultCase(),canAddGroup:this.canAddGroup(),setLock:this.setLock,isLocked:u,isTrueLocked:s,id:l})}}])}(en);jh.propTypes=ZC({},en.propTypes);const nw=Si(Ta("group switch_group")(Ra(jh)),"switch_group");function Rh(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),t.push.apply(t,r)}return t}function xh(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Rh(Object(t),!0).forEach(function(r){(0,z.A)(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Rh(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function aw(n,e,t){return e=(0,ue.A)(e),(0,qe.A)(n,Ph()?Reflect.construct(e,t||[],(0,ue.A)(n).constructor):e.apply(n,t))}function Ph(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Ph=function(){return!!n})()}var Ih=function(n){function e(t){var r;return(0,Ge.A)(this,e),r=aw(this,e,[t]),r.childrenClassName=function(){return"case_group--children"},r.renderFooterWrapper=function(){return null},r}return(0,Ue.A)(e,n),(0,ze.A)(e,[{key:"onPropsChanged",value:function(r){var a=this.props,i=!this.renderBeforeCaseValue||a?.config!==r?.config;if(Tt((0,ue.A)(e.prototype),"onPropsChanged",this).call(this,r),i){var o=r.config,u=o.settings,s=u.renderBeforeCaseValue,l=u.renderAfterCaseValue,c=u.renderRuleError;this.BeforeCaseValue=it(o,s),this.AfterCaseValue=it(o,l),this.RuleError=it(o,c)}}},{key:"isDefaultCase",value:function(){return this.props.children1==null}},{key:"reordableNodesCnt",value:function(){return this.props.parentReordableNodesCnt}},{key:"reordableNodesCntForItem",value:function(r){return this.props.isLocked?0:this.props.reordableNodesCnt}},{key:"totalRulesCntForItem",value:function(r){return this.props.totalRulesCnt}},{key:"showDragIcon",value:function(){return this.isDefaultCase()?!1:Tt((0,ue.A)(e.prototype),"showDragIcon",this).call(this)}},{key:"renderHeaderWrapper",value:function(){return C.createElement("div",{key:"group-header",className:Lt()("group--header",this.isOneChild()?"one--child":"",this.isOneChild()?"hide--line":"",this.isNoChildren()?"no--children":"",this.showDragIcon()?"with--drag":"hide--drag",this.showConjs()&&(!this.isOneChild()||this.showNot())?"with--conjs":"hide--conjs")},this.renderHeaderLeft(),this.renderHeaderCenter(),this.renderActions())}},{key:"renderChildrenWrapper",value:function(){return this.isDefaultCase()?null:C.createElement("div",{className:"case_group--body"},this.renderCondition(),this.renderBeforeValue(),this.renderValue(),this.renderAfterValue())}},{key:"renderHeaderLeft",value:function(){if(this.isDefaultCase()){var r=this.props.config.settings.defaultCaseLabel;return r||""}return C.createElement("div",{className:"group--conjunctions"},this.renderConjs(),this.renderDrag(),this.renderError())}},{key:"renderCondition",value:function(){return this.isDefaultCase()?null:Tt((0,ue.A)(e.prototype),"renderChildrenWrapper",this).call(this)}},{key:"renderHeaderCenter",value:function(){return this.isDefaultCase()?C.createElement("div",null,this.renderValue(),this.renderError()):null}},{key:"canAddGroup",value:function(){return this.isDefaultCase()?!1:Tt((0,ue.A)(e.prototype),"canAddGroup",this).call(this)}},{key:"canAddRule",value:function(){return this.isDefaultCase()?!1:Tt((0,ue.A)(e.prototype),"canAddRule",this).call(this)}},{key:"renderBeforeValue",value:function(){var r=this.BeforeCaseValue;return r==null?null:C.createElement(r,(0,Te.A)({key:"values-before"},this.props))}},{key:"renderAfterValue",value:function(){var r=this.AfterCaseValue;return r==null?null:C.createElement(r,(0,Te.A)({key:"values-after"},this.props))}},{key:"renderError",value:function(){var r=this.props,a=r.config,i=r.valueError,o=a.settings.showErrorMessage,u=this.RuleError,s=(0,Q.A)(i?.toArray()||[]).filter(function(l){return!!l}).shift()||null;return o&&s&&C.createElement("div",{className:"rule--error"},u?C.createElement(u,{error:s}):s)}},{key:"renderValue",value:function(){var r=this.props,a=r.config,i=r.isLocked,o=r.value,u=r.valueSrc,s=r.valueError,l=r.setValue,c=r.setValueSrc,d=r.setFuncValue,f=r.id,p=a.settings.immutableValuesMode,v=C.createElement(Oi,{key:"values",isCaseValue:!0,field:"!case_value",operator:null,value:o,valueSrc:u??"value",valueError:s,fieldError:null,config:a,setValue:p?at:l,setValueSrc:p?at:c,setFuncValue:p?at:d,readonly:p||i,id:f,groupId:null});return C.createElement(Er,{className:"case_group--value"},v)}},{key:"renderActions",value:function(){var r=this.props,a=r.config,i=r.addGroup,o=r.addRule,u=r.isLocked,s=r.isTrueLocked,l=r.id;return C.createElement(lh,{config:a,addGroup:i,addRule:o,canAddRule:this.canAddRule(),canAddGroup:this.canAddGroup(),canDeleteGroup:this.canDeleteGroup(),removeSelf:this.removeSelf,setLock:this.setLock,isLocked:u,isTrueLocked:s,id:l})}},{key:"isEmptyCurrentGroup",value:function(){var r=this.props.value,a=r&&r.size?r.get(0):null,i=a!=null&&(Array.isArray(a)?a.length>0:!0);return Tt((0,ue.A)(e.prototype),"isEmptyCurrentGroup",this).call(this)&&!i}}])}(en);Ih.propTypes=xh(xh({},en.propTypes),{},{parentReordableNodesCnt:w().number,value:w().any,setValue:w().func});const iw=Si(Ta("group case_group")(Ra(Ih)),"case_group");var ow=["type"];function uw(n,e,t){return e=(0,ue.A)(e),(0,qe.A)(n,Dh()?Reflect.construct(e,t||[],(0,ue.A)(n).constructor):e.apply(n,t))}function Dh(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Dh=function(){return!!n})()}function Vh(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),t.push.apply(t,r)}return t}function rl(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Vh(Object(t),!0).forEach(function(r){(0,z.A)(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Vh(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}var sw=["rule","group","rule_group","switch_group","case_group"],xa=function(e){var t,r=((t=e.properties)===null||t===void 0?void 0:t.toObject())||{},a=rl({},r);return e.isParentLocked&&(a.isLocked=!0),r.isLocked&&(a.isTrueLocked=!0),a},lw={rule:function(e){return C.createElement(OC,(0,Te.A)({},xa(e),{id:e.id,groupId:e.groupId,path:e.path,actions:e.actions,reordableNodesCnt:e.reordableNodesCnt,totalRulesCnt:e.totalRulesCnt,config:e.config,onDragStart:e.onDragStart,isDraggingTempo:e.isDraggingTempo,parentField:e.parentField,parentFieldPathSize:e.parentFieldPathSize,parentReordableNodesCnt:e.parentReordableNodesCnt,parentFieldCanReorder:e.parentFieldCanReorder}))},group:function(e){return C.createElement(DC,(0,Te.A)({},xa(e),{id:e.id,groupId:e.groupId,path:e.path,actions:e.actions,config:e.config,reordableNodesCnt:e.reordableNodesCnt,totalRulesCnt:e.totalRulesCnt,onDragStart:e.onDragStart,isDraggingTempo:e.isDraggingTempo,children1:e.children1,parentField:e.parentField,parentFieldPathSize:e.parentFieldPathSize,parentReordableNodesCnt:e.parentReordableNodesCnt,parentFieldCanReorder:e.parentFieldCanReorder}))},rule_group:function(e){return C.createElement(GC,(0,Te.A)({},xa(e),{id:e.id,groupId:e.groupId,path:e.path,actions:e.actions,config:e.config,reordableNodesCnt:e.reordableNodesCnt,totalRulesCnt:e.totalRulesCnt,onDragStart:e.onDragStart,isDraggingTempo:e.isDraggingTempo,children1:e.children1,parentField:e.parentField,parentFieldPathSize:e.parentFieldPathSize,parentReordableNodesCnt:e.parentReordableNodesCnt,parentFieldCanReorder:e.parentFieldCanReorder}))},rule_group_ext:function(e){return C.createElement(JC,(0,Te.A)({},xa(e),{id:e.id,groupId:e.groupId,path:e.path,actions:e.actions,config:e.config,reordableNodesCnt:e.reordableNodesCnt,totalRulesCnt:e.totalRulesCnt,onDragStart:e.onDragStart,isDraggingTempo:e.isDraggingTempo,children1:e.children1,parentField:e.parentField,parentFieldPathSize:e.parentFieldPathSize,parentReordableNodesCnt:e.parentReordableNodesCnt,parentFieldCanReorder:e.parentFieldCanReorder}))},switch_group:function(e){return C.createElement(nw,(0,Te.A)({},xa(e),{id:e.id,groupId:e.groupId,path:e.path,actions:e.actions,config:e.config,reordableNodesCnt:e.reordableNodesCnt,totalRulesCnt:e.totalRulesCnt,onDragStart:e.onDragStart,isDraggingTempo:e.isDraggingTempo,children1:e.children1,parentField:null,parentReordableNodesCnt:e.parentReordableNodesCnt}))},case_group:function(e){return C.createElement(iw,(0,Te.A)({},xa(e),{id:e.id,groupId:e.groupId,path:e.path,actions:e.actions,config:e.config,reordableNodesCnt:e.reordableNodesCnt,totalRulesCnt:e.totalRulesCnt,onDragStart:e.onDragStart,isDraggingTempo:e.isDraggingTempo,children1:e.children1,parentField:null,parentReordableNodesCnt:e.parentReordableNodesCnt}))}},tl=function(n){function e(){return(0,Ge.A)(this,e),uw(this,e,arguments)}return(0,Ue.A)(e,n),(0,ze.A)(e,[{key:"render",value:function(){var r,a=this.props,i=a.type,o=(0,Wn.A)(a,ow),u=(r=o.properties)===null||r===void 0?void 0:r.get("mode"),s=u=="array"?"_ext":"",l=o.config.settings.renderItem,c=lw[i+s];return l?l(rl(rl({},o),{},{type:i,itemComponent:c}),o.config.ctx):c?c(o):null}}])}(C.PureComponent);tl.propTypes={config:w().object.isRequired,id:w().string.isRequired,groupId:w().string,type:w().oneOf(sw).isRequired,path:w().any.isRequired,properties:w().any,children1:w().any,actions:w().object.isRequired,reordableNodesCnt:w().number,onDragStart:w().func,parentField:w().string,isDraggingTempo:w().bool,isParentLocked:w().bool};function cw(n,e,t){return e=(0,ue.A)(e),(0,qe.A)(n,Nh()?Reflect.construct(e,t||[],(0,ue.A)(n).constructor):e.apply(n,t))}function Nh(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Nh=function(){return!!n})()}var kh=Oe.TreeUtils,dw=kh.getTotalReordableNodesCountInTree,fw=kh.getTotalRulesCountInTree,Mh=Oe.DefaultUtils,pw=Mh.createListWithOneElement,$h=Mh.emptyProperties,Gh=function(n){function e(t){var r;return(0,Ge.A)(this,e),r=cw(this,e,[t]),r.pureShouldComponentUpdate=La(r),r._updPath(t),r}return(0,Ue.A)(e,n),(0,ze.A)(e,[{key:"shouldComponentUpdate",value:function(r,a){var i=this.pureShouldComponentUpdate(r,a);return i}},{key:"_updPath",value:function(r){var a=r.tree.get("id");this.path=pw(a)}},{key:"render",value:function(){var r=this.props,a=r.tree,i=r.config,o=r.actions,u=r.onDragStart,s=a.get("type"),l=s=="switch_group",c=l?null:dw(a),d=l?null:fw(a),f=a.get("id");return C.createElement(tl,{key:f,id:f,path:this.path,type:s,properties:a.get("properties")||$h(),config:i,actions:o,children1:a.get("children1")||$h(),reordableNodesCnt:c,totalRulesCnt:d,parentReordableNodesCnt:0,onDragStart:u})}}])}(C.Component);Gh.propTypes={tree:w().any.isRequired,config:w().object.isRequired,actions:w().object.isRequired,onDragStart:w().func};const vw=T_(Gh);function zh(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),t.push.apply(t,r)}return t}function gw(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?zh(Object(t),!0).forEach(function(r){(0,z.A)(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):zh(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function hw(n,e,t){return e=(0,ue.A)(e),(0,qe.A)(n,Uh()?Reflect.construct(e,t||[],(0,ue.A)(n).constructor):e.apply(n,t))}function Uh(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Uh=function(){return!!n})()}var mw=Oe.clone,nl=Oe.ConfigUtils,Fi=nl.getFieldConfig,Wh=nl.getFieldParts,Bh=nl.getFieldPathParts,qh=Oe.RuleUtils,Hh=qh.getFieldPathLabels,yw=qh.getWidgetForFieldOp,Jh=function(n){function e(t){var r;return(0,Ge.A)(this,e),r=hw(this,e,[t]),nt(r),r.onPropsChanged(t),r}return(0,Ue.A)(e,n),(0,ze.A)(e,[{key:"onPropsChanged",value:function(r){var a=this.props,i=["config","field","fieldSrc","fieldType","operator","isFuncArg","parentField"],o=["config","field","fieldSrc","fieldType","operator","value","placeholder","isFuncArg","parentField"],u=!this.items||i.map(function(l){return r[l]!==a[l]}).filter(function(l){return l}).length>0,s=!this.meta||o.map(function(l){return r[l]!==a[l]}).filter(function(l){return l}).length>0;u&&(this.items=this.getItems(r)),s&&(this.meta=this.getMeta(r))}},{key:"getItems",value:function(r){var a=r.config,i=r.field,o=r.fieldType,u=r.operator,s=r.parentField,l=r.isFuncArg,c=r.fieldDefinition,d=a.settings.canCompareFieldWithField,f=Wh(s,a),p=s?Fi(a,s):null,v=s?p?.subfields:a.fields,g=this.filterFields(a,v,i,s,f,u,d,l,c,o),h=this.buildOptions(f,a,g,f);return h}},{key:"getMeta",value:function(r){var a,i=r.config,o=r.field,u=r.fieldType,s=r.operator,l=r.value,c=r.placeholder,d=r.isFuncArg,f=r.parentField,p=i.settings,v=p.fieldPlaceholder,g=p.fieldSeparatorDisplay,h=l,y=!!l,m=o?Fi(i,o):{},b=m==null||(a=m.widgets)===null||a===void 0?void 0:a.field,O=b?.widgetProps||{},S=y?null:d&&c||O.valuePlaceholder||v,F=y?Fi(i,h):null,_=F||{},T=Bh(h,i),E=Bh(h,i,!0),A=this.getFieldLabel(F,h,i),j=Hh(h,i),R=j?j.join(g):null;(R==A||f)&&(R=null);var L=_.label2||_.tooltip;return{placeholder:S,selectedKey:h,selectedKeys:T,selectedPath:E,selectedLabel:A,selectedOpts:_,selectedAltLabel:L,selectedFullLabel:R}}},{key:"filterFields",value:function(r,a,i,o,u,s,l,c,d,f){a=mw(a);var p=r.settings.fieldSeparator,v=Fi(r,i),g=!1,h=yw(r,i,s,"value"),y=r.widgets[h],m;c?m=d?.type:g&&y?m=y.type:v?m=v.type:m=f;function b(O,S){for(var F in O){var _=O[F].subfields,T=(S||[]).concat(F),E=T.join(p),A=Fi(r,E);if(!A)delete O[F];else if(A.type=="!struct"||A.type=="!group")b(_,T)==0&&delete O[F];else{var j=(!m||A.type==m)&&(c?!0:E!=i),R=l||r.settings.canCompareFieldWithField;R&&(j=j&&R(i,v,E,A,s)),j||delete O[F]}}return ja()(O).length}return b(a,u||[]),a}},{key:"buildOptions",value:function(r,a,i){var o=this,u=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null,s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:null;if(!i)return null;var l=a.settings,c=l.fieldSeparator,d=l.fieldSeparatorDisplay,f=u!=null&&u.length?u.join(c)+c:"";return ja()(i).map(function(p){var v=[].concat((0,Q.A)(u??[]),[p]),g=i[p],h=o.getFieldLabel(g,v,a),y=Hh(v,a),m=y.join(d);(m==h||r)&&(m=null);var b=g.label2,O=g.tooltip;if(!g.hideForCompare)return g.type=="!struct"||g.type=="!group"?{key:p,path:f+p,label:h,fullLabel:m,altLabel:b,tooltip:O,items:o.buildOptions(r,a,g.subfields,v,{label:h,tooltip:O})}:{key:p,path:f+p,label:h,fullLabel:m,altLabel:b,tooltip:O,grouplabel:s?.label,group:s}}).filter(function(p){return!!p})}},{key:"getFieldLabel",value:function(r,a,i){if(!a)return null;var o=i.settings.maxLabelsLength,u=Wh(a,i),s=r?.label||Ji()(u);return s=Co(s,o),s}},{key:"render",value:function(){var r=this.props,a=r.config,i=r.customProps,o=r.setValue,u=r.readonly,s=r.id,l=r.groupId,c=a.settings.renderField,d=gw({isValueField:!0,config:a,customProps:i,setField:o,readonly:u,items:this.items,id:s,groupId:l},this.meta);return c(d,a.ctx)}}])}(C.Component);Jh.propTypes={id:w().string,groupId:w().string,setValue:w().func.isRequired,config:w().object.isRequired,field:w().any,fieldSrc:w().string,fieldType:w().string,value:w().string,operator:w().string,customProps:w().object,readonly:w().bool,parentField:w().string,fieldDefinition:w().object,isFuncArg:w().bool};const bw=function(n){var e=n.value,t=n.setValue,r=n.config,a=n.labelYes,i=n.labelNo,o=n.readonly,u=n.widgetId,s=n.customProps,l=s===void 0?{}:s,c=l.radioYes||{},d=l.radioNo||{},f=function(g){return t(g.target.checked)},p=function(g){return t(g.target.value=="true")};return C.createElement(C.Fragment,null,C.createElement("input",(0,Te.A)({type:"radio",value:!0,checked:!!e,disabled:o,onChange:p},c))," ",a,C.createElement("input",(0,Te.A)({type:"radio",value:!1,checked:!e,disabled:o,onChange:p},d))," ",i)},Ow=function(n){var e=n.value,t=n.setValue,r=n.config,a=n.readonly,i=n.placeholder,o=n.maxLength,u=n.customProps,s=function(d){var f=d.target.value;f===""&&(f=void 0),t(f)},l=e||"";return C.createElement("input",(0,Te.A)({type:"text",value:l,placeholder:i,disabled:a,onChange:s,maxLength:o},u))},Sw=function(n){var e=n.value,t=n.setValue,r=n.config,a=n.readonly,i=n.placeholder,o=n.maxLength,u=n.maxRows,s=n.fullWidth,l=n.customProps,c=function(p){var v=p.target.value;v===""&&(v=void 0),t(v)},d=e||"";return C.createElement("textarea",(0,Te.A)({value:d,placeholder:i,disabled:a,onChange:c,maxLength:o,style:{width:s?"100%":void 0}},l))};var OE=Oe.moment;const Fw=function(n){var e=n.value,t=n.setValue,r=n.config,a=n.valueFormat,i=n.readonly,o=n.customProps,u=function(l){var c=l.target.value;c==""&&(c=void 0),t(c)};return C.createElement("input",(0,Te.A)({type:"date",value:e||"",disabled:i,onChange:u},o))},_w=function(n){var e=n.value,t=n.setValue,r=n.config,a=n.valueFormat,i=n.use12Hours,o=n.readonly,u=n.customProps,s=function(c){var d=c.target.value;d==""&&(d=void 0),t(d)};return C.createElement("input",(0,Te.A)({type:"time",value:e||"",disabled:o,onChange:s},u))};var Yh=Oe.moment;const Cw=function(n){var e=n.value,t=n.setValue,r=n.config,a=n.valueFormat,i=n.use12Hours,o=n.readonly,u=n.customProps,s=function(d){var f=d.target.value;f==""?f=void 0:f=Yh(new Date(f)).format(a),t(f)},l=e;return e?l=Yh(e).format("YYYY-MM-DDTHH:mm"):l="",C.createElement("input",(0,Te.A)({type:"datetime-local",value:l,disabled:o,onChange:s},u))};var ww=Oe.ListUtils.mapListValues;const Aw=function(n){var e=n.listValues,t=n.value,r=n.setValue,a=n.allowCustomValues,i=n.readonly,o=n.customProps,u=function(){return ww(e,function(d){var f=d.title,p=d.value;return C.createElement("option",{key:p,value:p},f)})},s=function(d){for(var f=[],p=d.options,v=0;v<p.length;v++){var g=p[v];g.selected&&f.push(g.value)}return f.length||(f=void 0),f},l=function(d){return r(s(d.target))};return C.createElement("select",(0,Te.A)({multiple:!0,onChange:l,value:t,disabled:i},Yi()(o,["showSearch","input","showCheckboxes"])),u())};var Ew=Oe.ListUtils.mapListValues;const Lw=function(n){var e=n.listValues,t=n.value,r=n.setValue,a=n.allowCustomValues,i=n.readonly,o=n.customProps,u=function(){return Ew(e,function(d){var f=d.title,p=d.value;return C.createElement("option",{key:p,value:p},f)})},s=function(d){return r(d.target.value)},l=t!=null;return C.createElement("select",(0,Te.A)({onChange:s,value:l?t:"",disabled:i},Yi()(o,["showSearch","input"])),!l&&C.createElement("option",{disabled:!0,value:""}),u())},Tw=function(n){var e=n.value,t=n.setValue,r=n.config,a=n.readonly,i=n.min,o=n.max,u=n.step,s=n.placeholder,l=n.customProps,c=function(p){var v=p.target.value;v===""||v===null?v=void 0:v=Number(v),t(v)},d=e??"";return C.createElement("input",(0,Te.A)({type:"number",value:d,placeholder:s,disabled:a,min:i,max:o,step:u,onChange:c},l))},jw=function(n){var e=n.value,t=n.setValue,r=n.config,a=n.readonly,i=n.min,o=n.max,u=n.step,s=n.placeholder,l=n.customProps,c=l===void 0?{}:l,d=c.input||{},f=c.slider||c,p=function(h){var y=h.target.value;y===""||y===null?y=void 0:y=Number(y),t(y)},v=e??"";return C.createElement("div",{style:{display:"inline-flex"}},C.createElement("input",(0,Te.A)({key:"number",type:"number",value:v,placeholder:s,disabled:a,min:i,max:o,step:u,onChange:p},d)),C.createElement("input",(0,Te.A)({key:"range",type:"range",value:v,disabled:a,min:i,max:o,step:u,onChange:p},f)))},Rw=function(n){var e=n.items,t=n.setField,r=n.selectedKey,a=n.readonly,i=n.errorText,o=function l(c){return c.map(function(d){var f=d.items,p=d.path,v=d.label,g=d.disabled,h=d.matchesType;if(f)return C.createElement("optgroup",{disabled:g,key:p,label:v},l(f));var y=h?{fontWeight:"bold"}:{};return C.createElement("option",{disabled:g,key:p,value:p,style:y},v)})},u=function(c){return t(c.target.value)},s=r!=null;return C.createElement("select",{onChange:u,value:s?r:"",disabled:a,style:{color:i?"red":null}},!s&&C.createElement("option",{disabled:!0,value:""}),o(e))},xw=function(n){var e=n.id,t=n.not,r=n.setNot,a=n.conjunctionOptions,i=n.setConjunction,o=n.disabled,u=n.readonly,s=n.config,l=n.showNot,c=n.notLabel,d=Object.keys(a).length,f=o,p=s.settings.forceShowConj,v=p||d>1&&!f,g=function(){return Object.keys(a).map(function(O){var S=a[O],F=S.id,_=S.name,T=S.label,E=S.checked,A=i.isDummyFn?"__dummy":"";return(u||o)&&!E?null:[C.createElement("input",{key:F+A,type:"radio",id:F+A,name:_+A,checked:E,disabled:u||o,value:O,onChange:y}),C.createElement("label",{key:F+A+"label",htmlFor:F+A},T)]})},h=function(){var O="not";return[C.createElement("input",{key:e+O,type:"checkbox",id:e+O,checked:t,disabled:u,onChange:m}),C.createElement("label",{key:e+O+"label",htmlFor:e+O},c||"NOT")]},y=function(O){return i(O.target.value)},m=function(O){return r(O.target.checked)};return[l&&h(),v&&g()]};var Pw={addSubRuleSimple:"+",addSubRule:"+",addSubGroup:"+",delGroup:"x",delRuleGroup:"x",delRule:"x"};const Iw=function(n){var e=n.type,t=n.label,r=n.onClick,a=n.readonly,i=t||Pw[e];return C.createElement("button",{onClick:r,type:"button",disabled:a},i)},Dw=function(n){var e=n.type,t={},r=t[e]||null;return!r&&e==="drag"&&(r=C.createElement(Fg,null)),r},Vw=function(n){var e=n.children,t=n.config;return C.createElement(C.Fragment,null,e)},Nw=function(n){var e=n.config,t=n.valueSources,r=n.valueSrc,a=n.title,i=n.setValueSrc,o=n.readonly,u=function(c){return c.map(function(d){var f=(0,ie.A)(d,2),p=f[0],v=f[1];return C.createElement("option",{key:p,value:p},v.label)})},s=function(c){return i(c.target.value)};return C.createElement("select",{onChange:s,value:r||"",disabled:o},u(t))},kw=function(n){var e=n.value,t=n.setValue,r=n.label,a=n.id,i=n.config,o=n.type,u=function(c){return t(c.target.checked)},s=o;return[C.createElement("input",{key:a+s,type:"checkbox",id:a+s,checked:!!e,onChange:u}),C.createElement("label",{key:a+s+"label",htmlFor:a+s},r)]},Mw=function(n){var e=n.onOk,t=n.okText,r=n.cancelText,a=n.title;confirm(a)&&e()};var $w=function(e){var t=e.config,r=e.children;return r};function Gw(n,e,t){return e=(0,ue.A)(e),(0,qe.A)(n,Kh()?Reflect.construct(e,t||[],(0,ue.A)(n).constructor):e.apply(n,t))}function Kh(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Kh=function(){return!!n})()}var al=function(n){function e(){var t;(0,Ge.A)(this,e);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return t=Gw(this,e,[].concat(a)),t.handleChange=function(o){t.props.setOption("proximity",parseInt(o))},t}return(0,Ue.A)(e,n),(0,ze.A)(e,[{key:"render",value:function(){var r=this.props,a=r.defaults,i=r.options,o=r.config,u=r.optionLabel,s=r.optionPlaceholder,l=r.customProps,c=r.minProximity,d=r.maxProximity,f=r.optionTextBefore,p=r.readonly,v=o.settings,g=o.widgets,h=o.ctx,y=a?a.proximity:void 0,m=v.showLabels,b=i.get("proximity",y),O=Hs()(c,d+1).map(function(_){return{title:_,value:_}}),S=g.select.factory,F=function(T){return S(T,h)};return C.createElement("div",{className:"operator--PROXIMITY"},C.createElement("div",{className:"operator--options"},m&&C.createElement("label",{className:"rule--label"},u),!m&&f&&C.createElement("div",{className:"operator--options--sep"},C.createElement("span",null,f)),C.createElement(F,(0,Te.A)({config:o,value:b,listValues:O,setValue:this.handleChange,readonly:p,placeholder:s},l))),C.createElement("div",{className:"operator--widgets"},this.props.children))}}])}(C.PureComponent);al.propTypes={config:w().object.isRequired,setOption:w().func.isRequired,options:w().any.isRequired,minProximity:w().number,maxProximity:w().number,optionPlaceholder:w().string,optionTextBefore:w().string,optionLabel:w().string,customProps:w().object,readonly:w().bool},al.defaultProps={customProps:{},minProximity:2,maxProximity:10,optionPlaceholder:"Select words between",optionLabel:"Words between",optionTextBefore:null};function Qh(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),t.push.apply(t,r)}return t}function Se(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Qh(Object(t),!0).forEach(function(r){(0,z.A)(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Qh(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}var zw=Se({},fr.conjunctions),Uw=Se(Se({},fr.operators),{},{proximity:Se(Se({},fr.operators.proximity),{},{options:Se(Se({},fr.operators.proximity.options),{},{factory:function(e,t){var r=t.RCE,a=t.O.ProximityOperator;return r(a,e)}})})}),Ww={text:Se(Se({},fr.widgets.text),{},{factory:function(e,t){var r=t.RCE,a=t.W.VanillaTextWidget;return r(a,e)}}),textarea:Se(Se({},fr.widgets.textarea),{},{factory:function(e,t){var r=t.RCE,a=t.W.VanillaTextAreaWidget;return r(a,e)}}),number:Se(Se({},fr.widgets.number),{},{factory:function(e,t){var r=t.RCE,a=t.W.VanillaNumberWidget;return r(a,e)}}),slider:Se(Se({},fr.widgets.slider),{},{factory:function(e,t){var r=t.RCE,a=t.W.VanillaSliderWidget;return r(a,e)}}),select:Se(Se({},fr.widgets.select),{},{factory:function(e,t){var r=t.RCE,a=t.W.VanillaSelectWidget;return r(a,e)}}),multiselect:Se(Se({},fr.widgets.multiselect),{},{factory:function(e,t){var r=t.RCE,a=t.W.VanillaMultiSelectWidget;return r(a,e)}}),date:Se(Se({},fr.widgets.date),{},{factory:function(e,t){var r=t.RCE,a=t.W.VanillaDateWidget;return r(a,e)}}),time:Se(Se({},fr.widgets.time),{},{factory:function(e,t){var r=t.RCE,a=t.W.VanillaTimeWidget;return r(a,e)}}),datetime:Se(Se({},fr.widgets.datetime),{},{factory:function(e,t){var r=t.RCE,a=t.W.VanillaDateTimeWidget;return r(a,e)}}),boolean:Se(Se({},fr.widgets.boolean),{},{factory:function(e,t){var r=t.RCE,a=t.W.VanillaBooleanWidget;return r(a,e)}}),field:Se(Se({},fr.widgets.field),{},{factory:function(e,t){var r=t.RCE,a=t.W.ValueFieldWidget;return r(a,e)},customProps:{showSearch:!0}}),func:Se(Se({},fr.widgets.func),{},{factory:function(e,t){var r=t.RCE,a=t.W.FuncWidget;return r(a,e)},customProps:{}}),case_value:Se(Se({},fr.widgets.case_value),{},{factory:function(e,t){var r=t.RCE,a=t.W.VanillaTextWidget;return r(a,e)}})},Bw=Se(Se({},fr.types),{},{select:Se(Se({},fr.types.select),{},{widgets:Se(Se({},fr.types.select.widgets),{},{select:Se(Se({},fr.types.select.widgets.select),{},{widgetProps:{customProps:{showSearch:!0}}})})})}),qw=Se(Se({},fr.settings),{},{renderField:function(e,t){var r=t.RCE,a=t.W.VanillaFieldSelect;return r(a,e)},renderOperator:function(e,t){var r=t.RCE,a=t.W.VanillaFieldSelect;return r(a,e)},renderFunc:function(e,t){var r=t.RCE,a=t.W.VanillaFieldSelect;return r(a,e)},renderConjs:function(e,t){var r=t.RCE,a=t.W.VanillaConjs;return r(a,e)},renderSwitch:function(e,t){var r=t.RCE,a=t.W.VanillaSwitch;return r(a,e)},renderButton:function(e,t){var r=t.RCE,a=t.W.VanillaButton;return r(a,e)},renderIcon:function(e,t){var r=t.RCE,a=t.W.VanillaIcon;return r(a,e)},renderButtonGroup:function(e,t){var r=t.RCE,a=t.W.VanillaButtonGroup;return r(a,e)},renderProvider:function(e,t){var r=t.RCE,a=t.W.VanillaProvider;return r(a,e)},renderValueSources:function(e,t){var r=t.RCE,a=t.W.VanillaValueSources;return r(a,e)},renderFieldSources:function(e,t){var r=t.RCE,a=t.W.VanillaValueSources;return r(a,e)},renderConfirm:function(e,t){var r=t.W.vanillaConfirm;return r(e)},renderSwitchPrefix:"IF",renderBeforeCaseValue:function(e,t){var r=t.RCE;return r("span",{children:[" then "]})},customFieldSelectProps:{showSearch:!0},customOperatorSelectProps:{},defaultSliderWidth:"200px",defaultSelectWidth:"200px",defaultSearchWidth:"100px",defaultMaxRows:5,renderSize:"small",maxLabelsLength:100,showLock:!1,showNot:!0,forceShowConj:!1,groupActionsPosition:"topRight"}),Hw=Se(Se({},fr.ctx),{},{W:Se({},Kn),O:Se({},dn),RCE:function(e,t){return C.createElement(e,t)}}),il={conjunctions:zw,operators:Uw,widgets:Ww,types:Bw,settings:qw,ctx:Hw};il=Oe.ConfigMixins.removeMixins(il,["rangeslider","treeselect","treemultiselect"]);const Lr=il;var SE=D(38221);function Xh(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),t.push.apply(t,r)}return t}function To(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Xh(Object(t),!0).forEach(function(r){_defineProperty(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Xh(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}var _i=Oe.Autocomplete,jo=_i.mergeListValues,Zh=_i.listValueToOption,Jw=_i.optionToListValue,Yw=_i.optionsToListValues,Kw=_i.fixListValuesGroupOrder,Pa=Oe.ListUtils,Qw=Pa.mapListValues,Ro=Pa.listValuesToArray,xo=Pa.getListValue,Xw=Pa.makeCustomListValue,Zw=Pa.searchListValue,FE=Pa.getItemInListValues;function em(n){return new Promise(function(e){setTimeout(e,n)})}var _E=function(e,t){var r=e.asyncFetch,a=e.useLoadMore,i=e.useAsyncSearch,o=e.forceAsyncSearch,u=e.asyncListValues,s=e.listValues,l=e.allowCustomValues,c=e.value,d=e.setValue,f=e.placeholder,p=e.config,v=t.debounceTimeout,g=t.multiple,h=t.uif,y=t.isFieldAutocomplete,m=["LOAD_MORE","LOADING_MORE"],b="Load more...",O="Loading more...",S=o?"Type to search":f,F=React.useState(!1),_=_slicedToArray(F,2),T=_[0],E=_[1],A=React.useState(void 0),j=_slicedToArray(A,2),R=j[0],L=j[1],N=React.useState(0),I=_slicedToArray(N,2),P=I[0],x=I[1],k=React.useState(!1),V=_slicedToArray(k,2),G=V[0],$=V[1],W=React.useState(""),q=_slicedToArray(W,2),J=q[0],K=q[1],U=React.useState(void 0),X=_slicedToArray(U,2),Y=X[0],ae=X[1],ge=React.useRef(0),se=React.useRef(0),ce=React.useRef(!1),de=React.useMemo(function(){return Ro(u)},[u]),ne=React.useMemo(function(){return r?u?jo(Y,de,!0):Y:Ro(s)},[r,u,Y,s]),ve=r?Y:Ro(s);l&&J&&!Zw(J,Y)&&(ve=jo(ve,[Xw(J)],!0)),r&&!Y&&u&&!J&&!T&&h==="antd"&&(ve=ne),r&&!l&&u&&h==="mui"&&(ve=jo(ve,de,!0,!0));var ye=P>0,Ce=T&&r&&Y===void 0&&(o?J:!0),fe=Ce&&ye,ar=!fe&&ne&&ne.length>0&&R&&R.hasMore&&(R.filter||"")===J,Le=!ye&&ar,Me=Qw(ve,Zh),Ae=c!=null,Tr=!g&&Ae?xo(c,ne):null,Dr=function(){var Fr=_asyncToGenerator(_regeneratorRuntime.mark(function he(){var be,Ee,De,Be,vr,cr,ft,br,Tn,Nr,Gt,sn,jt,zt,Rt,xt=arguments;return _regeneratorRuntime.wrap(function(ot){for(;;)switch(ot.prev=ot.next){case 0:return be=xt.length>0&&xt[0]!==void 0?xt[0]:null,Ee=xt.length>1&&xt[1]!==void 0?xt[1]:!1,!Ee&&R&&L(void 0),De=Ee&&Y?Y.length:0,Be=Ee&&R||!a&&{pageSize:0},vr=++ge.current,ot.next=8,r.call(p?.ctx,be,De,Be);case 8:if(cr=ot.sent,ft=ge.current!=vr,!(ft||!se.current)){ot.next=12;break}return ot.abrupt("return",null);case 12:return br=cr!=null&&cr.values?cr:{values:cr},Tn=br.values,Nr=br.hasMore,Gt=br.meta,sn=Ro(Tn),Ee?(zt=jo(Y,sn,!1),jt=zt.length>Y.length):(zt=sn,a&&(jt=zt.length>0)),Rt=Nr!=null||Gt!=null||jt!=null?To(To(To(To({},jt!=null?{hasMore:jt}:{}),Nr!=null?{hasMore:Nr}:{}),Gt??{}),{},{filter:be}):void 0,Rt&&L(Rt),ot.abrupt("return",zt);case 18:case"end":return ot.stop()}},he)}));return function(){return Fr.apply(this,arguments)}}(),xr=function(){var Fr=_asyncToGenerator(_regeneratorRuntime.mark(function he(){var be,Ee,De,Be=arguments;return _regeneratorRuntime.wrap(function(cr){for(;;)switch(cr.prev=cr.next){case 0:return be=Be.length>0&&Be[0]!==void 0?Be[0]:null,Ee=Be.length>1&&Be[1]!==void 0?Be[1]:!1,x(function(ft){return ft+1}),$(Ee),cr.next=6,Dr(be,Ee);case 6:if(De=cr.sent,se.current){cr.next=9;break}return cr.abrupt("return");case 9:De!=null&&ae(De),x(function(ft){return ft-1}),$(!1);case 12:case"end":return cr.stop()}},he)}));return function(){return Fr.apply(this,arguments)}}(),$r=React.useCallback(debounce(xr,v),[]);React.useEffect(function(){return se.current++,Ce&&P==0&&ge.current==0&&_asyncToGenerator(_regeneratorRuntime.mark(function Fr(){return _regeneratorRuntime.wrap(function(be){for(;;)switch(be.prev=be.next){case 0:return be.next=2,xr();case 2:case"end":return be.stop()}},Fr)}))(),function(){se.current--}},[Ce]);var je=function(){E(!0)},yr=function(){var Fr=_asyncToGenerator(_regeneratorRuntime.mark(function he(be){var Ee,De;return _regeneratorRuntime.wrap(function(vr){for(;;)switch(vr.prev=vr.next){case 0:if(Ee=ce.current,Ee?(ce.current=!1,g&&E(!1)):E(!1),!(h==="mui"&&!Ee)){vr.next=6;break}return De="",vr.next=6,Pe(null,De,"my-reset");case 6:case"end":return vr.stop()}},he)}));return function(be){return Fr.apply(this,arguments)}}(),Gr=function(he){he?je():yr()},pr=function(he){var be=he?.specialValue||he?.value;return m.includes(be)},zr=function(){var Fr=_asyncToGenerator(_regeneratorRuntime.mark(function he(be,Ee,De){var Be,vr,cr,ft,br,Tn,Nr,Gt,sn,jt,zt,Rt,xt,Ci,ot,Do,Kr;return _regeneratorRuntime.wrap(function($e){for(;;)switch($e.prev=$e.next){case 0:if(vr=g&&h==="mui"&&De==="clear",cr=!g&&h==="mui"&&De==="clear"&&be?.type==="change",ft=!g&&h==="mui"&&De==="clear"&&be?.type!=="change",h==="mui"&&(De=Ee,g?Ee=De.map(function(ht){var ln;return(ln=ht?.value)!==null&&ln!==void 0?ln:ht}):Ee=(br=(Tn=De)===null||Tn===void 0?void 0:Tn.value)!==null&&br!==void 0?br:De),Nr=g&&Array.isArray(De)&&De.map(function(ht){return ht?.specialValue}).find(function(ht){return!!ht})||((Be=De)===null||Be===void 0?void 0:Be.specialValue),g&&Ee&&!Array.isArray(Ee)&&(Ee=[].concat(_toConsumableArray(c||[]),[Ee]),De=null),Gt=vr&&Ee.length===0&&J&&T||cr,!Gt){$e.next=9;break}return $e.abrupt("return");case 9:if(sn=g&&Ee.length&&Ee.length>(c||[]).length&&Ee[Ee.length-1]==J&&!xo(J,Y),Nr!="LOAD_MORE"){$e.next=17;break}return K(J),ce.current=!0,$e.next=15,xr(J,!0);case 15:$e.next=37;break;case 17:if(Nr!="LOADING_MORE"){$e.next=21;break}ce.current=!0,$e.next=37;break;case 21:if(!g){$e.next=31;break}if(jt=Yw(Ee,ne,l),zt=_slicedToArray(jt,2),Rt=zt[0],xt=zt[1],d(Rt,r?xt:void 0),!sn){$e.next=29;break}return $e.next=27,em(0);case 27:return $e.next=29,Pe(null,"","my-reset");case 29:$e.next=37;break;case 31:if(Ci=Jw(Ee,ne,l),ot=_slicedToArray(Ci,2),Do=ot[0],Kr=ot[1],d(Do,r?Kr:void 0),!(ft&&y)){$e.next=37;break}return $e.next=36,em(0);case 36:E(!1);case 37:case"end":return $e.stop()}},he)}));return function(be,Ee,De){return Fr.apply(this,arguments)}}(),Pe=function(){var Fr=_asyncToGenerator(_regeneratorRuntime.mark(function he(be,Ee,De){var Be,vr,cr;return _regeneratorRuntime.wrap(function(br){for(;;)switch(br.prev=br.next){case 0:if(Be=h==="mui"&&De==="reset",vr=Ee,!(vr===b||vr===O||Be)){br.next=4;break}return br.abrupt("return");case 4:if(Ee==J){br.next=13;break}if(K(vr),cr=i&&(o?!!vr:!0),!cr){br.next=12;break}return br.next=10,$r(vr);case 10:br.next=13;break;case 12:i&&o&&ae([]);case 13:case"end":return br.stop()}},he)}));return function(be,Ee,De){return Fr.apply(this,arguments)}}(),Vr=function(he){var be=_toConsumableArray(he);return a&&(Le?be.push({specialValue:"LOAD_MORE",title:b}):G&&be.push({specialValue:"LOADING_MORE",title:O,disabled:!0})),be},Pr=function(he,be){if(be==null)return null;var Ee=be.value!=null?be.value:be;return he.value===Ee},Sr=function(he){return he&&he.disabled},Jr=function(he){var be;if(he!=null&&he.isCustom)return!0;var Ee=(be=he?.value)!==null&&be!==void 0?be:he,De=xo(Ee,ne);return De?.isCustom||!1},Ln=function(he){if(he==null)return null;var be=he.value!=null?he:Zh(xo(he,ne));return!be&&he.specialValue?he.title:!be&&l||!be?he.toString():be.title||be.label||be.value.toString()},Yr=h==="mui"?Kw(Me):Me;return{options:Yr,listValues:ne,hasValue:Ae,selectedListValue:Tr,open:T,onOpen:je,onClose:yr,onDropdownVisibleChange:Gr,onChange:zr,inputValue:J,onInputChange:Pe,canShowLoadMore:Le,isInitialLoading:fe,isLoading:ye,isLoadingMore:G,isSpecialValue:pr,extendOptions:Vr,getOptionSelected:Pr,getOptionDisabled:Sr,getOptionIsCustom:Jr,getOptionLabel:Ln,aPlaceholder:S}};const CE=null;function rm(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),t.push.apply(t,r)}return t}function tm(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?rm(Object(t),!0).forEach(function(r){(0,z.A)(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):rm(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}const Yn=tm(tm({},Oe),{},{ReactUtils:cn,DragIcon:Fg});var nm=D(3202),eA=D(52961);const ol={add:"Add",remove:"Remove"},am={id:Yn.uuid(),type:"group"},im="timeFilter",om=[im],rA={...Lr.widgets,text:{...Lr.widgets.text,factory:function(e){return(0,M.jsx)(Zn.p,{value:e?.value||"",placeholder:e?.placeholder,onChange:t=>e?.setValue(t.currentTarget.value)})}},number:{...Lr.widgets.number,factory:function(e){return(0,M.jsx)(Zn.p,{value:e?.value,placeholder:e?.placeholder,type:"number",onChange:t=>e?.setValue(Number.parseInt(t.currentTarget.value,10))})}},datetime:{...Lr.widgets.datetime,factory:function(e){if(e?.operator==="macros")return(0,M.jsx)(yt.l6,{id:e.id,"aria-label":"Macros value selector",menuShouldPortal:!0,options:om.map(Rn.z),value:e?.value,onChange:r=>e.setValue(r.value)});const t=(0,nm.KQ)(e?.value).isValid()?(0,nm.KQ)(e?.value).utc():void 0;return(0,M.jsx)(eA.K,{onChange:r=>{e?.setValue(r?.format(Lr.widgets.datetime.valueFormat))},date:t})},sqlFormatValue:(n,e,t,r,a,i)=>r==="macros"?om.includes(n)?n:void 0:typeof Lr.widgets.datetime.sqlFormatValue=="string"||typeof Lr.widgets.datetime.sqlFormatValue=="object"?void 0:Lr.widgets.datetime.sqlFormatValue?.call(Lr.ctx,n,e,t,r,a,i)||""}},tA={...Lr.settings,canRegroup:!1,maxNesting:1,canReorder:!1,showNot:!1,addRuleLabel:ol.add,deleteLabel:ol.remove,renderConjs:function(e){return(0,M.jsx)(yt.l6,{id:e?.id,"aria-label":"Conjunction","data-testid":ct.Tp.components.SQLQueryEditor.filterConjunction,menuShouldPortal:!0,options:e?.conjunctionOptions?Object.keys(e?.conjunctionOptions).map(Rn.z):void 0,value:e?.selectedConjunction,onChange:t=>e?.setConjunction(t.value)})},renderField:function(e){const t=e?.config?.fields||{};return(0,M.jsx)(yt.l6,{id:e?.id,width:25,"aria-label":"Field","data-testid":ct.Tp.components.SQLQueryEditor.filterField,menuShouldPortal:!0,options:e?.items.map(r=>{const a=t[r.key].mainWidgetProps?.customProps?.icon;return{label:r.label,value:r.key,icon:a}}),value:e?.selectedKey,onChange:r=>{e?.setField(r.label)}})},renderButton:function(e){return(0,M.jsx)(Ut.$n,{type:"button",title:`${e?.label} filter`,onClick:e?.onClick,variant:"secondary",size:"md",icon:e?.label===ol.add?"plus":"times"})},renderOperator:function(e){return(0,M.jsx)(yt.l6,{options:e?.items.map(t=>({label:t.label,value:t.key})),"aria-label":"Operator","data-testid":ct.Tp.components.SQLQueryEditor.filterOperator,menuShouldPortal:!0,value:e?.selectedKey,onChange:t=>{e?.setField(t.value||"")}})}};var nA=(n=>(n.IN="select_any_in",n.NOT_IN="select_not_any_in",n.MACROS="macros",n))(nA||{});const aA=lA(Lr),um=Lr.types.text.widgets.text,iA=[...um.operators||[],"select_any_in","select_not_any_in"],oA={...um,operators:iA},uA={...Lr.types,text:{...Lr.types.text,widgets:{...Lr.types.text.widgets,text:oA}},datetime:{...Lr.types.datetime,widgets:{...Lr.types.datetime.widgets,datetime:{...Lr.types.datetime.widgets.datetime,operators:["macros",...Lr.types.datetime.widgets.datetime.operators||[]]}}}},sA={...Lr,widgets:rA,settings:tA,operators:aA,types:uA},sm=()=>"",lm=n=>typeof n=="function";function lA(n){const{...e}=n.operators,t=()=>{const u=e.select_any_in.sqlFormatOp;return lm(u)?u:sm},r=(u,s,l,c,d,f,p,v)=>t()(u,s,cm(l),c,d,f,p,v),a=()=>{const u=e.select_not_any_in.sqlFormatOp;return lm(u)?u:sm},i=(u,s,l,c,d,f,p,v)=>a()(u,s,cm(l),c,d,f,p,v);return{...e,select_any_in:{...e.select_any_in,sqlFormatOp:r},select_not_any_in:{...e.select_not_any_in,sqlFormatOp:i},macros:{label:"Macros",sqlFormatOp:(u,s,l)=>l===im?`$__timeFilter(${u})`:l}}}function cm(n){return(0,Da.isString)(n)?n.split(","):n}function cA({sql:n,config:e,onSqlChange:t}){const[r,a]=(0,C.useState)(),i=(0,C.useMemo)(()=>({...sA,...e}),[e]);(0,C.useEffect)(()=>{if(!r){const u=Yn.checkTree(Yn.loadTree(n.whereJsonTree??am),i);a(u)}},[i,n.whereJsonTree,r]),(0,C.useEffect)(()=>{n.whereJsonTree||a(Yn.checkTree(Yn.loadTree(am),i))},[i,n.whereJsonTree]);const o=(0,C.useCallback)((u,s)=>{a(u);const l={...n,whereJsonTree:Yn.getTree(u),whereString:Yn.sqlFormat(u,s)};t(l)},[t,n]);return r?(0,M.jsx)(pg,{...i,value:r,onChange:o,renderBuilder:u=>(0,M.jsx)(vw,{...u})}):null}function Po(n){return`
    display: flex;
    gap: 8px;
    flex-direction: ${n};`}(0,kr.injectGlobal)`
  .group--header {
    ${Po("row")}
  }

  .group-or-rule {
    ${Po("column")}
    .rule {
      flex-direction: row;
    }
  }

  .rule--body {
    ${Po("row")}
  }

  .group--children {
    ${Po("column")}
  }

  .group--conjunctions:empty {
    display: none;
  }
`;function dA({query:n,fields:e,onQueryChange:t,db:r}){const a=(0,Jm.A)(async()=>fA(e),[e]),{onSqlChange:i}=Ei({query:n,onQueryChange:t,db:r});return(0,M.jsx)(cA,{config:{fields:a.value||{}},sql:n.sql,onSqlChange:o=>{const u=(0,Ym.w)().getVariables();pA(o,u),i(o)}},JSON.stringify(a.value))}function fA(n){const e={};for(const t of n)e[t.value]={type:t.raqbFieldType||"text",valueSources:["value"],mainWidgetProps:{customProps:{icon:t.icon}}};return e}function pA(n,e){const t=r=>"multi"in r&&r.multi&&(n.whereString?.includes(`\${${r.name}}`)||n.whereString?.includes(`$${r.name}`));e.some(r=>t(r))&&(n.whereString=n.whereString?.replaceAll("')",")"),n.whereString=n.whereString?.replaceAll("('","("))}var Io=D(48583),ul=D(41117),Ia=D(76302);function dm({columns:n,onParameterChange:e,value:t}){const r=(0,C.useId)();return(0,M.jsx)(It.c,{label:"Column",width:25,children:(0,M.jsx)(yt.l6,{value:t,"data-testid":ct.Tp.components.SQLQueryEditor.selectColumn,inputId:r,menuShouldPortal:!0,options:[{label:"*",value:"*"},...n],allowCustomValue:!0,onChange:a=>e(a.value)})})}function vA({columns:n,query:e,onSqlChange:t,onParameterChange:r,currentColumnIndex:a}){const i=(0,pn.of)(gA),o=e.sql?.columns?.[a],u=(0,C.useCallback)(c=>{const d=e.sql?.columns?.[c];if(!d)return;d.parameters=d.parameters?[...d.parameters,{type:ul._.FunctionParameter,name:""}]:[];const f={...e.sql,columns:e.sql?.columns?.map((p,v)=>v===c?d:p)};t(f)},[t,e.sql]),s=(0,C.useCallback)((c,d)=>{const f=e.sql?.columns?.[c];if(!f?.parameters)return;f.parameters=f.parameters?.filter((v,g)=>g!==d);const p={...e.sql,columns:e.sql?.columns?.map((v,g)=>g===c?f:v)};t(p)},[t,e.sql]);function l(c){return!o?.parameters||o.parameters.length<=1?null:o.parameters.map((f,p)=>p===0?null:(0,M.jsxs)(Io.B,{gap:2,children:[(0,M.jsx)(Ia.c,{className:i.label,children:","}),(0,M.jsx)(Zn.p,{onChange:v=>r(p)(v.currentTarget.value),value:f.name,"aria-label":`Parameter ${p} for column ${c}`,"data-testid":ct.Tp.components.SQLQueryEditor.selectInputParameter,addonAfter:(0,M.jsx)(Ut.$n,{title:"Remove parameter",type:"button",icon:"times",variant:"secondary",size:"md",onClick:()=>s(c,p)})})]},p))}return(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)(Ia.c,{className:i.label,children:"("}),(0,M.jsx)(dm,{columns:n,onParameterChange:c=>r(0)(c),value:(0,fn.oG)(o?.parameters?.[0])}),l(a),(0,M.jsx)(Ut.$n,{type:"button",onClick:()=>u(a),variant:"secondary",size:"md",icon:"plus",title:"Add parameter"}),(0,M.jsx)(Ia.c,{className:i.label,children:")"})]})}const gA=()=>({label:(0,kr.css)({padding:0,margin:0,width:"unset"})});function hA({query:n,onSqlChange:e,currentColumnIndex:t,db:r,columns:a}){const i=(0,C.useId)(),o=n.sql?.columns?.[t],u=(0,pn.of)(mA),s=r.functions().find(p=>p.name===o?.name),[l,c]=(0,C.useState)([]);(0,C.useEffect)(()=>{(async()=>{if(!s)return;const v=[];for(const g of s.parameters??[])g.options?v.push(await g.options(n)):v.push([]);c(v)})()},[o?.name]);const d=(0,C.useCallback)((p,v)=>g=>{const h=n.sql?.columns?.[t];if(!h)return;h.parameters||(h.parameters=[]),h.parameters[p]===void 0?h.parameters[p]={type:ul._.FunctionParameter,name:g}:g==null&&v?(h.parameters=h.parameters.map((m,b)=>b===p?{...m,name:""}:m),h.parameters[h.parameters.length-1]?.name===""&&(h.parameters=h.parameters.filter(m=>m.name!==""))):g==null?h.parameters=h.parameters.filter((m,b)=>b!==p):h.parameters=h.parameters.map((m,b)=>b===p?{...m,name:g}:m);const y={...n.sql,columns:n.sql?.columns?.map((m,b)=>b===t?h:m)};e(y)},[t,e,n.sql]);function f(){return s?.parameters?s?.parameters.map((p,v)=>(0,M.jsxs)(Io.B,{alignItems:"flex-end",gap:2,children:[(0,M.jsx)(It.c,{label:p.name,width:25,optional:!p.required,children:(0,M.jsx)(M.Fragment,{children:p.options?(0,M.jsx)(yt.l6,{value:(0,fn.oG)(o?.parameters[v]),options:l?.[v],"data-testid":ct.Tp.components.SQLQueryEditor.selectFunctionParameter(p.name),inputId:i,menuShouldPortal:!0,allowCustomValue:!0,isClearable:!0,onChange:g=>d(v,!0)(g?.value)}):(0,M.jsx)(Zn.p,{onChange:g=>d(v,!0)(g.currentTarget.value),value:o?.parameters[v]?.name,"data-testid":ct.Tp.components.SQLQueryEditor.selectInputParameter})})}),s.parameters.length!==v+1&&(0,M.jsx)(Ia.c,{className:u.label,children:","})]},v)):null}return o?.name===void 0?(0,M.jsx)(dm,{columns:a,onParameterChange:p=>d(0)(p),value:(0,fn.oG)(o?.parameters?.[0])}):s?(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)(Ia.c,{className:u.label,children:"("}),f(),(0,M.jsx)(Ia.c,{className:u.label,children:")"})]}):(0,M.jsx)(vA,{query:n,onSqlChange:e,currentColumnIndex:t,columns:a,onParameterChange:d})}const mA=()=>({label:(0,kr.css)({padding:0,margin:0,width:"unset"})});function yA({query:n,onQueryChange:e,db:t,columns:r}){const a=(0,pn.of)(bA),{onSqlChange:i}=Ei({query:n,onQueryChange:e,db:t}),o=[];n.format===jn.gv.Timeseries&&(o.push({label:"time",value:"time"}),o.push({label:"value",value:"value"}));const u=(0,C.useCallback)((f,p)=>v=>{const g={...f,name:v?.value,parameters:[{type:ul._.FunctionParameter,name:f.parameters?.[0]?.name||""}]},h={...n.sql,columns:n.sql?.columns?.map((y,m)=>m===p?g:y)};i(h)},[i,n.sql]),s=(0,C.useCallback)((f,p)=>v=>{let g={...f};v!==null?g={...f,alias:`"${v?.value?.trim()}"`}:delete g.alias;const h={...n.sql,columns:n.sql?.columns?.map((y,m)=>m===p?g:y)};i(h)},[i,n.sql]),l=(0,C.useCallback)(f=>()=>{const p=[...n.sql?.columns||[]];p.splice(f,1);const v={...n.sql,columns:p};i(v)},[i,n.sql]),c=(0,C.useCallback)(()=>{const f={...n.sql,columns:[...n.sql?.columns||[],(0,fn.JD)()]};i(f)},[i,n.sql]),d=()=>{const f=[{label:"Aggregations",options:[]},{label:"Macros",options:[]}];for(const p of t.functions())p.name.startsWith("$__")?f[1].options.push({label:p.name,value:p.name}):f[0].options.push({label:p.name,value:p.name});return f};return(0,M.jsxs)(Io.B,{gap:2,wrap:"wrap",direction:"column",children:[n.sql?.columns?.map((f,p)=>(0,M.jsx)("div",{children:(0,M.jsxs)(Io.B,{gap:2,alignItems:"end",children:[(0,M.jsx)(It.c,{label:"Data operations",optional:!0,width:25,children:(0,M.jsx)(yt.l6,{value:f.name?(0,Rn.z)(f.name):null,inputId:`select-aggregation-${p}-${(0,Da.uniqueId)()}`,"data-testid":ct.Tp.components.SQLQueryEditor.selectAggregation,isClearable:!0,menuShouldPortal:!0,allowCustomValue:!0,options:d(),onChange:u(f,p)})}),(0,M.jsx)(hA,{currentColumnIndex:p,columns:r,onSqlChange:i,query:n,db:t}),(0,M.jsx)(It.c,{label:"Alias",optional:!0,width:15,children:(0,M.jsx)(yt.l6,{value:f.alias?(0,Rn.z)(f.alias):null,inputId:`select-alias-${p}-${(0,Da.uniqueId)()}`,"data-testid":ct.Tp.components.SQLQueryEditor.selectAlias,options:o,onChange:s(f,p),isClearable:!0,menuShouldPortal:!0,allowCustomValue:!0})}),(0,M.jsx)(Ut.$n,{title:"Remove column",type:"button",icon:"trash-alt",variant:"secondary",size:"md",onClick:l(p)})]})},p)),(0,M.jsx)(Ut.$n,{type:"button",onClick:c,variant:"secondary",title:"Add column",size:"md",icon:"plus",className:a.addButton})]})}const bA=()=>({addButton:(0,kr.css)({alignSelf:"flex-start"}),label:(0,kr.css)({padding:0,margin:0,width:"unset"})}),OA=({query:n,db:e,queryRowFilter:t,onChange:r,onValidate:a,range:i})=>{const o=(0,lt.A)(async()=>await e.fields(n),[e,n.dataset,n.table]);return(0,M.jsxs)(M.Fragment,{children:[(0,M.jsxs)(km.D,{children:[(0,M.jsx)(Xn.U,{children:(0,M.jsx)(yA,{columns:o.value||[],query:n,onQueryChange:r,db:e})}),t.filter&&(0,M.jsx)(Xn.U,{children:(0,M.jsx)(It.c,{label:"Filter by column value",optional:!0,children:(0,M.jsx)(dA,{fields:o.value||[],query:n,onQueryChange:r,db:e})})}),t.group&&(0,M.jsx)(Xn.U,{children:(0,M.jsx)(It.c,{label:"Group by column",children:(0,M.jsx)(Wm,{fields:o.value||[],query:n,onQueryChange:r,db:e})})}),t.order&&(0,M.jsx)(Xn.U,{children:(0,M.jsx)(Hm,{fields:o.value||[],query:n,onQueryChange:r,db:e})}),t.preview&&n.rawSql&&(0,M.jsx)(Xn.U,{children:(0,M.jsx)(Mm.l,{rawSql:n.rawSql,datasourceType:n.datasource?.type})})]}),(0,M.jsx)(pl,{db:e,query:n,onValidate:a,range:i})]})};function SA({datasource:n,query:e,onChange:t,onRunQuery:r,range:a,queryHeaderProps:i}){const[o,u]=(0,C.useState)(!0),s=n.getDB(),{preconfiguredDatabase:l}=n,c=i?.dialect??"other",{loading:d,error:f}=(0,lt.A)(async()=>()=>{n.getDB(n.id).init!==void 0&&n.getDB(n.id).init()},[n]),p=(0,hm.T)(e),[v,g]=(0,C.useState)({filter:!!p.sql?.whereString,group:!!p.sql?.groupBy?.[0]?.property.name,order:!!p.sql?.orderBy?.property.name,preview:!0}),[h,y]=(0,C.useState)(p);(0,C.useEffect)(()=>()=>{n.getDB(n.id).dispose!==void 0&&n.getDB(n.id).dispose()},[n]);const m=(0,C.useCallback)(S=>{FA(S)&&r&&r()},[r]),b=(S,F=!0)=>{y(S),t(S),(0,fn.YW)(S.sql?.columns)&&S.sql?.columns.some(_=>_.name)&&!v.group&&g({...v,group:!0}),F&&m(S)},O=S=>{y(S),t(S)};return d||f?null:(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)(Am,{db:s,preconfiguredDataset:l,onChange:O,onRunQuery:r,onQueryRowChange:g,queryRowFilter:v,query:p,isQueryRunnable:o,dialect:c}),(0,M.jsx)(Qn.$,{v:.5}),p.editorMode!==Or.lX.Code&&(0,M.jsx)(OA,{db:s,query:p,onChange:S=>b(S,!1),queryRowFilter:v,onValidate:u,range:a}),p.editorMode===Or.lX.Code&&(0,M.jsx)(Vm,{db:s,query:p,queryToValidate:h,onChange:b,onRunQuery:r,onValidate:u,range:a})]})}const FA=n=>!!n.rawSql},18678:function(st,gr,D){var we,Je;(function(or,ee){we=ee,Je=typeof we=="function"?we.call(gr,D,gr,st):we,Je!==void 0&&(st.exports=Je)})(this,function(){"use strict";Array.isArray||(Array.isArray=function(B){return Object.prototype.toString.call(B)==="[object Array]"});function or(B){for(var H=[],le=0,te=B.length;le<te;le++)H.indexOf(B[le])===-1&&H.push(B[le]);return H}var ee={},Ye={"==":function(B,H){return B==H},"===":function(B,H){return B===H},"!=":function(B,H){return B!=H},"!==":function(B,H){return B!==H},">":function(B,H){return B>H},">=":function(B,H){return B>=H},"<":function(B,H,le){return le===void 0?B<H:B<H&&H<le},"<=":function(B,H,le){return le===void 0?B<=H:B<=H&&H<=le},"!!":function(B){return ee.truthy(B)},"!":function(B){return!ee.truthy(B)},"%":function(B,H){return B%H},log:function(B){return console.log(B),B},in:function(B,H){return!H||typeof H.indexOf>"u"?!1:H.indexOf(B)!==-1},cat:function(){return Array.prototype.join.call(arguments,"")},substr:function(B,H,le){if(le<0){var te=String(B).substr(H);return te.substr(0,te.length+le)}return String(B).substr(H,le)},"+":function(){return Array.prototype.reduce.call(arguments,function(B,H){return parseFloat(B,10)+parseFloat(H,10)},0)},"*":function(){return Array.prototype.reduce.call(arguments,function(B,H){return parseFloat(B,10)*parseFloat(H,10)})},"-":function(B,H){return H===void 0?-B:B-H},"/":function(B,H){return B/H},min:function(){return Math.min.apply(this,arguments)},max:function(){return Math.max.apply(this,arguments)},merge:function(){return Array.prototype.reduce.call(arguments,function(B,H){return B.concat(H)},[])},var:function(B,H){var le=H===void 0?null:H,te=this;if(typeof B>"u"||B===""||B===null)return te;for(var re=String(B).split("."),Re=0;Re<re.length;Re++)if(te==null||(te=te[re[Re]],te===void 0))return le;return te},missing:function(){for(var B=[],H=Array.isArray(arguments[0])?arguments[0]:arguments,le=0;le<H.length;le++){var te=H[le],re=ee.apply({var:te},this);(re===null||re==="")&&B.push(te)}return B},missing_some:function(B,H){var le=ee.apply({missing:H},this);return H.length-le.length>=B?[]:le}};return ee.is_logic=function(B){return typeof B=="object"&&B!==null&&!Array.isArray(B)&&Object.keys(B).length===1},ee.truthy=function(B){return Array.isArray(B)&&B.length===0?!1:!!B},ee.get_operator=function(B){return Object.keys(B)[0]},ee.get_values=function(B){return B[ee.get_operator(B)]},ee.apply=function(B,H){if(Array.isArray(B))return B.map(function(hr){return ee.apply(hr,H)});if(!ee.is_logic(B))return B;var le=ee.get_operator(B),te=B[le],re,Re,Fe,me,ur;if(Array.isArray(te)||(te=[te]),le==="if"||le=="?:"){for(re=0;re<te.length-1;re+=2)if(ee.truthy(ee.apply(te[re],H)))return ee.apply(te[re+1],H);return te.length===re+1?ee.apply(te[re],H):null}else if(le==="and"){for(re=0;re<te.length;re+=1)if(Re=ee.apply(te[re],H),!ee.truthy(Re))return Re;return Re}else if(le==="or"){for(re=0;re<te.length;re+=1)if(Re=ee.apply(te[re],H),ee.truthy(Re))return Re;return Re}else{if(le==="filter")return me=ee.apply(te[0],H),Fe=te[1],Array.isArray(me)?me.filter(function(hr){return ee.truthy(ee.apply(Fe,hr))}):[];if(le==="map")return me=ee.apply(te[0],H),Fe=te[1],Array.isArray(me)?me.map(function(hr){return ee.apply(Fe,hr)}):[];if(le==="reduce")return me=ee.apply(te[0],H),Fe=te[1],ur=typeof te[2]<"u"?te[2]:null,Array.isArray(me)?me.reduce(function(hr,cn){return ee.apply(Fe,{current:cn,accumulator:hr})},ur):ur;if(le==="all"){if(me=ee.apply(te[0],H),Fe=te[1],!Array.isArray(me)||!me.length)return!1;for(re=0;re<me.length;re+=1)if(!ee.truthy(ee.apply(Fe,me[re])))return!1;return!0}else if(le==="none"){if(me=ee.apply(te[0],H),Fe=te[1],!Array.isArray(me)||!me.length)return!0;for(re=0;re<me.length;re+=1)if(ee.truthy(ee.apply(Fe,me[re])))return!1;return!0}else if(le==="some"){if(me=ee.apply(te[0],H),Fe=te[1],!Array.isArray(me)||!me.length)return!1;for(re=0;re<me.length;re+=1)if(ee.truthy(ee.apply(Fe,me[re])))return!0;return!1}}if(te=te.map(function(hr){return ee.apply(hr,H)}),Ye.hasOwnProperty(le)&&typeof Ye[le]=="function")return Ye[le].apply(H,te);if(le.indexOf(".")>0){var jr=String(le).split("."),sr=Ye;for(re=0;re<jr.length;re++){if(!sr.hasOwnProperty(jr[re]))throw new Error("Unrecognized operation "+le+" (failed at "+jr.slice(0,re+1).join(".")+")");sr=sr[jr[re]]}return sr.apply(H,te)}throw new Error("Unrecognized operation "+le)},ee.uses_data=function(B){var H=[];if(ee.is_logic(B)){var le=ee.get_operator(B),te=B[le];Array.isArray(te)||(te=[te]),le==="var"?H.push(te[0]):te.forEach(function(re){H.push.apply(H,ee.uses_data(re))})}return or(H)},ee.add_operation=function(B,H){Ye[B]=H},ee.rm_operation=function(B){delete Ye[B]},ee.rule_like=function(B,H){if(H===B||H==="@")return!0;if(H==="number")return typeof B=="number";if(H==="string")return typeof B=="string";if(H==="array")return Array.isArray(B)&&!ee.is_logic(B);if(ee.is_logic(H)){if(ee.is_logic(B)){var le=ee.get_operator(H),te=ee.get_operator(B);if(le==="@"||le===te)return ee.rule_like(ee.get_values(B,!1),ee.get_values(H,!1))}return!1}if(Array.isArray(H))if(Array.isArray(B)){if(H.length!==B.length)return!1;for(var re=0;re<H.length;re+=1)if(!ee.rule_like(B[re],H[re]))return!1;return!0}else return!1;return!1},ee})},75198:(st,gr,D)=>{"use strict";var we;we={value:!0};var Je=D(31635),or=D(96540),ee=Je.__importDefault(D(93182));function Ye(B,H,le){H===void 0&&(H=0),le===void 0&&(le=[]);var te=ee.default(B,H),re=te[0],Re=te[1],Fe=te[2];return or.useEffect(Fe,le),[re,Re]}gr.A=Ye},93182:(st,gr,D)=>{"use strict";Object.defineProperty(gr,"__esModule",{value:!0});var we=D(96540);function Je(or,ee){ee===void 0&&(ee=0);var Ye=we.useRef(!1),B=we.useRef(),H=we.useRef(or),le=we.useCallback(function(){return Ye.current},[]),te=we.useCallback(function(){Ye.current=!1,B.current&&clearTimeout(B.current),B.current=setTimeout(function(){Ye.current=!0,H.current()},ee)},[ee]),re=we.useCallback(function(){Ye.current=null,B.current&&clearTimeout(B.current)},[]);return we.useEffect(function(){H.current=or},[or]),we.useEffect(function(){return te(),re},[ee]),[le,re,te]}gr.default=Je},58493:(st,gr,D)=>{"use strict";/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var we=D(96540);function Je(Fe,me){return Fe===me&&(Fe!==0||1/Fe===1/me)||Fe!==Fe&&me!==me}var or=typeof Object.is=="function"?Object.is:Je,ee=we.useState,Ye=we.useEffect,B=we.useLayoutEffect,H=we.useDebugValue;function le(Fe,me){var ur=me(),jr=ee({inst:{value:ur,getSnapshot:me}}),sr=jr[0].inst,hr=jr[1];return B(function(){sr.value=ur,sr.getSnapshot=me,te(sr)&&hr({inst:sr})},[Fe,ur,me]),Ye(function(){return te(sr)&&hr({inst:sr}),Fe(function(){te(sr)&&hr({inst:sr})})},[Fe]),H(ur),ur}function te(Fe){var me=Fe.getSnapshot;Fe=Fe.value;try{var ur=me();return!or(Fe,ur)}catch{return!0}}function re(Fe,me){return me()}var Re=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?re:le;gr.useSyncExternalStore=we.useSyncExternalStore!==void 0?we.useSyncExternalStore:Re},22162:(st,gr,D)=>{"use strict";/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var we=D(96540),Je=D(19888);function or(re,Re){return re===Re&&(re!==0||1/re===1/Re)||re!==re&&Re!==Re}var ee=typeof Object.is=="function"?Object.is:or,Ye=Je.useSyncExternalStore,B=we.useRef,H=we.useEffect,le=we.useMemo,te=we.useDebugValue;gr.useSyncExternalStoreWithSelector=function(re,Re,Fe,me,ur){var jr=B(null);if(jr.current===null){var sr={hasValue:!1,value:null};jr.current=sr}else sr=jr.current;jr=le(function(){function cn(lt){if(!Kn){if(Kn=!0,dn=lt,lt=me(lt),ur!==void 0&&sr.hasValue){var Or=sr.value;if(ur(Or,lt))return M=Or}return M=lt}if(Or=M,ee(dn,lt))return Or;var Qn=me(lt);return ur!==void 0&&ur(Or,Qn)?(dn=lt,Or):(dn=lt,M=Qn)}var Kn=!1,dn,M,C=Fe===void 0?null:Fe;return[function(){return cn(Re())},C===null?void 0:function(){return cn(C())}]},[Re,Fe,me,ur]);var hr=Ye(re,jr[0],jr[1]);return H(function(){sr.hasValue=!0,sr.value=hr},[hr]),te(hr),hr}},19888:(st,gr,D)=>{"use strict";st.exports=D(58493)},69242:(st,gr,D)=>{"use strict";st.exports=D(22162)},84523:(st,gr,D)=>{"use strict";D.d(gr,{X:()=>ee});var we=D(22803),Je=D(96540),or=D(29675);const ee=({children:B})=>{const H=(0,or.of)(Ye);return Je.createElement("div",{className:H.root},B)},Ye=B=>({root:(0,we.css)({display:"flex",flexWrap:"wrap",alignItems:"center",gap:B.spacing(3),minHeight:B.spacing(4)})})},40263:(st,gr,D)=>{"use strict";D.d(gr,{Z:()=>Je});var we=D(96540);const Je=({grow:or,shrink:ee})=>we.createElement("div",{style:{display:"block",flexGrow:or,flexShrink:ee}})},75686:(st,gr,D)=>{"use strict";D.d(gr,{W:()=>B});var we=D(22803),Je=D(96540),or=D(29675),ee=D(44826),Ye=D(69145);function B({label:re,...Re}){const[Fe]=(0,Je.useState)(()=>Math.random().toString(16).slice(2)),me=(0,or.of)(te),ur={SelectContainer:H,ValueContainer:le,SingleValue:le};return Je.createElement("div",{className:me.root},re&&Je.createElement("label",{className:me.label,htmlFor:Fe},re,":","\xA0"),Je.createElement(ee.l6,{openMenuOnFocus:!0,inputId:Fe,...Re,components:ur}))}const H=re=>{const{children:Re}=re,Fe=(0,or.of)(te);return Je.createElement(Ye.K,{...re,className:(0,we.cx)(re.className,Fe.container)},Re)},le=re=>{const{className:Re,children:Fe}=re,me=(0,or.of)(te);return Je.createElement("div",{className:(0,we.cx)(Re,me.valueContainer)},Fe)},te=re=>({root:(0,we.css)({display:"flex",fontSize:12,alignItems:"center"}),label:(0,we.css)({color:re.colors.text.secondary,whiteSpace:"nowrap"}),container:(0,we.css)({background:"none",borderColor:"transparent"}),valueContainer:(0,we.css)({display:"flex",alignItems:"center",flex:"initial",color:re.colors.text.secondary,fontSize:12})})}}]);

//# sourceMappingURL=sql-query-editor.f525a28e8beaf3748e58.js.map