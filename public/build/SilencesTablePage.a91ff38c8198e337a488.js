"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[1668],{57323:(B,D,t)=>{t.d(D,{_:()=>y});var e=t(74848),i=t(2543),d=t.n(i),m=t(747);const y=({actions:g,children:p})=>{const E=(0,i.filter)(g,C),A=(0,i.filter)(g,N);return E.length?(0,e.jsx)(R,{actions:E,children:p}):A.length?(0,e.jsx)(L,{actions:A,children:p}):null},R=({actions:g,children:p})=>{const E=(0,m.iI)();return S(E,g)?(0,e.jsx)(e.Fragment,{children:p}):null},L=({actions:g,children:p})=>{const E=(0,m.e2)();return S(E,g)?(0,e.jsx)(e.Fragment,{children:p}):null};function S(g,p){return(0,i.chain)(g).pick(p).values().value().some(([E,A])=>A===!0)}function C(g){return Object.values(m.QI).includes(g)}function N(g){return Object.values(m.RY).includes(g)}},79653:(B,D,t)=>{t.d(D,{e:()=>d});var e=t(74848),i=t(54594);const d=({isCollapsed:m,onToggle:y,idControlled:R,className:L,text:S,size:C="xl",...N})=>(0,e.jsx)(i.$n,{type:"button",fill:"text",variant:"secondary","aria-expanded":!m,"aria-controls":R,className:L,icon:m?"angle-right":"angle-down",onClick:()=>y(!m),...N,children:S})},88176:(B,D,t)=>{t.r(D),t.d(D,{default:()=>Oe});var e=t(74848),i=t(22803),d=t(96540),m=t(30468),y=t(29675),R=t(81876),L=t(37e3),S=t(48583),C=t(54594),N=t(91036),g=t(79784),p=t(76080),E=t(8270),A=t(65539),f=t(11817),$=t(66150),X=t(27106),Q=t(83466),K=t(88214),P=t(80187),k=t(9365),z=t(747),q=t(13005),W=t(55936),I=t(85651),_=t(37104),ee=t(32174),te=t(57323),se=t(50585),ne=t(93185),re=t(95015),ae=t(1814);const le=({matchers:s})=>{const l=(0,y.of)(ie);return(0,e.jsx)("div",{children:(0,e.jsx)(re.L,{className:l.tags,tags:s.map(r=>`${r.name}${(0,ae.MN)(r)}${r.value}`)})})},ie=()=>({tags:(0,i.css)({justifyContent:"flex-start"})});var ce=t(59830),oe=t(78464),de=t(61351),ue=t(96621);const xe=({alertManagerSourceName:s})=>{const l=(0,ue.jy)(s);return de.TP.hasPermission(l.create)?(0,e.jsx)(ce.p,{variant:"call-to-action",button:(0,e.jsx)(C.z9,{href:(0,I.nL)("alerting/silence/new",s),icon:"bell-slash",size:"lg",children:(0,e.jsx)(f.x6,{i18nKey:"silences.empty-state.button-title",children:"Create silence"})}),message:(0,f.t)("silences.empty-state.title","You haven't created any silences yet")}):(0,e.jsx)(oe.c,{callToActionElement:(0,e.jsx)("div",{}),message:"No silences found."})};var Y=t(66102),ge=t(68836),he=t(3429),me=t(79653),fe=t(35912);const je=({alert:s,className:l})=>{const[r,c]=(0,d.useState)(!0),a=(0,Y.dU)({start:new Date(s.startsAt),end:new Date(s.endsAt)}),u=Object.entries(s.labels).reduce((o,[x,n])=>((x==="alertname"||x==="__alert_rule_title__")&&(o=n),o),"");return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("tr",{className:l,children:[(0,e.jsx)("td",{children:(0,e.jsx)(me.e,{isCollapsed:r,onToggle:o=>c(o)})}),(0,e.jsx)("td",{children:(0,e.jsx)(fe.y,{state:s.status.state})}),(0,e.jsxs)("td",{children:["for ",a]}),(0,e.jsx)("td",{children:u})]}),!r&&(0,e.jsxs)("tr",{className:l,children:[(0,e.jsx)("td",{}),(0,e.jsx)("td",{colSpan:5,children:(0,e.jsx)(he.m,{labels:s.labels,size:"sm"})})]})]})},ve=({silencedAlerts:s})=>{const l=(0,y.of)(ge.L),r=(0,y.of)(ye);return s.length?(0,e.jsxs)("table",{className:(0,i.cx)(l.table,r.tableMargin),children:[(0,e.jsxs)("colgroup",{children:[(0,e.jsx)("col",{className:l.colExpand}),(0,e.jsx)("col",{className:r.colState}),(0,e.jsx)("col",{}),(0,e.jsx)("col",{className:r.colName})]}),(0,e.jsx)("thead",{children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{}),(0,e.jsx)("th",{children:(0,e.jsx)(f.x6,{i18nKey:"silences-table.header.state",children:"State"})}),(0,e.jsx)("th",{}),(0,e.jsx)("th",{children:(0,e.jsx)(f.x6,{i18nKey:"silences-table.header.alert-name",children:"Alert name"})})]})}),(0,e.jsx)("tbody",{children:s.map((c,a)=>(0,e.jsx)(je,{alert:c,className:a%2===0?l.evenRow:""},c.fingerprint))})]}):null},ye=s=>({tableMargin:(0,i.css)({marginBottom:s.spacing(1)}),colState:(0,i.css)({width:"110px"}),colName:(0,i.css)({width:"65%"})}),pe=ve,Ae=({silence:s})=>{const{startsAt:l,endsAt:r,comment:c,createdBy:a,silencedAlerts:u}=s,o=(0,y.of)(Se),x="YYYY-MM-DD HH:mm",n=m.parse(l),h=m.parse(r),j=(0,Y.dU)({start:new Date(l),end:new Date(r)});return(0,e.jsxs)("div",{className:o.container,children:[(0,e.jsx)("div",{className:o.title,children:"Comment"}),(0,e.jsx)("div",{children:c}),(0,e.jsx)("div",{className:o.title,children:"Schedule"}),(0,e.jsx)("div",{children:`${n?.format(x)} - ${h?.format(x)}`}),(0,e.jsx)("div",{className:o.title,children:"Duration"}),(0,e.jsx)("div",{children:j}),(0,e.jsx)("div",{className:o.title,children:"Created by"}),(0,e.jsx)("div",{children:a}),Array.isArray(u)&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:o.title,children:"Affected alerts"}),(0,e.jsx)(pe,{silencedAlerts:u})]})]})},Se=s=>({container:(0,i.css)({display:"grid",gridTemplateColumns:"1fr 9fr",gridRowGap:"1rem",paddingBottom:s.spacing(2)}),title:(0,i.css)({color:s.colors.text.primary}),row:(0,i.css)({margin:s.spacing(1,0)})});var Ce=t(22245);const Ee={[P.RC.Active]:"good",[P.RC.Expired]:"neutral",[P.RC.Pending]:"neutral"},Ie=({state:s})=>(0,e.jsx)(Ce.O,{state:Ee[s],children:s});var H=t(2543),De=t(86489),Te=t(40271),Me=t(6736),Pe=t(34128);const G=()=>(0,H.uniqueId)("query-string-"),be=()=>{const[s,l]=(0,d.useState)(G()),[r,c]=(0,A.s)(),{queryString:a}=(0,I.qy)(r),u=(0,y.of)(Le),o=(0,H.debounce)(h=>{const j=h.target;c({queryString:j.value||null})},400),x=()=>{c({queryString:null,silenceState:null}),setTimeout(()=>l(G()))};let n=a&&a.length>3;try{a?(0,W.S6)(a):n=!0}catch{n=!1}return(0,e.jsxs)("div",{className:u.flexRow,children:[(0,e.jsx)(De.D,{className:u.rowChild,label:(0,e.jsx)(Te.J,{children:(0,e.jsxs)(S.B,{gap:.5,children:[(0,e.jsx)(f.x6,{i18nKey:"alerting.common.search-by-matchers",children:"Search by matchers"}),(0,e.jsx)(Me.m,{content:(0,e.jsxs)("div",{children:["Filter silences by using a comma separated list of matchers, e.g.:",(0,e.jsx)("pre",{children:"severity=critical, env=production"})]}),children:(0,e.jsx)(g.I,{name:"info-circle",size:"sm"})})]})}),invalid:!n,error:n?null:"Query must use valid matcher syntax",children:(0,e.jsx)(Pe.p,{className:u.searchInput,prefix:(0,e.jsx)(g.I,{name:"search"}),onChange:o,defaultValue:a??"",placeholder:"Search","data-testid":"search-query-input"},s)}),a&&(0,e.jsx)("div",{className:u.rowChild,children:(0,e.jsx)(C.$n,{variant:"secondary",icon:"times",onClick:x,children:(0,e.jsx)(f.x6,{i18nKey:"alerting.common.clear-filters",children:"Clear filters"})})})]})},Le=s=>({searchInput:(0,i.css)({width:"360px"}),flexRow:(0,i.css)({display:"flex",flexDirection:"row",alignItems:"flex-end",paddingBottom:s.spacing(3),borderBottom:`1px solid ${s.colors.border.medium}`}),rowChild:(0,i.css)({marginRight:s.spacing(1),marginBottom:0,maxHeight:"52px"}),fieldLabel:(0,i.css)({fontSize:"12px",fontWeight:500})}),J={pollingInterval:Q.wG,refetchOnFocus:!0},Re=()=>{const{selectedAlertmanager:s=""}=(0,q.VI)(),[l,r]=(0,z.L7)(z.QI.PreviewSilencedInstances),c=l&&r,{data:a=[],isLoading:u}=k.m.endpoints.getAlertmanagerAlerts.useQuery({amSourceName:s,filter:{silenced:!0,active:!0,inhibited:!0}},{...J,skip:!c}),{data:o=[],isLoading:x,error:n}=$.F.endpoints.getSilences.useQuery({datasourceUid:(0,K.w5)(s),ruleMetadata:!0,accessControl:!0},J),{currentData:h}=X.L.useDiscoverAmFeaturesQuery({amSourceName:s??""},{skip:!s}),j=(0,I.JZ)(n).includes("the Alertmanager is not configured")&&h?.lazyConfigInit,T=(0,y.of)(Ne),[M]=(0,A.s)(),O=Z(o,!1),w=Z(o,!0),{silenceState:Be}=(0,I.qy)(M),Ke=Be===P.RC.Expired,Ue=(0,d.useMemo)(()=>{const F=v=>a.filter(b=>b.status.silencedBy.includes(v));return O.map(v=>{const b=c?F(v.id):void 0;return{id:v.id,data:{...v,silencedAlerts:b}}})},[O,a,c]),U=(0,d.useMemo)(()=>{const F=v=>a.filter(b=>b.status.silencedBy.includes(v));return w.map(v=>{const b=c?F(v.id):void 0;return{id:v.id,data:{...v,silencedAlerts:b}}})},[w,a,c]);if(x||u)return(0,e.jsx)(R._,{text:"Loading silences..."});if(j)return(0,e.jsx)(L.F,{title:"The selected Alertmanager has no configuration",severity:"warning",children:(0,e.jsx)(f.x6,{i18nKey:"silences.table.noConfig",children:"Create a new contact point to create a configuration using the default values or contact your administrator to set up the Alertmanager."})});if(n){const F=(0,I.JZ)(n)||"Unknown error.";return(0,e.jsx)(L.F,{severity:"error",title:"Error loading silences",children:F})}return(0,e.jsxs)("div",{"data-testid":"silences-table",children:[(0,e.jsx)(ne.M,{currentAlertmanager:s}),!!o.length&&(0,e.jsxs)(S.B,{direction:"column",children:[(0,e.jsx)(be,{}),(0,e.jsx)(te._,{actions:[z.QI.CreateSilence],children:(0,e.jsx)(S.B,{justifyContent:"end",children:(0,e.jsx)(C.z9,{href:(0,I.nL)("/alerting/silence/new",s),icon:"plus",children:(0,e.jsx)(f.x6,{i18nKey:"silences.table.add-silence-button",children:"Add Silence"})})})}),(0,e.jsx)(V,{items:Ue,alertManagerSourceName:s,dataTestId:"not-expired-table"}),U.length>0&&(0,e.jsxs)(N.M,{label:`Expired silences (${U.length})`,isOpen:Ke,children:[(0,e.jsxs)("div",{className:T.callout,children:[(0,e.jsx)(g.I,{className:T.calloutIcon,name:"info-circle"}),(0,e.jsx)("span",{children:(0,e.jsx)(f.x6,{i18nKey:"silences.table.expired-silences",children:"Expired silences are automatically deleted after 5 days."})})]}),(0,e.jsx)(V,{items:U,alertManagerSourceName:s,dataTestId:"expired-table"})]})]}),!o.length&&(0,e.jsx)(xe,{alertManagerSourceName:s})]})};function V({items:s,alertManagerSourceName:l,dataTestId:r}){const c=ze(l);return s.length?(0,e.jsx)(se.E,{pagination:{itemsPerPage:25},items:s,cols:c,isExpandable:!0,dataTestId:r,renderExpandedContent:({data:a})=>(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(p.c,{}),(0,e.jsx)(Ae,{silence:a})]})}):(0,e.jsx)(f.x6,{i18nKey:"silences.table.no-matching-silences",children:"No matching silences found;"})}const Z=(s,l=!1)=>{const[r]=(0,A.s)();return(0,d.useMemo)(()=>{const{queryString:c}=(0,I.qy)(r),a=r?.silenceIds;return s.filter(u=>typeof a=="string"&&!a.split(",").includes(u.id)||c&&!(0,W.Zc)(c).every(n=>u.matchers?.some(({name:h,value:j,isEqual:T,isRegex:M})=>n.name===h&&n.value===j&&n.isEqual===T&&n.isRegex===M))?!1:l?u.status.state===P.RC.Expired:u.status.state!==P.RC.Expired)},[r,s,l])},Ne=s=>({callout:(0,i.css)({backgroundColor:s.colors.background.secondary,borderTop:`3px solid ${s.colors.info.border}`,borderRadius:s.shape.radius.default,height:"62px",display:"flex",flexDirection:"row",alignItems:"center","& > *":{marginLeft:s.spacing(1)}}),calloutIcon:(0,i.css)({color:s.colors.info.text})});function ze(s){const[l,r]=(0,z.L7)(z.QI.UpdateSilence),[c]=$.F.endpoints.expireSilence.useMutation(),a=s===K.hY;return(0,d.useMemo)(()=>{const u=x=>{c({datasourceUid:(0,K.w5)(s),silenceId:x})},o=[{id:"state",label:"State",renderCell:function({data:{status:n}}){return(0,e.jsx)(Ie,{state:n.state})},size:3},{id:"alert-rule",label:"Alert rule targeted",renderCell:function({data:{metadata:n}}){return n?.rule_title?(0,e.jsx)(E.N,{href:`/alerting/grafana/${n?.rule_uid}/view?returnTo=${encodeURIComponent("/alerting/silences")}`,children:n.rule_title}):"None"},size:8},{id:"matchers",label:"Matching labels",renderCell:function({data:{matchers:n}}){const h=n?.filter(j=>j.name!==Q.kW)||[];return(0,e.jsx)(le,{matchers:h})},size:7},{id:"alerts",label:"Alerts silenced",renderCell:function({data:{silencedAlerts:n}}){return(0,e.jsx)("span",{"data-testid":"alerts",children:Array.isArray(n)?n.length:"-"})},size:2},{id:"schedule",label:"Schedule",renderCell:function({data:{startsAt:n,endsAt:h}}){const j=m.parse(n),T=m.parse(h),M="YYYY-MM-DD HH:mm";return`${j?.format(M)} - ${T?.format(M)}`},size:7}];return l&&o.push({id:"actions",label:"Actions",renderCell:function({data:n}){const h=n.status.state===P.RC.Expired,j=n?.accessControl?.create,T=n?.accessControl?.write,M=h&&(a?j:r),O=!h&&(a?T:r);return(0,e.jsxs)(S.B,{gap:.5,wrap:"wrap",children:[M&&(0,e.jsx)(C.z9,{title:"Recreate",size:"sm",variant:"secondary",icon:"sync",href:(0,I.nL)(`/alerting/silence/${n.id}/edit`,s),children:(0,e.jsx)(f.x6,{i18nKey:"silences.table.recreate-button",children:"Recreate"})}),O&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(C.z9,{title:"Unsilence",size:"sm",variant:"secondary",icon:"bell",onClick:()=>u(n.id),children:(0,e.jsx)(f.x6,{i18nKey:"silences.table.unsilence-button",children:"Unsilence"})}),(0,e.jsx)(C.z9,{title:"Edit",size:"sm",variant:"secondary",icon:"pen",href:(0,I.nL)(`/alerting/silence/${n.id}/edit`,s),children:(0,e.jsx)(f.x6,{i18nKey:"silences.table.edit-button",children:"Edit"})})]})]})},size:5}),o},[s,c,a,r,l])}function Fe(){return(0,e.jsx)(ee.y,{navId:"silences",accessType:"instance",children:(0,e.jsx)(Re,{})})}const Oe=(0,_.S)(Fe)},68836:(B,D,t)=>{t.d(D,{L:()=>i});var e=t(22803);const i=d=>({table:(0,e.css)({width:"100%",borderRadius:d.shape.radius.default,border:`solid 1px ${d.colors.border.weak}`,backgroundColor:d.colors.background.secondary,th:{padding:d.spacing(1)},td:{padding:`0 ${d.spacing(1)}`},tr:{height:"38px"}}),evenRow:(0,e.css)({backgroundColor:d.colors.background.primary}),colExpand:(0,e.css)({width:"36px"}),nameCell:(0,e.css)({gap:d.spacing(1)}),actionsCell:(0,e.css)({textAlign:"right",width:"1%",whiteSpace:"nowrap","& > * + *":{marginLeft:d.spacing(.5)}})})}}]);

//# sourceMappingURL=SilencesTablePage.a91ff38c8198e337a488.js.map