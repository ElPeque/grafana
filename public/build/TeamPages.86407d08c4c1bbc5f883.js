"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[2212],{88159:(H,C,s)=>{s.d(C,{A:()=>l});var e=s(74848),T=s(22803),u=s(58779),D=s(79784),P=s(37e3),x=s(54594),v=s(78464),r=s(11817);const f=(0,T.css)({textAlign:"center"}),o=(0,T.css)({maxWidth:"700px",margin:"0 auto"}),l=({title:d,buttonIcon:R,buttonLink:A,buttonTitle:b,buttonDisabled:z,onClick:V,proTip:K,proTipLink:E,proTipLinkTitle:W,proTipTarget:Z,infoBox:n,infoBoxTitle:a})=>{const g=()=>(0,e.jsxs)(e.Fragment,{children:[K?(0,e.jsxs)("span",{children:[(0,e.jsx)(D.I,{name:"rocket"}),(0,e.jsxs)(r.x6,{i18nKey:"empty-list-cta.pro-tip",children:["ProTip: ",{proTip:K}]}),E&&(0,e.jsx)("a",{href:E,target:Z,className:"text-link",children:W})]},"proTipFooter"):"",n?(0,e.jsx)(P.F,{severity:"info",title:a??"",className:o,children:(0,e.jsx)("div",{dangerouslySetInnerHTML:n})}):""]}),_=g()?"":(0,T.css)({marginBottom:"20px"}),$=A?x.z9:x.$n,Y=(0,e.jsx)($,{size:"lg",onClick:V,href:A,icon:R,className:_,"data-testid":u.Tp.components.CallToActionCard.buttonV2(b),disabled:z,children:b});return(0,e.jsx)(v.c,{className:f,message:d,footer:g(),callToActionElement:Y})}},32469:(H,C,s)=>{s.d(C,{Y:()=>r});var e=s(74848),T=s(96540),u=s(41053),D=s(87638),P=s(61491),x=s(71623),v=s(26185);const r=({teamId:f,roleOptions:o,disabled:c,roles:l,onApplyRoles:d,pendingRoles:R,apply:A=!1,maxWidth:b,width:z,isLoading:V})=>{const[{loading:K,value:E=l||[]},W]=(0,u.A)(async()=>{try{if(l)return l;if(A&&R?.length)return R;if(D.TP.hasPermission(P.AccessControlAction.ActionTeamsRolesList)&&f>0)return await(0,v.xN)(f)}catch(a){console.error("Error loading options",a)}return[]},[f,R,l]);(0,T.useEffect)(()=>{W()},[W]);const Z=async a=>{A?d&&d(a):(await(0,v.G3)(a,f),await W())},n=D.TP.hasPermission(P.AccessControlAction.ActionTeamsRolesAdd)&&D.TP.hasPermission(P.AccessControlAction.ActionTeamsRolesRemove);return(0,e.jsx)(x.n,{apply:A,onRolesChange:Z,roleOptions:o,appliedRoles:E,isLoading:K||V,disabled:c,basicRoleDisabled:!0,canUpdateRoles:n,maxWidth:b,width:z})}},42829:(H,C,s)=>{s.d(C,{o:()=>r});var e=s(2543),T=s.n(e),u=s(96540),D=s(24705),P=s(87638),x=s(61491),v=s(26185);const r=o=>{const[c,l]=(0,u.useState)(o),{value:d=[]}=(0,D.A)(async()=>P.TP.licensedAccessControlEnabled()&&P.TP.hasPermission(x.AccessControlAction.ActionRolesList)?(0,v.RL)(c):Promise.resolve([]),[c]);return[{roleOptions:d},l]},f=o=>{const[c,l]=useState({});return useDeepCompareEffect(()=>{if(!contextSrv.licensedAccessControlEnabled()||!contextSrv.hasPermission(AccessControlAction.ActionRolesList))return;const d=Object.keys(c).map(A=>typeof A=="number"?A:parseInt(A,10)),R=difference(o,d);Promise.all(R.map(A=>fetchRoleOptions(A).then(b=>[A,b]))).then(A=>{l({...c,...Object.fromEntries(A)})})},[o]),c}},22447:(H,C,s)=>{s.d(C,{A:()=>_,u:()=>g});var e=s(74848),T=s(22803),u=s(96540),D=s(71985),P=s(16753),x=s(58779),v=s(56276),r=s(32370),f=s(44617),o=s(86489),c=s(54731),l=s(51064),d=s(40271),R=s(14749),A=s(45282),b=s(83508),z=s(54594),V=s(90617),K=s(93403),E=s(11817),W=s(1783),Z=s(33237),n=s(97267);function a(){const B=W.Yj.map(O=>({value:O.code,label:O.name})).sort((O,m)=>O.value===W.wi?1:m.value===W.wi?-1:O.label.localeCompare(m.label));return[{value:"",label:(0,E.t)("common.locale.default","Default")},...B]}class g extends u.PureComponent{constructor(y){super(y),this.onSubmitForm=async m=>{if(m.preventDefault(),this.props.onConfirm?await this.props.onConfirm():!0){const{homeDashboardUID:L,theme:U,timezone:w,weekStart:J,language:X,queryHistory:q,navbar:N}=this.state;await this.service.update({homeDashboardUID:L,theme:U,timezone:w,weekStart:J,language:X,queryHistory:q,navbar:N}),window.location.reload()}},this.onThemeChanged=m=>{this.setState({theme:m.value}),(0,v.rR)("grafana_preferences_theme_changed",{toTheme:m.value,preferenceType:this.props.preferenceType}),m.value&&(0,n.K)(m.value,!0)},this.onTimeZoneChanged=m=>{typeof m=="string"&&this.setState({timezone:m})},this.onWeekStartChanged=m=>{this.setState({weekStart:m})},this.onHomeDashboardChanged=m=>{this.setState({homeDashboardUID:m})},this.onLanguageChanged=m=>{this.setState({language:m}),(0,v.rR)("grafana_preferences_language_changed",{toLanguage:m,preferenceType:this.props.preferenceType})},this.service=new Z.W(y.resourceUri),this.state={isLoading:!1,theme:"",timezone:"",weekStart:"",language:"",queryHistory:{homeTab:""},navbar:{bookmarkUrls:[]}};const O=[];r.$.featureToggles.extraThemes&&O.push("debug"),r.$.featureToggles.grafanaconThemes&&(O.push("desertbloom"),O.push("gildedgrove"),O.push("sapphiredusk"),O.push("tron"),O.push("gloom")),this.themeOptions=(0,D.k)(O).map(m=>({value:m.id,label:Y(m)})),this.themeOptions.unshift({value:"",label:(0,E.t)("shared-preferences.theme.default-label","Default")})}async componentDidMount(){this.setState({isLoading:!0});const y=await this.service.load();this.setState({isLoading:!1,homeDashboardUID:y.homeDashboardUID,theme:y.theme,timezone:y.timezone,weekStart:y.weekStart,language:y.language,queryHistory:y.queryHistory,navbar:y.navbar})}render(){const{theme:y,timezone:O,weekStart:m,homeDashboardUID:F,language:L,isLoading:U}=this.state,{disabled:w}=this.props,J=$(),X=a(),q=this.themeOptions.find(N=>N.value===y)??this.themeOptions[0];return(0,e.jsxs)("form",{onSubmit:this.onSubmitForm,className:J.form,children:[(0,e.jsxs)(f.n,{label:(0,e.jsx)(E.x6,{i18nKey:"shared-preferences.title",children:"Preferences"}),disabled:w,children:[(0,e.jsx)(o.D,{loading:U,disabled:U,label:(0,E.t)("shared-preferences.fields.theme-label","Interface theme"),description:r.$.featureToggles.grafanaconThemes&&r.$.feedbackLinksEnabled?(0,e.jsxs)(E.x6,{i18nKey:"shared-preferences.fields.theme-description",children:["Enjoying the limited edition themes? Tell us what you'd like to see"," ",(0,e.jsx)(c.Y,{variant:"bodySmall",external:!0,href:"https://docs.google.com/forms/d/e/1FAIpQLSeRKAY8nUMEVIKSYJ99uOO-dimF6Y69_If1Q1jTLOZRWqK1cw/viewform?usp=dialog",children:"here."})]}):void 0,children:(0,e.jsx)(l.G,{options:this.themeOptions,value:q.value,onChange:this.onThemeChanged,id:"shared-preferences-theme-select"})}),(0,e.jsx)(o.D,{loading:U,disabled:U,label:(0,e.jsx)(d.J,{htmlFor:"home-dashboard-select",children:(0,e.jsx)("span",{className:J.labelText,children:(0,e.jsx)(E.x6,{i18nKey:"shared-preferences.fields.home-dashboard-label",children:"Home Dashboard"})})}),"data-testid":"User preferences home dashboard drop down",children:(0,e.jsx)(K.b,{value:F,onChange:N=>this.onHomeDashboardChanged(N?.uid??""),defaultOptions:!0,isClearable:!0,placeholder:(0,E.t)("shared-preferences.fields.home-dashboard-placeholder","Default dashboard"),inputId:"home-dashboard-select"})}),(0,e.jsx)(o.D,{loading:U,disabled:U,label:(0,E.t)("shared-dashboard.fields.timezone-label","Timezone"),"data-testid":x.Tp.components.TimeZonePicker.containerV2,children:(0,e.jsx)(R.U,{includeInternal:!0,value:O,onChange:this.onTimeZoneChanged,inputId:"shared-preferences-timezone-picker"})}),(0,e.jsx)(o.D,{loading:U,disabled:U,label:(0,E.t)("shared-preferences.fields.week-start-label","Week start"),"data-testid":x.Tp.components.WeekStartPicker.containerV2,children:(0,e.jsx)(A.l,{value:m||"",onChange:this.onWeekStartChanged,inputId:"shared-preferences-week-start-picker"})}),(0,e.jsx)(o.D,{loading:U,disabled:U,label:(0,e.jsxs)(d.J,{htmlFor:"locale-select",children:[(0,e.jsx)("span",{className:J.labelText,children:(0,e.jsx)(E.x6,{i18nKey:"shared-preferences.fields.locale-label",children:"Language"})}),(0,e.jsx)(b.y,{featureState:P.Ay.beta})]}),"data-testid":"User preferences language drop down",children:(0,e.jsx)(l.G,{value:X.find(N=>N.value===L)?.value||"",onChange:N=>this.onLanguageChanged(N?.value??""),options:X,placeholder:(0,E.t)("shared-preferences.fields.locale-placeholder","Choose language"),id:"locale-select"})})]}),(0,e.jsx)(z.$n,{type:"submit",variant:"primary","data-testid":x.Tp.components.UserProfile.preferencesSaveButton,children:(0,e.jsx)(E.x6,{i18nKey:"common.save",children:"Save"})})]})}}const _=g,$=(0,V.N)(()=>({labelText:(0,T.css)({marginRight:"6px"}),form:(0,T.css)({width:"100%",maxWidth:"600px"})}));function Y(B){switch(B.id){case"dark":return(0,E.t)("shared.preferences.theme.dark-label","Dark");case"light":return(0,E.t)("shared.preferences.theme.light-label","Light");case"system":return(0,E.t)("shared.preferences.theme.system-label","System preference");default:return B.name}}},76917:(H,C,s)=>{s.d(C,{J:()=>x});var e=s(74848),T=s(22803),u=s(96540),D=s(56276),P=s(29675);const x=({text:r="PRO",className:f,experimentId:o,eventVariant:c="",...l})=>{const d=(0,P.of)(v);return(0,u.useEffect)(()=>{o&&(0,D.Xp)(o,"test",c)},[o,c]),(0,e.jsx)("span",{className:(0,T.cx)(d.badge,f),...l,children:r})},v=r=>({badge:(0,T.css)({marginLeft:r.spacing(1.25),borderRadius:r.shape.borderRadius(5),backgroundColor:r.colors.success.main,padding:r.spacing(.25,.75),color:"white",fontWeight:r.typography.fontWeightMedium,fontSize:r.typography.pxToRem(10)})})},4148:(H,C,s)=>{s.d(C,{pL:()=>T,z5:()=>D});var e=s(32370);const T=/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;function u(){const P=e.$.licenseInfo?.trialExpiry;return!!(P&&P>0)}const D=()=>u()&&e.$.featureToggles.featureHighlights},36605:(H,C,s)=>{s.r(C),s.d(C,{default:()=>De});var e=s(74848),T=s(25508),u=s(96540),D=s(54148),P=s(16817),x=s(32864),v=s(54122),r=s(22803),f=s(56276),o=s(29675),c=s(79784),l=s(54594),d=s(11817);const R=({featureName:t,className:i,children:h,text:p,featureId:M,eventVariant:S="",size:I="md",...j})=>{const G=(0,o.of)(A,I);return(0,u.useEffect)(()=>{(0,f.Xp)(`feature-highlights-${M}`,"test",S)},[S,M]),(0,e.jsxs)("div",{className:(0,r.cx)(G.box,i),...j,children:[(0,e.jsx)(c.I,{name:"rocket",className:G.icon}),(0,e.jsxs)("div",{className:G.inner,children:[(0,e.jsxs)("p",{className:G.text,children:[(0,e.jsx)(d.x6,{i18nKey:"upgrade-box.discovery-text",children:"You\u2019ve discovered a Pro feature!"})," ",p||(0,d.t)("upgrade-box.discovery-text-continued","Get the Grafana Pro plan to access {{featureName}}.",{featureName:t})]}),(0,e.jsx)(l.z9,{variant:"secondary",size:I,className:G.button,href:"https://grafana.com/profile/org/subscription",target:"__blank",rel:"noopener noreferrer",children:(0,e.jsx)(d.x6,{i18nKey:"upgrade-box.upgrade-button",children:"Upgrade"})})]})]})},A=(t,i)=>{const h=t.shape.borderRadius(2),p=i==="md"?"body":"bodySmall";return{box:(0,r.css)({display:"flex",alignItems:"center",position:"relative",borderRadius:h,background:t.colors.success.transparent,padding:t.spacing(2),color:t.colors.success.text,fontSize:t.typography[p].fontSize,textAlign:"left",lineHeight:"16px",margin:t.spacing(0,"auto",3,"auto"),maxWidth:`${t.breakpoints.values.xxl}px`,width:"100%"}),inner:(0,r.css)({display:"flex",alignItems:"center",width:"100%",justifyContent:"space-between"}),text:(0,r.css)({margin:0}),button:(0,r.css)({backgroundColor:t.colors.success.main,fontWeight:t.typography.fontWeightLight,color:"white","&:hover":{backgroundColor:t.colors.success.main},"&:focus-visible":{boxShadow:"none",color:t.colors.text.primary,outline:`2px solid ${t.colors.primary.main}`}}),icon:(0,r.css)({margin:t.spacing(.5,1,.5,.5)})}},b=({listItems:t,image:i,featureUrl:h,featureName:p,description:M,caption:S,action:I})=>{const j=(0,o.of)(z);return(0,e.jsxs)("div",{className:j.container,children:[(0,e.jsxs)("div",{className:j.content,children:[(0,e.jsx)("h3",{className:j.title,children:(0,e.jsxs)(d.x6,{i18nKey:"upgrade-box.get-started",children:["Get started with ",{featureName:p}]})}),M&&(0,e.jsx)("h6",{className:j.description,children:M}),(0,e.jsx)("ul",{className:j.list,children:t.map((G,k)=>(0,e.jsxs)("li",{children:[(0,e.jsx)(c.I,{name:"check",size:"xl",className:j.icon})," ",G]},k))}),I?.link&&(0,e.jsx)(l.z9,{variant:"primary",href:I.link,children:I.text}),I?.onClick&&(0,e.jsx)(l.$n,{variant:"primary",onClick:I.onClick,children:I.text}),h&&(0,e.jsx)(l.z9,{fill:"text",href:h,className:j.link,target:"_blank",rel:"noreferrer noopener",children:(0,e.jsx)(d.x6,{i18nKey:"upgrade-box.learn-more",children:"Learn more"})})]}),(0,e.jsxs)("div",{className:j.media,children:[(0,e.jsx)("img",{src:E(i),alt:"Feature screenshot"}),S&&(0,e.jsx)("p",{className:j.caption,children:S})]})]})},z=t=>({container:(0,r.css)({display:"flex",justifyContent:"space-between"}),content:(0,r.css)({width:"45%",marginRight:t.spacing(4)}),media:(0,r.css)({width:"55%",img:{width:"100%"}}),title:(0,r.css)({color:t.colors.text.maxContrast}),description:(0,r.css)({color:t.colors.text.primary,fontWeight:t.typography.fontWeightLight}),list:(0,r.css)({listStyle:"none",margin:t.spacing(4,0,2,0),li:{display:"flex",alignItems:"flex-start",color:t.colors.text.primary,padding:t.spacing(1,0)}}),icon:(0,r.css)({color:t.colors.success.main,marginRight:t.spacing(1)}),link:(0,r.css)({marginLeft:t.spacing(2)}),caption:(0,r.css)({fontWeight:t.typography.fontWeightLight,margin:t.spacing(1,0,0)})}),V=({featureName:t,description:i,featureUrl:h,image:p})=>{const M=useStyles2(K);return jsxs("div",{className:M.container,children:[jsx("h3",{className:M.title,children:jsxs(Trans,{i18nKey:"upgrade-box.get-started",children:["Get started with ",{featureName:t}]})}),i&&jsx("h6",{className:M.description,children:i}),jsx(LinkButton,{fill:"text",href:h,target:"_blank",rel:"noreferrer noopener",children:jsx(Trans,{i18nKey:"upgrade-box.learn-more",children:"Learn more"})}),jsx("div",{className:M.media,children:jsx("img",{src:E(p),alt:"Feature screenshot"})})]})},K=t=>({container:css({overflow:"auto",height:"100%"}),title:css({color:t.colors.text.maxContrast}),description:css({color:t.colors.text.primary,fontWeight:t.typography.fontWeightLight}),media:css({width:"100%",marginTop:t.spacing(2),img:{width:"100%"}})}),E=t=>t.startsWith("http")?t:"/public/img/enterprise/highlights/"+t;var W=s(88023),Z=s(12636),n=s(61351),a=s(61491),g=s(71468),_=s(6736),$=s(77222),Y=s(60484),B=s(34128),y=s(79467),O=s(94219),m=s(88159),F=s(4148),L=s(77113);const U=t=>t.groups,w=(t,i)=>t.team.uid===i?t.team:null;function J(t){return{groups:U(t.team)}}const X={loadTeamGroups:L.aK,addTeamGroup:L.It,removeTeamGroup:L.nC},q=(0,g.connect)(J,X),N="Sync LDAP, OAuth or SAML groups with your Grafana teams.";class re extends u.PureComponent{constructor(i){super(i),this.onToggleAdding=()=>{this.setState({isAdding:!this.state.isAdding})},this.onNewGroupIdChanged=h=>{this.setState({newGroupId:h.target.value})},this.onAddGroup=h=>{h.preventDefault(),this.props.addTeamGroup(this.state.newGroupId),this.setState({isAdding:!1,newGroupId:""})},this.onRemoveGroup=h=>{this.props.removeTeamGroup(h.groupId)},this.state={isAdding:!1,newGroupId:""}}componentDidMount(){this.fetchTeamGroups()}async fetchTeamGroups(){this.props.loadTeamGroups()}isNewGroupValid(){return this.state.newGroupId.length>1}renderGroup(i){const{isReadOnly:h}=this.props;return(0,e.jsxs)("tr",{children:[(0,e.jsx)("td",{children:i.groupId}),(0,e.jsx)("td",{style:{width:"1%"},children:(0,e.jsx)(l.$n,{size:"sm",variant:"destructive",onClick:()=>this.onRemoveGroup(i),disabled:h,"aria-label":`Remove group ${i.groupId}`,children:(0,e.jsx)(c.I,{name:"times"})})})]},i.groupId)}render(){const{isAdding:i,newGroupId:h}=this.state,{groups:p,isReadOnly:M}=this.props,S=le();return(0,e.jsxs)("div",{children:[(0,F.z5)()&&(0,e.jsx)(R,{featureId:"team-sync",eventVariant:"trial",featureName:"team sync",text:"Add a group to enable team sync for free during your trial of Grafana Pro."}),(0,e.jsxs)("div",{className:"page-action-bar",children:[(!(0,F.z5)()||p.length>0)&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("h3",{className:"page-sub-heading",children:"External group sync"}),(0,e.jsx)(_.m,{placement:"auto",content:N,children:(0,e.jsx)(c.I,{className:(0,r.cx)(S.icon,"page-sub-heading-icon"),name:"question-circle"})})]}),(0,e.jsx)("div",{className:"page-action-bar__spacer"}),p.length>0&&(0,e.jsxs)(l.$n,{onClick:this.onToggleAdding,disabled:M,children:[(0,e.jsx)(c.I,{name:"plus"})," Add group"]})]}),(0,e.jsx)(y.a,{in:i,children:(0,e.jsxs)("div",{className:"cta-form",children:[(0,e.jsx)(O.J,{onClick:this.onToggleAdding}),(0,e.jsx)("form",{onSubmit:this.onAddGroup,children:(0,e.jsxs)($.C,{children:[(0,e.jsx)(Y.I,{label:"Add External Group",tooltip:"LDAP Group Example: cn=users,ou=groups,dc=grafana,dc=org.",children:(0,e.jsx)(B.p,{type:"text",id:"add-external-group",placeholder:"",value:h,onChange:this.onNewGroupIdChanged,disabled:M})}),(0,e.jsx)(l.$n,{type:"submit",disabled:M||!this.isNewGroupValid(),style:{marginLeft:4},children:"Add group"})]})})]})}),p.length===0&&!i&&((0,F.z5)()?(0,e.jsx)(te,{action:{onClick:this.onToggleAdding,text:"Add group"}}):(0,e.jsx)(m.A,{onClick:this.onToggleAdding,buttonIcon:"users-alt",title:"There are no external groups to sync with",buttonTitle:"Add group",proTip:N,proTipLinkTitle:"Learn more",proTipLink:"https://grafana.com/docs/grafana/latest/setup-grafana/configure-security/configure-team-sync/",proTipTarget:"_blank",buttonDisabled:M})),p.length>0&&(0,e.jsx)("div",{className:"admin-list-table",children:(0,e.jsxs)("table",{className:"filter-table filter-table--hover form-inline",children:[(0,e.jsx)("thead",{children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{children:"External Group ID"}),(0,e.jsx)("th",{style:{width:"1%"}})]})}),(0,e.jsx)("tbody",{children:p.map(I=>this.renderGroup(I))})]})})]})}}const te=({action:t})=>{const i=(0,o.$j)();return(0,e.jsx)(b,{action:t,listItems:["Stop managing user access in two places - assign users to groups in SAML, LDAP or Oauth, and manage access at a Team level in Grafana","Update users\u2019 permissions immediately when you add or remove them from an LDAP group, with no need for them to sign out and back in"],image:`team-sync-${i.isLight?"light":"dark"}.png`,featureName:"team sync",featureUrl:"https://grafana.com/docs/grafana/latest/enterprise/team-sync",description:"Team Sync makes it easier for you to manage users\u2019 access in Grafana, by immediately updating each user\u2019s Grafana teams and permissions based on their single sign-on group membership, instead of when users sign in."})},ie=(0,g.connect)(J,X)(re),le=()=>({icon:(0,r.css)({opacity:.7,"&:hover":{opacity:1}})});var ce=s(12590);const de=t=>{const i=n.TP.hasPermissionInMetadata(a.AccessControlAction.ActionTeamsPermissionsWrite,t.team);return(0,e.jsx)(ce.x,{title:"",addPermissionTitle:"Add member",buttonLabel:"Add member",emptyLabel:"There are no members in this team or you do not have the permissions to list the current members.",resource:"teams",resourceId:t.team.id,canSetPermissions:i})};var me=s(49785),he=s(48583),ue=s(44617),ee=s(86489),ge=s(32469),pe=s(42829),fe=s(22447);const Ee={updateTeam:L.n7},Pe=(0,g.connect)(null,Ee)(({team:t,updateTeam:i})=>{const h=n.TP.hasPermissionInMetadata(a.AccessControlAction.ActionTeamsWrite,t),p=n.TP.user.orgId,[{roleOptions:M}]=(0,pe.o)(p),{handleSubmit:S,register:I,formState:{errors:j}}=(0,me.mN)({defaultValues:t}),G=n.TP.hasPermission(a.AccessControlAction.ActionTeamsRolesAdd)&&n.TP.hasPermission(a.AccessControlAction.ActionTeamsRolesRemove),k=n.TP.hasPermissionInMetadata(a.AccessControlAction.ActionTeamsRolesList,t)&&n.TP.hasPermission(a.AccessControlAction.ActionRolesList),Q=async se=>{i(se.name,se.email||"")};return(0,e.jsxs)(he.B,{direction:"column",gap:3,children:[(0,e.jsx)("form",{onSubmit:S(Q),style:{maxWidth:"600px"},children:(0,e.jsxs)(ue.n,{label:"Team details",children:[(0,e.jsx)(ee.D,{label:"Numerical identifier",disabled:!0,children:(0,e.jsx)(B.p,{value:t.id,id:"id-input"})}),(0,e.jsx)(ee.D,{label:"Name",disabled:!h,required:!0,invalid:!!j.name,error:"Name is required",children:(0,e.jsx)(B.p,{...I("name",{required:!0}),id:"name-input"})}),n.TP.licensedAccessControlEnabled()&&k&&(0,e.jsx)(ee.D,{label:"Role",children:(0,e.jsx)(ge.Y,{teamId:t.id,roleOptions:M,disabled:!G,maxWidth:"100%"})}),(0,e.jsx)(ee.D,{label:"Email",description:"This is optional and is primarily used to set the team profile avatar (via gravatar service).",disabled:!h,children:(0,e.jsx)(B.p,{...I("email"),placeholder:"team@email.com",type:"email",id:"email-input"})}),(0,e.jsx)(l.$n,{type:"submit",disabled:!h,children:"Save"})]})}),(0,e.jsx)(fe.u,{resourceUri:`teams/${t.id}`,disabled:!h,preferenceType:"team"})]})});var Te=s(58258),xe=(t=>(t.Members="members",t.Settings="settings",t.GroupSync="groupsync",t))(xe||{});const ae=["members","settings","groupsync"],ve=(0,T.Mz)([t=>t.team,(t,i)=>i],(t,i)=>w(t,i)),Ae=(0,T.Mz)([t=>t.navIndex,(t,i)=>i,(t,i,h)=>h],(t,i,h)=>{const p=(0,Te.X)(i);return(0,Z.tc)(t,`team-${i}-${h}`,p).main}),ne=(0,u.memo)(()=>{const t=(0,u.useRef)((0,x.a)("teamsync")),{uid:i="",page:h}=(0,D.g)(),p=(0,a.useSelector)(Q=>ve(Q,i));let M="members";(!p||!n.TP.hasPermissionInMetadata(a.AccessControlAction.ActionTeamsPermissionsRead,p))&&(M="settings");const S=h??M,I=(0,a.useSelector)(Q=>Ae(Q,S,i)),j=(0,a.useDispatch)(),{loading:G}=(0,P.A)(async()=>j((0,L.eo)(i)),[i]),k=()=>{const Q=ae.includes(S)?S:ae[0],se=n.TP.hasPermissionInMetadata(a.AccessControlAction.ActionTeamsRead,p),oe=n.TP.hasPermissionInMetadata(a.AccessControlAction.ActionTeamsPermissionsRead,p),ye=n.TP.hasPermissionInMetadata(a.AccessControlAction.ActionTeamsPermissionsWrite,p);switch(Q){case"members":return oe?(0,e.jsx)(de,{team:p}):null;case"settings":return se&&(0,e.jsx)(Pe,{team:p});case"groupsync":if(t.current){if(oe)return(0,e.jsx)(ie,{isReadOnly:!ye})}else if(W.Ay.featureToggles.featureHighlights)return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(R,{featureName:"team sync",featureId:"team-sync"}),(0,e.jsx)(te,{})]})}return null};return(0,e.jsx)(v.Y,{navId:"teams",pageNav:I,children:(0,e.jsx)(v.Y.Contents,{isLoading:G,children:p&&Object.keys(p).length!==0&&k()})})});ne.displayName="TeamPages";const De=ne},77113:(H,C,s)=>{s.d(C,{Bu:()=>o,It:()=>E,To:()=>d,Vk:()=>b,aK:()=>K,eo:()=>l,n7:()=>V,nC:()=>W,nM:()=>R,yd:()=>A});var e=s(2543),T=s.n(e),u=s(28082),D=s(23737),P=s(87638),x=s(15084),v=s(61491),r=s(58258),f=s(34361);function o(n=!1){return async(a,g)=>{const{query:_,page:$,perPage:Y,sort:B}=g().teams;if(!P.TP.hasPermission(v.AccessControlAction.ActionTeamsRead)){a((0,f.Q9)({teams:[],totalCount:0,page:1,perPage:Y,noTeams:!0}));return}const y=await(0,u.AI)().get("/api/teams/search",(0,x.F)({query:_,page:$,perpage:Y,sort:B}));let O=!1;if(n&&(O=y.teams.length===0),P.TP.licensedAccessControlEnabled()&&P.TP.hasPermission(v.AccessControlAction.ActionTeamsRolesList)){a((0,f.dJ)());const m=y?.teams.map(L=>L.id),F=await(0,u.AI)().post("/api/access-control/teams/roles/search",{teamIds:m});y.teams.forEach(L=>{L.roles=F?F[L.id]||[]:[]}),a((0,f.jE)())}a((0,f.Q9)({noTeams:O,...y}))}}const c=(0,e.debounce)(n=>n(o()),500);function l(n){return async a=>{const g=await(0,u.AI)().get(`/api/teams/${n}`,(0,x.F)());a((0,f.$T)(g)),a((0,D.Vz)((0,r.R)(g)))}}function d(n){return async a=>{await(0,u.AI)().delete(`/api/teams/${n}`),await P.TP.fetchUserPermissions(),a(o())}}function R(n){return async a=>{a((0,f.L5)(n)),c(a)}}function A(n){return async a=>{a((0,f.EC)(n)),a(o())}}function b({sortBy:n}){const a=n.length?`${n[0].id}-${n[0].desc?"desc":"asc"}`:void 0;return async g=>{g((0,f.$u)(a)),g(o())}}function z(){return async(n,a)=>{const g=a().team.team,_=await getBackendSrv().get(`/api/teams/${g.uid}/members`);n(teamMembersLoaded(_))}}function V(n,a){return async(g,_)=>{const $=_().team.team;await(0,u.AI)().put(`/api/teams/${$.uid}`,{name:n,email:a}),g(l($.uid))}}function K(){return async(n,a)=>{const g=a().team.team,_=await(0,u.AI)().get(`/api/teams/${g.id}/groups`);n((0,f.tC)(_))}}function E(n){return async(a,g)=>{const _=g().team.team;await(0,u.AI)().post(`/api/teams/${_.id}/groups`,{groupId:n}),a(K())}}function W(n){return async(a,g)=>{const _=g().team.team;await(0,u.AI)().delete(`/api/teams/${_.id}/groups?groupId=${encodeURIComponent(n)}`),a(K())}}function Z(n){return async a=>{await getBackendSrv().put(`/api/teams/${n.teamId}/members/${n.userId}`,{permission:n.permission}),a(z())}}},58258:(H,C,s)=>{s.d(C,{R:()=>r,X:()=>f});var e=s(32864),T=s(76917),u=s(88023),D=s(61351),P=s(4148),x=s(61491);const v={avatarUrl:"public/img/user_profile.png",id:1,uid:"",name:"Loading",email:"loading",memberCount:0,permission:x.TeamPermissionLevel.Member,accessControl:{isEditor:!1},orgId:0,updated:""};function r(o){const c={img:o.avatarUrl,id:"team-"+o.uid,subTitle:"Manage members and settings",url:`org/teams/edit/${o.uid}`,text:o.name,children:[{active:!1,icon:"sliders-v-alt",id:`team-settings-${o.uid}`,text:"Settings",url:`org/teams/edit/${o.uid}/settings`}]};(o===v||D.TP.hasPermissionInMetadata(x.AccessControlAction.ActionTeamsPermissionsRead,o))&&c.children.unshift({active:!1,icon:"users-alt",id:`team-members-${o.uid}`,text:"Members",url:`org/teams/edit/${o.uid}/members`});const l={active:!1,icon:"sync",id:`team-groupsync-${o.uid}`,text:"External group sync",url:`org/teams/edit/${o.uid}/groupsync`},d=o===v;return(0,P.z5)()&&(l.tabSuffix=()=>(0,T.J)({experimentId:d?"":"feature-highlights-team-sync-badge",eventVariant:"trial"})),(0,e.a)("teamsync")?(d||D.TP.hasPermissionInMetadata(x.AccessControlAction.ActionTeamsPermissionsRead,o))&&c.children.push(l):u.Ay.featureToggles.featureHighlights&&c.children.push({...l,tabSuffix:()=>(0,T.J)({experimentId:d?"":"feature-highlights-team-sync-badge"})}),c}function f(o){const c=r(v);let l;for(const d of c.children)if(d.id.indexOf(o)>0){d.active=!0,l=d;break}return{main:c,node:l}}}}]);

//# sourceMappingURL=TeamPages.86407d08c4c1bbc5f883.js.map